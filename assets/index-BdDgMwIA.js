var my=r=>{throw TypeError(r)};var pd=(r,t,e)=>t.has(r)||my("Cannot "+e);var Kt=(r,t,e)=>(pd(r,t,"read from private field"),e?e.call(r):t.get(r)),zn=(r,t,e)=>t.has(r)?my("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),Ye=(r,t,e,n)=>(pd(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),Un=(r,t,e)=>(pd(r,t,"access private method"),e);var _y=(r,t,e,n)=>({set _(a){Ye(r,t,a,e)},get _(){return Kt(r,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();var gd={exports:{}},Yr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yy;function DE(){if(yy)return Yr;yy=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,a,o){var c=null;if(o!==void 0&&(c=""+o),a.key!==void 0&&(c=""+a.key),"key"in a){o={};for(var h in a)h!=="key"&&(o[h]=a[h])}else o=a;return a=o.ref,{$$typeof:r,type:n,key:c,ref:a!==void 0?a:null,props:o}}return Yr.Fragment=t,Yr.jsx=e,Yr.jsxs=e,Yr}var by;function ME(){return by||(by=1,gd.exports=DE()),gd.exports}var At=ME(),md={exports:{}},bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vy;function NE(){if(vy)return bt;vy=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.iterator;function y(D){return D===null||typeof D!="object"?null:(D=_&&D[_]||D["@@iterator"],typeof D=="function"?D:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,S={};function C(D,q,W){this.props=D,this.context=q,this.refs=S,this.updater=W||b}C.prototype.isReactComponent={},C.prototype.setState=function(D,q){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,q,"setState")},C.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function w(){}w.prototype=C.prototype;function M(D,q,W){this.props=D,this.context=q,this.refs=S,this.updater=W||b}var T=M.prototype=new w;T.constructor=M,A(T,C.prototype),T.isPureReactComponent=!0;var N=Array.isArray,R={H:null,A:null,T:null,S:null,V:null},k=Object.prototype.hasOwnProperty;function z(D,q,W,X,it,yt){return W=yt.ref,{$$typeof:r,type:D,key:q,ref:W!==void 0?W:null,props:yt}}function j(D,q){return z(D.type,q,void 0,void 0,void 0,D.props)}function $(D){return typeof D=="object"&&D!==null&&D.$$typeof===r}function tt(D){var q={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(W){return q[W]})}var Q=/\/+/g;function lt(D,q){return typeof D=="object"&&D!==null&&D.key!=null?tt(""+D.key):q.toString(36)}function mt(){}function Tt(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(mt,mt):(D.status="pending",D.then(function(q){D.status==="pending"&&(D.status="fulfilled",D.value=q)},function(q){D.status==="pending"&&(D.status="rejected",D.reason=q)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function _t(D,q,W,X,it){var yt=typeof D;(yt==="undefined"||yt==="boolean")&&(D=null);var at=!1;if(D===null)at=!0;else switch(yt){case"bigint":case"string":case"number":at=!0;break;case"object":switch(D.$$typeof){case r:case t:at=!0;break;case g:return at=D._init,_t(at(D._payload),q,W,X,it)}}if(at)return it=it(D),at=X===""?"."+lt(D,0):X,N(it)?(W="",at!=null&&(W=at.replace(Q,"$&/")+"/"),_t(it,q,W,"",function(kn){return kn})):it!=null&&($(it)&&(it=j(it,W+(it.key==null||D&&D.key===it.key?"":(""+it.key).replace(Q,"$&/")+"/")+at)),q.push(it)),1;at=0;var Mt=X===""?".":X+":";if(N(D))for(var Pt=0;Pt<D.length;Pt++)X=D[Pt],yt=Mt+lt(X,Pt),at+=_t(X,q,W,yt,it);else if(Pt=y(D),typeof Pt=="function")for(D=Pt.call(D),Pt=0;!(X=D.next()).done;)X=X.value,yt=Mt+lt(X,Pt++),at+=_t(X,q,W,yt,it);else if(yt==="object"){if(typeof D.then=="function")return _t(Tt(D),q,W,X,it);throw q=String(D),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return at}function I(D,q,W){if(D==null)return D;var X=[],it=0;return _t(D,X,"","",function(yt){return q.call(W,yt,it++)}),X}function U(D){if(D._status===-1){var q=D._result;q=q(),q.then(function(W){(D._status===0||D._status===-1)&&(D._status=1,D._result=W)},function(W){(D._status===0||D._status===-1)&&(D._status=2,D._result=W)}),D._status===-1&&(D._status=0,D._result=q)}if(D._status===1)return D._result.default;throw D._result}var Z=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)};function pt(){}return bt.Children={map:I,forEach:function(D,q,W){I(D,function(){q.apply(this,arguments)},W)},count:function(D){var q=0;return I(D,function(){q++}),q},toArray:function(D){return I(D,function(q){return q})||[]},only:function(D){if(!$(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},bt.Component=C,bt.Fragment=e,bt.Profiler=a,bt.PureComponent=M,bt.StrictMode=n,bt.Suspense=d,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,bt.__COMPILER_RUNTIME={__proto__:null,c:function(D){return R.H.useMemoCache(D)}},bt.cache=function(D){return function(){return D.apply(null,arguments)}},bt.cloneElement=function(D,q,W){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var X=A({},D.props),it=D.key,yt=void 0;if(q!=null)for(at in q.ref!==void 0&&(yt=void 0),q.key!==void 0&&(it=""+q.key),q)!k.call(q,at)||at==="key"||at==="__self"||at==="__source"||at==="ref"&&q.ref===void 0||(X[at]=q[at]);var at=arguments.length-2;if(at===1)X.children=W;else if(1<at){for(var Mt=Array(at),Pt=0;Pt<at;Pt++)Mt[Pt]=arguments[Pt+2];X.children=Mt}return z(D.type,it,void 0,void 0,yt,X)},bt.createContext=function(D){return D={$$typeof:c,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:o,_context:D},D},bt.createElement=function(D,q,W){var X,it={},yt=null;if(q!=null)for(X in q.key!==void 0&&(yt=""+q.key),q)k.call(q,X)&&X!=="key"&&X!=="__self"&&X!=="__source"&&(it[X]=q[X]);var at=arguments.length-2;if(at===1)it.children=W;else if(1<at){for(var Mt=Array(at),Pt=0;Pt<at;Pt++)Mt[Pt]=arguments[Pt+2];it.children=Mt}if(D&&D.defaultProps)for(X in at=D.defaultProps,at)it[X]===void 0&&(it[X]=at[X]);return z(D,yt,void 0,void 0,null,it)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(D){return{$$typeof:h,render:D}},bt.isValidElement=$,bt.lazy=function(D){return{$$typeof:g,_payload:{_status:-1,_result:D},_init:U}},bt.memo=function(D,q){return{$$typeof:f,type:D,compare:q===void 0?null:q}},bt.startTransition=function(D){var q=R.T,W={};R.T=W;try{var X=D(),it=R.S;it!==null&&it(W,X),typeof X=="object"&&X!==null&&typeof X.then=="function"&&X.then(pt,Z)}catch(yt){Z(yt)}finally{R.T=q}},bt.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},bt.use=function(D){return R.H.use(D)},bt.useActionState=function(D,q,W){return R.H.useActionState(D,q,W)},bt.useCallback=function(D,q){return R.H.useCallback(D,q)},bt.useContext=function(D){return R.H.useContext(D)},bt.useDebugValue=function(){},bt.useDeferredValue=function(D,q){return R.H.useDeferredValue(D,q)},bt.useEffect=function(D,q,W){var X=R.H;if(typeof W=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return X.useEffect(D,q)},bt.useId=function(){return R.H.useId()},bt.useImperativeHandle=function(D,q,W){return R.H.useImperativeHandle(D,q,W)},bt.useInsertionEffect=function(D,q){return R.H.useInsertionEffect(D,q)},bt.useLayoutEffect=function(D,q){return R.H.useLayoutEffect(D,q)},bt.useMemo=function(D,q){return R.H.useMemo(D,q)},bt.useOptimistic=function(D,q){return R.H.useOptimistic(D,q)},bt.useReducer=function(D,q,W){return R.H.useReducer(D,q,W)},bt.useRef=function(D){return R.H.useRef(D)},bt.useState=function(D){return R.H.useState(D)},bt.useSyncExternalStore=function(D,q,W){return R.H.useSyncExternalStore(D,q,W)},bt.useTransition=function(){return R.H.useTransition()},bt.version="19.1.1",bt}var Ay;function wf(){return Ay||(Ay=1,md.exports=NE()),md.exports}var En=wf(),_d={exports:{}},Xr={},yd={exports:{}},bd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sy;function OE(){return Sy||(Sy=1,(function(r){function t(I,U){var Z=I.length;I.push(U);t:for(;0<Z;){var pt=Z-1>>>1,D=I[pt];if(0<a(D,U))I[pt]=U,I[Z]=D,Z=pt;else break t}}function e(I){return I.length===0?null:I[0]}function n(I){if(I.length===0)return null;var U=I[0],Z=I.pop();if(Z!==U){I[0]=Z;t:for(var pt=0,D=I.length,q=D>>>1;pt<q;){var W=2*(pt+1)-1,X=I[W],it=W+1,yt=I[it];if(0>a(X,Z))it<D&&0>a(yt,X)?(I[pt]=yt,I[it]=Z,pt=it):(I[pt]=X,I[W]=Z,pt=W);else if(it<D&&0>a(yt,Z))I[pt]=yt,I[it]=Z,pt=it;else break t}}return U}function a(I,U){var Z=I.sortIndex-U.sortIndex;return Z!==0?Z:I.id-U.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var c=Date,h=c.now();r.unstable_now=function(){return c.now()-h}}var d=[],f=[],g=1,_=null,y=3,b=!1,A=!1,S=!1,C=!1,w=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function N(I){for(var U=e(f);U!==null;){if(U.callback===null)n(f);else if(U.startTime<=I)n(f),U.sortIndex=U.expirationTime,t(d,U);else break;U=e(f)}}function R(I){if(S=!1,N(I),!A)if(e(d)!==null)A=!0,k||(k=!0,lt());else{var U=e(f);U!==null&&_t(R,U.startTime-I)}}var k=!1,z=-1,j=5,$=-1;function tt(){return C?!0:!(r.unstable_now()-$<j)}function Q(){if(C=!1,k){var I=r.unstable_now();$=I;var U=!0;try{t:{A=!1,S&&(S=!1,M(z),z=-1),b=!0;var Z=y;try{e:{for(N(I),_=e(d);_!==null&&!(_.expirationTime>I&&tt());){var pt=_.callback;if(typeof pt=="function"){_.callback=null,y=_.priorityLevel;var D=pt(_.expirationTime<=I);if(I=r.unstable_now(),typeof D=="function"){_.callback=D,N(I),U=!0;break e}_===e(d)&&n(d),N(I)}else n(d);_=e(d)}if(_!==null)U=!0;else{var q=e(f);q!==null&&_t(R,q.startTime-I),U=!1}}break t}finally{_=null,y=Z,b=!1}U=void 0}}finally{U?lt():k=!1}}}var lt;if(typeof T=="function")lt=function(){T(Q)};else if(typeof MessageChannel<"u"){var mt=new MessageChannel,Tt=mt.port2;mt.port1.onmessage=Q,lt=function(){Tt.postMessage(null)}}else lt=function(){w(Q,0)};function _t(I,U){z=w(function(){I(r.unstable_now())},U)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(I){I.callback=null},r.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<I?Math.floor(1e3/I):5},r.unstable_getCurrentPriorityLevel=function(){return y},r.unstable_next=function(I){switch(y){case 1:case 2:case 3:var U=3;break;default:U=y}var Z=y;y=U;try{return I()}finally{y=Z}},r.unstable_requestPaint=function(){C=!0},r.unstable_runWithPriority=function(I,U){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var Z=y;y=I;try{return U()}finally{y=Z}},r.unstable_scheduleCallback=function(I,U,Z){var pt=r.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?pt+Z:pt):Z=pt,I){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=Z+D,I={id:g++,callback:U,priorityLevel:I,startTime:Z,expirationTime:D,sortIndex:-1},Z>pt?(I.sortIndex=Z,t(f,I),e(d)===null&&I===e(f)&&(S?(M(z),z=-1):S=!0,_t(R,Z-pt))):(I.sortIndex=D,t(d,I),A||b||(A=!0,k||(k=!0,lt()))),I},r.unstable_shouldYield=tt,r.unstable_wrapCallback=function(I){var U=y;return function(){var Z=y;y=U;try{return I.apply(this,arguments)}finally{y=Z}}}})(bd)),bd}var Ey;function kE(){return Ey||(Ey=1,yd.exports=OE()),yd.exports}var vd={exports:{}},Le={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wy;function LE(){if(wy)return Le;wy=1;var r=wf();function t(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(d,f,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:_==null?null:""+_,children:d,containerInfo:f,implementation:g}}var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Le.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Le.createPortal=function(d,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return o(d,f,null,g)},Le.flushSync=function(d){var f=c.T,g=n.p;try{if(c.T=null,n.p=2,d)return d()}finally{c.T=f,n.p=g,n.d.f()}},Le.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(d,f))},Le.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},Le.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var g=f.as,_=h(g,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,b=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?n.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:b}):g==="script"&&n.d.X(d,{crossOrigin:_,integrity:y,fetchPriority:b,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Le.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=h(f.as,f.crossOrigin);n.d.M(d,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(d)},Le.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,_=h(g,f.crossOrigin);n.d.L(d,g,{crossOrigin:_,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Le.preloadModule=function(d,f){if(typeof d=="string")if(f){var g=h(f.as,f.crossOrigin);n.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(d)},Le.requestFormReset=function(d){n.d.r(d)},Le.unstable_batchedUpdates=function(d,f){return d(f)},Le.useFormState=function(d,f,g){return c.H.useFormState(d,f,g)},Le.useFormStatus=function(){return c.H.useHostTransitionStatus()},Le.version="19.1.1",Le}var Cy;function IE(){if(Cy)return vd.exports;Cy=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),vd.exports=LE(),vd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ty;function PE(){if(Ty)return Xr;Ty=1;var r=kE(),t=wf(),e=IE();function n(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var s=i,l=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(l=s.return),i=s.return;while(i)}return s.tag===3?l:null}function c(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function h(i){if(o(i)!==i)throw Error(n(188))}function d(i){var s=i.alternate;if(!s){if(s=o(i),s===null)throw Error(n(188));return s!==i?null:i}for(var l=i,u=s;;){var p=l.return;if(p===null)break;var m=p.alternate;if(m===null){if(u=p.return,u!==null){l=u;continue}break}if(p.child===m.child){for(m=p.child;m;){if(m===l)return h(p),i;if(m===u)return h(p),s;m=m.sibling}throw Error(n(188))}if(l.return!==u.return)l=p,u=m;else{for(var v=!1,E=p.child;E;){if(E===l){v=!0,l=p,u=m;break}if(E===u){v=!0,u=p,l=m;break}E=E.sibling}if(!v){for(E=m.child;E;){if(E===l){v=!0,l=m,u=p;break}if(E===u){v=!0,u=m,l=p;break}E=E.sibling}if(!v)throw Error(n(189))}}if(l.alternate!==u)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?i:s}function f(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=f(i),s!==null)return s;i=i.sibling}return null}var g=Object.assign,_=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),M=Symbol.for("react.consumer"),T=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),tt=Symbol.for("react.memo_cache_sentinel"),Q=Symbol.iterator;function lt(i){return i===null||typeof i!="object"?null:(i=Q&&i[Q]||i["@@iterator"],typeof i=="function"?i:null)}var mt=Symbol.for("react.client.reference");function Tt(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===mt?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case A:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case R:return"Suspense";case k:return"SuspenseList";case $:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case b:return"Portal";case T:return(i.displayName||"Context")+".Provider";case M:return(i._context.displayName||"Context")+".Consumer";case N:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case z:return s=i.displayName||null,s!==null?s:Tt(i.type)||"Memo";case j:s=i._payload,i=i._init;try{return Tt(i(s))}catch{}}return null}var _t=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},pt=[],D=-1;function q(i){return{current:i}}function W(i){0>D||(i.current=pt[D],pt[D]=null,D--)}function X(i,s){D++,pt[D]=i.current,i.current=s}var it=q(null),yt=q(null),at=q(null),Mt=q(null);function Pt(i,s){switch(X(at,s),X(yt,i),X(it,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?V_(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=V_(s),i=q_(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}W(it),X(it,i)}function kn(){W(it),W(yt),W(at)}function Xa(i){i.memoizedState!==null&&X(Mt,i);var s=it.current,l=q_(s,i.type);s!==l&&(X(yt,i),X(it,l))}function _i(i){yt.current===i&&(W(it),W(yt)),Mt.current===i&&(W(Mt),Ur._currentValue=Z)}var Zi=Object.prototype.hasOwnProperty,Is=r.unstable_scheduleCallback,$a=r.unstable_cancelCallback,oA=r.unstable_shouldYield,lA=r.unstable_requestPaint,Ln=r.unstable_now,cA=r.unstable_getCurrentPriorityLevel,wp=r.unstable_ImmediatePriority,Cp=r.unstable_UserBlockingPriority,Ho=r.unstable_NormalPriority,uA=r.unstable_LowPriority,Tp=r.unstable_IdlePriority,hA=r.log,dA=r.unstable_setDisableYieldValue,Wa=null,Je=null;function yi(i){if(typeof hA=="function"&&dA(i),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(Wa,i)}catch{}}var tn=Math.clz32?Math.clz32:gA,fA=Math.log,pA=Math.LN2;function gA(i){return i>>>=0,i===0?32:31-(fA(i)/pA|0)|0}var zo=256,Uo=4194304;function Ji(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Go(i,s,l){var u=i.pendingLanes;if(u===0)return 0;var p=0,m=i.suspendedLanes,v=i.pingedLanes;i=i.warmLanes;var E=u&134217727;return E!==0?(u=E&~m,u!==0?p=Ji(u):(v&=E,v!==0?p=Ji(v):l||(l=E&~i,l!==0&&(p=Ji(l))))):(E=u&~m,E!==0?p=Ji(E):v!==0?p=Ji(v):l||(l=u&~i,l!==0&&(p=Ji(l)))),p===0?0:s!==0&&s!==p&&(s&m)===0&&(m=p&-p,l=s&-s,m>=l||m===32&&(l&4194048)!==0)?s:p}function Ka(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function mA(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xp(){var i=zo;return zo<<=1,(zo&4194048)===0&&(zo=256),i}function Rp(){var i=Uo;return Uo<<=1,(Uo&62914560)===0&&(Uo=4194304),i}function iu(i){for(var s=[],l=0;31>l;l++)s.push(i);return s}function Qa(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function _A(i,s,l,u,p,m){var v=i.pendingLanes;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=l,i.entangledLanes&=l,i.errorRecoveryDisabledLanes&=l,i.shellSuspendCounter=0;var E=i.entanglements,x=i.expirationTimes,B=i.hiddenUpdates;for(l=v&~l;0<l;){var G=31-tn(l),Y=1<<G;E[G]=0,x[G]=-1;var F=B[G];if(F!==null)for(B[G]=null,G=0;G<F.length;G++){var H=F[G];H!==null&&(H.lane&=-536870913)}l&=~Y}u!==0&&Dp(i,u,0),m!==0&&p===0&&i.tag!==0&&(i.suspendedLanes|=m&~(v&~s))}function Dp(i,s,l){i.pendingLanes|=s,i.suspendedLanes&=~s;var u=31-tn(s);i.entangledLanes|=s,i.entanglements[u]=i.entanglements[u]|1073741824|l&4194090}function Mp(i,s){var l=i.entangledLanes|=s;for(i=i.entanglements;l;){var u=31-tn(l),p=1<<u;p&s|i[u]&s&&(i[u]|=s),l&=~p}}function su(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function au(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Np(){var i=U.p;return i!==0?i:(i=window.event,i===void 0?32:uy(i.type))}function yA(i,s){var l=U.p;try{return U.p=i,s()}finally{U.p=l}}var bi=Math.random().toString(36).slice(2),Oe="__reactFiber$"+bi,Ue="__reactProps$"+bi,Ps="__reactContainer$"+bi,ru="__reactEvents$"+bi,bA="__reactListeners$"+bi,vA="__reactHandles$"+bi,Op="__reactResources$"+bi,Za="__reactMarker$"+bi;function ou(i){delete i[Oe],delete i[Ue],delete i[ru],delete i[bA],delete i[vA]}function Bs(i){var s=i[Oe];if(s)return s;for(var l=i.parentNode;l;){if(s=l[Ps]||l[Oe]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(i=W_(i);i!==null;){if(l=i[Oe])return l;i=W_(i)}return s}i=l,l=i.parentNode}return null}function Fs(i){if(i=i[Oe]||i[Ps]){var s=i.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return i}return null}function Ja(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(n(33))}function Hs(i){var s=i[Op];return s||(s=i[Op]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function me(i){i[Za]=!0}var kp=new Set,Lp={};function ts(i,s){zs(i,s),zs(i+"Capture",s)}function zs(i,s){for(Lp[i]=s,i=0;i<s.length;i++)kp.add(s[i])}var AA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ip={},Pp={};function SA(i){return Zi.call(Pp,i)?!0:Zi.call(Ip,i)?!1:AA.test(i)?Pp[i]=!0:(Ip[i]=!0,!1)}function jo(i,s,l){if(SA(s))if(l===null)i.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var u=s.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+l)}}function Vo(i,s,l){if(l===null)i.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+l)}}function Xn(i,s,l,u){if(u===null)i.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(l);return}i.setAttributeNS(s,l,""+u)}}var lu,Bp;function Us(i){if(lu===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);lu=s&&s[1]||"",Bp=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+lu+i+Bp}var cu=!1;function uu(i,s){if(!i||cu)return"";cu=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(s){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(H){var F=H}Reflect.construct(i,[],Y)}else{try{Y.call()}catch(H){F=H}i.call(Y.prototype)}}else{try{throw Error()}catch(H){F=H}(Y=i())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(H){if(H&&F&&typeof H.stack=="string")return[H.stack,F.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=u.DetermineComponentFrameRoot(),v=m[0],E=m[1];if(v&&E){var x=v.split(`
`),B=E.split(`
`);for(p=u=0;u<x.length&&!x[u].includes("DetermineComponentFrameRoot");)u++;for(;p<B.length&&!B[p].includes("DetermineComponentFrameRoot");)p++;if(u===x.length||p===B.length)for(u=x.length-1,p=B.length-1;1<=u&&0<=p&&x[u]!==B[p];)p--;for(;1<=u&&0<=p;u--,p--)if(x[u]!==B[p]){if(u!==1||p!==1)do if(u--,p--,0>p||x[u]!==B[p]){var G=`
`+x[u].replace(" at new "," at ");return i.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",i.displayName)),G}while(1<=u&&0<=p);break}}}finally{cu=!1,Error.prepareStackTrace=l}return(l=i?i.displayName||i.name:"")?Us(l):""}function EA(i){switch(i.tag){case 26:case 27:case 5:return Us(i.type);case 16:return Us("Lazy");case 13:return Us("Suspense");case 19:return Us("SuspenseList");case 0:case 15:return uu(i.type,!1);case 11:return uu(i.type.render,!1);case 1:return uu(i.type,!0);case 31:return Us("Activity");default:return""}}function Fp(i){try{var s="";do s+=EA(i),i=i.return;while(i);return s}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function hn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Hp(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function wA(i){var s=Hp(i)?"checked":"value",l=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),u=""+i[s];if(!i.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var p=l.get,m=l.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return p.call(this)},set:function(v){u=""+v,m.call(this,v)}}),Object.defineProperty(i,s,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(v){u=""+v},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function qo(i){i._valueTracker||(i._valueTracker=wA(i))}function zp(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var l=s.getValue(),u="";return i&&(u=Hp(i)?i.checked?"true":"false":i.value),i=u,i!==l?(s.setValue(i),!0):!1}function Yo(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var CA=/[\n"\\]/g;function dn(i){return i.replace(CA,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function hu(i,s,l,u,p,m,v,E){i.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?i.type=v:i.removeAttribute("type"),s!=null?v==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+hn(s)):i.value!==""+hn(s)&&(i.value=""+hn(s)):v!=="submit"&&v!=="reset"||i.removeAttribute("value"),s!=null?du(i,v,hn(s)):l!=null?du(i,v,hn(l)):u!=null&&i.removeAttribute("value"),p==null&&m!=null&&(i.defaultChecked=!!m),p!=null&&(i.checked=p&&typeof p!="function"&&typeof p!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?i.name=""+hn(E):i.removeAttribute("name")}function Up(i,s,l,u,p,m,v,E){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(i.type=m),s!=null||l!=null){if(!(m!=="submit"&&m!=="reset"||s!=null))return;l=l!=null?""+hn(l):"",s=s!=null?""+hn(s):l,E||s===i.value||(i.value=s),i.defaultValue=s}u=u??p,u=typeof u!="function"&&typeof u!="symbol"&&!!u,i.checked=E?i.checked:!!u,i.defaultChecked=!!u,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(i.name=v)}function du(i,s,l){s==="number"&&Yo(i.ownerDocument)===i||i.defaultValue===""+l||(i.defaultValue=""+l)}function Gs(i,s,l,u){if(i=i.options,s){s={};for(var p=0;p<l.length;p++)s["$"+l[p]]=!0;for(l=0;l<i.length;l++)p=s.hasOwnProperty("$"+i[l].value),i[l].selected!==p&&(i[l].selected=p),p&&u&&(i[l].defaultSelected=!0)}else{for(l=""+hn(l),s=null,p=0;p<i.length;p++){if(i[p].value===l){i[p].selected=!0,u&&(i[p].defaultSelected=!0);return}s!==null||i[p].disabled||(s=i[p])}s!==null&&(s.selected=!0)}}function Gp(i,s,l){if(s!=null&&(s=""+hn(s),s!==i.value&&(i.value=s),l==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=l!=null?""+hn(l):""}function jp(i,s,l,u){if(s==null){if(u!=null){if(l!=null)throw Error(n(92));if(_t(u)){if(1<u.length)throw Error(n(93));u=u[0]}l=u}l==null&&(l=""),s=l}l=hn(s),i.defaultValue=l,u=i.textContent,u===l&&u!==""&&u!==null&&(i.value=u)}function js(i,s){if(s){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=s;return}}i.textContent=s}var TA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Vp(i,s,l){var u=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":u?i.setProperty(s,l):typeof l!="number"||l===0||TA.has(s)?s==="float"?i.cssFloat=l:i[s]=(""+l).trim():i[s]=l+"px"}function qp(i,s,l){if(s!=null&&typeof s!="object")throw Error(n(62));if(i=i.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||s!=null&&s.hasOwnProperty(u)||(u.indexOf("--")===0?i.setProperty(u,""):u==="float"?i.cssFloat="":i[u]="");for(var p in s)u=s[p],s.hasOwnProperty(p)&&l[p]!==u&&Vp(i,p,u)}else for(var m in s)s.hasOwnProperty(m)&&Vp(i,m,s[m])}function fu(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),RA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xo(i){return RA.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var pu=null;function gu(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Vs=null,qs=null;function Yp(i){var s=Fs(i);if(s&&(i=s.stateNode)){var l=i[Ue]||null;t:switch(i=s.stateNode,s.type){case"input":if(hu(i,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+dn(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var u=l[s];if(u!==i&&u.form===i.form){var p=u[Ue]||null;if(!p)throw Error(n(90));hu(u,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(s=0;s<l.length;s++)u=l[s],u.form===i.form&&zp(u)}break t;case"textarea":Gp(i,l.value,l.defaultValue);break t;case"select":s=l.value,s!=null&&Gs(i,!!l.multiple,s,!1)}}}var mu=!1;function Xp(i,s,l){if(mu)return i(s,l);mu=!0;try{var u=i(s);return u}finally{if(mu=!1,(Vs!==null||qs!==null)&&(Ol(),Vs&&(s=Vs,i=qs,qs=Vs=null,Yp(s),i)))for(s=0;s<i.length;s++)Yp(i[s])}}function tr(i,s){var l=i.stateNode;if(l===null)return null;var u=l[Ue]||null;if(u===null)return null;l=u[s];t:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(i=i.type,u=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!u;break t;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(n(231,s,typeof l));return l}var $n=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_u=!1;if($n)try{var er={};Object.defineProperty(er,"passive",{get:function(){_u=!0}}),window.addEventListener("test",er,er),window.removeEventListener("test",er,er)}catch{_u=!1}var vi=null,yu=null,$o=null;function $p(){if($o)return $o;var i,s=yu,l=s.length,u,p="value"in vi?vi.value:vi.textContent,m=p.length;for(i=0;i<l&&s[i]===p[i];i++);var v=l-i;for(u=1;u<=v&&s[l-u]===p[m-u];u++);return $o=p.slice(i,1<u?1-u:void 0)}function Wo(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function Ko(){return!0}function Wp(){return!1}function Ge(i){function s(l,u,p,m,v){this._reactName=l,this._targetInst=p,this.type=u,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var E in i)i.hasOwnProperty(E)&&(l=i[E],this[E]=l?l(m):m[E]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Ko:Wp,this.isPropagationStopped=Wp,this}return g(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ko)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ko)},persist:function(){},isPersistent:Ko}),s}var es={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qo=Ge(es),nr=g({},es,{view:0,detail:0}),DA=Ge(nr),bu,vu,ir,Zo=g({},nr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Su,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ir&&(ir&&i.type==="mousemove"?(bu=i.screenX-ir.screenX,vu=i.screenY-ir.screenY):vu=bu=0,ir=i),bu)},movementY:function(i){return"movementY"in i?i.movementY:vu}}),Kp=Ge(Zo),MA=g({},Zo,{dataTransfer:0}),NA=Ge(MA),OA=g({},nr,{relatedTarget:0}),Au=Ge(OA),kA=g({},es,{animationName:0,elapsedTime:0,pseudoElement:0}),LA=Ge(kA),IA=g({},es,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),PA=Ge(IA),BA=g({},es,{data:0}),Qp=Ge(BA),FA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},HA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function UA(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=zA[i])?!!s[i]:!1}function Su(){return UA}var GA=g({},nr,{key:function(i){if(i.key){var s=FA[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Wo(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?HA[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Su,charCode:function(i){return i.type==="keypress"?Wo(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Wo(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),jA=Ge(GA),VA=g({},Zo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zp=Ge(VA),qA=g({},nr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Su}),YA=Ge(qA),XA=g({},es,{propertyName:0,elapsedTime:0,pseudoElement:0}),$A=Ge(XA),WA=g({},Zo,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),KA=Ge(WA),QA=g({},es,{newState:0,oldState:0}),ZA=Ge(QA),JA=[9,13,27,32],Eu=$n&&"CompositionEvent"in window,sr=null;$n&&"documentMode"in document&&(sr=document.documentMode);var tS=$n&&"TextEvent"in window&&!sr,Jp=$n&&(!Eu||sr&&8<sr&&11>=sr),tg=" ",eg=!1;function ng(i,s){switch(i){case"keyup":return JA.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ig(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Ys=!1;function eS(i,s){switch(i){case"compositionend":return ig(s);case"keypress":return s.which!==32?null:(eg=!0,tg);case"textInput":return i=s.data,i===tg&&eg?null:i;default:return null}}function nS(i,s){if(Ys)return i==="compositionend"||!Eu&&ng(i,s)?(i=$p(),$o=yu=vi=null,Ys=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Jp&&s.locale!=="ko"?null:s.data;default:return null}}var iS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sg(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!iS[i.type]:s==="textarea"}function ag(i,s,l,u){Vs?qs?qs.push(u):qs=[u]:Vs=u,s=Fl(s,"onChange"),0<s.length&&(l=new Qo("onChange","change",null,l,u),i.push({event:l,listeners:s}))}var ar=null,rr=null;function sS(i){H_(i,0)}function Jo(i){var s=Ja(i);if(zp(s))return i}function rg(i,s){if(i==="change")return s}var og=!1;if($n){var wu;if($n){var Cu="oninput"in document;if(!Cu){var lg=document.createElement("div");lg.setAttribute("oninput","return;"),Cu=typeof lg.oninput=="function"}wu=Cu}else wu=!1;og=wu&&(!document.documentMode||9<document.documentMode)}function cg(){ar&&(ar.detachEvent("onpropertychange",ug),rr=ar=null)}function ug(i){if(i.propertyName==="value"&&Jo(rr)){var s=[];ag(s,rr,i,gu(i)),Xp(sS,s)}}function aS(i,s,l){i==="focusin"?(cg(),ar=s,rr=l,ar.attachEvent("onpropertychange",ug)):i==="focusout"&&cg()}function rS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Jo(rr)}function oS(i,s){if(i==="click")return Jo(s)}function lS(i,s){if(i==="input"||i==="change")return Jo(s)}function cS(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var en=typeof Object.is=="function"?Object.is:cS;function or(i,s){if(en(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var l=Object.keys(i),u=Object.keys(s);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var p=l[u];if(!Zi.call(s,p)||!en(i[p],s[p]))return!1}return!0}function hg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function dg(i,s){var l=hg(i);i=0;for(var u;l;){if(l.nodeType===3){if(u=i+l.textContent.length,i<=s&&u>=s)return{node:l,offset:s-i};i=u}t:{for(;l;){if(l.nextSibling){l=l.nextSibling;break t}l=l.parentNode}l=void 0}l=hg(l)}}function fg(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?fg(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function pg(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=Yo(i.document);s instanceof i.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)i=s.contentWindow;else break;s=Yo(i.document)}return s}function Tu(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var uS=$n&&"documentMode"in document&&11>=document.documentMode,Xs=null,xu=null,lr=null,Ru=!1;function gg(i,s,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Ru||Xs==null||Xs!==Yo(u)||(u=Xs,"selectionStart"in u&&Tu(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),lr&&or(lr,u)||(lr=u,u=Fl(xu,"onSelect"),0<u.length&&(s=new Qo("onSelect","select",null,s,l),i.push({event:s,listeners:u}),s.target=Xs)))}function ns(i,s){var l={};return l[i.toLowerCase()]=s.toLowerCase(),l["Webkit"+i]="webkit"+s,l["Moz"+i]="moz"+s,l}var $s={animationend:ns("Animation","AnimationEnd"),animationiteration:ns("Animation","AnimationIteration"),animationstart:ns("Animation","AnimationStart"),transitionrun:ns("Transition","TransitionRun"),transitionstart:ns("Transition","TransitionStart"),transitioncancel:ns("Transition","TransitionCancel"),transitionend:ns("Transition","TransitionEnd")},Du={},mg={};$n&&(mg=document.createElement("div").style,"AnimationEvent"in window||(delete $s.animationend.animation,delete $s.animationiteration.animation,delete $s.animationstart.animation),"TransitionEvent"in window||delete $s.transitionend.transition);function is(i){if(Du[i])return Du[i];if(!$s[i])return i;var s=$s[i],l;for(l in s)if(s.hasOwnProperty(l)&&l in mg)return Du[i]=s[l];return i}var _g=is("animationend"),yg=is("animationiteration"),bg=is("animationstart"),hS=is("transitionrun"),dS=is("transitionstart"),fS=is("transitioncancel"),vg=is("transitionend"),Ag=new Map,Mu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Mu.push("scrollEnd");function Cn(i,s){Ag.set(i,s),ts(s,[i])}var Sg=new WeakMap;function fn(i,s){if(typeof i=="object"&&i!==null){var l=Sg.get(i);return l!==void 0?l:(s={value:i,source:s,stack:Fp(s)},Sg.set(i,s),s)}return{value:i,source:s,stack:Fp(s)}}var pn=[],Ws=0,Nu=0;function tl(){for(var i=Ws,s=Nu=Ws=0;s<i;){var l=pn[s];pn[s++]=null;var u=pn[s];pn[s++]=null;var p=pn[s];pn[s++]=null;var m=pn[s];if(pn[s++]=null,u!==null&&p!==null){var v=u.pending;v===null?p.next=p:(p.next=v.next,v.next=p),u.pending=p}m!==0&&Eg(l,p,m)}}function el(i,s,l,u){pn[Ws++]=i,pn[Ws++]=s,pn[Ws++]=l,pn[Ws++]=u,Nu|=u,i.lanes|=u,i=i.alternate,i!==null&&(i.lanes|=u)}function Ou(i,s,l,u){return el(i,s,l,u),nl(i)}function Ks(i,s){return el(i,null,null,s),nl(i)}function Eg(i,s,l){i.lanes|=l;var u=i.alternate;u!==null&&(u.lanes|=l);for(var p=!1,m=i.return;m!==null;)m.childLanes|=l,u=m.alternate,u!==null&&(u.childLanes|=l),m.tag===22&&(i=m.stateNode,i===null||i._visibility&1||(p=!0)),i=m,m=m.return;return i.tag===3?(m=i.stateNode,p&&s!==null&&(p=31-tn(l),i=m.hiddenUpdates,u=i[p],u===null?i[p]=[s]:u.push(s),s.lane=l|536870912),m):null}function nl(i){if(50<kr)throw kr=0,Fh=null,Error(n(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Qs={};function pS(i,s,l,u){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nn(i,s,l,u){return new pS(i,s,l,u)}function ku(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Wn(i,s){var l=i.alternate;return l===null?(l=nn(i.tag,s,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=s,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&65011712,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,s=i.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l.refCleanup=i.refCleanup,l}function wg(i,s){i.flags&=65011714;var l=i.alternate;return l===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,s=l.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function il(i,s,l,u,p,m){var v=0;if(u=i,typeof i=="function")ku(i)&&(v=1);else if(typeof i=="string")v=mE(i,l,it.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case $:return i=nn(31,l,s,p),i.elementType=$,i.lanes=m,i;case A:return ss(l.children,p,m,s);case S:v=8,p|=24;break;case C:return i=nn(12,l,s,p|2),i.elementType=C,i.lanes=m,i;case R:return i=nn(13,l,s,p),i.elementType=R,i.lanes=m,i;case k:return i=nn(19,l,s,p),i.elementType=k,i.lanes=m,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case w:case T:v=10;break t;case M:v=9;break t;case N:v=11;break t;case z:v=14;break t;case j:v=16,u=null;break t}v=29,l=Error(n(130,i===null?"null":typeof i,"")),u=null}return s=nn(v,l,s,p),s.elementType=i,s.type=u,s.lanes=m,s}function ss(i,s,l,u){return i=nn(7,i,u,s),i.lanes=l,i}function Lu(i,s,l){return i=nn(6,i,null,s),i.lanes=l,i}function Iu(i,s,l){return s=nn(4,i.children!==null?i.children:[],i.key,s),s.lanes=l,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var Zs=[],Js=0,sl=null,al=0,gn=[],mn=0,as=null,Kn=1,Qn="";function rs(i,s){Zs[Js++]=al,Zs[Js++]=sl,sl=i,al=s}function Cg(i,s,l){gn[mn++]=Kn,gn[mn++]=Qn,gn[mn++]=as,as=i;var u=Kn;i=Qn;var p=32-tn(u)-1;u&=~(1<<p),l+=1;var m=32-tn(s)+p;if(30<m){var v=p-p%5;m=(u&(1<<v)-1).toString(32),u>>=v,p-=v,Kn=1<<32-tn(s)+p|l<<p|u,Qn=m+i}else Kn=1<<m|l<<p|u,Qn=i}function Pu(i){i.return!==null&&(rs(i,1),Cg(i,1,0))}function Bu(i){for(;i===sl;)sl=Zs[--Js],Zs[Js]=null,al=Zs[--Js],Zs[Js]=null;for(;i===as;)as=gn[--mn],gn[mn]=null,Qn=gn[--mn],gn[mn]=null,Kn=gn[--mn],gn[mn]=null}var Pe=null,te=null,Lt=!1,os=null,In=!1,Fu=Error(n(519));function ls(i){var s=Error(n(418,""));throw hr(fn(s,i)),Fu}function Tg(i){var s=i.stateNode,l=i.type,u=i.memoizedProps;switch(s[Oe]=i,s[Ue]=u,l){case"dialog":Rt("cancel",s),Rt("close",s);break;case"iframe":case"object":case"embed":Rt("load",s);break;case"video":case"audio":for(l=0;l<Ir.length;l++)Rt(Ir[l],s);break;case"source":Rt("error",s);break;case"img":case"image":case"link":Rt("error",s),Rt("load",s);break;case"details":Rt("toggle",s);break;case"input":Rt("invalid",s),Up(s,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0),qo(s);break;case"select":Rt("invalid",s);break;case"textarea":Rt("invalid",s),jp(s,u.value,u.defaultValue,u.children),qo(s)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||u.suppressHydrationWarning===!0||j_(s.textContent,l)?(u.popover!=null&&(Rt("beforetoggle",s),Rt("toggle",s)),u.onScroll!=null&&Rt("scroll",s),u.onScrollEnd!=null&&Rt("scrollend",s),u.onClick!=null&&(s.onclick=Hl),s=!0):s=!1,s||ls(i)}function xg(i){for(Pe=i.return;Pe;)switch(Pe.tag){case 5:case 13:In=!1;return;case 27:case 3:In=!0;return;default:Pe=Pe.return}}function cr(i){if(i!==Pe)return!1;if(!Lt)return xg(i),Lt=!0,!1;var s=i.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=i.type,l=!(l!=="form"&&l!=="button")||td(i.type,i.memoizedProps)),l=!l),l&&te&&ls(i),xg(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));t:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8)if(l=i.data,l==="/$"){if(s===0){te=xn(i.nextSibling);break t}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++;i=i.nextSibling}te=null}}else s===27?(s=te,Pi(i.type)?(i=sd,sd=null,te=i):te=s):te=Pe?xn(i.stateNode.nextSibling):null;return!0}function ur(){te=Pe=null,Lt=!1}function Rg(){var i=os;return i!==null&&(qe===null?qe=i:qe.push.apply(qe,i),os=null),i}function hr(i){os===null?os=[i]:os.push(i)}var Hu=q(null),cs=null,Zn=null;function Ai(i,s,l){X(Hu,s._currentValue),s._currentValue=l}function Jn(i){i._currentValue=Hu.current,W(Hu)}function zu(i,s,l){for(;i!==null;){var u=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),i===l)break;i=i.return}}function Uu(i,s,l,u){var p=i.child;for(p!==null&&(p.return=i);p!==null;){var m=p.dependencies;if(m!==null){var v=p.child;m=m.firstContext;t:for(;m!==null;){var E=m;m=p;for(var x=0;x<s.length;x++)if(E.context===s[x]){m.lanes|=l,E=m.alternate,E!==null&&(E.lanes|=l),zu(m.return,l,i),u||(v=null);break t}m=E.next}}else if(p.tag===18){if(v=p.return,v===null)throw Error(n(341));v.lanes|=l,m=v.alternate,m!==null&&(m.lanes|=l),zu(v,l,i),v=null}else v=p.child;if(v!==null)v.return=p;else for(v=p;v!==null;){if(v===i){v=null;break}if(p=v.sibling,p!==null){p.return=v.return,v=p;break}v=v.return}p=v}}function dr(i,s,l,u){i=null;for(var p=s,m=!1;p!==null;){if(!m){if((p.flags&524288)!==0)m=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var v=p.alternate;if(v===null)throw Error(n(387));if(v=v.memoizedProps,v!==null){var E=p.type;en(p.pendingProps.value,v.value)||(i!==null?i.push(E):i=[E])}}else if(p===Mt.current){if(v=p.alternate,v===null)throw Error(n(387));v.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(i!==null?i.push(Ur):i=[Ur])}p=p.return}i!==null&&Uu(s,i,l,u),s.flags|=262144}function rl(i){for(i=i.firstContext;i!==null;){if(!en(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function us(i){cs=i,Zn=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function ke(i){return Dg(cs,i)}function ol(i,s){return cs===null&&us(i),Dg(i,s)}function Dg(i,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},Zn===null){if(i===null)throw Error(n(308));Zn=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Zn=Zn.next=s;return l}var gS=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(l,u){i.push(u)}};this.abort=function(){s.aborted=!0,i.forEach(function(l){return l()})}},mS=r.unstable_scheduleCallback,_S=r.unstable_NormalPriority,fe={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gu(){return{controller:new gS,data:new Map,refCount:0}}function fr(i){i.refCount--,i.refCount===0&&mS(_S,function(){i.controller.abort()})}var pr=null,ju=0,ta=0,ea=null;function yS(i,s){if(pr===null){var l=pr=[];ju=0,ta=qh(),ea={status:"pending",value:void 0,then:function(u){l.push(u)}}}return ju++,s.then(Mg,Mg),s}function Mg(){if(--ju===0&&pr!==null){ea!==null&&(ea.status="fulfilled");var i=pr;pr=null,ta=0,ea=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function bS(i,s){var l=[],u={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return i.then(function(){u.status="fulfilled",u.value=s;for(var p=0;p<l.length;p++)(0,l[p])(s)},function(p){for(u.status="rejected",u.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),u}var Ng=I.S;I.S=function(i,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&yS(i,s),Ng!==null&&Ng(i,s)};var hs=q(null);function Vu(){var i=hs.current;return i!==null?i:qt.pooledCache}function ll(i,s){s===null?X(hs,hs.current):X(hs,s.pool)}function Og(){var i=Vu();return i===null?null:{parent:fe._currentValue,pool:i}}var gr=Error(n(460)),kg=Error(n(474)),cl=Error(n(542)),qu={then:function(){}};function Lg(i){return i=i.status,i==="fulfilled"||i==="rejected"}function ul(){}function Ig(i,s,l){switch(l=i[l],l===void 0?i.push(s):l!==s&&(s.then(ul,ul),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Bg(i),i;default:if(typeof s.status=="string")s.then(ul,ul);else{if(i=qt,i!==null&&100<i.shellSuspendCounter)throw Error(n(482));i=s,i.status="pending",i.then(function(u){if(s.status==="pending"){var p=s;p.status="fulfilled",p.value=u}},function(u){if(s.status==="pending"){var p=s;p.status="rejected",p.reason=u}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Bg(i),i}throw mr=s,gr}}var mr=null;function Pg(){if(mr===null)throw Error(n(459));var i=mr;return mr=null,i}function Bg(i){if(i===gr||i===cl)throw Error(n(483))}var Si=!1;function Yu(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Xu(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ei(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function wi(i,s,l){var u=i.updateQueue;if(u===null)return null;if(u=u.shared,(Bt&2)!==0){var p=u.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),u.pending=s,s=nl(i),Eg(i,null,l),s}return el(i,u,s,l),nl(i)}function _r(i,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var u=s.lanes;u&=i.pendingLanes,l|=u,s.lanes=l,Mp(i,l)}}function $u(i,s){var l=i.updateQueue,u=i.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var p=null,m=null;if(l=l.firstBaseUpdate,l!==null){do{var v={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};m===null?p=m=v:m=m.next=v,l=l.next}while(l!==null);m===null?p=m=s:m=m.next=s}else p=m=s;l={baseState:u.baseState,firstBaseUpdate:p,lastBaseUpdate:m,shared:u.shared,callbacks:u.callbacks},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=s:i.next=s,l.lastBaseUpdate=s}var Wu=!1;function yr(){if(Wu){var i=ea;if(i!==null)throw i}}function br(i,s,l,u){Wu=!1;var p=i.updateQueue;Si=!1;var m=p.firstBaseUpdate,v=p.lastBaseUpdate,E=p.shared.pending;if(E!==null){p.shared.pending=null;var x=E,B=x.next;x.next=null,v===null?m=B:v.next=B,v=x;var G=i.alternate;G!==null&&(G=G.updateQueue,E=G.lastBaseUpdate,E!==v&&(E===null?G.firstBaseUpdate=B:E.next=B,G.lastBaseUpdate=x))}if(m!==null){var Y=p.baseState;v=0,G=B=x=null,E=m;do{var F=E.lane&-536870913,H=F!==E.lane;if(H?(Ot&F)===F:(u&F)===F){F!==0&&F===ta&&(Wu=!0),G!==null&&(G=G.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});t:{var ht=i,ot=E;F=s;var Ut=l;switch(ot.tag){case 1:if(ht=ot.payload,typeof ht=="function"){Y=ht.call(Ut,Y,F);break t}Y=ht;break t;case 3:ht.flags=ht.flags&-65537|128;case 0:if(ht=ot.payload,F=typeof ht=="function"?ht.call(Ut,Y,F):ht,F==null)break t;Y=g({},Y,F);break t;case 2:Si=!0}}F=E.callback,F!==null&&(i.flags|=64,H&&(i.flags|=8192),H=p.callbacks,H===null?p.callbacks=[F]:H.push(F))}else H={lane:F,tag:E.tag,payload:E.payload,callback:E.callback,next:null},G===null?(B=G=H,x=Y):G=G.next=H,v|=F;if(E=E.next,E===null){if(E=p.shared.pending,E===null)break;H=E,E=H.next,H.next=null,p.lastBaseUpdate=H,p.shared.pending=null}}while(!0);G===null&&(x=Y),p.baseState=x,p.firstBaseUpdate=B,p.lastBaseUpdate=G,m===null&&(p.shared.lanes=0),Oi|=v,i.lanes=v,i.memoizedState=Y}}function Fg(i,s){if(typeof i!="function")throw Error(n(191,i));i.call(s)}function Hg(i,s){var l=i.callbacks;if(l!==null)for(i.callbacks=null,i=0;i<l.length;i++)Fg(l[i],s)}var na=q(null),hl=q(0);function zg(i,s){i=ri,X(hl,i),X(na,s),ri=i|s.baseLanes}function Ku(){X(hl,ri),X(na,na.current)}function Qu(){ri=hl.current,W(na),W(hl)}var Ci=0,vt=null,Ht=null,oe=null,dl=!1,ia=!1,ds=!1,fl=0,vr=0,sa=null,vS=0;function ie(){throw Error(n(321))}function Zu(i,s){if(s===null)return!1;for(var l=0;l<s.length&&l<i.length;l++)if(!en(i[l],s[l]))return!1;return!0}function Ju(i,s,l,u,p,m){return Ci=m,vt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,I.H=i===null||i.memoizedState===null?Em:wm,ds=!1,m=l(u,p),ds=!1,ia&&(m=Gg(s,l,u,p)),Ug(i),m}function Ug(i){I.H=bl;var s=Ht!==null&&Ht.next!==null;if(Ci=0,oe=Ht=vt=null,dl=!1,vr=0,sa=null,s)throw Error(n(300));i===null||_e||(i=i.dependencies,i!==null&&rl(i)&&(_e=!0))}function Gg(i,s,l,u){vt=i;var p=0;do{if(ia&&(sa=null),vr=0,ia=!1,25<=p)throw Error(n(301));if(p+=1,oe=Ht=null,i.updateQueue!=null){var m=i.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}I.H=xS,m=s(l,u)}while(ia);return m}function AS(){var i=I.H,s=i.useState()[0];return s=typeof s.then=="function"?Ar(s):s,i=i.useState()[0],(Ht!==null?Ht.memoizedState:null)!==i&&(vt.flags|=1024),s}function th(){var i=fl!==0;return fl=0,i}function eh(i,s,l){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~l}function nh(i){if(dl){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}dl=!1}Ci=0,oe=Ht=vt=null,ia=!1,vr=fl=0,sa=null}function je(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oe===null?vt.memoizedState=oe=i:oe=oe.next=i,oe}function le(){if(Ht===null){var i=vt.alternate;i=i!==null?i.memoizedState:null}else i=Ht.next;var s=oe===null?vt.memoizedState:oe.next;if(s!==null)oe=s,Ht=i;else{if(i===null)throw vt.alternate===null?Error(n(467)):Error(n(310));Ht=i,i={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},oe===null?vt.memoizedState=oe=i:oe=oe.next=i}return oe}function ih(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ar(i){var s=vr;return vr+=1,sa===null&&(sa=[]),i=Ig(sa,i,s),s=vt,(oe===null?s.memoizedState:oe.next)===null&&(s=s.alternate,I.H=s===null||s.memoizedState===null?Em:wm),i}function pl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Ar(i);if(i.$$typeof===T)return ke(i)}throw Error(n(438,String(i)))}function sh(i){var s=null,l=vt.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var u=vt.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(s={data:u.data.map(function(p){return p.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=ih(),vt.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(i),u=0;u<i;u++)l[u]=tt;return s.index++,l}function ti(i,s){return typeof s=="function"?s(i):s}function gl(i){var s=le();return ah(s,Ht,i)}function ah(i,s,l){var u=i.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=l;var p=i.baseQueue,m=u.pending;if(m!==null){if(p!==null){var v=p.next;p.next=m.next,m.next=v}s.baseQueue=p=m,u.pending=null}if(m=i.baseState,p===null)i.memoizedState=m;else{s=p.next;var E=v=null,x=null,B=s,G=!1;do{var Y=B.lane&-536870913;if(Y!==B.lane?(Ot&Y)===Y:(Ci&Y)===Y){var F=B.revertLane;if(F===0)x!==null&&(x=x.next={lane:0,revertLane:0,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null}),Y===ta&&(G=!0);else if((Ci&F)===F){B=B.next,F===ta&&(G=!0);continue}else Y={lane:0,revertLane:B.revertLane,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null},x===null?(E=x=Y,v=m):x=x.next=Y,vt.lanes|=F,Oi|=F;Y=B.action,ds&&l(m,Y),m=B.hasEagerState?B.eagerState:l(m,Y)}else F={lane:Y,revertLane:B.revertLane,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null},x===null?(E=x=F,v=m):x=x.next=F,vt.lanes|=Y,Oi|=Y;B=B.next}while(B!==null&&B!==s);if(x===null?v=m:x.next=E,!en(m,i.memoizedState)&&(_e=!0,G&&(l=ea,l!==null)))throw l;i.memoizedState=m,i.baseState=v,i.baseQueue=x,u.lastRenderedState=m}return p===null&&(u.lanes=0),[i.memoizedState,u.dispatch]}function rh(i){var s=le(),l=s.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=i;var u=l.dispatch,p=l.pending,m=s.memoizedState;if(p!==null){l.pending=null;var v=p=p.next;do m=i(m,v.action),v=v.next;while(v!==p);en(m,s.memoizedState)||(_e=!0),s.memoizedState=m,s.baseQueue===null&&(s.baseState=m),l.lastRenderedState=m}return[m,u]}function jg(i,s,l){var u=vt,p=le(),m=Lt;if(m){if(l===void 0)throw Error(n(407));l=l()}else l=s();var v=!en((Ht||p).memoizedState,l);v&&(p.memoizedState=l,_e=!0),p=p.queue;var E=Yg.bind(null,u,p,i);if(Sr(2048,8,E,[i]),p.getSnapshot!==s||v||oe!==null&&oe.memoizedState.tag&1){if(u.flags|=2048,aa(9,ml(),qg.bind(null,u,p,l,s),null),qt===null)throw Error(n(349));m||(Ci&124)!==0||Vg(u,s,l)}return l}function Vg(i,s,l){i.flags|=16384,i={getSnapshot:s,value:l},s=vt.updateQueue,s===null?(s=ih(),vt.updateQueue=s,s.stores=[i]):(l=s.stores,l===null?s.stores=[i]:l.push(i))}function qg(i,s,l,u){s.value=l,s.getSnapshot=u,Xg(s)&&$g(i)}function Yg(i,s,l){return l(function(){Xg(s)&&$g(i)})}function Xg(i){var s=i.getSnapshot;i=i.value;try{var l=s();return!en(i,l)}catch{return!0}}function $g(i){var s=Ks(i,2);s!==null&&ln(s,i,2)}function oh(i){var s=je();if(typeof i=="function"){var l=i;if(i=l(),ds){yi(!0);try{l()}finally{yi(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:i},s}function Wg(i,s,l,u){return i.baseState=l,ah(i,Ht,typeof u=="function"?u:ti)}function SS(i,s,l,u,p){if(yl(i))throw Error(n(485));if(i=s.action,i!==null){var m={payload:p,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){m.listeners.push(v)}};I.T!==null?l(!0):m.isTransition=!1,u(m),l=s.pending,l===null?(m.next=s.pending=m,Kg(s,m)):(m.next=l.next,s.pending=l.next=m)}}function Kg(i,s){var l=s.action,u=s.payload,p=i.state;if(s.isTransition){var m=I.T,v={};I.T=v;try{var E=l(p,u),x=I.S;x!==null&&x(v,E),Qg(i,s,E)}catch(B){lh(i,s,B)}finally{I.T=m}}else try{m=l(p,u),Qg(i,s,m)}catch(B){lh(i,s,B)}}function Qg(i,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){Zg(i,s,u)},function(u){return lh(i,s,u)}):Zg(i,s,l)}function Zg(i,s,l){s.status="fulfilled",s.value=l,Jg(s),i.state=l,s=i.pending,s!==null&&(l=s.next,l===s?i.pending=null:(l=l.next,s.next=l,Kg(i,l)))}function lh(i,s,l){var u=i.pending;if(i.pending=null,u!==null){u=u.next;do s.status="rejected",s.reason=l,Jg(s),s=s.next;while(s!==u)}i.action=null}function Jg(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function tm(i,s){return s}function em(i,s){if(Lt){var l=qt.formState;if(l!==null){t:{var u=vt;if(Lt){if(te){e:{for(var p=te,m=In;p.nodeType!==8;){if(!m){p=null;break e}if(p=xn(p.nextSibling),p===null){p=null;break e}}m=p.data,p=m==="F!"||m==="F"?p:null}if(p){te=xn(p.nextSibling),u=p.data==="F!";break t}}ls(u)}u=!1}u&&(s=l[0])}}return l=je(),l.memoizedState=l.baseState=s,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tm,lastRenderedState:s},l.queue=u,l=vm.bind(null,vt,u),u.dispatch=l,u=oh(!1),m=fh.bind(null,vt,!1,u.queue),u=je(),p={state:s,dispatch:null,action:i,pending:null},u.queue=p,l=SS.bind(null,vt,p,m,l),p.dispatch=l,u.memoizedState=i,[s,l,!1]}function nm(i){var s=le();return im(s,Ht,i)}function im(i,s,l){if(s=ah(i,s,tm)[0],i=gl(ti)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var u=Ar(s)}catch(v){throw v===gr?cl:v}else u=s;s=le();var p=s.queue,m=p.dispatch;return l!==s.memoizedState&&(vt.flags|=2048,aa(9,ml(),ES.bind(null,p,l),null)),[u,m,i]}function ES(i,s){i.action=s}function sm(i){var s=le(),l=Ht;if(l!==null)return im(s,l,i);le(),s=s.memoizedState,l=le();var u=l.queue.dispatch;return l.memoizedState=i,[s,u,!1]}function aa(i,s,l,u){return i={tag:i,create:l,deps:u,inst:s,next:null},s=vt.updateQueue,s===null&&(s=ih(),vt.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=i.next=i:(u=l.next,l.next=i,i.next=u,s.lastEffect=i),i}function ml(){return{destroy:void 0,resource:void 0}}function am(){return le().memoizedState}function _l(i,s,l,u){var p=je();u=u===void 0?null:u,vt.flags|=i,p.memoizedState=aa(1|s,ml(),l,u)}function Sr(i,s,l,u){var p=le();u=u===void 0?null:u;var m=p.memoizedState.inst;Ht!==null&&u!==null&&Zu(u,Ht.memoizedState.deps)?p.memoizedState=aa(s,m,l,u):(vt.flags|=i,p.memoizedState=aa(1|s,m,l,u))}function rm(i,s){_l(8390656,8,i,s)}function om(i,s){Sr(2048,8,i,s)}function lm(i,s){return Sr(4,2,i,s)}function cm(i,s){return Sr(4,4,i,s)}function um(i,s){if(typeof s=="function"){i=i();var l=s(i);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function hm(i,s,l){l=l!=null?l.concat([i]):null,Sr(4,4,um.bind(null,s,i),l)}function ch(){}function dm(i,s){var l=le();s=s===void 0?null:s;var u=l.memoizedState;return s!==null&&Zu(s,u[1])?u[0]:(l.memoizedState=[i,s],i)}function fm(i,s){var l=le();s=s===void 0?null:s;var u=l.memoizedState;if(s!==null&&Zu(s,u[1]))return u[0];if(u=i(),ds){yi(!0);try{i()}finally{yi(!1)}}return l.memoizedState=[u,s],u}function uh(i,s,l){return l===void 0||(Ci&1073741824)!==0?i.memoizedState=s:(i.memoizedState=l,i=m_(),vt.lanes|=i,Oi|=i,l)}function pm(i,s,l,u){return en(l,s)?l:na.current!==null?(i=uh(i,l,u),en(i,s)||(_e=!0),i):(Ci&42)===0?(_e=!0,i.memoizedState=l):(i=m_(),vt.lanes|=i,Oi|=i,s)}function gm(i,s,l,u,p){var m=U.p;U.p=m!==0&&8>m?m:8;var v=I.T,E={};I.T=E,fh(i,!1,s,l);try{var x=p(),B=I.S;if(B!==null&&B(E,x),x!==null&&typeof x=="object"&&typeof x.then=="function"){var G=bS(x,u);Er(i,s,G,on(i))}else Er(i,s,u,on(i))}catch(Y){Er(i,s,{then:function(){},status:"rejected",reason:Y},on())}finally{U.p=m,I.T=v}}function wS(){}function hh(i,s,l,u){if(i.tag!==5)throw Error(n(476));var p=mm(i).queue;gm(i,p,s,Z,l===null?wS:function(){return _m(i),l(u)})}function mm(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:Z},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:l},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function _m(i){var s=mm(i).next.queue;Er(i,s,{},on())}function dh(){return ke(Ur)}function ym(){return le().memoizedState}function bm(){return le().memoizedState}function CS(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var l=on();i=Ei(l);var u=wi(s,i,l);u!==null&&(ln(u,s,l),_r(u,s,l)),s={cache:Gu()},i.payload=s;return}s=s.return}}function TS(i,s,l){var u=on();l={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},yl(i)?Am(s,l):(l=Ou(i,s,l,u),l!==null&&(ln(l,i,u),Sm(l,s,u)))}function vm(i,s,l){var u=on();Er(i,s,l,u)}function Er(i,s,l,u){var p={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(yl(i))Am(s,p);else{var m=i.alternate;if(i.lanes===0&&(m===null||m.lanes===0)&&(m=s.lastRenderedReducer,m!==null))try{var v=s.lastRenderedState,E=m(v,l);if(p.hasEagerState=!0,p.eagerState=E,en(E,v))return el(i,s,p,0),qt===null&&tl(),!1}catch{}finally{}if(l=Ou(i,s,p,u),l!==null)return ln(l,i,u),Sm(l,s,u),!0}return!1}function fh(i,s,l,u){if(u={lane:2,revertLane:qh(),action:u,hasEagerState:!1,eagerState:null,next:null},yl(i)){if(s)throw Error(n(479))}else s=Ou(i,l,u,2),s!==null&&ln(s,i,2)}function yl(i){var s=i.alternate;return i===vt||s!==null&&s===vt}function Am(i,s){ia=dl=!0;var l=i.pending;l===null?s.next=s:(s.next=l.next,l.next=s),i.pending=s}function Sm(i,s,l){if((l&4194048)!==0){var u=s.lanes;u&=i.pendingLanes,l|=u,s.lanes=l,Mp(i,l)}}var bl={readContext:ke,use:pl,useCallback:ie,useContext:ie,useEffect:ie,useImperativeHandle:ie,useLayoutEffect:ie,useInsertionEffect:ie,useMemo:ie,useReducer:ie,useRef:ie,useState:ie,useDebugValue:ie,useDeferredValue:ie,useTransition:ie,useSyncExternalStore:ie,useId:ie,useHostTransitionStatus:ie,useFormState:ie,useActionState:ie,useOptimistic:ie,useMemoCache:ie,useCacheRefresh:ie},Em={readContext:ke,use:pl,useCallback:function(i,s){return je().memoizedState=[i,s===void 0?null:s],i},useContext:ke,useEffect:rm,useImperativeHandle:function(i,s,l){l=l!=null?l.concat([i]):null,_l(4194308,4,um.bind(null,s,i),l)},useLayoutEffect:function(i,s){return _l(4194308,4,i,s)},useInsertionEffect:function(i,s){_l(4,2,i,s)},useMemo:function(i,s){var l=je();s=s===void 0?null:s;var u=i();if(ds){yi(!0);try{i()}finally{yi(!1)}}return l.memoizedState=[u,s],u},useReducer:function(i,s,l){var u=je();if(l!==void 0){var p=l(s);if(ds){yi(!0);try{l(s)}finally{yi(!1)}}}else p=s;return u.memoizedState=u.baseState=p,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:p},u.queue=i,i=i.dispatch=TS.bind(null,vt,i),[u.memoizedState,i]},useRef:function(i){var s=je();return i={current:i},s.memoizedState=i},useState:function(i){i=oh(i);var s=i.queue,l=vm.bind(null,vt,s);return s.dispatch=l,[i.memoizedState,l]},useDebugValue:ch,useDeferredValue:function(i,s){var l=je();return uh(l,i,s)},useTransition:function(){var i=oh(!1);return i=gm.bind(null,vt,i.queue,!0,!1),je().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,l){var u=vt,p=je();if(Lt){if(l===void 0)throw Error(n(407));l=l()}else{if(l=s(),qt===null)throw Error(n(349));(Ot&124)!==0||Vg(u,s,l)}p.memoizedState=l;var m={value:l,getSnapshot:s};return p.queue=m,rm(Yg.bind(null,u,m,i),[i]),u.flags|=2048,aa(9,ml(),qg.bind(null,u,m,l,s),null),l},useId:function(){var i=je(),s=qt.identifierPrefix;if(Lt){var l=Qn,u=Kn;l=(u&~(1<<32-tn(u)-1)).toString(32)+l,s="«"+s+"R"+l,l=fl++,0<l&&(s+="H"+l.toString(32)),s+="»"}else l=vS++,s="«"+s+"r"+l.toString(32)+"»";return i.memoizedState=s},useHostTransitionStatus:dh,useFormState:em,useActionState:em,useOptimistic:function(i){var s=je();s.memoizedState=s.baseState=i;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=fh.bind(null,vt,!0,l),l.dispatch=s,[i,s]},useMemoCache:sh,useCacheRefresh:function(){return je().memoizedState=CS.bind(null,vt)}},wm={readContext:ke,use:pl,useCallback:dm,useContext:ke,useEffect:om,useImperativeHandle:hm,useInsertionEffect:lm,useLayoutEffect:cm,useMemo:fm,useReducer:gl,useRef:am,useState:function(){return gl(ti)},useDebugValue:ch,useDeferredValue:function(i,s){var l=le();return pm(l,Ht.memoizedState,i,s)},useTransition:function(){var i=gl(ti)[0],s=le().memoizedState;return[typeof i=="boolean"?i:Ar(i),s]},useSyncExternalStore:jg,useId:ym,useHostTransitionStatus:dh,useFormState:nm,useActionState:nm,useOptimistic:function(i,s){var l=le();return Wg(l,Ht,i,s)},useMemoCache:sh,useCacheRefresh:bm},xS={readContext:ke,use:pl,useCallback:dm,useContext:ke,useEffect:om,useImperativeHandle:hm,useInsertionEffect:lm,useLayoutEffect:cm,useMemo:fm,useReducer:rh,useRef:am,useState:function(){return rh(ti)},useDebugValue:ch,useDeferredValue:function(i,s){var l=le();return Ht===null?uh(l,i,s):pm(l,Ht.memoizedState,i,s)},useTransition:function(){var i=rh(ti)[0],s=le().memoizedState;return[typeof i=="boolean"?i:Ar(i),s]},useSyncExternalStore:jg,useId:ym,useHostTransitionStatus:dh,useFormState:sm,useActionState:sm,useOptimistic:function(i,s){var l=le();return Ht!==null?Wg(l,Ht,i,s):(l.baseState=i,[i,l.queue.dispatch])},useMemoCache:sh,useCacheRefresh:bm},ra=null,wr=0;function vl(i){var s=wr;return wr+=1,ra===null&&(ra=[]),Ig(ra,i,s)}function Cr(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function Al(i,s){throw s.$$typeof===_?Error(n(525)):(i=Object.prototype.toString.call(s),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function Cm(i){var s=i._init;return s(i._payload)}function Tm(i){function s(L,O){if(i){var P=L.deletions;P===null?(L.deletions=[O],L.flags|=16):P.push(O)}}function l(L,O){if(!i)return null;for(;O!==null;)s(L,O),O=O.sibling;return null}function u(L){for(var O=new Map;L!==null;)L.key!==null?O.set(L.key,L):O.set(L.index,L),L=L.sibling;return O}function p(L,O){return L=Wn(L,O),L.index=0,L.sibling=null,L}function m(L,O,P){return L.index=P,i?(P=L.alternate,P!==null?(P=P.index,P<O?(L.flags|=67108866,O):P):(L.flags|=67108866,O)):(L.flags|=1048576,O)}function v(L){return i&&L.alternate===null&&(L.flags|=67108866),L}function E(L,O,P,V){return O===null||O.tag!==6?(O=Lu(P,L.mode,V),O.return=L,O):(O=p(O,P),O.return=L,O)}function x(L,O,P,V){var et=P.type;return et===A?G(L,O,P.props.children,V,P.key):O!==null&&(O.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===j&&Cm(et)===O.type)?(O=p(O,P.props),Cr(O,P),O.return=L,O):(O=il(P.type,P.key,P.props,null,L.mode,V),Cr(O,P),O.return=L,O)}function B(L,O,P,V){return O===null||O.tag!==4||O.stateNode.containerInfo!==P.containerInfo||O.stateNode.implementation!==P.implementation?(O=Iu(P,L.mode,V),O.return=L,O):(O=p(O,P.children||[]),O.return=L,O)}function G(L,O,P,V,et){return O===null||O.tag!==7?(O=ss(P,L.mode,V,et),O.return=L,O):(O=p(O,P),O.return=L,O)}function Y(L,O,P){if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return O=Lu(""+O,L.mode,P),O.return=L,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case y:return P=il(O.type,O.key,O.props,null,L.mode,P),Cr(P,O),P.return=L,P;case b:return O=Iu(O,L.mode,P),O.return=L,O;case j:var V=O._init;return O=V(O._payload),Y(L,O,P)}if(_t(O)||lt(O))return O=ss(O,L.mode,P,null),O.return=L,O;if(typeof O.then=="function")return Y(L,vl(O),P);if(O.$$typeof===T)return Y(L,ol(L,O),P);Al(L,O)}return null}function F(L,O,P,V){var et=O!==null?O.key:null;if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return et!==null?null:E(L,O,""+P,V);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case y:return P.key===et?x(L,O,P,V):null;case b:return P.key===et?B(L,O,P,V):null;case j:return et=P._init,P=et(P._payload),F(L,O,P,V)}if(_t(P)||lt(P))return et!==null?null:G(L,O,P,V,null);if(typeof P.then=="function")return F(L,O,vl(P),V);if(P.$$typeof===T)return F(L,O,ol(L,P),V);Al(L,P)}return null}function H(L,O,P,V,et){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return L=L.get(P)||null,E(O,L,""+V,et);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case y:return L=L.get(V.key===null?P:V.key)||null,x(O,L,V,et);case b:return L=L.get(V.key===null?P:V.key)||null,B(O,L,V,et);case j:var St=V._init;return V=St(V._payload),H(L,O,P,V,et)}if(_t(V)||lt(V))return L=L.get(P)||null,G(O,L,V,et,null);if(typeof V.then=="function")return H(L,O,P,vl(V),et);if(V.$$typeof===T)return H(L,O,P,ol(O,V),et);Al(O,V)}return null}function ht(L,O,P,V){for(var et=null,St=null,st=O,ct=O=0,be=null;st!==null&&ct<P.length;ct++){st.index>ct?(be=st,st=null):be=st.sibling;var kt=F(L,st,P[ct],V);if(kt===null){st===null&&(st=be);break}i&&st&&kt.alternate===null&&s(L,st),O=m(kt,O,ct),St===null?et=kt:St.sibling=kt,St=kt,st=be}if(ct===P.length)return l(L,st),Lt&&rs(L,ct),et;if(st===null){for(;ct<P.length;ct++)st=Y(L,P[ct],V),st!==null&&(O=m(st,O,ct),St===null?et=st:St.sibling=st,St=st);return Lt&&rs(L,ct),et}for(st=u(st);ct<P.length;ct++)be=H(st,L,ct,P[ct],V),be!==null&&(i&&be.alternate!==null&&st.delete(be.key===null?ct:be.key),O=m(be,O,ct),St===null?et=be:St.sibling=be,St=be);return i&&st.forEach(function(Ui){return s(L,Ui)}),Lt&&rs(L,ct),et}function ot(L,O,P,V){if(P==null)throw Error(n(151));for(var et=null,St=null,st=O,ct=O=0,be=null,kt=P.next();st!==null&&!kt.done;ct++,kt=P.next()){st.index>ct?(be=st,st=null):be=st.sibling;var Ui=F(L,st,kt.value,V);if(Ui===null){st===null&&(st=be);break}i&&st&&Ui.alternate===null&&s(L,st),O=m(Ui,O,ct),St===null?et=Ui:St.sibling=Ui,St=Ui,st=be}if(kt.done)return l(L,st),Lt&&rs(L,ct),et;if(st===null){for(;!kt.done;ct++,kt=P.next())kt=Y(L,kt.value,V),kt!==null&&(O=m(kt,O,ct),St===null?et=kt:St.sibling=kt,St=kt);return Lt&&rs(L,ct),et}for(st=u(st);!kt.done;ct++,kt=P.next())kt=H(st,L,ct,kt.value,V),kt!==null&&(i&&kt.alternate!==null&&st.delete(kt.key===null?ct:kt.key),O=m(kt,O,ct),St===null?et=kt:St.sibling=kt,St=kt);return i&&st.forEach(function(RE){return s(L,RE)}),Lt&&rs(L,ct),et}function Ut(L,O,P,V){if(typeof P=="object"&&P!==null&&P.type===A&&P.key===null&&(P=P.props.children),typeof P=="object"&&P!==null){switch(P.$$typeof){case y:t:{for(var et=P.key;O!==null;){if(O.key===et){if(et=P.type,et===A){if(O.tag===7){l(L,O.sibling),V=p(O,P.props.children),V.return=L,L=V;break t}}else if(O.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===j&&Cm(et)===O.type){l(L,O.sibling),V=p(O,P.props),Cr(V,P),V.return=L,L=V;break t}l(L,O);break}else s(L,O);O=O.sibling}P.type===A?(V=ss(P.props.children,L.mode,V,P.key),V.return=L,L=V):(V=il(P.type,P.key,P.props,null,L.mode,V),Cr(V,P),V.return=L,L=V)}return v(L);case b:t:{for(et=P.key;O!==null;){if(O.key===et)if(O.tag===4&&O.stateNode.containerInfo===P.containerInfo&&O.stateNode.implementation===P.implementation){l(L,O.sibling),V=p(O,P.children||[]),V.return=L,L=V;break t}else{l(L,O);break}else s(L,O);O=O.sibling}V=Iu(P,L.mode,V),V.return=L,L=V}return v(L);case j:return et=P._init,P=et(P._payload),Ut(L,O,P,V)}if(_t(P))return ht(L,O,P,V);if(lt(P)){if(et=lt(P),typeof et!="function")throw Error(n(150));return P=et.call(P),ot(L,O,P,V)}if(typeof P.then=="function")return Ut(L,O,vl(P),V);if(P.$$typeof===T)return Ut(L,O,ol(L,P),V);Al(L,P)}return typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint"?(P=""+P,O!==null&&O.tag===6?(l(L,O.sibling),V=p(O,P),V.return=L,L=V):(l(L,O),V=Lu(P,L.mode,V),V.return=L,L=V),v(L)):l(L,O)}return function(L,O,P,V){try{wr=0;var et=Ut(L,O,P,V);return ra=null,et}catch(st){if(st===gr||st===cl)throw st;var St=nn(29,st,null,L.mode);return St.lanes=V,St.return=L,St}finally{}}}var oa=Tm(!0),xm=Tm(!1),_n=q(null),Pn=null;function Ti(i){var s=i.alternate;X(pe,pe.current&1),X(_n,i),Pn===null&&(s===null||na.current!==null||s.memoizedState!==null)&&(Pn=i)}function Rm(i){if(i.tag===22){if(X(pe,pe.current),X(_n,i),Pn===null){var s=i.alternate;s!==null&&s.memoizedState!==null&&(Pn=i)}}else xi()}function xi(){X(pe,pe.current),X(_n,_n.current)}function ei(i){W(_n),Pn===i&&(Pn=null),W(pe)}var pe=q(0);function Sl(i){for(var s=i;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||id(l)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function ph(i,s,l,u){s=i.memoizedState,l=l(u,s),l=l==null?s:g({},s,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var gh={enqueueSetState:function(i,s,l){i=i._reactInternals;var u=on(),p=Ei(u);p.payload=s,l!=null&&(p.callback=l),s=wi(i,p,u),s!==null&&(ln(s,i,u),_r(s,i,u))},enqueueReplaceState:function(i,s,l){i=i._reactInternals;var u=on(),p=Ei(u);p.tag=1,p.payload=s,l!=null&&(p.callback=l),s=wi(i,p,u),s!==null&&(ln(s,i,u),_r(s,i,u))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var l=on(),u=Ei(l);u.tag=2,s!=null&&(u.callback=s),s=wi(i,u,l),s!==null&&(ln(s,i,l),_r(s,i,l))}};function Dm(i,s,l,u,p,m,v){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(u,m,v):s.prototype&&s.prototype.isPureReactComponent?!or(l,u)||!or(p,m):!0}function Mm(i,s,l,u){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,u),s.state!==i&&gh.enqueueReplaceState(s,s.state,null)}function fs(i,s){var l=s;if("ref"in s){l={};for(var u in s)u!=="ref"&&(l[u]=s[u])}if(i=i.defaultProps){l===s&&(l=g({},l));for(var p in i)l[p]===void 0&&(l[p]=i[p])}return l}var El=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Nm(i){El(i)}function Om(i){console.error(i)}function km(i){El(i)}function wl(i,s){try{var l=i.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(u){setTimeout(function(){throw u})}}function Lm(i,s,l){try{var u=i.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function mh(i,s,l){return l=Ei(l),l.tag=3,l.payload={element:null},l.callback=function(){wl(i,s)},l}function Im(i){return i=Ei(i),i.tag=3,i}function Pm(i,s,l,u){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var m=u.value;i.payload=function(){return p(m)},i.callback=function(){Lm(s,l,u)}}var v=l.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(i.callback=function(){Lm(s,l,u),typeof p!="function"&&(ki===null?ki=new Set([this]):ki.add(this));var E=u.stack;this.componentDidCatch(u.value,{componentStack:E!==null?E:""})})}function RS(i,s,l,u,p){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(s=l.alternate,s!==null&&dr(s,l,p,!0),l=_n.current,l!==null){switch(l.tag){case 13:return Pn===null?zh():l.alternate===null&&ee===0&&(ee=3),l.flags&=-257,l.flags|=65536,l.lanes=p,u===qu?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([u]):s.add(u),Gh(i,u,p)),!1;case 22:return l.flags|=65536,u===qu?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([u]):l.add(u)),Gh(i,u,p)),!1}throw Error(n(435,l.tag))}return Gh(i,u,p),zh(),!1}if(Lt)return s=_n.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=p,u!==Fu&&(i=Error(n(422),{cause:u}),hr(fn(i,l)))):(u!==Fu&&(s=Error(n(423),{cause:u}),hr(fn(s,l))),i=i.current.alternate,i.flags|=65536,p&=-p,i.lanes|=p,u=fn(u,l),p=mh(i.stateNode,u,p),$u(i,p),ee!==4&&(ee=2)),!1;var m=Error(n(520),{cause:u});if(m=fn(m,l),Or===null?Or=[m]:Or.push(m),ee!==4&&(ee=2),s===null)return!0;u=fn(u,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,i=p&-p,l.lanes|=i,i=mh(l.stateNode,u,i),$u(l,i),!1;case 1:if(s=l.type,m=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(ki===null||!ki.has(m))))return l.flags|=65536,p&=-p,l.lanes|=p,p=Im(p),Pm(p,i,l,u),$u(l,p),!1}l=l.return}while(l!==null);return!1}var Bm=Error(n(461)),_e=!1;function we(i,s,l,u){s.child=i===null?xm(s,null,l,u):oa(s,i.child,l,u)}function Fm(i,s,l,u,p){l=l.render;var m=s.ref;if("ref"in u){var v={};for(var E in u)E!=="ref"&&(v[E]=u[E])}else v=u;return us(s),u=Ju(i,s,l,v,m,p),E=th(),i!==null&&!_e?(eh(i,s,p),ni(i,s,p)):(Lt&&E&&Pu(s),s.flags|=1,we(i,s,u,p),s.child)}function Hm(i,s,l,u,p){if(i===null){var m=l.type;return typeof m=="function"&&!ku(m)&&m.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=m,zm(i,s,m,u,p)):(i=il(l.type,null,u,s,s.mode,p),i.ref=s.ref,i.return=s,s.child=i)}if(m=i.child,!wh(i,p)){var v=m.memoizedProps;if(l=l.compare,l=l!==null?l:or,l(v,u)&&i.ref===s.ref)return ni(i,s,p)}return s.flags|=1,i=Wn(m,u),i.ref=s.ref,i.return=s,s.child=i}function zm(i,s,l,u,p){if(i!==null){var m=i.memoizedProps;if(or(m,u)&&i.ref===s.ref)if(_e=!1,s.pendingProps=u=m,wh(i,p))(i.flags&131072)!==0&&(_e=!0);else return s.lanes=i.lanes,ni(i,s,p)}return _h(i,s,l,u,p)}function Um(i,s,l){var u=s.pendingProps,p=u.children,m=i!==null?i.memoizedState:null;if(u.mode==="hidden"){if((s.flags&128)!==0){if(u=m!==null?m.baseLanes|l:l,i!==null){for(p=s.child=i.child,m=0;p!==null;)m=m|p.lanes|p.childLanes,p=p.sibling;s.childLanes=m&~u}else s.childLanes=0,s.child=null;return Gm(i,s,u,l)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&ll(s,m!==null?m.cachePool:null),m!==null?zg(s,m):Ku(),Rm(s);else return s.lanes=s.childLanes=536870912,Gm(i,s,m!==null?m.baseLanes|l:l,l)}else m!==null?(ll(s,m.cachePool),zg(s,m),xi(),s.memoizedState=null):(i!==null&&ll(s,null),Ku(),xi());return we(i,s,p,l),s.child}function Gm(i,s,l,u){var p=Vu();return p=p===null?null:{parent:fe._currentValue,pool:p},s.memoizedState={baseLanes:l,cachePool:p},i!==null&&ll(s,null),Ku(),Rm(s),i!==null&&dr(i,s,u,!0),null}function Cl(i,s){var l=s.ref;if(l===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(n(284));(i===null||i.ref!==l)&&(s.flags|=4194816)}}function _h(i,s,l,u,p){return us(s),l=Ju(i,s,l,u,void 0,p),u=th(),i!==null&&!_e?(eh(i,s,p),ni(i,s,p)):(Lt&&u&&Pu(s),s.flags|=1,we(i,s,l,p),s.child)}function jm(i,s,l,u,p,m){return us(s),s.updateQueue=null,l=Gg(s,u,l,p),Ug(i),u=th(),i!==null&&!_e?(eh(i,s,m),ni(i,s,m)):(Lt&&u&&Pu(s),s.flags|=1,we(i,s,l,m),s.child)}function Vm(i,s,l,u,p){if(us(s),s.stateNode===null){var m=Qs,v=l.contextType;typeof v=="object"&&v!==null&&(m=ke(v)),m=new l(u,m),s.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=gh,s.stateNode=m,m._reactInternals=s,m=s.stateNode,m.props=u,m.state=s.memoizedState,m.refs={},Yu(s),v=l.contextType,m.context=typeof v=="object"&&v!==null?ke(v):Qs,m.state=s.memoizedState,v=l.getDerivedStateFromProps,typeof v=="function"&&(ph(s,l,v,u),m.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(v=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),v!==m.state&&gh.enqueueReplaceState(m,m.state,null),br(s,u,m,p),yr(),m.state=s.memoizedState),typeof m.componentDidMount=="function"&&(s.flags|=4194308),u=!0}else if(i===null){m=s.stateNode;var E=s.memoizedProps,x=fs(l,E);m.props=x;var B=m.context,G=l.contextType;v=Qs,typeof G=="object"&&G!==null&&(v=ke(G));var Y=l.getDerivedStateFromProps;G=typeof Y=="function"||typeof m.getSnapshotBeforeUpdate=="function",E=s.pendingProps!==E,G||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(E||B!==v)&&Mm(s,m,u,v),Si=!1;var F=s.memoizedState;m.state=F,br(s,u,m,p),yr(),B=s.memoizedState,E||F!==B||Si?(typeof Y=="function"&&(ph(s,l,Y,u),B=s.memoizedState),(x=Si||Dm(s,l,x,u,F,B,v))?(G||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(s.flags|=4194308)):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=B),m.props=u,m.state=B,m.context=v,u=x):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{m=s.stateNode,Xu(i,s),v=s.memoizedProps,G=fs(l,v),m.props=G,Y=s.pendingProps,F=m.context,B=l.contextType,x=Qs,typeof B=="object"&&B!==null&&(x=ke(B)),E=l.getDerivedStateFromProps,(B=typeof E=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(v!==Y||F!==x)&&Mm(s,m,u,x),Si=!1,F=s.memoizedState,m.state=F,br(s,u,m,p),yr();var H=s.memoizedState;v!==Y||F!==H||Si||i!==null&&i.dependencies!==null&&rl(i.dependencies)?(typeof E=="function"&&(ph(s,l,E,u),H=s.memoizedState),(G=Si||Dm(s,l,G,u,F,H,x)||i!==null&&i.dependencies!==null&&rl(i.dependencies))?(B||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(u,H,x),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(u,H,x)),typeof m.componentDidUpdate=="function"&&(s.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof m.componentDidUpdate!="function"||v===i.memoizedProps&&F===i.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===i.memoizedProps&&F===i.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=H),m.props=u,m.state=H,m.context=x,u=G):(typeof m.componentDidUpdate!="function"||v===i.memoizedProps&&F===i.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===i.memoizedProps&&F===i.memoizedState||(s.flags|=1024),u=!1)}return m=u,Cl(i,s),u=(s.flags&128)!==0,m||u?(m=s.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:m.render(),s.flags|=1,i!==null&&u?(s.child=oa(s,i.child,null,p),s.child=oa(s,null,l,p)):we(i,s,l,p),s.memoizedState=m.state,i=s.child):i=ni(i,s,p),i}function qm(i,s,l,u){return ur(),s.flags|=256,we(i,s,l,u),s.child}var yh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function bh(i){return{baseLanes:i,cachePool:Og()}}function vh(i,s,l){return i=i!==null?i.childLanes&~l:0,s&&(i|=yn),i}function Ym(i,s,l){var u=s.pendingProps,p=!1,m=(s.flags&128)!==0,v;if((v=m)||(v=i!==null&&i.memoizedState===null?!1:(pe.current&2)!==0),v&&(p=!0,s.flags&=-129),v=(s.flags&32)!==0,s.flags&=-33,i===null){if(Lt){if(p?Ti(s):xi(),Lt){var E=te,x;if(x=E){t:{for(x=E,E=In;x.nodeType!==8;){if(!E){E=null;break t}if(x=xn(x.nextSibling),x===null){E=null;break t}}E=x}E!==null?(s.memoizedState={dehydrated:E,treeContext:as!==null?{id:Kn,overflow:Qn}:null,retryLane:536870912,hydrationErrors:null},x=nn(18,null,null,0),x.stateNode=E,x.return=s,s.child=x,Pe=s,te=null,x=!0):x=!1}x||ls(s)}if(E=s.memoizedState,E!==null&&(E=E.dehydrated,E!==null))return id(E)?s.lanes=32:s.lanes=536870912,null;ei(s)}return E=u.children,u=u.fallback,p?(xi(),p=s.mode,E=Tl({mode:"hidden",children:E},p),u=ss(u,p,l,null),E.return=s,u.return=s,E.sibling=u,s.child=E,p=s.child,p.memoizedState=bh(l),p.childLanes=vh(i,v,l),s.memoizedState=yh,u):(Ti(s),Ah(s,E))}if(x=i.memoizedState,x!==null&&(E=x.dehydrated,E!==null)){if(m)s.flags&256?(Ti(s),s.flags&=-257,s=Sh(i,s,l)):s.memoizedState!==null?(xi(),s.child=i.child,s.flags|=128,s=null):(xi(),p=u.fallback,E=s.mode,u=Tl({mode:"visible",children:u.children},E),p=ss(p,E,l,null),p.flags|=2,u.return=s,p.return=s,u.sibling=p,s.child=u,oa(s,i.child,null,l),u=s.child,u.memoizedState=bh(l),u.childLanes=vh(i,v,l),s.memoizedState=yh,s=p);else if(Ti(s),id(E)){if(v=E.nextSibling&&E.nextSibling.dataset,v)var B=v.dgst;v=B,u=Error(n(419)),u.stack="",u.digest=v,hr({value:u,source:null,stack:null}),s=Sh(i,s,l)}else if(_e||dr(i,s,l,!1),v=(l&i.childLanes)!==0,_e||v){if(v=qt,v!==null&&(u=l&-l,u=(u&42)!==0?1:su(u),u=(u&(v.suspendedLanes|l))!==0?0:u,u!==0&&u!==x.retryLane))throw x.retryLane=u,Ks(i,u),ln(v,i,u),Bm;E.data==="$?"||zh(),s=Sh(i,s,l)}else E.data==="$?"?(s.flags|=192,s.child=i.child,s=null):(i=x.treeContext,te=xn(E.nextSibling),Pe=s,Lt=!0,os=null,In=!1,i!==null&&(gn[mn++]=Kn,gn[mn++]=Qn,gn[mn++]=as,Kn=i.id,Qn=i.overflow,as=s),s=Ah(s,u.children),s.flags|=4096);return s}return p?(xi(),p=u.fallback,E=s.mode,x=i.child,B=x.sibling,u=Wn(x,{mode:"hidden",children:u.children}),u.subtreeFlags=x.subtreeFlags&65011712,B!==null?p=Wn(B,p):(p=ss(p,E,l,null),p.flags|=2),p.return=s,u.return=s,u.sibling=p,s.child=u,u=p,p=s.child,E=i.child.memoizedState,E===null?E=bh(l):(x=E.cachePool,x!==null?(B=fe._currentValue,x=x.parent!==B?{parent:B,pool:B}:x):x=Og(),E={baseLanes:E.baseLanes|l,cachePool:x}),p.memoizedState=E,p.childLanes=vh(i,v,l),s.memoizedState=yh,u):(Ti(s),l=i.child,i=l.sibling,l=Wn(l,{mode:"visible",children:u.children}),l.return=s,l.sibling=null,i!==null&&(v=s.deletions,v===null?(s.deletions=[i],s.flags|=16):v.push(i)),s.child=l,s.memoizedState=null,l)}function Ah(i,s){return s=Tl({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function Tl(i,s){return i=nn(22,i,null,s),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function Sh(i,s,l){return oa(s,i.child,null,l),i=Ah(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function Xm(i,s,l){i.lanes|=s;var u=i.alternate;u!==null&&(u.lanes|=s),zu(i.return,s,l)}function Eh(i,s,l,u,p){var m=i.memoizedState;m===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:p}:(m.isBackwards=s,m.rendering=null,m.renderingStartTime=0,m.last=u,m.tail=l,m.tailMode=p)}function $m(i,s,l){var u=s.pendingProps,p=u.revealOrder,m=u.tail;if(we(i,s,u.children,l),u=pe.current,(u&2)!==0)u=u&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)t:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Xm(i,l,s);else if(i.tag===19)Xm(i,l,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break t;for(;i.sibling===null;){if(i.return===null||i.return===s)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}u&=1}switch(X(pe,u),p){case"forwards":for(l=s.child,p=null;l!==null;)i=l.alternate,i!==null&&Sl(i)===null&&(p=l),l=l.sibling;l=p,l===null?(p=s.child,s.child=null):(p=l.sibling,l.sibling=null),Eh(s,!1,p,l,m);break;case"backwards":for(l=null,p=s.child,s.child=null;p!==null;){if(i=p.alternate,i!==null&&Sl(i)===null){s.child=p;break}i=p.sibling,p.sibling=l,l=p,p=i}Eh(s,!0,l,null,m);break;case"together":Eh(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function ni(i,s,l){if(i!==null&&(s.dependencies=i.dependencies),Oi|=s.lanes,(l&s.childLanes)===0)if(i!==null){if(dr(i,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(n(153));if(s.child!==null){for(i=s.child,l=Wn(i,i.pendingProps),s.child=l,l.return=s;i.sibling!==null;)i=i.sibling,l=l.sibling=Wn(i,i.pendingProps),l.return=s;l.sibling=null}return s.child}function wh(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&rl(i)))}function DS(i,s,l){switch(s.tag){case 3:Pt(s,s.stateNode.containerInfo),Ai(s,fe,i.memoizedState.cache),ur();break;case 27:case 5:Xa(s);break;case 4:Pt(s,s.stateNode.containerInfo);break;case 10:Ai(s,s.type,s.memoizedProps.value);break;case 13:var u=s.memoizedState;if(u!==null)return u.dehydrated!==null?(Ti(s),s.flags|=128,null):(l&s.child.childLanes)!==0?Ym(i,s,l):(Ti(s),i=ni(i,s,l),i!==null?i.sibling:null);Ti(s);break;case 19:var p=(i.flags&128)!==0;if(u=(l&s.childLanes)!==0,u||(dr(i,s,l,!1),u=(l&s.childLanes)!==0),p){if(u)return $m(i,s,l);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),X(pe,pe.current),u)break;return null;case 22:case 23:return s.lanes=0,Um(i,s,l);case 24:Ai(s,fe,i.memoizedState.cache)}return ni(i,s,l)}function Wm(i,s,l){if(i!==null)if(i.memoizedProps!==s.pendingProps)_e=!0;else{if(!wh(i,l)&&(s.flags&128)===0)return _e=!1,DS(i,s,l);_e=(i.flags&131072)!==0}else _e=!1,Lt&&(s.flags&1048576)!==0&&Cg(s,al,s.index);switch(s.lanes=0,s.tag){case 16:t:{i=s.pendingProps;var u=s.elementType,p=u._init;if(u=p(u._payload),s.type=u,typeof u=="function")ku(u)?(i=fs(u,i),s.tag=1,s=Vm(null,s,u,i,l)):(s.tag=0,s=_h(null,s,u,i,l));else{if(u!=null){if(p=u.$$typeof,p===N){s.tag=11,s=Fm(null,s,u,i,l);break t}else if(p===z){s.tag=14,s=Hm(null,s,u,i,l);break t}}throw s=Tt(u)||u,Error(n(306,s,""))}}return s;case 0:return _h(i,s,s.type,s.pendingProps,l);case 1:return u=s.type,p=fs(u,s.pendingProps),Vm(i,s,u,p,l);case 3:t:{if(Pt(s,s.stateNode.containerInfo),i===null)throw Error(n(387));u=s.pendingProps;var m=s.memoizedState;p=m.element,Xu(i,s),br(s,u,null,l);var v=s.memoizedState;if(u=v.cache,Ai(s,fe,u),u!==m.cache&&Uu(s,[fe],l,!0),yr(),u=v.element,m.isDehydrated)if(m={element:u,isDehydrated:!1,cache:v.cache},s.updateQueue.baseState=m,s.memoizedState=m,s.flags&256){s=qm(i,s,u,l);break t}else if(u!==p){p=fn(Error(n(424)),s),hr(p),s=qm(i,s,u,l);break t}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(te=xn(i.firstChild),Pe=s,Lt=!0,os=null,In=!0,l=xm(s,null,u,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(ur(),u===p){s=ni(i,s,l);break t}we(i,s,u,l)}s=s.child}return s;case 26:return Cl(i,s),i===null?(l=J_(s.type,null,s.pendingProps,null))?s.memoizedState=l:Lt||(l=s.type,i=s.pendingProps,u=zl(at.current).createElement(l),u[Oe]=s,u[Ue]=i,Te(u,l,i),me(u),s.stateNode=u):s.memoizedState=J_(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return Xa(s),i===null&&Lt&&(u=s.stateNode=K_(s.type,s.pendingProps,at.current),Pe=s,In=!0,p=te,Pi(s.type)?(sd=p,te=xn(u.firstChild)):te=p),we(i,s,s.pendingProps.children,l),Cl(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&Lt&&((p=u=te)&&(u=iE(u,s.type,s.pendingProps,In),u!==null?(s.stateNode=u,Pe=s,te=xn(u.firstChild),In=!1,p=!0):p=!1),p||ls(s)),Xa(s),p=s.type,m=s.pendingProps,v=i!==null?i.memoizedProps:null,u=m.children,td(p,m)?u=null:v!==null&&td(p,v)&&(s.flags|=32),s.memoizedState!==null&&(p=Ju(i,s,AS,null,null,l),Ur._currentValue=p),Cl(i,s),we(i,s,u,l),s.child;case 6:return i===null&&Lt&&((i=l=te)&&(l=sE(l,s.pendingProps,In),l!==null?(s.stateNode=l,Pe=s,te=null,i=!0):i=!1),i||ls(s)),null;case 13:return Ym(i,s,l);case 4:return Pt(s,s.stateNode.containerInfo),u=s.pendingProps,i===null?s.child=oa(s,null,u,l):we(i,s,u,l),s.child;case 11:return Fm(i,s,s.type,s.pendingProps,l);case 7:return we(i,s,s.pendingProps,l),s.child;case 8:return we(i,s,s.pendingProps.children,l),s.child;case 12:return we(i,s,s.pendingProps.children,l),s.child;case 10:return u=s.pendingProps,Ai(s,s.type,u.value),we(i,s,u.children,l),s.child;case 9:return p=s.type._context,u=s.pendingProps.children,us(s),p=ke(p),u=u(p),s.flags|=1,we(i,s,u,l),s.child;case 14:return Hm(i,s,s.type,s.pendingProps,l);case 15:return zm(i,s,s.type,s.pendingProps,l);case 19:return $m(i,s,l);case 31:return u=s.pendingProps,l=s.mode,u={mode:u.mode,children:u.children},i===null?(l=Tl(u,l),l.ref=s.ref,s.child=l,l.return=s,s=l):(l=Wn(i.child,u),l.ref=s.ref,s.child=l,l.return=s,s=l),s;case 22:return Um(i,s,l);case 24:return us(s),u=ke(fe),i===null?(p=Vu(),p===null&&(p=qt,m=Gu(),p.pooledCache=m,m.refCount++,m!==null&&(p.pooledCacheLanes|=l),p=m),s.memoizedState={parent:u,cache:p},Yu(s),Ai(s,fe,p)):((i.lanes&l)!==0&&(Xu(i,s),br(s,null,null,l),yr()),p=i.memoizedState,m=s.memoizedState,p.parent!==u?(p={parent:u,cache:u},s.memoizedState=p,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=p),Ai(s,fe,u)):(u=m.cache,Ai(s,fe,u),u!==p.cache&&Uu(s,[fe],l,!0))),we(i,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(n(156,s.tag))}function ii(i){i.flags|=4}function Km(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!sy(s)){if(s=_n.current,s!==null&&((Ot&4194048)===Ot?Pn!==null:(Ot&62914560)!==Ot&&(Ot&536870912)===0||s!==Pn))throw mr=qu,kg;i.flags|=8192}}function xl(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Rp():536870912,i.lanes|=s,ha|=s)}function Tr(i,s){if(!Lt)switch(i.tailMode){case"hidden":s=i.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:u.sibling=null}}function Zt(i){var s=i.alternate!==null&&i.alternate.child===i.child,l=0,u=0;if(s)for(var p=i.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags&65011712,u|=p.flags&65011712,p.return=i,p=p.sibling;else for(p=i.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags,u|=p.flags,p.return=i,p=p.sibling;return i.subtreeFlags|=u,i.childLanes=l,s}function MS(i,s,l){var u=s.pendingProps;switch(Bu(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zt(s),null;case 1:return Zt(s),null;case 3:return l=s.stateNode,u=null,i!==null&&(u=i.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),Jn(fe),kn(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(cr(s)?ii(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Rg())),Zt(s),null;case 26:return l=s.memoizedState,i===null?(ii(s),l!==null?(Zt(s),Km(s,l)):(Zt(s),s.flags&=-16777217)):l?l!==i.memoizedState?(ii(s),Zt(s),Km(s,l)):(Zt(s),s.flags&=-16777217):(i.memoizedProps!==u&&ii(s),Zt(s),s.flags&=-16777217),null;case 27:_i(s),l=at.current;var p=s.type;if(i!==null&&s.stateNode!=null)i.memoizedProps!==u&&ii(s);else{if(!u){if(s.stateNode===null)throw Error(n(166));return Zt(s),null}i=it.current,cr(s)?Tg(s):(i=K_(p,u,l),s.stateNode=i,ii(s))}return Zt(s),null;case 5:if(_i(s),l=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==u&&ii(s);else{if(!u){if(s.stateNode===null)throw Error(n(166));return Zt(s),null}if(i=it.current,cr(s))Tg(s);else{switch(p=zl(at.current),i){case 1:i=p.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:i=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":i=p.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":i=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":i=p.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof u.is=="string"?p.createElement("select",{is:u.is}):p.createElement("select"),u.multiple?i.multiple=!0:u.size&&(i.size=u.size);break;default:i=typeof u.is=="string"?p.createElement(l,{is:u.is}):p.createElement(l)}}i[Oe]=s,i[Ue]=u;t:for(p=s.child;p!==null;){if(p.tag===5||p.tag===6)i.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===s)break t;for(;p.sibling===null;){if(p.return===null||p.return===s)break t;p=p.return}p.sibling.return=p.return,p=p.sibling}s.stateNode=i;t:switch(Te(i,l,u),l){case"button":case"input":case"select":case"textarea":i=!!u.autoFocus;break t;case"img":i=!0;break t;default:i=!1}i&&ii(s)}}return Zt(s),s.flags&=-16777217,null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==u&&ii(s);else{if(typeof u!="string"&&s.stateNode===null)throw Error(n(166));if(i=at.current,cr(s)){if(i=s.stateNode,l=s.memoizedProps,u=null,p=Pe,p!==null)switch(p.tag){case 27:case 5:u=p.memoizedProps}i[Oe]=s,i=!!(i.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||j_(i.nodeValue,l)),i||ls(s)}else i=zl(i).createTextNode(u),i[Oe]=s,s.stateNode=i}return Zt(s),null;case 13:if(u=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(p=cr(s),u!==null&&u.dehydrated!==null){if(i===null){if(!p)throw Error(n(318));if(p=s.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(n(317));p[Oe]=s}else ur(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Zt(s),p=!1}else p=Rg(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=p),p=!0;if(!p)return s.flags&256?(ei(s),s):(ei(s),null)}if(ei(s),(s.flags&128)!==0)return s.lanes=l,s;if(l=u!==null,i=i!==null&&i.memoizedState!==null,l){u=s.child,p=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(p=u.alternate.memoizedState.cachePool.pool);var m=null;u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(m=u.memoizedState.cachePool.pool),m!==p&&(u.flags|=2048)}return l!==i&&l&&(s.child.flags|=8192),xl(s,s.updateQueue),Zt(s),null;case 4:return kn(),i===null&&Wh(s.stateNode.containerInfo),Zt(s),null;case 10:return Jn(s.type),Zt(s),null;case 19:if(W(pe),p=s.memoizedState,p===null)return Zt(s),null;if(u=(s.flags&128)!==0,m=p.rendering,m===null)if(u)Tr(p,!1);else{if(ee!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(m=Sl(i),m!==null){for(s.flags|=128,Tr(p,!1),i=m.updateQueue,s.updateQueue=i,xl(s,i),s.subtreeFlags=0,i=l,l=s.child;l!==null;)wg(l,i),l=l.sibling;return X(pe,pe.current&1|2),s.child}i=i.sibling}p.tail!==null&&Ln()>Ml&&(s.flags|=128,u=!0,Tr(p,!1),s.lanes=4194304)}else{if(!u)if(i=Sl(m),i!==null){if(s.flags|=128,u=!0,i=i.updateQueue,s.updateQueue=i,xl(s,i),Tr(p,!0),p.tail===null&&p.tailMode==="hidden"&&!m.alternate&&!Lt)return Zt(s),null}else 2*Ln()-p.renderingStartTime>Ml&&l!==536870912&&(s.flags|=128,u=!0,Tr(p,!1),s.lanes=4194304);p.isBackwards?(m.sibling=s.child,s.child=m):(i=p.last,i!==null?i.sibling=m:s.child=m,p.last=m)}return p.tail!==null?(s=p.tail,p.rendering=s,p.tail=s.sibling,p.renderingStartTime=Ln(),s.sibling=null,i=pe.current,X(pe,u?i&1|2:i&1),s):(Zt(s),null);case 22:case 23:return ei(s),Qu(),u=s.memoizedState!==null,i!==null?i.memoizedState!==null!==u&&(s.flags|=8192):u&&(s.flags|=8192),u?(l&536870912)!==0&&(s.flags&128)===0&&(Zt(s),s.subtreeFlags&6&&(s.flags|=8192)):Zt(s),l=s.updateQueue,l!==null&&xl(s,l.retryQueue),l=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),u=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),u!==l&&(s.flags|=2048),i!==null&&W(hs),null;case 24:return l=null,i!==null&&(l=i.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Jn(fe),Zt(s),null;case 25:return null;case 30:return null}throw Error(n(156,s.tag))}function NS(i,s){switch(Bu(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Jn(fe),kn(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return _i(s),null;case 13:if(ei(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(n(340));ur()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return W(pe),null;case 4:return kn(),null;case 10:return Jn(s.type),null;case 22:case 23:return ei(s),Qu(),i!==null&&W(hs),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Jn(fe),null;case 25:return null;default:return null}}function Qm(i,s){switch(Bu(s),s.tag){case 3:Jn(fe),kn();break;case 26:case 27:case 5:_i(s);break;case 4:kn();break;case 13:ei(s);break;case 19:W(pe);break;case 10:Jn(s.type);break;case 22:case 23:ei(s),Qu(),i!==null&&W(hs);break;case 24:Jn(fe)}}function xr(i,s){try{var l=s.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var p=u.next;l=p;do{if((l.tag&i)===i){u=void 0;var m=l.create,v=l.inst;u=m(),v.destroy=u}l=l.next}while(l!==p)}}catch(E){jt(s,s.return,E)}}function Ri(i,s,l){try{var u=s.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var m=p.next;u=m;do{if((u.tag&i)===i){var v=u.inst,E=v.destroy;if(E!==void 0){v.destroy=void 0,p=s;var x=l,B=E;try{B()}catch(G){jt(p,x,G)}}}u=u.next}while(u!==m)}}catch(G){jt(s,s.return,G)}}function Zm(i){var s=i.updateQueue;if(s!==null){var l=i.stateNode;try{Hg(s,l)}catch(u){jt(i,i.return,u)}}}function Jm(i,s,l){l.props=fs(i.type,i.memoizedProps),l.state=i.memoizedState;try{l.componentWillUnmount()}catch(u){jt(i,s,u)}}function Rr(i,s){try{var l=i.ref;if(l!==null){switch(i.tag){case 26:case 27:case 5:var u=i.stateNode;break;case 30:u=i.stateNode;break;default:u=i.stateNode}typeof l=="function"?i.refCleanup=l(u):l.current=u}}catch(p){jt(i,s,p)}}function Bn(i,s){var l=i.ref,u=i.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(p){jt(i,s,p)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){jt(i,s,p)}else l.current=null}function t_(i){var s=i.type,l=i.memoizedProps,u=i.stateNode;try{t:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break t;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(p){jt(i,i.return,p)}}function Ch(i,s,l){try{var u=i.stateNode;ZS(u,i.type,l,s),u[Ue]=s}catch(p){jt(i,i.return,p)}}function e_(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Pi(i.type)||i.tag===4}function Th(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||e_(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Pi(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function xh(i,s,l){var u=i.tag;if(u===5||u===6)i=i.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(i,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(i),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Hl));else if(u!==4&&(u===27&&Pi(i.type)&&(l=i.stateNode,s=null),i=i.child,i!==null))for(xh(i,s,l),i=i.sibling;i!==null;)xh(i,s,l),i=i.sibling}function Rl(i,s,l){var u=i.tag;if(u===5||u===6)i=i.stateNode,s?l.insertBefore(i,s):l.appendChild(i);else if(u!==4&&(u===27&&Pi(i.type)&&(l=i.stateNode),i=i.child,i!==null))for(Rl(i,s,l),i=i.sibling;i!==null;)Rl(i,s,l),i=i.sibling}function n_(i){var s=i.stateNode,l=i.memoizedProps;try{for(var u=i.type,p=s.attributes;p.length;)s.removeAttributeNode(p[0]);Te(s,u,l),s[Oe]=i,s[Ue]=l}catch(m){jt(i,i.return,m)}}var si=!1,se=!1,Rh=!1,i_=typeof WeakSet=="function"?WeakSet:Set,ye=null;function OS(i,s){if(i=i.containerInfo,Zh=Yl,i=pg(i),Tu(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else t:{l=(l=i.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var p=u.anchorOffset,m=u.focusNode;u=u.focusOffset;try{l.nodeType,m.nodeType}catch{l=null;break t}var v=0,E=-1,x=-1,B=0,G=0,Y=i,F=null;e:for(;;){for(var H;Y!==l||p!==0&&Y.nodeType!==3||(E=v+p),Y!==m||u!==0&&Y.nodeType!==3||(x=v+u),Y.nodeType===3&&(v+=Y.nodeValue.length),(H=Y.firstChild)!==null;)F=Y,Y=H;for(;;){if(Y===i)break e;if(F===l&&++B===p&&(E=v),F===m&&++G===u&&(x=v),(H=Y.nextSibling)!==null)break;Y=F,F=Y.parentNode}Y=H}l=E===-1||x===-1?null:{start:E,end:x}}else l=null}l=l||{start:0,end:0}}else l=null;for(Jh={focusedElem:i,selectionRange:l},Yl=!1,ye=s;ye!==null;)if(s=ye,i=s.child,(s.subtreeFlags&1024)!==0&&i!==null)i.return=s,ye=i;else for(;ye!==null;){switch(s=ye,m=s.alternate,i=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&m!==null){i=void 0,l=s,p=m.memoizedProps,m=m.memoizedState,u=l.stateNode;try{var ht=fs(l.type,p,l.elementType===l.type);i=u.getSnapshotBeforeUpdate(ht,m),u.__reactInternalSnapshotBeforeUpdate=i}catch(ot){jt(l,l.return,ot)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,l=i.nodeType,l===9)nd(i);else if(l===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":nd(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(n(163))}if(i=s.sibling,i!==null){i.return=s.return,ye=i;break}ye=s.return}}function s_(i,s,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:Di(i,l),u&4&&xr(5,l);break;case 1:if(Di(i,l),u&4)if(i=l.stateNode,s===null)try{i.componentDidMount()}catch(v){jt(l,l.return,v)}else{var p=fs(l.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(p,s,i.__reactInternalSnapshotBeforeUpdate)}catch(v){jt(l,l.return,v)}}u&64&&Zm(l),u&512&&Rr(l,l.return);break;case 3:if(Di(i,l),u&64&&(i=l.updateQueue,i!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{Hg(i,s)}catch(v){jt(l,l.return,v)}}break;case 27:s===null&&u&4&&n_(l);case 26:case 5:Di(i,l),s===null&&u&4&&t_(l),u&512&&Rr(l,l.return);break;case 12:Di(i,l);break;case 13:Di(i,l),u&4&&o_(i,l),u&64&&(i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(l=US.bind(null,l),aE(i,l))));break;case 22:if(u=l.memoizedState!==null||si,!u){s=s!==null&&s.memoizedState!==null||se,p=si;var m=se;si=u,(se=s)&&!m?Mi(i,l,(l.subtreeFlags&8772)!==0):Di(i,l),si=p,se=m}break;case 30:break;default:Di(i,l)}}function a_(i){var s=i.alternate;s!==null&&(i.alternate=null,a_(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&ou(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Wt=null,Ve=!1;function ai(i,s,l){for(l=l.child;l!==null;)r_(i,s,l),l=l.sibling}function r_(i,s,l){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(Wa,l)}catch{}switch(l.tag){case 26:se||Bn(l,s),ai(i,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:se||Bn(l,s);var u=Wt,p=Ve;Pi(l.type)&&(Wt=l.stateNode,Ve=!1),ai(i,s,l),Br(l.stateNode),Wt=u,Ve=p;break;case 5:se||Bn(l,s);case 6:if(u=Wt,p=Ve,Wt=null,ai(i,s,l),Wt=u,Ve=p,Wt!==null)if(Ve)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(l.stateNode)}catch(m){jt(l,s,m)}else try{Wt.removeChild(l.stateNode)}catch(m){jt(l,s,m)}break;case 18:Wt!==null&&(Ve?(i=Wt,$_(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,l.stateNode),qr(i)):$_(Wt,l.stateNode));break;case 4:u=Wt,p=Ve,Wt=l.stateNode.containerInfo,Ve=!0,ai(i,s,l),Wt=u,Ve=p;break;case 0:case 11:case 14:case 15:se||Ri(2,l,s),se||Ri(4,l,s),ai(i,s,l);break;case 1:se||(Bn(l,s),u=l.stateNode,typeof u.componentWillUnmount=="function"&&Jm(l,s,u)),ai(i,s,l);break;case 21:ai(i,s,l);break;case 22:se=(u=se)||l.memoizedState!==null,ai(i,s,l),se=u;break;default:ai(i,s,l)}}function o_(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{qr(i)}catch(l){jt(s,s.return,l)}}function kS(i){switch(i.tag){case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new i_),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new i_),s;default:throw Error(n(435,i.tag))}}function Dh(i,s){var l=kS(i);s.forEach(function(u){var p=GS.bind(null,i,u);l.has(u)||(l.add(u),u.then(p,p))})}function sn(i,s){var l=s.deletions;if(l!==null)for(var u=0;u<l.length;u++){var p=l[u],m=i,v=s,E=v;t:for(;E!==null;){switch(E.tag){case 27:if(Pi(E.type)){Wt=E.stateNode,Ve=!1;break t}break;case 5:Wt=E.stateNode,Ve=!1;break t;case 3:case 4:Wt=E.stateNode.containerInfo,Ve=!0;break t}E=E.return}if(Wt===null)throw Error(n(160));r_(m,v,p),Wt=null,Ve=!1,m=p.alternate,m!==null&&(m.return=null),p.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)l_(s,i),s=s.sibling}var Tn=null;function l_(i,s){var l=i.alternate,u=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:sn(s,i),an(i),u&4&&(Ri(3,i,i.return),xr(3,i),Ri(5,i,i.return));break;case 1:sn(s,i),an(i),u&512&&(se||l===null||Bn(l,l.return)),u&64&&si&&(i=i.updateQueue,i!==null&&(u=i.callbacks,u!==null&&(l=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var p=Tn;if(sn(s,i),an(i),u&512&&(se||l===null||Bn(l,l.return)),u&4){var m=l!==null?l.memoizedState:null;if(u=i.memoizedState,l===null)if(u===null)if(i.stateNode===null){t:{u=i.type,l=i.memoizedProps,p=p.ownerDocument||p;e:switch(u){case"title":m=p.getElementsByTagName("title")[0],(!m||m[Za]||m[Oe]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=p.createElement(u),p.head.insertBefore(m,p.querySelector("head > title"))),Te(m,u,l),m[Oe]=i,me(m),u=m;break t;case"link":var v=ny("link","href",p).get(u+(l.href||""));if(v){for(var E=0;E<v.length;E++)if(m=v[E],m.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&m.getAttribute("rel")===(l.rel==null?null:l.rel)&&m.getAttribute("title")===(l.title==null?null:l.title)&&m.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){v.splice(E,1);break e}}m=p.createElement(u),Te(m,u,l),p.head.appendChild(m);break;case"meta":if(v=ny("meta","content",p).get(u+(l.content||""))){for(E=0;E<v.length;E++)if(m=v[E],m.getAttribute("content")===(l.content==null?null:""+l.content)&&m.getAttribute("name")===(l.name==null?null:l.name)&&m.getAttribute("property")===(l.property==null?null:l.property)&&m.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&m.getAttribute("charset")===(l.charSet==null?null:l.charSet)){v.splice(E,1);break e}}m=p.createElement(u),Te(m,u,l),p.head.appendChild(m);break;default:throw Error(n(468,u))}m[Oe]=i,me(m),u=m}i.stateNode=u}else iy(p,i.type,i.stateNode);else i.stateNode=ey(p,u,i.memoizedProps);else m!==u?(m===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):m.count--,u===null?iy(p,i.type,i.stateNode):ey(p,u,i.memoizedProps)):u===null&&i.stateNode!==null&&Ch(i,i.memoizedProps,l.memoizedProps)}break;case 27:sn(s,i),an(i),u&512&&(se||l===null||Bn(l,l.return)),l!==null&&u&4&&Ch(i,i.memoizedProps,l.memoizedProps);break;case 5:if(sn(s,i),an(i),u&512&&(se||l===null||Bn(l,l.return)),i.flags&32){p=i.stateNode;try{js(p,"")}catch(H){jt(i,i.return,H)}}u&4&&i.stateNode!=null&&(p=i.memoizedProps,Ch(i,p,l!==null?l.memoizedProps:p)),u&1024&&(Rh=!0);break;case 6:if(sn(s,i),an(i),u&4){if(i.stateNode===null)throw Error(n(162));u=i.memoizedProps,l=i.stateNode;try{l.nodeValue=u}catch(H){jt(i,i.return,H)}}break;case 3:if(jl=null,p=Tn,Tn=Ul(s.containerInfo),sn(s,i),Tn=p,an(i),u&4&&l!==null&&l.memoizedState.isDehydrated)try{qr(s.containerInfo)}catch(H){jt(i,i.return,H)}Rh&&(Rh=!1,c_(i));break;case 4:u=Tn,Tn=Ul(i.stateNode.containerInfo),sn(s,i),an(i),Tn=u;break;case 12:sn(s,i),an(i);break;case 13:sn(s,i),an(i),i.child.flags&8192&&i.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Ih=Ln()),u&4&&(u=i.updateQueue,u!==null&&(i.updateQueue=null,Dh(i,u)));break;case 22:p=i.memoizedState!==null;var x=l!==null&&l.memoizedState!==null,B=si,G=se;if(si=B||p,se=G||x,sn(s,i),se=G,si=B,an(i),u&8192)t:for(s=i.stateNode,s._visibility=p?s._visibility&-2:s._visibility|1,p&&(l===null||x||si||se||ps(i)),l=null,s=i;;){if(s.tag===5||s.tag===26){if(l===null){x=l=s;try{if(m=x.stateNode,p)v=m.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{E=x.stateNode;var Y=x.memoizedProps.style,F=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;E.style.display=F==null||typeof F=="boolean"?"":(""+F).trim()}}catch(H){jt(x,x.return,H)}}}else if(s.tag===6){if(l===null){x=s;try{x.stateNode.nodeValue=p?"":x.memoizedProps}catch(H){jt(x,x.return,H)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break t;for(;s.sibling===null;){if(s.return===null||s.return===i)break t;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}u&4&&(u=i.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,Dh(i,l))));break;case 19:sn(s,i),an(i),u&4&&(u=i.updateQueue,u!==null&&(i.updateQueue=null,Dh(i,u)));break;case 30:break;case 21:break;default:sn(s,i),an(i)}}function an(i){var s=i.flags;if(s&2){try{for(var l,u=i.return;u!==null;){if(e_(u)){l=u;break}u=u.return}if(l==null)throw Error(n(160));switch(l.tag){case 27:var p=l.stateNode,m=Th(i);Rl(i,m,p);break;case 5:var v=l.stateNode;l.flags&32&&(js(v,""),l.flags&=-33);var E=Th(i);Rl(i,E,v);break;case 3:case 4:var x=l.stateNode.containerInfo,B=Th(i);xh(i,B,x);break;default:throw Error(n(161))}}catch(G){jt(i,i.return,G)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function c_(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;c_(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function Di(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)s_(i,s.alternate,s),s=s.sibling}function ps(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:Ri(4,s,s.return),ps(s);break;case 1:Bn(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&Jm(s,s.return,l),ps(s);break;case 27:Br(s.stateNode);case 26:case 5:Bn(s,s.return),ps(s);break;case 22:s.memoizedState===null&&ps(s);break;case 30:ps(s);break;default:ps(s)}i=i.sibling}}function Mi(i,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var u=s.alternate,p=i,m=s,v=m.flags;switch(m.tag){case 0:case 11:case 15:Mi(p,m,l),xr(4,m);break;case 1:if(Mi(p,m,l),u=m,p=u.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(B){jt(u,u.return,B)}if(u=m,p=u.updateQueue,p!==null){var E=u.stateNode;try{var x=p.shared.hiddenCallbacks;if(x!==null)for(p.shared.hiddenCallbacks=null,p=0;p<x.length;p++)Fg(x[p],E)}catch(B){jt(u,u.return,B)}}l&&v&64&&Zm(m),Rr(m,m.return);break;case 27:n_(m);case 26:case 5:Mi(p,m,l),l&&u===null&&v&4&&t_(m),Rr(m,m.return);break;case 12:Mi(p,m,l);break;case 13:Mi(p,m,l),l&&v&4&&o_(p,m);break;case 22:m.memoizedState===null&&Mi(p,m,l),Rr(m,m.return);break;case 30:break;default:Mi(p,m,l)}s=s.sibling}}function Mh(i,s){var l=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==l&&(i!=null&&i.refCount++,l!=null&&fr(l))}function Nh(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&fr(i))}function Fn(i,s,l,u){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)u_(i,s,l,u),s=s.sibling}function u_(i,s,l,u){var p=s.flags;switch(s.tag){case 0:case 11:case 15:Fn(i,s,l,u),p&2048&&xr(9,s);break;case 1:Fn(i,s,l,u);break;case 3:Fn(i,s,l,u),p&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&fr(i)));break;case 12:if(p&2048){Fn(i,s,l,u),i=s.stateNode;try{var m=s.memoizedProps,v=m.id,E=m.onPostCommit;typeof E=="function"&&E(v,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(x){jt(s,s.return,x)}}else Fn(i,s,l,u);break;case 13:Fn(i,s,l,u);break;case 23:break;case 22:m=s.stateNode,v=s.alternate,s.memoizedState!==null?m._visibility&2?Fn(i,s,l,u):Dr(i,s):m._visibility&2?Fn(i,s,l,u):(m._visibility|=2,la(i,s,l,u,(s.subtreeFlags&10256)!==0)),p&2048&&Mh(v,s);break;case 24:Fn(i,s,l,u),p&2048&&Nh(s.alternate,s);break;default:Fn(i,s,l,u)}}function la(i,s,l,u,p){for(p=p&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var m=i,v=s,E=l,x=u,B=v.flags;switch(v.tag){case 0:case 11:case 15:la(m,v,E,x,p),xr(8,v);break;case 23:break;case 22:var G=v.stateNode;v.memoizedState!==null?G._visibility&2?la(m,v,E,x,p):Dr(m,v):(G._visibility|=2,la(m,v,E,x,p)),p&&B&2048&&Mh(v.alternate,v);break;case 24:la(m,v,E,x,p),p&&B&2048&&Nh(v.alternate,v);break;default:la(m,v,E,x,p)}s=s.sibling}}function Dr(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=i,u=s,p=u.flags;switch(u.tag){case 22:Dr(l,u),p&2048&&Mh(u.alternate,u);break;case 24:Dr(l,u),p&2048&&Nh(u.alternate,u);break;default:Dr(l,u)}s=s.sibling}}var Mr=8192;function ca(i){if(i.subtreeFlags&Mr)for(i=i.child;i!==null;)h_(i),i=i.sibling}function h_(i){switch(i.tag){case 26:ca(i),i.flags&Mr&&i.memoizedState!==null&&yE(Tn,i.memoizedState,i.memoizedProps);break;case 5:ca(i);break;case 3:case 4:var s=Tn;Tn=Ul(i.stateNode.containerInfo),ca(i),Tn=s;break;case 22:i.memoizedState===null&&(s=i.alternate,s!==null&&s.memoizedState!==null?(s=Mr,Mr=16777216,ca(i),Mr=s):ca(i));break;default:ca(i)}}function d_(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function Nr(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];ye=u,p_(u,i)}d_(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)f_(i),i=i.sibling}function f_(i){switch(i.tag){case 0:case 11:case 15:Nr(i),i.flags&2048&&Ri(9,i,i.return);break;case 3:Nr(i);break;case 12:Nr(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,Dl(i)):Nr(i);break;default:Nr(i)}}function Dl(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];ye=u,p_(u,i)}d_(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:Ri(8,s,s.return),Dl(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,Dl(s));break;default:Dl(s)}i=i.sibling}}function p_(i,s){for(;ye!==null;){var l=ye;switch(l.tag){case 0:case 11:case 15:Ri(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:fr(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,ye=u;else t:for(l=i;ye!==null;){u=ye;var p=u.sibling,m=u.return;if(a_(u),u===l){ye=null;break t}if(p!==null){p.return=m,ye=p;break t}ye=m}}}var LS={getCacheForType:function(i){var s=ke(fe),l=s.data.get(i);return l===void 0&&(l=i(),s.data.set(i,l)),l}},IS=typeof WeakMap=="function"?WeakMap:Map,Bt=0,qt=null,xt=null,Ot=0,Ft=0,rn=null,Ni=!1,ua=!1,Oh=!1,ri=0,ee=0,Oi=0,gs=0,kh=0,yn=0,ha=0,Or=null,qe=null,Lh=!1,Ih=0,Ml=1/0,Nl=null,ki=null,Ce=0,Li=null,da=null,fa=0,Ph=0,Bh=null,g_=null,kr=0,Fh=null;function on(){if((Bt&2)!==0&&Ot!==0)return Ot&-Ot;if(I.T!==null){var i=ta;return i!==0?i:qh()}return Np()}function m_(){yn===0&&(yn=(Ot&536870912)===0||Lt?xp():536870912);var i=_n.current;return i!==null&&(i.flags|=32),yn}function ln(i,s,l){(i===qt&&(Ft===2||Ft===9)||i.cancelPendingCommit!==null)&&(pa(i,0),Ii(i,Ot,yn,!1)),Qa(i,l),((Bt&2)===0||i!==qt)&&(i===qt&&((Bt&2)===0&&(gs|=l),ee===4&&Ii(i,Ot,yn,!1)),Hn(i))}function __(i,s,l){if((Bt&6)!==0)throw Error(n(327));var u=!l&&(s&124)===0&&(s&i.expiredLanes)===0||Ka(i,s),p=u?FS(i,s):Uh(i,s,!0),m=u;do{if(p===0){ua&&!u&&Ii(i,s,0,!1);break}else{if(l=i.current.alternate,m&&!PS(l)){p=Uh(i,s,!1),m=!1;continue}if(p===2){if(m=s,i.errorRecoveryDisabledLanes&m)var v=0;else v=i.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){s=v;t:{var E=i;p=Or;var x=E.current.memoizedState.isDehydrated;if(x&&(pa(E,v).flags|=256),v=Uh(E,v,!1),v!==2){if(Oh&&!x){E.errorRecoveryDisabledLanes|=m,gs|=m,p=4;break t}m=qe,qe=p,m!==null&&(qe===null?qe=m:qe.push.apply(qe,m))}p=v}if(m=!1,p!==2)continue}}if(p===1){pa(i,0),Ii(i,s,0,!0);break}t:{switch(u=i,m=p,m){case 0:case 1:throw Error(n(345));case 4:if((s&4194048)!==s)break;case 6:Ii(u,s,yn,!Ni);break t;case 2:qe=null;break;case 3:case 5:break;default:throw Error(n(329))}if((s&62914560)===s&&(p=Ih+300-Ln(),10<p)){if(Ii(u,s,yn,!Ni),Go(u,0,!0)!==0)break t;u.timeoutHandle=Y_(y_.bind(null,u,l,qe,Nl,Lh,s,yn,gs,ha,Ni,m,2,-0,0),p);break t}y_(u,l,qe,Nl,Lh,s,yn,gs,ha,Ni,m,0,-0,0)}}break}while(!0);Hn(i)}function y_(i,s,l,u,p,m,v,E,x,B,G,Y,F,H){if(i.timeoutHandle=-1,Y=s.subtreeFlags,(Y&8192||(Y&16785408)===16785408)&&(zr={stylesheets:null,count:0,unsuspend:_E},h_(s),Y=bE(),Y!==null)){i.cancelPendingCommit=Y(C_.bind(null,i,s,m,l,u,p,v,E,x,G,1,F,H)),Ii(i,m,v,!B);return}C_(i,s,m,l,u,p,v,E,x)}function PS(i){for(var s=i;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var p=l[u],m=p.getSnapshot;p=p.value;try{if(!en(m(),p))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ii(i,s,l,u){s&=~kh,s&=~gs,i.suspendedLanes|=s,i.pingedLanes&=~s,u&&(i.warmLanes|=s),u=i.expirationTimes;for(var p=s;0<p;){var m=31-tn(p),v=1<<m;u[m]=-1,p&=~v}l!==0&&Dp(i,l,s)}function Ol(){return(Bt&6)===0?(Lr(0),!1):!0}function Hh(){if(xt!==null){if(Ft===0)var i=xt.return;else i=xt,Zn=cs=null,nh(i),ra=null,wr=0,i=xt;for(;i!==null;)Qm(i.alternate,i),i=i.return;xt=null}}function pa(i,s){var l=i.timeoutHandle;l!==-1&&(i.timeoutHandle=-1,tE(l)),l=i.cancelPendingCommit,l!==null&&(i.cancelPendingCommit=null,l()),Hh(),qt=i,xt=l=Wn(i.current,null),Ot=s,Ft=0,rn=null,Ni=!1,ua=Ka(i,s),Oh=!1,ha=yn=kh=gs=Oi=ee=0,qe=Or=null,Lh=!1,(s&8)!==0&&(s|=s&32);var u=i.entangledLanes;if(u!==0)for(i=i.entanglements,u&=s;0<u;){var p=31-tn(u),m=1<<p;s|=i[p],u&=~m}return ri=s,tl(),l}function b_(i,s){vt=null,I.H=bl,s===gr||s===cl?(s=Pg(),Ft=3):s===kg?(s=Pg(),Ft=4):Ft=s===Bm?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,rn=s,xt===null&&(ee=1,wl(i,fn(s,i.current)))}function v_(){var i=I.H;return I.H=bl,i===null?bl:i}function A_(){var i=I.A;return I.A=LS,i}function zh(){ee=4,Ni||(Ot&4194048)!==Ot&&_n.current!==null||(ua=!0),(Oi&134217727)===0&&(gs&134217727)===0||qt===null||Ii(qt,Ot,yn,!1)}function Uh(i,s,l){var u=Bt;Bt|=2;var p=v_(),m=A_();(qt!==i||Ot!==s)&&(Nl=null,pa(i,s)),s=!1;var v=ee;t:do try{if(Ft!==0&&xt!==null){var E=xt,x=rn;switch(Ft){case 8:Hh(),v=6;break t;case 3:case 2:case 9:case 6:_n.current===null&&(s=!0);var B=Ft;if(Ft=0,rn=null,ga(i,E,x,B),l&&ua){v=0;break t}break;default:B=Ft,Ft=0,rn=null,ga(i,E,x,B)}}BS(),v=ee;break}catch(G){b_(i,G)}while(!0);return s&&i.shellSuspendCounter++,Zn=cs=null,Bt=u,I.H=p,I.A=m,xt===null&&(qt=null,Ot=0,tl()),v}function BS(){for(;xt!==null;)S_(xt)}function FS(i,s){var l=Bt;Bt|=2;var u=v_(),p=A_();qt!==i||Ot!==s?(Nl=null,Ml=Ln()+500,pa(i,s)):ua=Ka(i,s);t:do try{if(Ft!==0&&xt!==null){s=xt;var m=rn;e:switch(Ft){case 1:Ft=0,rn=null,ga(i,s,m,1);break;case 2:case 9:if(Lg(m)){Ft=0,rn=null,E_(s);break}s=function(){Ft!==2&&Ft!==9||qt!==i||(Ft=7),Hn(i)},m.then(s,s);break t;case 3:Ft=7;break t;case 4:Ft=5;break t;case 7:Lg(m)?(Ft=0,rn=null,E_(s)):(Ft=0,rn=null,ga(i,s,m,7));break;case 5:var v=null;switch(xt.tag){case 26:v=xt.memoizedState;case 5:case 27:var E=xt;if(!v||sy(v)){Ft=0,rn=null;var x=E.sibling;if(x!==null)xt=x;else{var B=E.return;B!==null?(xt=B,kl(B)):xt=null}break e}}Ft=0,rn=null,ga(i,s,m,5);break;case 6:Ft=0,rn=null,ga(i,s,m,6);break;case 8:Hh(),ee=6;break t;default:throw Error(n(462))}}HS();break}catch(G){b_(i,G)}while(!0);return Zn=cs=null,I.H=u,I.A=p,Bt=l,xt!==null?0:(qt=null,Ot=0,tl(),ee)}function HS(){for(;xt!==null&&!oA();)S_(xt)}function S_(i){var s=Wm(i.alternate,i,ri);i.memoizedProps=i.pendingProps,s===null?kl(i):xt=s}function E_(i){var s=i,l=s.alternate;switch(s.tag){case 15:case 0:s=jm(l,s,s.pendingProps,s.type,void 0,Ot);break;case 11:s=jm(l,s,s.pendingProps,s.type.render,s.ref,Ot);break;case 5:nh(s);default:Qm(l,s),s=xt=wg(s,ri),s=Wm(l,s,ri)}i.memoizedProps=i.pendingProps,s===null?kl(i):xt=s}function ga(i,s,l,u){Zn=cs=null,nh(s),ra=null,wr=0;var p=s.return;try{if(RS(i,p,s,l,Ot)){ee=1,wl(i,fn(l,i.current)),xt=null;return}}catch(m){if(p!==null)throw xt=p,m;ee=1,wl(i,fn(l,i.current)),xt=null;return}s.flags&32768?(Lt||u===1?i=!0:ua||(Ot&536870912)!==0?i=!1:(Ni=i=!0,(u===2||u===9||u===3||u===6)&&(u=_n.current,u!==null&&u.tag===13&&(u.flags|=16384))),w_(s,i)):kl(s)}function kl(i){var s=i;do{if((s.flags&32768)!==0){w_(s,Ni);return}i=s.return;var l=MS(s.alternate,s,ri);if(l!==null){xt=l;return}if(s=s.sibling,s!==null){xt=s;return}xt=s=i}while(s!==null);ee===0&&(ee=5)}function w_(i,s){do{var l=NS(i.alternate,i);if(l!==null){l.flags&=32767,xt=l;return}if(l=i.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(i=i.sibling,i!==null)){xt=i;return}xt=i=l}while(i!==null);ee=6,xt=null}function C_(i,s,l,u,p,m,v,E,x){i.cancelPendingCommit=null;do Ll();while(Ce!==0);if((Bt&6)!==0)throw Error(n(327));if(s!==null){if(s===i.current)throw Error(n(177));if(m=s.lanes|s.childLanes,m|=Nu,_A(i,l,m,v,E,x),i===qt&&(xt=qt=null,Ot=0),da=s,Li=i,fa=l,Ph=m,Bh=p,g_=u,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,jS(Ho,function(){return M_(),null})):(i.callbackNode=null,i.callbackPriority=0),u=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||u){u=I.T,I.T=null,p=U.p,U.p=2,v=Bt,Bt|=4;try{OS(i,s,l)}finally{Bt=v,U.p=p,I.T=u}}Ce=1,T_(),x_(),R_()}}function T_(){if(Ce===1){Ce=0;var i=Li,s=da,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=I.T,I.T=null;var u=U.p;U.p=2;var p=Bt;Bt|=4;try{l_(s,i);var m=Jh,v=pg(i.containerInfo),E=m.focusedElem,x=m.selectionRange;if(v!==E&&E&&E.ownerDocument&&fg(E.ownerDocument.documentElement,E)){if(x!==null&&Tu(E)){var B=x.start,G=x.end;if(G===void 0&&(G=B),"selectionStart"in E)E.selectionStart=B,E.selectionEnd=Math.min(G,E.value.length);else{var Y=E.ownerDocument||document,F=Y&&Y.defaultView||window;if(F.getSelection){var H=F.getSelection(),ht=E.textContent.length,ot=Math.min(x.start,ht),Ut=x.end===void 0?ot:Math.min(x.end,ht);!H.extend&&ot>Ut&&(v=Ut,Ut=ot,ot=v);var L=dg(E,ot),O=dg(E,Ut);if(L&&O&&(H.rangeCount!==1||H.anchorNode!==L.node||H.anchorOffset!==L.offset||H.focusNode!==O.node||H.focusOffset!==O.offset)){var P=Y.createRange();P.setStart(L.node,L.offset),H.removeAllRanges(),ot>Ut?(H.addRange(P),H.extend(O.node,O.offset)):(P.setEnd(O.node,O.offset),H.addRange(P))}}}}for(Y=[],H=E;H=H.parentNode;)H.nodeType===1&&Y.push({element:H,left:H.scrollLeft,top:H.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<Y.length;E++){var V=Y[E];V.element.scrollLeft=V.left,V.element.scrollTop=V.top}}Yl=!!Zh,Jh=Zh=null}finally{Bt=p,U.p=u,I.T=l}}i.current=s,Ce=2}}function x_(){if(Ce===2){Ce=0;var i=Li,s=da,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=I.T,I.T=null;var u=U.p;U.p=2;var p=Bt;Bt|=4;try{s_(i,s.alternate,s)}finally{Bt=p,U.p=u,I.T=l}}Ce=3}}function R_(){if(Ce===4||Ce===3){Ce=0,lA();var i=Li,s=da,l=fa,u=g_;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Ce=5:(Ce=0,da=Li=null,D_(i,i.pendingLanes));var p=i.pendingLanes;if(p===0&&(ki=null),au(l),s=s.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(Wa,s,void 0,(s.current.flags&128)===128)}catch{}if(u!==null){s=I.T,p=U.p,U.p=2,I.T=null;try{for(var m=i.onRecoverableError,v=0;v<u.length;v++){var E=u[v];m(E.value,{componentStack:E.stack})}}finally{I.T=s,U.p=p}}(fa&3)!==0&&Ll(),Hn(i),p=i.pendingLanes,(l&4194090)!==0&&(p&42)!==0?i===Fh?kr++:(kr=0,Fh=i):kr=0,Lr(0)}}function D_(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,fr(s)))}function Ll(i){return T_(),x_(),R_(),M_()}function M_(){if(Ce!==5)return!1;var i=Li,s=Ph;Ph=0;var l=au(fa),u=I.T,p=U.p;try{U.p=32>l?32:l,I.T=null,l=Bh,Bh=null;var m=Li,v=fa;if(Ce=0,da=Li=null,fa=0,(Bt&6)!==0)throw Error(n(331));var E=Bt;if(Bt|=4,f_(m.current),u_(m,m.current,v,l),Bt=E,Lr(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(Wa,m)}catch{}return!0}finally{U.p=p,I.T=u,D_(i,s)}}function N_(i,s,l){s=fn(l,s),s=mh(i.stateNode,s,2),i=wi(i,s,2),i!==null&&(Qa(i,2),Hn(i))}function jt(i,s,l){if(i.tag===3)N_(i,i,l);else for(;s!==null;){if(s.tag===3){N_(s,i,l);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(ki===null||!ki.has(u))){i=fn(l,i),l=Im(2),u=wi(s,l,2),u!==null&&(Pm(l,u,s,i),Qa(u,2),Hn(u));break}}s=s.return}}function Gh(i,s,l){var u=i.pingCache;if(u===null){u=i.pingCache=new IS;var p=new Set;u.set(s,p)}else p=u.get(s),p===void 0&&(p=new Set,u.set(s,p));p.has(l)||(Oh=!0,p.add(l),i=zS.bind(null,i,s,l),s.then(i,i))}function zS(i,s,l){var u=i.pingCache;u!==null&&u.delete(s),i.pingedLanes|=i.suspendedLanes&l,i.warmLanes&=~l,qt===i&&(Ot&l)===l&&(ee===4||ee===3&&(Ot&62914560)===Ot&&300>Ln()-Ih?(Bt&2)===0&&pa(i,0):kh|=l,ha===Ot&&(ha=0)),Hn(i)}function O_(i,s){s===0&&(s=Rp()),i=Ks(i,s),i!==null&&(Qa(i,s),Hn(i))}function US(i){var s=i.memoizedState,l=0;s!==null&&(l=s.retryLane),O_(i,l)}function GS(i,s){var l=0;switch(i.tag){case 13:var u=i.stateNode,p=i.memoizedState;p!==null&&(l=p.retryLane);break;case 19:u=i.stateNode;break;case 22:u=i.stateNode._retryCache;break;default:throw Error(n(314))}u!==null&&u.delete(s),O_(i,l)}function jS(i,s){return Is(i,s)}var Il=null,ma=null,jh=!1,Pl=!1,Vh=!1,ms=0;function Hn(i){i!==ma&&i.next===null&&(ma===null?Il=ma=i:ma=ma.next=i),Pl=!0,jh||(jh=!0,qS())}function Lr(i,s){if(!Vh&&Pl){Vh=!0;do for(var l=!1,u=Il;u!==null;){if(i!==0){var p=u.pendingLanes;if(p===0)var m=0;else{var v=u.suspendedLanes,E=u.pingedLanes;m=(1<<31-tn(42|i)+1)-1,m&=p&~(v&~E),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(l=!0,P_(u,m))}else m=Ot,m=Go(u,u===qt?m:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(m&3)===0||Ka(u,m)||(l=!0,P_(u,m));u=u.next}while(l);Vh=!1}}function VS(){k_()}function k_(){Pl=jh=!1;var i=0;ms!==0&&(JS()&&(i=ms),ms=0);for(var s=Ln(),l=null,u=Il;u!==null;){var p=u.next,m=L_(u,s);m===0?(u.next=null,l===null?Il=p:l.next=p,p===null&&(ma=l)):(l=u,(i!==0||(m&3)!==0)&&(Pl=!0)),u=p}Lr(i)}function L_(i,s){for(var l=i.suspendedLanes,u=i.pingedLanes,p=i.expirationTimes,m=i.pendingLanes&-62914561;0<m;){var v=31-tn(m),E=1<<v,x=p[v];x===-1?((E&l)===0||(E&u)!==0)&&(p[v]=mA(E,s)):x<=s&&(i.expiredLanes|=E),m&=~E}if(s=qt,l=Ot,l=Go(i,i===s?l:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),u=i.callbackNode,l===0||i===s&&(Ft===2||Ft===9)||i.cancelPendingCommit!==null)return u!==null&&u!==null&&$a(u),i.callbackNode=null,i.callbackPriority=0;if((l&3)===0||Ka(i,l)){if(s=l&-l,s===i.callbackPriority)return s;switch(u!==null&&$a(u),au(l)){case 2:case 8:l=Cp;break;case 32:l=Ho;break;case 268435456:l=Tp;break;default:l=Ho}return u=I_.bind(null,i),l=Is(l,u),i.callbackPriority=s,i.callbackNode=l,s}return u!==null&&u!==null&&$a(u),i.callbackPriority=2,i.callbackNode=null,2}function I_(i,s){if(Ce!==0&&Ce!==5)return i.callbackNode=null,i.callbackPriority=0,null;var l=i.callbackNode;if(Ll()&&i.callbackNode!==l)return null;var u=Ot;return u=Go(i,i===qt?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),u===0?null:(__(i,u,s),L_(i,Ln()),i.callbackNode!=null&&i.callbackNode===l?I_.bind(null,i):null)}function P_(i,s){if(Ll())return null;__(i,s,!0)}function qS(){eE(function(){(Bt&6)!==0?Is(wp,VS):k_()})}function qh(){return ms===0&&(ms=xp()),ms}function B_(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Xo(""+i)}function F_(i,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,i.id&&l.setAttribute("form",i.id),s.parentNode.insertBefore(l,s),i=new FormData(i),l.parentNode.removeChild(l),i}function YS(i,s,l,u,p){if(s==="submit"&&l&&l.stateNode===p){var m=B_((p[Ue]||null).action),v=u.submitter;v&&(s=(s=v[Ue]||null)?B_(s.formAction):v.getAttribute("formAction"),s!==null&&(m=s,v=null));var E=new Qo("action","action",null,u,p);i.push({event:E,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(ms!==0){var x=v?F_(p,v):new FormData(p);hh(l,{pending:!0,data:x,method:p.method,action:m},null,x)}}else typeof m=="function"&&(E.preventDefault(),x=v?F_(p,v):new FormData(p),hh(l,{pending:!0,data:x,method:p.method,action:m},m,x))},currentTarget:p}]})}}for(var Yh=0;Yh<Mu.length;Yh++){var Xh=Mu[Yh],XS=Xh.toLowerCase(),$S=Xh[0].toUpperCase()+Xh.slice(1);Cn(XS,"on"+$S)}Cn(_g,"onAnimationEnd"),Cn(yg,"onAnimationIteration"),Cn(bg,"onAnimationStart"),Cn("dblclick","onDoubleClick"),Cn("focusin","onFocus"),Cn("focusout","onBlur"),Cn(hS,"onTransitionRun"),Cn(dS,"onTransitionStart"),Cn(fS,"onTransitionCancel"),Cn(vg,"onTransitionEnd"),zs("onMouseEnter",["mouseout","mouseover"]),zs("onMouseLeave",["mouseout","mouseover"]),zs("onPointerEnter",["pointerout","pointerover"]),zs("onPointerLeave",["pointerout","pointerover"]),ts("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ts("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ts("onBeforeInput",["compositionend","keypress","textInput","paste"]),ts("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ts("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ts("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ir="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ir));function H_(i,s){s=(s&4)!==0;for(var l=0;l<i.length;l++){var u=i[l],p=u.event;u=u.listeners;t:{var m=void 0;if(s)for(var v=u.length-1;0<=v;v--){var E=u[v],x=E.instance,B=E.currentTarget;if(E=E.listener,x!==m&&p.isPropagationStopped())break t;m=E,p.currentTarget=B;try{m(p)}catch(G){El(G)}p.currentTarget=null,m=x}else for(v=0;v<u.length;v++){if(E=u[v],x=E.instance,B=E.currentTarget,E=E.listener,x!==m&&p.isPropagationStopped())break t;m=E,p.currentTarget=B;try{m(p)}catch(G){El(G)}p.currentTarget=null,m=x}}}}function Rt(i,s){var l=s[ru];l===void 0&&(l=s[ru]=new Set);var u=i+"__bubble";l.has(u)||(z_(s,i,2,!1),l.add(u))}function $h(i,s,l){var u=0;s&&(u|=4),z_(l,i,u,s)}var Bl="_reactListening"+Math.random().toString(36).slice(2);function Wh(i){if(!i[Bl]){i[Bl]=!0,kp.forEach(function(l){l!=="selectionchange"&&(WS.has(l)||$h(l,!1,i),$h(l,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[Bl]||(s[Bl]=!0,$h("selectionchange",!1,s))}}function z_(i,s,l,u){switch(uy(s)){case 2:var p=SE;break;case 8:p=EE;break;default:p=cd}l=p.bind(null,s,l,i),p=void 0,!_u||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),u?p!==void 0?i.addEventListener(s,l,{capture:!0,passive:p}):i.addEventListener(s,l,!0):p!==void 0?i.addEventListener(s,l,{passive:p}):i.addEventListener(s,l,!1)}function Kh(i,s,l,u,p){var m=u;if((s&1)===0&&(s&2)===0&&u!==null)t:for(;;){if(u===null)return;var v=u.tag;if(v===3||v===4){var E=u.stateNode.containerInfo;if(E===p)break;if(v===4)for(v=u.return;v!==null;){var x=v.tag;if((x===3||x===4)&&v.stateNode.containerInfo===p)return;v=v.return}for(;E!==null;){if(v=Bs(E),v===null)return;if(x=v.tag,x===5||x===6||x===26||x===27){u=m=v;continue t}E=E.parentNode}}u=u.return}Xp(function(){var B=m,G=gu(l),Y=[];t:{var F=Ag.get(i);if(F!==void 0){var H=Qo,ht=i;switch(i){case"keypress":if(Wo(l)===0)break t;case"keydown":case"keyup":H=jA;break;case"focusin":ht="focus",H=Au;break;case"focusout":ht="blur",H=Au;break;case"beforeblur":case"afterblur":H=Au;break;case"click":if(l.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=Kp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=NA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=YA;break;case _g:case yg:case bg:H=LA;break;case vg:H=$A;break;case"scroll":case"scrollend":H=DA;break;case"wheel":H=KA;break;case"copy":case"cut":case"paste":H=PA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=Zp;break;case"toggle":case"beforetoggle":H=ZA}var ot=(s&4)!==0,Ut=!ot&&(i==="scroll"||i==="scrollend"),L=ot?F!==null?F+"Capture":null:F;ot=[];for(var O=B,P;O!==null;){var V=O;if(P=V.stateNode,V=V.tag,V!==5&&V!==26&&V!==27||P===null||L===null||(V=tr(O,L),V!=null&&ot.push(Pr(O,V,P))),Ut)break;O=O.return}0<ot.length&&(F=new H(F,ht,null,l,G),Y.push({event:F,listeners:ot}))}}if((s&7)===0){t:{if(F=i==="mouseover"||i==="pointerover",H=i==="mouseout"||i==="pointerout",F&&l!==pu&&(ht=l.relatedTarget||l.fromElement)&&(Bs(ht)||ht[Ps]))break t;if((H||F)&&(F=G.window===G?G:(F=G.ownerDocument)?F.defaultView||F.parentWindow:window,H?(ht=l.relatedTarget||l.toElement,H=B,ht=ht?Bs(ht):null,ht!==null&&(Ut=o(ht),ot=ht.tag,ht!==Ut||ot!==5&&ot!==27&&ot!==6)&&(ht=null)):(H=null,ht=B),H!==ht)){if(ot=Kp,V="onMouseLeave",L="onMouseEnter",O="mouse",(i==="pointerout"||i==="pointerover")&&(ot=Zp,V="onPointerLeave",L="onPointerEnter",O="pointer"),Ut=H==null?F:Ja(H),P=ht==null?F:Ja(ht),F=new ot(V,O+"leave",H,l,G),F.target=Ut,F.relatedTarget=P,V=null,Bs(G)===B&&(ot=new ot(L,O+"enter",ht,l,G),ot.target=P,ot.relatedTarget=Ut,V=ot),Ut=V,H&&ht)e:{for(ot=H,L=ht,O=0,P=ot;P;P=_a(P))O++;for(P=0,V=L;V;V=_a(V))P++;for(;0<O-P;)ot=_a(ot),O--;for(;0<P-O;)L=_a(L),P--;for(;O--;){if(ot===L||L!==null&&ot===L.alternate)break e;ot=_a(ot),L=_a(L)}ot=null}else ot=null;H!==null&&U_(Y,F,H,ot,!1),ht!==null&&Ut!==null&&U_(Y,Ut,ht,ot,!0)}}t:{if(F=B?Ja(B):window,H=F.nodeName&&F.nodeName.toLowerCase(),H==="select"||H==="input"&&F.type==="file")var et=rg;else if(sg(F))if(og)et=lS;else{et=rS;var St=aS}else H=F.nodeName,!H||H.toLowerCase()!=="input"||F.type!=="checkbox"&&F.type!=="radio"?B&&fu(B.elementType)&&(et=rg):et=oS;if(et&&(et=et(i,B))){ag(Y,et,l,G);break t}St&&St(i,F,B),i==="focusout"&&B&&F.type==="number"&&B.memoizedProps.value!=null&&du(F,"number",F.value)}switch(St=B?Ja(B):window,i){case"focusin":(sg(St)||St.contentEditable==="true")&&(Xs=St,xu=B,lr=null);break;case"focusout":lr=xu=Xs=null;break;case"mousedown":Ru=!0;break;case"contextmenu":case"mouseup":case"dragend":Ru=!1,gg(Y,l,G);break;case"selectionchange":if(uS)break;case"keydown":case"keyup":gg(Y,l,G)}var st;if(Eu)t:{switch(i){case"compositionstart":var ct="onCompositionStart";break t;case"compositionend":ct="onCompositionEnd";break t;case"compositionupdate":ct="onCompositionUpdate";break t}ct=void 0}else Ys?ng(i,l)&&(ct="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(ct="onCompositionStart");ct&&(Jp&&l.locale!=="ko"&&(Ys||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&Ys&&(st=$p()):(vi=G,yu="value"in vi?vi.value:vi.textContent,Ys=!0)),St=Fl(B,ct),0<St.length&&(ct=new Qp(ct,i,null,l,G),Y.push({event:ct,listeners:St}),st?ct.data=st:(st=ig(l),st!==null&&(ct.data=st)))),(st=tS?eS(i,l):nS(i,l))&&(ct=Fl(B,"onBeforeInput"),0<ct.length&&(St=new Qp("onBeforeInput","beforeinput",null,l,G),Y.push({event:St,listeners:ct}),St.data=st)),YS(Y,i,B,l,G)}H_(Y,s)})}function Pr(i,s,l){return{instance:i,listener:s,currentTarget:l}}function Fl(i,s){for(var l=s+"Capture",u=[];i!==null;){var p=i,m=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||m===null||(p=tr(i,l),p!=null&&u.unshift(Pr(i,p,m)),p=tr(i,s),p!=null&&u.push(Pr(i,p,m))),i.tag===3)return u;i=i.return}return[]}function _a(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function U_(i,s,l,u,p){for(var m=s._reactName,v=[];l!==null&&l!==u;){var E=l,x=E.alternate,B=E.stateNode;if(E=E.tag,x!==null&&x===u)break;E!==5&&E!==26&&E!==27||B===null||(x=B,p?(B=tr(l,m),B!=null&&v.unshift(Pr(l,B,x))):p||(B=tr(l,m),B!=null&&v.push(Pr(l,B,x)))),l=l.return}v.length!==0&&i.push({event:s,listeners:v})}var KS=/\r\n?/g,QS=/\u0000|\uFFFD/g;function G_(i){return(typeof i=="string"?i:""+i).replace(KS,`
`).replace(QS,"")}function j_(i,s){return s=G_(s),G_(i)===s}function Hl(){}function zt(i,s,l,u,p,m){switch(l){case"children":typeof u=="string"?s==="body"||s==="textarea"&&u===""||js(i,u):(typeof u=="number"||typeof u=="bigint")&&s!=="body"&&js(i,""+u);break;case"className":Vo(i,"class",u);break;case"tabIndex":Vo(i,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":Vo(i,l,u);break;case"style":qp(i,u,m);break;case"data":if(s!=="object"){Vo(i,"data",u);break}case"src":case"href":if(u===""&&(s!=="a"||l!=="href")){i.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){i.removeAttribute(l);break}u=Xo(""+u),i.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){i.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(l==="formAction"?(s!=="input"&&zt(i,s,"name",p.name,p,null),zt(i,s,"formEncType",p.formEncType,p,null),zt(i,s,"formMethod",p.formMethod,p,null),zt(i,s,"formTarget",p.formTarget,p,null)):(zt(i,s,"encType",p.encType,p,null),zt(i,s,"method",p.method,p,null),zt(i,s,"target",p.target,p,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){i.removeAttribute(l);break}u=Xo(""+u),i.setAttribute(l,u);break;case"onClick":u!=null&&(i.onclick=Hl);break;case"onScroll":u!=null&&Rt("scroll",i);break;case"onScrollEnd":u!=null&&Rt("scrollend",i);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(n(60));i.innerHTML=l}}break;case"multiple":i.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":i.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){i.removeAttribute("xlink:href");break}l=Xo(""+u),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,""+u):i.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,""):i.removeAttribute(l);break;case"capture":case"download":u===!0?i.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,u):i.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?i.setAttribute(l,u):i.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?i.removeAttribute(l):i.setAttribute(l,u);break;case"popover":Rt("beforetoggle",i),Rt("toggle",i),jo(i,"popover",u);break;case"xlinkActuate":Xn(i,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Xn(i,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Xn(i,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Xn(i,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Xn(i,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Xn(i,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Xn(i,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Xn(i,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Xn(i,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":jo(i,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=xA.get(l)||l,jo(i,l,u))}}function Qh(i,s,l,u,p,m){switch(l){case"style":qp(i,u,m);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(n(60));i.innerHTML=l}}break;case"children":typeof u=="string"?js(i,u):(typeof u=="number"||typeof u=="bigint")&&js(i,""+u);break;case"onScroll":u!=null&&Rt("scroll",i);break;case"onScrollEnd":u!=null&&Rt("scrollend",i);break;case"onClick":u!=null&&(i.onclick=Hl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Lp.hasOwnProperty(l))t:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),s=l.slice(2,p?l.length-7:void 0),m=i[Ue]||null,m=m!=null?m[l]:null,typeof m=="function"&&i.removeEventListener(s,m,p),typeof u=="function")){typeof m!="function"&&m!==null&&(l in i?i[l]=null:i.hasAttribute(l)&&i.removeAttribute(l)),i.addEventListener(s,u,p);break t}l in i?i[l]=u:u===!0?i.setAttribute(l,""):jo(i,l,u)}}}function Te(i,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Rt("error",i),Rt("load",i);var u=!1,p=!1,m;for(m in l)if(l.hasOwnProperty(m)){var v=l[m];if(v!=null)switch(m){case"src":u=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,s));default:zt(i,s,m,v,l,null)}}p&&zt(i,s,"srcSet",l.srcSet,l,null),u&&zt(i,s,"src",l.src,l,null);return;case"input":Rt("invalid",i);var E=m=v=p=null,x=null,B=null;for(u in l)if(l.hasOwnProperty(u)){var G=l[u];if(G!=null)switch(u){case"name":p=G;break;case"type":v=G;break;case"checked":x=G;break;case"defaultChecked":B=G;break;case"value":m=G;break;case"defaultValue":E=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(n(137,s));break;default:zt(i,s,u,G,l,null)}}Up(i,m,E,x,B,v,p,!1),qo(i);return;case"select":Rt("invalid",i),u=v=m=null;for(p in l)if(l.hasOwnProperty(p)&&(E=l[p],E!=null))switch(p){case"value":m=E;break;case"defaultValue":v=E;break;case"multiple":u=E;default:zt(i,s,p,E,l,null)}s=m,l=v,i.multiple=!!u,s!=null?Gs(i,!!u,s,!1):l!=null&&Gs(i,!!u,l,!0);return;case"textarea":Rt("invalid",i),m=p=u=null;for(v in l)if(l.hasOwnProperty(v)&&(E=l[v],E!=null))switch(v){case"value":u=E;break;case"defaultValue":p=E;break;case"children":m=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(n(91));break;default:zt(i,s,v,E,l,null)}jp(i,u,p,m),qo(i);return;case"option":for(x in l)if(l.hasOwnProperty(x)&&(u=l[x],u!=null))switch(x){case"selected":i.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:zt(i,s,x,u,l,null)}return;case"dialog":Rt("beforetoggle",i),Rt("toggle",i),Rt("cancel",i),Rt("close",i);break;case"iframe":case"object":Rt("load",i);break;case"video":case"audio":for(u=0;u<Ir.length;u++)Rt(Ir[u],i);break;case"image":Rt("error",i),Rt("load",i);break;case"details":Rt("toggle",i);break;case"embed":case"source":case"link":Rt("error",i),Rt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(B in l)if(l.hasOwnProperty(B)&&(u=l[B],u!=null))switch(B){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,s));default:zt(i,s,B,u,l,null)}return;default:if(fu(s)){for(G in l)l.hasOwnProperty(G)&&(u=l[G],u!==void 0&&Qh(i,s,G,u,l,void 0));return}}for(E in l)l.hasOwnProperty(E)&&(u=l[E],u!=null&&zt(i,s,E,u,l,null))}function ZS(i,s,l,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,m=null,v=null,E=null,x=null,B=null,G=null;for(H in l){var Y=l[H];if(l.hasOwnProperty(H)&&Y!=null)switch(H){case"checked":break;case"value":break;case"defaultValue":x=Y;default:u.hasOwnProperty(H)||zt(i,s,H,null,u,Y)}}for(var F in u){var H=u[F];if(Y=l[F],u.hasOwnProperty(F)&&(H!=null||Y!=null))switch(F){case"type":m=H;break;case"name":p=H;break;case"checked":B=H;break;case"defaultChecked":G=H;break;case"value":v=H;break;case"defaultValue":E=H;break;case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(n(137,s));break;default:H!==Y&&zt(i,s,F,H,u,Y)}}hu(i,v,E,x,B,G,m,p);return;case"select":H=v=E=F=null;for(m in l)if(x=l[m],l.hasOwnProperty(m)&&x!=null)switch(m){case"value":break;case"multiple":H=x;default:u.hasOwnProperty(m)||zt(i,s,m,null,u,x)}for(p in u)if(m=u[p],x=l[p],u.hasOwnProperty(p)&&(m!=null||x!=null))switch(p){case"value":F=m;break;case"defaultValue":E=m;break;case"multiple":v=m;default:m!==x&&zt(i,s,p,m,u,x)}s=E,l=v,u=H,F!=null?Gs(i,!!l,F,!1):!!u!=!!l&&(s!=null?Gs(i,!!l,s,!0):Gs(i,!!l,l?[]:"",!1));return;case"textarea":H=F=null;for(E in l)if(p=l[E],l.hasOwnProperty(E)&&p!=null&&!u.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:zt(i,s,E,null,u,p)}for(v in u)if(p=u[v],m=l[v],u.hasOwnProperty(v)&&(p!=null||m!=null))switch(v){case"value":F=p;break;case"defaultValue":H=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(n(91));break;default:p!==m&&zt(i,s,v,p,u,m)}Gp(i,F,H);return;case"option":for(var ht in l)if(F=l[ht],l.hasOwnProperty(ht)&&F!=null&&!u.hasOwnProperty(ht))switch(ht){case"selected":i.selected=!1;break;default:zt(i,s,ht,null,u,F)}for(x in u)if(F=u[x],H=l[x],u.hasOwnProperty(x)&&F!==H&&(F!=null||H!=null))switch(x){case"selected":i.selected=F&&typeof F!="function"&&typeof F!="symbol";break;default:zt(i,s,x,F,u,H)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ot in l)F=l[ot],l.hasOwnProperty(ot)&&F!=null&&!u.hasOwnProperty(ot)&&zt(i,s,ot,null,u,F);for(B in u)if(F=u[B],H=l[B],u.hasOwnProperty(B)&&F!==H&&(F!=null||H!=null))switch(B){case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(n(137,s));break;default:zt(i,s,B,F,u,H)}return;default:if(fu(s)){for(var Ut in l)F=l[Ut],l.hasOwnProperty(Ut)&&F!==void 0&&!u.hasOwnProperty(Ut)&&Qh(i,s,Ut,void 0,u,F);for(G in u)F=u[G],H=l[G],!u.hasOwnProperty(G)||F===H||F===void 0&&H===void 0||Qh(i,s,G,F,u,H);return}}for(var L in l)F=l[L],l.hasOwnProperty(L)&&F!=null&&!u.hasOwnProperty(L)&&zt(i,s,L,null,u,F);for(Y in u)F=u[Y],H=l[Y],!u.hasOwnProperty(Y)||F===H||F==null&&H==null||zt(i,s,Y,F,u,H)}var Zh=null,Jh=null;function zl(i){return i.nodeType===9?i:i.ownerDocument}function V_(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function q_(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function td(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var ed=null;function JS(){var i=window.event;return i&&i.type==="popstate"?i===ed?!1:(ed=i,!0):(ed=null,!1)}var Y_=typeof setTimeout=="function"?setTimeout:void 0,tE=typeof clearTimeout=="function"?clearTimeout:void 0,X_=typeof Promise=="function"?Promise:void 0,eE=typeof queueMicrotask=="function"?queueMicrotask:typeof X_<"u"?function(i){return X_.resolve(null).then(i).catch(nE)}:Y_;function nE(i){setTimeout(function(){throw i})}function Pi(i){return i==="head"}function $_(i,s){var l=s,u=0,p=0;do{var m=l.nextSibling;if(i.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"){if(0<u&&8>u){l=u;var v=i.ownerDocument;if(l&1&&Br(v.documentElement),l&2&&Br(v.body),l&4)for(l=v.head,Br(l),v=l.firstChild;v;){var E=v.nextSibling,x=v.nodeName;v[Za]||x==="SCRIPT"||x==="STYLE"||x==="LINK"&&v.rel.toLowerCase()==="stylesheet"||l.removeChild(v),v=E}}if(p===0){i.removeChild(m),qr(s);return}p--}else l==="$"||l==="$?"||l==="$!"?p++:u=l.charCodeAt(0)-48;else u=0;l=m}while(l);qr(s)}function nd(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":nd(l),ou(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}i.removeChild(l)}}function iE(i,s,l,u){for(;i.nodeType===1;){var p=l;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!u&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(u){if(!i[Za])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(m=i.getAttribute("rel"),m==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(m!==p.rel||i.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||i.getAttribute("title")!==(p.title==null?null:p.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(m=i.getAttribute("src"),(m!==(p.src==null?null:p.src)||i.getAttribute("type")!==(p.type==null?null:p.type)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&m&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var m=p.name==null?null:""+p.name;if(p.type==="hidden"&&i.getAttribute("name")===m)return i}else return i;if(i=xn(i.nextSibling),i===null)break}return null}function sE(i,s,l){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!l||(i=xn(i.nextSibling),i===null))return null;return i}function id(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function aE(i,s){var l=i.ownerDocument;if(i.data!=="$?"||l.readyState==="complete")s();else{var u=function(){s(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),i._reactRetry=u}}function xn(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return i}var sd=null;function W_(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return i;s--}else l==="/$"&&s++}i=i.previousSibling}return null}function K_(i,s,l){switch(s=zl(l),i){case"html":if(i=s.documentElement,!i)throw Error(n(452));return i;case"head":if(i=s.head,!i)throw Error(n(453));return i;case"body":if(i=s.body,!i)throw Error(n(454));return i;default:throw Error(n(451))}}function Br(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);ou(i)}var bn=new Map,Q_=new Set;function Ul(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var oi=U.d;U.d={f:rE,r:oE,D:lE,C:cE,L:uE,m:hE,X:fE,S:dE,M:pE};function rE(){var i=oi.f(),s=Ol();return i||s}function oE(i){var s=Fs(i);s!==null&&s.tag===5&&s.type==="form"?_m(s):oi.r(i)}var ya=typeof document>"u"?null:document;function Z_(i,s,l){var u=ya;if(u&&typeof s=="string"&&s){var p=dn(s);p='link[rel="'+i+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),Q_.has(p)||(Q_.add(p),i={rel:i,crossOrigin:l,href:s},u.querySelector(p)===null&&(s=u.createElement("link"),Te(s,"link",i),me(s),u.head.appendChild(s)))}}function lE(i){oi.D(i),Z_("dns-prefetch",i,null)}function cE(i,s){oi.C(i,s),Z_("preconnect",i,s)}function uE(i,s,l){oi.L(i,s,l);var u=ya;if(u&&i&&s){var p='link[rel="preload"][as="'+dn(s)+'"]';s==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+dn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+dn(l.imageSizes)+'"]')):p+='[href="'+dn(i)+'"]';var m=p;switch(s){case"style":m=ba(i);break;case"script":m=va(i)}bn.has(m)||(i=g({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:i,as:s},l),bn.set(m,i),u.querySelector(p)!==null||s==="style"&&u.querySelector(Fr(m))||s==="script"&&u.querySelector(Hr(m))||(s=u.createElement("link"),Te(s,"link",i),me(s),u.head.appendChild(s)))}}function hE(i,s){oi.m(i,s);var l=ya;if(l&&i){var u=s&&typeof s.as=="string"?s.as:"script",p='link[rel="modulepreload"][as="'+dn(u)+'"][href="'+dn(i)+'"]',m=p;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=va(i)}if(!bn.has(m)&&(i=g({rel:"modulepreload",href:i},s),bn.set(m,i),l.querySelector(p)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Hr(m)))return}u=l.createElement("link"),Te(u,"link",i),me(u),l.head.appendChild(u)}}}function dE(i,s,l){oi.S(i,s,l);var u=ya;if(u&&i){var p=Hs(u).hoistableStyles,m=ba(i);s=s||"default";var v=p.get(m);if(!v){var E={loading:0,preload:null};if(v=u.querySelector(Fr(m)))E.loading=5;else{i=g({rel:"stylesheet",href:i,"data-precedence":s},l),(l=bn.get(m))&&ad(i,l);var x=v=u.createElement("link");me(x),Te(x,"link",i),x._p=new Promise(function(B,G){x.onload=B,x.onerror=G}),x.addEventListener("load",function(){E.loading|=1}),x.addEventListener("error",function(){E.loading|=2}),E.loading|=4,Gl(v,s,u)}v={type:"stylesheet",instance:v,count:1,state:E},p.set(m,v)}}}function fE(i,s){oi.X(i,s);var l=ya;if(l&&i){var u=Hs(l).hoistableScripts,p=va(i),m=u.get(p);m||(m=l.querySelector(Hr(p)),m||(i=g({src:i,async:!0},s),(s=bn.get(p))&&rd(i,s),m=l.createElement("script"),me(m),Te(m,"link",i),l.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(p,m))}}function pE(i,s){oi.M(i,s);var l=ya;if(l&&i){var u=Hs(l).hoistableScripts,p=va(i),m=u.get(p);m||(m=l.querySelector(Hr(p)),m||(i=g({src:i,async:!0,type:"module"},s),(s=bn.get(p))&&rd(i,s),m=l.createElement("script"),me(m),Te(m,"link",i),l.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(p,m))}}function J_(i,s,l,u){var p=(p=at.current)?Ul(p):null;if(!p)throw Error(n(446));switch(i){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=ba(l.href),l=Hs(p).hoistableStyles,u=l.get(s),u||(u={type:"style",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){i=ba(l.href);var m=Hs(p).hoistableStyles,v=m.get(i);if(v||(p=p.ownerDocument||p,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(i,v),(m=p.querySelector(Fr(i)))&&!m._p&&(v.instance=m,v.state.loading=5),bn.has(i)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},bn.set(i,l),m||gE(p,i,l,v.state))),s&&u===null)throw Error(n(528,""));return v}if(s&&u!==null)throw Error(n(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=va(l),l=Hs(p).hoistableScripts,u=l.get(s),u||(u={type:"script",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,i))}}function ba(i){return'href="'+dn(i)+'"'}function Fr(i){return'link[rel="stylesheet"]['+i+"]"}function ty(i){return g({},i,{"data-precedence":i.precedence,precedence:null})}function gE(i,s,l,u){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?u.loading=1:(s=i.createElement("link"),u.preload=s,s.addEventListener("load",function(){return u.loading|=1}),s.addEventListener("error",function(){return u.loading|=2}),Te(s,"link",l),me(s),i.head.appendChild(s))}function va(i){return'[src="'+dn(i)+'"]'}function Hr(i){return"script[async]"+i}function ey(i,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var u=i.querySelector('style[data-href~="'+dn(l.href)+'"]');if(u)return s.instance=u,me(u),u;var p=g({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(i.ownerDocument||i).createElement("style"),me(u),Te(u,"style",p),Gl(u,l.precedence,i),s.instance=u;case"stylesheet":p=ba(l.href);var m=i.querySelector(Fr(p));if(m)return s.state.loading|=4,s.instance=m,me(m),m;u=ty(l),(p=bn.get(p))&&ad(u,p),m=(i.ownerDocument||i).createElement("link"),me(m);var v=m;return v._p=new Promise(function(E,x){v.onload=E,v.onerror=x}),Te(m,"link",u),s.state.loading|=4,Gl(m,l.precedence,i),s.instance=m;case"script":return m=va(l.src),(p=i.querySelector(Hr(m)))?(s.instance=p,me(p),p):(u=l,(p=bn.get(m))&&(u=g({},l),rd(u,p)),i=i.ownerDocument||i,p=i.createElement("script"),me(p),Te(p,"link",u),i.head.appendChild(p),s.instance=p);case"void":return null;default:throw Error(n(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(u=s.instance,s.state.loading|=4,Gl(u,l.precedence,i));return s.instance}function Gl(i,s,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=u.length?u[u.length-1]:null,m=p,v=0;v<u.length;v++){var E=u[v];if(E.dataset.precedence===s)m=E;else if(m!==p)break}m?m.parentNode.insertBefore(i,m.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(i,s.firstChild))}function ad(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function rd(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var jl=null;function ny(i,s,l){if(jl===null){var u=new Map,p=jl=new Map;p.set(l,u)}else p=jl,u=p.get(l),u||(u=new Map,p.set(l,u));if(u.has(i))return u;for(u.set(i,null),l=l.getElementsByTagName(i),p=0;p<l.length;p++){var m=l[p];if(!(m[Za]||m[Oe]||i==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var v=m.getAttribute(s)||"";v=i+v;var E=u.get(v);E?E.push(m):u.set(v,[m])}}return u}function iy(i,s,l){i=i.ownerDocument||i,i.head.insertBefore(l,s==="title"?i.querySelector("head > title"):null)}function mE(i,s,l){if(l===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function sy(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var zr=null;function _E(){}function yE(i,s,l){if(zr===null)throw Error(n(475));var u=zr;if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var p=ba(l.href),m=i.querySelector(Fr(p));if(m){i=m._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(u.count++,u=Vl.bind(u),i.then(u,u)),s.state.loading|=4,s.instance=m,me(m);return}m=i.ownerDocument||i,l=ty(l),(p=bn.get(p))&&ad(l,p),m=m.createElement("link"),me(m);var v=m;v._p=new Promise(function(E,x){v.onload=E,v.onerror=x}),Te(m,"link",l),s.instance=m}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(u.count++,s=Vl.bind(u),i.addEventListener("load",s),i.addEventListener("error",s))}}function bE(){if(zr===null)throw Error(n(475));var i=zr;return i.stylesheets&&i.count===0&&od(i,i.stylesheets),0<i.count?function(s){var l=setTimeout(function(){if(i.stylesheets&&od(i,i.stylesheets),i.unsuspend){var u=i.unsuspend;i.unsuspend=null,u()}},6e4);return i.unsuspend=s,function(){i.unsuspend=null,clearTimeout(l)}}:null}function Vl(){if(this.count--,this.count===0){if(this.stylesheets)od(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var ql=null;function od(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,ql=new Map,s.forEach(vE,i),ql=null,Vl.call(i))}function vE(i,s){if(!(s.state.loading&4)){var l=ql.get(i);if(l)var u=l.get(null);else{l=new Map,ql.set(i,l);for(var p=i.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<p.length;m++){var v=p[m];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(l.set(v.dataset.precedence,v),u=v)}u&&l.set(null,u)}p=s.instance,v=p.getAttribute("data-precedence"),m=l.get(v)||u,m===u&&l.set(null,p),l.set(v,p),this.count++,u=Vl.bind(this),p.addEventListener("load",u),p.addEventListener("error",u),m?m.parentNode.insertBefore(p,m.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(p,i.firstChild)),s.state.loading|=4}}var Ur={$$typeof:T,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function AE(i,s,l,u,p,m,v,E){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=iu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=iu(0),this.hiddenUpdates=iu(null),this.identifierPrefix=u,this.onUncaughtError=p,this.onCaughtError=m,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=E,this.incompleteTransitions=new Map}function ay(i,s,l,u,p,m,v,E,x,B,G,Y){return i=new AE(i,s,l,v,E,x,B,Y),s=1,m===!0&&(s|=24),m=nn(3,null,null,s),i.current=m,m.stateNode=i,s=Gu(),s.refCount++,i.pooledCache=s,s.refCount++,m.memoizedState={element:u,isDehydrated:l,cache:s},Yu(m),i}function ry(i){return i?(i=Qs,i):Qs}function oy(i,s,l,u,p,m){p=ry(p),u.context===null?u.context=p:u.pendingContext=p,u=Ei(s),u.payload={element:l},m=m===void 0?null:m,m!==null&&(u.callback=m),l=wi(i,u,s),l!==null&&(ln(l,i,s),_r(l,i,s))}function ly(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<s?l:s}}function ld(i,s){ly(i,s),(i=i.alternate)&&ly(i,s)}function cy(i){if(i.tag===13){var s=Ks(i,67108864);s!==null&&ln(s,i,67108864),ld(i,67108864)}}var Yl=!0;function SE(i,s,l,u){var p=I.T;I.T=null;var m=U.p;try{U.p=2,cd(i,s,l,u)}finally{U.p=m,I.T=p}}function EE(i,s,l,u){var p=I.T;I.T=null;var m=U.p;try{U.p=8,cd(i,s,l,u)}finally{U.p=m,I.T=p}}function cd(i,s,l,u){if(Yl){var p=ud(u);if(p===null)Kh(i,s,u,Xl,l),hy(i,u);else if(CE(p,i,s,l,u))u.stopPropagation();else if(hy(i,u),s&4&&-1<wE.indexOf(i)){for(;p!==null;){var m=Fs(p);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var v=Ji(m.pendingLanes);if(v!==0){var E=m;for(E.pendingLanes|=2,E.entangledLanes|=2;v;){var x=1<<31-tn(v);E.entanglements[1]|=x,v&=~x}Hn(m),(Bt&6)===0&&(Ml=Ln()+500,Lr(0))}}break;case 13:E=Ks(m,2),E!==null&&ln(E,m,2),Ol(),ld(m,2)}if(m=ud(u),m===null&&Kh(i,s,u,Xl,l),m===p)break;p=m}p!==null&&u.stopPropagation()}else Kh(i,s,u,null,l)}}function ud(i){return i=gu(i),hd(i)}var Xl=null;function hd(i){if(Xl=null,i=Bs(i),i!==null){var s=o(i);if(s===null)i=null;else{var l=s.tag;if(l===13){if(i=c(s),i!==null)return i;i=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return Xl=i,null}function uy(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(cA()){case wp:return 2;case Cp:return 8;case Ho:case uA:return 32;case Tp:return 268435456;default:return 32}default:return 32}}var dd=!1,Bi=null,Fi=null,Hi=null,Gr=new Map,jr=new Map,zi=[],wE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function hy(i,s){switch(i){case"focusin":case"focusout":Bi=null;break;case"dragenter":case"dragleave":Fi=null;break;case"mouseover":case"mouseout":Hi=null;break;case"pointerover":case"pointerout":Gr.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":jr.delete(s.pointerId)}}function Vr(i,s,l,u,p,m){return i===null||i.nativeEvent!==m?(i={blockedOn:s,domEventName:l,eventSystemFlags:u,nativeEvent:m,targetContainers:[p]},s!==null&&(s=Fs(s),s!==null&&cy(s)),i):(i.eventSystemFlags|=u,s=i.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),i)}function CE(i,s,l,u,p){switch(s){case"focusin":return Bi=Vr(Bi,i,s,l,u,p),!0;case"dragenter":return Fi=Vr(Fi,i,s,l,u,p),!0;case"mouseover":return Hi=Vr(Hi,i,s,l,u,p),!0;case"pointerover":var m=p.pointerId;return Gr.set(m,Vr(Gr.get(m)||null,i,s,l,u,p)),!0;case"gotpointercapture":return m=p.pointerId,jr.set(m,Vr(jr.get(m)||null,i,s,l,u,p)),!0}return!1}function dy(i){var s=Bs(i.target);if(s!==null){var l=o(s);if(l!==null){if(s=l.tag,s===13){if(s=c(l),s!==null){i.blockedOn=s,yA(i.priority,function(){if(l.tag===13){var u=on();u=su(u);var p=Ks(l,u);p!==null&&ln(p,l,u),ld(l,u)}});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function $l(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var l=ud(i.nativeEvent);if(l===null){l=i.nativeEvent;var u=new l.constructor(l.type,l);pu=u,l.target.dispatchEvent(u),pu=null}else return s=Fs(l),s!==null&&cy(s),i.blockedOn=l,!1;s.shift()}return!0}function fy(i,s,l){$l(i)&&l.delete(s)}function TE(){dd=!1,Bi!==null&&$l(Bi)&&(Bi=null),Fi!==null&&$l(Fi)&&(Fi=null),Hi!==null&&$l(Hi)&&(Hi=null),Gr.forEach(fy),jr.forEach(fy)}function Wl(i,s){i.blockedOn===s&&(i.blockedOn=null,dd||(dd=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,TE)))}var Kl=null;function py(i){Kl!==i&&(Kl=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Kl===i&&(Kl=null);for(var s=0;s<i.length;s+=3){var l=i[s],u=i[s+1],p=i[s+2];if(typeof u!="function"){if(hd(u||l)===null)continue;break}var m=Fs(l);m!==null&&(i.splice(s,3),s-=3,hh(m,{pending:!0,data:p,method:l.method,action:u},u,p))}}))}function qr(i){function s(x){return Wl(x,i)}Bi!==null&&Wl(Bi,i),Fi!==null&&Wl(Fi,i),Hi!==null&&Wl(Hi,i),Gr.forEach(s),jr.forEach(s);for(var l=0;l<zi.length;l++){var u=zi[l];u.blockedOn===i&&(u.blockedOn=null)}for(;0<zi.length&&(l=zi[0],l.blockedOn===null);)dy(l),l.blockedOn===null&&zi.shift();if(l=(i.ownerDocument||i).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var p=l[u],m=l[u+1],v=p[Ue]||null;if(typeof m=="function")v||py(l);else if(v){var E=null;if(m&&m.hasAttribute("formAction")){if(p=m,v=m[Ue]||null)E=v.formAction;else if(hd(p)!==null)continue}else E=v.action;typeof E=="function"?l[u+1]=E:(l.splice(u,3),u-=3),py(l)}}}function fd(i){this._internalRoot=i}Ql.prototype.render=fd.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(n(409));var l=s.current,u=on();oy(l,u,i,s,null,null)},Ql.prototype.unmount=fd.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;oy(i.current,2,null,i,null,null),Ol(),s[Ps]=null}};function Ql(i){this._internalRoot=i}Ql.prototype.unstable_scheduleHydration=function(i){if(i){var s=Np();i={blockedOn:null,target:i,priority:s};for(var l=0;l<zi.length&&s!==0&&s<zi[l].priority;l++);zi.splice(l,0,i),l===0&&dy(i)}};var gy=t.version;if(gy!=="19.1.1")throw Error(n(527,gy,"19.1.1"));U.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=d(s),i=i!==null?f(i):null,i=i===null?null:i.stateNode,i};var xE={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zl.isDisabled&&Zl.supportsFiber)try{Wa=Zl.inject(xE),Je=Zl}catch{}}return Xr.createRoot=function(i,s){if(!a(i))throw Error(n(299));var l=!1,u="",p=Nm,m=Om,v=km,E=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(p=s.onUncaughtError),s.onCaughtError!==void 0&&(m=s.onCaughtError),s.onRecoverableError!==void 0&&(v=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(E=s.unstable_transitionCallbacks)),s=ay(i,1,!1,null,null,l,u,p,m,v,E,null),i[Ps]=s.current,Wh(i),new fd(s)},Xr.hydrateRoot=function(i,s,l){if(!a(i))throw Error(n(299));var u=!1,p="",m=Nm,v=Om,E=km,x=null,B=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(m=l.onUncaughtError),l.onCaughtError!==void 0&&(v=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(x=l.unstable_transitionCallbacks),l.formState!==void 0&&(B=l.formState)),s=ay(i,1,!0,s,l??null,u,p,m,v,E,x,B),s.context=ry(null),l=s.current,u=on(),u=su(u),p=Ei(u),p.callback=null,wi(l,p,u),l=u,s.current.lanes=l,Qa(s,l),Hn(s),i[Ps]=s.current,Wh(i),new Ql(s)},Xr.version="19.1.1",Xr}var xy;function BE(){if(xy)return _d.exports;xy=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),_d.exports=PE(),_d.exports}var FE=BE();const Fe=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Gd=[.001,0,0,.001,0,0],Ad=1.35,cn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Gi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Wb="pdfjs_internal_editor_",ft={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Nt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},HE={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},xe={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},hc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ue={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},wa={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Fc={ERRORS:0,WARNINGS:1,INFOS:5},fo={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Jl={moveTo:0,lineTo:1,curveTo:2,closePath:3},zE={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Hc=Fc.WARNINGS;function UE(r){Number.isInteger(r)&&(Hc=r)}function GE(){return Hc}function zc(r){Hc>=Fc.INFOS&&console.log(`Info: ${r}`)}function gt(r){Hc>=Fc.WARNINGS&&console.log(`Warning: ${r}`)}function Gt(r){throw new Error(r)}function de(r,t){r||Gt(t)}function jE(r){switch(r?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Kb(r,t=null,e=null){if(!r)return null;if(e&&typeof r=="string"&&(e.addDefaultProtocol&&r.startsWith("www.")&&r.match(/\./g)?.length>=2&&(r=`http://${r}`),e.tryConvertEncoding))try{r=$E(r)}catch{}const n=t?URL.parse(r,t):URL.parse(r);return jE(n)?n:null}function Qb(r,t,e=!1){const n=URL.parse(r);return n?(n.hash=t,n.href):e&&Kb(r,"http://example.com")?r.split("#",1)[0]+`${t?`#${t}`:""}`:""}function Et(r,t,e,n=!1){return Object.defineProperty(r,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}const Os=(function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t})();class Ry extends Os{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Sd extends Os{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class jd extends Os{constructor(t){super(t,"InvalidPDFException")}}class gc extends Os{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class VE extends Os{constructor(t){super(t,"FormatError")}}class Xi extends Os{constructor(t){super(t,"AbortException")}}function Zb(r){(typeof r!="object"||r?.length===void 0)&&Gt("Invalid argument for bytesToString");const t=r.length,e=8192;if(t<e)return String.fromCharCode.apply(null,r);const n=[];for(let a=0;a<t;a+=e){const o=Math.min(a+e,t),c=r.subarray(a,o);n.push(String.fromCharCode.apply(null,c))}return n.join("")}function xo(r){typeof r!="string"&&Gt("Invalid argument for stringToBytes");const t=r.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=r.charCodeAt(n)&255;return e}function qE(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,r&255)}function YE(){const r=new Uint8Array(4);return r[0]=1,new Uint32Array(r.buffer,0,1)[0]===1}function XE(){try{return new Function(""),!0}catch{return!1}}class Ne{static get isLittleEndian(){return Et(this,"isLittleEndian",YE())}static get isEvalSupported(){return Et(this,"isEvalSupported",XE())}static get isOffscreenCanvasSupported(){return Et(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Et(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return Et(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return Et(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Ed=Array.from(Array(256).keys(),r=>r.toString(16).padStart(2,"0"));class nt{static makeHexColor(t,e,n){return`#${Ed[t]}${Ed[e]}${Ed[n]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,n=0){const a=t[n],o=t[n+1];t[n]=a*e[0]+o*e[2]+e[4],t[n+1]=a*e[1]+o*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const a=e[0],o=e[1],c=e[2],h=e[3],d=e[4],f=e[5];for(let g=0;g<6;g+=2){const _=t[n+g],y=t[n+g+1];t[n+g]=_*a+y*c+d,t[n+g+1]=_*o+y*h+f}}static applyInverseTransform(t,e){const n=t[0],a=t[1],o=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-a*e[2]+e[2]*e[5]-e[4]*e[3])/o,t[1]=(-n*e[1]+a*e[0]+e[4]*e[1]-e[5]*e[0])/o}static axialAlignedBoundingBox(t,e,n){const a=e[0],o=e[1],c=e[2],h=e[3],d=e[4],f=e[5],g=t[0],_=t[1],y=t[2],b=t[3];let A=a*g+d,S=A,C=a*y+d,w=C,M=h*_+f,T=M,N=h*b+f,R=N;if(o!==0||c!==0){const k=o*g,z=o*y,j=c*_,$=c*b;A+=j,w+=j,C+=$,S+=$,M+=k,R+=k,N+=z,T+=z}n[0]=Math.min(n[0],A,C,S,w),n[1]=Math.min(n[1],M,N,T,R),n[2]=Math.max(n[2],A,C,S,w),n[3]=Math.max(n[3],M,N,T,R)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],a=t[1],o=t[2],c=t[3],h=n**2+a**2,d=n*o+a*c,f=o**2+c**2,g=(h+f)/2,_=Math.sqrt(g**2-(h*f-d**2));e[0]=Math.sqrt(g+_||1),e[1]=Math.sqrt(g-_||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),a=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>a)return null;const o=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),c=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return o>c?null:[n,o,a,c]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,a,o){o[0]=Math.min(o[0],t,n),o[1]=Math.min(o[1],e,a),o[2]=Math.max(o[2],t,n),o[3]=Math.max(o[3],e,a)}static#t(t,e,n,a,o,c,h,d,f,g){if(f<=0||f>=1)return;const _=1-f,y=f*f,b=y*f,A=_*(_*(_*t+3*f*e)+3*y*n)+b*a,S=_*(_*(_*o+3*f*c)+3*y*h)+b*d;g[0]=Math.min(g[0],A),g[1]=Math.min(g[1],S),g[2]=Math.max(g[2],A),g[3]=Math.max(g[3],S)}static#e(t,e,n,a,o,c,h,d,f,g,_,y){if(Math.abs(f)<1e-12){Math.abs(g)>=1e-12&&this.#t(t,e,n,a,o,c,h,d,-_/g,y);return}const b=g**2-4*_*f;if(b<0)return;const A=Math.sqrt(b),S=2*f;this.#t(t,e,n,a,o,c,h,d,(-g+A)/S,y),this.#t(t,e,n,a,o,c,h,d,(-g-A)/S,y)}static bezierBoundingBox(t,e,n,a,o,c,h,d,f){f[0]=Math.min(f[0],t,h),f[1]=Math.min(f[1],e,d),f[2]=Math.max(f[2],t,h),f[3]=Math.max(f[3],e,d),this.#e(t,n,o,h,e,a,c,d,3*(-t+3*(n-o)+h),6*(t-2*n+o),3*(n-t),f),this.#e(t,n,o,h,e,a,c,d,3*(-e+3*(a-c)+d),6*(e-2*a+c),3*(a-e),f)}}function $E(r){return decodeURIComponent(escape(r))}let wd=null,Dy=null;function WE(r){return wd||(wd=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Dy=new Map([["ﬅ","ſt"]])),r.replaceAll(wd,(t,e,n)=>e?e.normalize("NFKC"):Dy.get(n))}function Jb(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const r=new Uint8Array(32);return crypto.getRandomValues(r),Zb(r)}const Cf="pdfjs_internal_id_";function KE(r,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[n,a,...o]=e;if(!r(n)&&!Number.isInteger(n)||!t(a))return!1;const c=o.length;let h=!0;switch(a.name){case"XYZ":if(c<2||c>3)return!1;break;case"Fit":case"FitB":return c===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(c>1)return!1;break;case"FitR":if(c!==4)return!1;h=!1;break;default:return!1}for(const d of o)if(!(typeof d=="number"||h&&d===null))return!1;return!0}function He(r,t,e){return Math.min(Math.max(r,t),e)}function tv(r){return Uint8Array.prototype.toBase64?r.toBase64():btoa(Zb(r))}function QE(r){return Uint8Array.fromBase64?Uint8Array.fromBase64(r):xo(atob(r))}typeof Promise.try!="function"&&(Promise.try=function(r,...t){return new Promise(e=>{e(r(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(r){return r.reduce((t,e)=>t+e,0)});const li="http://www.w3.org/2000/svg";class Ba{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Ro(r,t="text"){if(no(r,document.baseURI)){const e=await fetch(r);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{const a=new XMLHttpRequest;a.open("GET",r,!0),a.responseType=t,a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE){if(a.status===200||a.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(a.response);return}e(a.responseText);return}n(new Error(a.statusText))}},a.send(null)})}class Do{constructor({viewBox:t,userUnit:e,scale:n,rotation:a,offsetX:o=0,offsetY:c=0,dontFlip:h=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=a,this.offsetX=o,this.offsetY=c,n*=e;const d=(t[2]+t[0])/2,f=(t[3]+t[1])/2;let g,_,y,b;switch(a%=360,a<0&&(a+=360),a){case 180:g=-1,_=0,y=0,b=1;break;case 90:g=0,_=1,y=1,b=0;break;case 270:g=0,_=-1,y=-1,b=0;break;case 0:g=1,_=0,y=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}h&&(y=-y,b=-b);let A,S,C,w;g===0?(A=Math.abs(f-t[1])*n+o,S=Math.abs(d-t[0])*n+c,C=(t[3]-t[1])*n,w=(t[2]-t[0])*n):(A=Math.abs(d-t[0])*n+o,S=Math.abs(f-t[1])*n+c,C=(t[2]-t[0])*n,w=(t[3]-t[1])*n),this.transform=[g*n,_*n,y*n,b*n,A-g*n*d-y*n*f,S-_*n*d-b*n*f],this.width=C,this.height=w}get rawDims(){const t=this.viewBox;return Et(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:a=this.offsetY,dontFlip:o=!1}={}){return new Do({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:a,dontFlip:o})}convertToViewportPoint(t,e){const n=[t,e];return nt.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];nt.applyTransform(e,this.transform);const n=[t[2],t[3]];return nt.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return nt.applyInverseTransform(n,this.transform),n}}class Tf extends Os{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Uc(r){const t=r.length;let e=0;for(;e<t&&r[e].trim()==="";)e++;return r.substring(e,e+5).toLowerCase()==="data:"}function xf(r){return typeof r=="string"&&/\.pdf$/i.test(r)}function ZE(r){return[r]=r.split(/[#?]/,1),r.substring(r.lastIndexOf("/")+1)}function JE(r,t="document.pdf"){if(typeof r!="string")return t;if(Uc(r))return gt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(h=>{try{return new URL(h)}catch{try{return new URL(decodeURIComponent(h))}catch{try{return new URL(h,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(h),"https://foo.bar")}catch{return null}}}}})(r);if(!n)return t;const a=h=>{try{let d=decodeURIComponent(h);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:h):d}catch{return h}},o=/\.pdf$/i,c=n.pathname.split("/").at(-1);if(o.test(c))return a(c);if(n.searchParams.size>0){const h=Array.from(n.searchParams.values()).reverse();for(const f of h)if(o.test(f))return a(f);const d=Array.from(n.searchParams.keys()).reverse();for(const f of d)if(o.test(f))return a(f)}if(n.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(d)return a(d[0])}return t}class My{started=Object.create(null);times=[];time(t){t in this.started&&gt(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||gt(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:a,end:o}of this.times)t.push(`${n.padEnd(e)} ${o-a}ms
`);return t.join("")}}function no(r,t){const e=t?URL.parse(r,t):URL.parse(r);return e?.protocol==="http:"||e?.protocol==="https:"}function wn(r){r.preventDefault()}function he(r){r.preventDefault(),r.stopPropagation()}function t1(r){console.log("Deprecated API usage: "+r)}class Vd{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const n=parseInt(e[1],10);let a=parseInt(e[2],10);a=a>=1&&a<=12?a-1:0;let o=parseInt(e[3],10);o=o>=1&&o<=31?o:1;let c=parseInt(e[4],10);c=c>=0&&c<=23?c:0;let h=parseInt(e[5],10);h=h>=0&&h<=59?h:0;let d=parseInt(e[6],10);d=d>=0&&d<=59?d:0;const f=e[7]||"Z";let g=parseInt(e[8],10);g=g>=0&&g<=23?g:0;let _=parseInt(e[9],10)||0;return _=_>=0&&_<=59?_:0,f==="-"?(c+=g,h+=_):f==="+"&&(c-=g,h-=_),new Date(Date.UTC(n,a,o,c,h,d))}}function e1(r,{scale:t=1,rotation:e=0}){const{width:n,height:a}=r.attributes.style,o=[0,0,parseInt(n),parseInt(a)];return new Do({viewBox:o,userUnit:1,scale:t,rotation:e})}function Gc(r){if(r.startsWith("#")){const t=parseInt(r.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return r.startsWith("rgb(")?r.slice(4,-1).split(",").map(t=>parseInt(t)):r.startsWith("rgba(")?r.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(gt(`Not a valid color format: "${r}"`),[0,0,0])}function n1(r){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of r.keys()){t.style.color=e;const n=window.getComputedStyle(t).color;r.set(e,Gc(n))}t.remove()}function Jt(r){const{a:t,b:e,c:n,d:a,e:o,f:c}=r.getTransform();return[t,e,n,a,o,c]}function Gn(r){const{a:t,b:e,c:n,d:a,e:o,f:c}=r.getTransform().invertSelf();return[t,e,n,a,o,c]}function Ts(r,t,e=!1,n=!0){if(t instanceof Do){const{pageWidth:a,pageHeight:o}=t.rawDims,{style:c}=r,h=Ne.isCSSRoundSupported,d=`var(--total-scale-factor) * ${a}px`,f=`var(--total-scale-factor) * ${o}px`,g=h?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,_=h?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!e||t.rotation%180===0?(c.width=g,c.height=_):(c.width=_,c.height=g)}n&&r.setAttribute("data-main-rotation",t.rotation)}class Yn{constructor(){const{pixelRatio:t}=Yn;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,a,o=-1){let c=1/0,h=1/0,d=1/0;n=Yn.capPixels(n,o),n>0&&(c=Math.sqrt(n/(t*e))),a!==-1&&(h=a/t,d=a/e);const f=Math.min(c,h,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const qd=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class ao{#t=null;#e=null;#n;#i=null;#a=null;#s=null;#r=null;static#o=null;constructor(t){this.#n=t,ao.#o||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#n._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",wn,{signal:e}),t.addEventListener("pointerdown",ao.#l,{signal:e}));const n=this.#i=document.createElement("div");n.className="buttons",t.append(n);const a=this.#n.toolbarPosition;if(a){const{style:o}=t,c=this.#n._uiManager.direction==="ltr"?1-a[0]:a[0];o.insetInlineEnd=`${100*c}%`,o.top=`calc(${100*a[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#c(t){this.#n._focusEventsAllowed=!1,he(t)}#d(t){this.#n._focusEventsAllowed=!0,he(t)}#u(t){const e=this.#n._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#c.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",wn,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#s?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#n,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",ao.#o[t]),this.#u(n)&&n.addEventListener("click",a=>{e.delete()},{signal:e._signal}),this.#i.append(n)}get#f(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#u(e),this.#i.append(e,this.#f),this.#a=t}addComment(t){if(this.#s)return;const e=t.render();e&&(this.#u(e),this.#i.append(e,this.#f),this.#s=t,t.toolbar=this)}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#u(e),this.#i.append(e,this.#f)}async addEditSignatureButton(t){const e=this.#r=await t.renderEditButton(this.#n);this.#u(e),this.#i.append(e,this.#f)}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}updateEditSignatureButton(t){this.#r&&(this.#r.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class i1{#t=null;#e=null;#n;constructor(t){this.#n=t}#i(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#n._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",wn,{signal:e});const n=this.#t=document.createElement("div");return n.className="buttons",t.append(n),this.#n.hasCommentManager()&&this.#s("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#s("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),t}#a(t,e){let n=0,a=0;for(const o of t){const c=o.y+o.height;if(c<n)continue;const h=o.x+(e?o.width:0);if(c>n){a=h,n=c;continue}e?h>a&&(a=h):h<a&&(a=h)}return[e?1-a:a,n]}show(t,e,n){const[a,o]=this.#a(e,n),{style:c}=this.#e||=this.#i();t.append(this.#e),c.insetInlineEnd=`${100*a}%`,c.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#s(t,e,n,a){const o=document.createElement("button");o.classList.add("basic",t),o.tabIndex=0,o.setAttribute("data-l10n-id",e);const c=document.createElement("span");o.append(c),c.className="visuallyHidden",c.setAttribute("data-l10n-id",n);const h=this.#n._signal;h instanceof AbortSignal&&!h.aborted&&(o.addEventListener("contextmenu",wn,{signal:h}),o.addEventListener("click",a,{signal:h})),this.#t.append(o)}}function ev(r,t,e){for(const n of e)t.addEventListener(n,r[n].bind(r))}class s1{#t=0;get id(){return`${Wb}${this.#t++}`}}class Rf{#t=Jb();#e=0;#n=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),a=new Image;a.src=t;const o=a.decode().then(()=>(n.drawImage(a,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Et(this,"_isSVGFittingCanvas",o)}async#i(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let a;if(typeof e=="string"?(n.url=e,a=await Ro(e,"blob")):e instanceof File?a=n.file=e:e instanceof Blob&&(a=e),a.type==="image/svg+xml"){const o=Rf._isSVGFittingCanvas,c=new FileReader,h=new Image,d=new Promise((f,g)=>{h.onload=()=>{n.bitmap=h,n.isSvg=!0,f()},c.onload=async()=>{const _=n.svgUrl=c.result;h.src=await o?`${_}#svgView(preserveAspectRatio(none))`:_},h.onerror=c.onerror=g});c.readAsDataURL(a),await d}else n.bitmap=await createImageBitmap(a);n.refCounter=1}catch(a){gt(a),n=null}return this.#n.set(t,n),n&&this.#n.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:a,type:o}=t;return this.#i(`${e}_${n}_${a}_${o}`,t)}async getFromUrl(t){return this.#i(t,t)}async getFromBlob(t,e){const n=await e;return this.#i(t,n)}async getFromId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n?.bitmap)return n.refCounter+=1,n;const a=new OffscreenCanvas(e.width,e.height);return a.getContext("2d").drawImage(e,0,0),n={bitmap:a.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#n.set(t,n),this.#n.set(n.id,n),n}getSvgUrl(t){const e=this.#n.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:n}=e;if(!e.url&&!e.file){const a=new OffscreenCanvas(n.width,n.height);a.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=a.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class a1{#t=[];#e=!1;#n;#i=-1;constructor(t=128){this.#n=t}add({cmd:t,undo:e,post:n,mustExec:a,type:o=NaN,overwriteIfSameType:c=!1,keepUndo:h=!1}){if(a&&t(),this.#e)return;const d={cmd:t,undo:e,post:n,type:o};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(d);return}if(c&&this.#t[this.#i].type===o){h&&(d.undo=this.#t[this.#i].undo),this.#t[this.#i]=d;return}const f=this.#i+1;f===this.#n?this.#t.splice(0,1):(this.#i=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(d)}undo(){if(this.#i===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(t){if(this.#i!==-1){for(let e=this.#i;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#i-e),this.#i=e;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}}class Mo{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Ne.platform;for(const[n,a,o={}]of t)for(const c of n){const h=c.startsWith("mac+");e&&h?(this.callbacks.set(c.slice(4),{callback:a,options:o}),this.allKeys.add(c.split("+").at(-1))):!e&&!h&&(this.callbacks.set(c,{callback:a,options:o}),this.allKeys.add(c.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#t(e));if(!n)return;const{callback:a,options:{bubbles:o=!1,args:c=[],checker:h=null}}=n;h&&!h(t,e)||(a.bind(t,...c,e)(),o||he(e))}}class Df{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return n1(t),Et(this,"_colors",t)}convert(t){const e=Gc(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,a]of this._colors)if(a.every((o,c)=>o===e[c]))return Df._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?nt.makeHexColor(...e):t}}class $i{#t=new AbortController;#e=null;#n=null;#i=new Map;#a=new Map;#s=null;#r=null;#o=null;#l=new a1;#c=null;#d=null;#u=null;#f=0;#g=new Set;#p=null;#h=null;#m=new Set;_editorUndoBar=null;#b=!1;#_=!1;#A=!1;#S=null;#y=null;#E=null;#R=null;#T=!1;#w=null;#O=new s1;#x=!1;#D=!1;#I=!1;#k=null;#L=null;#P=null;#N=null;#H=null;#C=ft.NONE;#v=new Set;#z=null;#U=null;#j=null;#$=null;#Y=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#B=[0,0];#V=null;#q=null;#Z=null;#J=null;#F=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=$i.prototype,e=c=>c.#q.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&c.hasSomethingToControl(),n=(c,{target:h})=>{if(h instanceof HTMLInputElement){const{type:d}=h;return d!=="text"&&d!=="number"}return!0},a=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Et(this,"_keyboardManager",new Mo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(c,{target:h})=>!(h instanceof HTMLButtonElement)&&c.#q.contains(h)&&!c.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(c,{target:h})=>!(h instanceof HTMLButtonElement)&&c.#q.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:e}]]))}constructor(t,e,n,a,o,c,h,d,f,g,_,y,b,A,S,C){const w=this._signal=this.#t.signal;this.#q=t,this.#Z=e,this.#J=n,this.#s=a,this.#c=o,this.#U=c,this.#Y=d,this._eventBus=h,h._on("editingaction",this.onEditingAction.bind(this),{signal:w}),h._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),h._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),h._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),h._on("setpreference",this.onSetPreference.bind(this),{signal:w}),h._on("switchannotationeditorparams",M=>this.updateParams(M.type,M.value),{signal:w}),window.addEventListener("pointerdown",()=>{this.#D=!0},{capture:!0,signal:w}),window.addEventListener("pointerup",()=>{this.#D=!1},{capture:!0,signal:w}),this.#lt(),this.#dt(),this.#et(),this.#r=d.annotationStorage,this.#S=d.filterFactory,this.#j=f,this.#R=g||null,this.#b=_,this.#_=y,this.#A=b,this.#H=A||null,this.viewParameters={realScale:Ba.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=S||null,this._supportsPinchToZoom=C!==!1}destroy(){this.#F?.resolve(),this.#F=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#i.clear(),this.#m.clear(),this.#N?.clear(),this.#e=null,this.#v.clear(),this.#l.destroy(),this.#s?.destroy(),this.#c?.destroy(),this.#U?.destroy(),this.#w?.hide(),this.#w=null,this.#P?.destroy(),this.#P=null,this.#n=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#V&&(clearTimeout(this.#V),this.#V=null),this._editorUndoBar?.destroy(),this.#Y=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#_}get useNewAltTextWhenAddingImage(){return this.#A}get hcmFilter(){return Et(this,"hcmFilter",this.#j?this.#S.addHCMFilter(this.#j.foreground,this.#j.background):"none")}get direction(){return Et(this,"direction",getComputedStyle(this.#q).direction)}get _highlightColors(){return Et(this,"_highlightColors",this.#R?new Map(this.#R.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return Et(this,"highlightColors",null);const e=new Map,n=!!this.#j;for(const[a,o]of t){const c=a.endsWith("_HCM");if(n&&c){e.set(a.replace("_HCM",""),o);continue}!n&&!c&&e.set(a,o)}return Et(this,"highlightColors",e)}get highlightColorNames(){return Et(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#u=t}setMainHighlightColorPicker(t){this.#P=t}editAltText(t,e=!1){this.#s?.editAltText(this,t,e)}hasCommentManager(){return!!this.#c}editComment(t,e){this.#c?.open(this,t,e)}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#A=e;break}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#q.focus()}findParent(t,e){for(const n of this.#a.values()){const{x:a,y:o,width:c,height:h}=n.div.getBoundingClientRect();if(t>=a&&t<=a+c&&e>=o&&e<=o+h)return n}return null}disableUserSelect(t=!1){this.#Z.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#m.add(t)}removeShouldRescale(t){this.#m.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Ba.PDF_TO_CSS_UNITS;for(const e of this.#m)e.onScaleChanging();this.#u?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of this.#a.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(t="",e=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:a,anchorOffset:o,focusNode:c,focusOffset:h}=n,d=n.toString(),g=this.#Q(n).closest(".textLayer"),_=this.getSelectionBoxes(g);if(!_)return;n.empty();const y=this.#tt(g),b=this.#C===ft.NONE,A=()=>{const S=y?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:_,anchorNode:a,anchorOffset:o,focusNode:c,focusOffset:h,text:d});b&&this.showAllEditors("highlight",!0,!0),e&&S?.editComment()};if(b){this.switchToMode(ft.HIGHLIGHT,A);return}A()}commentSelection(t=""){this.highlightSelection(t,!0)}#rt(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=this.#Q(t).closest(".textLayer"),a=this.getSelectionBoxes(n);a&&(this.#w||=new i1(this),this.#w.show(n,a,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#r&&!this.#r.has(t.id)&&this.#r.setValue(t.id,t)}a11yAlert(t,e=null){const n=this.#J;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#ot(){const t=document.getSelection();if(!t||t.isCollapsed){this.#z&&(this.#w?.hide(),this.#z=null,this.#M({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#z)return;const a=this.#Q(t).closest(".textLayer");if(!a){this.#z&&(this.#w?.hide(),this.#z=null,this.#M({hasSelectedText:!1}));return}if(this.#w?.hide(),this.#z=e,this.#M({hasSelectedText:!0}),!(this.#C!==ft.HIGHLIGHT&&this.#C!==ft.NONE)&&(this.#C===ft.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#T=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#C===ft.HIGHLIGHT?this.#tt(a):null;if(o?.toggleDrawing(),this.#D){const c=new AbortController,h=this.combinedSignal(c),d=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),o?.toggleDrawing(!0),f.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("blur",d,{signal:h})}else o?.toggleDrawing(!0),this.#W("main_toolbar")}}#W(t=""){this.#C===ft.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#rt()}#lt(){document.addEventListener("selectionchange",this.#ot.bind(this),{signal:this._signal})}#ct(){if(this.#E)return;this.#E=new AbortController;const t=this.combinedSignal(this.#E);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ut(){this.#E?.abort(),this.#E=null}blur(){if(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#v)if(e.div.contains(t)){this.#L=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#L)return;const[t,e]=this.#L;this.#L=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#k)return;this.#k=new AbortController;const t=this.combinedSignal(this.#k);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ht(){this.#k?.abort(),this.#k=null}#nt(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#it(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.#nt()}removeEditListeners(){this.#ht(),this.#it()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#h)if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#h)if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of this.#v){const a=n.serialize(!0);a&&e.push(a)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const o of e.items)for(const c of this.#h)if(c.isHandlingMimeForPasting(o.type)){c.paste(o,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){gt(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const a=this.currentLayer;try{const o=[];for(const d of n){const f=await a.deserialize(d);if(!f)return;o.push(f)}const c=()=>{for(const d of o)this.#st(d);this.#at(o)},h=()=>{for(const d of o)d.remove()};this.addCommands({cmd:c,undo:h,mustExec:!0})}catch(o){gt(`paste: "${o.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==ft.NONE&&!this.isEditorHandlingKeyboard&&$i._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#M(t){Object.entries(t).some(([n,a])=>this.#X[n]!==a)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#C===ft.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#G([[Nt.HIGHLIGHT_FREE,!0]]))}#G(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ct(),this.#nt(),this.#M({isEditing:this.#C!==ft.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ut(),this.#it(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#h){this.#h=t;for(const e of this.#h)this.#G(e.defaultPropertiesToUpdate)}}getId(){return this.#O.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#a.set(t.pageIndex,t),this.#x?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,n=!1,a=!1,o=!1){if(this.#C!==t&&!(this.#F&&(await this.#F.promise,!this.#F))){if(this.#F=Promise.withResolvers(),this.#u?.commitOrRemove(),this.#C===ft.POPUP&&this.#c?.hideSidebar(),this.#C=t,t===ft.NONE){this.setEditingState(!1),this.#pt(),this._editorUndoBar?.hide(),this.#F.resolve();return}t===ft.SIGNATURE&&await this.#U?.loadSignatures(),t===ft.POPUP&&(this.#n||=await this.#Y.getAnnotationsByType(new Set(this.#h.map(c=>c._editorType))),this.#c?.showSidebar(this.#n)),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const c of this.#a.values())c.updateMode(t);if(!e){n&&this.addNewEditorFromKeyboard(),this.#F.resolve();return}for(const c of this.#i.values())c.annotationElementId===e||c.id===e?(this.setSelected(c),o?c.editComment():a&&c.enterInEditMode()):c.unselect();this.#F.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#h){switch(t){case Nt.CREATE:this.currentLayer.addNewEditor(e);return;case Nt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#$||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const n of this.#v)n.updateParams(t,e);else for(const n of this.#h)n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){for(const o of this.#i.values())o.editorType===t&&o.show(e);(this.#$?.get(Nt.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#G([[Nt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#I!==t){this.#I=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#x){this.#x=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#pt(){if(this.unselectAll(),this.#x){this.#x=!1;for(const t of this.#a.values())t.disable();for(const t of this.#i.values())t.disable()}}getEditors(t){const e=[];for(const n of this.#i.values())n.pageIndex===t&&e.push(n);return e}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#N?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#g.has(t.annotationElementId))&&this.#r?.remove(t.id)}addDeletedAnnotationElement(t){this.#g.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#g.has(t)}removeDeletedAnnotationElement(t){this.#g.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#G(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#v);return t}updateUI(t){this.#gt===t&&this.#G(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#G(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#G(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#u?.commitOrRemove();for(const e of this.#v)e!==t&&e.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#G(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#M({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#l.add(t),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#l.cleanType(t)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#v],n=()=>{this._editorUndoBar?.show(a,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},a=()=>{for(const o of e)this.#st(o)};this.addCommands({cmd:n,undo:a,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#at(t){for(const e of this.#v)e.unselect();this.#v.clear();for(const e of t)e.isEmpty()||(this.#v.add(e),e.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#v)t.commit();this.#at(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#C!==ft.NONE))&&!this.#u?.commitOrRemove()&&this.hasSelection){for(const t of this.#v)t.unselect();this.#v.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#B[0]+=t,this.#B[1]+=e;const[a,o]=this.#B,c=[...this.#v],h=1e3;this.#V&&clearTimeout(this.#V),this.#V=setTimeout(()=>{this.#V=null,this.#B[0]=this.#B[1]=0,this.addCommands({cmd:()=>{for(const d of c)this.#i.has(d.id)&&(d.translateInPage(a,o),d.translationDone())},undo:()=>{for(const d of c)this.#i.has(d.id)&&(d.translateInPage(-a,-o),d.translationDone())},mustExec:!1})},h);for(const d of c)d.translateInPage(t,e),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const t of this.#v)this.#p.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const t=this.#p;this.#p=null;let e=!1;for(const[{x:a,y:o,pageIndex:c},h]of t)h.newX=a,h.newY=o,h.newPageIndex=c,e||=a!==h.savedX||o!==h.savedY||c!==h.savedPageIndex;if(!e)return!1;const n=(a,o,c,h)=>{if(this.#i.has(a.id)){const d=this.#a.get(h);d?a._setParentAndPosition(d,o,c):(a.pageIndex=h,a.x=o,a.y=c)}};return this.addCommands({cmd:()=>{for(const[a,{newX:o,newY:c,newPageIndex:h}]of t)n(a,o,c,h)},undo:()=>{for(const[a,{savedX:o,savedY:c,savedPageIndex:h}]of t)n(a,o,c,h)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#p)for(const n of this.#p.keys())n.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#C}get imageManager(){return Et(this,"imageManager",new Rf)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let f=0,g=e.rangeCount;f<g;f++)if(!t.contains(e.getRangeAt(f).commonAncestorContainer))return null;const{x:n,y:a,width:o,height:c}=t.getBoundingClientRect();let h;switch(t.getAttribute("data-main-rotation")){case"90":h=(f,g,_,y)=>({x:(g-a)/c,y:1-(f+_-n)/o,width:y/c,height:_/o});break;case"180":h=(f,g,_,y)=>({x:1-(f+_-n)/o,y:1-(g+y-a)/c,width:_/o,height:y/c});break;case"270":h=(f,g,_,y)=>({x:1-(g+y-a)/c,y:(f-n)/o,width:y/c,height:_/o});break;default:h=(f,g,_,y)=>({x:(f-n)/o,y:(g-a)/c,width:_/o,height:y/c});break}const d=[];for(let f=0,g=e.rangeCount;f<g;f++){const _=e.getRangeAt(f);if(!_.collapsed)for(const{x:y,y:b,width:A,height:S}of _.getClientRects())A===0||S===0||d.push(h(y,b,A,S))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const n=this.#r.getRawValue(e);n&&(this.#C===ft.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,e,n){const a=this.#N?.get(t);a&&(a.setCanvas(e,n),this.#N.delete(t))}addMissingCanvas(t,e){(this.#N||=new Map).set(t,e)}}class qn{#t=null;#e=!1;#n=null;#i=null;#a=null;#s=null;#r=!1;#o=null;#l=null;#c=null;#d=null;#u=!1;static#f=null;static _l10n=null;constructor(t){this.#l=t,this.#u=t._uiManager.useNewAltTextFlow,qn.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){qn._l10n??=t}async render(){const t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#i=document.createElement("span");t.append(e),this.#u?(t.classList.add("new"),t.setAttribute("data-l10n-id",qn.#f.missing),e.setAttribute("data-l10n-id",qn.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#l._uiManager._signal;t.addEventListener("contextmenu",wn,{signal:n}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});const a=o=>{o.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#u&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",a,{capture:!0,signal:n}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(this.#r=!0,a(o))},{signal:n}),await this.#p(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#u?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#u?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(t){this.#t===null&&(this.#c=t,this.#d=await qn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())}toggleAltTextBadge(t=!1){if(!this.#u||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#l.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#c===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:a,cancel:o=!1}){n&&(this.#c=n,this.#d=a),!(this.#t===t&&this.#e===e)&&(o||(this.#t=t,this.#e=e),this.#p())}toggle(t=!1){this.#n&&(!t&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!t)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#a=null,this.#o?.remove(),this.#o=null}async#p(){const t=this.#n;if(!t)return;if(this.#u){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",qn.#f[this.#g]),this.#i?.setAttribute("data-l10n-id",qn.#f[`${this.#g}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#l.id}`;const a=100,o=this.#l._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#a.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},a)},{signal:o}),t.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#a?.classList.remove("show")},{signal:o})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#l.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class tc{#t=null;#e=!1;#n=null;#i=null;#a=null;#s=null;#r=!1;constructor(t){this.#n=t,this.toolbar=null}render(){if(!this.#n._uiManager.hasCommentManager())return null;const t=this.#t=document.createElement("button");t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=this.#n._uiManager._signal;if(!(e instanceof AbortSignal)||e.aborted)return t;t.addEventListener("contextmenu",wn,{signal:e}),t.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:e});const n=a=>{a.preventDefault(),this.edit()};return t.addEventListener("click",n,{capture:!0,signal:e}),t.addEventListener("keydown",a=>{a.target===t&&a.key==="Enter"&&(this.#e=!0,n(a))},{signal:e}),t}edit(){const{bottom:t,left:e,right:n}=this.#n.getClientDimensions(),a={top:t};this.#n._uiManager.direction==="ltr"?a.right=n:a.left=e,this.#n._uiManager.editComment(this.#n,a)}finish(){this.#t&&(this.#t.focus({focusVisible:this.#e}),this.#e=!1)}isDeleted(){return this.#r||this.#a===""}hasBeenEdited(){return this.isDeleted()||this.#a!==this.#i}serialize(){return this.data}get data(){return{text:this.#a,date:this.#s,deleted:this.#r}}set data(t){if(t===null){this.#a="",this.#r=!0;return}this.#a=t,this.#s=new Date,this.#r=!1}setInitialText(t){this.#i=t,this.data=t}toggle(t=!1){this.#t&&(this.#t.disabled=!t)}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#a="",this.#s=null,this.#n=null,this.#e=!1,this.#r=!1}}class jc{#t;#e=!1;#n=null;#i;#a;#s;#r;#o=null;#l;#c=null;#d;#u=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:a=null,onPinching:o=null,onPinchEnd:c=null,signal:h}){this.#t=t,this.#n=n,this.#i=e,this.#a=a,this.#s=o,this.#r=c,this.#d=new AbortController,this.#l=AbortSignal.any([h,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Yn.pixelRatio}#f(t){if(this.#i?.())return;if(t.touches.length===1){if(this.#o)return;const a=this.#o=new AbortController,o=AbortSignal.any([this.#l,a.signal]),c=this.#t,h={capture:!0,signal:o,passive:!1},d=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};c.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(he(f),d(f))},h),c.addEventListener("pointerup",d,h),c.addEventListener("pointercancel",d,h);return}if(!this.#u){this.#u=new AbortController;const a=AbortSignal.any([this.#l,this.#u.signal]),o=this.#t,c={signal:a,capture:!1,passive:!1};o.addEventListener("touchmove",this.#g.bind(this),c);const h=this.#p.bind(this);o.addEventListener("touchend",h,c),o.addEventListener("touchcancel",h,c),c.capture=!0,o.addEventListener("pointerdown",he,c),o.addEventListener("pointermove",he,c),o.addEventListener("pointercancel",he,c),o.addEventListener("pointerup",he,c),this.#a?.()}if(he(t),t.touches.length!==2||this.#n?.()){this.#c=null;return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#c={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#g(t){if(!this.#c||t.touches.length!==2)return;he(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:a,screenY:o}=e,{screenX:c,screenY:h}=n,d=this.#c,{touch0X:f,touch0Y:g,touch1X:_,touch1Y:y}=d,b=_-f,A=y-g,S=c-a,C=h-o,w=Math.hypot(S,C)||1,M=Math.hypot(b,A)||1;if(!this.#e&&Math.abs(M-w)<=jc.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=a,d.touch0Y=o,d.touch1X=c,d.touch1Y=h,!this.#e){this.#e=!0;return}const T=[(a+c)/2,(o+h)/2];this.#s?.(T,M,w)}#p(t){t.touches.length>=2||(this.#u&&(this.#u.abort(),this.#u=null,this.#r?.()),this.#c&&(he(t),this.#c=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class rt{#t=null;#e=null;#n=null;#i=null;#a=!1;#s=null;#r="";#o=!1;#l=null;#c=null;#d=null;#u=null;#f="";#g=!1;#p=null;#h=!1;#m=!1;#b=!1;#_=null;#A=0;#S=0;#y=null;#E=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#R=!1;#T=rt._zIndex++;static _borderLineWidth=-1;static _colorManager=new Df;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=rt.prototype._resizeWithKeyboard,e=$i.TRANSLATE_SMALL,n=$i.TRANSLATE_BIG;return Et(this,"_resizerKeyboardManager",new Mo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],rt.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:c}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,a],this.pageTranslation=[o,c];const[h,d]=this.parentDimensions;this.x=t.x/h,this.y=t.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Et(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new r1({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(rt._l10n??=t,rt._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),rt._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);rt._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Gt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#R}set _isDraggable(t){this.#R=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#B(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,a){const[o,c]=this.parentDimensions;[n,a]=this.screenToPageTranslation(n,a),this.x=(t+n)/o,this.y=(e+a)/c,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,a]=this.parentDimensions;this.setAt(t*n,e*a,this.width*n,this.height*a),this._onTranslated()}#w([t,e],n,a){[n,a]=this.screenToPageTranslation(n,a),this.x+=n/t,this.y+=a/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#w(this.parentDimensions,t,e)}translateInPage(t,e){this.#p||=[this.x,this.y,this.width,this.height],this.#w(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#p||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[a,o]}=this;if(this.x+=t/a,this.y+=e/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:_,y}=this.div.getBoundingClientRect();this.parent.findNewParent(this,_,y)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:c,y:h}=this;const[d,f]=this.getBaseTranslation();c+=d,h+=f;const{style:g}=n;g.left=`${(100*c).toFixed(2)}%`,g.top=`${(100*h).toFixed(2)}%`,this._onTranslating(c,h),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#p&&(this.#p[0]!==this.x||this.#p[1]!==this.y)}get _hasBeenResized(){return!!this.#p&&(this.#p[2]!==this.width||this.#p[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=rt,a=n/t,o=n/e;switch(this.rotation){case 90:return[-a,o];case 180:return[a,o];case 270:return[a,-o];default:return[-a,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,a]}=this;let{x:o,y:c,width:h,height:d}=this;if(h*=n,d*=a,o*=n,c*=a,this._mustFixPosition)switch(t){case 0:o=He(o,0,n-h),c=He(c,0,a-d);break;case 90:o=He(o,0,n-d),c=He(c,h,a);break;case 180:o=He(o,h,n),c=He(c,d,a);break;case 270:o=He(o,d,n),c=He(c,0,a-h);break}this.x=o/=n,this.y=c/=a;const[f,g]=this.getBaseTranslation();o+=f,c+=g,e.left=`${(100*o).toFixed(2)}%`,e.top=`${(100*c).toFixed(2)}%`,this.moveInDOM()}static#O(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return rt.#O(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return rt.#O(t,e,360-this.parentRotation)}#x(t){switch(t){case 90:{const[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(t,e){const[n,a]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*t/n).toFixed(2)}%`,this.#o||(o.height=`${(100*e/a).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:n}=t,a=n.endsWith("%"),o=!this.#o&&e.endsWith("%");if(a&&o)return;const[c,h]=this.parentDimensions;a||(t.width=`${(100*parseFloat(n)/c).toFixed(2)}%`),!this.#o&&!o&&(t.height=`${(100*parseFloat(e)/h).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#D(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const a=document.createElement("div");this.#l.append(a),a.classList.add("resizer",n),a.setAttribute("data-resizer-name",n),a.addEventListener("pointerdown",this.#I.bind(this,n),{signal:e}),a.addEventListener("contextmenu",wn,{signal:e}),a.tabIndex=-1}this.div.prepend(this.#l)}#I(t,e){e.preventDefault();const{isMac:n}=Ne.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#n?.toggle(!1);const a=this._isDraggable;this._isDraggable=!1,this.#c=[e.screenX,e.screenY];const o=new AbortController,c=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#P.bind(this,t),{passive:!0,capture:!0,signal:c}),window.addEventListener("touchmove",he,{passive:!1,signal:c}),window.addEventListener("contextmenu",wn,{signal:c}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const h=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const f=()=>{o.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=a,this.parent.div.style.cursor=h,this.div.style.cursor=d,this.#L()};window.addEventListener("pointerup",f,{signal:c}),window.addEventListener("blur",f,{signal:c})}#k(t,e,n,a){this.width=n,this.height=a,this.x=t,this.y=e;const[o,c]=this.parentDimensions;this.setDims(o*n,c*a),this.fixAndSetPosition(),this._onResized()}_onResized(){}#L(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:a}=this.#d;this.#d=null;const o=this.x,c=this.y,h=this.width,d=this.height;o===t&&c===e&&h===n&&d===a||this.addCommands({cmd:this.#k.bind(this,o,c,h,d),undo:this.#k.bind(this,t,e,n,a),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#P(t,e){const[n,a]=this.parentDimensions,o=this.x,c=this.y,h=this.width,d=this.height,f=rt.MIN_SIZE/n,g=rt.MIN_SIZE/a,_=this.#x(this.rotation),y=(I,U)=>[_[0]*I+_[2]*U,_[1]*I+_[3]*U],b=this.#x(360-this.rotation),A=(I,U)=>[b[0]*I+b[2]*U,b[1]*I+b[3]*U];let S,C,w=!1,M=!1;switch(t){case"topLeft":w=!0,S=(I,U)=>[0,0],C=(I,U)=>[I,U];break;case"topMiddle":S=(I,U)=>[I/2,0],C=(I,U)=>[I/2,U];break;case"topRight":w=!0,S=(I,U)=>[I,0],C=(I,U)=>[0,U];break;case"middleRight":M=!0,S=(I,U)=>[I,U/2],C=(I,U)=>[0,U/2];break;case"bottomRight":w=!0,S=(I,U)=>[I,U],C=(I,U)=>[0,0];break;case"bottomMiddle":S=(I,U)=>[I/2,U],C=(I,U)=>[I/2,0];break;case"bottomLeft":w=!0,S=(I,U)=>[0,U],C=(I,U)=>[I,0];break;case"middleLeft":M=!0,S=(I,U)=>[0,U/2],C=(I,U)=>[I,U/2];break}const T=S(h,d),N=C(h,d);let R=y(...N);const k=rt._round(o+R[0]),z=rt._round(c+R[1]);let j=1,$=1,tt,Q;if(e.fromKeyboard)({deltaX:tt,deltaY:Q}=e);else{const{screenX:I,screenY:U}=e,[Z,pt]=this.#c;[tt,Q]=this.screenToPageTranslation(I-Z,U-pt),this.#c[0]=I,this.#c[1]=U}if([tt,Q]=A(tt/n,Q/a),w){const I=Math.hypot(h,d);j=$=Math.max(Math.min(Math.hypot(N[0]-T[0]-tt,N[1]-T[1]-Q)/I,1/h,1/d),f/h,g/d)}else M?j=He(Math.abs(N[0]-T[0]-tt),f,1)/h:$=He(Math.abs(N[1]-T[1]-Q),g,1)/d;const lt=rt._round(h*j),mt=rt._round(d*$);R=y(...C(lt,mt));const Tt=k-R[0],_t=z-R[1];this.#p||=[this.x,this.y,this.width,this.height],this.width=lt,this.height=mt,this.x=Tt,this.y=_t,this.setDims(n*lt,a*mt),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#m)return this._editToolbar;this._editToolbar=new ao(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#n?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(qn.initialize(rt._l10n),this.#n=new qn(this),this.#t&&(this.#n.data=this.#t,this.#t=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(t){this.#n&&(this.#n.data=t)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(t){await this.#n?.setGuessedText(t)}serializeAltText(t){return this.#n?.serialize(t)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}addCommentButton(){return this.#i?this.#i:this.#i=new tc(this)}get commentColor(){return null}get comment(){const t=this.#i;return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){this.#i||(this.#i=new tc(this)),this.#i.data=t}setCommentData(t){this.#i||(this.#i=new tc(this)),this.#i.setInitialText(t)}get hasEditedComment(){return this.#i?.hasBeenEdited()}async editComment(){this.#i||(this.#i=new tc(this)),this.#i.edit()}addComment(t){if(this.hasEditedComment){const[,,,a]=t.rect,[o]=this.pageDimensions,[c]=this.pageTranslation,h=c+o+1,d=a-100,f=h+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[h,d,f,a]}}}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#a?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#U();const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[a,o]=this.getInitialTranslation();return this.translate(a,o),ev(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#E||=new jc({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#N.bind(this),onPinching:this.#H.bind(this),onPinchEnd:this.#C.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),t}#N(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#H(t,e,n){let o=.7*(n/e)+1-.7;if(o===1)return;const c=this.#x(this.rotation),h=(k,z)=>[c[0]*k+c[2]*z,c[1]*k+c[3]*z],[d,f]=this.parentDimensions,g=this.x,_=this.y,y=this.width,b=this.height,A=rt.MIN_SIZE/d,S=rt.MIN_SIZE/f;o=Math.max(Math.min(o,1/y,1/b),A/y,S/b);const C=rt._round(y*o),w=rt._round(b*o);if(C===y&&w===b)return;this.#p||=[g,_,y,b];const M=h(y/2,b/2),T=rt._round(g+M[0]),N=rt._round(_+M[1]),R=h(C/2,w/2);this.x=T-R[0],this.y=N-R[1],this.width=C,this.height=w,this.setDims(d*C,f*w),this.fixAndSetPosition(),this._onResizing()}#C(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#L()}pointerdown(t){const{isMac:e}=Ne.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#z(t);return}this.#v(t)}#v(t){const{isMac:e}=Ne.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#z(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const a=new AbortController,o=this._uiManager.combinedSignal(a),c={capture:!0,passive:!1,signal:o},h=f=>{a.abort(),this.#s=null,this.#g=!1,this._uiManager.endDragSession()||this.#v(f),n&&this._onStopDragging()};e&&(this.#A=t.clientX,this.#S=t.clientY,this.#s=t.pointerId,this.#r=t.pointerType,window.addEventListener("pointermove",f=>{n||(n=!0,this._onStartDragging());const{clientX:g,clientY:_,pointerId:y}=f;if(y!==this.#s){he(f);return}const[b,A]=this.screenToPageTranslation(g-this.#A,_-this.#S);this.#A=g,this.#S=_,this._uiManager.dragSelectedEditors(b,A)},c),window.addEventListener("touchmove",he,c),window.addEventListener("pointerdown",f=>{f.pointerType===this.#r&&(this.#E||f.isPrimary)&&h(f),he(f)},c));const d=f=>{if(!this.#s||this.#s===f.pointerId){h(f);return}he(f)};window.addEventListener("pointerup",d,{signal:o}),window.addEventListener("blur",d,{signal:o})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.#_=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const a=this.parentScale,[o,c]=this.pageDimensions,[h,d]=this.pageTranslation,f=t/a,g=e/a,_=this.x*o,y=this.y*c,b=this.width*o,A=this.height*c;switch(n){case 0:return[_+f+h,c-y-g-A+d,_+f+b+h,c-y-g+d];case 90:return[_+g+h,c-y+f+d,_+g+A+h,c-y+f+b+d];case 180:return[_-f-b+h,c-y+g+d,_-f+h,c-y+g+A+d];case 270:return[_-g-A+h,c-y-f-b+d,_-g+h,c-y-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,a,o,c]=t,h=o-n,d=c-a;switch(this.rotation){case 0:return[n,e-c,h,d];case 90:return[n,e-a,d,h];case 180:return[o,e-a,h,d];case 270:return[o,e-c,d,h];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#m=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#m=!1,!0):!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#b}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:a}=this.getClientDimensions(),{innerHeight:o,innerWidth:c}=window;return e<c&&a>0&&t<o&&n>0}#U(){if(this.#u||!this.div)return;this.#u=new AbortController;const t=this._uiManager.combinedSignal(this.#u);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#U()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){Gt("An editor must be serializable")}static async deserialize(t,e,n){const a=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId});a.rotation=t.rotation,a.#t=t.accessibilityData,a._isCopy=t.isCopy||!1;const[o,c]=a.pageDimensions,[h,d,f,g]=a.getRectInCurrentCoords(t.rect,c);return a.x=h/o,a.y=d/c,a.width=f/o,a.height=g/c,a}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#u?.abort(),this.#u=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#_&&(clearTimeout(this.#_),this.#_=null),this.#B(),this.removeEditToolbar(),this.#y){for(const t of this.#y.values())clearTimeout(t);this.#y=null}this.parent=null,this.#E?.destroy(),this.#E=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#D(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#l.children;if(!this.#e){this.#e=Array.from(e);const c=this.#j.bind(this),h=this.#$.bind(this),d=this._uiManager._signal;for(const f of this.#e){const g=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",c,{signal:d}),f.addEventListener("blur",h,{signal:d}),f.addEventListener("focus",this.#Y.bind(this,g),{signal:d}),f.setAttribute("data-l10n-id",rt._l10nResizer[g])}}const n=this.#e[0];let a=0;for(const c of e){if(c===n)break;a++}const o=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(o!==a){if(o<a)for(let h=0;h<a-o;h++)this.#l.append(this.#l.firstChild);else if(o>a)for(let h=0;h<o-a;h++)this.#l.firstChild.before(this.#l.lastChild);let c=0;for(const h of e){const f=this.#e[c++].getAttribute("data-resizer-name");h.setAttribute("data-l10n-id",rt._l10nResizer[f])}}this.#X(0),this.#b=!0,this.#l.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#j(t){rt._resizerKeyboardManager.exec(this,t)}#$(t){this.#b&&t.relatedTarget?.parentNode!==this.#l&&this.#B()}#Y(t){this.#f=this.#b?t:""}#X(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#b&&this.#P(this.#f,{deltaX:t,deltaY:e,fromKeyboard:!0})}#B(){this.#b=!1,this.#X(-1),this.#L()}_stopResizingWithKeyboard(){this.#B(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#h}set isEditing(t){this.#h=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#o=!0;const n=t/e,{style:a}=this.div;a.aspectRatio=n,a.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#y||=new Map;const{action:n}=t;let a=this.#y.get(n);a&&clearTimeout(a),a=setTimeout(()=>{this._reportTelemetry(t),this.#y.delete(n),this.#y.size===0&&(this.#y=null)},rt._telemetryTimeout),this.#y.set(n,a);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#a=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#a=!0}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class r1 extends rt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Ny=3285377520,vn=4294901760,jn=65535;class nv{constructor(t){this.h1=t?t&4294967295:Ny,this.h2=t?t&4294967295:Ny}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let S=0,C=t.length;S<C;S++){const w=t.charCodeAt(S);w<=255?e[n++]=w:(e[n++]=w>>>8,e[n++]=w&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const a=n>>2,o=n-a*4,c=new Uint32Array(e.buffer,0,a);let h=0,d=0,f=this.h1,g=this.h2;const _=3432918353,y=461845907,b=_&jn,A=y&jn;for(let S=0;S<a;S++)S&1?(h=c[S],h=h*_&vn|h*b&jn,h=h<<15|h>>>17,h=h*y&vn|h*A&jn,f^=h,f=f<<13|f>>>19,f=f*5+3864292196):(d=c[S],d=d*_&vn|d*b&jn,d=d<<15|d>>>17,d=d*y&vn|d*A&jn,g^=d,g=g<<13|g>>>19,g=g*5+3864292196);switch(h=0,o){case 3:h^=e[a*4+2]<<16;case 2:h^=e[a*4+1]<<8;case 1:h^=e[a*4],h=h*_&vn|h*b&jn,h=h<<15|h>>>17,h=h*y&vn|h*A&jn,a&1?f^=h:g^=h}this.h1=f,this.h2=g}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&vn|t*36045&jn,e=e*4283543511&vn|((e<<16|t>>>16)*2950163797&vn)>>>16,t^=e>>>1,t=t*444984403&vn|t*60499&jn,e=e*3301882366&vn|((e<<16|t>>>16)*3120437893&vn)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Yd=Object.freeze({map:null,hash:"",transfer:void 0});class Mf{#t=!1;#e=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#n.get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return this.#n.get(t)}remove(t){if(this.#n.delete(t),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of this.#n.values())if(e instanceof rt)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#n.get(t);let a=!1;if(n!==void 0)for(const[o,c]of Object.entries(e))n[o]!==c&&(a=!0,n[o]=c);else a=!0,this.#n.set(t,e);a&&this.#i(),e instanceof rt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#n.has(t)}get size(){return this.#n.size}#i(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new iv(this)}get serializable(){if(this.#n.size===0)return Yd;const t=new Map,e=new nv,n=[],a=Object.create(null);let o=!1;for(const[c,h]of this.#n){const d=h instanceof rt?h.serialize(!1,a):h;d&&(t.set(c,d),e.update(`${c}:${JSON.stringify(d)}`),o||=!!d.bitmap)}if(o)for(const c of t.values())c.bitmap&&n.push(c.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:Yd}get editorStats(){let t=null;const e=new Map;for(const n of this.#n.values()){if(!(n instanceof rt))continue;const a=n.telemetryFinalData;if(!a)continue;const{type:o}=a;e.has(o)||e.set(o,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const c=t[o]||=new Map;for(const[h,d]of Object.entries(a)){if(h==="type")continue;let f=c.get(h);f||(f=new Map,c.set(h,f));const g=f.get(d)??0;f.set(d,g+1)}}for(const[n,a]of e)t[n]=a.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;const t=[];for(const e of this.#n.values())!(e instanceof rt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class iv extends Mf{#t;constructor(t){super();const{map:e,hash:n,transfer:a}=t.serializable,o=structuredClone(e,a?{transfer:a}:null);this.#t={map:o,hash:n,transfer:a}}get print(){Gt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return Et(this,"modifiedIds",{ids:new Set,hash:""})}}class o1{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(!(!t||this.#t.has(t.loadedName))){if(de(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:a,src:o,style:c}=t,h=new FontFace(a,o,c);this.addNativeFontFace(h);try{await h.load(),this.#t.add(a),n?.(t)}catch{gt(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(h)}return}Gt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(a){throw gt(`Failed to load font '${n.family}': '${a}'.`),t.disableFontFace=!0,a}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const a=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,a)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return Et(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Et(this,"isSyncFontLoadingSupported",Fe||Ne.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(de(!a.done,"completeRequest() cannot be called twice."),a.done=!0;n.length>0&&n[0].done;){const o=n.shift();setTimeout(o.callback,0)}}const{loadingRequests:n}=this,a={done:!1,complete:e,callback:t};return n.push(a),a}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Et(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(N,R){return N.charCodeAt(R)<<24|N.charCodeAt(R+1)<<16|N.charCodeAt(R+2)<<8|N.charCodeAt(R+3)&255}function a(N,R,k,z){const j=N.substring(0,R),$=N.substring(R+k);return j+z+$}let o,c;const h=this._document.createElement("canvas");h.width=1,h.height=1;const d=h.getContext("2d");let f=0;function g(N,R){if(++f>30){gt("Load test font never loaded."),R();return}if(d.font="30px "+N,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){R();return}setTimeout(g.bind(null,N,R))}const _=`lt${Date.now()}${this.loadTestFontId++}`;let y=this._loadTestFont;y=a(y,976,_.length,_);const A=16,S=1482184792;let C=n(y,A);for(o=0,c=_.length-3;o<c;o+=4)C=C-S+n(_,o)|0;o<_.length&&(C=C-S+n(_+"XXX",o)|0),y=a(y,A,4,qE(C));const w=`url(data:font/opentype;base64,${btoa(y)});`,M=`@font-face {font-family:"${_}";src:${w}}`;this.insertRule(M);const T=this._document.createElement("div");T.style.visibility="hidden",T.style.width=T.style.height="10px",T.style.position="absolute",T.style.top=T.style.left="0px";for(const N of[t.loadedName,_]){const R=this._document.createElement("span");R.textContent="Hi",R.style.fontFamily=N,T.append(R)}this._document.body.append(T),g(_,()=>{T.remove(),e.complete()})}}class l1{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const n in t)this[n]=t[n];this._inspectFont=e}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${tv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let a;try{a=t.get(n)}catch(c){gt(`getPathGenerator - ignoring character: "${c}".`)}const o=new Path2D(a||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=o}}function c1(r){if(r instanceof URL)return r.href;if(typeof r=="string"){if(Fe)return r;const t=URL.parse(r,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function u1(r){if(Fe&&typeof Buffer<"u"&&r instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength)return r;if(typeof r=="string")return xo(r);if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)||typeof r=="object"&&!isNaN(r?.length))return new Uint8Array(r);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function ec(r){if(typeof r!="string")return null;if(r.endsWith("/"))return r;throw new Error(`Invalid factory url: "${r}" must include trailing slash.`)}const Xd=r=>typeof r=="object"&&Number.isInteger(r?.num)&&r.num>=0&&Number.isInteger(r?.gen)&&r.gen>=0,h1=r=>typeof r=="object"&&typeof r?.name=="string",d1=KE.bind(null,Xd,h1);class f1{#t=new Map;#e=Promise.resolve();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[a]of this.#t)a.call(this,n)})}addEventListener(t,e,n=null){let a=null;if(n?.signal instanceof AbortSignal){const{signal:o}=n;if(o.aborted){gt("LoopbackPort - cannot use an `aborted` signal.");return}const c=()=>this.removeEventListener(t,e);a=()=>o.removeEventListener("abort",c),o.addEventListener("abort",c)}this.#t.set(e,a)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const nc={DATA:1,ERROR:2},ce={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Oy(){}function Xe(r){if(r instanceof Xi||r instanceof jd||r instanceof Ry||r instanceof gc||r instanceof Sd)return r;switch(r instanceof Error||typeof r=="object"&&r!==null||Gt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),r.name){case"AbortException":return new Xi(r.message);case"InvalidPDFException":return new jd(r.message);case"PasswordException":return new Ry(r.message,r.code);case"ResponseException":return new gc(r.message,r.status,r.missing);case"UnknownErrorException":return new Sd(r.message,r.details)}return new Sd(r.message,r.toString())}class io{#t=new AbortController;constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#i(t);return}if(t.callback){const n=t.callbackId,a=this.callbackCapabilities[n];if(!a)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===nc.DATA)a.resolve(t.data);else if(t.callback===nc.ERROR)a.reject(Xe(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,a=t.sourceName,o=this.comObj;Promise.try(e,t.data).then(function(c){o.postMessage({sourceName:n,targetName:a,callback:nc.DATA,callbackId:t.callbackId,data:c})},function(c){o.postMessage({sourceName:n,targetName:a,callback:nc.ERROR,callbackId:t.callbackId,reason:Xe(c)})});return}if(t.streamId){this.#n(t);return}e(t.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const a=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[a]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:a,data:e},n)}catch(c){o.reject(c)}return o.promise}sendWithStream(t,e,n,a){const o=this.streamId++,c=this.sourceName,h=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const g=Promise.withResolvers();return this.streamControllers[o]={controller:f,startCall:g,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:c,targetName:h,action:t,streamId:o,data:e,desiredSize:f.desiredSize},a),g.promise},pull:f=>{const g=Promise.withResolvers();return this.streamControllers[o].pullCall=g,d.postMessage({sourceName:c,targetName:h,stream:ce.PULL,streamId:o,desiredSize:f.desiredSize}),g.promise},cancel:f=>{de(f instanceof Error,"cancel must have a valid reason");const g=Promise.withResolvers();return this.streamControllers[o].cancelCall=g,this.streamControllers[o].isClosed=!0,d.postMessage({sourceName:c,targetName:h,stream:ce.CANCEL,streamId:o,reason:Xe(f)}),g.promise}},n)}#n(t){const e=t.streamId,n=this.sourceName,a=t.sourceName,o=this.comObj,c=this,h=this.actionHandler[t.action],d={enqueue(f,g=1,_){if(this.isCancelled)return;const y=this.desiredSize;this.desiredSize-=g,y>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:a,stream:ce.ENQUEUE,streamId:e,chunk:f},_)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:a,stream:ce.CLOSE,streamId:e}),delete c.streamSinks[e])},error(f){de(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:a,stream:ce.ERROR,streamId:e,reason:Xe(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[e]=d,Promise.try(h,t.data,d).then(function(){o.postMessage({sourceName:n,targetName:a,stream:ce.START_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:a,stream:ce.START_COMPLETE,streamId:e,reason:Xe(f)})})}#i(t){const e=t.streamId,n=this.sourceName,a=t.sourceName,o=this.comObj,c=this.streamControllers[e],h=this.streamSinks[e];switch(t.stream){case ce.START_COMPLETE:t.success?c.startCall.resolve():c.startCall.reject(Xe(t.reason));break;case ce.PULL_COMPLETE:t.success?c.pullCall.resolve():c.pullCall.reject(Xe(t.reason));break;case ce.PULL:if(!h){o.postMessage({sourceName:n,targetName:a,stream:ce.PULL_COMPLETE,streamId:e,success:!0});break}h.desiredSize<=0&&t.desiredSize>0&&h.sinkCapability.resolve(),h.desiredSize=t.desiredSize,Promise.try(h.onPull||Oy).then(function(){o.postMessage({sourceName:n,targetName:a,stream:ce.PULL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:a,stream:ce.PULL_COMPLETE,streamId:e,reason:Xe(f)})});break;case ce.ENQUEUE:if(de(c,"enqueue should have stream controller"),c.isClosed)break;c.controller.enqueue(t.chunk);break;case ce.CLOSE:if(de(c,"close should have stream controller"),c.isClosed)break;c.isClosed=!0,c.controller.close(),this.#a(c,e);break;case ce.ERROR:de(c,"error should have stream controller"),c.controller.error(Xe(t.reason)),this.#a(c,e);break;case ce.CANCEL_COMPLETE:t.success?c.cancelCall.resolve():c.cancelCall.reject(Xe(t.reason)),this.#a(c,e);break;case ce.CANCEL:if(!h)break;const d=Xe(t.reason);Promise.try(h.onCancel||Oy,d).then(function(){o.postMessage({sourceName:n,targetName:a,stream:ce.CANCEL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:a,stream:ce.CANCEL_COMPLETE,streamId:e,reason:Xe(f)})}),h.sinkCapability.reject(d),h.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class sv{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Gt("Abstract method `_createCanvas` called.")}}class p1 extends sv{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class av{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Gt("Abstract method `_fetch` called.")}}class ky extends av{async _fetch(t){const e=await Ro(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):xo(e)}}class rv{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,a,o){return"none"}destroy(t=!1){}}class g1 extends rv{#t;#e;#n;#i;#a;#s;#r=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#i=t,this.#a=e}get#o(){return this.#e||=new Map}get#l(){return this.#s||=new Map}get#c(){if(!this.#n){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#a.createElementNS(li,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#n=this.#a.createElementNS(li,"defs"),t.append(n),n.append(this.#n),this.#a.body.append(t)}return this.#n}#d(t){if(t.length===1){const d=t[0],f=new Array(256);for(let _=0;_<256;_++)f[_]=d[_]/255;const g=f.join(",");return[g,g,g]}const[e,n,a]=t,o=new Array(256),c=new Array(256),h=new Array(256);for(let d=0;d<256;d++)o[d]=e[d]/255,c[d]=n[d]/255,h[d]=a[d]/255;return[o.join(","),c.join(","),h.join(",")]}#u(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(Uc(e)?gt('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Qb(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[n,a,o]=this.#d(t),c=t.length===1?n:`${n}${a}${o}`;if(e=this.#o.get(c),e)return this.#o.set(t,e),e;const h=`g_${this.#i}_transfer_map_${this.#r++}`,d=this.#u(h);this.#o.set(t,d),this.#o.set(c,d);const f=this.#p(h);return this.#m(n,a,o,f),d}addHCMFilter(t,e){const n=`${t}-${e}`,a="base";let o=this.#l.get(a);if(o?.key===n||(o?(o.filter?.remove(),o.key=n,o.url="none",o.filter=null):(o={key:n,url:"none",filter:null},this.#l.set(a,o)),!t||!e))return o.url;const c=this.#_(t);t=nt.makeHexColor(...c);const h=this.#_(e);if(e=nt.makeHexColor(...h),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return o.url;const d=new Array(256);for(let b=0;b<=255;b++){const A=b/255;d[b]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const f=d.join(","),g=`g_${this.#i}_hcm_filter`,_=o.filter=this.#p(g);this.#m(f,f,f,_),this.#g(_);const y=(b,A)=>{const S=c[b]/255,C=h[b]/255,w=new Array(A+1);for(let M=0;M<=A;M++)w[M]=S+M/A*(C-S);return w.join(",")};return this.#m(y(0,5),y(1,5),y(2,5),_),o.url=this.#u(g),o.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[n]=this.#d([t]),a=`alpha_${n}`;if(e=this.#o.get(a),e)return this.#o.set(t,e),e;const o=`g_${this.#i}_alpha_map_${this.#r++}`,c=this.#u(o);this.#o.set(t,c),this.#o.set(a,c);const h=this.#p(o);return this.#b(n,h),c}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let n,a;if(t?([n]=this.#d([t]),a=`luminosity_${n}`):a="luminosity",e=this.#o.get(a),e)return this.#o.set(t,e),e;const o=`g_${this.#i}_luminosity_map_${this.#r++}`,c=this.#u(o);this.#o.set(t,c),this.#o.set(a,c);const h=this.#p(o);return this.#f(h),t&&this.#b(n,h),c}addHighlightHCMFilter(t,e,n,a,o){const c=`${e}-${n}-${a}-${o}`;let h=this.#l.get(t);if(h?.key===c||(h?(h.filter?.remove(),h.key=c,h.url="none",h.filter=null):(h={key:c,url:"none",filter:null},this.#l.set(t,h)),!e||!n))return h.url;const[d,f]=[e,n].map(this.#_.bind(this));let g=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),_=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[y,b]=[a,o].map(this.#_.bind(this));_<g&&([g,_,y,b]=[_,g,b,y]),this.#c.style.color="";const A=(w,M,T)=>{const N=new Array(256),R=(_-g)/T,k=w/255,z=(M-w)/(255*T);let j=0;for(let $=0;$<=T;$++){const tt=Math.round(g+$*R),Q=k+$*z;for(let lt=j;lt<=tt;lt++)N[lt]=Q;j=tt+1}for(let $=j;$<256;$++)N[$]=N[j-1];return N.join(",")},S=`g_${this.#i}_hcm_${t}_filter`,C=h.filter=this.#p(S);return this.#g(C),this.#m(A(y[0],b[0],5),A(y[1],b[1],5),A(y[2],b[2],5),C),h.url=this.#u(S),h.url}destroy(t=!1){t&&this.#s?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#e?.clear(),this.#e=null,this.#s?.clear(),this.#s=null,this.#r=0)}#f(t){const e=this.#a.createElementNS(li,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#a.createElementNS(li,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){const e=this.#a.createElementNS(li,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#h(t,e,n){const a=this.#a.createElementNS(li,e);a.setAttribute("type","discrete"),a.setAttribute("tableValues",n),t.append(a)}#m(t,e,n,a){const o=this.#a.createElementNS(li,"feComponentTransfer");a.append(o),this.#h(o,"feFuncR",t),this.#h(o,"feFuncG",e),this.#h(o,"feFuncB",n)}#b(t,e){const n=this.#a.createElementNS(li,"feComponentTransfer");e.append(n),this.#h(n,"feFuncA",t)}#_(t){return this.#c.style.color=t,Gc(getComputedStyle(this.#c).getPropertyValue("color"))}}class ov{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Gt("Abstract method `_fetch` called.")}}class Ly extends ov{async _fetch(t){const e=await Ro(t,"arraybuffer");return new Uint8Array(e)}}class lv{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Gt("Abstract method `_fetch` called.")}}class Iy extends lv{async _fetch(t){const e=await Ro(t,"arraybuffer");return new Uint8Array(e)}}Fe&&gt("Please use the `legacy` build in Node.js environments.");async function Nf(r){const e=await process.getBuiltinModule("fs").promises.readFile(r);return new Uint8Array(e)}class m1 extends rv{}class _1 extends sv{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class y1 extends av{async _fetch(t){return Nf(t)}}class b1 extends ov{async _fetch(t){return Nf(t)}}class v1 extends lv{async _fetch(t){return Nf(t)}}const Aa="__forcedDependency";class A1{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Aa]:[]};#n=new Map;#i=[];#a=[];#s=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#c=new Set;#d=new Map;#u=new Map;#f;#g;constructor(t){this.#f=t.width,this.#g=t.height}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Aa]:{__proto__:this.#e[Aa]}},this.#r={__proto__:this.#r},this.#i.push([t,null]),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#r=Object.getPrototypeOf(this.#r);const n=this.#i.pop();return n!==void 0&&(n[1]=t),this}recordOpenMarker(t){return this.#i.push([t,null]),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)[0]}recordCloseMarker(t){const e=this.#i.pop();return e!==void 0&&(e[1]=t),this}beginMarkedContent(t){return this.#a.push([t,null]),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(e[1]=t),this}pushBaseTransform(t){return this.#s.push(nt.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform())),this}popBaseTransform(){return this.#s.length>1&&this.#s.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#n.set(t,e),this}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Aa,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#c)this.recordFutureForcedDependency(Aa,t);return this}resetBBox(t){return this.#l=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0,this}get hasPendingBBox(){return this.#l!==-1}recordClipBox(t,e,n,a,o,c){const h=nt.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform()),d=[1/0,1/0,-1/0,-1/0];nt.axialAlignedBoundingBox([n,o,a,c],h,d);const f=nt.intersect(this.#r,d);return f?(this.#r[0]=f[0],this.#r[1]=f[1],this.#r[2]=f[2],this.#r[3]=f[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(t,e,n,a,o,c){const h=this.#r;if(h[0]===1/0)return this;const d=nt.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform());if(h[0]===-1/0)return nt.axialAlignedBoundingBox([n,o,a,c],d,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return nt.axialAlignedBoundingBox([n,o,a,c],d,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],h[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],h[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],h[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],h[3])),this}recordCharacterBBox(t,e,n,a=1,o=0,c=0,h){const d=n.bbox;let f,g;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&this.#u.get(n),f!==!1&&(g=[0,0,0,0],nt.axialAlignedBoundingBox(d,n.fontMatrix,g),(a!==1||o!==0||c!==0)&&nt.scaleMinMax([a,0,0,-a,o,c],g),f)))return this.recordBBox(t,e,g[0],g[2],g[1],g[3]);if(!h)return this.recordFullPageBBox(t);const _=h();return d&&g&&f===void 0&&(f=g[0]<=o-_.actualBoundingBoxLeft&&g[2]>=o+_.actualBoundingBoxRight&&g[1]<=c-_.actualBoundingBoxAscent&&g[3]>=c+_.actualBoundingBoxDescent,this.#u.set(n,f),f)?this.recordBBox(t,e,g[0],g[2],g[1],g[3]):this.recordBBox(t,e,o-_.actualBoundingBoxLeft,o+_.actualBoundingBoxRight,c-_.actualBoundingBoxAscent,c+_.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#f,this.#r[2]),this.#o[3]=Math.min(this.#g,this.#r[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const n=this.#c,a=this.#t,o=this.#e;for(const c of e)c in this.#t?n.add(a[c]):c in o&&o[c].forEach(n.add,n);return this}copyDependenciesFromIncrementalOperation(t,e){const n=this.#d,a=this.#c;for(const o of this.#e[e])n.get(o).dependencies.forEach(a.add,a.add(o));return this}recordNamedDependency(t,e){return this.#n.has(e)&&this.#c.add(this.#n.get(e)),this}recordOperation(t,e=!1){this.recordDependencies(t,[Aa]);const n=new Set(this.#c),a=this.#i.concat(this.#a),o=this.#l===t?{minX:this.#o[0],minY:this.#o[1],maxX:this.#o[2],maxY:this.#o[3]}:null;return this.#d.set(t,{bbox:o,pairs:a,dependencies:n}),e||(this.#l=-1),this.#c.clear(),this}bboxToClipBoxDropOperation(t){return this.#l!==-1&&(this.#l=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3])),this.#c.clear(),this}_takePendingDependencies(){const t=this.#c;return this.#c=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#c.add(e)}take(){return this.#u.clear(),Array.from(this.#d,([t,{bbox:e,pairs:n,dependencies:a}])=>(n.forEach(o=>o.forEach(a.add,a)),a.delete(t),{minX:(e?.minX??0)/this.#f,maxX:(e?.maxX??this.#f)/this.#f,minY:(e?.minY??0)/this.#g,maxY:(e?.maxY??this.#g)/this.#g,dependencies:Array.from(a).sort((o,c)=>o-c),idx:t}))}}class mc{#t;#e;#n=0;#i;#a=0;constructor(t,e){if(t instanceof mc)return t;this.#t=t,this.#i=t._takePendingDependencies(),this.#e=e}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#n--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#t.hasPendingBBox||this.#t.resetBBox(this.#e),this}get hasPendingBBox(){return this.#t.hasPendingBBox}recordClipBox(t,e,n,a,o,c){return this.#t.recordClipBox(this.#e,e,n,a,o,c),this}recordBBox(t,e,n,a,o,c){return this.#t.recordBBox(this.#e,e,n,a,o,c),this}recordCharacterBBox(t,e,n,a,o,c,h){return this.#t.recordCharacterBBox(this.#e,e,n,a,o,c,h),this}recordFullPageBBox(t){return this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}copyDependenciesFromIncrementalOperation(t,e){return this.#t.copyDependenciesFromIncrementalOperation(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){this.#t.recordOperation(this.#e,!0);const e=this.#t._extractOperation(this.#e);for(const n of e.dependencies)this.#i.add(n);return this.#i.delete(this.#e),this.#i.delete(null),this}bboxToClipBoxDropOperation(t){return this.#t.bboxToClipBoxDropOperation(this.#e),this}recordNestedDependencies(){this.#t._pushPendingDependencies(this.#i)}take(){throw new Error("Unreachable")}}const An={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation"],transform:["transform"],transformAndFill:["transform","fillColor"]},De={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function $d(r,t){if(!t)return;const e=t[2]-t[0],n=t[3]-t[1],a=new Path2D;a.rect(t[0],t[1],e,n),r.clip(a)}class Of{isModifyingCurrentTransform(){return!1}getPattern(){Gt("Abstract method `getPattern` called.")}}class S1 extends Of{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,a){let o;if(a===De.STROKE||a===De.FILL){const c=e.current.getClippedPathBoundingBox(a,Jt(t))||[0,0,0,0],h=Math.ceil(c[2]-c[0])||1,d=Math.ceil(c[3]-c[1])||1,f=e.cachedCanvases.getCanvas("pattern",h,d),g=f.context;g.clearRect(0,0,g.canvas.width,g.canvas.height),g.beginPath(),g.rect(0,0,g.canvas.width,g.canvas.height),g.translate(-c[0],-c[1]),n=nt.transform(n,[1,0,0,1,c[0],c[1]]),g.transform(...e.baseTransform),this.matrix&&g.transform(...this.matrix),$d(g,this._bbox),g.fillStyle=this._createGradient(g),g.fill(),o=t.createPattern(f.canvas,"no-repeat");const _=new DOMMatrix(n);o.setTransform(_)}else $d(t,this._bbox),o=this._createGradient(t);return o}}function Cd(r,t,e,n,a,o,c,h){const d=t.coords,f=t.colors,g=r.data,_=r.width*4;let y;d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=o,o=c,c=y),d[n+1]>d[a+1]&&(y=n,n=a,a=y,y=c,c=h,h=y),d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=o,o=c,c=y);const b=(d[e]+t.offsetX)*t.scaleX,A=(d[e+1]+t.offsetY)*t.scaleY,S=(d[n]+t.offsetX)*t.scaleX,C=(d[n+1]+t.offsetY)*t.scaleY,w=(d[a]+t.offsetX)*t.scaleX,M=(d[a+1]+t.offsetY)*t.scaleY;if(A>=M)return;const T=f[o],N=f[o+1],R=f[o+2],k=f[c],z=f[c+1],j=f[c+2],$=f[h],tt=f[h+1],Q=f[h+2],lt=Math.round(A),mt=Math.round(M);let Tt,_t,I,U,Z,pt,D,q;for(let W=lt;W<=mt;W++){if(W<C){const Mt=W<A?0:(A-W)/(A-C);Tt=b-(b-S)*Mt,_t=T-(T-k)*Mt,I=N-(N-z)*Mt,U=R-(R-j)*Mt}else{let Mt;W>M?Mt=1:C===M?Mt=0:Mt=(C-W)/(C-M),Tt=S-(S-w)*Mt,_t=k-(k-$)*Mt,I=z-(z-tt)*Mt,U=j-(j-Q)*Mt}let X;W<A?X=0:W>M?X=1:X=(A-W)/(A-M),Z=b-(b-w)*X,pt=T-(T-$)*X,D=N-(N-tt)*X,q=R-(R-Q)*X;const it=Math.round(Math.min(Tt,Z)),yt=Math.round(Math.max(Tt,Z));let at=_*W+it*4;for(let Mt=it;Mt<=yt;Mt++)X=(Tt-Mt)/(Tt-Z),X<0?X=0:X>1&&(X=1),g[at++]=_t-(_t-pt)*X|0,g[at++]=I-(I-D)*X|0,g[at++]=U-(U-q)*X|0,g[at++]=255}}function E1(r,t,e){const n=t.coords,a=t.colors;let o,c;switch(t.type){case"lattice":const h=t.verticesPerRow,d=Math.floor(n.length/h)-1,f=h-1;for(o=0;o<d;o++){let g=o*h;for(let _=0;_<f;_++,g++)Cd(r,e,n[g],n[g+1],n[g+h],a[g],a[g+1],a[g+h]),Cd(r,e,n[g+h+1],n[g+1],n[g+h],a[g+h+1],a[g+1],a[g+h])}break;case"triangles":for(o=0,c=n.length;o<c;o+=3)Cd(r,e,n[o],n[o+1],n[o+2],a[o],a[o+1],a[o+2]);break;default:throw new Error("illegal figure")}}class w1 extends Of{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const h=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-h,g=Math.ceil(this._bounds[3])-d,_=Math.min(Math.ceil(Math.abs(f*t[0]*1.1)),3e3),y=Math.min(Math.ceil(Math.abs(g*t[1]*1.1)),3e3),b=f/_,A=g/y,S={coords:this._coords,colors:this._colors,offsetX:-h,offsetY:-d,scaleX:1/b,scaleY:1/A},C=_+4,w=y+4,M=n.getCanvas("mesh",C,w),T=M.context,N=T.createImageData(_,y);if(e){const k=N.data;for(let z=0,j=k.length;z<j;z+=4)k[z]=e[0],k[z+1]=e[1],k[z+2]=e[2],k[z+3]=255}for(const k of this._figures)E1(N,k,S);return T.putImageData(N,2,2),{canvas:M.canvas,offsetX:h-2*b,offsetY:d-2*A,scaleX:b,scaleY:A}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,a){$d(t,this._bbox);const o=new Float32Array(2);if(a===De.SHADING)nt.singularValueDecompose2dScale(Jt(t),o);else if(this.matrix){nt.singularValueDecompose2dScale(this.matrix,o);const[h,d]=o;nt.singularValueDecompose2dScale(e.baseTransform,o),o[0]*=h,o[1]*=d}else nt.singularValueDecompose2dScale(e.baseTransform,o);const c=this._createMeshCanvas(o,a===De.SHADING?null:this._background,e.cachedCanvases);return a!==De.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(c.offsetX,c.offsetY),t.scale(c.scaleX,c.scaleY),t.createPattern(c.canvas,"no-repeat")}}class C1 extends Of{getPattern(){return"hotpink"}}function T1(r){switch(r[0]){case"RadialAxial":return new S1(r);case"Mesh":return new w1(r);case"Dummy":return new C1}throw new Error(`Unknown IR type: ${r[0]}`)}const Py={COLORED:1,UNCOLORED:2};class kf{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,a){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=a}createPatternCanvas(t){const{bbox:e,operatorList:n,paintType:a,tilingType:o,color:c,canvasGraphicsFactory:h}=this;let{xstep:d,ystep:f}=this;d=Math.abs(d),f=Math.abs(f),zc("TilingType: "+o);const g=e[0],_=e[1],y=e[2],b=e[3],A=y-g,S=b-_,C=new Float32Array(2);nt.singularValueDecompose2dScale(this.matrix,C);const[w,M]=C;nt.singularValueDecompose2dScale(this.baseTransform,C);const T=w*C[0],N=M*C[1];let R=A,k=S,z=!1,j=!1;const $=Math.ceil(d*T),tt=Math.ceil(f*N),Q=Math.ceil(A*T),lt=Math.ceil(S*N);$>=Q?R=d:z=!0,tt>=lt?k=f:j=!0;const mt=this.getSizeAndScale(R,this.ctx.canvas.width,T),Tt=this.getSizeAndScale(k,this.ctx.canvas.height,N),_t=t.cachedCanvases.getCanvas("pattern",mt.size,Tt.size),I=_t.context,U=h.createCanvasGraphics(I);if(U.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(U,a,c),I.translate(-mt.scale*g,-Tt.scale*_),U.transform(0,mt.scale,0,0,Tt.scale,0,0),I.save(),U.dependencyTracker?.save(),this.clipBbox(U,g,_,y,b),U.baseTransform=Jt(U.ctx),U.executeOperatorList(n),U.endDrawing(),U.dependencyTracker?.restore().recordNestedDependencies?.(),I.restore(),z||j){const Z=_t.canvas;z&&(R=d),j&&(k=f);const pt=this.getSizeAndScale(R,this.ctx.canvas.width,T),D=this.getSizeAndScale(k,this.ctx.canvas.height,N),q=pt.size,W=D.size,X=t.cachedCanvases.getCanvas("pattern-workaround",q,W),it=X.context,yt=z?Math.floor(A/d):0,at=j?Math.floor(S/f):0;for(let Mt=0;Mt<=yt;Mt++)for(let Pt=0;Pt<=at;Pt++)it.drawImage(Z,q*Mt,W*Pt,q,W,0,0,q,W);return{canvas:X.canvas,scaleX:pt.scale,scaleY:D.scale,offsetX:g,offsetY:_}}return{canvas:_t.canvas,scaleX:mt.scale,scaleY:Tt.scale,offsetX:g,offsetY:_}}getSizeAndScale(t,e,n){const a=Math.max(kf.MAX_PATTERN_SIZE,e);let o=Math.ceil(t*n);return o>=a?o=a:n=o/t,{scale:n,size:o}}clipBbox(t,e,n,a,o){const c=a-e,h=o-n;t.ctx.rect(e,n,c,h),nt.axialAlignedBoundingBox([e,n,a,o],Jt(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const a=t.ctx,o=t.current;switch(e){case Py.COLORED:const{fillStyle:c,strokeStyle:h}=this.ctx;a.fillStyle=o.fillColor=c,a.strokeStyle=o.strokeColor=h;break;case Py.UNCOLORED:a.fillStyle=a.strokeStyle=n,o.fillColor=o.strokeColor=n;break;default:throw new VE(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,a){let o=n;a!==De.SHADING&&(o=nt.transform(o,e.baseTransform),this.matrix&&(o=nt.transform(o,this.matrix)));const c=this.createPatternCanvas(e);let h=new DOMMatrix(o);h=h.translate(c.offsetX,c.offsetY),h=h.scale(1/c.scaleX,1/c.scaleY);const d=t.createPattern(c.canvas,"repeat");return d.setTransform(h),d}}function x1({src:r,srcPos:t=0,dest:e,width:n,height:a,nonBlackColor:o=4294967295,inverseDecode:c=!1}){const h=Ne.isLittleEndian?4278190080:255,[d,f]=c?[o,h]:[h,o],g=n>>3,_=n&7,y=r.length;e=new Uint32Array(e.buffer);let b=0;for(let A=0;A<a;A++){for(const C=t+g;t<C;t++){const w=t<y?r[t]:255;e[b++]=w&128?f:d,e[b++]=w&64?f:d,e[b++]=w&32?f:d,e[b++]=w&16?f:d,e[b++]=w&8?f:d,e[b++]=w&4?f:d,e[b++]=w&2?f:d,e[b++]=w&1?f:d}if(_===0)continue;const S=t<y?r[t++]:255;for(let C=0;C<_;C++)e[b++]=S&1<<7-C?f:d}return{srcPos:t,destPos:b}}const By=16,Fy=100,R1=15,Hy=10,$e=16,Td=new DOMMatrix,un=new Float32Array(2),xa=new Float32Array([1/0,1/0,-1/0,-1/0]);function D1(r,t){if(r._removeMirroring)throw new Error("Context is already forwarding operations.");r.__originalSave=r.save,r.__originalRestore=r.restore,r.__originalRotate=r.rotate,r.__originalScale=r.scale,r.__originalTranslate=r.translate,r.__originalTransform=r.transform,r.__originalSetTransform=r.setTransform,r.__originalResetTransform=r.resetTransform,r.__originalClip=r.clip,r.__originalMoveTo=r.moveTo,r.__originalLineTo=r.lineTo,r.__originalBezierCurveTo=r.bezierCurveTo,r.__originalRect=r.rect,r.__originalClosePath=r.closePath,r.__originalBeginPath=r.beginPath,r._removeMirroring=()=>{r.save=r.__originalSave,r.restore=r.__originalRestore,r.rotate=r.__originalRotate,r.scale=r.__originalScale,r.translate=r.__originalTranslate,r.transform=r.__originalTransform,r.setTransform=r.__originalSetTransform,r.resetTransform=r.__originalResetTransform,r.clip=r.__originalClip,r.moveTo=r.__originalMoveTo,r.lineTo=r.__originalLineTo,r.bezierCurveTo=r.__originalBezierCurveTo,r.rect=r.__originalRect,r.closePath=r.__originalClosePath,r.beginPath=r.__originalBeginPath,delete r._removeMirroring},r.save=function(){t.save(),this.__originalSave()},r.restore=function(){t.restore(),this.__originalRestore()},r.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},r.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},r.transform=function(e,n,a,o,c,h){t.transform(e,n,a,o,c,h),this.__originalTransform(e,n,a,o,c,h)},r.setTransform=function(e,n,a,o,c,h){t.setTransform(e,n,a,o,c,h),this.__originalSetTransform(e,n,a,o,c,h)},r.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},r.rotate=function(e){t.rotate(e),this.__originalRotate(e)},r.clip=function(e){t.clip(e),this.__originalClip(e)},r.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},r.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},r.bezierCurveTo=function(e,n,a,o,c,h){t.bezierCurveTo(e,n,a,o,c,h),this.__originalBezierCurveTo(e,n,a,o,c,h)},r.rect=function(e,n,a,o){t.rect(e,n,a,o),this.__originalRect(e,n,a,o)},r.closePath=function(){t.closePath(),this.__originalClosePath()},r.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class M1{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let a;return this.cache[t]!==void 0?(a=this.cache[t],this.canvasFactory.reset(a,e,n)):(a=this.canvasFactory.create(e,n),this.cache[t]=a),a}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function ic(r,t,e,n,a,o,c,h,d,f){const[g,_,y,b,A,S]=Jt(r);if(_===0&&y===0){const M=c*g+A,T=Math.round(M),N=h*b+S,R=Math.round(N),k=(c+d)*g+A,z=Math.abs(Math.round(k)-T)||1,j=(h+f)*b+S,$=Math.abs(Math.round(j)-R)||1;return r.setTransform(Math.sign(g),0,0,Math.sign(b),T,R),r.drawImage(t,e,n,a,o,0,0,z,$),r.setTransform(g,_,y,b,A,S),[z,$]}if(g===0&&b===0){const M=h*y+A,T=Math.round(M),N=c*_+S,R=Math.round(N),k=(h+f)*y+A,z=Math.abs(Math.round(k)-T)||1,j=(c+d)*_+S,$=Math.abs(Math.round(j)-R)||1;return r.setTransform(0,Math.sign(_),Math.sign(y),0,T,R),r.drawImage(t,e,n,a,o,0,0,$,z),r.setTransform(g,_,y,b,A,S),[$,z]}r.drawImage(t,e,n,a,o,c,h,d,f);const C=Math.hypot(g,_),w=Math.hypot(y,b);return[C*d,w*f]}class zy{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Gd;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=xe.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,n){n?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=xa.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=De.FILL,e=null){const n=this.minMax.slice();if(t===De.STROKE){e||Gt("Stroke bounding box must include transform."),nt.singularValueDecompose2dScale(e,un);const a=un[0]*this.lineWidth/2,o=un[1]*this.lineWidth/2;n[0]-=a,n[1]-=o,n[2]+=a,n[3]+=o}return n}updateClipFromPath(){const t=nt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(xa,0)}getClippedPathBoundingBox(t=De.FILL,e=null){return nt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Uy(r,t){if(t instanceof ImageData){r.putImageData(t,0,0);return}const e=t.height,n=t.width,a=e%$e,o=(e-a)/$e,c=a===0?o:o+1,h=r.createImageData(n,$e);let d=0,f;const g=t.data,_=h.data;let y,b,A,S;if(t.kind===hc.GRAYSCALE_1BPP){const C=g.byteLength,w=new Uint32Array(_.buffer,0,_.byteLength>>2),M=w.length,T=n+7>>3,N=4294967295,R=Ne.isLittleEndian?4278190080:255;for(y=0;y<c;y++){for(A=y<o?$e:a,f=0,b=0;b<A;b++){const k=C-d;let z=0;const j=k>T?n:k*8-7,$=j&-8;let tt=0,Q=0;for(;z<$;z+=8)Q=g[d++],w[f++]=Q&128?N:R,w[f++]=Q&64?N:R,w[f++]=Q&32?N:R,w[f++]=Q&16?N:R,w[f++]=Q&8?N:R,w[f++]=Q&4?N:R,w[f++]=Q&2?N:R,w[f++]=Q&1?N:R;for(;z<j;z++)tt===0&&(Q=g[d++],tt=128),w[f++]=Q&tt?N:R,tt>>=1}for(;f<M;)w[f++]=0;r.putImageData(h,0,y*$e)}}else if(t.kind===hc.RGBA_32BPP){for(b=0,S=n*$e*4,y=0;y<o;y++)_.set(g.subarray(d,d+S)),d+=S,r.putImageData(h,0,b),b+=$e;y<c&&(S=n*a*4,_.set(g.subarray(d,d+S)),r.putImageData(h,0,b))}else if(t.kind===hc.RGB_24BPP)for(A=$e,S=n*A,y=0;y<c;y++){for(y>=o&&(A=a,S=n*A),f=0,b=S;b--;)_[f++]=g[d++],_[f++]=g[d++],_[f++]=g[d++],_[f++]=255;r.putImageData(h,0,y*$e)}else throw new Error(`bad image kind: ${t.kind}`)}function Gy(r,t){if(t.bitmap){r.drawImage(t.bitmap,0,0);return}const e=t.height,n=t.width,a=e%$e,o=(e-a)/$e,c=a===0?o:o+1,h=r.createImageData(n,$e);let d=0;const f=t.data,g=h.data;for(let _=0;_<c;_++){const y=_<o?$e:a;({srcPos:d}=x1({src:f,srcPos:d,dest:g,width:n,height:y,nonBlackColor:0})),r.putImageData(h,0,_*$e)}}function $r(r,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of e)r[n]!==void 0&&(t[n]=r[n]);r.setLineDash!==void 0&&(t.setLineDash(r.getLineDash()),t.lineDashOffset=r.lineDashOffset)}function sc(r){r.strokeStyle=r.fillStyle="#000000",r.fillRule="nonzero",r.globalAlpha=1,r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.miterLimit=10,r.globalCompositeOperation="source-over",r.font="10px sans-serif",r.setLineDash!==void 0&&(r.setLineDash([]),r.lineDashOffset=0);const{filter:t}=r;t!=="none"&&t!==""&&(r.filter="none")}function jy(r,t){if(t)return!0;nt.singularValueDecompose2dScale(r,un);const e=Math.fround(Yn.pixelRatio*Ba.PDF_TO_CSS_UNITS);return un[0]<=e&&un[1]<=e}const N1=["butt","round","square"],O1=["miter","round","bevel"],k1={},Vy={};class Ma{constructor(t,e,n,a,o,{optionalContentConfig:c,markedContentStack:h=null},d,f,g){this.ctx=t,this.current=new zy(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=a,this.filterFactory=o,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=h||[],this.optionalContentConfig=c,this.cachedCanvases=new M1(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=g??null}getObject(t,e,n=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):n}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:a=null}){const o=this.ctx.canvas.width,c=this.ctx.canvas.height,h=this.ctx.fillStyle;if(this.ctx.fillStyle=a||"#ffffff",this.ctx.fillRect(0,0,o,c),this.ctx.fillStyle=h,n){const d=this.cachedCanvases.getCanvas("transparent",o,c);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...Jt(this.compositeCtx))}this.ctx.save(),sc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Jt(this.ctx)}executeOperatorList(t,e,n,a,o){const c=t.argsArray,h=t.fnArray;let d=e||0;const f=c.length;if(f===d)return d;const g=f-d>Hy&&typeof n=="function",_=g?Date.now()+R1:0;let y=0;const b=this.commonObjs,A=this.objs;let S,C;for(;;){if(a!==void 0&&d===a.nextBreakPoint)return a.breakIt(d,n),d;if(!o||o.has(d))if(S=h[d],C=c[d]??null,S!==fo.dependency)C===null?this[S](d):this[S](d,...C);else for(const w of C){this.dependencyTracker?.recordNamedData(w,d);const M=w.startsWith("g_")?b:A;if(!M.has(w))return M.get(w,n),d}if(d++,d===f)return d;if(g&&++y>Hy){if(Date.now()>_)return n(),d;y=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,a=t.height??t.displayHeight;let o=Math.max(Math.hypot(e[0],e[1]),1),c=Math.max(Math.hypot(e[2],e[3]),1),h=n,d=a,f="prescale1",g,_;for(;o>2&&h>1||c>2&&d>1;){let y=h,b=d;o>2&&h>1&&(y=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2),o/=h/y),c>2&&d>1&&(b=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,c/=d/b),g=this.cachedCanvases.getCanvas(f,y,b),_=g.context,_.clearRect(0,0,y,b),_.drawImage(t,0,0,h,d,0,0,y,b),t=g.canvas,h=y,d=b,f=f==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:h,paintHeight:d}}_createMaskCanvas(t,e){const n=this.ctx,{width:a,height:o}=e,c=this.current.fillColor,h=this.current.patternFill,d=Jt(n);let f,g,_,y;if((e.bitmap||e.data)&&e.count>1){const tt=e.bitmap||e.data.buffer;g=JSON.stringify(h?d:[d.slice(0,4),c]),f=this._cachedBitmapsMap.get(tt),f||(f=new Map,this._cachedBitmapsMap.set(tt,f));const Q=f.get(g);if(Q&&!h){const lt=Math.round(Math.min(d[0],d[2])+d[4]),mt=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(t,An.transformAndFill),{canvas:Q,offsetX:lt,offsetY:mt}}_=Q}_||(y=this.cachedCanvases.getCanvas("maskCanvas",a,o),Gy(y.context,e));let b=nt.transform(d,[1/a,0,0,-1/o,0,0]);b=nt.transform(b,[1,0,0,1,0,-o]);const A=xa.slice();nt.axialAlignedBoundingBox([0,0,a,o],b,A);const[S,C,w,M]=A,T=Math.round(w-S)||1,N=Math.round(M-C)||1,R=this.cachedCanvases.getCanvas("fillCanvas",T,N),k=R.context,z=S,j=C;k.translate(-z,-j),k.transform(...b),_||(_=this._scaleImage(y.canvas,Gn(k)),_=_.img,f&&h&&f.set(g,_)),k.imageSmoothingEnabled=jy(Jt(k),e.interpolate),ic(k,_,0,0,_.width,_.height,0,0,a,o),k.globalCompositeOperation="source-in";const $=nt.transform(Gn(k),[1,0,0,1,-z,-j]);return k.fillStyle=h?c.getPattern(n,this,$,De.FILL):c,k.fillRect(0,0,a,o),f&&!h&&(this.cachedCanvases.delete("fillCanvas"),f.set(g,R.canvas)),this.dependencyTracker?.recordDependencies(t,An.transformAndFill),{canvas:R.canvas,offsetX:Math.round(z),offsetY:Math.round(j)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=N1[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=O1[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,n){this.dependencyTracker?.recordSimpleData("dash",t);const a=this.ctx;a.setLineDash!==void 0&&(a.setLineDash(e),a.lineDashOffset=n)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[n,a]of e)switch(n){case"LW":this.setLineWidth(t,a);break;case"LC":this.setLineCap(t,a);break;case"LJ":this.setLineJoin(t,a);break;case"ML":this.setMiterLimit(t,a);break;case"D":this.setDash(t,a[0],a[1]);break;case"RI":this.setRenderingIntent(t,a);break;case"FL":this.setFlatness(t,a);break;case"Font":this.setFont(t,a[0],a[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=a;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=a;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=a;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=a?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(a);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,a="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(a,e,n);this.suspendedCtx=this.ctx;const c=this.ctx=o.context;c.setTransform(this.suspendedCtx.getTransform()),$r(this.suspendedCtx,c),D1(c,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),$r(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,a){const o=a[0],c=a[1],h=a[2]-o,d=a[3]-c;h===0||d===0||(this.genericComposeSMask(e.context,n,h,d,e.subtype,e.backdrop,e.transferMap,o,c,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,a,o,c,h,d,f,g,_){let y=t.canvas,b=d-g,A=f-_;if(c)if(b<0||A<0||b+n>y.width||A+a>y.height){const C=this.cachedCanvases.getCanvas("maskExtension",n,a),w=C.context;w.drawImage(y,-b,-A),w.globalCompositeOperation="destination-atop",w.fillStyle=c,w.fillRect(0,0,n,a),w.globalCompositeOperation="source-over",y=C.canvas,b=A=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const C=new Path2D;C.rect(b,A,n,a),t.clip(C),t.globalCompositeOperation="destination-atop",t.fillStyle=c,t.fillRect(b,A,n,a),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),o==="Alpha"&&h?e.filter=this.filterFactory.addAlphaFilter(h):o==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(h));const S=new Path2D;S.rect(d,f,n,a),e.clip(S),e.globalCompositeOperation="destination-in",e.drawImage(y,b,A,n,a,d,f,n,a),e.restore()}save(t){this.inSMaskMode&&$r(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&$r(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,n,a,o,c,h){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,n,a,o,c,h),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n,a){let[o]=n;if(!a){o||=n[0]=new Path2D,this[e](t,o);return}if(this.dependencyTracker!==null){const c=e===fo.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,a[0]-c,a[2]+c,a[1]-c,a[3]+c).recordDependencies(t,["transform"])}if(!(o instanceof Path2D)){const c=n[0]=new Path2D;for(let h=0,d=o.length;h<d;)switch(o[h++]){case Jl.moveTo:c.moveTo(o[h++],o[h++]);break;case Jl.lineTo:c.lineTo(o[h++],o[h++]);break;case Jl.curveTo:c.bezierCurveTo(o[h++],o[h++],o[h++],o[h++],o[h++],o[h++]);break;case Jl.closePath:c.closePath();break;default:gt(`Unrecognized drawing path operator: ${o[h-1]}`);break}o=c}nt.axialAlignedBoundingBox(a,Jt(this.ctx),this.current.minMax),this[e](t,o),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,n=!0){const a=this.ctx,o=this.current.strokeColor;if(a.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof o=="object"&&o?.getPattern){const c=o.isModifyingCurrentTransform()?a.getTransform():null;if(a.save(),a.strokeStyle=o.getPattern(a,this,Gn(a),De.STROKE),c){const h=new Path2D;h.addPath(e,a.getTransform().invertSelf().multiplySelf(c)),e=h}this.rescaleAndStroke(e,!1),a.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,An.stroke),n&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(De.STROKE,Jt(this.ctx))),a.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,n=!0){const a=this.ctx,o=this.current.fillColor,c=this.current.patternFill;let h=!1;if(c){const f=o.isModifyingCurrentTransform()?a.getTransform():null;if(this.dependencyTracker?.save(t),a.save(),a.fillStyle=o.getPattern(a,this,Gn(a),De.FILL),f){const g=new Path2D;g.addPath(e,a.getTransform().invertSelf().multiplySelf(f)),e=g}h=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(a.fill(e,"evenodd"),this.pendingEOFill=!1):a.fill(e)),this.dependencyTracker?.recordDependencies(t,An.fill),h&&(a.restore(),this.dependencyTracker?.restore(t)),n&&this.consumePath(t,e,d)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,An.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=k1}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Vy}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:a}=this;e!==void 0&&a.recordFutureForcedDependency("textClip",a.getOpenMarker()).recordFutureForcedDependency("textClip",t),a.recordCloseMarker(t)}if(e!==void 0){const a=new Path2D,o=n.getTransform().invertSelf();for(const{transform:c,x:h,y:d,fontSize:f,path:g}of e)g&&a.addPath(g,new DOMMatrix(c).preMultiplySelf(o).translate(h,d).scale(f,-f));n.clip(a)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,n){this.dependencyTracker?.recordSimpleData("font",t).recordNamedDependency(t,e);const a=this.commonObjs.get(e),o=this.current;if(!a)throw new Error(`Can't find font for ${e}`);if(o.fontMatrix=a.fontMatrix||Gd,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&gt("Invalid font matrix for font "+e),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=a,this.current.fontSize=n,a.isType3Font)return;const c=a.loadedName||"sans-serif",h=a.systemFontInfo?.css||`"${c}", ${a.fallbackName}`;let d="normal";a.black?d="900":a.bold&&(d="bold");const f=a.italic?"italic":"normal";let g=n;n<By?g=By:n>Fy&&(g=Fy),this.current.fontSizeScale=n/g,this.ctx.font=`${f} ${d} ${g}px ${h}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(t,e,n){this.setLeading(t,-n),this.moveText(t,e,n)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:n}=this;n.textMatrix=e,n.textMatrixScale=Math.hypot(e[0],e[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#n(t,e,n){const a=new Path2D;return a.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),a}paintChar(t,e,n,a,o,c){const h=this.ctx,d=this.current,f=d.font,g=d.textRenderingMode,_=d.fontSize/d.fontSizeScale,y=g&xe.FILL_STROKE_MASK,b=!!(g&xe.ADD_TO_PATH_FLAG),A=d.patternFill&&!f.missingFile,S=d.patternStroke&&!f.missingFile;let C;if((f.disableFontFace||b||A||S)&&!f.missingFile&&(C=f.getPathGenerator(this.commonObjs,e)),C&&(f.disableFontFace||A||S)){h.save(),h.translate(n,a),h.scale(_,-_),this.dependencyTracker?.recordCharacterBBox(t,h,f);let w;if(y===xe.FILL||y===xe.FILL_STROKE)if(o){w=h.getTransform(),h.setTransform(...o);const M=this.#n(C,w,o);h.fill(M)}else h.fill(C);if(y===xe.STROKE||y===xe.FILL_STROKE)if(c){w||=h.getTransform(),h.setTransform(...c);const{a:M,b:T,c:N,d:R}=w,k=nt.inverseTransform(c),z=nt.transform([M,T,N,R,0,0],k);nt.singularValueDecompose2dScale(z,un),h.lineWidth*=Math.max(un[0],un[1])/_,h.stroke(this.#n(C,w,c))}else h.lineWidth/=_,h.stroke(C);h.restore()}else(y===xe.FILL||y===xe.FILL_STROKE)&&(h.fillText(e,n,a),this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,a,()=>h.measureText(e))),(y===xe.STROKE||y===xe.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,a,()=>h.measureText(e)).recordDependencies(t,An.stroke),h.strokeText(e,n,a));b&&((this.pendingTextPaths||=[]).push({transform:Jt(h),x:n,y:a,fontSize:_,path:C}),this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,a))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let a=3;a<e.length;a+=4)if(e[a]>0&&e[a]<255){n=!0;break}return Et(this,"isFontSubpixelAAEnabled",n)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,An.showText).copyDependenciesFromIncrementalOperation(t,"sameLineText").resetBBox(t),this.current.textRenderingMode&xe.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,a=n.font;if(a.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t);return}const o=n.fontSize;if(o===0){this.dependencyTracker?.recordOperation(t);return}const c=this.ctx,h=n.fontSizeScale,d=n.charSpacing,f=n.wordSpacing,g=n.fontDirection,_=n.textHScale*g,y=e.length,b=a.vertical,A=b?1:-1,S=a.defaultVMetrics,C=o*n.fontMatrix[0],w=n.textRenderingMode===xe.FILL&&!a.disableFontFace&&!n.patternFill;c.save(),n.textMatrix&&c.transform(...n.textMatrix),c.translate(n.x,n.y+n.textRise),g>0?c.scale(_,-1):c.scale(_,1);let M,T;if(n.patternFill){c.save();const j=n.fillColor.getPattern(c,this,Gn(c),De.FILL);M=Jt(c),c.restore(),c.fillStyle=j}if(n.patternStroke){c.save();const j=n.strokeColor.getPattern(c,this,Gn(c),De.STROKE);T=Jt(c),c.restore(),c.strokeStyle=j}let N=n.lineWidth;const R=n.textMatrixScale;if(R===0||N===0){const j=n.textRenderingMode&xe.FILL_STROKE_MASK;(j===xe.STROKE||j===xe.FILL_STROKE)&&(N=this.getSinglePixelWidth())}else N/=R;if(h!==1&&(c.scale(h,h),N/=h),c.lineWidth=N,a.isInvalidPDFjsFont){const j=[];let $=0;for(const Q of e)j.push(Q.unicode),$+=Q.width;const tt=j.join("");if(c.fillText(tt,0,0),this.dependencyTracker!==null){const Q=c.measureText(tt);this.dependencyTracker.recordBBox(t,this.ctx,-Q.actualBoundingBoxLeft,Q.actualBoundingBoxRight,-Q.actualBoundingBoxAscent,Q.actualBoundingBoxDescent).recordOperation(t).recordIncrementalData("sameLineText",t)}n.x+=$*C*_,c.restore(),this.compose();return}let k=0,z;for(z=0;z<y;++z){const j=e[z];if(typeof j=="number"){k+=A*j*o/1e3;continue}let $=!1;const tt=(j.isSpace?f:0)+d,Q=j.fontChar,lt=j.accent;let mt,Tt,_t=j.width;if(b){const Z=j.vmetric||S,pt=-(j.vmetric?Z[1]:_t*.5)*C,D=Z[2]*C;_t=Z?-Z[0]:_t,mt=pt/h,Tt=(k+D)/h}else mt=k/h,Tt=0;let I;if(a.remeasure&&_t>0){I=c.measureText(Q);const Z=I.width*1e3/o*h;if(_t<Z&&this.isFontSubpixelAAEnabled){const pt=_t/Z;$=!0,c.save(),c.scale(pt,1),mt/=pt}else _t!==Z&&(mt+=(_t-Z)/2e3*o/h)}if(this.contentVisible&&(j.isInFont||a.missingFile)){if(w&&!lt)c.fillText(Q,mt,Tt),this.dependencyTracker?.recordCharacterBBox(t,c,I?{bbox:null}:a,o/h,mt,Tt,()=>I??c.measureText(Q));else if(this.paintChar(t,Q,mt,Tt,M,T),lt){const Z=mt+o*lt.offset.x/h,pt=Tt-o*lt.offset.y/h;this.paintChar(t,lt.fontChar,Z,pt,M,T)}}const U=b?_t*C-tt*g:_t*C+tt*g;k+=U,$&&c.restore()}b?n.y-=k:n.x+=k*_,c.restore(),this.compose(),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t)}showType3Text(t,e){const n=this.ctx,a=this.current,o=a.font,c=a.fontSize,h=a.fontDirection,d=o.vertical?1:-1,f=a.charSpacing,g=a.wordSpacing,_=a.textHScale*h,y=a.fontMatrix||Gd,b=e.length,A=a.textRenderingMode===xe.INVISIBLE;let S,C,w,M;if(A||c===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),a.textMatrix&&n.transform(...a.textMatrix),n.translate(a.x,a.y+a.textRise),n.scale(_,h);const T=this.dependencyTracker;for(this.dependencyTracker=T?new mc(T,t):null,S=0;S<b;++S){if(C=e[S],typeof C=="number"){M=d*C*c/1e3,this.ctx.translate(M,0),a.x+=M*_;continue}const N=(C.isSpace?g:0)+f,R=o.charProcOperatorList[C.operatorListId];R?this.contentVisible&&(this.save(),n.scale(c,c),n.transform(...y),this.executeOperatorList(R),this.restore()):gt(`Type3 character "${C.operatorListId}" is not available.`);const k=[C.width,0];nt.applyTransform(k,y),w=k[0]*c+N,n.translate(w,0),a.x+=w*_}n.restore(),T&&(this.dependencyTracker.recordNestedDependencies(),this.dependencyTracker=T)}setCharWidth(t,e,n){}setCharWidthAndBounds(t,e,n,a,o,c,h){const d=new Path2D;d.rect(a,o,c-a,h-o),this.ctx.clip(d),this.dependencyTracker?.recordBBox(t,this.ctx,a,c,o,h).recordClipBox(t,this.ctx,a,c,o,h),this.endPath(t)}getColorN_Pattern(t,e){let n;if(e[0]==="TilingPattern"){const a=this.baseTransform||Jt(this.ctx),o={createCanvasGraphics:c=>new Ma(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new mc(this.dependencyTracker,t):null)};n=new kf(e,this.ctx,o,a)}else n=this._getPattern(t,e[1],e[2]);return n}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,n=null){let a;return this.cachedPatterns.has(e)?a=this.cachedPatterns.get(e):(a=T1(this.getObject(t,e)),this.cachedPatterns.set(e,a)),n&&(a.matrix=n),a}shadingFill(t,e){if(!this.contentVisible)return;const n=this.ctx;this.save(t);const a=this._getPattern(t,e);n.fillStyle=a.getPattern(n,this,Gn(n),De.SHADING);const o=Gn(n);if(o){const{width:c,height:h}=n.canvas,d=xa.slice();nt.axialAlignedBoundingBox([0,0,c,h],o,d);const[f,g,_,y]=d;this.ctx.fillRect(f,g,_-f,y-g)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,An.transform).recordDependencies(t,An.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Gt("Should not call beginInlineImage")}beginImageData(){Gt("Should not call beginImageData")}paintFormXObjectBegin(t,e,n){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Jt(this.ctx),n)){nt.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[a,o,c,h]=n,d=new Path2D;d.rect(a,o,c-a,h-o),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(t,this.ctx,a,c,o,h),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||zc("TODO: Support non-isolated groups."),e.knockout&&gt("Knockout groups not supported.");const a=Jt(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let o=xa.slice();nt.axialAlignedBoundingBox(e.bbox,Jt(n),o);const c=[0,0,n.canvas.width,n.canvas.height];o=nt.intersect(o,c)||[0,0,0,0];const h=Math.floor(o[0]),d=Math.floor(o[1]),f=Math.max(Math.ceil(o[2])-h,1),g=Math.max(Math.ceil(o[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,g]);let _="groupAt"+this.groupLevel;e.smask&&(_+="_smask_"+this.smaskCounter++%2);const y=this.cachedCanvases.getCanvas(_,f,g),b=y.context;b.translate(-h,-d),b.transform(...a);let A=new Path2D;const[S,C,w,M]=e.bbox;if(A.rect(S,C,w-S,M-C),e.matrix){const T=new Path2D;T.addPath(A,new DOMMatrix(e.matrix)),A=T}b.clip(A),e.smask&&this.smaskStack.push({canvas:y.canvas,context:b,offsetX:h,offsetY:d,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(h,d),n.save()),$r(n,b),this.ctx=b,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,a=this.groupStack.pop();if(this.ctx=a,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Jt(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...o);const c=xa.slice();nt.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,c),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(c)}}beginAnnotation(t,e,n,a,o,c){if(this.#t(),sc(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const h=n[2]-n[0],d=n[3]-n[1];if(c&&this.annotationCanvasMap){a=a.slice(),a[4]-=n[0],a[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=h,n[3]=d,nt.singularValueDecompose2dScale(Jt(this.ctx),un);const{viewportScale:f}=this,g=Math.ceil(h*this.outputScaleX*f),_=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(g,_);const{canvas:y,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(e,y),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(un[0],0,0,-un[1],0,d*un[1]),sc(this.ctx)}else{sc(this.ctx),this.endPath(t);const f=new Path2D;f.rect(n[0],n[1],h,d),this.ctx.clip(f)}}this.current=new zy(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...a),this.transform(t,...o)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(t,e.data,e),e.count=n;const a=this.ctx,o=this._createMaskCanvas(t,e),c=o.canvas;a.save(),a.setTransform(1,0,0,1,0,0),a.drawImage(c,o.offsetX,o.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,o.offsetX,o.offsetX+c.width,o.offsetY,o.offsetY+c.height).recordOperation(t),a.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n,a=0,o=0,c,h){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const d=this.ctx;d.save();const f=Jt(d);d.transform(n,a,o,c,0,0);const g=this._createMaskCanvas(t,e);d.setTransform(1,0,0,1,g.offsetX-f[4],g.offsetY-f[5]),this.dependencyTracker?.resetBBox(t);for(let _=0,y=h.length;_<y;_+=2){const b=nt.transform(f,[n,a,o,c,h[_],h[_+1]]);d.drawImage(g.canvas,b[4],b[5]),this.dependencyTracker?.recordBBox(t,this.ctx,b[4],b[4]+g.canvas.width,b[5],b[5]+g.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx,a=this.current.fillColor,o=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,An.transformAndFill);for(const c of e){const{data:h,width:d,height:f,transform:g}=c,_=this.cachedCanvases.getCanvas("maskCanvas",d,f),y=_.context;y.save();const b=this.getObject(t,h,c);Gy(y,b),y.globalCompositeOperation="source-in",y.fillStyle=o?a.getPattern(y,this,Gn(n),De.FILL):a,y.fillRect(0,0,d,f),y.restore(),n.save(),n.transform(...g),n.scale(1,-1),ic(n,_.canvas,0,0,d,f,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,d,0,f),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const n=this.getObject(t,e);if(!n){gt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,n)}paintImageXObjectRepeat(t,e,n,a,o){if(!this.contentVisible)return;const c=this.getObject(t,e);if(!c){gt("Dependent image isn't ready yet");return}const h=c.width,d=c.height,f=[];for(let g=0,_=o.length;g<_;g+=2)f.push({transform:[n,0,0,a,o[g],o[g+1]],x:0,y:0,w:h,h:d});this.paintInlineImageXObjectGroup(t,c,f)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:n,height:a}=t,o=this.cachedCanvases.getCanvas("inlineImage",n,a),c=o.context;return c.filter=this.current.transferMaps,c.drawImage(e,0,0),c.filter="none",o.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const n=e.width,a=e.height,o=this.ctx;this.save(t);const{filter:c}=o;c!=="none"&&c!==""&&(o.filter="none"),o.scale(1/n,-1/a);let h;if(e.bitmap)h=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)h=e;else{const g=this.cachedCanvases.getCanvas("inlineImage",n,a).context;Uy(g,e),h=this.applyTransferMapsToCanvas(g)}const d=this._scaleImage(h,Gn(o));o.imageSmoothingEnabled=jy(Jt(o),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,o,0,n,-a,0).recordDependencies(t,An.imageXObject).recordOperation(t),ic(o,d.img,0,0,d.paintWidth,d.paintHeight,0,-a,n,a),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,n){if(!this.contentVisible)return;const a=this.ctx;let o;if(e.bitmap)o=e.bitmap;else{const c=e.width,h=e.height,f=this.cachedCanvases.getCanvas("inlineImage",c,h).context;Uy(f,e),o=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(t);for(const c of n)a.save(),a.transform(...c.transform),a.scale(1,-1),ic(a,o,c.x,c.y,c.w,c.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,a,0,1,-1,0),a.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,An.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,n){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,n){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,n){const a=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const o=this.ctx;this.pendingClip?(a||(this.pendingClip===Vy?o.clip(e,"evenodd"):o.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Jt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),a=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,a)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:n,c:a,d:o}=this.ctx.getTransform();let c,h;if(n===0&&a===0){const d=Math.abs(e),f=Math.abs(o);if(d===f)if(t===0)c=h=1/d;else{const g=d*t;c=h=g<1?1/g:1}else if(t===0)c=1/d,h=1/f;else{const g=d*t,_=f*t;c=g<1?1/g:1,h=_<1?1/_:1}}else{const d=Math.abs(e*o-n*a),f=Math.hypot(e,n),g=Math.hypot(a,o);if(t===0)c=g/d,h=f/d;else{const _=t*d;c=g>_?g/_:1,h=f>_?f/_:1}}this._cachedScaleForStroking[0]=c,this._cachedScaleForStroking[1]=h}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:a}}=this,[o,c]=this.getScaleForStroking();if(o===c){n.lineWidth=(a||1)*o,n.stroke(t);return}const h=n.getLineDash();e&&n.save(),n.scale(o,c),Td.a=1/o,Td.d=1/c;const d=new Path2D;if(d.addPath(t,Td),h.length>0){const f=Math.max(o,c);n.setLineDash(h.map(g=>g/f)),n.lineDashOffset/=f}n.lineWidth=a||1,n.stroke(d),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const r in fo)Ma.prototype[r]!==void 0&&(Ma.prototype[fo[r]]=Ma.prototype[r]);class Na{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class L1{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Ca=Symbol("INTERNAL");class I1{#t=!1;#e=!1;#n=!1;#i=!0;constructor(t,{name:e,intent:n,usage:a,rbGroups:o}){this.#t=!!(t&cn.DISPLAY),this.#e=!!(t&cn.PRINT),this.name=e,this.intent=n,this.usage=a,this.rbGroups=o}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,n=!1){t!==Ca&&Gt("Internal method `_setVisible` called."),this.#n=n,this.#i=e}}class P1{#t=null;#e=new Map;#n=null;#i=null;constructor(t,e=cn.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#i=t.order;for(const n of t.groups)this.#e.set(n.id,new I1(e,n));if(t.baseState==="OFF")for(const n of this.#e.values())n._setVisible(Ca,!1);for(const n of t.on)this.#e.get(n)._setVisible(Ca,!0);for(const n of t.off)this.#e.get(n)._setVisible(Ca,!1);this.#n=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let a=1;a<e;a++){const o=t[a];let c;if(Array.isArray(o))c=this.#a(o);else if(this.#e.has(o))c=this.#e.get(o).visible;else return gt(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!c)return!1;break;case"Or":if(c)return!0;break;case"Not":return!c;default:return!0}}return n==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return zc("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(gt(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return gt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return gt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return gt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return gt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return gt(`Unknown optional content policy ${t.policy}.`),!0}return gt(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){const a=this.#e.get(t);if(!a){gt(`Optional content group not found: ${t}`);return}if(n&&e&&a.rbGroups.length)for(const o of a.rbGroups)for(const c of o)c!==t&&this.#e.get(c)?._setVisible(Ca,!1,!0);a._setVisible(Ca,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let n;for(const a of t){switch(a){case"ON":case"OFF":case"Toggle":n=a;continue}const o=this.#e.get(a);if(o)switch(n){case"ON":this.setVisibility(a,!0,e);break;case"OFF":this.setVisibility(a,!1,e);break;case"Toggle":this.setVisibility(a,!o.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new nv;for(const[e,n]of this.#e)t.update(`${e}:${n.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class B1{constructor(t,{disableRange:e=!1,disableStream:n=!1}){de(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:a,initialData:o,progressiveDone:c,contentDispositionFilename:h}=t;if(this._queuedChunks=[],this._progressiveDone=c,this._contentDispositionFilename=h,o?.length>0){const d=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=a,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),t.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),t.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const a=this._rangeReaders.some(function(o){return o._begin!==t?!1:(o._enqueue(n),!0)});de(a,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){de(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new F1(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new H1(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class F1{constructor(t,e,n=!1,a=null){this._stream=t,this._done=n||!1,this._filename=xf(a)?a:null,this._queuedChunks=e||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class H1{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function z1(r){let t=!0,e=n("filename\\*","i").exec(r);if(e){e=e[1];let g=h(e);return g=unescape(g),g=d(g),g=f(g),o(g)}if(e=c(r),e){const g=f(e);return o(g)}if(e=n("filename","i").exec(r),e){e=e[1];let g=h(e);return g=f(g),o(g)}function n(g,_){return new RegExp("(?:^|;)\\s*"+g+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',_)}function a(g,_){if(g){if(!/^[\x00-\xFF]+$/.test(_))return _;try{const y=new TextDecoder(g,{fatal:!0}),b=xo(_);_=y.decode(b),t=!1}catch{}}return _}function o(g){return t&&/[\x80-\xff]/.test(g)&&(g=a("utf-8",g),t&&(g=a("iso-8859-1",g))),g}function c(g){const _=[];let y;const b=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(y=b.exec(g))!==null;){let[,S,C,w]=y;if(S=parseInt(S,10),S in _){if(S===0)break;continue}_[S]=[C,w]}const A=[];for(let S=0;S<_.length&&S in _;++S){let[C,w]=_[S];w=h(w),C&&(w=unescape(w),S===0&&(w=d(w))),A.push(w)}return A.join("")}function h(g){if(g.startsWith('"')){const _=g.slice(1).split('\\"');for(let y=0;y<_.length;++y){const b=_[y].indexOf('"');b!==-1&&(_[y]=_[y].slice(0,b),_.length=y+1),_[y]=_[y].replaceAll(/\\(.)/g,"$1")}g=_.join('"')}return g}function d(g){const _=g.indexOf("'");if(_===-1)return g;const y=g.slice(0,_),A=g.slice(_+1).replace(/^[^']*'/,"");return a(y,A)}function f(g){return!g.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(g)?g:g.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(_,y,b,A){if(b==="q"||b==="Q")return A=A.replaceAll("_"," "),A=A.replaceAll(/=([0-9a-fA-F]{2})/g,function(S,C){return String.fromCharCode(parseInt(C,16))}),a(y,A);try{A=atob(A)}catch{}return a(y,A)})}return""}function cv(r,t){const e=new Headers;if(!r||!t||typeof t!="object")return e;for(const n in t){const a=t[n];a!==void 0&&e.append(n,a)}return e}function Vc(r){return URL.parse(r)?.origin??null}function uv({responseHeaders:r,isHttp:t,rangeChunkSize:e,disableRange:n}){const a={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(r.get("Content-Length"),10);return!Number.isInteger(o)||(a.suggestedLength=o,o<=2*e)||n||!t||r.get("Accept-Ranges")!=="bytes"||(r.get("Content-Encoding")||"identity")!=="identity"||(a.allowRangeRequests=!0),a}function hv(r){const t=r.get("Content-Disposition");if(t){let e=z1(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(xf(e))return e}return null}function No(r,t){return new gc(`Unexpected server response (${r}) while retrieving PDF "${t}".`,r,r===404||r===0&&t.startsWith("file:"))}function dv(r){return r===200||r===206}function fv(r,t,e){return{method:"GET",headers:r,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function pv(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:(gt(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class U1{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=cv(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return de(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new G1(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new j1(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class G1{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),a=e.url;fetch(a,fv(n,this._withCredentials,this._abortController)).then(o=>{if(t._responseOrigin=Vc(o.url),!dv(o.status))throw No(o.status,a);this._reader=o.body.getReader(),this._headersCapability.resolve();const c=o.headers,{allowRangeRequests:h,suggestedLength:d}=uv({responseHeaders:c,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=d||this._contentLength,this._filename=hv(c),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Xi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:pv(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class j1{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const a=t.source;this._withCredentials=a.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!a.disableStream,this._abortController=new AbortController;const o=new Headers(t.headers);o.append("Range",`bytes=${e}-${n-1}`);const c=a.url;fetch(c,fv(o,this._withCredentials,this._abortController)).then(h=>{const d=Vc(h.url);if(d!==t._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${t._responseOrigin}".`);if(!dv(h.status))throw No(h.status,c);this._readCapability.resolve(),this._reader=h.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:pv(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const xd=200,Rd=206;function V1(r){const t=r.response;return typeof t!="string"?t:xo(t).buffer}class q1{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:n}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=cv(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,a=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[o,c]of this.headers)e.setRequestHeader(o,c);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),a.expectedStatus=Rd):a.expectedStatus=xd,e.responseType="arraybuffer",de(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),a.onHeadersReceived=t.onHeadersReceived,a.onDone=t.onDone,a.onError=t.onError,a.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const a=n.xhr;if(a.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),a.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],a.status===0&&this.isHttp){n.onError(a.status);return}const o=a.status||xd;if(!(o===xd&&n.expectedStatus===Rd)&&o!==n.expectedStatus){n.onError(a.status);return}const h=V1(a);if(o===Rd){const d=a.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?n.onDone({begin:parseInt(f[1],10),chunk:h}):(gt('Missing or invalid "Content-Range" header.'),n.onError(0))}else h?n.onDone({begin:0,chunk:h}):n.onError(a.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Y1{constructor(t){this._source=t,this._manager=new q1(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return de(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new X1(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new $1(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class X1{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Vc(e.responseURL);const n=e.getAllResponseHeaders(),a=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(h=>{const[d,...f]=h.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:c}=uv({responseHeaders:a,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=c||this._contentLength,this._filename=hv(a),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=No(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class $1{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Vc(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=No(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const W1=/^[a-z][a-z0-9\-+.]+:/i;function K1(r){if(W1.test(r))return new URL(r);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(r))}class Q1{constructor(t){this.source=t,this.url=K1(t.url),de(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return de(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Z1(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new J1(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Z1{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(a=>{this._contentLength=a.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},a=>{a.code==="ENOENT"&&(a=No(0,this._url.href)),this._storedError=a,this._headersCapability.reject(a)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Xi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class J1{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const a=t.source;this._isStreamingSupported=!a.disableStream;const o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Wr=Symbol("INITIAL_DATA");class gv{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:Wr}}get(t,e=null){if(e){const a=this.#e(t);return a.promise.then(()=>e(a.data)),null}const n=this.#t[t];if(!n||n.data===Wr)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#t[t];return!!e&&e.data!==Wr}delete(t){const e=this.#t[t];return!e||e.data===Wr?!1:(delete this.#t[t],!0)}resolve(t,e=null){const n=this.#e(t);n.data=e,n.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==Wr&&(yield[t,e])}}}const tw=1e5,qy=30;class Be{#t=Promise.withResolvers();#e=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#a=null;#s=null;#r=0;#o=0;#l=null;#c=null;#d=0;#u=0;#f=Object.create(null);#g=[];#p=null;#h=[];#m=new WeakMap;#b=null;static#_=new Map;static#A=new Map;static#S=new WeakMap;static#y=null;static#E=new Set;constructor({textContentSource:t,container:e,viewport:n}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(d){d.enqueue(t),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#u=n.scale*Yn.pixelRatio,this.#d=n.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:a,pageHeight:o,pageX:c,pageY:h}=n.rawDims;this.#b=[1,0,0,-1,-c,h+o],this.#o=a,this.#r=o,Be.#D(),Ts(e,n),this.#t.promise.finally(()=>{Be.#E.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Ne.platform;return Et(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#l.read().then(({value:e,done:n})=>{if(n){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#f,e.styles),this.#R(e.items),t()},this.#t.reject)};return this.#l=this.#p.getReader(),Be.#E.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const n=t.scale*Yn.pixelRatio,a=t.rotation;if(a!==this.#d&&(e?.(),this.#d=a,Ts(this.#c,{rotation:a})),n!==this.#u){e?.(),this.#u=n;const o={div:null,properties:null,ctx:Be.#O(this.#a)};for(const c of this.#h)o.properties=this.#m.get(c),o.div=c,this.#w(o)}}cancel(){const t=new Xi("TextLayer task cancelled.");this.#l?.cancel(t).catch(()=>{}),this.#l=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#g}#R(t){if(this.#n)return;this.#s.ctx??=Be.#O(this.#a);const e=this.#h,n=this.#g;for(const a of t){if(e.length>tw){gt("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),a.id&&this.#e.setAttribute("id",`${a.id}`),o.append(this.#e)}else a.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}n.push(a.str),this.#T(a)}}#T(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const a=nt.transform(this.#b,t.transform);let o=Math.atan2(a[1],a[0]);const c=this.#f[t.fontName];c.vertical&&(o+=Math.PI/2);let h=this.#i&&c.fontSubstitution||c.fontFamily;h=Be.fontFamilyMap.get(h)||h;const d=Math.hypot(a[2],a[3]),f=d*Be.#I(h,c,this.#a);let g,_;o===0?(g=a[4],_=a[5]-f):(g=a[4]+f*Math.sin(o),_=a[5]-f*Math.cos(o));const y="calc(var(--total-scale-factor) *",b=e.style;this.#e===this.#c?(b.left=`${(100*g/this.#o).toFixed(2)}%`,b.top=`${(100*_/this.#r).toFixed(2)}%`):(b.left=`${y}${g.toFixed(2)}px)`,b.top=`${y}${_.toFixed(2)}px)`),b.fontSize=`${y}${(Be.#y*d).toFixed(2)}px)`,b.fontFamily=h,n.fontSize=d,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#i&&(e.dataset.fontName=c.fontSubstitutionLoadedName||t.fontName),o!==0&&(n.angle=o*(180/Math.PI));let A=!1;if(t.str.length>1)A=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const S=Math.abs(t.transform[0]),C=Math.abs(t.transform[3]);S!==C&&Math.max(S,C)/Math.min(S,C)>1.5&&(A=!0)}if(A&&(n.canvasWidth=c.vertical?t.height:t.width),this.#m.set(e,n),this.#s.div=e,this.#s.properties=n,this.#w(this.#s),n.hasText&&this.#e.append(e),n.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),this.#e.append(S)}}#w(t){const{div:e,properties:n,ctx:a}=t,{style:o}=e;let c="";if(Be.#y>1&&(c=`scale(${1/Be.#y})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:h}=o,{canvasWidth:d,fontSize:f}=n;Be.#x(a,f*this.#u,h);const{width:g}=a.measureText(e.textContent);g>0&&(c=`scaleX(${d*this.#u/g}) ${c}`)}n.angle!==0&&(c=`rotate(${n.angle}deg) ${c}`),c.length>0&&(o.transform=c)}static cleanup(){if(!(this.#E.size>0)){this.#_.clear();for(const{canvas:t}of this.#A.values())t.remove();this.#A.clear()}}static#O(t=null){let e=this.#A.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#A.set(t,e),this.#S.set(e,{size:0,family:""})}return e}static#x(t,e,n){const a=this.#S.get(t);e===a.size&&n===a.family||(t.font=`${e}px ${n}`,a.size=e,a.family=n)}static#D(){if(this.#y!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#y=t.getBoundingClientRect().height,t.remove()}static#I(t,e,n){const a=this.#_.get(t);if(a)return a;const o=this.#O(n);o.canvas.width=o.canvas.height=qy,this.#x(o,qy,t);const c=o.measureText(""),h=c.fontBoundingBoxAscent,d=Math.abs(c.fontBoundingBoxDescent);o.canvas.width=o.canvas.height=0;let f=.8;return h?f=h/(h+d):(Ne.platform.isFirefox&&gt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?f=e.ascent:e.descent&&(f=1+e.descent)),this.#_.set(t,f),f}}class po{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};function a(o){if(!o)return;let c=null;const h=o.name;if(h==="#text")c=o.value;else if(po.shouldBuildText(h))o?.attributes?.textContent?c=o.attributes.textContent:o.value&&(c=o.value);else return;if(c!==null&&e.push({str:c}),!!o.children)for(const d of o.children)a(d)}return a(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const ew=100;function mv(r={}){typeof r=="string"||r instanceof URL?r={url:r}:(r instanceof ArrayBuffer||ArrayBuffer.isView(r))&&(r={data:r});const t=new Lf,{docId:e}=t,n=r.url?c1(r.url):null,a=r.data?u1(r.data):null,o=r.httpHeaders||null,c=r.withCredentials===!0,h=r.password??null,d=r.range instanceof _v?r.range:null,f=Number.isInteger(r.rangeChunkSize)&&r.rangeChunkSize>0?r.rangeChunkSize:2**16;let g=r.worker instanceof go?r.worker:null;const _=r.verbosity,y=typeof r.docBaseUrl=="string"&&!Uc(r.docBaseUrl)?r.docBaseUrl:null,b=ec(r.cMapUrl),A=r.cMapPacked!==!1,S=r.CMapReaderFactory||(Fe?y1:ky),C=ec(r.iccUrl),w=ec(r.standardFontDataUrl),M=r.StandardFontDataFactory||(Fe?b1:Ly),T=ec(r.wasmUrl),N=r.WasmFactory||(Fe?v1:Iy),R=r.stopAtErrors!==!0,k=Number.isInteger(r.maxImageSize)&&r.maxImageSize>-1?r.maxImageSize:-1,z=r.isEvalSupported!==!1,j=typeof r.isOffscreenCanvasSupported=="boolean"?r.isOffscreenCanvasSupported:!Fe,$=typeof r.isImageDecoderSupported=="boolean"?r.isImageDecoderSupported:!Fe&&(Ne.platform.isFirefox||!globalThis.chrome),tt=Number.isInteger(r.canvasMaxAreaInBytes)?r.canvasMaxAreaInBytes:-1,Q=typeof r.disableFontFace=="boolean"?r.disableFontFace:Fe,lt=r.fontExtraProperties===!0,mt=r.enableXfa===!0,Tt=r.ownerDocument||globalThis.document,_t=r.disableRange===!0,I=r.disableStream===!0,U=r.disableAutoFetch===!0,Z=r.pdfBug===!0,pt=r.CanvasFactory||(Fe?_1:p1),D=r.FilterFactory||(Fe?m1:g1),q=r.enableHWA===!0,W=r.useWasm!==!1,X=d?d.length:r.length??NaN,it=typeof r.useSystemFonts=="boolean"?r.useSystemFonts:!Fe&&!Q,yt=typeof r.useWorkerFetch=="boolean"?r.useWorkerFetch:!!(S===ky&&M===Ly&&N===Iy&&b&&w&&T&&no(b,document.baseURI)&&no(w,document.baseURI)&&no(T,document.baseURI)),at=null;UE(_);const Mt={canvasFactory:new pt({ownerDocument:Tt,enableHWA:q}),filterFactory:new D({docId:e,ownerDocument:Tt}),cMapReaderFactory:yt?null:new S({baseUrl:b,isCompressed:A}),standardFontDataFactory:yt?null:new M({baseUrl:w}),wasmFactory:yt?null:new N({baseUrl:T})};g||(g=go.create({verbosity:_,port:Na.workerPort}),t._worker=g);const Pt={docId:e,apiVersion:"5.4.149",data:a,password:h,disableAutoFetch:U,rangeChunkSize:f,length:X,docBaseUrl:y,enableXfa:mt,evaluatorOptions:{maxImageSize:k,disableFontFace:Q,ignoreErrors:R,isEvalSupported:z,isOffscreenCanvasSupported:j,isImageDecoderSupported:$,canvasMaxAreaInBytes:tt,fontExtraProperties:lt,useSystemFonts:it,useWasm:W,useWorkerFetch:yt,cMapUrl:b,iccUrl:C,standardFontDataUrl:w,wasmUrl:T}},kn={ownerDocument:Tt,pdfBug:Z,styleElement:at,loadingParams:{disableAutoFetch:U,enableXfa:mt}};return g.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const Xa=g.messageHandler.sendWithPromise("GetDocRequest",Pt,a?[a.buffer]:null);let _i;if(d)_i=new B1(d,{disableRange:_t,disableStream:I});else if(!a){if(!n)throw new Error("getDocument - no `url` parameter provided.");const Zi=no(n)?U1:Fe?Q1:Y1;_i=new Zi({url:n,length:X,httpHeaders:o,withCredentials:c,rangeChunkSize:f,disableRange:_t,disableStream:I})}return Xa.then(Zi=>{if(t.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const Is=new io(e,Zi,g.port),$a=new sw(Is,t,_i,kn,Mt,q);t._transport=$a,Is.send("Ready",null)})}).catch(t._capability.reject),t}class Lf{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Lf.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class _v{#t=Promise.withResolvers();#e=[];#n=[];#i=[];#a=[];constructor(t,e,n=!1,a=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=a}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#i.push(t)}addProgressiveReadListener(t){this.#n.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const n of this.#a)n(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const n of this.#i)n(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#n)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Gt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class nw{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Et(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class iw{#t=!1;constructor(t,e,n,a=!1){this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=a?new My:null,this._pdfBug=a,this.commonObjs=n.commonObjs,this.objs=new gv,this._intentStates=new Map,this.destroyed=!1,this.recordedGroups=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}={}){return new Do({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:a,dontFlip:o})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Et(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:a="display",annotationMode:o=Gi.ENABLE,transform:c=null,background:h=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:g=null,printAnnotationStorage:_=null,isEditing:y=!1,recordOperations:b=!1,filteredOperationIndexes:A=null}){this._stats?.time("Overall");const S=this._transport.getRenderingIntent(a,o,_,y),{renderingIntent:C,cacheKey:w}=S;this.#t=!1,d||=this._transport.getOptionalContentConfig(C);let M=this._intentStates.get(w);M||(M=Object.create(null),this._intentStates.set(w,M)),M.streamReaderCancelTimeout&&(clearTimeout(M.streamReaderCancelTimeout),M.streamReaderCancelTimeout=null);const T=!!(C&cn.PRINT);M.displayReadyCapability||(M.displayReadyCapability=Promise.withResolvers(),M.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(S));const N=!this.recordedGroups&&(b||this._pdfBug&&globalThis.StepperManager?.enabled),R=j=>{if(M.renderTasks.delete(k),N){const $=k.gfx?.dependencyTracker.take();$?(k.stepper?.setOperatorGroups($),b&&(this.recordedGroups=$)):b&&(this.recordedGroups=[])}T&&(this.#t=!0),this.#e(),j?(k.capability.reject(j),this._abortOperatorList({intentState:M,reason:j instanceof Error?j:new Error(j)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new Ra({callback:R,params:{canvas:e,canvasContext:t,dependencyTracker:N?new A1(e):null,viewport:n,transform:c,background:h},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:M.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:g,enableHWA:this._transport.enableHWA,filteredOperationIndexes:A});(M.renderTasks||=new Set).add(k);const z=k.task;return Promise.all([M.displayReadyCapability.promise,d]).then(([j,$])=>{if(this.destroyed){R();return}if(this._stats?.time("Rendering"),!($.renderingIntent&C))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:j,optionalContentConfig:$}),k.operatorListChanged()}).catch(R),z}getOperatorList({intent:t="display",annotationMode:e=Gi.ENABLE,printAnnotationStorage:n=null,isEditing:a=!1}={}){function o(){h.operatorList.lastChunk&&(h.opListReadCapability.resolve(h.operatorList),h.renderTasks.delete(d))}const c=this._transport.getRenderingIntent(t,e,n,a,!0);let h=this._intentStates.get(c.cacheKey);h||(h=Object.create(null),this._intentStates.set(c.cacheKey,h));let d;return h.opListReadCapability||(d=Object.create(null),d.operatorListChanged=o,h.opListReadCapability=Promise.withResolvers(),(h.renderTasks||=new Set).add(d),h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(c)),h.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(a){return a.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>po.textContent(n));const e=this.streamTextContent(t);return new Promise(function(n,a){function o(){c.read().then(function({value:d,done:f}){if(f){n(h);return}h.lang??=d.lang,Object.assign(h.styles,d.styles),h.items.push(...d.items),o()},a)}const c=e.getReader(),h={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new My),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,a=t.length;n<a;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:a}){const{map:o,transfer:c}=n,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:o,modifiedIds:a},c).getReader(),f=this._intentStates.get(e);f.streamReader=d;const g=()=>{d.read().then(({value:_,done:y})=>{if(y){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(_,f),g())},_=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const y of f.renderTasks)y.operatorListChanged();this.#e()}if(f.displayReadyCapability)f.displayReadyCapability.reject(_);else if(f.opListReadCapability)f.opListReadCapability.reject(_);else throw _}})};g()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof Tf){let a=ew;e.extraDelay>0&&e.extraDelay<1e3&&(a+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},a);return}}if(t.streamReader.cancel(new Xi(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[a,o]of this._intentStates)if(o===t){this._intentStates.delete(a);break}this.cleanup()}}}get stats(){return this._stats}}var ji,Rn,ui,Ss,Bc,Es,ws,ze,dc,yv,bv,so,Pa,fc;const Qt=class Qt{constructor({name:t=null,port:e=null,verbosity:n=GE()}={}){zn(this,ze);zn(this,ji,Promise.withResolvers());zn(this,Rn,null);zn(this,ui,null);zn(this,Ss,null);if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(Kt(Qt,ws).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Kt(Qt,ws).set(e,this),Un(this,ze,yv).call(this,e)}else Un(this,ze,bv).call(this)}get promise(){return Kt(this,ji).promise}get port(){return Kt(this,ui)}get messageHandler(){return Kt(this,Rn)}destroy(){this.destroyed=!0,Kt(this,Ss)?.terminate(),Ye(this,Ss,null),Kt(Qt,ws).delete(Kt(this,ui)),Ye(this,ui,null),Kt(this,Rn)?.destroy(),Ye(this,Rn,null)}static create(t){const e=Kt(this,ws).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Qt(t)}static get workerSrc(){if(Na.workerSrc)return Na.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Et(this,"_setupFakeWorkerGlobal",(async()=>Kt(this,Pa,fc)?Kt(this,Pa,fc):(await import(this.workerSrc)).WorkerMessageHandler)())}};ji=new WeakMap,Rn=new WeakMap,ui=new WeakMap,Ss=new WeakMap,Bc=new WeakMap,Es=new WeakMap,ws=new WeakMap,ze=new WeakSet,dc=function(){Kt(this,ji).resolve(),Kt(this,Rn).send("configure",{verbosity:this.verbosity})},yv=function(t){Ye(this,ui,t),Ye(this,Rn,new io("main","worker",t)),Kt(this,Rn).on("ready",()=>{}),Un(this,ze,dc).call(this)},bv=function(){if(Kt(Qt,Es)||Kt(Qt,Pa,fc)){Un(this,ze,so).call(this);return}let{workerSrc:t}=Qt;try{Qt._isSameOrigin(window.location,t)||(t=Qt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new io("main","worker",e),a=()=>{o.abort(),n.destroy(),e.terminate(),this.destroyed?Kt(this,ji).reject(new Error("Worker was destroyed")):Un(this,ze,so).call(this)},o=new AbortController;e.addEventListener("error",()=>{Kt(this,Ss)||a()},{signal:o.signal}),n.on("test",h=>{if(o.abort(),this.destroyed||!h){a();return}Ye(this,Rn,n),Ye(this,ui,e),Ye(this,Ss,e),Un(this,ze,dc).call(this)}),n.on("ready",h=>{if(o.abort(),this.destroyed){a();return}try{c()}catch{Un(this,ze,so).call(this)}});const c=()=>{const h=new Uint8Array;n.send("test",h,[h.buffer])};c();return}catch{zc("The worker has been disabled.")}Un(this,ze,so).call(this)},so=function(){Kt(Qt,Es)||(gt("Setting up fake worker."),Ye(Qt,Es,!0)),Qt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Kt(this,ji).reject(new Error("Worker was destroyed"));return}const e=new f1;Ye(this,ui,e);const n=`fake${_y(Qt,Bc)._++}`,a=new io(n+"_worker",n,e);t.setup(a,e),Ye(this,Rn,new io(n,n+"_worker",e)),Un(this,ze,dc).call(this)}).catch(t=>{Kt(this,ji).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},Pa=new WeakSet,fc=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},zn(Qt,Pa),zn(Qt,Bc,0),zn(Qt,Es,!1),zn(Qt,ws,new WeakMap),Fe&&(Ye(Qt,Es,!0),Na.workerSrc||="./pdf.worker.mjs"),Qt._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||n.origin==="null")return!1;const a=new URL(e,n);return n.origin===a.origin},Qt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Qt.fromPort=t=>{if(t1("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Qt.create(t)};let go=Qt;class sw{#t=new Map;#e=new Map;#n=new Map;#i=new Map;#a=null;constructor(t,e,n,a,o,c){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new gv,this.fontLoader=new o1({ownerDocument:a.ownerDocument,styleElement:a.styleElement}),this.loadingParams=a.loadingParams,this._params=a,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.wasmFactory=o.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=c,this.setupMessageHandler()}#s(t,e=null){const n=this.#t.get(t);if(n)return n;const a=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,a),a}get annotationStorage(){return Et(this,"annotationStorage",new Mf)}getRenderingIntent(t,e=Gi.ENABLE,n=null,a=!1,o=!1){let c=cn.DISPLAY,h=Yd;switch(t){case"any":c=cn.ANY;break;case"display":break;case"print":c=cn.PRINT;break;default:gt(`getRenderingIntent - invalid intent: ${t}`)}const d=c&cn.PRINT&&n instanceof iv?n:this.annotationStorage;switch(e){case Gi.DISABLE:c+=cn.ANNOTATIONS_DISABLE;break;case Gi.ENABLE:break;case Gi.ENABLE_FORMS:c+=cn.ANNOTATIONS_FORMS;break;case Gi.ENABLE_STORAGE:c+=cn.ANNOTATIONS_STORAGE,h=d.serializable;break;default:gt(`getRenderingIntent - invalid annotationMode: ${e}`)}a&&(c+=cn.IS_EDITING),o&&(c+=cn.OPLIST);const{ids:f,hash:g}=d.modifiedIds,_=[c,h.hash,g];return{renderingIntent:c,cacheKey:_.join("_"),annotationStorageSerializable:h,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#e.values())t.push(n._destroy());this.#e.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Be.cleanup(),this._networkStream?.cancelAllRequests(new Xi("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,a)=>{de(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},a.onPull=()=>{this._fullReader.read().then(function({value:o,done:c}){if(c){a.close();return}de(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{a.error(o)})},a.onCancel=o=>{this._fullReader.cancel(o),a.ready.catch(c=>{if(!this.destroyed)throw c})}}),t.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:a,isRangeSupported:o,contentLength:c}=this._fullReader;return(!a||!o)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=h=>{e.onProgress?.({loaded:h.loaded,total:h.total})}),{isStreamingSupported:a,isRangeSupported:o,contentLength:c}}),t.on("GetRangeReader",(n,a)=>{de(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){a.close();return}a.onPull=()=>{o.read().then(function({value:c,done:h}){if(h){a.close();return}de(c instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(c),1,[c])}).catch(c=>{a.error(c)})},a.onCancel=c=>{o.cancel(c),a.ready.catch(h=>{if(!this.destroyed)throw h})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new nw(n,this))}),t.on("DocException",n=>{e._capability.reject(Xe(n))}),t.on("PasswordRequest",n=>{this.#a=Promise.withResolvers();try{if(!e.onPassword)throw Xe(n);const a=o=>{o instanceof Error?this.#a.reject(o):this.#a.resolve({password:o})};e.onPassword(a,n.code)}catch(a){this.#a.reject(a)}return this.#a.promise}),t.on("DataLoaded",n=>{e.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;this.#e.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,a,o])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(a){case"Font":if("error"in o){const f=o.error;gt(`Error during font loading: ${f}`),this.commonObjs.resolve(n,f);break}const c=this._params.pdfBug&&globalThis.FontInspector?.enabled?(f,g)=>globalThis.FontInspector.fontAdded(f,g):null,h=new l1(o,c);this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!h.fontExtraProperties&&h.data&&(h.data=null),this.commonObjs.resolve(n,h)});break;case"CopyLocalImage":const{imageRef:d}=o;de(d,"The imageRef must be defined.");for(const f of this.#e.values())for(const[,g]of f.objs)if(g?.ref===d)return g.dataLen?(this.commonObjs.resolve(n,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${a}`)}return null}),t.on("obj",([n,a,o,c])=>{if(this.destroyed)return;const h=this.#e.get(a);if(!h.objs.has(n)){if(h._intentStates.size===0){c?.bitmap?.close();return}switch(o){case"Image":case"Pattern":h.objs.resolve(n,c);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",n=>{this.destroyed||e.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const a=this[n.type];if(!a)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return a.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&gt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#n.get(e);if(n)return n;const a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#i.set(o.refStr,t);const c=new iw(e,o,this,this._params.pdfBug);return this.#e.set(e,c),c});return this.#n.set(e,a),a}getPageIndex(t){return Xd(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#s("GetOptionalContentConfig").then(e=>new P1(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(a=>({info:a[0],metadata:a[1]?new L1(a[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Be.cleanup()}}cachedPageNumber(t){if(!Xd(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#i.get(e)??null}}class aw{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Ra{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:n,commonObjs:a,annotationCanvasMap:o,operatorList:c,pageIndex:h,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:g=!1,pdfBug:_=!1,pageColors:y=null,enableHWA:b=!1,filteredOperationIndexes:A=null}){this.callback=t,this.params=e,this.objs=n,this.commonObjs=a,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=c,this._pageIndex=h,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=_,this.pageColors=y,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=g===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new aw(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=b,this._dependencyTracker=e.dependencyTracker,this._filteredOperationIndexes=A}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Ra.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ra.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:a,background:o,dependencyTracker:c}=this.params,h=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Ma(h,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,c),this.gfx.beginDrawing({transform:a,viewport:n,transparency:t,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Ra.#e.delete(this._canvas),t||=new Tf(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._filteredOperationIndexes),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ra.#e.delete(this._canvas),this.callback())))}}const rw="5.4.149",ow="9e2e9e209";class Sn{#t=null;#e=null;#n;#i=null;#a=!1;#s=!1;#r=null;#o;#l=null;#c=null;static#d=null;static get _keyboardManager(){return Et(this,"_keyboardManager",new Mo([[["Escape","mac+Escape"],Sn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Sn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Sn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Sn.prototype._moveToPrevious],[["Home","mac+Home"],Sn.prototype._moveToBeginning],[["End","mac+End"],Sn.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#s=!1,this.#r=t):this.#s=!0,this.#c=t?._uiManager||e,this.#o=this.#c._eventBus,this.#n=t?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",Sn.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#c._signal;t.addEventListener("click",this.#p.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const n=this.#e=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#n,t.append(n),t}renderMainDropdown(){const t=this.#i=this.#u();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#u(){const t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",wn,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,a]of this.#c.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",a),o.title=n,o.setAttribute("data-l10n-id",Sn.#d[n]);const c=document.createElement("span");o.append(c),c.className="swatch",c.style.backgroundColor=a,o.ariaSelected=a===this.#n,o.addEventListener("click",this.#f.bind(this,a),{signal:e}),t.append(o)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:Nt.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#p(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#m){this.#p(t);return}if(t.target===this.#t){this.#i.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#i?.firstChild||t.target===this.#t){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#p(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#m){this.#p(t);return}this.#i.firstChild?.focus()}_moveToEnd(t){if(!this.#m){this.#p(t);return}this.#i.lastChild?.focus()}#g(t){Sn._keyboardManager.exec(this,t)}#p(t){if(this.#m){this.hideDropdown();return}if(this.#a=t.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#c.combinedSignal(this.#l)})),this.#t.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const e=this.#i=this.#u();this.#t.append(e)}#h(t){this.#i?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#m(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#m){this.#r?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#i)return;const e=this.#c.highlightColors.values();for(const n of this.#i.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}}class mo{#t=null;#e=null;#n=null;static#i=null;constructor(t){this.#e=t,this.#n=t._uiManager,mo.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:n}=this.#e,a=this.#t=document.createElement("input");return a.type="color",a.value=n||"#000000",a.className="basicColorPicker",a.tabIndex=0,a.setAttribute("data-l10n-id",mo.#i[t]),a.addEventListener("input",()=>{this.#n.updateParams(e,a.value)},{signal:this.#n._signal}),a}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function Yy(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function Kr(r){return Math.max(0,Math.min(255,255*r))}class Xy{static CMYK_G([t,e,n,a]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+a)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Kr(t),[t,t,t]}static G_HTML([t]){const e=Yy(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(Kr)}static RGB_HTML(t){return`#${t.map(Yy).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,a]){return["RGB",1-Math.min(1,t+a),1-Math.min(1,n+a),1-Math.min(1,e+a)]}static CMYK_rgb([t,e,n,a]){return[Kr(1-Math.min(1,t+a)),Kr(1-Math.min(1,n+a)),Kr(1-Math.min(1,e+a))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const a=1-t,o=1-e,c=1-n,h=Math.min(a,o,c);return["CMYK",a,o,c,h]}}class lw{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const a=this._createSVG("svg:svg");return a.setAttribute("version","1.1"),n||(a.setAttribute("width",`${t}px`),a.setAttribute("height",`${e}px`)),a.setAttribute("preserveAspectRatio","none"),a.setAttribute("viewBox",`0 0 ${t} ${e}`),a}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Gt("Abstract method `_createSVG` called.")}}class _c extends lw{_createSVG(t){return document.createElementNS(li,t)}}class vv{static setupStorage(t,e,n,a,o){const c=a.getValue(e,{value:null});switch(n.name){case"textarea":if(c.value!==null&&(t.textContent=c.value),o==="print")break;t.addEventListener("input",h=>{a.setValue(e,{value:h.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(c.value===n.attributes.xfaOn?t.setAttribute("checked",!0):c.value===n.attributes.xfaOff&&t.removeAttribute("checked"),o==="print")break;t.addEventListener("change",h=>{a.setValue(e,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(c.value!==null&&t.setAttribute("value",c.value),o==="print")break;t.addEventListener("input",h=>{a.setValue(e,{value:h.target.value})})}break;case"select":if(c.value!==null){t.setAttribute("value",c.value);for(const h of n.children)h.attributes.value===c.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}t.addEventListener("input",h=>{const d=h.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;a.setValue(e,{value:f})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:a,linkService:o}){const{attributes:c}=e,h=t instanceof HTMLAnchorElement;c.type==="radio"&&(c.name=`${c.name}-${a}`);for(const[d,f]of Object.entries(c))if(f!=null)switch(d){case"class":f.length&&t.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",f);break;case"style":Object.assign(t.style,f);break;case"textContent":t.textContent=f;break;default:(!h||d!=="href"&&d!=="newWindow")&&t.setAttribute(d,f)}h&&o.addLinkAttributes(t,c.href,c.newWindow),n&&c.dataId&&this.setupStorage(t,c.dataId,e,n)}static render(t){const e=t.annotationStorage,n=t.linkService,a=t.xfaHtml,o=t.intent||"display",c=document.createElement(a.name);a.attributes&&this.setAttributes({html:c,element:a,intent:o,linkService:n});const h=o!=="richText",d=t.div;if(d.append(c),t.viewport){const _=`matrix(${t.viewport.transform.join(",")})`;d.style.transform=_}h&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(a.children.length===0){if(a.value){const _=document.createTextNode(a.value);c.append(_),h&&po.shouldBuildText(a.name)&&f.push(_)}return{textDivs:f}}const g=[[a,-1,c]];for(;g.length>0;){const[_,y,b]=g.at(-1);if(y+1===_.children.length){g.pop();continue}const A=_.children[++g.at(-1)[1]];if(A===null)continue;const{name:S}=A;if(S==="#text"){const w=document.createTextNode(A.value);f.push(w),b.append(w);continue}const C=A?.attributes?.xmlns?document.createElementNS(A.attributes.xmlns,S):document.createElement(S);if(b.append(C),A.attributes&&this.setAttributes({html:C,element:A,storage:e,intent:o,linkService:n}),A.children?.length>0)g.push([A,-1,C]);else if(A.value){const w=document.createTextNode(A.value);h&&po.shouldBuildText(S)&&f.push(w),C.append(w)}}for(const _ of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))_.setAttribute("readOnly",!0);return{textDivs:f}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const cw=9,xs=new WeakSet,uw=new Date().getTimezoneOffset()*60*1e3;class $y{static create(t){switch(t.data.annotationType){case ue.LINK:return new If(t);case ue.TEXT:return new hw(t);case ue.WIDGET:switch(t.data.fieldType){case"Tx":return new dw(t);case"Btn":return t.data.radioButton?new Av(t):t.data.checkBox?new pw(t):new gw(t);case"Ch":return new mw(t);case"Sig":return new fw(t)}return new ks(t);case ue.POPUP:return new Wd(t);case ue.FREETEXT:return new Sv(t);case ue.LINE:return new yw(t);case ue.SQUARE:return new bw(t);case ue.CIRCLE:return new vw(t);case ue.POLYLINE:return new Ev(t);case ue.CARET:return new Sw(t);case ue.INK:return new Pf(t);case ue.POLYGON:return new Aw(t);case ue.HIGHLIGHT:return new wv(t);case ue.UNDERLINE:return new Ew(t);case ue.SQUIGGLY:return new ww(t);case ue.STRIKEOUT:return new Cw(t);case ue.STAMP:return new Cv(t);case ue.FILEATTACHMENT:return new Tw(t);default:return new re(t)}}}class re{#t=null;#e=!1;#n=null;constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:a=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),a&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return re._hasPopupData(this.data)}get hasCommentButton(){return this.enableComment&&this._isEditable&&this.hasPopupElement}get commentButtonPosition(){const{quadPoints:t,rect:e}=this.data;let n=-1/0,a=-1/0;if(t?.length>=8){for(let o=0;o<t.length;o+=8)t[o+1]>a?(a=t[o+1],n=t[o+2]):t[o+1]===a&&(n=Math.max(n,t[o+2]));return[n,a]}return e?[e[2],e[3]]:null}get commentButtonColor(){if(!this.data.color)return null;const[t,e,n]=this.data.color,o=255*(1-(this.data.opacity??1));return this.#i(Math.min(t+o,255),Math.min(e+o,255),Math.min(n+o,255))}#i(t,e,n){t/=255,e/=255,n/=255;const a=Math.max(t,e,n),o=Math.min(t,e,n),c=(a+o)/2,h=((1+Math.sqrt(c))/2*100).toFixed(2);if(a===o)return`hsl(0, 0%, ${h}%)`;const d=a-o;let f;a===t?f=(e-n)/d+(e<n?6:0):a===e?f=(n-t)/d+2:f=(t-e)/d+4,f=(f*60).toFixed(2);const g=(d/(1-Math.abs(2*c-1))*100).toFixed(2);return`hsl(${f}, ${g}%, ${h}%)`}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:c}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-o)/n,t[1]=100*(t[1]-c)/a,t}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#a(e);let a=this.#n?.popup||this.popup;!a&&n?.text&&(this._createPopup(n),a=this.#n.popup),a&&(a.updateEdited(t),n?.deleted&&(a.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#t&&(this.#a(this.#t.rect),this.#n?.popup.resetEdited(),this.#t=null)}#a(t){const{container:{style:e},data:{rect:n,rotation:a},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:c,pageX:h,pageY:d}}}}=this;n?.splice(0,4,...t),e.left=`${100*(t[0]-h)/o}%`,e.top=`${100*(c-t[3]+d)/c}%`,a===0?(e.width=`${100*(t[2]-t[0])/o}%`,e.height=`${100*(t[3]-t[1])/c}%`):this.setRotation(a)}_createContainer(t){const{data:e,parent:{page:n,viewport:a}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",e.id),!(this instanceof ks)&&!(this instanceof If)&&(o.tabIndex=0);const{style:c}=o;if(c.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(o.title=e.alternativeText),e.noRotate&&o.classList.add("norotate"),!e.rect||this instanceof Wd){const{rotation:S}=e;return!e.hasOwnCanvas&&S!==0&&this.setRotation(S,o),o}const{width:h,height:d}=this;if(!t&&e.borderStyle.width>0){c.borderWidth=`${e.borderStyle.width}px`;const S=e.borderStyle.horizontalCornerRadius,C=e.borderStyle.verticalCornerRadius;if(S>0||C>0){const M=`calc(${S}px * var(--total-scale-factor)) / calc(${C}px * var(--total-scale-factor))`;c.borderRadius=M}else if(this instanceof Av){const M=`calc(${h}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;c.borderRadius=M}switch(e.borderStyle.style){case wa.SOLID:c.borderStyle="solid";break;case wa.DASHED:c.borderStyle="dashed";break;case wa.BEVELED:gt("Unimplemented border style: beveled");break;case wa.INSET:gt("Unimplemented border style: inset");break;case wa.UNDERLINE:c.borderBottomStyle="solid";break}const w=e.borderColor||null;w?(this.#e=!0,c.borderColor=nt.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):c.borderWidth=0}const f=nt.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:g,pageHeight:_,pageX:y,pageY:b}=a.rawDims;c.left=`${100*(f[0]-y)/g}%`,c.top=`${100*(f[1]-b)/_}%`;const{rotation:A}=e;return e.hasOwnCanvas||A===0?(c.width=`${100*h/g}%`,c.height=`${100*d/_}%`):this.setRotation(A,o),o}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:a}=this.parent.viewport.rawDims;let{width:o,height:c}=this;t%180!==0&&([o,c]=[c,o]),e.style.width=`${100*o/n}%`,e.style.height=`${100*c/a}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,n,a)=>{const o=a.detail[e],c=o[0],h=o.slice(1);a.target.style[n]=Xy[`${c}_HTML`](h),this.annotationStorage.setValue(this.data.id,{[n]:Xy[`${c}_rgb`](h)})};return Et(this,"_commonActions",{display:e=>{const{display:n}=e.detail,a=n%2===1;this.container.style.visibility=a?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:a,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const a of Object.keys(e.detail))(t[a]||n[a])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[a,o]of Object.entries(e)){const c=n[a];if(c){const h={detail:{[a]:o},target:t};c(h),delete e[a]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,a,o]=this.data.rect.map(S=>Math.fround(S));if(t.length===8){const[S,C,w,M]=t.subarray(2,6);if(a===S&&o===C&&e===w&&n===M)return}const{style:c}=this.container;let h;if(this.#e){const{borderColor:S,borderWidth:C}=c;c.borderWidth=0,h=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${S}" stroke-width="${C}">`],this.container.classList.add("hasBorder")}const d=a-e,f=o-n,{svgFactory:g}=this,_=g.createElement("svg");_.classList.add("quadrilateralsContainer"),_.setAttribute("width",0),_.setAttribute("height",0),_.role="none";const y=g.createElement("defs");_.append(y);const b=g.createElement("clipPath"),A=`clippath_${this.data.id}`;b.setAttribute("id",A),b.setAttribute("clipPathUnits","objectBoundingBox"),y.append(b);for(let S=2,C=t.length;S<C;S+=8){const w=t[S],M=t[S+1],T=t[S+2],N=t[S+3],R=g.createElement("rect"),k=(T-e)/d,z=(o-M)/f,j=(w-T)/d,$=(M-N)/f;R.setAttribute("x",k),R.setAttribute("y",z),R.setAttribute("width",j),R.setAttribute("height",$),b.append(R),h?.push(`<rect vector-effect="non-scaling-stroke" x="${k}" y="${z}" width="${j}" height="${$}"/>`)}this.#e&&(h.push("</g></svg>')"),c.backgroundImage=h.join("")),this.container.append(_),this.container.style.clipPath=`url(#${A})`}_createPopup(t=null){const{data:e}=this;let n,a;t?(n={str:t.text},a=t.date):(n=e.contentsObj,a=e.modificationDate);const o=this.#n=new Wd({data:{color:e.color,titleObj:e.titleObj,modificationDate:a,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(o.render())}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}render(){Gt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const a=this._fieldObjects[t];if(a)for(const{page:o,id:c,exportValues:h}of a){if(o===-1||c===e)continue;const d=typeof h=="string"?h:null,f=document.querySelector(`[data-element-id="${c}"]`);if(f&&!xs.has(f)){gt(`_getElementsByName - element not allowed: ${c}`);continue}n.push({id:c,exportValue:d,domElement:f})}return n}for(const a of document.getElementsByName(t)){const{exportValue:o}=a,c=a.getAttribute("data-element-id");c!==e&&xs.has(a)&&n.push({id:c,exportValue:o,domElement:a})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class If extends re{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let a=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),a=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),a=!0):t.attachment?(this.#e(n,t.attachment,t.overlaidText,t.attachmentDest),a=!0):t.setOCGState?(this.#n(n,t.setOCGState,t.overlaidText),a=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),a=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),a=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),a=!0):this.isTooltipOnly&&!a&&(this._bindLink(n,""),a=!0)),this.container.classList.add("linkAnnotation"),a&&this.container.append(n),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,n=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),n&&(t.title=n)}_bindNamedAction(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#t()}#e(t,e,n="",a=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,a),!1),this.#t()}#n(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const a of Object.keys(e.actions)){const o=n.get(a);o&&(t[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:a}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){gt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(t.onclick=()=>!1);return}t.onclick=()=>{n?.();const{fields:a,refs:o,include:c}=e,h=[];if(a.length!==0||o.length!==0){const g=new Set(o);for(const _ of a){const y=this._fieldObjects[_]||[];for(const{id:b}of y)g.add(b)}for(const _ of Object.values(this._fieldObjects))for(const y of _)g.has(y.id)===c&&h.push(y)}else for(const g of Object.values(this._fieldObjects))h.push(...g);const d=this.annotationStorage,f=[];for(const g of h){const{id:_}=g;switch(f.push(_),g.type){case"text":{const b=g.defaultValue||"";d.setValue(_,{value:b});break}case"checkbox":case"radiobutton":{const b=g.defaultValue===g.exportValues;d.setValue(_,{value:b});break}case"combobox":case"listbox":{const b=g.defaultValue||"";d.setValue(_,{value:b});break}default:continue}const y=document.querySelector(`[data-element-id="${_}"]`);if(y){if(!xs.has(y)){gt(`_bindResetFormAction - element not allowed: ${_}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class hw extends re{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class ks extends re{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Ne.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,a,o){n.includes("mouse")?t.addEventListener(n,c=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:a,value:o(c),shift:c.shiftKey,modifier:this._getKeyModifier(c)}})}):t.addEventListener(n,c=>{if(n==="blur"){if(!e.focused||!c.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}o&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:a,value:o(c)}})})}_setEventListeners(t,e,n,a){for(const[o,c]of n)(c==="Action"||this.data.actions?.[c])&&((c==="Focus"||c==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,o,c,a),c==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":nt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,a=this.data.defaultAppearanceData.fontSize||cw,o=t.style;let c;const h=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h),g=Math.round(f/(Ad*a))||1,_=f/g;c=Math.min(a,d(_/Ad))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h);c=Math.min(a,d(f/Ad))}o.fontSize=`calc(${c}px * var(--total-scale-factor))`,o.color=nt.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class dw extends ks{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,a){const o=this.annotationStorage;for(const c of this._getElementsByName(t.name,t.id))c.domElement&&(c.domElement[e]=n),o.setValue(c.id,{[a]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const a=t.getValue(e,{value:this.data.fieldValue});let o=a.value||"";const c=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;c&&o.length>c&&(o=o.slice(0,c));let h=a.formattedValue||this.data.textContent?.join(`
`)||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=h??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",h??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),xs.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:f,datetimeType:g,timeStep:_}=this.data,y=!!g&&this.enableScripting;f&&(n.title=f),this._setRequired(n,this.data.required),c&&(n.maxLength=c),n.addEventListener("input",A=>{t.setValue(e,{value:A.target.value}),this.setPropertyOnSiblings(n,"value",A.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",A=>{const S=this.data.defaultFieldValue??"";n.value=d.userValue=S,d.formattedValue=null});let b=A=>{const{formattedValue:S}=d;S!=null&&(A.target.value=S),A.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",S=>{if(d.focused)return;const{target:C}=S;if(y&&(C.type=g,_&&(C.step=_)),d.userValue){const w=d.userValue;if(y)if(g==="time"){const M=new Date(w),T=[M.getHours(),M.getMinutes(),M.getSeconds()];C.value=T.map(N=>N.toString().padStart(2,"0")).join(":")}else C.value=new Date(w-uw).toISOString().split(g==="date"?"T":".",1)[0];else C.value=w}d.lastCommittedValue=C.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",S=>{this.showElementAndHideCanvas(S.target);const C={value(w){d.userValue=w.detail.value??"",y||t.setValue(e,{value:d.userValue.toString()}),w.target.value=d.userValue},formattedValue(w){const{formattedValue:M}=w.detail;d.formattedValue=M,M!=null&&w.target!==document.activeElement&&(w.target.value=M);const T={formattedValue:M};y&&(T.value=M),t.setValue(e,T)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{const{charLimit:M}=w.detail,{target:T}=w;if(M===0){T.removeAttribute("maxLength");return}T.setAttribute("maxLength",M);let N=d.userValue;!N||N.length<=M||(N=N.slice(0,M),T.value=d.userValue=N,t.setValue(e,{value:N}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:N,willCommit:!0,commitKey:1,selStart:T.selectionStart,selEnd:T.selectionEnd}}))}};this._dispatchEventFromSandbox(C,S)}),n.addEventListener("keydown",S=>{d.commitKey=1;let C=-1;if(S.key==="Escape"?C=0:S.key==="Enter"&&!this.data.multiLine?C=2:S.key==="Tab"&&(d.commitKey=3),C===-1)return;const{value:w}=S.target;d.lastCommittedValue!==w&&(d.lastCommittedValue=w,d.userValue=w,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:C,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}}))});const A=b;b=null,n.addEventListener("blur",S=>{if(!d.focused||!S.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:C}=S;let{value:w}=C;if(y){if(w&&g==="time"){const M=w.split(":").map(T=>parseInt(T,10));w=new Date(2e3,0,1,M[0],M[1],M[2]||0).valueOf(),C.step=""}else w=new Date(w).valueOf();C.type="text"}d.userValue=w,d.lastCommittedValue!==w&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:d.commitKey,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}}),A(S)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",S=>{d.lastCommittedValue=null;const{data:C,target:w}=S,{value:M,selectionStart:T,selectionEnd:N}=w;let R=T,k=N;switch(S.inputType){case"deleteWordBackward":{const z=M.substring(0,T).match(/\w*[^\w]*$/);z&&(R-=z[0].length);break}case"deleteWordForward":{const z=M.substring(T).match(/^[^\w]*\w*/);z&&(k+=z[0].length);break}case"deleteContentBackward":T===N&&(R-=1);break;case"deleteContentForward":T===N&&(k+=1);break}S.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:M,change:C||"",willCommit:!1,selStart:R,selEnd:k}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],S=>S.target.value)}if(b&&n.addEventListener("blur",b),this.data.comb){const S=(this.data.rect[2]-this.data.rect[0])/c;n.classList.add("comb"),n.style.letterSpacing=`calc(${S}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class fw extends ks{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class pw extends ks{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let a=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof a=="string"&&(a=a!=="Off",t.setValue(n,{value:a})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return xs.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=e.fieldName,a&&o.setAttribute("checked",!0),o.setAttribute("exportValue",e.exportValue),o.tabIndex=0,o.addEventListener("change",c=>{const{name:h,checked:d}=c.target;for(const f of this._getElementsByName(h,n)){const g=d&&f.exportValue===e.exportValue;f.domElement&&(f.domElement.checked=g),t.setValue(f.id,{value:g})}t.setValue(n,{value:d})}),o.addEventListener("resetform",c=>{const h=e.defaultFieldValue||"Off";c.target.checked=h===e.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",c=>{const h={value(d){d.target.checked=d.detail.value!=="Off",t.setValue(n,{value:d.target.checked})}};this._dispatchEventFromSandbox(h,c)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class Av extends ks{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let a=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof a=="string"&&(a=a!==e.buttonValue,t.setValue(n,{value:a})),a)for(const c of this._getElementsByName(e.fieldName,n))t.setValue(c.id,{value:!1});const o=document.createElement("input");if(xs.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=e.fieldName,a&&o.setAttribute("checked",!0),o.tabIndex=0,o.addEventListener("change",c=>{const{name:h,checked:d}=c.target;for(const f of this._getElementsByName(h,n))t.setValue(f.id,{value:!1});t.setValue(n,{value:d})}),o.addEventListener("resetform",c=>{const h=e.defaultFieldValue;c.target.checked=h!=null&&h===e.buttonValue}),this.enableScripting&&this.hasJSActions){const c=e.buttonValue;o.addEventListener("updatefromsandbox",h=>{const d={value:f=>{const g=c===f.detail.value;for(const _ of this._getElementsByName(f.target.name)){const y=g&&_.id===n;_.domElement&&(_.domElement.checked=y),t.setValue(_.id,{value:y})}}};this._dispatchEventFromSandbox(d,h)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class gw extends If{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}}class mw extends ks{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),a=document.createElement("select");xs.add(a),a.setAttribute("data-element-id",e),a.disabled=this.data.readOnly,this._setRequired(a,this.data.required),a.name=this.data.fieldName,a.tabIndex=0;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(a.size=this.data.options.length,this.data.multiSelect&&(a.multiple=!0)),a.addEventListener("resetform",g=>{const _=this.data.defaultFieldValue;for(const y of a.options)y.selected=y.value===_});for(const g of this.data.options){const _=document.createElement("option");_.textContent=g.displayValue,_.value=g.exportValue,n.value.includes(g.exportValue)&&(_.setAttribute("selected",!0),o=!1),a.append(_)}let c=null;if(o){const g=document.createElement("option");g.value=" ",g.setAttribute("hidden",!0),g.setAttribute("selected",!0),a.prepend(g),c=()=>{g.remove(),a.removeEventListener("input",c),c=null},a.addEventListener("input",c)}const h=g=>{const _=g?"value":"textContent",{options:y,multiple:b}=a;return b?Array.prototype.filter.call(y,A=>A.selected).map(A=>A[_]):y.selectedIndex===-1?null:y[y.selectedIndex][_]};let d=h(!1);const f=g=>{const _=g.target.options;return Array.prototype.map.call(_,y=>({displayValue:y.textContent,exportValue:y.value}))};return this.enableScripting&&this.hasJSActions?(a.addEventListener("updatefromsandbox",g=>{const _={value(y){c?.();const b=y.detail.value,A=new Set(Array.isArray(b)?b:[b]);for(const S of a.options)S.selected=A.has(S.value);t.setValue(e,{value:h(!0)}),d=h(!1)},multipleSelection(y){a.multiple=!0},remove(y){const b=a.options,A=y.detail.remove;b[A].selected=!1,a.remove(A),b.length>0&&Array.prototype.findIndex.call(b,C=>C.selected)===-1&&(b[0].selected=!0),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},clear(y){for(;a.length!==0;)a.remove(0);t.setValue(e,{value:null,items:[]}),d=h(!1)},insert(y){const{index:b,displayValue:A,exportValue:S}=y.detail.insert,C=a.children[b],w=document.createElement("option");w.textContent=A,w.value=S,C?C.before(w):a.append(w),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},items(y){const{items:b}=y.detail;for(;a.length!==0;)a.remove(0);for(const A of b){const{displayValue:S,exportValue:C}=A,w=document.createElement("option");w.textContent=S,w.value=C,a.append(w)}a.options.length>0&&(a.options[0].selected=!0),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},indices(y){const b=new Set(y.detail.indices);for(const A of y.target.options)A.selected=b.has(A.index);t.setValue(e,{value:h(!0)}),d=h(!1)},editable(y){y.target.disabled=!y.detail.editable}};this._dispatchEventFromSandbox(_,g)}),a.addEventListener("input",g=>{const _=h(!0),y=h(!1);t.setValue(e,{value:_}),g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:d,change:y,changeEx:_,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(a,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],g=>g.target.value)):a.addEventListener("input",function(g){t.setValue(e,{value:h(!0)})}),this.data.combo&&this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class Wd extends re{constructor(t){const{data:e,elements:n}=t;super(t,{isRenderable:re._hasPopupData(e)}),this.elements=n,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new _w({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,eventBus:this.linkService.eventBus}),n=[];for(const a of this.elements)a.popup=e,a.container.ariaHasPopup="dialog",n.push(a.data.id),a.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(a=>`${Cf}${a}`).join(",")),this.container}}class _w{#t=this.#L.bind(this);#e=this.#C.bind(this);#n=this.#H.bind(this);#i=this.#N.bind(this);#a=null;#s=null;#r=null;#o=null;#l=null;#c=null;#d=null;#u=null;#f=!1;#g=null;#p=null;#h=null;#m=null;#b=null;#_=null;#A=null;#S=null;#y=null;#E=null;#R=!1;constructor({container:t,color:e,elements:n,titleObj:a,modificationDate:o,contentsObj:c,richText:h,parent:d,rect:f,parentRect:g,open:_,eventBus:y=null}){this.#s=t,this.#y=a,this.#r=c,this.#S=h,this.#d=d,this.#a=e,this.#A=f,this.#u=g,this.#l=n,this.#c=y,this.#o=Vd.toDateObject(o),this.trigger=n.flatMap(b=>b.getElementsToTriggerPopup()),this.#T(),this.#s.hidden=!0,_&&this.#N()}#T(){if(this.#p)return;this.#p=new AbortController;const{signal:t}=this.#p;for(const e of this.trigger)e.addEventListener("click",this.#i,{signal:t}),e.addEventListener("mouseenter",this.#n,{signal:t}),e.addEventListener("mouseleave",this.#e,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#t,{signal:t});this.#O()}#w(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition),this.#_=t.commentButtonColor)}#O(){if(this.#m||(this.#b||this.#w(),!this.#b))return;const t=this.#m=document.createElement("button");t.className="annotationCommentButton";const e=this.#l[0].container;t.style.zIndex=e.style.zIndex+1,t.tabIndex=0;const{signal:n}=this.#p;t.addEventListener("hover",this.#i,{signal:n}),t.addEventListener("keydown",this.#t,{signal:n}),t.addEventListener("click",()=>{const[{data:{id:o},annotationEditorType:c}]=this.#l;this.#c?.dispatch("switchannotationeditormode",{source:this,editId:o,mode:c,editComment:!0})},{signal:n});const{style:a}=t;a.left=`calc(${this.#b[0]}%)`,a.top=`calc(${this.#b[1]}% - var(--comment-button-dim))`,this.#_&&(a.backgroundColor=this.#_),e.after(t)}render(){if(this.#g)return;const t=this.#g=document.createElement("div");if(t.className="popup",this.#a){const a=t.style.outlineColor=nt.makeHexColor(...this.#a);t.style.backgroundColor=`color-mix(in srgb, ${a} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#y?.str){const a=document.createElement("span");a.className="title",e.append(a),{dir:a.dir,str:a.textContent}=this.#y}if(t.append(e),this.#o){const a=document.createElement("time");a.className="popupDate",a.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),a.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),a.dateTime=this.#o.toISOString(),e.append(a)}const n=this.#x;if(n)vv.render({xfaHtml:n,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const a=this._formatContents(this.#r);t.append(a)}this.#s.append(t)}get#x(){const t=this.#S,e=this.#r;return t?.str&&(!e?.str||e.str===t.str)&&this.#S.html||null}get#D(){return this.#x?.attributes?.style?.fontSize||0}get#I(){return this.#x?.attributes?.style?.color||null}#k(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},a={style:{color:this.#I,fontSize:this.#D?`calc(${this.#D}px * var(--total-scale-factor))`:""}};for(const o of t.split(`
`))e.push({name:"span",value:o,attributes:a});return n}_formatContents({str:t,dir:e}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=e;const a=t.split(/(?:\r\n?|\n)/);for(let o=0,c=a.length;o<c;++o){const h=a[o];n.append(document.createTextNode(h)),o<c-1&&n.append(document.createElement("br"))}return n}#L(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#N()}updateEdited({rect:t,popup:e,deleted:n}){if(n||e?.deleted){this.remove();return}this.#T(),this.#E||={contentsObj:this.#r,richText:this.#S},t&&(this.#h=null),e&&(this.#S=this.#k(e.text),this.#o=Vd.toDateObject(e.date),this.#r=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#E&&({contentsObj:this.#r,richText:this.#S}=this.#E,this.#E=null,this.#g?.remove(),this.#g=null,this.#h=null)}remove(){this.#p?.abort(),this.#p=null,this.#g?.remove(),this.#g=null,this.#R=!1,this.#f=!1;for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#P(){if(this.#h!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:a,pageY:o}}}=this.#d;let c=!!this.#u,h=c?this.#u:this.#A;for(const A of this.#l)if(!h||nt.intersect(A.data.rect,h)!==null){h=A.data.rect,c=!0;break}const d=nt.normalizeRect([h[0],t[3]-h[1]+t[1],h[2],t[3]-h[3]+t[1]]),g=c?h[2]-h[0]+5:0,_=d[0]+g,y=d[1];this.#h=[100*(_-a)/e,100*(y-o)/n];const{style:b}=this.#s;b.left=`${this.#h[0]}%`,b.top=`${this.#h[1]}%`}#N(){this.#f=!this.#f,this.#f?(this.#H(),this.#s.addEventListener("click",this.#i),this.#s.addEventListener("keydown",this.#t)):(this.#C(),this.#s.removeEventListener("click",this.#i),this.#s.removeEventListener("keydown",this.#t))}#H(){this.#g||this.render(),this.isVisible?this.#f&&this.#s.classList.add("focused"):(this.#P(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#C(){this.#s.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#R=this.isVisible,this.#R&&(this.#s.hidden=!0)}maybeShow(){this.#T(),this.#R&&(this.#g||this.#H(),this.#R=!1,this.#s.hidden=!1)}get isVisible(){return this.#s.hidden===!1}}class Sv extends re{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=ft.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class yw extends re{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,a=this.svgFactory.create(e,n,!0),o=this.#t=this.svgFactory.createElement("svg:line");return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),a.append(o),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class bw extends re{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,a=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,c=this.#t=this.svgFactory.createElement("svg:rect");return c.setAttribute("x",o/2),c.setAttribute("y",o/2),c.setAttribute("width",e-o),c.setAttribute("height",n-o),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class vw extends re{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,a=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,c=this.#t=this.svgFactory.createElement("svg:ellipse");return c.setAttribute("cx",e/2),c.setAttribute("cy",n/2),c.setAttribute("rx",e/2-o/2),c.setAttribute("ry",n/2-o/2),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ev extends re{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:a},width:o,height:c}=this;if(!e)return this.container;const h=this.svgFactory.create(o,c,!0);let d=[];for(let g=0,_=e.length;g<_;g+=2){const y=e[g]-t[0],b=t[3]-e[g+1];d.push(`${y},${b}`)}d=d.join(" ");const f=this.#t=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",d),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),h.append(f),this.container.append(h),!a&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Aw extends Ev{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Sw extends re{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Pf extends re{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ft.HIGHLIGHT:ft.INK}#n(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:a,popupRef:o}}=this,{transform:c,width:h,height:d}=this.#n(e,t),f=this.svgFactory.create(h,d,!0),g=this.#t=this.svgFactory.createElement("svg:g");f.append(g),g.setAttribute("stroke-width",a.width||1),g.setAttribute("stroke-linecap","round"),g.setAttribute("stroke-linejoin","round"),g.setAttribute("stroke-miterlimit",10),g.setAttribute("stroke","transparent"),g.setAttribute("fill","transparent"),g.setAttribute("transform",c);for(let _=0,y=n.length;_<y;_++){const b=this.svgFactory.createElement(this.svgElementName);this.#e.push(b),b.setAttribute("points",n[_].join(",")),g.append(b)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:a}=t,o=this.#t;if(e>=0&&o.setAttribute("stroke-width",e||1),n)for(let c=0,h=this.#e.length;c<h;c++)this.#e[c].setAttribute("points",n[c].join(","));if(a){const{transform:c,width:h,height:d}=this.#n(this.data.rotation,a);o.parentElement.setAttribute("viewBox",`0 0 ${h} ${d}`),o.setAttribute("transform",c)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}get commentButtonPosition(){const{inkLists:t,rect:e}=this.data;if(t?.length>=1){let n=-1/0,a=-1/0;for(const o of t)for(let c=0,h=o.length;c<h;c+=2)o[c+1]>a?(a=o[c+1],n=o[c]):o[c+1]===a&&(n=Math.max(n,o[c]));if(n!==1/0)return[n,a]}return e?[e[2],e[3]]:null}}class wv extends re{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ft.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Ew extends re{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class ww extends re{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Cw extends re{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Cv extends re{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ft.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Tw extends re{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||e.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#e.bind(this)),this.#t=n;const{isMac:a}=Ne.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(a?o.metaKey:o.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Bf{#t=null;#e=null;#n=new Map;#i=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:a,page:o,viewport:c,structTreeLayer:h}){this.div=t,this.#t=e,this.#e=n,this.#i=h||null,this.page=o,this.viewport=c,this.zIndex=0,this._annotationEditorUIManager=a}hasEditableAnnotations(){return this.#n.size>0}async#a(t,e,n){const a=t.firstChild||t,o=a.id=`${Cf}${e}`,c=await this.#i?.getAriaAttributes(o);if(c)for(const[h,d]of c)a.setAttribute(h,d);n?n.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,a,!1))}async render(t){const{annotations:e}=t,n=this.div;Ts(n,this.viewport);const a=new Map,o={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new _c,annotationStorage:t.annotationStorage||new Mf,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const c of e){if(c.noHTML)continue;const h=c.annotationType===ue.POPUP;if(h){const g=a.get(c.id);if(!g)continue;o.elements=g}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;o.data=c;const d=$y.create(o);if(!d.isRenderable)continue;if(!h&&c.popupRef){const g=a.get(c.popupRef);g?g.push(d):a.set(c.popupRef,[d])}const f=d.render();c.hidden&&(f.style.visibility="hidden"),await this.#a(f,c.id,o.elements),d._isEditable&&(this.#n.set(d.data.id,d),this._annotationEditorUIManager?.renderAnnotationElement(d))}this.#s()}async addLinkAnnotations(t,e){const n={data:null,layer:this.div,linkService:e,svgFactory:new _c,parent:this};for(const a of t){a.borderStyle||=Bf._defaultBorderStyle,n.data=a;const o=$y.create(n);if(!o.isRenderable)continue;const c=o.render();await this.#a(c,a.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,Ts(e,{rotation:t.rotation}),this.#s(),e.hidden=!1}#s(){if(!this.#e)return;const t=this.div;for(const[e,n]of this.#e){const a=t.querySelector(`[data-annotation-id="${e}"]`);if(!a)continue;n.className="annotationContent";const{firstChild:o}=a;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):a.append(n);const c=this.#n.get(e);c&&(c._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,a.id,n),c._hasNoCanvas=!1):c.canvas=n)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(t){return this.#n.get(t)}static get _defaultBorderStyle(){return Et(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:wa.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const ac=/\r\n?|\n/g;class ve extends rt{#t;#e="";#n=`${this.id}-editor`;#i=null;#a;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=ve.prototype,e=o=>o.isEmpty(),n=$i.TRANSLATE_SMALL,a=$i.TRANSLATE_BIG;return Et(this,"_keyboardManager",new Mo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-a,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[a,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-a],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,a],checker:e}]]))}static _type="freetext";static _editorType=ft.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#t=t.color||ve._defaultColor||rt._defaultLineColor,this.#a=t.fontSize||ve._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){rt.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case Nt.FREETEXT_SIZE:ve._defaultFontSize=e;break;case Nt.FREETEXT_COLOR:ve._defaultColor=e;break}}updateParams(t,e){switch(t){case Nt.FREETEXT_SIZE:this.#s(e);break;case Nt.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[Nt.FREETEXT_SIZE,ve._defaultFontSize],[Nt.FREETEXT_COLOR,ve._defaultColor||rt._defaultLineColor]]}get propertiesToUpdate(){return[[Nt.FREETEXT_SIZE,this.#a],[Nt.FREETEXT_COLOR,this.#t]]}get toolbarButtons(){return this._colorPicker||=new mo(this),[["colorPicker",this._colorPicker]]}get colorType(){return Nt.FREETEXT_COLOR}get colorValue(){return this.#t}#s(t){const e=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--total-scale-factor))`,this.translate(0,-(a-this.#a)*this.parentScale),this.#a=a,this.#l()},n=this.#a;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#r(t){const e=a=>{this.#t=this.editorDiv.style.color=a,this._colorPicker?.update(a)},n=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-ve._internalPadding*t,-(ve._internalPadding+this.#a)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(ve.#c(n)),e=n);return t.join(`
`)}#l(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:a,div:o}=this,c=o.style.display,h=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",a.div.append(this.div),n=o.getBoundingClientRect(),o.remove(),o.style.display=c,o.classList.toggle("hidden",h)}this.rotation%180===this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;const n=a=>{if(this.#e=a,!a){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#l()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#l()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){ve._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#a}px * var(--total-scale-factor))`,n.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[a,o]=this.parentDimensions;if(this.annotationElementId){const{position:c}=this._initialData;let[h,d]=this.getInitialTranslation();[h,d]=this.pageTranslationToScreen(h,d);const[f,g]=this.pageDimensions,[_,y]=this.pageTranslation;let b,A;switch(this.rotation){case 0:b=t+(c[0]-_)/f,A=e+this.height-(c[1]-y)/g;break;case 90:b=t+(c[0]-_)/f,A=e-(c[1]-y)/g,[h,d]=[d,-h];break;case 180:b=t-this.width+(c[0]-_)/f,A=e-(c[1]-y)/g,[h,d]=[-h,-d];break;case 270:b=t+(c[0]-_-this.height*g)/f,A=e+(c[1]-y-this.width*f)/g,[h,d]=[-d,h];break}this.setAt(b*a,A*o,h,d)}else this._moveAfterPaste(t,e);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(ac,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(n.length===1&&n[0]==="text/plain")return;t.preventDefault();const a=ve.#f(e.getData("text")||"").replaceAll(ac,`
`);if(!a)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const c=o.getRangeAt(0);if(!a.includes(`
`)){c.insertNode(document.createTextNode(a)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:h,startOffset:d}=c,f=[],g=[];if(h.nodeType===Node.TEXT_NODE){const b=h.parentElement;if(g.push(h.nodeValue.slice(d).replaceAll(ac,"")),b!==this.editorDiv){let A=f;for(const S of this.editorDiv.childNodes){if(S===b){A=g;continue}A.push(ve.#c(S))}}f.push(h.nodeValue.slice(0,d).replaceAll(ac,""))}else if(h===this.editorDiv){let b=f,A=0;for(const S of this.editorDiv.childNodes)A++===d&&(b=g),b.push(ve.#c(S))}this.#e=`${f.join(`
`)}${a}${g.join(`
`)}`,this.#d();const _=new Range;let y=Math.sumPrecise(f.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const A=b.nodeValue.length;if(y<=A){_.setStart(b,y),_.setEnd(b,y);break}y-=A}o.removeAllRanges(),o.addRange(_)}#d(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const t of this.#e.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#e.replaceAll(" "," ")}static#f(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=ve._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,n){let a=null;if(t instanceof Sv){const{data:{defaultAppearanceData:{fontSize:c,fontColor:h},rect:d,rotation:f,id:g,popupRef:_,contentsObj:y},textContent:b,textPosition:A,parent:{page:{pageNumber:S}}}=t;if(!b||b.length===0)return null;a=t={annotationType:ft.FREETEXT,color:Array.from(h),fontSize:c,value:b.join(`
`),position:A,pageIndex:S-1,rect:d.slice(0),rotation:f,annotationElementId:g,id:g,deleted:!1,popupRef:_,comment:y?.str||null}}const o=await super.deserialize(t,e,n);return o.#a=t.fontSize,o.#t=nt.makeHexColor(...t.color),o.#e=ve.#f(t.value),o._initialData=a,t.comment&&o.setCommentData(t.comment),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),n=rt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),a={annotationType:ft.FREETEXT,color:n,fontSize:this.#a,value:this.#u(),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#g(a)?null:(a.id=this.annotationElementId,a)}#g(t){const{value:e,fontSize:n,color:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((c,h)=>c!==a[h])||t.pageIndex!==o}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:n}=e;n.fontSize=`calc(${this.#a}px * var(--total-scale-factor))`,n.color=this.#t,e.replaceChildren();for(const o of this.#e.split(`
`)){const c=document.createElement("div");c.append(o?document.createTextNode(o):document.createElement("br")),e.append(c)}const a={rect:this.getPDFRect()};return a.popup=this.hasEditedComment?this.comment:{text:this.#e},t.updateEdited(a),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class J{static PRECISION=1e-4;toSVGPath(){Gt("Abstract method `toSVGPath` must be implemented.")}get box(){Gt("Abstract getter `box` must be implemented.")}serialize(t,e){Gt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,a,o,c){c||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)c[h]=e+t[h]*a,c[h+1]=n+t[h+1]*o;return c}static _rescaleAndSwap(t,e,n,a,o,c){c||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)c[h]=e+t[h+1]*a,c[h+1]=n+t[h]*o;return c}static _translate(t,e,n,a){a||=new Float32Array(t.length);for(let o=0,c=t.length;o<c;o+=2)a[o]=e+t[o],a[o+1]=n+t[o+1];return a}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,a,o){switch(o){case 90:return[1-e/n,t/a];case 180:return[1-t/n,1-e/a];case 270:return[e/n,1-t/a];default:return[t/n,e/a]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,a,o,c){return[(t+5*n)/6,(e+5*a)/6,(5*n+o)/6,(5*a+c)/6,(n+o)/2,(a+c)/2]}}class bs{#t;#e=[];#n;#i;#a=[];#s=new Float32Array(18);#r;#o;#l;#c;#d;#u;#f=[];static#g=8;static#p=2;static#h=bs.#g+bs.#p;constructor({x:t,y:e},n,a,o,c,h=0){this.#t=n,this.#u=o*a,this.#i=c,this.#s.set([NaN,NaN,NaN,NaN,t,e],6),this.#n=h,this.#c=bs.#g*a,this.#l=bs.#h*a,this.#d=a,this.#f.push(t,e)}isEmpty(){return isNaN(this.#s[8])}#m(){const t=this.#s.subarray(4,6),e=this.#s.subarray(16,18),[n,a,o,c]=this.#t;return[(this.#r+(t[0]-e[0])/2-n)/o,(this.#o+(t[1]-e[1])/2-a)/c,(this.#r+(e[0]-t[0])/2-n)/o,(this.#o+(e[1]-t[1])/2-a)/c]}add({x:t,y:e}){this.#r=t,this.#o=e;const[n,a,o,c]=this.#t;let[h,d,f,g]=this.#s.subarray(8,12);const _=t-f,y=e-g,b=Math.hypot(_,y);if(b<this.#l)return!1;const A=b-this.#c,S=A/b,C=S*_,w=S*y;let M=h,T=d;h=f,d=g,f+=C,g+=w,this.#f?.push(t,e);const N=-w/A,R=C/A,k=N*this.#u,z=R*this.#u;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([f+k,g+z],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([f-k,g-z],16),isNaN(this.#s[6])?(this.#a.length===0&&(this.#s.set([h+k,d+z],2),this.#a.push(NaN,NaN,NaN,NaN,(h+k-n)/o,(d+z-a)/c),this.#s.set([h-k,d-z],14),this.#e.push(NaN,NaN,NaN,NaN,(h-k-n)/o,(d-z-a)/c)),this.#s.set([M,T,h,d,f,g],6),!this.isEmpty()):(this.#s.set([M,T,h,d,f,g],6),Math.abs(Math.atan2(T-d,M-h)-Math.atan2(w,C))<Math.PI/2?([h,d,f,g]=this.#s.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((h+f)/2-n)/o,((d+g)/2-a)/c),[h,d,M,T]=this.#s.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((M+h)/2-n)/o,((T+d)/2-a)/c),!0):([M,T,h,d,f,g]=this.#s.subarray(0,6),this.#a.push(((M+5*h)/6-n)/o,((T+5*d)/6-a)/c,((5*h+f)/6-n)/o,((5*d+g)/6-a)/c,((h+f)/2-n)/o,((d+g)/2-a)/c),[f,g,h,d,M,T]=this.#s.subarray(12,18),this.#e.push(((M+5*h)/6-n)/o,((T+5*d)/6-a)/c,((5*h+f)/6-n)/o,((5*d+g)/6-a)/c,((h+f)/2-n)/o,((d+g)/2-a)/c),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#b();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let a=6;a<t.length;a+=6)isNaN(t[a])?n.push(`L${t[a+4]} ${t[a+5]}`):n.push(`C${t[a]} ${t[a+1]} ${t[a+2]} ${t[a+3]} ${t[a+4]} ${t[a+5]}`);this.#A(n);for(let a=e.length-6;a>=6;a-=6)isNaN(e[a])?n.push(`L${e[a+4]} ${e[a+5]}`):n.push(`C${e[a]} ${e[a+1]} ${e[a+2]} ${e[a+3]} ${e[a+4]} ${e[a+5]}`);return this.#_(n),n.join(" ")}#b(){const[t,e,n,a]=this.#t,[o,c,h,d]=this.#m();return`M${(this.#s[2]-t)/n} ${(this.#s[3]-e)/a} L${(this.#s[4]-t)/n} ${(this.#s[5]-e)/a} L${o} ${c} L${h} ${d} L${(this.#s[16]-t)/n} ${(this.#s[17]-e)/a} L${(this.#s[14]-t)/n} ${(this.#s[15]-e)/a} Z`}#_(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#A(t){const[e,n,a,o]=this.#t,c=this.#s.subarray(4,6),h=this.#s.subarray(16,18),[d,f,g,_]=this.#m();t.push(`L${(c[0]-e)/a} ${(c[1]-n)/o} L${d} ${f} L${g} ${_} L${(h[0]-e)/a} ${(h[1]-n)/o}`)}newFreeDrawOutline(t,e,n,a,o,c){return new Tv(t,e,n,a,o,c)}getOutlines(){const t=this.#a,e=this.#e,n=this.#s,[a,o,c,h]=this.#t,d=new Float32Array((this.#f?.length??0)+2);for(let _=0,y=d.length-2;_<y;_+=2)d[_]=(this.#f[_]-a)/c,d[_+1]=(this.#f[_+1]-o)/h;if(d[d.length-2]=(this.#r-a)/c,d[d.length-1]=(this.#o-o)/h,isNaN(n[6])&&!this.isEmpty())return this.#S(d);const f=new Float32Array(this.#a.length+24+this.#e.length);let g=t.length;for(let _=0;_<g;_+=2){if(isNaN(t[_])){f[_]=f[_+1]=NaN;continue}f[_]=t[_],f[_+1]=t[_+1]}g=this.#E(f,g);for(let _=e.length-6;_>=6;_-=6)for(let y=0;y<6;y+=2){if(isNaN(e[_+y])){f[g]=f[g+1]=NaN,g+=2;continue}f[g]=e[_+y],f[g+1]=e[_+y+1],g+=2}return this.#y(f,g),this.newFreeDrawOutline(f,d,this.#t,this.#d,this.#n,this.#i)}#S(t){const e=this.#s,[n,a,o,c]=this.#t,[h,d,f,g]=this.#m(),_=new Float32Array(36);return _.set([NaN,NaN,NaN,NaN,(e[2]-n)/o,(e[3]-a)/c,NaN,NaN,NaN,NaN,(e[4]-n)/o,(e[5]-a)/c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,f,g,NaN,NaN,NaN,NaN,(e[16]-n)/o,(e[17]-a)/c,NaN,NaN,NaN,NaN,(e[14]-n)/o,(e[15]-a)/c],0),this.newFreeDrawOutline(_,t,this.#t,this.#d,this.#n,this.#i)}#y(t,e){const n=this.#e;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6}#E(t,e){const n=this.#s.subarray(4,6),a=this.#s.subarray(16,18),[o,c,h,d]=this.#t,[f,g,_,y]=this.#m();return t.set([NaN,NaN,NaN,NaN,(n[0]-o)/h,(n[1]-c)/d,NaN,NaN,NaN,NaN,f,g,NaN,NaN,NaN,NaN,_,y,NaN,NaN,NaN,NaN,(a[0]-o)/h,(a[1]-c)/d],e),e+=24}}class Tv extends J{#t;#e=new Float32Array(4);#n;#i;#a;#s;#r;constructor(t,e,n,a,o,c){super(),this.#r=t,this.#a=e,this.#t=n,this.#s=a,this.#n=o,this.#i=c,this.lastPoint=[NaN,NaN],this.#o(c);const[h,d,f,g]=this.#e;for(let _=0,y=t.length;_<y;_+=2)t[_]=(t[_]-h)/f,t[_+1]=(t[_+1]-d)/g;for(let _=0,y=e.length;_<y;_+=2)e[_]=(e[_]-h)/f,e[_+1]=(e[_+1]-d)/g}toSVGPath(){const t=[`M${this.#r[4]} ${this.#r[5]}`];for(let e=6,n=this.#r.length;e<n;e+=6){if(isNaN(this.#r[e])){t.push(`L${this.#r[e+4]} ${this.#r[e+5]}`);continue}t.push(`C${this.#r[e]} ${this.#r[e+1]} ${this.#r[e+2]} ${this.#r[e+3]} ${this.#r[e+4]} ${this.#r[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,n,a],o){const c=n-t,h=a-e;let d,f;switch(o){case 0:d=J._rescale(this.#r,t,a,c,-h),f=J._rescale(this.#a,t,a,c,-h);break;case 90:d=J._rescaleAndSwap(this.#r,t,e,c,h),f=J._rescaleAndSwap(this.#a,t,e,c,h);break;case 180:d=J._rescale(this.#r,n,e,-c,h),f=J._rescale(this.#a,n,e,-c,h);break;case 270:d=J._rescaleAndSwap(this.#r,n,a,-c,-h),f=J._rescaleAndSwap(this.#a,n,a,-c,-h);break}return{outline:Array.from(d),points:[Array.from(f)]}}#o(t){const e=this.#r;let n=e[4],a=e[5];const o=[n,a,n,a];let c=n,h=a;const d=t?Math.max:Math.min;for(let g=6,_=e.length;g<_;g+=6){const y=e[g+4],b=e[g+5];if(isNaN(e[g]))nt.pointBoundingBox(y,b,o),h<b?(c=y,h=b):h===b&&(c=d(c,y));else{const A=[1/0,1/0,-1/0,-1/0];nt.bezierBoundingBox(n,a,...e.slice(g,g+6),A),nt.rectBoundingBox(...A,o),h<A[3]?(c=A[2],h=A[3]):h===A[3]&&(c=d(c,A[2]))}n=y,a=b}const f=this.#e;f[0]=o[0]-this.#n,f[1]=o[1]-this.#n,f[2]=o[2]-o[0]+2*this.#n,f[3]=o[3]-o[1]+2*this.#n,this.lastPoint=[c,h]}get box(){return this.#e}newOutliner(t,e,n,a,o,c=0){return new bs(t,e,n,a,o,c)}getNewOutline(t,e){const[n,a,o,c]=this.#e,[h,d,f,g]=this.#t,_=o*f,y=c*g,b=n*f+h,A=a*g+d,S=this.newOutliner({x:this.#a[0]*_+b,y:this.#a[1]*y+A},this.#t,this.#s,t,this.#i,e??this.#n);for(let C=2;C<this.#a.length;C+=2)S.add({x:this.#a[C]*_+b,y:this.#a[C+1]*y+A});return S.getOutlines()}}class Kd{#t;#e;#n=[];#i=[];constructor(t,e=0,n=0,a=!0){const o=[1/0,1/0,-1/0,-1/0],c=10**-4;for(const{x:b,y:A,width:S,height:C}of t){const w=Math.floor((b-e)/c)*c,M=Math.ceil((b+S+e)/c)*c,T=Math.floor((A-e)/c)*c,N=Math.ceil((A+C+e)/c)*c,R=[w,T,N,!0],k=[M,T,N,!1];this.#n.push(R,k),nt.rectBoundingBox(w,T,M,N,o)}const h=o[2]-o[0]+2*n,d=o[3]-o[1]+2*n,f=o[0]-n,g=o[1]-n,_=this.#n.at(a?-1:-2),y=[_[0],_[2]];for(const b of this.#n){const[A,S,C]=b;b[0]=(A-f)/h,b[1]=(S-g)/d,b[2]=(C-g)/d}this.#t=new Float32Array([f,g,h,d]),this.#e=y}getOutlines(){this.#n.sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);const t=[];for(const e of this.#n)e[3]?(t.push(...this.#l(e)),this.#r(e)):(this.#o(e),t.push(...this.#l(e)));return this.#a(t)}#a(t){const e=[],n=new Set;for(const c of t){const[h,d,f]=c;e.push([h,d,c],[h,f,c])}e.sort((c,h)=>c[1]-h[1]||c[0]-h[0]);for(let c=0,h=e.length;c<h;c+=2){const d=e[c][2],f=e[c+1][2];d.push(f),f.push(d),n.add(d),n.add(f)}const a=[];let o;for(;n.size>0;){const c=n.values().next().value;let[h,d,f,g,_]=c;n.delete(c);let y=h,b=d;for(o=[h,f],a.push(o);;){let A;if(n.has(g))A=g;else if(n.has(_))A=_;else break;n.delete(A),[h,d,f,g,_]=A,y!==h&&(o.push(y,b,h,b===d?d:f),y=h),b=b===d?f:d}o.push(y,b)}return new xw(a,this.#t,this.#e)}#s(t){const e=this.#i;let n=0,a=e.length-1;for(;n<=a;){const o=n+a>>1,c=e[o][0];if(c===t)return o;c<t?n=o+1:a=o-1}return a+1}#r([,t,e]){const n=this.#s(t);this.#i.splice(n,0,[t,e])}#o([,t,e]){const n=this.#s(t);for(let a=n;a<this.#i.length;a++){const[o,c]=this.#i[a];if(o!==t)break;if(o===t&&c===e){this.#i.splice(a,1);return}}for(let a=n-1;a>=0;a--){const[o,c]=this.#i[a];if(o!==t)break;if(o===t&&c===e){this.#i.splice(a,1);return}}}#l(t){const[e,n,a]=t,o=[[e,n,a]],c=this.#s(a);for(let h=0;h<c;h++){const[d,f]=this.#i[h];for(let g=0,_=o.length;g<_;g++){const[,y,b]=o[g];if(!(f<=y||b<=d)){if(y>=d){if(b>f)o[g][1]=f;else{if(_===1)return[];o.splice(g,1),g--,_--}continue}o[g][2]=d,b>f&&o.push([e,f,b])}}}return o}}class xw extends J{#t;#e;constructor(t,e,n){super(),this.#e=t,this.#t=e,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#e){let[n,a]=e;t.push(`M${n} ${a}`);for(let o=2;o<e.length;o+=2){const c=e[o],h=e[o+1];c===n?(t.push(`V${h}`),a=h):h===a&&(t.push(`H${c}`),n=c)}t.push("Z")}return t.join(" ")}serialize([t,e,n,a],o){const c=[],h=n-t,d=a-e;for(const f of this.#e){const g=new Array(f.length);for(let _=0;_<f.length;_+=2)g[_]=t+f[_]*h,g[_+1]=a-f[_+1]*d;c.push(g)}return c}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class Qd extends bs{newFreeDrawOutline(t,e,n,a,o,c){return new Rw(t,e,n,a,o,c)}}class Rw extends Tv{newOutliner(t,e,n,a,o,c=0){return new Qd(t,e,n,a,o,c)}}class ae extends rt{#t=null;#e=0;#n;#i=null;#a=null;#s=null;#r=null;#o=0;#l=null;#c=null;#d=null;#u=!1;#f=null;#g;#p=null;#h="";#m;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=ft.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=ae.prototype;return Et(this,"_keyboardManager",new Mo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||ae._defaultColor,this.#m=t.thickness||ae._defaultThickness,this.#g=t.opacity||ae._defaultOpacity,this.#n=t.boxes||null,this.#b=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#u=!0,this.#A(t),this.#T()):this.#n&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#r=t.focusNode,this.#o=t.focusOffset,this.#_(),this.#T(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#m,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#_(){const t=new Kd(this.#n,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const e=new Kd(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#s=e.getOutlines();const{lastPoint:n}=this.#s;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#A({highlightOutlines:t,highlightId:e,clipPathId:n}){this.#c=t;const a=1.5;if(this.#s=t.getNewOutline(this.#m/2+a,.0025),e>=0)this.#d=e,this.#i=n,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:ae.#w(this.#c.box,(g-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:ae.#w(this.#s.box,g),path:{d:this.#s.toSVGPath()}})}const[o,c,h,d]=t.box;switch(this.rotation){case 0:this.x=o,this.y=c,this.width=h,this.height=d;break;case 90:{const[g,_]=this.parentDimensions;this.x=c,this.y=1-o,this.width=h*_/g,this.height=d*g/_;break}case 180:this.x=1-o,this.y=1-c,this.width=h,this.height=d;break;case 270:{const[g,_]=this.parentDimensions;this.x=1-c,this.y=o,this.width=h*_/g,this.height=d*g/_;break}}const{lastPoint:f}=this.#s;this.#f=[(f[0]-o)/h,(f[1]-c)/d]}static initialize(t,e){rt.initialize(t,e),ae._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case Nt.HIGHLIGHT_COLOR:ae._defaultColor=e;break;case Nt.HIGHLIGHT_THICKNESS:ae._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#f}updateParams(t,e){switch(t){case Nt.HIGHLIGHT_COLOR:this.#S(e);break;case Nt.HIGHLIGHT_THICKNESS:this.#y(e);break}}static get defaultPropertiesToUpdate(){return[[Nt.HIGHLIGHT_COLOR,ae._defaultColor],[Nt.HIGHLIGHT_THICKNESS,ae._defaultThickness]]}get propertiesToUpdate(){return[[Nt.HIGHLIGHT_COLOR,this.color||ae._defaultColor],[Nt.HIGHLIGHT_THICKNESS,this.#m||ae._defaultThickness],[Nt.HIGHLIGHT_FREE,this.#u]]}#S(t){const e=(o,c)=>{this.color=o,this.#g=c,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:o,"fill-opacity":c}}),this.#a?.updateColor(o)},n=this.color,a=this.#g;this.addCommands({cmd:e.bind(this,t,ae._defaultOpacity),undo:e.bind(this,n,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#y(t){const e=this.#m,n=a=>{this.#m=a,this.#E(a)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new Sn({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#D())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#D())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#R(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#T(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#R():t&&(this.#T(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#E(t){if(!this.#u)return;this.#A({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}#R(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#T(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#i}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#g},rootClass:{highlight:!0,free:this.#u},path:{d:this.#c.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#u),this.#l&&(this.#l.style.clipPath=this.#i))}static#w([t,e,n,a],o){switch(o){case 90:return[1-e-a,t,a,n];case 180:return[1-t-n,1-e-a,n,a];case 270:return[e,1-t-n,a,n]}return[t,e,n,a]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#u?(t=(t-this.rotation+360)%360,n=ae.#w(this.#c.box,t)):n=ae.#w([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:ae.#w(this.#s.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#u?t.classList.add("free"):this.div.addEventListener("keydown",this.#O.bind(this),{signal:this._uiManager._signal});const e=this.#l=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#i;const[n,a]=this.parentDimensions;return this.setDims(this.width*n,this.height*a),ev(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#O(t){ae._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#x(!0);break;case 1:case 3:this.#x(!1);break}}#x(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#r,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#u||this.#x(!1))}get _mustFixPosition(){return!this.#u}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#D(){return this.#u?this.rotation:0}#I(){if(this.#u)return null;const[t,e]=this.pageDimensions,[n,a]=this.pageTranslation,o=this.#n,c=new Float32Array(o.length*8);let h=0;for(const{x:d,y:f,width:g,height:_}of o){const y=d*t+n,b=(1-f)*e+a;c[h]=c[h+4]=y,c[h+1]=c[h+3]=b,c[h+2]=c[h+6]=y+g*t,c[h+5]=c[h+7]=b-_*e,h+=8}return c}#k(t){return this.#c.serialize(t,this.#D())}static startHighlighting(t,e,{target:n,x:a,y:o}){const{x:c,y:h,width:d,height:f}=n.getBoundingClientRect(),g=new AbortController,_=t.combinedSignal(g),y=b=>{g.abort(),this.#P(t,b)};window.addEventListener("blur",y,{signal:_}),window.addEventListener("pointerup",y,{signal:_}),window.addEventListener("pointerdown",he,{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",wn,{signal:_}),n.addEventListener("pointermove",this.#L.bind(this,t),{signal:_}),this._freeHighlight=new Qd({x:a,y:o},[c,h,d,f],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#L(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#P(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let a=null;if(t instanceof wv){const{data:{quadPoints:A,rect:S,rotation:C,id:w,color:M,opacity:T,popupRef:N,contentsObj:R},parent:{page:{pageNumber:k}}}=t;a=t={annotationType:ft.HIGHLIGHT,color:Array.from(M),opacity:T,quadPoints:A,boxes:null,pageIndex:k-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,popupRef:N,comment:R?.str||null}}else if(t instanceof Pf){const{data:{inkLists:A,rect:S,rotation:C,id:w,color:M,borderStyle:{rawWidth:T},popupRef:N,contentsObj:R},parent:{page:{pageNumber:k}}}=t;a=t={annotationType:ft.HIGHLIGHT,color:Array.from(M),thickness:T,inkLists:A,boxes:null,pageIndex:k-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,popupRef:N,comment:R?.str||null}}const{color:o,quadPoints:c,inkLists:h,opacity:d}=t,f=await super.deserialize(t,e,n);f.color=nt.makeHexColor(...o),f.#g=d||1,h&&(f.#m=t.thickness),f._initialData=a,t.comment&&f.setCommentData(t.comment);const[g,_]=f.pageDimensions,[y,b]=f.pageTranslation;if(c){const A=f.#n=[];for(let S=0;S<c.length;S+=8)A.push({x:(c[S]-y)/g,y:1-(c[S+1]-b)/_,width:(c[S+2]-c[S])/g,height:(c[S+1]-c[S+5])/_});f.#_(),f.#T(),f.rotate(f.rotation)}else if(h){f.#u=!0;const A=h[0],S={x:A[0]-y,y:_-(A[1]-b)},C=new Qd(S,[0,0,g,_],1,f.#m/2,!0,.001);for(let T=0,N=A.length;T<N;T+=2)S.x=A[T]-y,S.y=_-(A[T+1]-b),C.add(S);const{id:w,clipPathId:M}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);f.#A({highlightOutlines:C.getOutlines(),highlightId:w,clipPathId:M}),f.#T(),f.rotate(f.parentRotation)}return f}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),n=rt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),a={annotationType:ft.HIGHLIGHT,color:n,opacity:this.#g,thickness:this.#m,quadPoints:this.#I(),outlines:this.#k(e),pageIndex:this.pageIndex,rect:e,rotation:this.#D(),structTreeParentId:this._structTreeParentId};return this.addComment(a),this.annotationElementId&&!this.#N(a)?null:(a.id=this.annotationElementId,a)}#N(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((n,a)=>n!==e[a])}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}static canCreateNewEmptyEditor(){return!1}}class xv{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Gt("Not implemented")}}class ut extends rt{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#a=null;static#s=NaN;static#r=null;static#o=null;static#l=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(this.#c(t),this.#f())}#c({drawOutlines:t,drawId:e,drawingOptions:n}){this.#t=t,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#d(t,this.parent),this.#h(t.box)}#d(t,e){const{id:n}=e.drawLayer.draw(ut._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[a,o]of Object.entries(e))n.has(a)?Object.assign(t[a],o):t[a]=o;return t}static getDefaultDrawingOptions(t){Gt("Not implemented")}static get typesMap(){Gt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(ut.#n.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,a]of this.typesMap)t.push([n,e[a]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,a]of this.constructor.typesMap)t.push([n,e[a]]);return t}_updateProperty(t,e,n){const a=this._drawingOptions,o=a[e],c=h=>{a.updateProperty(e,h);const d=this.#t.updateProperty(e,h);d&&this.#h(d),this.parent?.drawLayer.updateProperties(this._drawId,a.toSVGProperties()),t===this.colorType&&this._colorPicker?.update(h)};this.addCommands({cmd:c.bind(this,n),undo:c.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ut._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ut._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#m()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ut._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#u(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#u()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#u(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#t,t)}}#g([t,e,n,a]){const{parentDimensions:[o,c],rotation:h}=this;switch(h){case 90:return[e,1-t,n*(c/o),a*(o/c)];case 180:return[1-t,1-e,n,a];case 270:return[1-e,t,n*(c/o),a*(o/c)];default:return[t,e,n,a]}}#p(){const{x:t,y:e,width:n,height:a,parentDimensions:[o,c],rotation:h}=this;switch(h){case 90:return[1-e,t,n*(o/c),a*(c/o)];case 180:return[1-t,1-e,n,a];case 270:return[e,1-t,n*(o/c),a*(c/o)];default:return[t,e,n,a]}}#h(t){if([this.x,this.y,this.width,this.height]=this.#g(t),this.div){this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}this._onResized()}#m(){const{x:t,y:e,width:n,height:a,rotation:o,parentRotation:c,parentDimensions:[h,d]}=this;switch((o*4+c)/90){case 1:return[1-e-a,t,a,n];case 2:return[1-t-n,1-e-a,n,a];case 3:return[e,1-t-n,a,n];case 4:return[t,e-n*(h/d),a*(d/h),n*(h/d)];case 5:return[1-e,t,n*(h/d),a*(d/h)];case 6:return[1-t-a*(d/h),1-e,a*(d/h),n*(h/d)];case 7:return[e-n*(h/d),1-t-a*(d/h),n*(h/d),a*(d/h)];case 8:return[t-n,e-a,n,a];case 9:return[1-e,t-n,a,n];case 10:return[1-t,1-e,n,a];case 11:return[e-a,1-t,a,n];case 12:return[t-a*(d/h),e,a*(d/h),n*(h/d)];case 13:return[1-e-n*(h/d),t-a*(d/h),n*(h/d),a*(d/h)];case 14:return[1-t,1-e-n*(h/d),a*(d/h),n*(h/d)];case 15:return[e,1-t,n*(h/d),a*(d/h)];default:return[t,e,n,a]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ut._mergeSVGProperties({bbox:this.#m()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const a=document.createElement("div");n.append(a),a.setAttribute("aria-hidden","true"),a.className="internal";const[o,c]=this.parentDimensions;return this.setDims(this.width*o,this.height*c),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,a,o){Gt("Not implemented")}static startDrawing(t,e,n,a){const{target:o,offsetX:c,offsetY:h,pointerId:d,pointerType:f}=a;if(ut.#r&&ut.#r!==f)return;const{viewport:{rotation:g}}=t,{width:_,height:y}=o.getBoundingClientRect(),b=ut.#i=new AbortController,A=t.combinedSignal(b);if(ut.#s||=d,ut.#r??=f,window.addEventListener("pointerup",S=>{ut.#s===S.pointerId?this._endDraw(S):ut.#o?.delete(S.pointerId)},{signal:A}),window.addEventListener("pointercancel",S=>{ut.#s===S.pointerId?this._currentParent.endDrawingSession():ut.#o?.delete(S.pointerId)},{signal:A}),window.addEventListener("pointerdown",S=>{ut.#r===S.pointerType&&((ut.#o||=new Set).add(S.pointerId),ut.#n.isCancellable()&&(ut.#n.removeLastElement(),ut.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:A}),window.addEventListener("contextmenu",wn,{signal:A}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:A}),o.addEventListener("touchmove",S=>{S.timeStamp===ut.#l&&he(S)},{signal:A}),t.toggleDrawing(),e._editorUndoBar?.hide(),ut.#n){t.drawLayer.updateProperties(this._currentDrawId,ut.#n.startNew(c,h,_,y,g));return}e.updateUIForDefaultProperties(this),ut.#n=this.createDrawerInstance(c,h,_,y,g),ut.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(ut.#a.toSVGProperties(),ut.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(ut.#l=-1,!ut.#n)return;const{offsetX:e,offsetY:n,pointerId:a}=t;if(ut.#s===a){if(ut.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,ut.#n.add(e,n)),ut.#l=t.timeStamp,he(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,ut.#n=null,ut.#a=null,ut.#r=null,ut.#l=NaN),ut.#i&&(ut.#i.abort(),ut.#i=null,ut.#s=NaN,ut.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,ut.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const n=ut.#n,a=this._currentDrawId,o=n.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(a,n.setLastElement(o))},undo:()=>{e.drawLayer.updateProperties(a,n.removeLastElement())},mustExec:!1,type:Nt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(Nt.DRAW_STEP),!ut.#n.isEmpty()){const{pageDimensions:[n,a],scale:o}=e,c=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:ut.#n.getOutlines(n*o,a*o,o,this._INNER_MARGIN),drawingOptions:ut.#a,mustBeCommitted:!t});return this._cleanup(!0),c}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,a,o,c){Gt("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:a,pageHeight:o,pageX:c,pageY:h}}=e.viewport,d=this.deserializeDraw(c,h,a,o,this._INNER_MARGIN,t),f=await super.deserialize(t,e,n);return f.createDrawingOptions(t),f.#c({drawOutlines:d}),f.#f(),f.onScaleChanging(),f.rotate(),f}serializeDraw(t){const[e,n]=this.pageTranslation,[a,o]=this.pageDimensions;return this.#t.serialize([e,n,a,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Dw{#t=new Float64Array(6);#e;#n;#i;#a;#s;#r="";#o=0;#l=new Oo;#c;#d;constructor(t,e,n,a,o,c){this.#c=n,this.#d=a,this.#i=o,this.#a=c,[t,e]=this.#u(t,e);const h=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e],this.#n=[{line:h,points:this.#s}],this.#t.set(h,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#u(t,e){return J._normalizePoint(t,e,this.#c,this.#d,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#s.length<=10}add(t,e){[t,e]=this.#u(t,e);const[n,a,o,c]=this.#t.subarray(2,6),h=t-o,d=e-c;return Math.hypot(this.#c*h,this.#d*d)<=2?null:(this.#s.push(t,e),isNaN(n)?(this.#t.set([o,c,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([n,a,o,c,t,e],0),this.#e.push(...J.createBezierPoints(n,a,o,c,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,a,o){this.#c=n,this.#d=a,this.#i=o,[t,e]=this.#u(t,e);const c=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e];const h=this.#n.at(-1);return h&&(h.line=new Float32Array(h.line),h.points=new Float32Array(h.points)),this.#n.push({line:c,points:this.#s}),this.#t.set(c,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(t){return this.#n?(this.#n.push(t),this.#e=t.line,this.#s=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(t)}removeLastElement(){if(!this.#n)return this.#l.removeLastElement();this.#n.pop(),this.#r="";for(let t=0,e=this.#n.length;t<e;t++){const{line:n,points:a}=this.#n[t];this.#e=n,this.#s=a,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const t=J.svgRound(this.#e[4]),e=J.svgRound(this.#e[5]);if(this.#s.length===2)return this.#r=`${this.#r} M ${t} ${e} Z`,this.#r;if(this.#s.length<=6){const a=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,a)} M ${t} ${e}`,this.#o=6}if(this.#s.length===4){const a=J.svgRound(this.#e[10]),o=J.svgRound(this.#e[11]);return this.#r=`${this.#r} L ${a} ${o}`,this.#o=12,this.#r}const n=[];this.#o===0&&(n.push(`M ${t} ${e}`),this.#o=6);for(let a=this.#o,o=this.#e.length;a<o;a+=6){const[c,h,d,f,g,_]=this.#e.slice(a,a+6).map(J.svgRound);n.push(`C${c} ${h} ${d} ${f} ${g} ${_}`)}return this.#r+=n.join(" "),this.#o=this.#e.length,this.#r}getOutlines(t,e,n,a){const o=this.#n.at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),this.#l.build(this.#n,t,e,n,this.#i,this.#a,a),this.#t=null,this.#e=null,this.#n=null,this.#r=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Oo extends J{#t;#e=0;#n;#i;#a;#s;#r;#o;#l;build(t,e,n,a,o,c,h){this.#a=e,this.#s=n,this.#r=a,this.#o=o,this.#l=c,this.#n=h??0,this.#i=t,this.#u()}get thickness(){return this.#l}setLastElement(t){return this.#i.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#i){if(t.push(`M${J.svgRound(e[4])} ${J.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${J.svgRound(e[10])} ${J.svgRound(e[11])}`);continue}for(let n=6,a=e.length;n<a;n+=6){const[o,c,h,d,f,g]=e.subarray(n,n+6).map(J.svgRound);t.push(`C${o} ${c} ${h} ${d} ${f} ${g}`)}}return t.join("")}serialize([t,e,n,a],o){const c=[],h=[],[d,f,g,_]=this.#d();let y,b,A,S,C,w,M,T,N;switch(this.#o){case 0:N=J._rescale,y=t,b=e+a,A=n,S=-a,C=t+d*n,w=e+(1-f-_)*a,M=t+(d+g)*n,T=e+(1-f)*a;break;case 90:N=J._rescaleAndSwap,y=t,b=e,A=n,S=a,C=t+f*n,w=e+d*a,M=t+(f+_)*n,T=e+(d+g)*a;break;case 180:N=J._rescale,y=t+n,b=e,A=-n,S=a,C=t+(1-d-g)*n,w=e+f*a,M=t+(1-d)*n,T=e+(f+_)*a;break;case 270:N=J._rescaleAndSwap,y=t+n,b=e+a,A=-n,S=-a,C=t+(1-f-_)*n,w=e+(1-d-g)*a,M=t+(1-f)*n,T=e+(1-d)*a;break}for(const{line:R,points:k}of this.#i)c.push(N(R,y,b,A,S,o?new Array(R.length):null)),h.push(N(k,y,b,A,S,o?new Array(k.length):null));return{lines:c,points:h,rect:[C,w,M,T]}}static deserialize(t,e,n,a,o,{paths:{lines:c,points:h},rotation:d,thickness:f}){const g=[];let _,y,b,A,S;switch(d){case 0:S=J._rescale,_=-t/n,y=e/a+1,b=1/n,A=-1/a;break;case 90:S=J._rescaleAndSwap,_=-e/a,y=-t/n,b=1/a,A=1/n;break;case 180:S=J._rescale,_=t/n+1,y=-e/a,b=-1/n,A=1/a;break;case 270:S=J._rescaleAndSwap,_=e/a+1,y=t/n+1,b=-1/a,A=-1/n;break}if(!c){c=[];for(const w of h){const M=w.length;if(M===2){c.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(M===4){c.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const T=new Float32Array(3*(M-2));c.push(T);let[N,R,k,z]=w.subarray(0,4);T.set([NaN,NaN,NaN,NaN,N,R],0);for(let j=4;j<M;j+=2){const $=w[j],tt=w[j+1];T.set(J.createBezierPoints(N,R,k,z,$,tt),(j-2)*3),[N,R,k,z]=[k,z,$,tt]}}}for(let w=0,M=c.length;w<M;w++)g.push({line:S(c[w].map(T=>T??NaN),_,y,b,A),points:S(h[w].map(T=>T??NaN),_,y,b,A)});const C=new this.prototype.constructor;return C.build(g,n,a,1,d,f,o),C}#c(t=this.#l){const e=this.#n+t/2*this.#r;return this.#o%180===0?[e/this.#a,e/this.#s]:[e/this.#s,e/this.#a]}#d(){const[t,e,n,a]=this.#t,[o,c]=this.#c(0);return[t+o,e+c,n-2*o,a-2*c]}#u(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:a}of this.#i){if(a.length<=12){for(let h=4,d=a.length;h<d;h+=6)nt.pointBoundingBox(a[h],a[h+1],t);continue}let o=a[4],c=a[5];for(let h=6,d=a.length;h<d;h+=6){const[f,g,_,y,b,A]=a.subarray(h,h+6);nt.bezierBoundingBox(o,c,f,g,_,y,b,A,t),o=b,c=A}}const[e,n]=this.#c();t[0]=He(t[0]-e,0,1),t[1]=He(t[1]-n,0,1),t[2]=He(t[2]+e,0,1),t[3]=He(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,n]=this.#c();this.#l=t;const[a,o]=this.#c(),[c,h]=[a-e,o-n],d=this.#t;return d[0]-=c,d[1]-=h,d[2]+=2*c,d[3]+=2*h,d}updateParentDimensions([t,e],n){const[a,o]=this.#c();this.#a=t,this.#s=e,this.#r=n;const[c,h]=this.#c(),d=c-a,f=h-o,g=this.#t;return g[0]-=d,g[1]-=f,g[2]+=2*d,g[3]+=2*f,g}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(J.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${J.svgRound(t)} ${J.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let n=0,a=0,o=0,c=0,h=0,d=0;switch(this.#e){case 90:a=e/t,o=-t/e,h=t;break;case 180:n=-1,c=-1,h=t,d=e;break;case 270:a=-e/t,o=t/e,d=e;break;default:return""}return`matrix(${n} ${a} ${o} ${c} ${J.svgRound(h)} ${J.svgRound(d)})`}getPathResizingSVGProperties([t,e,n,a]){const[o,c]=this.#c(),[h,d,f,g]=this.#t;if(Math.abs(f-o)<=J.PRECISION||Math.abs(g-c)<=J.PRECISION){const S=t+n/2-(h+f/2),C=e+a/2-(d+g/2);return{path:{"transform-origin":`${J.svgRound(t)} ${J.svgRound(e)}`,transform:`${this.rotationTransform} translate(${S} ${C})`}}}const _=(n-2*o)/(f-2*o),y=(a-2*c)/(g-2*c),b=f/n,A=g/a;return{path:{"transform-origin":`${J.svgRound(h)} ${J.svgRound(d)}`,transform:`${this.rotationTransform} scale(${b} ${A}) translate(${J.svgRound(o)} ${J.svgRound(c)}) scale(${_} ${y}) translate(${J.svgRound(-o)} ${J.svgRound(-c)})`}}}getPathResizedSVGProperties([t,e,n,a]){const[o,c]=this.#c(),h=this.#t,[d,f,g,_]=h;if(h[0]=t,h[1]=e,h[2]=n,h[3]=a,Math.abs(g-o)<=J.PRECISION||Math.abs(_-c)<=J.PRECISION){const C=t+n/2-(d+g/2),w=e+a/2-(f+_/2);for(const{line:M,points:T}of this.#i)J._translate(M,C,w,M),J._translate(T,C,w,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${J.svgRound(t)} ${J.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const y=(n-2*o)/(g-2*o),b=(a-2*c)/(_-2*c),A=-y*(d+o)+t+o,S=-b*(f+c)+e+c;if(y!==1||b!==1||A!==0||S!==0)for(const{line:C,points:w}of this.#i)J._rescale(C,A,S,y,b,C),J._rescale(w,A,S,y,b,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${J.svgRound(t)} ${J.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],n){const[a,o]=n,c=this.#t,h=t-c[0],d=e-c[1];if(this.#a===a&&this.#s===o)for(const{line:f,points:g}of this.#i)J._translate(f,h,d,f),J._translate(g,h,d,g);else{const f=this.#a/a,g=this.#s/o;this.#a=a,this.#s=o;for(const{line:_,points:y}of this.#i)J._rescale(_,h,d,f,g,_),J._rescale(y,h,d,f,g,y);c[2]*=f,c[3]*=g}return c[0]=t,c[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${J.svgRound(t)} ${J.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${J.svgRound(t[0])} ${J.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class qc extends xv{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:rt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new qc(this._viewParameters);return t.updateAll(this),t}}class Ff extends ut{static _type="ink";static _editorType=ft.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){rt.initialize(t,e),this._defaultDrawingOptions=new qc(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return Et(this,"typesMap",new Map([[Nt.INK_THICKNESS,"stroke-width"],[Nt.INK_COLOR,"stroke"],[Nt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,a,o){return new Dw(t,e,n,a,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,a,o,c){return Oo.deserialize(t,e,n,a,o,c)}static async deserialize(t,e,n){let a=null;if(t instanceof Pf){const{data:{inkLists:c,rect:h,rotation:d,id:f,color:g,opacity:_,borderStyle:{rawWidth:y},popupRef:b,contentsObj:A},parent:{page:{pageNumber:S}}}=t;a=t={annotationType:ft.INK,color:Array.from(g),thickness:y,opacity:_,paths:{points:c},boxes:null,pageIndex:S-1,rect:h.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:b,comment:A?.str||null}}const o=await super.deserialize(t,e,n);return o._initialData=a,t.comment&&o.setCommentData(t.comment),o}get toolbarButtons(){return this._colorPicker||=new mo(this),[["colorPicker",this._colorPicker]]}get colorType(){return Nt.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:n}){this._drawingOptions=Ff.getDefaultDrawingOptions({stroke:nt.makeHexColor(...t),"stroke-width":e,"stroke-opacity":n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n,rect:a}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":c,"stroke-width":h}}=this,d={annotationType:ft.INK,color:rt._colorManager.convert(o),opacity:c,thickness:h,paths:{lines:e,points:n},pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(d),t?(d.isCopy=!0,d):this.annotationElementId&&!this.#t(d)?null:(d.id=this.annotationElementId,d)}#t(t){const{color:e,thickness:n,opacity:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((c,h)=>c!==e[h])||t.thickness!==n||t.opacity!==a||t.pageIndex!==o}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:n}=this.serializeDraw(!1),a={rect:n,thickness:this._drawingOptions["stroke-width"],points:e};return this.hasEditedComment&&(a.popup=this.comment),t.updateEdited(a),null}}class Zd extends Oo{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const rc=8,Qr=3;class Ta{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,n,a){return n-=t,a-=e,n===0?a>0?0:4:n===1?a+6:2-a}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(t,e,n,a,o,c,h){const d=this.#e(n,a,o,c);for(let f=0;f<8;f++){const g=(-f+d-h+16)%8,_=this.#n[2*g],y=this.#n[2*g+1];if(t[(n+_)*e+(a+y)]!==0)return g}return-1}static#a(t,e,n,a,o,c,h){const d=this.#e(n,a,o,c);for(let f=0;f<8;f++){const g=(f+d+h+16)%8,_=this.#n[2*g],y=this.#n[2*g+1];if(t[(n+_)*e+(a+y)]!==0)return g}return-1}static#s(t,e,n,a){const o=t.length,c=new Int32Array(o);for(let g=0;g<o;g++)c[g]=t[g]<=a?1:0;for(let g=1;g<n-1;g++)c[g*e]=c[g*e+e-1]=0;for(let g=0;g<e;g++)c[g]=c[e*n-1-g]=0;let h=1,d;const f=[];for(let g=1;g<n-1;g++){d=1;for(let _=1;_<e-1;_++){const y=g*e+_,b=c[y];if(b===0)continue;let A=g,S=_;if(b===1&&c[y-1]===0)h+=1,S-=1;else if(b>=1&&c[y+1]===0)h+=1,S+=1,b>1&&(d=b);else{b!==1&&(d=Math.abs(b));continue}const C=[_,g],w=S===_+1,M={isHole:w,points:C,id:h,parent:0};f.push(M);let T;for(const Q of f)if(Q.id===d){T=Q;break}T?T.isHole?M.parent=w?T.parent:d:M.parent=w?d:T.parent:M.parent=w?d:0;const N=this.#i(c,e,g,_,A,S,0);if(N===-1){c[y]=-h,c[y]!==1&&(d=Math.abs(c[y]));continue}let R=this.#n[2*N],k=this.#n[2*N+1];const z=g+R,j=_+k;A=z,S=j;let $=g,tt=_;for(;;){const Q=this.#a(c,e,$,tt,A,S,1);R=this.#n[2*Q],k=this.#n[2*Q+1];const lt=$+R,mt=tt+k;C.push(mt,lt);const Tt=$*e+tt;if(c[Tt+1]===0?c[Tt]=-h:c[Tt]===1&&(c[Tt]=h),lt===g&&mt===_&&$===z&&tt===j){c[y]!==1&&(d=Math.abs(c[y]));break}else A=$,S=tt,$=lt,tt=mt}}}return f}static#r(t,e,n,a){if(n-e<=4){for(let z=e;z<n-2;z+=2)a.push(t[z],t[z+1]);return}const o=t[e],c=t[e+1],h=t[n-4]-o,d=t[n-3]-c,f=Math.hypot(h,d),g=h/f,_=d/f,y=g*c-_*o,b=d/h,A=1/f,S=Math.atan(b),C=Math.cos(S),w=Math.sin(S),M=A*(Math.abs(C)+Math.abs(w)),T=A*(1-M+M**2),N=Math.max(Math.atan(Math.abs(w+C)*T),Math.atan(Math.abs(w-C)*T));let R=0,k=e;for(let z=e+2;z<n-2;z+=2){const j=Math.abs(y-g*t[z+1]+_*t[z]);j>R&&(k=z,R=j)}R>(f*N)**2?(this.#r(t,e,k+2,a),this.#r(t,k,n,a)):a.push(o,c)}static#o(t){const e=[],n=t.length;return this.#r(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#l(t,e,n,a,o,c){const h=new Float32Array(c**2),d=-2*a**2,f=c>>1;for(let S=0;S<c;S++){const C=(S-f)**2;for(let w=0;w<c;w++)h[S*c+w]=Math.exp((C+(w-f)**2)/d)}const g=new Float32Array(256),_=-2*o**2;for(let S=0;S<256;S++)g[S]=Math.exp(S**2/_);const y=t.length,b=new Uint8Array(y),A=new Uint32Array(256);for(let S=0;S<n;S++)for(let C=0;C<e;C++){const w=S*e+C,M=t[w];let T=0,N=0;for(let k=0;k<c;k++){const z=S+k-f;if(!(z<0||z>=n))for(let j=0;j<c;j++){const $=C+j-f;if($<0||$>=e)continue;const tt=t[z*e+$],Q=h[k*c+j]*g[Math.abs(tt-M)];T+=tt*Q,N+=Q}}const R=b[w]=Math.round(T/N);A[R]++}return[b,A]}static#c(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#d(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let a=-1/0,o=1/0;for(let h=0,d=n.length;h<d;h++){const f=n[h]=t[h<<2];a=Math.max(a,f),o=Math.min(o,f)}const c=255/(a-o);for(let h=0,d=n.length;h<d;h++)n[h]=(n[h]-o)*c;return n}static#u(t){let e,n=-1/0,a=-1/0;const o=t.findIndex(d=>d!==0);let c=o,h=o;for(e=o;e<256;e++){const d=t[e];d>n&&(e-c>a&&(a=e-c,h=e-1),n=d,c=e)}for(e=h-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:n,height:a}=t,{maxDim:o}=this.#t;let c=n,h=a;if(n>o||a>o){let y=n,b=a,A=Math.log2(Math.max(n,a)/o);const S=Math.floor(A);A=A===S?S-1:S;for(let w=0;w<A;w++){c=Math.ceil(y/2),h=Math.ceil(b/2);const M=new OffscreenCanvas(c,h);M.getContext("2d").drawImage(t,0,0,y,b,0,0,c,h),y=c,b=h,t!==e&&t.close(),t=M.transferToImageBitmap()}const C=Math.min(o/c,o/h);c=Math.round(c*C),h=Math.round(h*C)}const f=new OffscreenCanvas(c,h).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,c,h),f.filter="grayscale(1)",f.drawImage(t,0,0,t.width,t.height,0,0,c,h);const g=f.getImageData(0,0,c,h).data;return[this.#d(g),c,h]}static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:a},o,c,h,d){let f=new OffscreenCanvas(1,1),g=f.getContext("2d",{alpha:!1});const _=200,y=g.font=`${n} ${a} ${_}px ${e}`,{actualBoundingBoxLeft:b,actualBoundingBoxRight:A,actualBoundingBoxAscent:S,actualBoundingBoxDescent:C,fontBoundingBoxAscent:w,fontBoundingBoxDescent:M,width:T}=g.measureText(t),N=1.5,R=Math.ceil(Math.max(Math.abs(b)+Math.abs(A)||0,T)*N),k=Math.ceil(Math.max(Math.abs(S)+Math.abs(C)||_,Math.abs(w)+Math.abs(M)||_)*N);f=new OffscreenCanvas(R,k),g=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),g.font=y,g.filter="grayscale(1)",g.fillStyle="white",g.fillRect(0,0,R,k),g.fillStyle="black",g.fillText(t,R*(N-1)/2,k*(3-N)/2);const z=this.#d(g.getImageData(0,0,R,k).data),j=this.#c(z),$=this.#u(j),tt=this.#s(z,R,k,$);return this.processDrawnLines({lines:{curves:tt,width:R,height:k},pageWidth:o,pageHeight:c,rotation:h,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(t,e,n,a,o){const[c,h,d]=this.#f(t),[f,g]=this.#l(c,h,d,Math.hypot(h,d)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),_=this.#u(g),y=this.#s(f,h,d,_);return this.processDrawnLines({lines:{curves:y,width:h,height:d},pageWidth:e,pageHeight:n,rotation:a,innerMargin:o,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:a,innerMargin:o,mustSmooth:c,areContours:h}){a%180!==0&&([e,n]=[n,e]);const{curves:d,width:f,height:g}=t,_=t.thickness??0,y=[],b=Math.min(e/f,n/g),A=b/e,S=b/n,C=[];for(const{points:M}of d){const T=c?this.#o(M):M;if(!T)continue;C.push(T);const N=T.length,R=new Float32Array(N),k=new Float32Array(3*(N===2?2:N-2));if(y.push({line:k,points:R}),N===2){R[0]=T[0]*A,R[1]=T[1]*S,k.set([NaN,NaN,NaN,NaN,R[0],R[1]],0);continue}let[z,j,$,tt]=T;z*=A,j*=S,$*=A,tt*=S,R.set([z,j,$,tt],0),k.set([NaN,NaN,NaN,NaN,z,j],0);for(let Q=4;Q<N;Q+=2){const lt=R[Q]=T[Q]*A,mt=R[Q+1]=T[Q+1]*S;k.set(J.createBezierPoints(z,j,$,tt,lt,mt),(Q-2)*3),[z,j,$,tt]=[$,tt,lt,mt]}}if(y.length===0)return null;const w=h?new Zd:new Oo;return w.build(y,e,n,1,a,h?0:_,o),{outline:w,newCurves:C,areContours:h,thickness:_,width:f,height:g}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:a,height:o}){let c=1/0,h=-1/0,d=0;for(const T of t){d+=T.length;for(let N=2,R=T.length;N<R;N++){const k=T[N]-T[N-2];c=Math.min(c,k),h=Math.max(h,k)}}let f;c>=-128&&h<=127?f=Int8Array:c>=-32768&&h<=32767?f=Int16Array:f=Int32Array;const g=t.length,_=rc+Qr*g,y=new Uint32Array(_);let b=0;y[b++]=_*Uint32Array.BYTES_PER_ELEMENT+(d-2*g)*f.BYTES_PER_ELEMENT,y[b++]=0,y[b++]=a,y[b++]=o,y[b++]=e?0:1,y[b++]=Math.max(0,Math.floor(n??0)),y[b++]=g,y[b++]=f.BYTES_PER_ELEMENT;for(const T of t)y[b++]=T.length-2,y[b++]=T[0],y[b++]=T[1];const A=new CompressionStream("deflate-raw"),S=A.writable.getWriter();await S.ready,S.write(y);const C=f.prototype.constructor;for(const T of t){const N=new C(T.length-2);for(let R=2,k=T.length;R<k;R++)N[R-2]=T[R]-T[R-2];S.write(N)}S.close();const w=await new Response(A.readable).arrayBuffer(),M=new Uint8Array(w);return tv(M)}static async decompressSignature(t){try{const e=QE(t),{readable:n,writable:a}=new DecompressionStream("deflate-raw"),o=a.getWriter();await o.ready,o.write(e).then(async()=>{await o.ready,await o.close()}).catch(()=>{});let c=null,h=0;for await(const T of n)c||=new Uint8Array(new Uint32Array(T.buffer,0,4)[0]),c.set(T,h),h+=T.length;const d=new Uint32Array(c.buffer,0,c.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const g=d[2],_=d[3],y=d[4]===0,b=d[5],A=d[6],S=d[7],C=[],w=(rc+Qr*A)*Uint32Array.BYTES_PER_ELEMENT;let M;switch(S){case Int8Array.BYTES_PER_ELEMENT:M=new Int8Array(c.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:M=new Int16Array(c.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:M=new Int32Array(c.buffer,w);break}h=0;for(let T=0;T<A;T++){const N=d[Qr*T+rc],R=new Float32Array(N+2);C.push(R);for(let k=0;k<Qr-1;k++)R[k]=d[Qr*T+rc+k+1];for(let k=0;k<N;k++)R[k+2]=R[k]+M[h++]}return{areContours:y,thickness:b,outlines:C,width:g,height:_}}catch(e){return gt(`decompressSignature: ${e}`),null}}}class Hf extends xv{constructor(){super(),super.updateProperties({fill:rt._defaultLineColor,"stroke-width":0})}clone(){const t=new Hf;return t.updateAll(this),t}}class zf extends qc{constructor(t){super(t),super.updateProperties({stroke:rt._defaultLineColor,"stroke-width":1})}clone(){const t=new zf(this._viewParameters);return t.updateAll(this),t}}class Vn extends ut{#t=!1;#e=null;#n=null;#i=null;static _type="signature";static _editorType=ft.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){rt.initialize(t,e),this._defaultDrawingOptions=new Hf,this._defaultDrawnSignatureOptions=new zf(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return Et(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:a,mustSmooth:o,areContours:c,description:h,uuid:d,heightInPage:f}=this.#n,{rawDims:{pageWidth:g,pageHeight:_},rotation:y}=this.parent.viewport,b=Ta.processDrawnLines({lines:a,pageWidth:g,pageHeight:_,rotation:y,innerMargin:Vn._INNER_MARGIN,mustSmooth:o,areContours:c});this.addSignature(b,f,h,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#i=t,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:a,height:o}=this.#n,c=Math.max(a,o),h=Ta.processDrawnLines({lines:{curves:t.map(d=>({points:d})),thickness:n,width:a,height:o},pageWidth:c,pageHeight:c,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:h.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,a){const{x:o,y:c}=this,{outline:h}=this.#n=t;this.#t=h instanceof Zd,this.description=n;let d;this.#t?d=Vn.getDefaultDrawingOptions():(d=Vn._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":h.thickness})),this._addOutlines({drawOutlines:h,drawingOptions:d});const[f,g]=this.parentDimensions,[,_]=this.pageDimensions;let y=e/_;y=y>=1?.5:y,this.width*=y/this.height,this.width>=1&&(y*=.9/this.width,this.width=.9),this.height=y,this.setDims(f*this.width,g*this.height),this.x=o,this.y=c,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(a),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!a,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:a}=this.parent.viewport;return Ta.process(t,e,n,a,Vn._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:a},rotation:o}=this.parent.viewport;return Ta.extractContoursFromText(t,e,n,a,o,Vn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:a}=this.parent.viewport;return Ta.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:a,innerMargin:Vn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Vn.getDefaultDrawingOptions():(this._drawingOptions=Vn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:n,rect:a}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":o}}=this,c={annotationType:ft.SIGNATURE,isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:o,pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(c),t?(c.paths={lines:e,points:n},c.uuid=this.#i,c.isCopy=!0):c.lines=e,this.#e&&(c.accessibilityData={type:"Figure",alt:this.#e}),c}static deserializeDraw(t,e,n,a,o,c){return c.areContours?Zd.deserialize(t,e,n,a,o,c):Oo.deserialize(t,e,n,a,o,c)}static async deserialize(t,e,n){const a=await super.deserialize(t,e,n);return a.#t=t.areContours,a.description=t.accessibilityData?.alt||"",a.#i=t.uuid,a}}class Mw extends rt{#t=null;#e=null;#n=null;#i=null;#a=null;#s="";#r=null;#o=!1;#l=null;#c=!1;#d=!1;static _type="stamp";static _editorType=ft.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#i=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){rt.initialize(t,e)}static isHandlingMimeForPasting(t){return qd.includes(t)}static paste(t,e){e.pasteEditor({mode:ft.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#u(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#c=t.isSvg),t.file&&(this.#s=t.file.name),this.#p()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:a,width:o,height:c}=t||this.copyCanvas(null,null,!0).imageData,h=await n.guess({name:"altText",request:{data:a,width:o,height:c,channels:a.length/(o*c)}});if(!h)throw new Error("No response from the AI service.");if(h.error)throw new Error("Error from the AI service.");if(h.cancel)return null;if(!h.output)throw new Error("No valid response from the AI service.");const d=h.output;return await this.setGuessedAltText(d),e&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(n=>this.#u(n,!0)).finally(()=>this.#f());return}if(this.#i){const n=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(n).then(a=>this.#u(a)).finally(()=>this.#f());return}if(this.#a){const n=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(n).then(a=>this.#u(a)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=qd.join(",");const e=this._uiManager._signal;this.#n=new Promise(n=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const a=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(a)}n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#r?.remove(),this.#r=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#r===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#n||this.#t||this.#i||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#p():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:a}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#e=n,a&&(this.#t=a),this.#o=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const t=200;this.#l=setTimeout(()=>{this.#l=null,this.#m()},t)}#p(){const{div:t}=this;let{width:e,height:n}=this.#t;const[a,o]=this.pageDimensions,c=.75;if(this.width)e=this.width*a,n=this.height*o;else if(e>c*a||n>c*o){const g=Math.min(c*a/e,c*o/n);e*=g,n*=g}const[h,d]=this.parentDimensions;this.setDims(e*h/a,n*d/o),this._uiManager.enableWaiting(!1);const f=this.#r=document.createElement("canvas");f.setAttribute("role","img"),this.addContainer(f),this.width=e/a,this.height=n/o,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,n=!1){t||(t=224);const{width:a,height:o}=this.#t,c=new Yn;let h=this.#t,d=a,f=o,g=null;if(e){if(a>e||o>e){const k=Math.min(e/a,e/o);d=Math.floor(a*k),f=Math.floor(o*k)}g=document.createElement("canvas");const y=g.width=Math.ceil(d*c.sx),b=g.height=Math.ceil(f*c.sy);this.#c||(h=this.#h(y,b));const A=g.getContext("2d");A.filter=this._uiManager.hcmFilter;let S="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(S="#8f8f9d",C="#42414d");const w=15,M=w*c.sx,T=w*c.sy,N=new OffscreenCanvas(M*2,T*2),R=N.getContext("2d");R.fillStyle=S,R.fillRect(0,0,M*2,T*2),R.fillStyle=C,R.fillRect(0,0,M,T),R.fillRect(M,T,M,T),A.fillStyle=A.createPattern(N,"repeat"),A.fillRect(0,0,y,b),A.drawImage(h,0,0,h.width,h.height,0,0,y,b)}let _=null;if(n){let y,b;if(c.symmetric&&h.width<t&&h.height<t)y=h.width,b=h.height;else if(h=this.#t,a>t||o>t){const C=Math.min(t/a,t/o);y=Math.floor(a*C),b=Math.floor(o*C),this.#c||(h=this.#h(y,b))}const S=new OffscreenCanvas(y,b).getContext("2d",{willReadFrequently:!0});S.drawImage(h,0,0,h.width,h.height,0,0,y,b),_={width:y,height:b,data:S.getImageData(0,0,y,b).data}}return{canvas:g,width:d,height:f,imageData:_}}#h(t,e){const{width:n,height:a}=this.#t;let o=n,c=a,h=this.#t;for(;o>2*t||c>2*e;){const d=o,f=c;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),c>2*e&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2));const g=new OffscreenCanvas(o,c);g.getContext("2d").drawImage(h,0,0,d,f,0,0,o,c),h=g.transferToImageBitmap()}return h}#m(){const[t,e]=this.parentDimensions,{width:n,height:a}=this,o=new Yn,c=Math.ceil(n*t*o.sx),h=Math.ceil(a*e*o.sy),d=this.#r;if(!d||d.width===c&&d.height===h)return;d.width=c,d.height=h;const f=this.#c?this.#t:this.#h(c,h),g=d.getContext("2d");g.filter=this._uiManager.hcmFilter,g.drawImage(f,0,0,f.width,f.height,0,0,c,h)}#b(t){if(t){if(this.#c){const a=this._uiManager.imageManager.getSvgUrl(this.#e);if(a)return a}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#c){const[e,n]=this.pageDimensions,a=Math.round(this.width*e*Ba.PDF_TO_CSS_UNITS),o=Math.round(this.height*n*Ba.PDF_TO_CSS_UNITS),c=new OffscreenCanvas(a,o);return c.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,a,o),c.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,n){let a=null,o=!1;if(t instanceof Cv){const{data:{rect:S,rotation:C,id:w,structParent:M,popupRef:T,contentsObj:N},container:R,parent:{page:{pageNumber:k}},canvas:z}=t;let j,$;z?(delete t.canvas,{id:j,bitmap:$}=n.imageManager.getFromCanvas(R.id,z),z.remove()):(o=!0,t._hasNoCanvas=!0);const tt=(await e._structTree.getAriaAttributes(`${Cf}${w}`))?.get("aria-label")||"";a=t={annotationType:ft.STAMP,bitmapId:j,bitmap:$,pageIndex:k-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:tt},isSvg:!1,structParent:M,popupRef:T,comment:N?.str||null}}const c=await super.deserialize(t,e,n),{rect:h,bitmap:d,bitmapUrl:f,bitmapId:g,isSvg:_,accessibilityData:y}=t;o?(n.addMissingCanvas(t.id,c),c.#o=!0):g&&n.imageManager.isValidId(g)?(c.#e=g,d&&(c.#t=d)):c.#i=f,c.#c=_;const[b,A]=c.pageDimensions;return c.width=(h[2]-h[0])/b,c.height=(h[3]-h[1])/A,y&&(c.altTextData=y),c._initialData=a,t.comment&&c.setCommentData(t.comment),c.#d=!!a,c}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:ft.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(this.addComment(n),t)return n.bitmapUrl=this.#b(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:a,altText:o}=this.serializeAltText(!1);if(!a&&o&&(n.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const h=this.#_(n);if(h.isSame)return null;h.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,e===null)return n;e.stamps||=new Map;const c=this.#c?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:c,serialized:n}),n.bitmap=this.#b(!1);else if(this.#c){const h=e.stamps.get(this.#e);c>h.area&&(h.area=c,h.serialized.bitmap.close(),h.serialized.bitmap=this.#b(!1))}return n}#_(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,a=t.pageIndex===e,o=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&a&&o,isSameAltText:o}}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}}class ci{#t;#e=!1;#n=null;#i=null;#a=null;#s=new Map;#r=!1;#o=!1;#l=!1;#c=null;#d=null;#u=null;#f=null;#g=null;#p=-1;#h;static _initialized=!1;static#m=new Map([ve,Ff,Mw,ae,Vn].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:a,accessibilityManager:o,annotationLayer:c,drawLayer:h,textLayer:d,viewport:f,l10n:g}){const _=[...ci.#m.values()];if(!ci._initialized){ci._initialized=!0;for(const y of _)y.initialize(g,t)}t.registerEditorTypes(_),this.#h=t,this.pageIndex=e,this.div=n,this.#t=o,this.#n=c,this.viewport=f,this.#u=d,this.drawLayer=h,this._structTree=a,this.#h.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===ft.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#y(),t){case ft.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ft.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ft.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const n of ci.#m.values())e.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#u?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.div.classList.toggle("disabled",!t)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#g?.abort(),this.#g=null;const t=new Set;for(const n of this.#s.values())n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#h.removeChangedExistingAnnotation(n),t.add(n.annotationElementId));if(!this.#n){this.#l=!1;return}const e=this.#n.getEditableAnnotations();for(const n of e){if(n.hide(),this.#h.isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;const a=await this.deserialize(n);a&&(this.addOrRebuild(a),a.enableEditing())}this.#l=!1}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#u&&!this.#g){this.#g=new AbortController;const a=this.#h.combinedSignal(this.#g);this.#u.div.addEventListener("pointerdown",o=>{const{clientX:h,clientY:d,timeStamp:f}=o,g=this.#p;if(f-g>500){this.#p=f;return}this.#p=-1;const{classList:_}=this.div;_.toggle("getElements",!0);const y=document.elementsFromPoint(h,d);if(_.toggle("getElements",!1),!this.div.contains(y[0]))return;let b;const A=new RegExp(`^${Wb}[0-9]+$`);for(const C of y)if(A.test(C.id)){b=C.id;break}if(!b)return;const S=this.#s.get(b);S?.annotationElementId===null&&(o.stopPropagation(),o.preventDefault(),S.dblclick())},{signal:a,capture:!0})}const t=new Map,e=new Map;for(const a of this.#s.values())if(a.disableEditing(),!!a.annotationElementId){if(a.serialize()!==null){t.set(a.annotationElementId,a);continue}else e.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}if(this.#n){const a=this.#n.getEditableAnnotations();for(const o of a){const{id:c}=o.data;if(this.#h.isDeletedAnnotationElement(c)){o.updateEdited({deleted:!0});continue}let h=e.get(c);if(h){h.resetAnnotationElement(o),h.show(!1),o.show();continue}h=t.get(c),h&&(this.#h.addChangedExistingAnnotation(h),h.renderAnnotationElement(o)&&h.show(!1)),o.show()}}this.#y(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const a of ci.#m.values())n.remove(`${a._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#f){this.#f=new AbortController;const t=this.#h.combinedSignal(this.#f);this.#u.div.addEventListener("pointerdown",this.#b.bind(this),{signal:t}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#u.div.classList.remove("highlighting"))}#b(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#u.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#u.div.contains(e)){const{isMac:n}=Ne.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#h.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),ae.startHighlighting(this,this.#h.direction==="ltr",{target:this.#u.div,x:t.x,y:t.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const t=this.#h.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#s.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#s.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t.annotationElementId),rt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#l),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getNextId(){return this.#h.getId()}get#_(){return ci.#m.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#A(t){const e=this.#_;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#_?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:n,offsetY:a}=this.#S(),o=this.getNextId(),c=this.#A({parent:this,id:o,x:n,y:a,uiManager:this.#h,isCentered:!0,...e});c&&this.add(c)}async deserialize(t){return await ci.#m.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,n={}){const a=this.getNextId(),o=this.#A({parent:this,id:a,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...n});return o&&this.add(o),o}#S(){const{x:t,y:e,width:n,height:a}=this.div.getBoundingClientRect(),o=Math.max(0,t),c=Math.max(0,e),h=Math.min(window.innerWidth,t+n),d=Math.min(window.innerHeight,e+a),f=(o+h)/2-t,g=(c+d)/2-e,[_,y]=this.viewport.rotation%180===0?[f,g]:[g,f];return{offsetX:_,offsetY:y}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=Ne.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#r||(this.#r=!1,this.#_?.isDrawer&&this.#_.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const n=this.#h.getMode();if(n===ft.STAMP||n===ft.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===ft.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:e}=Ne.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#r=!0,this.#_?.isDrawer){this.startDrawingSession(t);return}const n=this.#h.getActive();this.#e=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#c){this.#_.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#c=new AbortController;const e=this.#h.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#_.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#c?(this.#h.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#_.endDrawing(t)):null}findNewParent(t,e,n){const a=this.#h.findParent(e,n);return a===null||a===this?!1:(a.changeParent(t),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#_.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#s.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#s.clear(),this.#h.removeLayer(this)}#y(){for(const t of this.#s.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Ts(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#y();const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Ts(this.div,{rotation:n}),e!==n)for(const a of this.#s.values())a.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class Re{#t=null;#e=new Map;#n=new Map;static#i=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return Et(this,"_svgFactory",new _c)}static#a(t,[e,n,a,o]){const{style:c}=t;c.top=`${100*n}%`,c.left=`${100*e}%`,c.width=`${100*a}%`,c.height=`${100*o}%`}#s(){const t=Re._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#r(t,e){const n=Re._svgFactory.createElement("clipPath");t.append(n);const a=`clip_${e}`;n.setAttribute("id",a),n.setAttribute("clipPathUnits","objectBoundingBox");const o=Re._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${e}`),o.classList.add("clip"),a}#o(t,e){for(const[n,a]of Object.entries(e))a===null?t.removeAttribute(n):t.setAttribute(n,a)}draw(t,e=!1,n=!1){const a=Re.#i++,o=this.#s(),c=Re._svgFactory.createElement("defs");o.append(c);const h=Re._svgFactory.createElement("path");c.append(h);const d=`path_p${this.pageIndex}_${a}`;h.setAttribute("id",d),h.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(a,h);const f=n?this.#r(c,d):null,g=Re._svgFactory.createElement("use");return o.append(g),g.setAttribute("href",`#${d}`),this.updateProperties(o,t),this.#e.set(a,o),{id:a,clipPathId:`url(#${f})`}}drawOutline(t,e){const n=Re.#i++,a=this.#s(),o=Re._svgFactory.createElement("defs");a.append(o);const c=Re._svgFactory.createElement("path");o.append(c);const h=`path_p${this.pageIndex}_${n}`;c.setAttribute("id",h),c.setAttribute("vector-effect","non-scaling-stroke");let d;if(e){const _=Re._svgFactory.createElement("mask");o.append(_),d=`mask_p${this.pageIndex}_${n}`,_.setAttribute("id",d),_.setAttribute("maskUnits","objectBoundingBox");const y=Re._svgFactory.createElement("rect");_.append(y),y.setAttribute("width","1"),y.setAttribute("height","1"),y.setAttribute("fill","white");const b=Re._svgFactory.createElement("use");_.append(b),b.setAttribute("href",`#${h}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const f=Re._svgFactory.createElement("use");a.append(f),f.setAttribute("href",`#${h}`),d&&f.setAttribute("mask",`url(#${d})`);const g=f.cloneNode();return a.append(g),f.classList.add("mainOutline"),g.classList.add("secondaryOutline"),this.updateProperties(a,t),this.#e.set(n,a),n}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:a,rootClass:o,path:c}=e,h=typeof t=="number"?this.#e.get(t):t;if(h){if(n&&this.#o(h,n),a&&Re.#a(h,a),o){const{classList:d}=h;for(const[f,g]of Object.entries(o))d.toggle(f,g)}if(c){const f=h.firstChild.firstChild;this.#o(f,c)}}}updateParent(t,e){if(e===this)return;const n=this.#e.get(t);n&&(e.#t.append(n),this.#e.delete(t),e.#e.set(t,n))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Kd};globalThis.pdfjsLib={AbortException:Xi,AnnotationEditorLayer:ci,AnnotationEditorParamsType:Nt,AnnotationEditorType:ft,AnnotationEditorUIManager:$i,AnnotationLayer:Bf,AnnotationMode:Gi,AnnotationType:ue,build:ow,ColorPicker:Sn,createValidAbsoluteUrl:Kb,DOMSVGFactory:_c,DrawLayer:Re,FeatureTest:Ne,fetchData:Ro,getDocument:mv,getFilenameFromUrl:ZE,getPdfFilenameFromUrl:JE,getRGB:Gc,getUuid:Jb,getXfaPageViewport:e1,GlobalWorkerOptions:Na,ImageKind:hc,InvalidPDFException:jd,isDataScheme:Uc,isPdfFile:xf,isValidExplicitDest:d1,MathClamp:He,noContextMenu:wn,normalizeUnicode:WE,OPS:fo,OutputScale:Yn,PasswordResponses:zE,PDFDataRangeTransport:_v,PDFDateString:Vd,PDFWorker:go,PermissionFlag:HE,PixelsPerInch:Ba,RenderingCancelledException:Tf,ResponseException:gc,setLayerDimensions:Ts,shadow:Et,SignatureExtractor:Ta,stopEvent:he,SupportedImageMimeTypes:qd,TextLayer:Be,TouchManager:jc,updateUrlHash:Qb,Util:nt,VerbosityLevel:Fc,version:rw,XfaLayer:vv};const Jd=(r,t)=>t.some(e=>r instanceof e);let Wy,Ky;function Nw(){return Wy||(Wy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ow(){return Ky||(Ky=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tf=new WeakMap,Dd=new WeakMap,Yc=new WeakMap;function kw(r){const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("success",o),r.removeEventListener("error",c)},o=()=>{e(Cs(r.result)),a()},c=()=>{n(r.error),a()};r.addEventListener("success",o),r.addEventListener("error",c)});return Yc.set(t,r),t}function Lw(r){if(tf.has(r))return;const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",c),r.removeEventListener("abort",c)},o=()=>{e(),a()},c=()=>{n(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",o),r.addEventListener("error",c),r.addEventListener("abort",c)});tf.set(r,t)}let ef={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return tf.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Cs(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Rv(r){ef=r(ef)}function Iw(r){return Ow().includes(r)?function(...t){return r.apply(nf(this),t),Cs(this.request)}:function(...t){return Cs(r.apply(nf(this),t))}}function Pw(r){return typeof r=="function"?Iw(r):(r instanceof IDBTransaction&&Lw(r),Jd(r,Nw())?new Proxy(r,ef):r)}function Cs(r){if(r instanceof IDBRequest)return kw(r);if(Dd.has(r))return Dd.get(r);const t=Pw(r);return t!==r&&(Dd.set(r,t),Yc.set(t,r)),t}const nf=r=>Yc.get(r);function yc(r,t,{blocked:e,upgrade:n,blocking:a,terminated:o}={}){const c=indexedDB.open(r,t),h=Cs(c);return n&&c.addEventListener("upgradeneeded",d=>{n(Cs(c.result),d.oldVersion,d.newVersion,Cs(c.transaction),d)}),e&&c.addEventListener("blocked",d=>e(d.oldVersion,d.newVersion,d)),h.then(d=>{o&&d.addEventListener("close",()=>o()),a&&d.addEventListener("versionchange",f=>a(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}const Bw=["get","getKey","getAll","getAllKeys","count"],Fw=["put","add","delete","clear"],Md=new Map;function Qy(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Md.get(t))return Md.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,a=Fw.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Bw.includes(e)))return;const o=async function(c,...h){const d=this.transaction(c,a?"readwrite":"readonly");let f=d.store;return n&&(f=f.index(h.shift())),(await Promise.all([f[e](...h),a&&d.done]))[0]};return Md.set(t,o),o}Rv(r=>({...r,get:(t,e,n)=>Qy(t,e)||r.get(t,e,n),has:(t,e)=>!!Qy(t,e)||r.has(t,e)}));const Hw=["continue","continuePrimaryKey","advance"],Zy={},sf=new WeakMap,Dv=new WeakMap,zw={get(r,t){if(!Hw.includes(t))return r[t];let e=Zy[t];return e||(e=Zy[t]=function(...n){sf.set(this,Dv.get(this)[t](...n))}),e}};async function*Uw(...r){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...r)),!t)return;t=t;const e=new Proxy(t,zw);for(Dv.set(e,t),Yc.set(e,nf(t));t;)yield e,t=await(sf.get(e)||t.continue()),sf.delete(e)}function Jy(r,t){return t===Symbol.asyncIterator&&Jd(r,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Jd(r,[IDBIndex,IDBObjectStore])}Rv(r=>({...r,get(t,e,n){return Jy(t,e)?Uw:r.get(t,e,n)},has(t,e){return Jy(t,e)||r.has(t,e)}}));Na.workerSrc="./pdf.worker.min.js";async function Gw(r){const t=await mv({url:URL.createObjectURL(r)}).promise,e=[];for(let n=0;n<t.numPages;n++){const a=await t.getPage(n+1),o=await jw(a);e.push(o)}return e}async function jw(r){const n=(await r.getTextContent()).items.map(f=>{const[g,_,y,b,A,S]=f.transform;return{text:f.str,x:A,y:S,width:f.width,height:b}}).sort((f,g)=>Math.abs(f.y-g.y)>5?g.y-f.y:f.x-g.x),a=[];let o=[],c=null;const h=5;for(let f of n)c===null||Math.abs(f.y-c)<=h?(o.push(f),c===null?c=f.y:c=o.reduce((g,_)=>g+_.y,0)/o.length):(o.length&&a.push(o),o=[f],c=f.y);o.length&&a.push(o);let d="";for(let f of a){f.sort((y,b)=>y.x-b.x);let g="",_=null;for(let y of f)_!==null&&y.x-_>y.height*.2&&(g+=" "),g+=y.text,_=y.x+y.width;g.trim()&&(d+=g+`
`)}return d.trim()}function Vw(r){return!r||!Array.isArray(r)||r.length===0?(console.warn("No se pudo extraer texto del PDF"),{}):r}function qw(r){const t=["Fecha Fin","Frec. Horas","F. Real de Ejecucion","Frec. Comb.","Incidencia"],e={"Numero orden":/Número orden\s+?(\d+)/,"Tipo de Orden":/[A-Z0-9]\nClase/,Clase:/Clase (.+?) Asignado a/,"Asignado a":/Asignado a (.+?)\n/,Descripcion:/Descripción (.+?) Tipo/,Tipo:/Tipo (.+?) Estado/,Estado:/Estado (.+?) Frec/,"Frec. Dias":/Frec\. D[ií]as ([0-9]+)/,"N Unidad":/Nº Unidad (.+?) Parte/,Parte:/Parte (.+?) F inicial/,"F inicial":/F inicial ([0-9/]+)/,"Frec. Comb.":/Frec\. Comb\. (.+?)/,Especialidad:/Especialidad (.+?) Elemento/,Elemento:/Elemento (.+?) FF\.\.RReeaall/,"F. Real de Ejecucion":/FF\.\.RReeaall EEjjeeccuucciioonn (.+?) Frec\. Km/,"Frec. Km":/Frec\. Km ([^ ]*)/,Modo:/Modo ([^ ]*?)(?:\s+(?:Fecha Fin|Frec\. Horas))/,"Fecha Fin":/Fecha Fin ([0-9/]+)/,"Frec. Horas":/Frec\. Horas ([^ ]*)/,Originador:/Originador\s+?([A-Z]+ [A-ZÁÉÍÓÚÑa-z\s]+)\nIncidencia/,Incidencia:/Incidencia (.+?) Fecha Venc\./,"Fecha Venc.":/Fecha Venc\. ([0-9/]+)/,"Ultima Realiz.":/Ultima Realiz\.\s+?([0-9/]+)/,Linea:/Linea (.+?) Kit de Tareas/,"Kit de Tareas":/Kit de Tareas ([0-9]+)/,"Proximo Venc.":/Proximo Venc\. ([0-9/]+)/,"Fecha Prox Emision":/Fecha Prox Emisión ([0-9/]+)/,"N de Serie":/Nº de Serie (.+?) Planta/,Planta:/Planta (.+?) Tipo servici/,"Tipo servici":/Tipo servici ([A-Z0-9]+ [A-ZÁÉÍÓÚÑa-z\.]+)/,Prioridad:/Prioridad: ([A-Z\-a-z]+)/,"Seg. y Medio Ambiente":/Seg\. y Medio Ambiente ([A-Z0-9]+)/,Calidad:/Calidad ([A-Z0-9]+)/,Operacion:/Operación ([A-Z0-9]+)/,Mantenimiento:/Mantenimiento ([A-Z0-9]+)/,Categorizacion:/Categorización\s+?([A-Z0-9]+)/,"Tipo de Servicio":/Tipo de Servicio (.+?)\n/},n={};t.forEach(o=>n[o]=null);for(const[o,c]of Object.entries(e)){const h=r.match(c);h&&(n[o]=h[1].trim())}let a=n["Tipo de Servicio"];return a&&a.includes("SYS")?a=1:a&&a.includes("CCL")?a=2:a=3,n["Frec. Dias"]=n["Frec. Dias"]&&!isNaN(n["Frec. Dias"])?parseInt(n["Frec. Dias"]):null,n.prioridad=a,n.asignado_a_code=null,n.asignado_por_name=null,n.asignado_por_code=null,n.Especialidad_id=null,n.hs_reales=0,n.fecha_inicio=null,n.fecha_fin=null,n.observaciones=null,n.status=0,n.obs_anulada=null,n.code_orden_anulada=null,n.checkListDict={},n}function Yw(r){const t=r.split(`
`),e=[];let n=0;const a=/^([A-ZÁÉÍÓÚÑa-z0-9]+)\s+([\d\S]+)\s+(\d+)\s+(.*)\s+(\d\.\d+|\.\d+)\s+(.+)/,o=/^([A-ZÁÉÍÓÚÑa-z0-9]+)\s+([\d\.]+)\s+(\d+)\s+(.+)/;let c=0;for(let h=17;h<t.length;h++){const d=t[h];let f=d.match(a);if(f){let g=parseFloat(f[5]);isNaN(g)&&(g=0);const _={Taller:f[1],"Numero sec oper":parseFloat(f[2]),"Tarea Standard":f[3],Descripcion:f[4],"Hs Estim":g,"Valor esperado":f[6],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};e.push(_),n++}else if(f=d.match(o),f){const g={Taller:f[1],"Numero sec oper":parseFloat(f[2]),"Tarea Standard":f[3],Descripcion:f[4],"Hs Estim":0,"Valor esperado":f[4],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};e.push(g),n++}else{try{c=e.reduce((g,_)=>g+(_["Hs Estim"]||0),0),c=Math.round(c*1e3)/1e3}catch{c=0}return{data:e,Tasks_N:n,h_estimadas:c}}}try{c=e.reduce((h,d)=>h+(d["Hs Estim"]||0),0),c=Math.round(c*1e3)/1e3}catch{c=0}return{data:e,Tasks_N:n,h_estimadas:c}}function Xw(r,t){let e="";const n=["OT Generadas","Realizado por:","Firma:"];e=t.split(`
`).slice(r+17).join(`
`).trim();for(const o of n){const c=e.indexOf(o);if(c!==-1){e=e.slice(0,c).trim();break}}return e}function $w(r,t){t=Xw(r,t);const e=/^(.?.?T\d+)/im,n=/^(.?.?SEGURIDAD)|^(.?.?SGURIDAD)/im,a=[];let o="",c="",h=0,d=0;for(const f of t.split(`
`))e.test(f)?(h===1&&(c!==""&&(o=c+`
`+o),a.push(o)),o=f,h=1,d=0):n.test(f)&&h===1&&d===0?o+=`
`+f:n.test(f)?d===1&&h===1?(o=c+`
`+o,a.push(o)):(c=f,h=2,d=1):h===1?o+=`
`+f:h===2&&(c+=`
`+f);return h===1?(c!==""&&(o=c+`
`+o),a.push(o)):h===2&&c!==""&&a.push(c),a}function Ww(r){const t=Vw(r),e=/Número orden\s+?(\d+)/,n=/(\nOT Generadas)|(\nRealizado por:)|(\nFirma:)/g,a="",o={};for(const c of t){let h;if((h=e.exec(c))!==null){const d=h[1];if(o[d]){let f=c.replace(n,a);f=f.split(`
`).slice(3).join(`
`),o[d].data+=`
`+f}else{o[d]={};let f=c.replace(n,a);o[d].data=f}}}for(const c in o)o[c].info=qw(o[c].data),o[c].tasks=Yw(o[c].data),o[c].protocolos=$w(o[c].tasks.Tasks_N,o[c].data);return o}async function Kw(r){let t=[];Array.isArray(r)?t=r:typeof r=="object"&&r!==null&&(t=Object.entries(r).map(([a,o])=>({id:a,...o})));const n=(await yc("pdfDataDB",1,{upgrade(a){a.objectStoreNames.contains("pdfData")||a.createObjectStore("pdfData",{keyPath:"id"})}})).transaction("pdfData","readwrite");for(const a of t)await n.store.put(a);await n.done}async function Qw(r,t){const e=await Gw(r),n=Ww(e);await Kw(n),t(Object.keys(n).length)}const Zw=()=>{};var tb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mv={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K=function(r,t){if(!r)throw Ga(t)},Ga=function(r){return new Error("Firebase Database ("+Mv.SDK_VERSION+") INTERNAL ASSERT FAILED: "+r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nv=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);a<128?t[e++]=a:a<2048?(t[e++]=a>>6|192,t[e++]=a&63|128):(a&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=a>>18|240,t[e++]=a>>12&63|128,t[e++]=a>>6&63|128,t[e++]=a&63|128):(t[e++]=a>>12|224,t[e++]=a>>6&63|128,t[e++]=a&63|128)}return t},Jw=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const a=r[e++];if(a<128)t[n++]=String.fromCharCode(a);else if(a>191&&a<224){const o=r[e++];t[n++]=String.fromCharCode((a&31)<<6|o&63)}else if(a>239&&a<365){const o=r[e++],c=r[e++],h=r[e++],d=((a&7)<<18|(o&63)<<12|(c&63)<<6|h&63)-65536;t[n++]=String.fromCharCode(55296+(d>>10)),t[n++]=String.fromCharCode(56320+(d&1023))}else{const o=r[e++],c=r[e++];t[n++]=String.fromCharCode((a&15)<<12|(o&63)<<6|c&63)}}return t.join("")},Uf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<r.length;a+=3){const o=r[a],c=a+1<r.length,h=c?r[a+1]:0,d=a+2<r.length,f=d?r[a+2]:0,g=o>>2,_=(o&3)<<4|h>>4;let y=(h&15)<<2|f>>6,b=f&63;d||(b=64,c||(y=64)),n.push(e[g],e[_],e[y],e[b])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Nv(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Jw(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<r.length;){const o=e[r.charAt(a++)],h=a<r.length?e[r.charAt(a)]:0;++a;const f=a<r.length?e[r.charAt(a)]:64;++a;const _=a<r.length?e[r.charAt(a)]:64;if(++a,o==null||h==null||f==null||_==null)throw new tC;const y=o<<2|h>>4;if(n.push(y),f!==64){const b=h<<4&240|f>>2;if(n.push(b),_!==64){const A=f<<6&192|_;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class tC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ov=function(r){const t=Nv(r);return Uf.encodeByteArray(t,!0)},bc=function(r){return Ov(r).replace(/\./g,"")},af=function(r){try{return Uf.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(r){return kv(void 0,r)}function kv(r,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const e=t;return new Date(e.getTime());case Object:r===void 0&&(r={});break;case Array:r=[];break;default:return t}for(const e in t)!t.hasOwnProperty(e)||!nC(e)||(r[e]=kv(r[e],t[e]));return r}function nC(r){return r!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sC=()=>iC().__FIREBASE_DEFAULTS__,aC=()=>{if(typeof process>"u"||typeof tb>"u")return;const r=tb.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},rC=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&af(r[1]);return t&&JSON.parse(t)},Lv=()=>{try{return Zw()||sC()||aC()||rC()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},oC=r=>Lv()?.emulatorHosts?.[r],lC=r=>{const t=oC(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},Iv=()=>Lv()?.config;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gf(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function cC(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uC(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",a=r.iat||0,o=r.sub||r.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...r};return[bc(JSON.stringify(e)),bc(JSON.stringify(c)),""].join(".")}const ro={};function hC(){const r={prod:[],emulator:[]};for(const t of Object.keys(ro))ro[t]?r.emulator.push(t):r.prod.push(t);return r}function dC(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let eb=!1;function fC(r,t){if(typeof window>"u"||typeof document>"u"||!Gf(window.location.host)||ro[r]===t||ro[r]||eb)return;ro[r]=t;function e(y){return`__firebase__banner__${y}`}const n="__firebase__banner",o=hC().prod.length>0;function c(){const y=document.getElementById(n);y&&y.remove()}function h(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function d(y,b){y.setAttribute("width","24"),y.setAttribute("id",b),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function f(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{eb=!0,c()},y}function g(y,b){y.setAttribute("id",b),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function _(){const y=dC(n),b=e("text"),A=document.getElementById(b)||document.createElement("span"),S=e("learnmore"),C=document.getElementById(S)||document.createElement("a"),w=e("preprendIcon"),M=document.getElementById(w)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const T=y.element;h(T),g(C,S);const N=f();d(M,w),T.append(M,A,C,N),document.body.appendChild(T)}o?(A.innerText="Preview backend disconnected.",M.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(M.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pC(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Pv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pC())}function gC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function mC(){return Mv.NODE_ADMIN===!0}function _C(){try{return typeof indexedDB=="object"}catch{return!1}}function yC(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},a.onupgradeneeded=()=>{e=!1},a.onerror=()=>{t(a.error?.message||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bC="FirebaseError";class ko extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=bC,Object.setPrototypeOf(this,ko.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bv.prototype.create)}}class Bv{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},a=`${this.service}/${t}`,o=this.errors[t],c=o?vC(o,n):"Error",h=`${this.serviceName}: ${c} (${a}).`;return new ko(a,h,n)}}function vC(r,t){return r.replace(AC,(e,n)=>{const a=t[n];return a!=null?String(a):`<${n}?>`})}const AC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _o(r){return JSON.parse(r)}function Ee(r){return JSON.stringify(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fv=function(r){let t={},e={},n={},a="";try{const o=r.split(".");t=_o(af(o[0])||""),e=_o(af(o[1])||""),a=o[2],n=e.d||{},delete e.d}catch{}return{header:t,claims:e,data:n,signature:a}},SC=function(r){const t=Fv(r),e=t.claims;return!!e&&typeof e=="object"&&e.hasOwnProperty("iat")},EC=function(r){const t=Fv(r).claims;return typeof t=="object"&&t.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mi(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function Fa(r,t){if(Object.prototype.hasOwnProperty.call(r,t))return r[t]}function nb(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function vc(r,t,e){const n={};for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=t.call(e,r[a],a,r));return n}function Ac(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const a of e){if(!n.includes(a))return!1;const o=r[a],c=t[a];if(ib(o)&&ib(c)){if(!Ac(o,c))return!1}else if(o!==c)return!1}for(const a of n)if(!e.includes(a))return!1;return!0}function ib(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wC(r){const t=[];for(const[e,n]of Object.entries(r))Array.isArray(n)?n.forEach(a=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(a))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if(typeof t=="string")for(let _=0;_<16;_++)n[_]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let _=0;_<16;_++)n[_]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let _=16;_<80;_++){const y=n[_-3]^n[_-8]^n[_-14]^n[_-16];n[_]=(y<<1|y>>>31)&4294967295}let a=this.chain_[0],o=this.chain_[1],c=this.chain_[2],h=this.chain_[3],d=this.chain_[4],f,g;for(let _=0;_<80;_++){_<40?_<20?(f=h^o&(c^h),g=1518500249):(f=o^c^h,g=1859775393):_<60?(f=o&c|h&(o|c),g=2400959708):(f=o^c^h,g=3395469782);const y=(a<<5|a>>>27)+f+d+g+n[_]&4294967295;d=h,h=c,c=(o<<30|o>>>2)&4294967295,o=a,a=y}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+d&4294967295}update(t,e){if(t==null)return;e===void 0&&(e=t.length);const n=e-this.blockSize;let a=0;const o=this.buf_;let c=this.inbuf_;for(;a<e;){if(c===0)for(;a<=n;)this.compress_(t,a),a+=this.blockSize;if(typeof t=="string"){for(;a<e;)if(o[c]=t.charCodeAt(a),++c,++a,c===this.blockSize){this.compress_(o),c=0;break}}else for(;a<e;)if(o[c]=t[a],++c,++a,c===this.blockSize){this.compress_(o),c=0;break}}this.inbuf_=c,this.total_+=e}digest(){const t=[];let e=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=e&255,e/=256;this.compress_(this.buf_);let n=0;for(let a=0;a<5;a++)for(let o=24;o>=0;o-=8)t[n]=this.chain_[a]>>o&255,++n;return t}}function jf(r,t){return`${r} failed: ${t} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);if(a>=55296&&a<=56319){const o=a-55296;n++,K(n<r.length,"Surrogate pair missing trail surrogate.");const c=r.charCodeAt(n)-56320;a=65536+(o<<10)+c}a<128?t[e++]=a:a<2048?(t[e++]=a>>6|192,t[e++]=a&63|128):a<65536?(t[e++]=a>>12|224,t[e++]=a>>6&63|128,t[e++]=a&63|128):(t[e++]=a>>18|240,t[e++]=a>>12&63|128,t[e++]=a>>6&63|128,t[e++]=a&63|128)}return t},$c=function(r){let t=0;for(let e=0;e<r.length;e++){const n=r.charCodeAt(e);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,e++):t+=3}return t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ja(r){return r&&r._delegate?r._delegate:r}class yo{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _s="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new Xc;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:e});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(a){if(n)return null;throw a}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(DC(t))try{this.getOrInitializeService({instanceIdentifier:_s})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:a});n.resolve(o)}catch{}}}}clearInstance(t=_s){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=_s){return this.instances.has(t)}getOptions(t=_s){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[o,c]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(o);n===h&&c.resolve(a)}return a}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),a=this.onInitCallbacks.get(n)??new Set;a.add(t),this.onInitCallbacks.set(n,a);const o=this.instances.get(n);return o&&t(o,n),()=>{a.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const a of n)try{a(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:RC(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=_s){return this.component?this.component.multipleInstances?t:_s:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function RC(r){return r===_s?void 0:r}function DC(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new xC(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yt;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Yt||(Yt={}));const NC={debug:Yt.DEBUG,verbose:Yt.VERBOSE,info:Yt.INFO,warn:Yt.WARN,error:Yt.ERROR,silent:Yt.SILENT},OC=Yt.INFO,kC={[Yt.DEBUG]:"log",[Yt.VERBOSE]:"log",[Yt.INFO]:"info",[Yt.WARN]:"warn",[Yt.ERROR]:"error"},LC=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),a=kC[t];if(a)console[a](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Hv{constructor(t){this.name=t,this._logLevel=OC,this._logHandler=LC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Yt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?NC[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Yt.DEBUG,...t),this._logHandler(this,Yt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Yt.VERBOSE,...t),this._logHandler(this,Yt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Yt.INFO,...t),this._logHandler(this,Yt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Yt.WARN,...t),this._logHandler(this,Yt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Yt.ERROR,...t),this._logHandler(this,Yt.ERROR,...t)}}const IC=(r,t)=>t.some(e=>r instanceof e);let sb,ab;function PC(){return sb||(sb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function BC(){return ab||(ab=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const zv=new WeakMap,rf=new WeakMap,Uv=new WeakMap,Nd=new WeakMap,Vf=new WeakMap;function FC(r){const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("success",o),r.removeEventListener("error",c)},o=()=>{e(Vi(r.result)),a()},c=()=>{n(r.error),a()};r.addEventListener("success",o),r.addEventListener("error",c)});return t.then(e=>{e instanceof IDBCursor&&zv.set(e,r)}).catch(()=>{}),Vf.set(t,r),t}function HC(r){if(rf.has(r))return;const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",c),r.removeEventListener("abort",c)},o=()=>{e(),a()},c=()=>{n(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",o),r.addEventListener("error",c),r.addEventListener("abort",c)});rf.set(r,t)}let of={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return rf.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Uv.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Vi(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function zC(r){of=r(of)}function UC(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(Od(this),t,...e);return Uv.set(n,t.sort?t.sort():[t]),Vi(n)}:BC().includes(r)?function(...t){return r.apply(Od(this),t),Vi(zv.get(this))}:function(...t){return Vi(r.apply(Od(this),t))}}function GC(r){return typeof r=="function"?UC(r):(r instanceof IDBTransaction&&HC(r),IC(r,PC())?new Proxy(r,of):r)}function Vi(r){if(r instanceof IDBRequest)return FC(r);if(Nd.has(r))return Nd.get(r);const t=GC(r);return t!==r&&(Nd.set(r,t),Vf.set(t,r)),t}const Od=r=>Vf.get(r);function jC(r,t,{blocked:e,upgrade:n,blocking:a,terminated:o}={}){const c=indexedDB.open(r,t),h=Vi(c);return n&&c.addEventListener("upgradeneeded",d=>{n(Vi(c.result),d.oldVersion,d.newVersion,Vi(c.transaction),d)}),e&&c.addEventListener("blocked",d=>e(d.oldVersion,d.newVersion,d)),h.then(d=>{o&&d.addEventListener("close",()=>o()),a&&d.addEventListener("versionchange",f=>a(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}const VC=["get","getKey","getAll","getAllKeys","count"],qC=["put","add","delete","clear"],kd=new Map;function rb(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(kd.get(t))return kd.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,a=qC.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(a||VC.includes(e)))return;const o=async function(c,...h){const d=this.transaction(c,a?"readwrite":"readonly");let f=d.store;return n&&(f=f.index(h.shift())),(await Promise.all([f[e](...h),a&&d.done]))[0]};return kd.set(t,o),o}zC(r=>({...r,get:(t,e,n)=>rb(t,e)||r.get(t,e,n),has:(t,e)=>!!rb(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(XC(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function XC(r){return r.getComponent()?.type==="VERSION"}const lf="@firebase/app",ob="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi=new Hv("@firebase/app"),$C="@firebase/app-compat",WC="@firebase/analytics-compat",KC="@firebase/analytics",QC="@firebase/app-check-compat",ZC="@firebase/app-check",JC="@firebase/auth",tT="@firebase/auth-compat",eT="@firebase/database",nT="@firebase/data-connect",iT="@firebase/database-compat",sT="@firebase/functions",aT="@firebase/functions-compat",rT="@firebase/installations",oT="@firebase/installations-compat",lT="@firebase/messaging",cT="@firebase/messaging-compat",uT="@firebase/performance",hT="@firebase/performance-compat",dT="@firebase/remote-config",fT="@firebase/remote-config-compat",pT="@firebase/storage",gT="@firebase/storage-compat",mT="@firebase/firestore",_T="@firebase/ai",yT="@firebase/firestore-compat",bT="firebase",vT="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cf="[DEFAULT]",AT={[lf]:"fire-core",[$C]:"fire-core-compat",[KC]:"fire-analytics",[WC]:"fire-analytics-compat",[ZC]:"fire-app-check",[QC]:"fire-app-check-compat",[JC]:"fire-auth",[tT]:"fire-auth-compat",[eT]:"fire-rtdb",[nT]:"fire-data-connect",[iT]:"fire-rtdb-compat",[sT]:"fire-fn",[aT]:"fire-fn-compat",[rT]:"fire-iid",[oT]:"fire-iid-compat",[lT]:"fire-fcm",[cT]:"fire-fcm-compat",[uT]:"fire-perf",[hT]:"fire-perf-compat",[dT]:"fire-rc",[fT]:"fire-rc-compat",[pT]:"fire-gcs",[gT]:"fire-gcs-compat",[mT]:"fire-fst",[yT]:"fire-fst-compat",[_T]:"fire-vertex","fire-js":"fire-js",[bT]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc=new Map,ST=new Map,uf=new Map;function lb(r,t){try{r.container.addComponent(t)}catch(e){fi.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Ec(r){const t=r.name;if(uf.has(t))return fi.debug(`There were multiple attempts to register component ${t}.`),!1;uf.set(t,r);for(const e of Sc.values())lb(e,r);for(const e of ST.values())lb(e,r);return!0}function ET(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function wT(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CT={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},qi=new Bv("app","Firebase",CT);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new yo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw qi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT=vT;function Gv(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:cf,automaticDataCollectionEnabled:!0,...t},a=n.name;if(typeof a!="string"||!a)throw qi.create("bad-app-name",{appName:String(a)});if(e||(e=Iv()),!e)throw qi.create("no-options");const o=Sc.get(a);if(o){if(Ac(e,o.options)&&Ac(n,o.config))return o;throw qi.create("duplicate-app",{appName:a})}const c=new MC(a);for(const d of uf.values())c.addComponent(d);const h=new TT(e,n,c);return Sc.set(a,h),h}function RT(r=cf){const t=Sc.get(r);if(!t&&r===cf&&Iv())return Gv();if(!t)throw qi.create("no-app",{appName:r});return t}function Oa(r,t,e){let n=AT[r]??r;e&&(n+=`-${e}`);const a=n.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const c=[`Unable to register library "${n}" with version "${t}":`];a&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),a&&o&&c.push("and"),o&&c.push(`version name "${t}" contains illegal characters (whitespace or "/")`),fi.warn(c.join(" "));return}Ec(new yo(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DT="firebase-heartbeat-database",MT=1,bo="firebase-heartbeat-store";let Ld=null;function jv(){return Ld||(Ld=jC(DT,MT,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(bo)}catch(e){console.warn(e)}}}}).catch(r=>{throw qi.create("idb-open",{originalErrorMessage:r.message})})),Ld}async function NT(r){try{const e=(await jv()).transaction(bo),n=await e.objectStore(bo).get(Vv(r));return await e.done,n}catch(t){if(t instanceof ko)fi.warn(t.message);else{const e=qi.create("idb-get",{originalErrorMessage:t?.message});fi.warn(e.message)}}}async function cb(r,t){try{const n=(await jv()).transaction(bo,"readwrite");await n.objectStore(bo).put(t,Vv(r)),await n.done}catch(e){if(e instanceof ko)fi.warn(e.message);else{const n=qi.create("idb-set",{originalErrorMessage:e?.message});fi.warn(n.message)}}}function Vv(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT=1024,kT=30;class LT{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new PT(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=ub();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(a=>a.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>kT){const a=BT(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){fi.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ub(),{heartbeatsToSend:e,unsentEntries:n}=IT(this._heartbeatsCache.heartbeats),a=bc(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return fi.warn(t),""}}}function ub(){return new Date().toISOString().substring(0,10)}function IT(r,t=OT){const e=[];let n=r.slice();for(const a of r){const o=e.find(c=>c.agent===a.agent);if(o){if(o.dates.push(a.date),hb(e)>t){o.dates.pop();break}}else if(e.push({agent:a.agent,dates:[a.date]}),hb(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class PT{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _C()?yC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await NT(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return cb(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return cb(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function hb(r){return bc(JSON.stringify({version:2,heartbeats:r})).length}function BT(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FT(r){Ec(new yo("platform-logger",t=>new YC(t),"PRIVATE")),Ec(new yo("heartbeat",t=>new LT(t),"PRIVATE")),Oa(lf,ob,r),Oa(lf,ob,"esm2020"),Oa("fire-js","")}FT("");var HT="firebase",zT="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Oa(HT,zT,"app");var db={};const fb="@firebase/database",pb="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qv="";function UT(r){qv=r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Ee(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:_o(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jT{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return mi(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yv=function(r){try{if(typeof window<"u"&&typeof window[r]<"u"){const t=window[r];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new GT(t)}}catch{}return new jT},vs=Yv("localStorage"),VT=Yv("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ka=new Hv("@firebase/database"),qT=(function(){let r=1;return function(){return r++}})(),Xv=function(r){const t=TC(r),e=new CC;e.update(t);const n=e.digest();return Uf.encodeByteArray(n)},Lo=function(...r){let t="";for(let e=0;e<r.length;e++){const n=r[e];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?t+=Lo.apply(null,n):typeof n=="object"?t+=Ee(n):t+=n,t+=" "}return t};let oo=null,gb=!0;const YT=function(r,t){K(!0,"Can't turn on custom loggers persistently."),ka.logLevel=Yt.VERBOSE,oo=ka.log.bind(ka)},Ie=function(...r){if(gb===!0&&(gb=!1,oo===null&&VT.get("logging_enabled")===!0&&YT()),oo){const t=Lo.apply(null,r);oo(t)}},Io=function(r){return function(...t){Ie(r,...t)}},hf=function(...r){const t="FIREBASE INTERNAL ERROR: "+Lo(...r);ka.error(t)},pi=function(...r){const t=`FIREBASE FATAL ERROR: ${Lo(...r)}`;throw ka.error(t),new Error(t)},Qe=function(...r){const t="FIREBASE WARNING: "+Lo(...r);ka.warn(t)},XT=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Qe("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$v=function(r){return typeof r=="number"&&(r!==r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)},$T=function(r){if(document.readyState==="complete")r();else{let t=!1;const e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,r())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},Ha="[MIN_NAME]",Rs="[MAX_NAME]",Va=function(r,t){if(r===t)return 0;if(r===Ha||t===Rs)return-1;if(t===Ha||r===Rs)return 1;{const e=mb(r),n=mb(t);return e!==null?n!==null?e-n===0?r.length-t.length:e-n:-1:n!==null?1:r<t?-1:1}},WT=function(r,t){return r===t?0:r<t?-1:1},Zr=function(r,t){if(t&&r in t)return t[r];throw new Error("Missing required key ("+r+") in object: "+Ee(t))},qf=function(r){if(typeof r!="object"||r===null)return Ee(r);const t=[];for(const n in r)t.push(n);t.sort();let e="{";for(let n=0;n<t.length;n++)n!==0&&(e+=","),e+=Ee(t[n]),e+=":",e+=qf(r[t[n]]);return e+="}",e},Wv=function(r,t){const e=r.length;if(e<=t)return[r];const n=[];for(let a=0;a<e;a+=t)a+t>e?n.push(r.substring(a,e)):n.push(r.substring(a,a+t));return n};function Ze(r,t){for(const e in r)r.hasOwnProperty(e)&&t(e,r[e])}const Kv=function(r){K(!$v(r),"Invalid JSON number");const t=11,e=52,n=(1<<t-1)-1;let a,o,c,h,d;r===0?(o=0,c=0,a=1/r===-1/0?1:0):(a=r<0,r=Math.abs(r),r>=Math.pow(2,1-n)?(h=Math.min(Math.floor(Math.log(r)/Math.LN2),n),o=h+n,c=Math.round(r*Math.pow(2,e-h)-Math.pow(2,e))):(o=0,c=Math.round(r/Math.pow(2,1-n-e))));const f=[];for(d=e;d;d-=1)f.push(c%2?1:0),c=Math.floor(c/2);for(d=t;d;d-=1)f.push(o%2?1:0),o=Math.floor(o/2);f.push(a?1:0),f.reverse();const g=f.join("");let _="";for(d=0;d<64;d+=8){let y=parseInt(g.substr(d,8),2).toString(16);y.length===1&&(y="0"+y),_=_+y}return _.toLowerCase()},KT=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},QT=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function ZT(r,t){let e="Unknown Error";r==="too_big"?e="The data requested exceeds the maximum size that can be accessed with a single request.":r==="permission_denied"?e="Client doesn't have permission to access the desired data.":r==="unavailable"&&(e="The service is unavailable");const n=new Error(r+" at "+t._path.toString()+": "+e);return n.code=r.toUpperCase(),n}const JT=new RegExp("^-?(0*)\\d{1,10}$"),tx=-2147483648,ex=2147483647,mb=function(r){if(JT.test(r)){const t=Number(r);if(t>=tx&&t<=ex)return t}return null},qa=function(r){try{r()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Qe("Exception was thrown by user callback.",e),t},Math.floor(0))}},nx=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},lo=function(r,t){const e=setTimeout(r,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,wT(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(n=>this.appCheck=n)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,n)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){this.appCheckProvider?.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Qe(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(a=>this.auth_=a)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?(Ie("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,n)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Qe(t)}}class pc{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}pc.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yf="5",Qv="v",Zv="s",Jv="r",t0="f",e0=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,n0="ls",i0="p",df="ac",s0="websocket",a0="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(t,e,n,a,o=!1,c="",h=!1,d=!1,f=null){this.secure=e,this.namespace=n,this.webSocketOnly=a,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=d,this.emulatorOptions=f,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=vs.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&vs.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function ax(r){return r.host!==r.internalHost||r.isCustomHost()||r.includeNamespaceInQueryParams}function o0(r,t,e){K(typeof t=="string","typeof type must == string"),K(typeof e=="object","typeof params must == object");let n;if(t===s0)n=(r.secure?"wss://":"ws://")+r.internalHost+"/.ws?";else if(t===a0)n=(r.secure?"https://":"http://")+r.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);ax(r)&&(e.ns=r.namespace);const a=[];return Ze(e,(o,c)=>{a.push(o+"="+c)}),n+a.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(){this.counters_={}}incrementCounter(t,e=1){mi(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return eC(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Id={},Pd={};function Xf(r){const t=r.toString();return Id[t]||(Id[t]=new rx),Id[t]}function ox(r,t){const e=r.toString();return Pd[e]||(Pd[e]=t()),Pd[e]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let a=0;a<n.length;++a)n[a]&&qa(()=>{this.onMessage_(n[a])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _b="start",cx="close",ux="pLPCommand",hx="pRTLPCB",l0="id",c0="pw",u0="ser",dx="cb",fx="seg",px="ts",gx="d",mx="dframe",h0=1870,d0=30,_x=h0-d0,yx=25e3,bx=3e4;class Da{constructor(t,e,n,a,o,c,h){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=a,this.authToken=o,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Io(t),this.stats_=Xf(e),this.urlFn=d=>(this.appCheckToken&&(d[df]=this.appCheckToken),o0(e,a0,d))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new lx(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(bx)),$T(()=>{if(this.isClosed_)return;this.scriptTagHolder=new $f((...o)=>{const[c,h,d,f,g]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,c===_b)this.id=h,this.password=d;else if(c===cx)h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+c)},(...o)=>{const[c,h]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const n={};n[_b]="t",n[u0]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[dx]=this.scriptTagHolder.uniqueCallbackIdentifier),n[Qv]=Yf,this.transportSessionId&&(n[Zv]=this.transportSessionId),this.lastSessionId&&(n[n0]=this.lastSessionId),this.applicationId&&(n[i0]=this.applicationId),this.appCheckToken&&(n[df]=this.appCheckToken),typeof location<"u"&&location.hostname&&e0.test(location.hostname)&&(n[Jv]=t0);const a=this.urlFn(n);this.log_("Connecting via long-poll to "+a),this.scriptTagHolder.addTag(a,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Da.forceAllow_=!0}static forceDisallow(){Da.forceDisallow_=!0}static isAvailable(){return Da.forceAllow_?!0:!Da.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!KT()&&!QT()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=Ee(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=Ov(e),a=Wv(n,_x);for(let o=0;o<a.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,a.length,a[o]),this.curSegmentNum++}addDisconnectPingFrame(t,e){this.myDisconnFrame=document.createElement("iframe");const n={};n[mx]="t",n[l0]=t,n[c0]=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=Ee(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class $f{constructor(t,e,n,a){this.onDisconnect=n,this.urlFn=a,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=qT(),window[ux+this.uniqueCallbackIdentifier]=t,window[hx+this.uniqueCallbackIdentifier]=e,this.myIFrame=$f.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){Ie("frame writing exception"),h.stack&&Ie(h.stack),Ie(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||Ie("No IE domain setting required")}catch{const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[l0]=this.myID,t[c0]=this.myPW,t[u0]=this.currentSerial;let e=this.urlFn(t),n="",a=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+d0+n.length<=h0;){const c=this.pendingSegs.shift();n=n+"&"+fx+a+"="+c.seg+"&"+px+a+"="+c.ts+"&"+gx+a+"="+c.d,a++}return e=e+n,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},a=setTimeout(n,Math.floor(yx)),o=()=>{clearTimeout(a),n()};this.addTag(t,o)}addTag(t,e){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const a=n.readyState;(!a||a==="loaded"||a==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{Ie("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vx=16384,Ax=45e3;let wc=null;typeof MozWebSocket<"u"?wc=MozWebSocket:typeof WebSocket<"u"&&(wc=WebSocket);class Dn{constructor(t,e,n,a,o,c,h){this.connId=t,this.applicationId=n,this.appCheckToken=a,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Io(this.connId),this.stats_=Xf(e),this.connURL=Dn.connectionURL_(e,c,h,a,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,a,o){const c={};return c[Qv]=Yf,typeof location<"u"&&location.hostname&&e0.test(location.hostname)&&(c[Jv]=t0),e&&(c[Zv]=e),n&&(c[n0]=n),a&&(c[df]=a),o&&(c[i0]=o),o0(t,s0,c)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,vs.set("previous_websocket_failure",!0);try{let n;mC(),this.mySock=new wc(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const a=n.message||n.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const a=n.message||n.data;a&&this.log_(a),this.onClosed_()}}start(){}static forceDisallow(){Dn.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&wc!==null&&!Dn.forceDisallow_}static previouslyFailed(){return vs.isInMemoryStorage||vs.get("previous_websocket_failure")===!0}markConnectionHealthy(){vs.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const n=_o(e);this.onMessage(n)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(K(this.frames===null,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(e);else{const n=this.extractFrameCount_(e);n!==null&&this.appendFrame_(n)}}send(t){this.resetKeepAlive();const e=Ee(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=Wv(e,vx);n.length>1&&this.sendString_(String(n.length));for(let a=0;a<n.length;a++)this.sendString_(n[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Ax))}sendString_(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Dn.responsesRequiredToBeHealthy=2;Dn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{static get ALL_TRANSPORTS(){return[Da,Dn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=Dn&&Dn.isAvailable();let n=e&&!Dn.previouslyFailed();if(t.webSocketOnly&&(e||Qe("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Dn];else{const a=this.transports_=[];for(const o of vo.ALL_TRANSPORTS)o&&o.isAvailable()&&a.push(o);vo.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}vo.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sx=6e4,Ex=5e3,wx=10*1024,Cx=100*1024,Bd="t",yb="d",Tx="s",bb="r",xx="e",vb="o",Ab="a",Sb="n",Eb="p",Rx="h";let Dx=class{constructor(t,e,n,a,o,c,h,d,f,g){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=a,this.authToken_=o,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=d,this.onKill_=f,this.lastSessionId=g,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Io("c:"+this.id+":"),this.transportManager_=new vo(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,n)},Math.floor(0));const a=t.healthyTimeout||0;a>0&&(this.healthyTimeout_=lo(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Cx?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>wx?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(a)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(Bd in t){const e=t[Bd];e===Ab?this.upgradeIfSecondaryHealthy_():e===bb?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===vb&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=Zr("t",t),n=Zr("d",t);if(e==="c")this.onSecondaryControl_(n);else if(e==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Eb,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ab,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Sb,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=Zr("t",t),n=Zr("d",t);e==="c"?this.onControl_(n):e==="d"&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=Zr(Bd,t);if(yb in t){const n=t[yb];if(e===Rx){const a={...n};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if(e===Sb){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===Tx?this.onConnectionShutdown_(n):e===bb?this.onReset_(n):e===xx?hf("Server Error: "+n):e===vb?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):hf("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,a=t.h;this.sessionId=t.s,this.repoInfo_.host=a,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),Yf!==n&&Qe("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),lo(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Sx))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):lo(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Ex))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Eb,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(vs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{put(t,e,n,a){}merge(t,e,n,a){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(t){this.allowedEvents_=t,this.listeners_={},K(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let a=0;a<n.length;a++)n[a].callback.apply(n[a].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const a=this.getInitialEvent(t);a&&e.apply(n,a)}off(t,e,n){this.validateEventType_(t);const a=this.listeners_[t]||[];for(let o=0;o<a.length;o++)if(a[o].callback===e&&(!n||n===a[o].context)){a.splice(o,1);return}}validateEventType_(t){K(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc extends p0{static getInstance(){return new Cc}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Pv()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return K(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wb=32,Cb=768;class Vt{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let n=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[n]=this.pieces_[a],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}}function It(){return new Vt("")}function wt(r){return r.pieceNum_>=r.pieces_.length?null:r.pieces_[r.pieceNum_]}function Wi(r){return r.pieces_.length-r.pieceNum_}function Xt(r){let t=r.pieceNum_;return t<r.pieces_.length&&t++,new Vt(r.pieces_,t)}function g0(r){return r.pieceNum_<r.pieces_.length?r.pieces_[r.pieces_.length-1]:null}function Mx(r){let t="";for(let e=r.pieceNum_;e<r.pieces_.length;e++)r.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(r.pieces_[e])));return t||"/"}function m0(r,t=0){return r.pieces_.slice(r.pieceNum_+t)}function _0(r){if(r.pieceNum_>=r.pieces_.length)return null;const t=[];for(let e=r.pieceNum_;e<r.pieces_.length-1;e++)t.push(r.pieces_[e]);return new Vt(t,0)}function ge(r,t){const e=[];for(let n=r.pieceNum_;n<r.pieces_.length;n++)e.push(r.pieces_[n]);if(t instanceof Vt)for(let n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{const n=t.split("/");for(let a=0;a<n.length;a++)n[a].length>0&&e.push(n[a])}return new Vt(e,0)}function Dt(r){return r.pieceNum_>=r.pieces_.length}function We(r,t){const e=wt(r),n=wt(t);if(e===null)return t;if(e===n)return We(Xt(r),Xt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+r+")")}function Wf(r,t){if(Wi(r)!==Wi(t))return!1;for(let e=r.pieceNum_,n=t.pieceNum_;e<=r.pieces_.length;e++,n++)if(r.pieces_[e]!==t.pieces_[n])return!1;return!0}function Mn(r,t){let e=r.pieceNum_,n=t.pieceNum_;if(Wi(r)>Wi(t))return!1;for(;e<r.pieces_.length;){if(r.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0}class Nx{constructor(t,e){this.errorPrefix_=e,this.parts_=m0(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=$c(this.parts_[n]);y0(this)}}function Ox(r,t){r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=$c(t),y0(r)}function kx(r){const t=r.parts_.pop();r.byteLength_-=$c(t),r.parts_.length>0&&(r.byteLength_-=1)}function y0(r){if(r.byteLength_>Cb)throw new Error(r.errorPrefix_+"has a key path longer than "+Cb+" bytes ("+r.byteLength_+").");if(r.parts_.length>wb)throw new Error(r.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+wb+") or object contains a cycle "+ys(r))}function ys(r){return r.parts_.length===0?"":"in property '"+r.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf extends p0{static getInstance(){return new Kf}constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const n=!document[t];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}getInitialEvent(t){return K(t==="visible","Unknown event type: "+t),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jr=1e3,Lx=300*1e3,Tb=30*1e3,Ix=1.3,Px=3e4,Bx="server_kill",xb=3;class di extends f0{constructor(t,e,n,a,o,c,h,d){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=a,this.onServerInfoUpdate_=o,this.authTokenProvider_=c,this.appCheckTokenProvider_=h,this.authOverride_=d,this.id=di.nextPersistentConnectionId_++,this.log_=Io("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Jr,this.maxReconnectDelay_=Lx,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Kf.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Cc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,n){const a=++this.requestNumber_,o={r:a,a:t,b:e};this.log_(Ee(o)),K(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[a]=n)}get(t){this.initConnection_();const e=new Xc,a={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:c=>{const h=c.d;c.s==="ok"?e.resolve(h):e.reject(h)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),e.promise}listen(t,e,n,a){this.initConnection_();const o=t._queryIdentifier,c=t._path.toString();this.log_("Listen called for "+c+" "+o),this.listens.has(c)||this.listens.set(c,new Map),K(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),K(!this.listens.get(c).has(o),"listen() called twice for same path/queryId.");const h={onComplete:a,hashFn:e,query:t,tag:n};this.listens.get(c).set(o,h),this.connected_&&this.sendListen_(h)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)})}sendListen_(t){const e=t.query,n=e._path.toString(),a=e._queryIdentifier;this.log_("Listen on "+n+" for "+a);const o={p:n},c="q";t.tag&&(o.q=e._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(c,o,h=>{const d=h.d,f=h.s;di.warnOnListenWarnings_(d,e),(this.listens.get(n)&&this.listens.get(n).get(a))===t&&(this.log_("listen response",h),f!=="ok"&&this.removeListen_(n,a),t.onComplete&&t.onComplete(f,d))})}static warnOnListenWarnings_(t,e){if(t&&typeof t=="object"&&mi(t,"w")){const n=Fa(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const a='".indexOn": "'+e._queryParams.getIndex().toString()+'"',o=e._path.toString();Qe(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||EC(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Tb)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=SC(t)?"auth":"gauth",n={cred:t};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(e,n,a=>{const o=a.s,c=a.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,c))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const e=t.s,n=t.d||"error";e==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)})}unlisten(t,e){const n=t._path.toString(),a=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+a),K(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,a)&&this.connected_&&this.sendUnlisten_(n,a,t._queryObject,e)}sendUnlisten_(t,e,n,a){this.log_("Unlisten on "+t+" for "+e);const o={p:t},c="n";a&&(o.q=n,o.t=a),this.sendRequest(c,o)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,a){const o={p:e,d:n};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,c=>{a&&setTimeout(()=>{a(c.s,c.d)},Math.floor(0))})}put(t,e,n,a){this.putInternal("p",t,e,n,a)}merge(t,e,n,a){this.putInternal("m",t,e,n,a)}putInternal(t,e,n,a,o){this.initConnection_();const c={p:e,d:n};o!==void 0&&(c.h=o),this.outstandingPuts_.push({action:t,request:c,onComplete:a}),this.outstandingPutCount_++;const h=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(h):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,a=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,o=>{this.log_(e+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),a&&a(o.s,o.d)})}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,n=>{if(n.s!=="ok"){const o=n.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ee(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),t==="d"?this.onDataUpdate_(e.p,e.d,!1,e.t):t==="m"?this.onDataUpdate_(e.p,e.d,!0,e.t):t==="c"?this.onListenRevoked_(e.p,e.q):t==="ac"?this.onAuthRevoked_(e.s,e.d):t==="apc"?this.onAppCheckRevoked_(e.s,e.d):t==="sd"?this.onSecurityDebugPacket_(e):hf("Unrecognized action received from server: "+Ee(t)+`
Are you using the latest client?`)}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){K(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Jr,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Jr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Px&&(this.reconnectDelay_=Jr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ix)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),a=this.id+":"+di.nextConnectionId_++,o=this.lastSessionId;let c=!1,h=null;const d=function(){h?h.close():(c=!0,n())},f=function(_){K(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(_)};this.realtime_={close:d,sendRequest:f};const g=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[_,y]=await Promise.all([this.authTokenProvider_.getToken(g),this.appCheckTokenProvider_.getToken(g)]);c?Ie("getToken() completed but was canceled"):(Ie("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=y&&y.token,h=new Dx(a,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,n,b=>{Qe(b+" ("+this.repoInfo_.toString()+")"),this.interrupt(Bx)},o))}catch(_){this.log_("Failed to get token: "+_),c||(this.repoInfo_.nodeAdmin&&Qe(_),d())}}}interrupt(t){Ie("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ie("Resuming connection for reason: "+t),delete this.interruptReasons_[t],nb(this.interruptReasons_)&&(this.reconnectDelay_=Jr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;e?n=e.map(o=>qf(o)).join("$"):n="default";const a=this.removeListen_(t,n);a&&a.onComplete&&a.onComplete("permission_denied")}removeListen_(t,e){const n=new Vt(t).toString();let a;if(this.listens.has(n)){const o=this.listens.get(n);a=o.get(e),o.delete(e),o.size===0&&this.listens.delete(n)}else a=void 0;return a}onAuthRevoked_(t,e){Ie("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=xb&&(this.reconnectDelay_=Tb,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Ie("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=xb&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";t["sdk."+e+"."+qv.replace(/\./g,"-")]=1,Pv()?t["framework.cordova"]=1:gC()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Cc.getInstance().currentlyOnline();return nb(this.interruptReasons_)&&t}}di.nextPersistentConnectionId_=0;di.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new Ct(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new Ct(Ha,t),a=new Ct(Ha,e);return this.compare(n,a)!==0}minPost(){return Ct.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oc;class b0 extends Wc{static get __EMPTY_NODE(){return oc}static set __EMPTY_NODE(t){oc=t}compare(t,e){return Va(t.name,e.name)}isDefinedOn(t){throw Ga("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return Ct.MIN}maxPost(){return new Ct(Rs,oc)}makePost(t,e){return K(typeof t=="string","KeyIndex indexValue must always be a string."),new Ct(t,oc)}toString(){return".key"}}const La=new b0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(t,e,n,a,o=null){this.isReverse_=a,this.resultGenerator_=o,this.nodeStack_=[];let c=1;for(;!t.isEmpty();)if(t=t,c=e?n(t.key,e):1,a&&(c*=-1),c<0)this.isReverse_?t=t.left:t=t.right;else if(c===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class Se{constructor(t,e,n,a,o){this.key=t,this.value=e,this.color=n??Se.RED,this.left=a??Ke.EMPTY_NODE,this.right=o??Ke.EMPTY_NODE}copy(t,e,n,a,o){return new Se(t??this.key,e??this.value,n??this.color,a??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let a=this;const o=n(t,a.key);return o<0?a=a.copy(null,null,null,a.left.insert(t,e,n),null):o===0?a=a.copy(null,e,null,null,null):a=a.copy(null,null,null,null,a.right.insert(t,e,n)),a.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ke.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,a;if(n=this,e(t,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),e(t,n.key)===0){if(n.right.isEmpty())return Ke.EMPTY_NODE;a=n.right.min_(),n=n.copy(a.key,a.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,Se.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,Se.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}Se.RED=!0;Se.BLACK=!1;class Fx{copy(t,e,n,a,o){return this}insert(t,e,n){return new Se(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ke{constructor(t,e=Ke.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new Ke(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Se.BLACK,null,null))}remove(t){return new Ke(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Se.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),e===0)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,a=null;for(;!n.isEmpty();)if(e=this.comparator_(t,n.key),e===0){if(n.left.isEmpty())return a?a.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else e<0?n=n.left:e>0&&(a=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new lc(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new lc(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new lc(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new lc(this.root_,null,this.comparator_,!0,t)}}Ke.EMPTY_NODE=new Fx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(r,t){return Va(r.name,t.name)}function Qf(r,t){return Va(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ff;function zx(r){ff=r}const v0=function(r){return typeof r=="number"?"number:"+Kv(r):"string:"+r},A0=function(r){if(r.isLeafNode()){const t=r.val();K(typeof t=="string"||typeof t=="number"||typeof t=="object"&&mi(t,".sv"),"Priority must be a string or number.")}else K(r===ff||r.isEmpty(),"priority of unexpected type.");K(r===ff||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rb;class Ae{static set __childrenNodeConstructor(t){Rb=t}static get __childrenNodeConstructor(){return Rb}constructor(t,e=Ae.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,K(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),A0(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Ae(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:Ae.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Dt(t)?this:wt(t)===".priority"?this.priorityNode_:Ae.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return t===".priority"?this.updatePriority(e):e.isEmpty()&&t!==".priority"?this:Ae.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const n=wt(t);return n===null?e:e.isEmpty()&&n!==".priority"?this:(K(n!==".priority"||Wi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,Ae.__childrenNodeConstructor.EMPTY_NODE.updateChild(Xt(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+v0(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",e==="number"?t+=Kv(this.value_):t+=this.value_,this.lazyHash_=Xv(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Ae.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Ae.__childrenNodeConstructor?-1:(K(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,n=typeof this.value_,a=Ae.VALUE_TYPE_ORDER.indexOf(e),o=Ae.VALUE_TYPE_ORDER.indexOf(n);return K(a>=0,"Unknown leaf type: "+e),K(o>=0,"Unknown leaf type: "+n),a===o?n==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-a}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}else return!1}}Ae.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S0,E0;function Ux(r){S0=r}function Gx(r){E0=r}class jx extends Wc{compare(t,e){const n=t.node.getPriority(),a=e.node.getPriority(),o=n.compareTo(a);return o===0?Va(t.name,e.name):o}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return Ct.MIN}maxPost(){return new Ct(Rs,new Ae("[PRIORITY-POST]",E0))}makePost(t,e){const n=S0(t);return new Ct(e,new Ae("[PRIORITY-POST]",n))}toString(){return".priority"}}const ne=new jx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vx=Math.log(2);class qx{constructor(t){const e=o=>parseInt(Math.log(o)/Vx,10),n=o=>parseInt(Array(o+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const a=n(this.count);this.bits_=t+1&a}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Tc=function(r,t,e,n){r.sort(t);const a=function(d,f){const g=f-d;let _,y;if(g===0)return null;if(g===1)return _=r[d],y=e?e(_):_,new Se(y,_.node,Se.BLACK,null,null);{const b=parseInt(g/2,10)+d,A=a(d,b),S=a(b+1,f);return _=r[b],y=e?e(_):_,new Se(y,_.node,Se.BLACK,A,S)}},o=function(d){let f=null,g=null,_=r.length;const y=function(A,S){const C=_-A,w=_;_-=A;const M=a(C+1,w),T=r[C],N=e?e(T):T;b(new Se(N,T.node,S,null,M))},b=function(A){f?(f.left=A,f=A):(g=A,f=A)};for(let A=0;A<d.count;++A){const S=d.nextBitIsOne(),C=Math.pow(2,d.count-(A+1));S?y(C,Se.BLACK):(y(C,Se.BLACK),y(C,Se.RED))}return g},c=new qx(r.length),h=o(c);return new Ke(n||t,h)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fd;const Sa={};class hi{static get Default(){return K(Sa&&ne,"ChildrenNode.ts has not been loaded"),Fd=Fd||new hi({".priority":Sa},{".priority":ne}),Fd}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=Fa(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Ke?e:null}hasIndex(t){return mi(this.indexSet_,t.toString())}addIndex(t,e){K(t!==La,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let a=!1;const o=e.getIterator(Ct.Wrap);let c=o.getNext();for(;c;)a=a||t.isDefinedOn(c.node),n.push(c),c=o.getNext();let h;a?h=Tc(n,t.getCompare()):h=Sa;const d=t.toString(),f={...this.indexSet_};f[d]=t;const g={...this.indexes_};return g[d]=h,new hi(g,f)}addToIndexes(t,e){const n=vc(this.indexes_,(a,o)=>{const c=Fa(this.indexSet_,o);if(K(c,"Missing index implementation for "+o),a===Sa)if(c.isDefinedOn(t.node)){const h=[],d=e.getIterator(Ct.Wrap);let f=d.getNext();for(;f;)f.name!==t.name&&h.push(f),f=d.getNext();return h.push(t),Tc(h,c.getCompare())}else return Sa;else{const h=e.get(t.name);let d=a;return h&&(d=d.remove(new Ct(t.name,h))),d.insert(t,t.node)}});return new hi(n,this.indexSet_)}removeFromIndexes(t,e){const n=vc(this.indexes_,a=>{if(a===Sa)return a;{const o=e.get(t.name);return o?a.remove(new Ct(t.name,o)):a}});return new hi(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let to;class dt{static get EMPTY_NODE(){return to||(to=new dt(new Ke(Qf),null,hi.Default))}constructor(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&A0(this.priorityNode_),this.children_.isEmpty()&&K(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||to}updatePriority(t){return this.children_.isEmpty()?this:new dt(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{const e=this.children_.get(t);return e===null?to:e}}getChild(t){const e=wt(t);return e===null?this:this.getImmediateChild(e).getChild(Xt(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,e){if(K(e,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(e);{const n=new Ct(t,e);let a,o;e.isEmpty()?(a=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(n,this.children_)):(a=this.children_.insert(t,e),o=this.indexMap_.addToIndexes(n,this.children_));const c=a.isEmpty()?to:this.priorityNode_;return new dt(a,c,o)}}updateChild(t,e){const n=wt(t);if(n===null)return e;{K(wt(t)!==".priority"||Wi(t)===1,".priority must be the last token in a path");const a=this.getImmediateChild(n).updateChild(Xt(t),e);return this.updateImmediateChild(n,a)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,a=0,o=!0;if(this.forEachChild(ne,(c,h)=>{e[c]=h.val(t),n++,o&&dt.INTEGER_REGEXP_.test(c)?a=Math.max(a,Number(c)):o=!1}),!t&&o&&a<2*n){const c=[];for(const h in e)c[h]=e[h];return c}else return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+v0(this.getPriority().val())+":"),this.forEachChild(ne,(e,n)=>{const a=n.hash();a!==""&&(t+=":"+e+":"+a)}),this.lazyHash_=t===""?"":Xv(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const a=this.resolveIndex_(n);if(a){const o=a.getPredecessorKey(new Ct(t,e));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const n=e.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new Ct(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const n=e.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new Ct(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal(a=>e(a.name,a.node)):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,a=>a);{const a=this.children_.getIteratorFrom(t.name,Ct.Wrap);let o=a.peek();for(;o!=null&&e.compare(o,t)<0;)a.getNext(),o=a.peek();return a}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,a=>a);{const a=this.children_.getReverseIteratorFrom(t.name,Ct.Wrap);let o=a.peek();for(;o!=null&&e.compare(o,t)>0;)a.getNext(),o=a.peek();return a}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Po?-1:0}withIndex(t){if(t===La||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new dt(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===La||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority()))if(this.children_.count()===e.children_.count()){const n=this.getIterator(ne),a=e.getIterator(ne);let o=n.getNext(),c=a.getNext();for(;o&&c;){if(o.name!==c.name||!o.node.equals(c.node))return!1;o=n.getNext(),c=a.getNext()}return o===null&&c===null}else return!1;else return!1}}resolveIndex_(t){return t===La?null:this.indexMap_.get(t.toString())}}dt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Yx extends dt{constructor(){super(new Ke(Qf),dt.EMPTY_NODE,hi.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return dt.EMPTY_NODE}isEmpty(){return!1}}const Po=new Yx;Object.defineProperties(Ct,{MIN:{value:new Ct(Ha,dt.EMPTY_NODE)},MAX:{value:new Ct(Rs,Po)}});b0.__EMPTY_NODE=dt.EMPTY_NODE;Ae.__childrenNodeConstructor=dt;zx(Po);Gx(Po);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xx=!0;function Me(r,t=null){if(r===null)return dt.EMPTY_NODE;if(typeof r=="object"&&".priority"in r&&(t=r[".priority"]),K(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof r=="object"&&".value"in r&&r[".value"]!==null&&(r=r[".value"]),typeof r!="object"||".sv"in r){const e=r;return new Ae(e,Me(t))}if(!(r instanceof Array)&&Xx){const e=[];let n=!1;if(Ze(r,(c,h)=>{if(c.substring(0,1)!=="."){const d=Me(h);d.isEmpty()||(n=n||!d.getPriority().isEmpty(),e.push(new Ct(c,d)))}}),e.length===0)return dt.EMPTY_NODE;const o=Tc(e,Hx,c=>c.name,Qf);if(n){const c=Tc(e,ne.getCompare());return new dt(o,Me(t),new hi({".priority":c},{".priority":ne}))}else return new dt(o,Me(t),hi.Default)}else{let e=dt.EMPTY_NODE;return Ze(r,(n,a)=>{if(mi(r,n)&&n.substring(0,1)!=="."){const o=Me(a);(o.isLeafNode()||!o.isEmpty())&&(e=e.updateImmediateChild(n,o))}}),e.updatePriority(Me(t))}}Ux(Me);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x extends Wc{constructor(t){super(),this.indexPath_=t,K(!Dt(t)&&wt(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),a=this.extractChild(e.node),o=n.compareTo(a);return o===0?Va(t.name,e.name):o}makePost(t,e){const n=Me(t),a=dt.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ct(e,a)}maxPost(){const t=dt.EMPTY_NODE.updateChild(this.indexPath_,Po);return new Ct(Rs,t)}toString(){return m0(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx extends Wc{compare(t,e){const n=t.node.compareTo(e.node);return n===0?Va(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return Ct.MIN}maxPost(){return Ct.MAX}makePost(t,e){const n=Me(t);return new Ct(e,n)}toString(){return".value"}}const Kx=new Wx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w0(r){return{type:"value",snapshotNode:r}}function za(r,t){return{type:"child_added",snapshotNode:t,childName:r}}function Ao(r,t){return{type:"child_removed",snapshotNode:t,childName:r}}function So(r,t,e){return{type:"child_changed",snapshotNode:t,childName:r,oldSnap:e}}function Qx(r,t){return{type:"child_moved",snapshotNode:t,childName:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(t){this.index_=t}updateChild(t,e,n,a,o,c){K(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=t.getImmediateChild(e);return h.getChild(a).equals(n.getChild(a))&&h.isEmpty()===n.isEmpty()||(c!=null&&(n.isEmpty()?t.hasChild(e)?c.trackChildChange(Ao(e,h)):K(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(za(e,n)):c.trackChildChange(So(e,n,h))),t.isLeafNode()&&n.isEmpty())?t:t.updateImmediateChild(e,n).withIndex(this.index_)}updateFullNode(t,e,n){return n!=null&&(t.isLeafNode()||t.forEachChild(ne,(a,o)=>{e.hasChild(a)||n.trackChildChange(Ao(a,o))}),e.isLeafNode()||e.forEachChild(ne,(a,o)=>{if(t.hasChild(a)){const c=t.getImmediateChild(a);c.equals(o)||n.trackChildChange(So(a,o,c))}else n.trackChildChange(za(a,o))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?dt.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(t){this.indexedFilter_=new Zf(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Eo.getStartPost_(t),this.endPost_=Eo.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,n=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&n}updateChild(t,e,n,a,o,c){return this.matches(new Ct(e,n))||(n=dt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,a,o,c)}updateFullNode(t,e,n){e.isLeafNode()&&(e=dt.EMPTY_NODE);let a=e.withIndex(this.index_);a=a.updatePriority(dt.EMPTY_NODE);const o=this;return e.forEachChild(ne,(c,h)=>{o.matches(new Ct(c,h))||(a=a.updateImmediateChild(c,dt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,a,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}else return t.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zx{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=e=>{const n=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new Eo(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,n,a,o,c){return this.rangedFilter_.matches(new Ct(e,n))||(n=dt.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,a,o,c):this.fullLimitUpdateChild_(t,e,n,o,c)}updateFullNode(t,e,n){let a;if(e.isLeafNode()||e.isEmpty())a=dt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<e.numChildren()&&e.isIndexed(this.index_)){a=dt.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;o.hasNext()&&c<this.limit_;){const h=o.getNext();if(this.withinDirectionalStart(h))if(this.withinDirectionalEnd(h))a=a.updateImmediateChild(h.name,h.node),c++;else break;else continue}}else{a=e.withIndex(this.index_),a=a.updatePriority(dt.EMPTY_NODE);let o;this.reverse_?o=a.getReverseIterator(this.index_):o=a.getIterator(this.index_);let c=0;for(;o.hasNext();){const h=o.getNext();c<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?c++:a=a.updateImmediateChild(h.name,dt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,a,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,n,a,o){let c;if(this.reverse_){const _=this.index_.getCompare();c=(y,b)=>_(b,y)}else c=this.index_.getCompare();const h=t;K(h.numChildren()===this.limit_,"");const d=new Ct(e,n),f=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),g=this.rangedFilter_.matches(d);if(h.hasChild(e)){const _=h.getImmediateChild(e);let y=a.getChildAfterChild(this.index_,f,this.reverse_);for(;y!=null&&(y.name===e||h.hasChild(y.name));)y=a.getChildAfterChild(this.index_,y,this.reverse_);const b=y==null?1:c(y,d);if(g&&!n.isEmpty()&&b>=0)return o?.trackChildChange(So(e,n,_)),h.updateImmediateChild(e,n);{o?.trackChildChange(Ao(e,_));const S=h.updateImmediateChild(e,dt.EMPTY_NODE);return y!=null&&this.rangedFilter_.matches(y)?(o?.trackChildChange(za(y.name,y.node)),S.updateImmediateChild(y.name,y.node)):S}}else return n.isEmpty()?t:g&&c(f,d)>=0?(o!=null&&(o.trackChildChange(Ao(f.name,f.node)),o.trackChildChange(za(e,n))),h.updateImmediateChild(e,n).updateImmediateChild(f.name,dt.EMPTY_NODE)):t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ne}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return K(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return K(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ha}hasEnd(){return this.endSet_}getIndexEndValue(){return K(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return K(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Rs}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return K(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ne}copy(){const t=new Jf;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Jx(r){return r.loadsAllData()?new Zf(r.getIndex()):r.hasLimit()?new Zx(r):new Eo(r)}function Db(r){const t={};if(r.isDefault())return t;let e;if(r.index_===ne?e="$priority":r.index_===Kx?e="$value":r.index_===La?e="$key":(K(r.index_ instanceof $x,"Unrecognized index type!"),e=r.index_.toString()),t.orderBy=Ee(e),r.startSet_){const n=r.startAfterSet_?"startAfter":"startAt";t[n]=Ee(r.indexStartValue_),r.startNameSet_&&(t[n]+=","+Ee(r.indexStartName_))}if(r.endSet_){const n=r.endBeforeSet_?"endBefore":"endAt";t[n]=Ee(r.indexEndValue_),r.endNameSet_&&(t[n]+=","+Ee(r.indexEndName_))}return r.limitSet_&&(r.isViewFromLeft()?t.limitToFirst=r.limit_:t.limitToLast=r.limit_),t}function Mb(r){const t={};if(r.startSet_&&(t.sp=r.indexStartValue_,r.startNameSet_&&(t.sn=r.indexStartName_),t.sin=!r.startAfterSet_),r.endSet_&&(t.ep=r.indexEndValue_,r.endNameSet_&&(t.en=r.indexEndName_),t.ein=!r.endBeforeSet_),r.limitSet_){t.l=r.limit_;let e=r.viewFrom_;e===""&&(r.isViewFromLeft()?e="l":e="r"),t.vf=e}return r.index_!==ne&&(t.i=r.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends f0{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(K(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,n,a){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=a,this.log_=Io("p:rest:"),this.listens_={}}listen(t,e,n,a){const o=t._path.toString();this.log_("Listen called for "+o+" "+t._queryIdentifier);const c=xc.getListenId_(t,n),h={};this.listens_[c]=h;const d=Db(t._queryParams);this.restRequest_(o+".json",d,(f,g)=>{let _=g;if(f===404&&(_=null,f=null),f===null&&this.onDataUpdate_(o,_,!1,n),Fa(this.listens_,c)===h){let y;f?f===401?y="permission_denied":y="rest_error:"+f:y="ok",a(y,null)}})}unlisten(t,e){const n=xc.getListenId_(t,e);delete this.listens_[n]}get(t){const e=Db(t._queryParams),n=t._path.toString(),a=new Xc;return this.restRequest_(n+".json",e,(o,c)=>{let h=c;o===404&&(h=null,o=null),o===null?(this.onDataUpdate_(n,h,!1,null),a.resolve(h)):a.reject(new Error(h))}),a.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([a,o])=>{a&&a.accessToken&&(e.auth=a.accessToken),o&&o.token&&(e.ac=o.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+wC(e);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(n&&h.readyState===4){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let d=null;if(h.status>=200&&h.status<300){try{d=_o(h.responseText)}catch{Qe("Failed to parse JSON response for "+c+": "+h.responseText)}n(null,d)}else h.status!==401&&h.status!==404&&Qe("Got unsuccessful REST response for "+c+" Status: "+h.status),n(h.status);n=null}},h.open("GET",c,!0),h.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(){this.rootNode_=dt.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(){return{value:null,children:new Map}}function C0(r,t,e){if(Dt(t))r.value=e,r.children.clear();else if(r.value!==null)r.value=r.value.updateChild(t,e);else{const n=wt(t);r.children.has(n)||r.children.set(n,Rc());const a=r.children.get(n);t=Xt(t),C0(a,t,e)}}function pf(r,t,e){r.value!==null?e(t,r.value):eR(r,(n,a)=>{const o=new Vt(t.toString()+"/"+n);pf(a,o,e)})}function eR(r,t){r.children.forEach((e,n)=>{t(n,e)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e={...t};return this.last_&&Ze(this.last_,(n,a)=>{e[n]=e[n]-a}),this.last_=t,e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nb=10*1e3,iR=30*1e3,sR=300*1e3;class aR{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new nR(t);const n=Nb+(iR-Nb)*Math.random();lo(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;Ze(t,(a,o)=>{o>0&&mi(this.statsToReport_,a)&&(e[a]=o,n=!0)}),n&&this.server_.reportStats(e),lo(this.reportStats_.bind(this),Math.floor(Math.random()*2*sR))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nn;(function(r){r[r.OVERWRITE=0]="OVERWRITE",r[r.MERGE=1]="MERGE",r[r.ACK_USER_WRITE=2]="ACK_USER_WRITE",r[r.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Nn||(Nn={}));function T0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ep(r){return{fromUser:!1,fromServer:!0,queryId:r,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Nn.ACK_USER_WRITE,this.source=T0()}operationForChild(t){if(Dt(this.path)){if(this.affectedTree.value!=null)return K(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Vt(t));return new Dc(It(),e,this.revert)}}else return K(wt(this.path)===t,"operationForChild called for unrelated child."),new Dc(Xt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(t,e){this.source=t,this.path=e,this.type=Nn.LISTEN_COMPLETE}operationForChild(t){return Dt(this.path)?new wo(this.source,It()):new wo(this.source,Xt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Nn.OVERWRITE}operationForChild(t){return Dt(this.path)?new Ds(this.source,It(),this.snap.getImmediateChild(t)):new Ds(this.source,Xt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Nn.MERGE}operationForChild(t){if(Dt(this.path)){const e=this.children.subtree(new Vt(t));return e.isEmpty()?null:e.value?new Ds(this.source,It(),e.value):new Co(this.source,It(),e)}else return K(wt(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new Co(this.source,Xt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(Dt(t))return this.isFullyInitialized()&&!this.filtered_;const e=wt(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function oR(r,t,e,n){const a=[],o=[];return t.forEach(c=>{c.type==="child_changed"&&r.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&o.push(Qx(c.childName,c.snapshotNode))}),eo(r,a,"child_removed",t,n,e),eo(r,a,"child_added",t,n,e),eo(r,a,"child_moved",o,n,e),eo(r,a,"child_changed",t,n,e),eo(r,a,"value",t,n,e),a}function eo(r,t,e,n,a,o){const c=n.filter(h=>h.type===e);c.sort((h,d)=>cR(r,h,d)),c.forEach(h=>{const d=lR(r,h,o);a.forEach(f=>{f.respondsTo(h.type)&&t.push(f.createEvent(d,r.query_))})})}function lR(r,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,r.index_)),t}function cR(r,t,e){if(t.childName==null||e.childName==null)throw Ga("Should only compare child_ events.");const n=new Ct(t.childName,t.snapshotNode),a=new Ct(e.childName,e.snapshotNode);return r.index_.compare(n,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(r,t){return{eventCache:r,serverCache:t}}function co(r,t,e,n){return Kc(new Ms(t,e,n),r.serverCache)}function x0(r,t,e,n){return Kc(r.eventCache,new Ms(t,e,n))}function gf(r){return r.eventCache.isFullyInitialized()?r.eventCache.getNode():null}function Ns(r){return r.serverCache.isFullyInitialized()?r.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hd;const uR=()=>(Hd||(Hd=new Ke(WT)),Hd);class $t{static fromObject(t){let e=new $t(null);return Ze(t,(n,a)=>{e=e.set(new Vt(n),a)}),e}constructor(t,e=uR()){this.value=t,this.children=e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:It(),value:this.value};if(Dt(t))return null;{const n=wt(t),a=this.children.get(n);if(a!==null){const o=a.findRootMostMatchingPathAndValue(Xt(t),e);return o!=null?{path:ge(new Vt(n),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(Dt(t))return this;{const e=wt(t),n=this.children.get(e);return n!==null?n.subtree(Xt(t)):new $t(null)}}set(t,e){if(Dt(t))return new $t(e,this.children);{const n=wt(t),o=(this.children.get(n)||new $t(null)).set(Xt(t),e),c=this.children.insert(n,o);return new $t(this.value,c)}}remove(t){if(Dt(t))return this.children.isEmpty()?new $t(null):new $t(null,this.children);{const e=wt(t),n=this.children.get(e);if(n){const a=n.remove(Xt(t));let o;return a.isEmpty()?o=this.children.remove(e):o=this.children.insert(e,a),this.value===null&&o.isEmpty()?new $t(null):new $t(this.value,o)}else return this}}get(t){if(Dt(t))return this.value;{const e=wt(t),n=this.children.get(e);return n?n.get(Xt(t)):null}}setTree(t,e){if(Dt(t))return e;{const n=wt(t),o=(this.children.get(n)||new $t(null)).setTree(Xt(t),e);let c;return o.isEmpty()?c=this.children.remove(n):c=this.children.insert(n,o),new $t(this.value,c)}}fold(t){return this.fold_(It(),t)}fold_(t,e){const n={};return this.children.inorderTraversal((a,o)=>{n[a]=o.fold_(ge(t,a),e)}),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,It(),e)}findOnPath_(t,e,n){const a=this.value?n(e,this.value):!1;if(a)return a;if(Dt(t))return null;{const o=wt(t),c=this.children.get(o);return c?c.findOnPath_(Xt(t),ge(e,o),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,It(),e)}foreachOnPath_(t,e,n){if(Dt(t))return this;{this.value&&n(e,this.value);const a=wt(t),o=this.children.get(a);return o?o.foreachOnPath_(Xt(t),ge(e,a),n):new $t(null)}}foreach(t){this.foreach_(It(),t)}foreach_(t,e){this.children.inorderTraversal((n,a)=>{a.foreach_(ge(t,n),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,n)=>{n.value&&t(e,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(t){this.writeTree_=t}static empty(){return new On(new $t(null))}}function uo(r,t,e){if(Dt(t))return new On(new $t(e));{const n=r.writeTree_.findRootMostValueAndPath(t);if(n!=null){const a=n.path;let o=n.value;const c=We(a,t);return o=o.updateChild(c,e),new On(r.writeTree_.set(a,o))}else{const a=new $t(e),o=r.writeTree_.setTree(t,a);return new On(o)}}}function Ob(r,t,e){let n=r;return Ze(e,(a,o)=>{n=uo(n,ge(t,a),o)}),n}function kb(r,t){if(Dt(t))return On.empty();{const e=r.writeTree_.setTree(t,new $t(null));return new On(e)}}function mf(r,t){return Ls(r,t)!=null}function Ls(r,t){const e=r.writeTree_.findRootMostValueAndPath(t);return e!=null?r.writeTree_.get(e.path).getChild(We(e.path,t)):null}function Lb(r){const t=[],e=r.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(ne,(n,a)=>{t.push(new Ct(n,a))}):r.writeTree_.children.inorderTraversal((n,a)=>{a.value!=null&&t.push(new Ct(n,a.value))}),t}function Yi(r,t){if(Dt(t))return r;{const e=Ls(r,t);return e!=null?new On(new $t(e)):new On(r.writeTree_.subtree(t))}}function _f(r){return r.writeTree_.isEmpty()}function Ua(r,t){return R0(It(),r.writeTree_,t)}function R0(r,t,e){if(t.value!=null)return e.updateChild(r,t.value);{let n=null;return t.children.inorderTraversal((a,o)=>{a===".priority"?(K(o.value!==null,"Priority writes must always be leaf nodes"),n=o.value):e=R0(ge(r,a),o,e)}),!e.getChild(r).isEmpty()&&n!==null&&(e=e.updateChild(ge(r,".priority"),n)),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function np(r,t){return O0(t,r)}function hR(r,t,e,n,a){K(n>r.lastWriteId,"Stacking an older write on top of newer ones"),a===void 0&&(a=!0),r.allWrites.push({path:t,snap:e,writeId:n,visible:a}),a&&(r.visibleWrites=uo(r.visibleWrites,t,e)),r.lastWriteId=n}function dR(r,t){for(let e=0;e<r.allWrites.length;e++){const n=r.allWrites[e];if(n.writeId===t)return n}return null}function fR(r,t){const e=r.allWrites.findIndex(h=>h.writeId===t);K(e>=0,"removeWrite called with nonexistent writeId.");const n=r.allWrites[e];r.allWrites.splice(e,1);let a=n.visible,o=!1,c=r.allWrites.length-1;for(;a&&c>=0;){const h=r.allWrites[c];h.visible&&(c>=e&&pR(h,n.path)?a=!1:Mn(n.path,h.path)&&(o=!0)),c--}if(a){if(o)return gR(r),!0;if(n.snap)r.visibleWrites=kb(r.visibleWrites,n.path);else{const h=n.children;Ze(h,d=>{r.visibleWrites=kb(r.visibleWrites,ge(n.path,d))})}return!0}else return!1}function pR(r,t){if(r.snap)return Mn(r.path,t);for(const e in r.children)if(r.children.hasOwnProperty(e)&&Mn(ge(r.path,e),t))return!0;return!1}function gR(r){r.visibleWrites=D0(r.allWrites,mR,It()),r.allWrites.length>0?r.lastWriteId=r.allWrites[r.allWrites.length-1].writeId:r.lastWriteId=-1}function mR(r){return r.visible}function D0(r,t,e){let n=On.empty();for(let a=0;a<r.length;++a){const o=r[a];if(t(o)){const c=o.path;let h;if(o.snap)Mn(e,c)?(h=We(e,c),n=uo(n,h,o.snap)):Mn(c,e)&&(h=We(c,e),n=uo(n,It(),o.snap.getChild(h)));else if(o.children){if(Mn(e,c))h=We(e,c),n=Ob(n,h,o.children);else if(Mn(c,e))if(h=We(c,e),Dt(h))n=Ob(n,It(),o.children);else{const d=Fa(o.children,wt(h));if(d){const f=d.getChild(Xt(h));n=uo(n,It(),f)}}}else throw Ga("WriteRecord should have .snap or .children")}}return n}function M0(r,t,e,n,a){if(!n&&!a){const o=Ls(r.visibleWrites,t);if(o!=null)return o;{const c=Yi(r.visibleWrites,t);if(_f(c))return e;if(e==null&&!mf(c,It()))return null;{const h=e||dt.EMPTY_NODE;return Ua(c,h)}}}else{const o=Yi(r.visibleWrites,t);if(!a&&_f(o))return e;if(!a&&e==null&&!mf(o,It()))return null;{const c=function(f){return(f.visible||a)&&(!n||!~n.indexOf(f.writeId))&&(Mn(f.path,t)||Mn(t,f.path))},h=D0(r.allWrites,c,t),d=e||dt.EMPTY_NODE;return Ua(h,d)}}}function _R(r,t,e){let n=dt.EMPTY_NODE;const a=Ls(r.visibleWrites,t);if(a)return a.isLeafNode()||a.forEachChild(ne,(o,c)=>{n=n.updateImmediateChild(o,c)}),n;if(e){const o=Yi(r.visibleWrites,t);return e.forEachChild(ne,(c,h)=>{const d=Ua(Yi(o,new Vt(c)),h);n=n.updateImmediateChild(c,d)}),Lb(o).forEach(c=>{n=n.updateImmediateChild(c.name,c.node)}),n}else{const o=Yi(r.visibleWrites,t);return Lb(o).forEach(c=>{n=n.updateImmediateChild(c.name,c.node)}),n}}function yR(r,t,e,n,a){K(n||a,"Either existingEventSnap or existingServerSnap must exist");const o=ge(t,e);if(mf(r.visibleWrites,o))return null;{const c=Yi(r.visibleWrites,o);return _f(c)?a.getChild(e):Ua(c,a.getChild(e))}}function bR(r,t,e,n){const a=ge(t,e),o=Ls(r.visibleWrites,a);if(o!=null)return o;if(n.isCompleteForChild(e)){const c=Yi(r.visibleWrites,a);return Ua(c,n.getNode().getImmediateChild(e))}else return null}function vR(r,t){return Ls(r.visibleWrites,t)}function AR(r,t,e,n,a,o,c){let h;const d=Yi(r.visibleWrites,t),f=Ls(d,It());if(f!=null)h=f;else if(e!=null)h=Ua(d,e);else return[];if(h=h.withIndex(c),!h.isEmpty()&&!h.isLeafNode()){const g=[],_=c.getCompare(),y=o?h.getReverseIteratorFrom(n,c):h.getIteratorFrom(n,c);let b=y.getNext();for(;b&&g.length<a;)_(b,n)!==0&&g.push(b),b=y.getNext();return g}else return[]}function SR(){return{visibleWrites:On.empty(),allWrites:[],lastWriteId:-1}}function Mc(r,t,e,n){return M0(r.writeTree,r.treePath,t,e,n)}function ip(r,t){return _R(r.writeTree,r.treePath,t)}function Ib(r,t,e,n){return yR(r.writeTree,r.treePath,t,e,n)}function Nc(r,t){return vR(r.writeTree,ge(r.treePath,t))}function ER(r,t,e,n,a,o){return AR(r.writeTree,r.treePath,t,e,n,a,o)}function sp(r,t,e){return bR(r.writeTree,r.treePath,t,e)}function N0(r,t){return O0(ge(r.treePath,t),r.writeTree)}function O0(r,t){return{treePath:r,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,n=t.childName;K(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),K(n!==".priority","Only non-priority child changes can be tracked.");const a=this.changeMap.get(n);if(a){const o=a.type;if(e==="child_added"&&o==="child_removed")this.changeMap.set(n,So(n,t.snapshotNode,a.snapshotNode));else if(e==="child_removed"&&o==="child_added")this.changeMap.delete(n);else if(e==="child_removed"&&o==="child_changed")this.changeMap.set(n,Ao(n,a.oldSnap));else if(e==="child_changed"&&o==="child_added")this.changeMap.set(n,za(n,t.snapshotNode));else if(e==="child_changed"&&o==="child_changed")this.changeMap.set(n,So(n,t.snapshotNode,a.oldSnap));else throw Ga("Illegal combination of changes: "+t+" occurred after "+a)}else this.changeMap.set(n,t)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}}const k0=new CR;class ap{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const n=this.optCompleteServerCache_!=null?new Ms(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return sp(this.writes_,t,n)}}getChildAfterChild(t,e,n){const a=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ns(this.viewCache_),o=ER(this.writes_,a,e,1,n,t);return o.length===0?null:o[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TR(r){return{filter:r}}function xR(r,t){K(t.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),K(t.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed")}function RR(r,t,e,n,a){const o=new wR;let c,h;if(e.type===Nn.OVERWRITE){const f=e;f.source.fromUser?c=yf(r,t,f.path,f.snap,n,a,o):(K(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered()&&!Dt(f.path),c=Oc(r,t,f.path,f.snap,n,a,h,o))}else if(e.type===Nn.MERGE){const f=e;f.source.fromUser?c=MR(r,t,f.path,f.children,n,a,o):(K(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered(),c=bf(r,t,f.path,f.children,n,a,h,o))}else if(e.type===Nn.ACK_USER_WRITE){const f=e;f.revert?c=kR(r,t,f.path,n,a,o):c=NR(r,t,f.path,f.affectedTree,n,a,o)}else if(e.type===Nn.LISTEN_COMPLETE)c=OR(r,t,e.path,n,o);else throw Ga("Unknown operation type: "+e.type);const d=o.getChanges();return DR(t,c,d),{viewCache:c,changes:d}}function DR(r,t,e){const n=t.eventCache;if(n.isFullyInitialized()){const a=n.getNode().isLeafNode()||n.getNode().isEmpty(),o=gf(r);(e.length>0||!r.eventCache.isFullyInitialized()||a&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&e.push(w0(gf(t)))}}function L0(r,t,e,n,a,o){const c=t.eventCache;if(Nc(n,e)!=null)return t;{let h,d;if(Dt(e))if(K(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const f=Ns(t),g=f instanceof dt?f:dt.EMPTY_NODE,_=ip(n,g);h=r.filter.updateFullNode(t.eventCache.getNode(),_,o)}else{const f=Mc(n,Ns(t));h=r.filter.updateFullNode(t.eventCache.getNode(),f,o)}else{const f=wt(e);if(f===".priority"){K(Wi(e)===1,"Can't have a priority with additional path components");const g=c.getNode();d=t.serverCache.getNode();const _=Ib(n,e,g,d);_!=null?h=r.filter.updatePriority(g,_):h=c.getNode()}else{const g=Xt(e);let _;if(c.isCompleteForChild(f)){d=t.serverCache.getNode();const y=Ib(n,e,c.getNode(),d);y!=null?_=c.getNode().getImmediateChild(f).updateChild(g,y):_=c.getNode().getImmediateChild(f)}else _=sp(n,f,t.serverCache);_!=null?h=r.filter.updateChild(c.getNode(),f,_,g,a,o):h=c.getNode()}}return co(t,h,c.isFullyInitialized()||Dt(e),r.filter.filtersNodes())}}function Oc(r,t,e,n,a,o,c,h){const d=t.serverCache;let f;const g=c?r.filter:r.filter.getIndexedFilter();if(Dt(e))f=g.updateFullNode(d.getNode(),n,null);else if(g.filtersNodes()&&!d.isFiltered()){const b=d.getNode().updateChild(e,n);f=g.updateFullNode(d.getNode(),b,null)}else{const b=wt(e);if(!d.isCompleteForPath(e)&&Wi(e)>1)return t;const A=Xt(e),C=d.getNode().getImmediateChild(b).updateChild(A,n);b===".priority"?f=g.updatePriority(d.getNode(),C):f=g.updateChild(d.getNode(),b,C,A,k0,null)}const _=x0(t,f,d.isFullyInitialized()||Dt(e),g.filtersNodes()),y=new ap(a,_,o);return L0(r,_,e,a,y,h)}function yf(r,t,e,n,a,o,c){const h=t.eventCache;let d,f;const g=new ap(a,t,o);if(Dt(e))f=r.filter.updateFullNode(t.eventCache.getNode(),n,c),d=co(t,f,!0,r.filter.filtersNodes());else{const _=wt(e);if(_===".priority")f=r.filter.updatePriority(t.eventCache.getNode(),n),d=co(t,f,h.isFullyInitialized(),h.isFiltered());else{const y=Xt(e),b=h.getNode().getImmediateChild(_);let A;if(Dt(y))A=n;else{const S=g.getCompleteChild(_);S!=null?g0(y)===".priority"&&S.getChild(_0(y)).isEmpty()?A=S:A=S.updateChild(y,n):A=dt.EMPTY_NODE}if(b.equals(A))d=t;else{const S=r.filter.updateChild(h.getNode(),_,A,y,g,c);d=co(t,S,h.isFullyInitialized(),r.filter.filtersNodes())}}}return d}function Pb(r,t){return r.eventCache.isCompleteForChild(t)}function MR(r,t,e,n,a,o,c){let h=t;return n.foreach((d,f)=>{const g=ge(e,d);Pb(t,wt(g))&&(h=yf(r,h,g,f,a,o,c))}),n.foreach((d,f)=>{const g=ge(e,d);Pb(t,wt(g))||(h=yf(r,h,g,f,a,o,c))}),h}function Bb(r,t,e){return e.foreach((n,a)=>{t=t.updateChild(n,a)}),t}function bf(r,t,e,n,a,o,c,h){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let d=t,f;Dt(e)?f=n:f=new $t(null).setTree(e,n);const g=t.serverCache.getNode();return f.children.inorderTraversal((_,y)=>{if(g.hasChild(_)){const b=t.serverCache.getNode().getImmediateChild(_),A=Bb(r,b,y);d=Oc(r,d,new Vt(_),A,a,o,c,h)}}),f.children.inorderTraversal((_,y)=>{const b=!t.serverCache.isCompleteForChild(_)&&y.value===null;if(!g.hasChild(_)&&!b){const A=t.serverCache.getNode().getImmediateChild(_),S=Bb(r,A,y);d=Oc(r,d,new Vt(_),S,a,o,c,h)}}),d}function NR(r,t,e,n,a,o,c){if(Nc(a,e)!=null)return t;const h=t.serverCache.isFiltered(),d=t.serverCache;if(n.value!=null){if(Dt(e)&&d.isFullyInitialized()||d.isCompleteForPath(e))return Oc(r,t,e,d.getNode().getChild(e),a,o,h,c);if(Dt(e)){let f=new $t(null);return d.getNode().forEachChild(La,(g,_)=>{f=f.set(new Vt(g),_)}),bf(r,t,e,f,a,o,h,c)}else return t}else{let f=new $t(null);return n.foreach((g,_)=>{const y=ge(e,g);d.isCompleteForPath(y)&&(f=f.set(g,d.getNode().getChild(y)))}),bf(r,t,e,f,a,o,h,c)}}function OR(r,t,e,n,a){const o=t.serverCache,c=x0(t,o.getNode(),o.isFullyInitialized()||Dt(e),o.isFiltered());return L0(r,c,e,n,k0,a)}function kR(r,t,e,n,a,o){let c;if(Nc(n,e)!=null)return t;{const h=new ap(n,t,a),d=t.eventCache.getNode();let f;if(Dt(e)||wt(e)===".priority"){let g;if(t.serverCache.isFullyInitialized())g=Mc(n,Ns(t));else{const _=t.serverCache.getNode();K(_ instanceof dt,"serverChildren would be complete if leaf node"),g=ip(n,_)}g=g,f=r.filter.updateFullNode(d,g,o)}else{const g=wt(e);let _=sp(n,g,t.serverCache);_==null&&t.serverCache.isCompleteForChild(g)&&(_=d.getImmediateChild(g)),_!=null?f=r.filter.updateChild(d,g,_,Xt(e),h,o):t.eventCache.getNode().hasChild(g)?f=r.filter.updateChild(d,g,dt.EMPTY_NODE,Xt(e),h,o):f=d,f.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=Mc(n,Ns(t)),c.isLeafNode()&&(f=r.filter.updateFullNode(f,c,o)))}return c=t.serverCache.isFullyInitialized()||Nc(n,It())!=null,co(t,f,c,r.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const n=this.query_._queryParams,a=new Zf(n.getIndex()),o=Jx(n);this.processor_=TR(o);const c=e.serverCache,h=e.eventCache,d=a.updateFullNode(dt.EMPTY_NODE,c.getNode(),null),f=o.updateFullNode(dt.EMPTY_NODE,h.getNode(),null),g=new Ms(d,c.isFullyInitialized(),a.filtersNodes()),_=new Ms(f,h.isFullyInitialized(),o.filtersNodes());this.viewCache_=Kc(_,g),this.eventGenerator_=new rR(this.query_)}get query(){return this.query_}}function IR(r){return r.viewCache_.serverCache.getNode()}function PR(r,t){const e=Ns(r.viewCache_);return e&&(r.query._queryParams.loadsAllData()||!Dt(t)&&!e.getImmediateChild(wt(t)).isEmpty())?e.getChild(t):null}function Fb(r){return r.eventRegistrations_.length===0}function BR(r,t){r.eventRegistrations_.push(t)}function Hb(r,t,e){const n=[];if(e){K(t==null,"A cancel should cancel all event registrations.");const a=r.query._path;r.eventRegistrations_.forEach(o=>{const c=o.createCancelEvent(e,a);c&&n.push(c)})}if(t){let a=[];for(let o=0;o<r.eventRegistrations_.length;++o){const c=r.eventRegistrations_[o];if(!c.matches(t))a.push(c);else if(t.hasAnyCallback()){a=a.concat(r.eventRegistrations_.slice(o+1));break}}r.eventRegistrations_=a}else r.eventRegistrations_=[];return n}function zb(r,t,e,n){t.type===Nn.MERGE&&t.source.queryId!==null&&(K(Ns(r.viewCache_),"We should always have a full cache before handling merges"),K(gf(r.viewCache_),"Missing event cache, even though we have a server cache"));const a=r.viewCache_,o=RR(r.processor_,a,t,e,n);return xR(r.processor_,o.viewCache),K(o.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),r.viewCache_=o.viewCache,I0(r,o.changes,o.viewCache.eventCache.getNode(),null)}function FR(r,t){const e=r.viewCache_.eventCache,n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(ne,(o,c)=>{n.push(za(o,c))}),e.isFullyInitialized()&&n.push(w0(e.getNode())),I0(r,n,e.getNode(),t)}function I0(r,t,e,n){const a=n?[n]:r.eventRegistrations_;return oR(r.eventGenerator_,t,e,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kc;class HR{constructor(){this.views=new Map}}function zR(r){K(!kc,"__referenceConstructor has already been defined"),kc=r}function UR(){return K(kc,"Reference.ts has not been loaded"),kc}function GR(r){return r.views.size===0}function rp(r,t,e,n){const a=t.source.queryId;if(a!==null){const o=r.views.get(a);return K(o!=null,"SyncTree gave us an op for an invalid query."),zb(o,t,e,n)}else{let o=[];for(const c of r.views.values())o=o.concat(zb(c,t,e,n));return o}}function jR(r,t,e,n,a){const o=t._queryIdentifier,c=r.views.get(o);if(!c){let h=Mc(e,a?n:null),d=!1;h?d=!0:n instanceof dt?(h=ip(e,n),d=!1):(h=dt.EMPTY_NODE,d=!1);const f=Kc(new Ms(h,d,!1),new Ms(n,a,!1));return new LR(t,f)}return c}function VR(r,t,e,n,a,o){const c=jR(r,t,n,a,o);return r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,c),BR(c,e),FR(c,e)}function qR(r,t,e,n){const a=t._queryIdentifier,o=[];let c=[];const h=Ki(r);if(a==="default")for(const[d,f]of r.views.entries())c=c.concat(Hb(f,e,n)),Fb(f)&&(r.views.delete(d),f.query._queryParams.loadsAllData()||o.push(f.query));else{const d=r.views.get(a);d&&(c=c.concat(Hb(d,e,n)),Fb(d)&&(r.views.delete(a),d.query._queryParams.loadsAllData()||o.push(d.query)))}return h&&!Ki(r)&&o.push(new(UR())(t._repo,t._path)),{removed:o,events:c}}function P0(r){const t=[];for(const e of r.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function Ia(r,t){let e=null;for(const n of r.views.values())e=e||PR(n,t);return e}function B0(r,t){if(t._queryParams.loadsAllData())return Qc(r);{const n=t._queryIdentifier;return r.views.get(n)}}function F0(r,t){return B0(r,t)!=null}function Ki(r){return Qc(r)!=null}function Qc(r){for(const t of r.views.values())if(t.query._queryParams.loadsAllData())return t;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lc;function YR(r){K(!Lc,"__referenceConstructor has already been defined"),Lc=r}function XR(){return K(Lc,"Reference.ts has not been loaded"),Lc}let $R=1;class Ub{constructor(t){this.listenProvider_=t,this.syncPointTree_=new $t(null),this.pendingWriteTree_=SR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function H0(r,t,e,n,a){return hR(r.pendingWriteTree_,t,e,n,a),a?Bo(r,new Ds(T0(),t,e)):[]}function As(r,t,e=!1){const n=dR(r.pendingWriteTree_,t);if(fR(r.pendingWriteTree_,t)){let o=new $t(null);return n.snap!=null?o=o.set(It(),!0):Ze(n.children,c=>{o=o.set(new Vt(c),!0)}),Bo(r,new Dc(n.path,o,e))}else return[]}function Zc(r,t,e){return Bo(r,new Ds(tp(),t,e))}function WR(r,t,e){const n=$t.fromObject(e);return Bo(r,new Co(tp(),t,n))}function KR(r,t){return Bo(r,new wo(tp(),t))}function QR(r,t,e){const n=lp(r,e);if(n){const a=cp(n),o=a.path,c=a.queryId,h=We(o,t),d=new wo(ep(c),h);return up(r,o,d)}else return[]}function vf(r,t,e,n,a=!1){const o=t._path,c=r.syncPointTree_.get(o);let h=[];if(c&&(t._queryIdentifier==="default"||F0(c,t))){const d=qR(c,t,e,n);GR(c)&&(r.syncPointTree_=r.syncPointTree_.remove(o));const f=d.removed;if(h=d.events,!a){const g=f.findIndex(y=>y._queryParams.loadsAllData())!==-1,_=r.syncPointTree_.findOnPath(o,(y,b)=>Ki(b));if(g&&!_){const y=r.syncPointTree_.subtree(o);if(!y.isEmpty()){const b=tD(y);for(let A=0;A<b.length;++A){const S=b[A],C=S.query,w=G0(r,S);r.listenProvider_.startListening(ho(C),Ic(r,C),w.hashFn,w.onComplete)}}}!_&&f.length>0&&!n&&(g?r.listenProvider_.stopListening(ho(t),null):f.forEach(y=>{const b=r.queryToTagMap.get(Jc(y));r.listenProvider_.stopListening(ho(y),b)}))}eD(r,f)}return h}function ZR(r,t,e,n){const a=lp(r,n);if(a!=null){const o=cp(a),c=o.path,h=o.queryId,d=We(c,t),f=new Ds(ep(h),d,e);return up(r,c,f)}else return[]}function JR(r,t,e,n){const a=lp(r,n);if(a){const o=cp(a),c=o.path,h=o.queryId,d=We(c,t),f=$t.fromObject(e),g=new Co(ep(h),d,f);return up(r,c,g)}else return[]}function Gb(r,t,e,n=!1){const a=t._path;let o=null,c=!1;r.syncPointTree_.foreachOnPath(a,(y,b)=>{const A=We(y,a);o=o||Ia(b,A),c=c||Ki(b)});let h=r.syncPointTree_.get(a);h?(c=c||Ki(h),o=o||Ia(h,It())):(h=new HR,r.syncPointTree_=r.syncPointTree_.set(a,h));let d;o!=null?d=!0:(d=!1,o=dt.EMPTY_NODE,r.syncPointTree_.subtree(a).foreachChild((b,A)=>{const S=Ia(A,It());S&&(o=o.updateImmediateChild(b,S))}));const f=F0(h,t);if(!f&&!t._queryParams.loadsAllData()){const y=Jc(t);K(!r.queryToTagMap.has(y),"View does not exist, but we have a tag");const b=nD();r.queryToTagMap.set(y,b),r.tagToQueryMap.set(b,y)}const g=np(r.pendingWriteTree_,a);let _=VR(h,t,e,g,o,d);if(!f&&!c&&!n){const y=B0(h,t);_=_.concat(iD(r,t,y))}return _}function op(r,t,e){const a=r.pendingWriteTree_,o=r.syncPointTree_.findOnPath(t,(c,h)=>{const d=We(c,t),f=Ia(h,d);if(f)return f});return M0(a,t,o,e,!0)}function Bo(r,t){return z0(t,r.syncPointTree_,null,np(r.pendingWriteTree_,It()))}function z0(r,t,e,n){if(Dt(r.path))return U0(r,t,e,n);{const a=t.get(It());e==null&&a!=null&&(e=Ia(a,It()));let o=[];const c=wt(r.path),h=r.operationForChild(c),d=t.children.get(c);if(d&&h){const f=e?e.getImmediateChild(c):null,g=N0(n,c);o=o.concat(z0(h,d,f,g))}return a&&(o=o.concat(rp(a,r,n,e))),o}}function U0(r,t,e,n){const a=t.get(It());e==null&&a!=null&&(e=Ia(a,It()));let o=[];return t.children.inorderTraversal((c,h)=>{const d=e?e.getImmediateChild(c):null,f=N0(n,c),g=r.operationForChild(c);g&&(o=o.concat(U0(g,h,d,f)))}),a&&(o=o.concat(rp(a,r,n,e))),o}function G0(r,t){const e=t.query,n=Ic(r,e);return{hashFn:()=>(IR(t)||dt.EMPTY_NODE).hash(),onComplete:a=>{if(a==="ok")return n?QR(r,e._path,n):KR(r,e._path);{const o=ZT(a,e);return vf(r,e,null,o)}}}}function Ic(r,t){const e=Jc(t);return r.queryToTagMap.get(e)}function Jc(r){return r._path.toString()+"$"+r._queryIdentifier}function lp(r,t){return r.tagToQueryMap.get(t)}function cp(r){const t=r.indexOf("$");return K(t!==-1&&t<r.length-1,"Bad queryKey."),{queryId:r.substr(t+1),path:new Vt(r.substr(0,t))}}function up(r,t,e){const n=r.syncPointTree_.get(t);K(n,"Missing sync point for query tag that we're tracking");const a=np(r.pendingWriteTree_,t);return rp(n,e,a,null)}function tD(r){return r.fold((t,e,n)=>{if(e&&Ki(e))return[Qc(e)];{let a=[];return e&&(a=P0(e)),Ze(n,(o,c)=>{a=a.concat(c)}),a}})}function ho(r){return r._queryParams.loadsAllData()&&!r._queryParams.isDefault()?new(XR())(r._repo,r._path):r}function eD(r,t){for(let e=0;e<t.length;++e){const n=t[e];if(!n._queryParams.loadsAllData()){const a=Jc(n),o=r.queryToTagMap.get(a);r.queryToTagMap.delete(a),r.tagToQueryMap.delete(o)}}}function nD(){return $R++}function iD(r,t,e){const n=t._path,a=Ic(r,t),o=G0(r,e),c=r.listenProvider_.startListening(ho(t),a,o.hashFn,o.onComplete),h=r.syncPointTree_.subtree(n);if(a)K(!Ki(h.value),"If we're adding a query, it shouldn't be shadowed");else{const d=h.fold((f,g,_)=>{if(!Dt(f)&&g&&Ki(g))return[Qc(g).query];{let y=[];return g&&(y=y.concat(P0(g).map(b=>b.query))),Ze(_,(b,A)=>{y=y.concat(A)}),y}});for(let f=0;f<d.length;++f){const g=d[f];r.listenProvider_.stopListening(ho(g),Ic(r,g))}}return c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hp{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new hp(e)}node(){return this.node_}}class dp{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=ge(this.path_,t);return new dp(this.syncTree_,e)}node(){return op(this.syncTree_,this.path_)}}const sD=function(r){return r=r||{},r.timestamp=r.timestamp||new Date().getTime(),r},jb=function(r,t,e){if(!r||typeof r!="object")return r;if(K(".sv"in r,"Unexpected leaf node or priority contents"),typeof r[".sv"]=="string")return aD(r[".sv"],t,e);if(typeof r[".sv"]=="object")return rD(r[".sv"],t);K(!1,"Unexpected server value: "+JSON.stringify(r,null,2))},aD=function(r,t,e){switch(r){case"timestamp":return e.timestamp;default:K(!1,"Unexpected server value: "+r)}},rD=function(r,t,e){r.hasOwnProperty("increment")||K(!1,"Unexpected server value: "+JSON.stringify(r,null,2));const n=r.increment;typeof n!="number"&&K(!1,"Unexpected increment value: "+n);const a=t.node();if(K(a!==null&&typeof a<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!a.isLeafNode())return n;const c=a.getValue();return typeof c!="number"?n:c+n},oD=function(r,t,e,n){return fp(t,new dp(e,r),n)},j0=function(r,t,e){return fp(r,new hp(t),e)};function fp(r,t,e){const n=r.getPriority().val(),a=jb(n,t.getImmediateChild(".priority"),e);let o;if(r.isLeafNode()){const c=r,h=jb(c.getValue(),t,e);return h!==c.getValue()||a!==c.getPriority().val()?new Ae(h,Me(a)):r}else{const c=r;return o=c,a!==c.getPriority().val()&&(o=o.updatePriority(new Ae(a))),c.forEachChild(ne,(h,d)=>{const f=fp(d,t.getImmediateChild(h),e);f!==d&&(o=o.updateImmediateChild(h,f))}),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function gp(r,t){let e=t instanceof Vt?t:new Vt(t),n=r,a=wt(e);for(;a!==null;){const o=Fa(n.node.children,a)||{children:{},childCount:0};n=new pp(a,n,o),e=Xt(e),a=wt(e)}return n}function Ya(r){return r.node.value}function V0(r,t){r.node.value=t,Af(r)}function q0(r){return r.node.childCount>0}function lD(r){return Ya(r)===void 0&&!q0(r)}function tu(r,t){Ze(r.node.children,(e,n)=>{t(new pp(e,r,n))})}function Y0(r,t,e,n){e&&t(r),tu(r,a=>{Y0(a,t,!0)})}function cD(r,t,e){let n=r.parent;for(;n!==null;){if(t(n))return!0;n=n.parent}return!1}function Fo(r){return new Vt(r.parent===null?r.name:Fo(r.parent)+"/"+r.name)}function Af(r){r.parent!==null&&uD(r.parent,r.name,r)}function uD(r,t,e){const n=lD(e),a=mi(r.node.children,t);n&&a?(delete r.node.children[t],r.node.childCount--,Af(r)):!n&&!a&&(r.node.children[t]=e.node,r.node.childCount++,Af(r))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD=/[\[\].#$\/\u0000-\u001F\u007F]/,dD=/[\[\].#$\u0000-\u001F\u007F]/,zd=10*1024*1024,X0=function(r){return typeof r=="string"&&r.length!==0&&!hD.test(r)},$0=function(r){return typeof r=="string"&&r.length!==0&&!dD.test(r)},fD=function(r){return r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),$0(r)},W0=function(r,t,e,n){n&&t===void 0||mp(jf(r,"value"),t,e)},mp=function(r,t,e){const n=e instanceof Vt?new Nx(e,r):e;if(t===void 0)throw new Error(r+"contains undefined "+ys(n));if(typeof t=="function")throw new Error(r+"contains a function "+ys(n)+" with contents = "+t.toString());if($v(t))throw new Error(r+"contains "+t.toString()+" "+ys(n));if(typeof t=="string"&&t.length>zd/3&&$c(t)>zd)throw new Error(r+"contains a string greater than "+zd+" utf8 bytes "+ys(n)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let a=!1,o=!1;if(Ze(t,(c,h)=>{if(c===".value")a=!0;else if(c!==".priority"&&c!==".sv"&&(o=!0,!X0(c)))throw new Error(r+" contains an invalid key ("+c+") "+ys(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Ox(n,c),mp(r,h,n),kx(n)}),a&&o)throw new Error(r+' contains ".value" child '+ys(n)+" in addition to actual children.")}},K0=function(r,t,e,n){if(!$0(e))throw new Error(jf(r,t)+'was an invalid path = "'+e+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},pD=function(r,t,e,n){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),K0(r,t,e)},Q0=function(r,t){if(wt(t)===".info")throw new Error(r+" failed = Can't modify data under /.info/")},gD=function(r,t){const e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!X0(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!fD(e))throw new Error(jf(r,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function _p(r,t){let e=null;for(let n=0;n<t.length;n++){const a=t[n],o=a.getPath();e!==null&&!Wf(o,e.path)&&(r.eventLists_.push(e),e=null),e===null&&(e={events:[],path:o}),e.events.push(a)}e&&r.eventLists_.push(e)}function Z0(r,t,e){_p(r,e),J0(r,n=>Wf(n,t))}function gi(r,t,e){_p(r,e),J0(r,n=>Mn(n,t)||Mn(t,n))}function J0(r,t){r.recursionDepth_++;let e=!0;for(let n=0;n<r.eventLists_.length;n++){const a=r.eventLists_[n];if(a){const o=a.path;t(o)?(_D(r.eventLists_[n]),r.eventLists_[n]=null):e=!1}}e&&(r.eventLists_=[]),r.recursionDepth_--}function _D(r){for(let t=0;t<r.events.length;t++){const e=r.events[t];if(e!==null){r.events[t]=null;const n=e.getEventRunner();oo&&Ie("event: "+e.toString()),qa(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD="repo_interrupt",bD=25;class vD{constructor(t,e,n,a){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=a,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new mD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Rc(),this.transactionQueueTree_=new pp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function AD(r,t,e){if(r.stats_=Xf(r.repoInfo_),r.forceRestClient_||nx())r.server_=new xc(r.repoInfo_,(n,a,o,c)=>{Vb(r,n,a,o,c)},r.authTokenProvider_,r.appCheckProvider_),setTimeout(()=>qb(r,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ee(e)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}r.persistentConnection_=new di(r.repoInfo_,t,(n,a,o,c)=>{Vb(r,n,a,o,c)},n=>{qb(r,n)},n=>{SD(r,n)},r.authTokenProvider_,r.appCheckProvider_,e),r.server_=r.persistentConnection_}r.authTokenProvider_.addTokenChangeListener(n=>{r.server_.refreshAuthToken(n)}),r.appCheckProvider_.addTokenChangeListener(n=>{r.server_.refreshAppCheckToken(n.token)}),r.statsReporter_=ox(r.repoInfo_,()=>new aR(r.stats_,r.server_)),r.infoData_=new tR,r.infoSyncTree_=new Ub({startListening:(n,a,o,c)=>{let h=[];const d=r.infoData_.getNode(n._path);return d.isEmpty()||(h=Zc(r.infoSyncTree_,n._path,d),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),bp(r,"connected",!1),r.serverSyncTree_=new Ub({startListening:(n,a,o,c)=>(r.server_.listen(n,o,a,(h,d)=>{const f=c(h,d);gi(r.eventQueue_,n._path,f)}),[]),stopListening:(n,a)=>{r.server_.unlisten(n,a)}})}function tA(r){const e=r.infoData_.getNode(new Vt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function yp(r){return sD({timestamp:tA(r)})}function Vb(r,t,e,n,a){r.dataUpdateCount++;const o=new Vt(t);e=r.interceptServerDataCallback_?r.interceptServerDataCallback_(t,e):e;let c=[];if(a)if(n){const d=vc(e,f=>Me(f));c=JR(r.serverSyncTree_,o,d,a)}else{const d=Me(e);c=ZR(r.serverSyncTree_,o,d,a)}else if(n){const d=vc(e,f=>Me(f));c=WR(r.serverSyncTree_,o,d)}else{const d=Me(e);c=Zc(r.serverSyncTree_,o,d)}let h=o;c.length>0&&(h=eu(r,o)),gi(r.eventQueue_,h,c)}function qb(r,t){bp(r,"connected",t),t===!1&&wD(r)}function SD(r,t){Ze(t,(e,n)=>{bp(r,e,n)})}function bp(r,t,e){const n=new Vt("/.info/"+t),a=Me(e);r.infoData_.updateSnapshot(n,a);const o=Zc(r.infoSyncTree_,n,a);gi(r.eventQueue_,n,o)}function eA(r){return r.nextWriteId_++}function ED(r,t,e,n,a){vp(r,"set",{path:t.toString(),value:e,priority:n});const o=yp(r),c=Me(e,n),h=op(r.serverSyncTree_,t),d=j0(c,h,o),f=eA(r),g=H0(r.serverSyncTree_,t,d,f,!0);_p(r.eventQueue_,g),r.server_.put(t.toString(),c.val(!0),(y,b)=>{const A=y==="ok";A||Qe("set at "+t+" failed: "+y);const S=As(r.serverSyncTree_,f,!A);gi(r.eventQueue_,t,S),RD(r,a,y,b)});const _=rA(r,t);eu(r,_),gi(r.eventQueue_,_,[])}function wD(r){vp(r,"onDisconnectEvents");const t=yp(r),e=Rc();pf(r.onDisconnect_,It(),(a,o)=>{const c=oD(a,o,r.serverSyncTree_,t);C0(e,a,c)});let n=[];pf(e,It(),(a,o)=>{n=n.concat(Zc(r.serverSyncTree_,a,o));const c=rA(r,a);eu(r,c)}),r.onDisconnect_=Rc(),gi(r.eventQueue_,It(),n)}function CD(r,t,e){let n;wt(t._path)===".info"?n=Gb(r.infoSyncTree_,t,e):n=Gb(r.serverSyncTree_,t,e),Z0(r.eventQueue_,t._path,n)}function TD(r,t,e){let n;wt(t._path)===".info"?n=vf(r.infoSyncTree_,t,e):n=vf(r.serverSyncTree_,t,e),Z0(r.eventQueue_,t._path,n)}function xD(r){r.persistentConnection_&&r.persistentConnection_.interrupt(yD)}function vp(r,...t){let e="";r.persistentConnection_&&(e=r.persistentConnection_.id+":"),Ie(e,...t)}function RD(r,t,e,n){t&&qa(()=>{if(e==="ok")t(null);else{const a=(e||"error").toUpperCase();let o=a;n&&(o+=": "+n);const c=new Error(o);c.code=a,t(c)}})}function nA(r,t,e){return op(r.serverSyncTree_,t,e)||dt.EMPTY_NODE}function Ap(r,t=r.transactionQueueTree_){if(t||nu(r,t),Ya(t)){const e=sA(r,t);K(e.length>0,"Sending zero length transaction queue"),e.every(a=>a.status===0)&&DD(r,Fo(t),e)}else q0(t)&&tu(t,e=>{Ap(r,e)})}function DD(r,t,e){const n=e.map(f=>f.currentWriteId),a=nA(r,t,n);let o=a;const c=a.hash();for(let f=0;f<e.length;f++){const g=e[f];K(g.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),g.status=1,g.retryCount++;const _=We(t,g.path);o=o.updateChild(_,g.currentOutputSnapshotRaw)}const h=o.val(!0),d=t;r.server_.put(d.toString(),h,f=>{vp(r,"transaction put response",{path:d.toString(),status:f});let g=[];if(f==="ok"){const _=[];for(let y=0;y<e.length;y++)e[y].status=2,g=g.concat(As(r.serverSyncTree_,e[y].currentWriteId)),e[y].onComplete&&_.push(()=>e[y].onComplete(null,!0,e[y].currentOutputSnapshotResolved)),e[y].unwatcher();nu(r,gp(r.transactionQueueTree_,t)),Ap(r,r.transactionQueueTree_),gi(r.eventQueue_,t,g);for(let y=0;y<_.length;y++)qa(_[y])}else{if(f==="datastale")for(let _=0;_<e.length;_++)e[_].status===3?e[_].status=4:e[_].status=0;else{Qe("transaction at "+d.toString()+" failed: "+f);for(let _=0;_<e.length;_++)e[_].status=4,e[_].abortReason=f}eu(r,t)}},c)}function eu(r,t){const e=iA(r,t),n=Fo(e),a=sA(r,e);return MD(r,a,n),n}function MD(r,t,e){if(t.length===0)return;const n=[];let a=[];const c=t.filter(h=>h.status===0).map(h=>h.currentWriteId);for(let h=0;h<t.length;h++){const d=t[h],f=We(e,d.path);let g=!1,_;if(K(f!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),d.status===4)g=!0,_=d.abortReason,a=a.concat(As(r.serverSyncTree_,d.currentWriteId,!0));else if(d.status===0)if(d.retryCount>=bD)g=!0,_="maxretry",a=a.concat(As(r.serverSyncTree_,d.currentWriteId,!0));else{const y=nA(r,d.path,c);d.currentInputSnapshot=y;const b=t[h].update(y.val());if(b!==void 0){mp("transaction failed: Data returned ",b,d.path);let A=Me(b);typeof b=="object"&&b!=null&&mi(b,".priority")||(A=A.updatePriority(y.getPriority()));const C=d.currentWriteId,w=yp(r),M=j0(A,y,w);d.currentOutputSnapshotRaw=A,d.currentOutputSnapshotResolved=M,d.currentWriteId=eA(r),c.splice(c.indexOf(C),1),a=a.concat(H0(r.serverSyncTree_,d.path,M,d.currentWriteId,d.applyLocally)),a=a.concat(As(r.serverSyncTree_,C,!0))}else g=!0,_="nodata",a=a.concat(As(r.serverSyncTree_,d.currentWriteId,!0))}gi(r.eventQueue_,e,a),a=[],g&&(t[h].status=2,(function(y){setTimeout(y,Math.floor(0))})(t[h].unwatcher),t[h].onComplete&&(_==="nodata"?n.push(()=>t[h].onComplete(null,!1,t[h].currentInputSnapshot)):n.push(()=>t[h].onComplete(new Error(_),!1,null))))}nu(r,r.transactionQueueTree_);for(let h=0;h<n.length;h++)qa(n[h]);Ap(r,r.transactionQueueTree_)}function iA(r,t){let e,n=r.transactionQueueTree_;for(e=wt(t);e!==null&&Ya(n)===void 0;)n=gp(n,e),t=Xt(t),e=wt(t);return n}function sA(r,t){const e=[];return aA(r,t,e),e.sort((n,a)=>n.order-a.order),e}function aA(r,t,e){const n=Ya(t);if(n)for(let a=0;a<n.length;a++)e.push(n[a]);tu(t,a=>{aA(r,a,e)})}function nu(r,t){const e=Ya(t);if(e){let n=0;for(let a=0;a<e.length;a++)e[a].status!==2&&(e[n]=e[a],n++);e.length=n,V0(t,e.length>0?e:void 0)}tu(t,n=>{nu(r,n)})}function rA(r,t){const e=Fo(iA(r,t)),n=gp(r.transactionQueueTree_,t);return cD(n,a=>{Ud(r,a)}),Ud(r,n),Y0(n,a=>{Ud(r,a)}),e}function Ud(r,t){const e=Ya(t);if(e){const n=[];let a=[],o=-1;for(let c=0;c<e.length;c++)e[c].status===3||(e[c].status===1?(K(o===c-1,"All SENT items should be at beginning of queue."),o=c,e[c].status=3,e[c].abortReason="set"):(K(e[c].status===0,"Unexpected transaction status in abort"),e[c].unwatcher(),a=a.concat(As(r.serverSyncTree_,e[c].currentWriteId,!0)),e[c].onComplete&&n.push(e[c].onComplete.bind(null,new Error("set"),!1,null))));o===-1?V0(t,void 0):e.length=o+1,gi(r.eventQueue_,Fo(t),a);for(let c=0;c<n.length;c++)qa(n[c])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ND(r){let t="";const e=r.split("/");for(let n=0;n<e.length;n++)if(e[n].length>0){let a=e[n];try{a=decodeURIComponent(a.replace(/\+/g," "))}catch{}t+="/"+a}return t}function OD(r){const t={};r.charAt(0)==="?"&&(r=r.substring(1));for(const e of r.split("&")){if(e.length===0)continue;const n=e.split("=");n.length===2?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Qe(`Invalid query segment '${e}' in query '${r}'`)}return t}const Yb=function(r,t){const e=kD(r),n=e.namespace;e.domain==="firebase.com"&&pi(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&e.domain!=="localhost"&&pi("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||XT();const a=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new r0(e.host,e.secure,n,a,t,"",n!==e.subdomain),path:new Vt(e.pathString)}},kD=function(r){let t="",e="",n="",a="",o="",c=!0,h="https",d=443;if(typeof r=="string"){let f=r.indexOf("//");f>=0&&(h=r.substring(0,f-1),r=r.substring(f+2));let g=r.indexOf("/");g===-1&&(g=r.length);let _=r.indexOf("?");_===-1&&(_=r.length),t=r.substring(0,Math.min(g,_)),g<_&&(a=ND(r.substring(g,_)));const y=OD(r.substring(Math.min(r.length,_)));f=t.indexOf(":"),f>=0?(c=h==="https"||h==="wss",d=parseInt(t.substring(f+1),10)):f=t.length;const b=t.slice(0,f);if(b.toLowerCase()==="localhost")e="localhost";else if(b.split(".").length<=2)e=b;else{const A=t.indexOf(".");n=t.substring(0,A).toLowerCase(),e=t.substring(A+1),o=n}"ns"in y&&(o=y.ns)}return{host:t,port:d,domain:e,subdomain:n,secure:c,scheme:h,pathString:a,namespace:o}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",LD=(function(){let r=0;const t=[];return function(e){const n=e===r;r=e;let a;const o=new Array(8);for(a=7;a>=0;a--)o[a]=Xb.charAt(e%64),e=Math.floor(e/64);K(e===0,"Cannot push at time == 0");let c=o.join("");if(n){for(a=11;a>=0&&t[a]===63;a--)t[a]=0;t[a]++}else for(a=0;a<12;a++)t[a]=Math.floor(Math.random()*64);for(a=0;a<12;a++)c+=Xb.charAt(t[a]);return K(c.length===20,"nextPushId: Length should be 20."),c}})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(t,e,n,a){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=a}getPath(){const t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ee(this.snapshot.exportVal())}}class PD{constructor(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return K(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(t,e,n,a){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=a}get key(){return Dt(this._path)?null:g0(this._path)}get ref(){return new Qi(this._repo,this._path)}get _queryIdentifier(){const t=Mb(this._queryParams),e=qf(t);return e==="{}"?"default":e}get _queryObject(){return Mb(this._queryParams)}isEqual(t){if(t=ja(t),!(t instanceof Sp))return!1;const e=this._repo===t._repo,n=Wf(this._path,t._path),a=this._queryIdentifier===t._queryIdentifier;return e&&n&&a}toJSON(){return this.toString()}toString(){return this._repo.toString()+Mx(this._path)}}class Qi extends Sp{constructor(t,e){super(t,e,new Jf,!1)}get parent(){const t=_0(this._path);return t===null?null:new Qi(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}}class Pc{constructor(t,e,n){this._node=t,this.ref=e,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new Vt(t),n=To(this.ref,t);return new Pc(this._node.getChild(e),n,ne)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,a)=>t(new Pc(a,To(this.ref,n),ne)))}hasChild(t){const e=new Vt(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function cc(r,t){return r=ja(r),r._checkNotDeleted("ref"),t!==void 0?To(r._root,t):r._root}function To(r,t){return r=ja(r),wt(r._path)===null?pD("child","path",t):K0("child","path",t),new Qi(r._repo,ge(r._path,t))}function FD(r,t){r=ja(r),Q0("push",r._path),W0("push",t,r._path,!0);const e=tA(r._repo),n=LD(e),a=To(r,n),o=To(r,n);let c;return t!=null?c=Sf(o,t).then(()=>o):c=Promise.resolve(o),a.then=c.then.bind(c),a.catch=c.then.bind(c,void 0),a}function Sf(r,t){r=ja(r),Q0("set",r._path),W0("set",t,r._path,!1);const e=new Xc;return ED(r._repo,r._path,t,null,e.wrapCallback(()=>{})),e.promise}class Ep{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,e){const n=e._queryParams.getIndex();return new ID("value",this,new Pc(t.snapshotNode,new Qi(e._repo,e._path),n))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new PD(this,t,e):null}matches(t){return t instanceof Ep?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function HD(r,t,e,n,a){const o=new BD(e,void 0),c=new Ep(o);return CD(r._repo,r,c),()=>TD(r._repo,r,c)}function $b(r,t,e,n){return HD(r,"value",t)}zR(Qi);YR(Qi);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zD="FIREBASE_DATABASE_EMULATOR_HOST",Ef={};let UD=!1;function GD(r,t,e,n){const a=t.lastIndexOf(":"),o=t.substring(0,a),c=Gf(o);r.repoInfo_=new r0(t,c,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0,e),n&&(r.authTokenProvider_=n)}function jD(r,t,e,n,a){let o=n||r.options.databaseURL;o===void 0&&(r.options.projectId||pi("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ie("Using default host for project ",r.options.projectId),o=`${r.options.projectId}-default-rtdb.firebaseio.com`);let c=Yb(o,a),h=c.repoInfo,d;typeof process<"u"&&db&&(d=db[zD]),d?(o=`http://${d}?ns=${h.namespace}`,c=Yb(o,a),h=c.repoInfo):c.repoInfo.secure;const f=new sx(r.name,r.options,t);gD("Invalid Firebase Database URL",c),Dt(c.path)||pi("Database URL must point to the root of a Firebase Database (not including a child path).");const g=qD(h,r,f,new ix(r,e));return new YD(g,r)}function VD(r,t){const e=Ef[t];(!e||e[r.key]!==r)&&pi(`Database ${t}(${r.repoInfo_}) has already been deleted.`),xD(r),delete e[r.key]}function qD(r,t,e,n){let a=Ef[t.name];a||(a={},Ef[t.name]=a);let o=a[r.toURLString()];return o&&pi("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new vD(r,UD,e,n),a[r.toURLString()]=o,o}class YD{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(AD(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Qi(this._repo,It())),this._rootInternal}_delete(){return this._rootInternal!==null&&(VD(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&pi("Cannot call "+t+" on a deleted database.")}}function XD(r=RT(),t){const e=ET(r,"database").getImmediate({identifier:t});if(!e._instanceStarted){const n=lC("database");n&&$D(e,...n)}return e}function $D(r,t,e,n={}){r=ja(r),r._checkNotDeleted("useEmulator");const a=`${t}:${e}`,o=r._repoInternal;if(r._instanceStarted){if(a===r._repoInternal.repoInfo_.host&&Ac(n,o.repoInfo_.emulatorOptions))return;pi("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let c;if(o.repoInfo_.nodeAdmin)n.mockUserToken&&pi('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),c=new pc(pc.OWNER);else if(n.mockUserToken){const h=typeof n.mockUserToken=="string"?n.mockUserToken:uC(n.mockUserToken,r.app.options.projectId);c=new pc(h)}Gf(t)&&(cC(t),fC("Database",!0)),GD(o,a,n,c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WD(r){UT(xT),Ec(new yo("database",(t,{instanceIdentifier:e})=>{const n=t.getProvider("app").getImmediate(),a=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return jD(n,a,o,e)},"PUBLIC").setMultipleInstances(!0)),Oa(fb,pb,r),Oa(fb,pb,"esm2020")}di.prototype.simpleListen=function(r,t){this.sendRequest("q",{p:r},t)};di.prototype.echo=function(r,t){this.sendRequest("echo",{d:r},t)};WD();const KD={apiKey:"",authDomain:"watchtask-35eb1.firebaseapp.com",databaseURL:"https://watchtask-35eb1-default-rtdb.firebaseio.com",projectId:"watchtask-35eb1",storageBucket:"watchtask-35eb1.appspot.com",messagingSenderId:"421711878688",appId:"1:421711878688:web:xxxxxxxxxxxxxxxx"},QD=Gv(KD),uc=XD(QD),Ea="globalRoom";function ZD(){const[r,t]=En.useState([]),[e,n]=En.useState("idle"),a=En.useRef(null),o=En.useRef(null),c=En.useRef([]),h=(T,N)=>{const R=cc(uc,T),k=$b(R,N);return c.current.push(()=>k()),R},d=()=>{a.current||(a.current=new RTCPeerConnection,a.current.onicecandidate=T=>{if(T.candidate){const R=a.current.__role==="caller"?"callerCandidates":"calleeCandidates";FD(cc(uc,`${Ea}/${R}`),T.candidate.toJSON())}},a.current.ondatachannel=T=>{o.current=T.channel,o.current.onmessage=g,n("canal listo")})},f=En.useRef({}),g=T=>{let N=T.data;try{const R=JSON.parse(N);if(R&&R.__type==="chunk"){const{id:k,index:z,total:j,payload:$}=R;f.current[k]||(f.current[k]={parts:[],total:j}),f.current[k].parts[z]=$;const tt=f.current[k].parts.filter(Boolean).length;if(n(`recibiendo dataset ${k}: ${tt}/${j}`),tt===j){const Q=f.current[k].parts.join("");delete f.current[k];try{const lt=JSON.parse(Q);t(mt=>[...mt,`Peer dataset (${k}) recibido (${lt.length||Object.keys(lt).length} items)`]),y(lt)}catch{t(mt=>[...mt,`Error parseando dataset ${k}`])}n("conectado")}return}else if(R&&R.__type==="info"){t(k=>[...k,`Peer info: ${R.msg}`]);return}}catch{}t(R=>[...R,"Peer: "+N])},_=async()=>{let T=await yc("pdfDataDB");if(!T.objectStoreNames.contains("pdfData")){const N=T.version+1;T.close(),T=await yc("pdfDataDB",N,{upgrade(R){R.objectStoreNames.contains("pdfData")||R.createObjectStore("pdfData",{keyPath:"id"})}})}return T},y=async T=>{try{const N=await _();if(Array.isArray(T)&&T.length){const R=N.transaction("pdfData","readwrite");for(const k of T)await R.store.put(k);await R.done}}catch(N){console.warn("No se pudo almacenar dataset recibido",N)}},b=async()=>{n("conectando..."),d();const T=cc(uc,`${Ea}/offer`);let N;if(await new Promise(R=>{const k=$b(T,z=>{N=z.val(),k(),R()})}),N){a.current.__role="callee",await a.current.setRemoteDescription(N);const R=await a.current.createAnswer();await a.current.setLocalDescription(R),await Sf(cc(uc,`${Ea}/answer`),R),n("conectado (callee)")}else{a.current.__role="caller",o.current=a.current.createDataChannel("data"),o.current.onmessage=g,n("creando oferta");const R=await a.current.createOffer();await a.current.setLocalDescription(R),await Sf(T,R),h(`${Ea}/answer`,async k=>{const z=k.val();z&&!a.current.currentRemoteDescription&&(await a.current.setRemoteDescription(z),n("conectado (caller)"))})}h(`${Ea}/callerCandidates`,R=>{a.current.__role==="callee"&&R.forEach(async k=>{const z=k.val();if(z&&!z.__added)try{await a.current.addIceCandidate(new RTCIceCandidate(z))}catch{}})}),h(`${Ea}/calleeCandidates`,R=>{a.current.__role==="caller"&&R.forEach(async k=>{const z=k.val();if(z&&!z.__added)try{await a.current.addIceCandidate(new RTCIceCandidate(z))}catch{}})})},A=()=>{const T="Hola 👋";o.current?.send(T),t(N=>[...N,"Yo: "+T])},S=async()=>await(await _()).transaction("pdfData","readonly").store.getAll(),C=async T=>{if(!o.current)return;const N=JSON.stringify(T),R=14e3,k=Math.ceil(N.length/R),z=Date.now().toString(36);n(`enviando dataset ${z} (${k} chunks)`);for(let j=0;j<k;j++){const $=N.slice(j*R,(j+1)*R),tt=JSON.stringify({__type:"chunk",id:z,index:j,total:k,payload:$});o.current.send(tt),await new Promise(Q=>setTimeout(Q,5))}o.current.send(JSON.stringify({__type:"info",msg:`dataset ${z} enviado`})),n("conectado")},w=async()=>{try{const T=await S();if(!T.length){t(N=>[...N,"DB vacía"]);return}await C(T),t(N=>[...N,`Dataset completo enviado (${T.length} registros)`])}catch{t(N=>[...N,"Error leyendo DB"])}},M=async(T=10)=>{try{const N=await S();if(!N.length){t(k=>[...k,"DB vacía"]);return}const R=N.slice(0,T);await C(R),t(k=>[...k,`Fracción enviada (${R.length}/${N.length})`])}catch{t(R=>[...R,"Error leyendo DB"])}};return En.useEffect(()=>()=>{c.current.forEach(T=>T()),a.current&&a.current.close()},[]),At.jsxs("div",{className:"flex flex-col h-full",children:[At.jsxs("div",{className:"flex items-start justify-between gap-2 flex-wrap mb-4",children:[At.jsxs("div",{children:[At.jsx("h2",{className:"heading mb-1",children:"Conexión global WebRTC"}),At.jsx("p",{className:"text-xs font-mono px-2 py-1 rounded bg-gray-100 border border-gray-200 inline-block",children:e})]}),At.jsxs("div",{className:"flex flex-wrap gap-2",children:[At.jsx("button",{onClick:b,disabled:e.startsWith("conectado"),className:"btn btn-primary",children:"Conectar"}),At.jsx("button",{onClick:A,disabled:!o.current,className:"btn btn-outline",children:"Chat hola"}),At.jsx("button",{onClick:w,disabled:!o.current,className:"btn btn-outline",children:"DB completa"}),At.jsx("button",{onClick:()=>M(5),disabled:!o.current,className:"btn btn-outline",children:"5 registros"})]})]}),At.jsx("ul",{className:"messages flex-1",children:r.map((T,N)=>At.jsx("li",{children:T},N))})]})}function JD(){const[r,t]=En.useState(0),[e,n]=En.useState(0);En.useEffect(()=>{navigator.storage&&navigator.storage.persist&&navigator.storage.persist().then(o=>{console.log(o?"Almacenamiento persistente garantizado":"No se pudo garantizar almacenamiento persistente")})},[]),En.useEffect(()=>{async function o(){const h=await yc("pdfDataDB",1,{upgrade(f){f.objectStoreNames.contains("pdfData")||f.createObjectStore("pdfData",{keyPath:"id"})}});let d=0;try{d=await h.count("pdfData")}catch{d=0}n(d)}o();const c=setInterval(o,5e3);return()=>clearInterval(c)},[]);async function a(o){await Qw(o,t)}return At.jsxs("div",{className:"min-h-screen flex flex-col",children:[At.jsx("header",{className:"bg-blue-700 text-white shadow-sm",children:At.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[At.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"WatchTask"}),At.jsx("div",{className:"flex items-center gap-3",children:At.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium cursor-pointer",children:[At.jsx("span",{className:"hidden sm:inline",children:"Cargar PDF"}),At.jsx("input",{type:"file",accept:"application/pdf",onChange:o=>a(o.target.files[0]),className:"block text-sm text-white file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100"})]})})]})}),At.jsxs("main",{className:"flex-1 max-w-5xl w-full mx-auto px-4 py-6 grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[At.jsxs("section",{className:"card md:col-span-1 lg:col-span-1 flex flex-col gap-2",children:[At.jsx("h2",{className:"heading",children:"Resumen"}),At.jsx("p",{className:"muted",children:"Estado general de los datos procesados."}),At.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3 text-center",children:[At.jsxs("div",{className:"p-3 rounded-md bg-blue-50 border border-blue-100",children:[At.jsx("p",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"Órdenes"}),At.jsx("p",{className:"text-lg font-semibold text-blue-700",children:r})]}),At.jsxs("div",{className:"p-3 rounded-md bg-blue-50 border border-blue-100",children:[At.jsx("p",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"En DB"}),At.jsx("p",{className:"text-lg font-semibold text-blue-700",children:e})]})]})]}),At.jsx("section",{className:"card md:col-span-1 lg:col-span-2",children:At.jsx(ZD,{})})]}),At.jsx("footer",{className:"mt-auto bg-white border-t border-gray-200",children:At.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-3 text-xs text-gray-500 flex items-center justify-between",children:[At.jsxs("span",{children:["© ",new Date().getFullYear()," WatchTask v0.0.1"]}),At.jsx("span",{children:"Tailwind UI básico"})]})})]})}FE.createRoot(document.getElementById("root")).render(At.jsx(En.StrictMode,{children:At.jsx(JD,{})}));
