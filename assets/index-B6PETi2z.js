var Dy=r=>{throw TypeError(r)};var Cd=(r,t,e)=>t.has(r)||Dy("Cannot "+e);var Qt=(r,t,e)=>(Cd(r,t,"read from private field"),e?e.call(r):t.get(r)),zn=(r,t,e)=>t.has(r)?Dy("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),$e=(r,t,e,n)=>(Cd(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),Un=(r,t,e)=>(Cd(r,t,"access private method"),e);var My=(r,t,e,n)=>({set _(a){$e(r,t,a,e)},get _(){return Qt(r,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();var Td={exports:{}},eo={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ny;function PE(){if(Ny)return eo;Ny=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,a,o){var c=null;if(o!==void 0&&(c=""+o),a.key!==void 0&&(c=""+a.key),"key"in a){o={};for(var h in a)h!=="key"&&(o[h]=a[h])}else o=a;return a=o.ref,{$$typeof:r,type:n,key:c,ref:a!==void 0?a:null,props:o}}return eo.Fragment=t,eo.jsx=e,eo.jsxs=e,eo}var Oy;function BE(){return Oy||(Oy=1,Td.exports=PE()),Td.exports}var et=BE(),xd={exports:{}},At={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ky;function FE(){if(ky)return At;ky=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.iterator;function y(T){return T===null||typeof T!="object"?null:(T=_&&T[_]||T["@@iterator"],typeof T=="function"?T:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,S={};function C(T,H,X){this.props=T,this.context=H,this.refs=S,this.updater=X||b}C.prototype.isReactComponent={},C.prototype.setState=function(T,H){if(typeof T!="object"&&typeof T!="function"&&T!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,T,H,"setState")},C.prototype.forceUpdate=function(T){this.updater.enqueueForceUpdate(this,T,"forceUpdate")};function w(){}w.prototype=C.prototype;function D(T,H,X){this.props=T,this.context=H,this.refs=S,this.updater=X||b}var x=D.prototype=new w;x.constructor=D,A(x,C.prototype),x.isPureReactComponent=!0;var k=Array.isArray,O={H:null,A:null,T:null,S:null,V:null},P=Object.prototype.hasOwnProperty;function j(T,H,X,W,rt,_t){return X=_t.ref,{$$typeof:r,type:T,key:H,ref:X!==void 0?X:null,props:_t}}function Y(T,H){return j(T.type,H,void 0,void 0,void 0,T.props)}function K(T){return typeof T=="object"&&T!==null&&T.$$typeof===r}function it(T){var H={"=":"=0",":":"=2"};return"$"+T.replace(/[=:]/g,function(X){return H[X]})}var J=/\/+/g;function ft(T,H){return typeof T=="object"&&T!==null&&T.key!=null?it(""+T.key):H.toString(36)}function tt(){}function vt(T){switch(T.status){case"fulfilled":return T.value;case"rejected":throw T.reason;default:switch(typeof T.status=="string"?T.then(tt,tt):(T.status="pending",T.then(function(H){T.status==="pending"&&(T.status="fulfilled",T.value=H)},function(H){T.status==="pending"&&(T.status="rejected",T.reason=H)})),T.status){case"fulfilled":return T.value;case"rejected":throw T.reason}}throw T}function bt(T,H,X,W,rt){var _t=typeof T;(_t==="undefined"||_t==="boolean")&&(T=null);var lt=!1;if(T===null)lt=!0;else switch(_t){case"bigint":case"string":case"number":lt=!0;break;case"object":switch(T.$$typeof){case r:case t:lt=!0;break;case g:return lt=T._init,bt(lt(T._payload),H,X,W,rt)}}if(lt)return rt=rt(T),lt=W===""?"."+ft(T,0):W,k(rt)?(X="",lt!=null&&(X=lt.replace(J,"$&/")+"/"),bt(rt,H,X,"",function(kn){return kn})):rt!=null&&(K(rt)&&(rt=Y(rt,X+(rt.key==null||T&&T.key===rt.key?"":(""+rt.key).replace(J,"$&/")+"/")+lt)),H.push(rt)),1;lt=0;var Nt=W===""?".":W+":";if(k(T))for(var Bt=0;Bt<T.length;Bt++)W=T[Bt],_t=Nt+ft(W,Bt),lt+=bt(W,H,X,_t,rt);else if(Bt=y(T),typeof Bt=="function")for(T=Bt.call(T),Bt=0;!(W=T.next()).done;)W=W.value,_t=Nt+ft(W,Bt++),lt+=bt(W,H,X,_t,rt);else if(_t==="object"){if(typeof T.then=="function")return bt(vt(T),H,X,W,rt);throw H=String(T),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return lt}function I(T,H,X){if(T==null)return T;var W=[],rt=0;return bt(T,W,"","",function(_t){return H.call(X,_t,rt++)}),W}function M(T){if(T._status===-1){var H=T._result;H=H(),H.then(function(X){(T._status===0||T._status===-1)&&(T._status=1,T._result=X)},function(X){(T._status===0||T._status===-1)&&(T._status=2,T._result=X)}),T._status===-1&&(T._status=0,T._result=H)}if(T._status===1)return T._result.default;throw T._result}var V=typeof reportError=="function"?reportError:function(T){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof T=="object"&&T!==null&&typeof T.message=="string"?String(T.message):String(T),error:T});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",T);return}console.error(T)};function Z(){}return At.Children={map:I,forEach:function(T,H,X){I(T,function(){H.apply(this,arguments)},X)},count:function(T){var H=0;return I(T,function(){H++}),H},toArray:function(T){return I(T,function(H){return H})||[]},only:function(T){if(!K(T))throw Error("React.Children.only expected to receive a single React element child.");return T}},At.Component=C,At.Fragment=e,At.Profiler=a,At.PureComponent=D,At.StrictMode=n,At.Suspense=d,At.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,At.__COMPILER_RUNTIME={__proto__:null,c:function(T){return O.H.useMemoCache(T)}},At.cache=function(T){return function(){return T.apply(null,arguments)}},At.cloneElement=function(T,H,X){if(T==null)throw Error("The argument must be a React element, but you passed "+T+".");var W=A({},T.props),rt=T.key,_t=void 0;if(H!=null)for(lt in H.ref!==void 0&&(_t=void 0),H.key!==void 0&&(rt=""+H.key),H)!P.call(H,lt)||lt==="key"||lt==="__self"||lt==="__source"||lt==="ref"&&H.ref===void 0||(W[lt]=H[lt]);var lt=arguments.length-2;if(lt===1)W.children=X;else if(1<lt){for(var Nt=Array(lt),Bt=0;Bt<lt;Bt++)Nt[Bt]=arguments[Bt+2];W.children=Nt}return j(T.type,rt,void 0,void 0,_t,W)},At.createContext=function(T){return T={$$typeof:c,_currentValue:T,_currentValue2:T,_threadCount:0,Provider:null,Consumer:null},T.Provider=T,T.Consumer={$$typeof:o,_context:T},T},At.createElement=function(T,H,X){var W,rt={},_t=null;if(H!=null)for(W in H.key!==void 0&&(_t=""+H.key),H)P.call(H,W)&&W!=="key"&&W!=="__self"&&W!=="__source"&&(rt[W]=H[W]);var lt=arguments.length-2;if(lt===1)rt.children=X;else if(1<lt){for(var Nt=Array(lt),Bt=0;Bt<lt;Bt++)Nt[Bt]=arguments[Bt+2];rt.children=Nt}if(T&&T.defaultProps)for(W in lt=T.defaultProps,lt)rt[W]===void 0&&(rt[W]=lt[W]);return j(T,_t,void 0,void 0,null,rt)},At.createRef=function(){return{current:null}},At.forwardRef=function(T){return{$$typeof:h,render:T}},At.isValidElement=K,At.lazy=function(T){return{$$typeof:g,_payload:{_status:-1,_result:T},_init:M}},At.memo=function(T,H){return{$$typeof:f,type:T,compare:H===void 0?null:H}},At.startTransition=function(T){var H=O.T,X={};O.T=X;try{var W=T(),rt=O.S;rt!==null&&rt(X,W),typeof W=="object"&&W!==null&&typeof W.then=="function"&&W.then(Z,V)}catch(_t){V(_t)}finally{O.T=H}},At.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},At.use=function(T){return O.H.use(T)},At.useActionState=function(T,H,X){return O.H.useActionState(T,H,X)},At.useCallback=function(T,H){return O.H.useCallback(T,H)},At.useContext=function(T){return O.H.useContext(T)},At.useDebugValue=function(){},At.useDeferredValue=function(T,H){return O.H.useDeferredValue(T,H)},At.useEffect=function(T,H,X){var W=O.H;if(typeof X=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return W.useEffect(T,H)},At.useId=function(){return O.H.useId()},At.useImperativeHandle=function(T,H,X){return O.H.useImperativeHandle(T,H,X)},At.useInsertionEffect=function(T,H){return O.H.useInsertionEffect(T,H)},At.useLayoutEffect=function(T,H){return O.H.useLayoutEffect(T,H)},At.useMemo=function(T,H){return O.H.useMemo(T,H)},At.useOptimistic=function(T,H){return O.H.useOptimistic(T,H)},At.useReducer=function(T,H,X){return O.H.useReducer(T,H,X)},At.useRef=function(T){return O.H.useRef(T)},At.useState=function(T){return O.H.useState(T)},At.useSyncExternalStore=function(T,H,X){return O.H.useSyncExternalStore(T,H,X)},At.useTransition=function(){return O.H.useTransition()},At.version="19.1.1",At}var Ly;function Pf(){return Ly||(Ly=1,xd.exports=FE()),xd.exports}var St=Pf(),Rd={exports:{}},no={},Dd={exports:{}},Md={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Iy;function HE(){return Iy||(Iy=1,(function(r){function t(I,M){var V=I.length;I.push(M);t:for(;0<V;){var Z=V-1>>>1,T=I[Z];if(0<a(T,M))I[Z]=M,I[V]=T,V=Z;else break t}}function e(I){return I.length===0?null:I[0]}function n(I){if(I.length===0)return null;var M=I[0],V=I.pop();if(V!==M){I[0]=V;t:for(var Z=0,T=I.length,H=T>>>1;Z<H;){var X=2*(Z+1)-1,W=I[X],rt=X+1,_t=I[rt];if(0>a(W,V))rt<T&&0>a(_t,W)?(I[Z]=_t,I[rt]=V,Z=rt):(I[Z]=W,I[X]=V,Z=X);else if(rt<T&&0>a(_t,V))I[Z]=_t,I[rt]=V,Z=rt;else break t}}return M}function a(I,M){var V=I.sortIndex-M.sortIndex;return V!==0?V:I.id-M.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var c=Date,h=c.now();r.unstable_now=function(){return c.now()-h}}var d=[],f=[],g=1,_=null,y=3,b=!1,A=!1,S=!1,C=!1,w=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function k(I){for(var M=e(f);M!==null;){if(M.callback===null)n(f);else if(M.startTime<=I)n(f),M.sortIndex=M.expirationTime,t(d,M);else break;M=e(f)}}function O(I){if(S=!1,k(I),!A)if(e(d)!==null)A=!0,P||(P=!0,ft());else{var M=e(f);M!==null&&bt(O,M.startTime-I)}}var P=!1,j=-1,Y=5,K=-1;function it(){return C?!0:!(r.unstable_now()-K<Y)}function J(){if(C=!1,P){var I=r.unstable_now();K=I;var M=!0;try{t:{A=!1,S&&(S=!1,D(j),j=-1),b=!0;var V=y;try{e:{for(k(I),_=e(d);_!==null&&!(_.expirationTime>I&&it());){var Z=_.callback;if(typeof Z=="function"){_.callback=null,y=_.priorityLevel;var T=Z(_.expirationTime<=I);if(I=r.unstable_now(),typeof T=="function"){_.callback=T,k(I),M=!0;break e}_===e(d)&&n(d),k(I)}else n(d);_=e(d)}if(_!==null)M=!0;else{var H=e(f);H!==null&&bt(O,H.startTime-I),M=!1}}break t}finally{_=null,y=V,b=!1}M=void 0}}finally{M?ft():P=!1}}}var ft;if(typeof x=="function")ft=function(){x(J)};else if(typeof MessageChannel<"u"){var tt=new MessageChannel,vt=tt.port2;tt.port1.onmessage=J,ft=function(){vt.postMessage(null)}}else ft=function(){w(J,0)};function bt(I,M){j=w(function(){I(r.unstable_now())},M)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(I){I.callback=null},r.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<I?Math.floor(1e3/I):5},r.unstable_getCurrentPriorityLevel=function(){return y},r.unstable_next=function(I){switch(y){case 1:case 2:case 3:var M=3;break;default:M=y}var V=y;y=M;try{return I()}finally{y=V}},r.unstable_requestPaint=function(){C=!0},r.unstable_runWithPriority=function(I,M){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var V=y;y=I;try{return M()}finally{y=V}},r.unstable_scheduleCallback=function(I,M,V){var Z=r.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?Z+V:Z):V=Z,I){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=V+T,I={id:g++,callback:M,priorityLevel:I,startTime:V,expirationTime:T,sortIndex:-1},V>Z?(I.sortIndex=V,t(f,I),e(d)===null&&I===e(f)&&(S?(D(j),j=-1):S=!0,bt(O,V-Z))):(I.sortIndex=T,t(d,I),A||b||(A=!0,P||(P=!0,ft()))),I},r.unstable_shouldYield=it,r.unstable_wrapCallback=function(I){var M=y;return function(){var V=y;y=M;try{return I.apply(this,arguments)}finally{y=V}}}})(Md)),Md}var Py;function zE(){return Py||(Py=1,Dd.exports=HE()),Dd.exports}var Nd={exports:{}},Pe={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var By;function UE(){if(By)return Pe;By=1;var r=Pf();function t(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(d,f,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:_==null?null:""+_,children:d,containerInfo:f,implementation:g}}var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Pe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Pe.createPortal=function(d,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return o(d,f,null,g)},Pe.flushSync=function(d){var f=c.T,g=n.p;try{if(c.T=null,n.p=2,d)return d()}finally{c.T=f,n.p=g,n.d.f()}},Pe.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(d,f))},Pe.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},Pe.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var g=f.as,_=h(g,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,b=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?n.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:b}):g==="script"&&n.d.X(d,{crossOrigin:_,integrity:y,fetchPriority:b,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Pe.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=h(f.as,f.crossOrigin);n.d.M(d,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(d)},Pe.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,_=h(g,f.crossOrigin);n.d.L(d,g,{crossOrigin:_,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Pe.preloadModule=function(d,f){if(typeof d=="string")if(f){var g=h(f.as,f.crossOrigin);n.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(d)},Pe.requestFormReset=function(d){n.d.r(d)},Pe.unstable_batchedUpdates=function(d,f){return d(f)},Pe.useFormState=function(d,f,g){return c.H.useFormState(d,f,g)},Pe.useFormStatus=function(){return c.H.useHostTransitionStatus()},Pe.version="19.1.1",Pe}var Fy;function jE(){if(Fy)return Nd.exports;Fy=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Nd.exports=UE(),Nd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function GE(){if(Hy)return no;Hy=1;var r=zE(),t=Pf(),e=jE();function n(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var s=i,l=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(l=s.return),i=s.return;while(i)}return s.tag===3?l:null}function c(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function h(i){if(o(i)!==i)throw Error(n(188))}function d(i){var s=i.alternate;if(!s){if(s=o(i),s===null)throw Error(n(188));return s!==i?null:i}for(var l=i,u=s;;){var p=l.return;if(p===null)break;var m=p.alternate;if(m===null){if(u=p.return,u!==null){l=u;continue}break}if(p.child===m.child){for(m=p.child;m;){if(m===l)return h(p),i;if(m===u)return h(p),s;m=m.sibling}throw Error(n(188))}if(l.return!==u.return)l=p,u=m;else{for(var v=!1,E=p.child;E;){if(E===l){v=!0,l=p,u=m;break}if(E===u){v=!0,u=p,l=m;break}E=E.sibling}if(!v){for(E=m.child;E;){if(E===l){v=!0,l=m,u=p;break}if(E===u){v=!0,u=m,l=p;break}E=E.sibling}if(!v)throw Error(n(189))}}if(l.alternate!==u)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?i:s}function f(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=f(i),s!==null)return s;i=i.sibling}return null}var g=Object.assign,_=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),D=Symbol.for("react.consumer"),x=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),it=Symbol.for("react.memo_cache_sentinel"),J=Symbol.iterator;function ft(i){return i===null||typeof i!="object"?null:(i=J&&i[J]||i["@@iterator"],typeof i=="function"?i:null)}var tt=Symbol.for("react.client.reference");function vt(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===tt?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case A:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case O:return"Suspense";case P:return"SuspenseList";case K:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case b:return"Portal";case x:return(i.displayName||"Context")+".Provider";case D:return(i._context.displayName||"Context")+".Consumer";case k:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case j:return s=i.displayName||null,s!==null?s:vt(i.type)||"Memo";case Y:s=i._payload,i=i._init;try{return vt(i(s))}catch{}}return null}var bt=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V={pending:!1,data:null,method:null,action:null},Z=[],T=-1;function H(i){return{current:i}}function X(i){0>T||(i.current=Z[T],Z[T]=null,T--)}function W(i,s){T++,Z[T]=i.current,i.current=s}var rt=H(null),_t=H(null),lt=H(null),Nt=H(null);function Bt(i,s){switch(W(lt,s),W(_t,i),W(rt,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?iy(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=iy(s),i=sy(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}X(rt),W(rt,i)}function kn(){X(rt),X(_t),X(lt)}function nr(i){i.memoizedState!==null&&W(Nt,i);var s=rt.current,l=sy(s,i.type);s!==l&&(W(_t,i),W(rt,l))}function bi(i){_t.current===i&&(X(rt),X(_t)),Nt.current===i&&(X(Nt),Kr._currentValue=V)}var is=Object.prototype.hasOwnProperty,js=r.unstable_scheduleCallback,ir=r.unstable_cancelCallback,pA=r.unstable_shouldYield,gA=r.unstable_requestPaint,Ln=r.unstable_now,mA=r.unstable_getCurrentPriorityLevel,Bp=r.unstable_ImmediatePriority,Fp=r.unstable_UserBlockingPriority,Wo=r.unstable_NormalPriority,_A=r.unstable_LowPriority,Hp=r.unstable_IdlePriority,yA=r.log,bA=r.unstable_setDisableYieldValue,sr=null,tn=null;function vi(i){if(typeof yA=="function"&&bA(i),tn&&typeof tn.setStrictMode=="function")try{tn.setStrictMode(sr,i)}catch{}}var en=Math.clz32?Math.clz32:SA,vA=Math.log,AA=Math.LN2;function SA(i){return i>>>=0,i===0?32:31-(vA(i)/AA|0)|0}var Ko=256,Qo=4194304;function ss(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Zo(i,s,l){var u=i.pendingLanes;if(u===0)return 0;var p=0,m=i.suspendedLanes,v=i.pingedLanes;i=i.warmLanes;var E=u&134217727;return E!==0?(u=E&~m,u!==0?p=ss(u):(v&=E,v!==0?p=ss(v):l||(l=E&~i,l!==0&&(p=ss(l))))):(E=u&~m,E!==0?p=ss(E):v!==0?p=ss(v):l||(l=u&~i,l!==0&&(p=ss(l)))),p===0?0:s!==0&&s!==p&&(s&m)===0&&(m=p&-p,l=s&-s,m>=l||m===32&&(l&4194048)!==0)?s:p}function ar(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function EA(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zp(){var i=Ko;return Ko<<=1,(Ko&4194048)===0&&(Ko=256),i}function Up(){var i=Qo;return Qo<<=1,(Qo&62914560)===0&&(Qo=4194304),i}function pu(i){for(var s=[],l=0;31>l;l++)s.push(i);return s}function rr(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function wA(i,s,l,u,p,m){var v=i.pendingLanes;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=l,i.entangledLanes&=l,i.errorRecoveryDisabledLanes&=l,i.shellSuspendCounter=0;var E=i.entanglements,R=i.expirationTimes,F=i.hiddenUpdates;for(l=v&~l;0<l;){var G=31-en(l),$=1<<G;E[G]=0,R[G]=-1;var z=F[G];if(z!==null)for(F[G]=null,G=0;G<z.length;G++){var U=z[G];U!==null&&(U.lane&=-536870913)}l&=~$}u!==0&&jp(i,u,0),m!==0&&p===0&&i.tag!==0&&(i.suspendedLanes|=m&~(v&~s))}function jp(i,s,l){i.pendingLanes|=s,i.suspendedLanes&=~s;var u=31-en(s);i.entangledLanes|=s,i.entanglements[u]=i.entanglements[u]|1073741824|l&4194090}function Gp(i,s){var l=i.entangledLanes|=s;for(i=i.entanglements;l;){var u=31-en(l),p=1<<u;p&s|i[u]&s&&(i[u]|=s),l&=~p}}function gu(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function mu(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Vp(){var i=M.p;return i!==0?i:(i=window.event,i===void 0?32:Ey(i.type))}function CA(i,s){var l=M.p;try{return M.p=i,s()}finally{M.p=l}}var Ai=Math.random().toString(36).slice(2),Le="__reactFiber$"+Ai,Ge="__reactProps$"+Ai,Gs="__reactContainer$"+Ai,_u="__reactEvents$"+Ai,TA="__reactListeners$"+Ai,xA="__reactHandles$"+Ai,qp="__reactResources$"+Ai,or="__reactMarker$"+Ai;function yu(i){delete i[Le],delete i[Ge],delete i[_u],delete i[TA],delete i[xA]}function Vs(i){var s=i[Le];if(s)return s;for(var l=i.parentNode;l;){if(s=l[Gs]||l[Le]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(i=ly(i);i!==null;){if(l=i[Le])return l;i=ly(i)}return s}i=l,l=i.parentNode}return null}function qs(i){if(i=i[Le]||i[Gs]){var s=i.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return i}return null}function lr(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(n(33))}function Ys(i){var s=i[qp];return s||(s=i[qp]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function ye(i){i[or]=!0}var Yp=new Set,Xp={};function as(i,s){Xs(i,s),Xs(i+"Capture",s)}function Xs(i,s){for(Xp[i]=s,i=0;i<s.length;i++)Yp.add(s[i])}var RA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$p={},Wp={};function DA(i){return is.call(Wp,i)?!0:is.call($p,i)?!1:RA.test(i)?Wp[i]=!0:($p[i]=!0,!1)}function Jo(i,s,l){if(DA(s))if(l===null)i.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var u=s.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+l)}}function tl(i,s,l){if(l===null)i.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+l)}}function Wn(i,s,l,u){if(u===null)i.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(l);return}i.setAttributeNS(s,l,""+u)}}var bu,Kp;function $s(i){if(bu===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);bu=s&&s[1]||"",Kp=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bu+i+Kp}var vu=!1;function Au(i,s){if(!i||vu)return"";vu=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(s){var $=function(){throw Error()};if(Object.defineProperty($.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($,[])}catch(U){var z=U}Reflect.construct(i,[],$)}else{try{$.call()}catch(U){z=U}i.call($.prototype)}}else{try{throw Error()}catch(U){z=U}($=i())&&typeof $.catch=="function"&&$.catch(function(){})}}catch(U){if(U&&z&&typeof U.stack=="string")return[U.stack,z.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=u.DetermineComponentFrameRoot(),v=m[0],E=m[1];if(v&&E){var R=v.split(`
`),F=E.split(`
`);for(p=u=0;u<R.length&&!R[u].includes("DetermineComponentFrameRoot");)u++;for(;p<F.length&&!F[p].includes("DetermineComponentFrameRoot");)p++;if(u===R.length||p===F.length)for(u=R.length-1,p=F.length-1;1<=u&&0<=p&&R[u]!==F[p];)p--;for(;1<=u&&0<=p;u--,p--)if(R[u]!==F[p]){if(u!==1||p!==1)do if(u--,p--,0>p||R[u]!==F[p]){var G=`
`+R[u].replace(" at new "," at ");return i.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",i.displayName)),G}while(1<=u&&0<=p);break}}}finally{vu=!1,Error.prepareStackTrace=l}return(l=i?i.displayName||i.name:"")?$s(l):""}function MA(i){switch(i.tag){case 26:case 27:case 5:return $s(i.type);case 16:return $s("Lazy");case 13:return $s("Suspense");case 19:return $s("SuspenseList");case 0:case 15:return Au(i.type,!1);case 11:return Au(i.type.render,!1);case 1:return Au(i.type,!0);case 31:return $s("Activity");default:return""}}function Qp(i){try{var s="";do s+=MA(i),i=i.return;while(i);return s}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function dn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Zp(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function NA(i){var s=Zp(i)?"checked":"value",l=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),u=""+i[s];if(!i.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var p=l.get,m=l.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return p.call(this)},set:function(v){u=""+v,m.call(this,v)}}),Object.defineProperty(i,s,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(v){u=""+v},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function el(i){i._valueTracker||(i._valueTracker=NA(i))}function Jp(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var l=s.getValue(),u="";return i&&(u=Zp(i)?i.checked?"true":"false":i.value),i=u,i!==l?(s.setValue(i),!0):!1}function nl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var OA=/[\n"\\]/g;function fn(i){return i.replace(OA,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Su(i,s,l,u,p,m,v,E){i.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?i.type=v:i.removeAttribute("type"),s!=null?v==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+dn(s)):i.value!==""+dn(s)&&(i.value=""+dn(s)):v!=="submit"&&v!=="reset"||i.removeAttribute("value"),s!=null?Eu(i,v,dn(s)):l!=null?Eu(i,v,dn(l)):u!=null&&i.removeAttribute("value"),p==null&&m!=null&&(i.defaultChecked=!!m),p!=null&&(i.checked=p&&typeof p!="function"&&typeof p!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?i.name=""+dn(E):i.removeAttribute("name")}function tg(i,s,l,u,p,m,v,E){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(i.type=m),s!=null||l!=null){if(!(m!=="submit"&&m!=="reset"||s!=null))return;l=l!=null?""+dn(l):"",s=s!=null?""+dn(s):l,E||s===i.value||(i.value=s),i.defaultValue=s}u=u??p,u=typeof u!="function"&&typeof u!="symbol"&&!!u,i.checked=E?i.checked:!!u,i.defaultChecked=!!u,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(i.name=v)}function Eu(i,s,l){s==="number"&&nl(i.ownerDocument)===i||i.defaultValue===""+l||(i.defaultValue=""+l)}function Ws(i,s,l,u){if(i=i.options,s){s={};for(var p=0;p<l.length;p++)s["$"+l[p]]=!0;for(l=0;l<i.length;l++)p=s.hasOwnProperty("$"+i[l].value),i[l].selected!==p&&(i[l].selected=p),p&&u&&(i[l].defaultSelected=!0)}else{for(l=""+dn(l),s=null,p=0;p<i.length;p++){if(i[p].value===l){i[p].selected=!0,u&&(i[p].defaultSelected=!0);return}s!==null||i[p].disabled||(s=i[p])}s!==null&&(s.selected=!0)}}function eg(i,s,l){if(s!=null&&(s=""+dn(s),s!==i.value&&(i.value=s),l==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=l!=null?""+dn(l):""}function ng(i,s,l,u){if(s==null){if(u!=null){if(l!=null)throw Error(n(92));if(bt(u)){if(1<u.length)throw Error(n(93));u=u[0]}l=u}l==null&&(l=""),s=l}l=dn(s),i.defaultValue=l,u=i.textContent,u===l&&u!==""&&u!==null&&(i.value=u)}function Ks(i,s){if(s){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=s;return}}i.textContent=s}var kA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ig(i,s,l){var u=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":u?i.setProperty(s,l):typeof l!="number"||l===0||kA.has(s)?s==="float"?i.cssFloat=l:i[s]=(""+l).trim():i[s]=l+"px"}function sg(i,s,l){if(s!=null&&typeof s!="object")throw Error(n(62));if(i=i.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||s!=null&&s.hasOwnProperty(u)||(u.indexOf("--")===0?i.setProperty(u,""):u==="float"?i.cssFloat="":i[u]="");for(var p in s)u=s[p],s.hasOwnProperty(p)&&l[p]!==u&&ig(i,p,u)}else for(var m in s)s.hasOwnProperty(m)&&ig(i,m,s[m])}function wu(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var LA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),IA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function il(i){return IA.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var Cu=null;function Tu(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Qs=null,Zs=null;function ag(i){var s=qs(i);if(s&&(i=s.stateNode)){var l=i[Ge]||null;t:switch(i=s.stateNode,s.type){case"input":if(Su(i,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+fn(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var u=l[s];if(u!==i&&u.form===i.form){var p=u[Ge]||null;if(!p)throw Error(n(90));Su(u,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(s=0;s<l.length;s++)u=l[s],u.form===i.form&&Jp(u)}break t;case"textarea":eg(i,l.value,l.defaultValue);break t;case"select":s=l.value,s!=null&&Ws(i,!!l.multiple,s,!1)}}}var xu=!1;function rg(i,s,l){if(xu)return i(s,l);xu=!0;try{var u=i(s);return u}finally{if(xu=!1,(Qs!==null||Zs!==null)&&(jl(),Qs&&(s=Qs,i=Zs,Zs=Qs=null,ag(s),i)))for(s=0;s<i.length;s++)ag(i[s])}}function cr(i,s){var l=i.stateNode;if(l===null)return null;var u=l[Ge]||null;if(u===null)return null;l=u[s];t:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(i=i.type,u=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!u;break t;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(n(231,s,typeof l));return l}var Kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ru=!1;if(Kn)try{var ur={};Object.defineProperty(ur,"passive",{get:function(){Ru=!0}}),window.addEventListener("test",ur,ur),window.removeEventListener("test",ur,ur)}catch{Ru=!1}var Si=null,Du=null,sl=null;function og(){if(sl)return sl;var i,s=Du,l=s.length,u,p="value"in Si?Si.value:Si.textContent,m=p.length;for(i=0;i<l&&s[i]===p[i];i++);var v=l-i;for(u=1;u<=v&&s[l-u]===p[m-u];u++);return sl=p.slice(i,1<u?1-u:void 0)}function al(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function rl(){return!0}function lg(){return!1}function Ve(i){function s(l,u,p,m,v){this._reactName=l,this._targetInst=p,this.type=u,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var E in i)i.hasOwnProperty(E)&&(l=i[E],this[E]=l?l(m):m[E]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?rl:lg,this.isPropagationStopped=lg,this}return g(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=rl)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=rl)},persist:function(){},isPersistent:rl}),s}var rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ol=Ve(rs),hr=g({},rs,{view:0,detail:0}),PA=Ve(hr),Mu,Nu,dr,ll=g({},hr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ku,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==dr&&(dr&&i.type==="mousemove"?(Mu=i.screenX-dr.screenX,Nu=i.screenY-dr.screenY):Nu=Mu=0,dr=i),Mu)},movementY:function(i){return"movementY"in i?i.movementY:Nu}}),cg=Ve(ll),BA=g({},ll,{dataTransfer:0}),FA=Ve(BA),HA=g({},hr,{relatedTarget:0}),Ou=Ve(HA),zA=g({},rs,{animationName:0,elapsedTime:0,pseudoElement:0}),UA=Ve(zA),jA=g({},rs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),GA=Ve(jA),VA=g({},rs,{data:0}),ug=Ve(VA),qA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},YA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},XA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $A(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=XA[i])?!!s[i]:!1}function ku(){return $A}var WA=g({},hr,{key:function(i){if(i.key){var s=qA[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=al(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?YA[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ku,charCode:function(i){return i.type==="keypress"?al(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?al(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),KA=Ve(WA),QA=g({},ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hg=Ve(QA),ZA=g({},hr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ku}),JA=Ve(ZA),tS=g({},rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),eS=Ve(tS),nS=g({},ll,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),iS=Ve(nS),sS=g({},rs,{newState:0,oldState:0}),aS=Ve(sS),rS=[9,13,27,32],Lu=Kn&&"CompositionEvent"in window,fr=null;Kn&&"documentMode"in document&&(fr=document.documentMode);var oS=Kn&&"TextEvent"in window&&!fr,dg=Kn&&(!Lu||fr&&8<fr&&11>=fr),fg=" ",pg=!1;function gg(i,s){switch(i){case"keyup":return rS.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mg(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Js=!1;function lS(i,s){switch(i){case"compositionend":return mg(s);case"keypress":return s.which!==32?null:(pg=!0,fg);case"textInput":return i=s.data,i===fg&&pg?null:i;default:return null}}function cS(i,s){if(Js)return i==="compositionend"||!Lu&&gg(i,s)?(i=og(),sl=Du=Si=null,Js=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return dg&&s.locale!=="ko"?null:s.data;default:return null}}var uS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _g(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!uS[i.type]:s==="textarea"}function yg(i,s,l,u){Qs?Zs?Zs.push(u):Zs=[u]:Qs=u,s=$l(s,"onChange"),0<s.length&&(l=new ol("onChange","change",null,l,u),i.push({event:l,listeners:s}))}var pr=null,gr=null;function hS(i){Z_(i,0)}function cl(i){var s=lr(i);if(Jp(s))return i}function bg(i,s){if(i==="change")return s}var vg=!1;if(Kn){var Iu;if(Kn){var Pu="oninput"in document;if(!Pu){var Ag=document.createElement("div");Ag.setAttribute("oninput","return;"),Pu=typeof Ag.oninput=="function"}Iu=Pu}else Iu=!1;vg=Iu&&(!document.documentMode||9<document.documentMode)}function Sg(){pr&&(pr.detachEvent("onpropertychange",Eg),gr=pr=null)}function Eg(i){if(i.propertyName==="value"&&cl(gr)){var s=[];yg(s,gr,i,Tu(i)),rg(hS,s)}}function dS(i,s,l){i==="focusin"?(Sg(),pr=s,gr=l,pr.attachEvent("onpropertychange",Eg)):i==="focusout"&&Sg()}function fS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return cl(gr)}function pS(i,s){if(i==="click")return cl(s)}function gS(i,s){if(i==="input"||i==="change")return cl(s)}function mS(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var nn=typeof Object.is=="function"?Object.is:mS;function mr(i,s){if(nn(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var l=Object.keys(i),u=Object.keys(s);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var p=l[u];if(!is.call(s,p)||!nn(i[p],s[p]))return!1}return!0}function wg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Cg(i,s){var l=wg(i);i=0;for(var u;l;){if(l.nodeType===3){if(u=i+l.textContent.length,i<=s&&u>=s)return{node:l,offset:s-i};i=u}t:{for(;l;){if(l.nextSibling){l=l.nextSibling;break t}l=l.parentNode}l=void 0}l=wg(l)}}function Tg(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Tg(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function xg(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=nl(i.document);s instanceof i.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)i=s.contentWindow;else break;s=nl(i.document)}return s}function Bu(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var _S=Kn&&"documentMode"in document&&11>=document.documentMode,ta=null,Fu=null,_r=null,Hu=!1;function Rg(i,s,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Hu||ta==null||ta!==nl(u)||(u=ta,"selectionStart"in u&&Bu(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),_r&&mr(_r,u)||(_r=u,u=$l(Fu,"onSelect"),0<u.length&&(s=new ol("onSelect","select",null,s,l),i.push({event:s,listeners:u}),s.target=ta)))}function os(i,s){var l={};return l[i.toLowerCase()]=s.toLowerCase(),l["Webkit"+i]="webkit"+s,l["Moz"+i]="moz"+s,l}var ea={animationend:os("Animation","AnimationEnd"),animationiteration:os("Animation","AnimationIteration"),animationstart:os("Animation","AnimationStart"),transitionrun:os("Transition","TransitionRun"),transitionstart:os("Transition","TransitionStart"),transitioncancel:os("Transition","TransitionCancel"),transitionend:os("Transition","TransitionEnd")},zu={},Dg={};Kn&&(Dg=document.createElement("div").style,"AnimationEvent"in window||(delete ea.animationend.animation,delete ea.animationiteration.animation,delete ea.animationstart.animation),"TransitionEvent"in window||delete ea.transitionend.transition);function ls(i){if(zu[i])return zu[i];if(!ea[i])return i;var s=ea[i],l;for(l in s)if(s.hasOwnProperty(l)&&l in Dg)return zu[i]=s[l];return i}var Mg=ls("animationend"),Ng=ls("animationiteration"),Og=ls("animationstart"),yS=ls("transitionrun"),bS=ls("transitionstart"),vS=ls("transitioncancel"),kg=ls("transitionend"),Lg=new Map,Uu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Uu.push("scrollEnd");function Tn(i,s){Lg.set(i,s),as(s,[i])}var Ig=new WeakMap;function pn(i,s){if(typeof i=="object"&&i!==null){var l=Ig.get(i);return l!==void 0?l:(s={value:i,source:s,stack:Qp(s)},Ig.set(i,s),s)}return{value:i,source:s,stack:Qp(s)}}var gn=[],na=0,ju=0;function ul(){for(var i=na,s=ju=na=0;s<i;){var l=gn[s];gn[s++]=null;var u=gn[s];gn[s++]=null;var p=gn[s];gn[s++]=null;var m=gn[s];if(gn[s++]=null,u!==null&&p!==null){var v=u.pending;v===null?p.next=p:(p.next=v.next,v.next=p),u.pending=p}m!==0&&Pg(l,p,m)}}function hl(i,s,l,u){gn[na++]=i,gn[na++]=s,gn[na++]=l,gn[na++]=u,ju|=u,i.lanes|=u,i=i.alternate,i!==null&&(i.lanes|=u)}function Gu(i,s,l,u){return hl(i,s,l,u),dl(i)}function ia(i,s){return hl(i,null,null,s),dl(i)}function Pg(i,s,l){i.lanes|=l;var u=i.alternate;u!==null&&(u.lanes|=l);for(var p=!1,m=i.return;m!==null;)m.childLanes|=l,u=m.alternate,u!==null&&(u.childLanes|=l),m.tag===22&&(i=m.stateNode,i===null||i._visibility&1||(p=!0)),i=m,m=m.return;return i.tag===3?(m=i.stateNode,p&&s!==null&&(p=31-en(l),i=m.hiddenUpdates,u=i[p],u===null?i[p]=[s]:u.push(s),s.lane=l|536870912),m):null}function dl(i){if(50<jr)throw jr=0,Wh=null,Error(n(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var sa={};function AS(i,s,l,u){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sn(i,s,l,u){return new AS(i,s,l,u)}function Vu(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Qn(i,s){var l=i.alternate;return l===null?(l=sn(i.tag,s,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=s,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&65011712,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,s=i.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l.refCleanup=i.refCleanup,l}function Bg(i,s){i.flags&=65011714;var l=i.alternate;return l===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,s=l.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function fl(i,s,l,u,p,m){var v=0;if(u=i,typeof i=="function")Vu(i)&&(v=1);else if(typeof i=="string")v=EE(i,l,rt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case K:return i=sn(31,l,s,p),i.elementType=K,i.lanes=m,i;case A:return cs(l.children,p,m,s);case S:v=8,p|=24;break;case C:return i=sn(12,l,s,p|2),i.elementType=C,i.lanes=m,i;case O:return i=sn(13,l,s,p),i.elementType=O,i.lanes=m,i;case P:return i=sn(19,l,s,p),i.elementType=P,i.lanes=m,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case w:case x:v=10;break t;case D:v=9;break t;case k:v=11;break t;case j:v=14;break t;case Y:v=16,u=null;break t}v=29,l=Error(n(130,i===null?"null":typeof i,"")),u=null}return s=sn(v,l,s,p),s.elementType=i,s.type=u,s.lanes=m,s}function cs(i,s,l,u){return i=sn(7,i,u,s),i.lanes=l,i}function qu(i,s,l){return i=sn(6,i,null,s),i.lanes=l,i}function Yu(i,s,l){return s=sn(4,i.children!==null?i.children:[],i.key,s),s.lanes=l,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var aa=[],ra=0,pl=null,gl=0,mn=[],_n=0,us=null,Zn=1,Jn="";function hs(i,s){aa[ra++]=gl,aa[ra++]=pl,pl=i,gl=s}function Fg(i,s,l){mn[_n++]=Zn,mn[_n++]=Jn,mn[_n++]=us,us=i;var u=Zn;i=Jn;var p=32-en(u)-1;u&=~(1<<p),l+=1;var m=32-en(s)+p;if(30<m){var v=p-p%5;m=(u&(1<<v)-1).toString(32),u>>=v,p-=v,Zn=1<<32-en(s)+p|l<<p|u,Jn=m+i}else Zn=1<<m|l<<p|u,Jn=i}function Xu(i){i.return!==null&&(hs(i,1),Fg(i,1,0))}function $u(i){for(;i===pl;)pl=aa[--ra],aa[ra]=null,gl=aa[--ra],aa[ra]=null;for(;i===us;)us=mn[--_n],mn[_n]=null,Jn=mn[--_n],mn[_n]=null,Zn=mn[--_n],mn[_n]=null}var Fe=null,ne=null,It=!1,ds=null,In=!1,Wu=Error(n(519));function fs(i){var s=Error(n(418,""));throw vr(pn(s,i)),Wu}function Hg(i){var s=i.stateNode,l=i.type,u=i.memoizedProps;switch(s[Le]=i,s[Ge]=u,l){case"dialog":Mt("cancel",s),Mt("close",s);break;case"iframe":case"object":case"embed":Mt("load",s);break;case"video":case"audio":for(l=0;l<Vr.length;l++)Mt(Vr[l],s);break;case"source":Mt("error",s);break;case"img":case"image":case"link":Mt("error",s),Mt("load",s);break;case"details":Mt("toggle",s);break;case"input":Mt("invalid",s),tg(s,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0),el(s);break;case"select":Mt("invalid",s);break;case"textarea":Mt("invalid",s),ng(s,u.value,u.defaultValue,u.children),el(s)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||u.suppressHydrationWarning===!0||ny(s.textContent,l)?(u.popover!=null&&(Mt("beforetoggle",s),Mt("toggle",s)),u.onScroll!=null&&Mt("scroll",s),u.onScrollEnd!=null&&Mt("scrollend",s),u.onClick!=null&&(s.onclick=Wl),s=!0):s=!1,s||fs(i)}function zg(i){for(Fe=i.return;Fe;)switch(Fe.tag){case 5:case 13:In=!1;return;case 27:case 3:In=!0;return;default:Fe=Fe.return}}function yr(i){if(i!==Fe)return!1;if(!It)return zg(i),It=!0,!1;var s=i.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=i.type,l=!(l!=="form"&&l!=="button")||hd(i.type,i.memoizedProps)),l=!l),l&&ne&&fs(i),zg(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));t:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8)if(l=i.data,l==="/$"){if(s===0){ne=Rn(i.nextSibling);break t}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++;i=i.nextSibling}ne=null}}else s===27?(s=ne,Fi(i.type)?(i=gd,gd=null,ne=i):ne=s):ne=Fe?Rn(i.stateNode.nextSibling):null;return!0}function br(){ne=Fe=null,It=!1}function Ug(){var i=ds;return i!==null&&(Xe===null?Xe=i:Xe.push.apply(Xe,i),ds=null),i}function vr(i){ds===null?ds=[i]:ds.push(i)}var Ku=H(null),ps=null,ti=null;function Ei(i,s,l){W(Ku,s._currentValue),s._currentValue=l}function ei(i){i._currentValue=Ku.current,X(Ku)}function Qu(i,s,l){for(;i!==null;){var u=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),i===l)break;i=i.return}}function Zu(i,s,l,u){var p=i.child;for(p!==null&&(p.return=i);p!==null;){var m=p.dependencies;if(m!==null){var v=p.child;m=m.firstContext;t:for(;m!==null;){var E=m;m=p;for(var R=0;R<s.length;R++)if(E.context===s[R]){m.lanes|=l,E=m.alternate,E!==null&&(E.lanes|=l),Qu(m.return,l,i),u||(v=null);break t}m=E.next}}else if(p.tag===18){if(v=p.return,v===null)throw Error(n(341));v.lanes|=l,m=v.alternate,m!==null&&(m.lanes|=l),Qu(v,l,i),v=null}else v=p.child;if(v!==null)v.return=p;else for(v=p;v!==null;){if(v===i){v=null;break}if(p=v.sibling,p!==null){p.return=v.return,v=p;break}v=v.return}p=v}}function Ar(i,s,l,u){i=null;for(var p=s,m=!1;p!==null;){if(!m){if((p.flags&524288)!==0)m=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var v=p.alternate;if(v===null)throw Error(n(387));if(v=v.memoizedProps,v!==null){var E=p.type;nn(p.pendingProps.value,v.value)||(i!==null?i.push(E):i=[E])}}else if(p===Nt.current){if(v=p.alternate,v===null)throw Error(n(387));v.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(i!==null?i.push(Kr):i=[Kr])}p=p.return}i!==null&&Zu(s,i,l,u),s.flags|=262144}function ml(i){for(i=i.firstContext;i!==null;){if(!nn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function gs(i){ps=i,ti=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Ie(i){return jg(ps,i)}function _l(i,s){return ps===null&&gs(i),jg(i,s)}function jg(i,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},ti===null){if(i===null)throw Error(n(308));ti=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else ti=ti.next=s;return l}var SS=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(l,u){i.push(u)}};this.abort=function(){s.aborted=!0,i.forEach(function(l){return l()})}},ES=r.unstable_scheduleCallback,wS=r.unstable_NormalPriority,me={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ju(){return{controller:new SS,data:new Map,refCount:0}}function Sr(i){i.refCount--,i.refCount===0&&ES(wS,function(){i.controller.abort()})}var Er=null,th=0,oa=0,la=null;function CS(i,s){if(Er===null){var l=Er=[];th=0,oa=nd(),la={status:"pending",value:void 0,then:function(u){l.push(u)}}}return th++,s.then(Gg,Gg),s}function Gg(){if(--th===0&&Er!==null){la!==null&&(la.status="fulfilled");var i=Er;Er=null,oa=0,la=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function TS(i,s){var l=[],u={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return i.then(function(){u.status="fulfilled",u.value=s;for(var p=0;p<l.length;p++)(0,l[p])(s)},function(p){for(u.status="rejected",u.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),u}var Vg=I.S;I.S=function(i,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&CS(i,s),Vg!==null&&Vg(i,s)};var ms=H(null);function eh(){var i=ms.current;return i!==null?i:Xt.pooledCache}function yl(i,s){s===null?W(ms,ms.current):W(ms,s.pool)}function qg(){var i=eh();return i===null?null:{parent:me._currentValue,pool:i}}var wr=Error(n(460)),Yg=Error(n(474)),bl=Error(n(542)),nh={then:function(){}};function Xg(i){return i=i.status,i==="fulfilled"||i==="rejected"}function vl(){}function $g(i,s,l){switch(l=i[l],l===void 0?i.push(s):l!==s&&(s.then(vl,vl),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Kg(i),i;default:if(typeof s.status=="string")s.then(vl,vl);else{if(i=Xt,i!==null&&100<i.shellSuspendCounter)throw Error(n(482));i=s,i.status="pending",i.then(function(u){if(s.status==="pending"){var p=s;p.status="fulfilled",p.value=u}},function(u){if(s.status==="pending"){var p=s;p.status="rejected",p.reason=u}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Kg(i),i}throw Cr=s,wr}}var Cr=null;function Wg(){if(Cr===null)throw Error(n(459));var i=Cr;return Cr=null,i}function Kg(i){if(i===wr||i===bl)throw Error(n(483))}var wi=!1;function ih(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function sh(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ci(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Ti(i,s,l){var u=i.updateQueue;if(u===null)return null;if(u=u.shared,(Ft&2)!==0){var p=u.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),u.pending=s,s=dl(i),Pg(i,null,l),s}return hl(i,u,s,l),dl(i)}function Tr(i,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var u=s.lanes;u&=i.pendingLanes,l|=u,s.lanes=l,Gp(i,l)}}function ah(i,s){var l=i.updateQueue,u=i.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var p=null,m=null;if(l=l.firstBaseUpdate,l!==null){do{var v={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};m===null?p=m=v:m=m.next=v,l=l.next}while(l!==null);m===null?p=m=s:m=m.next=s}else p=m=s;l={baseState:u.baseState,firstBaseUpdate:p,lastBaseUpdate:m,shared:u.shared,callbacks:u.callbacks},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=s:i.next=s,l.lastBaseUpdate=s}var rh=!1;function xr(){if(rh){var i=la;if(i!==null)throw i}}function Rr(i,s,l,u){rh=!1;var p=i.updateQueue;wi=!1;var m=p.firstBaseUpdate,v=p.lastBaseUpdate,E=p.shared.pending;if(E!==null){p.shared.pending=null;var R=E,F=R.next;R.next=null,v===null?m=F:v.next=F,v=R;var G=i.alternate;G!==null&&(G=G.updateQueue,E=G.lastBaseUpdate,E!==v&&(E===null?G.firstBaseUpdate=F:E.next=F,G.lastBaseUpdate=R))}if(m!==null){var $=p.baseState;v=0,G=F=R=null,E=m;do{var z=E.lane&-536870913,U=z!==E.lane;if(U?(kt&z)===z:(u&z)===z){z!==0&&z===oa&&(rh=!0),G!==null&&(G=G.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});t:{var pt=i,ut=E;z=s;var Gt=l;switch(ut.tag){case 1:if(pt=ut.payload,typeof pt=="function"){$=pt.call(Gt,$,z);break t}$=pt;break t;case 3:pt.flags=pt.flags&-65537|128;case 0:if(pt=ut.payload,z=typeof pt=="function"?pt.call(Gt,$,z):pt,z==null)break t;$=g({},$,z);break t;case 2:wi=!0}}z=E.callback,z!==null&&(i.flags|=64,U&&(i.flags|=8192),U=p.callbacks,U===null?p.callbacks=[z]:U.push(z))}else U={lane:z,tag:E.tag,payload:E.payload,callback:E.callback,next:null},G===null?(F=G=U,R=$):G=G.next=U,v|=z;if(E=E.next,E===null){if(E=p.shared.pending,E===null)break;U=E,E=U.next,U.next=null,p.lastBaseUpdate=U,p.shared.pending=null}}while(!0);G===null&&(R=$),p.baseState=R,p.firstBaseUpdate=F,p.lastBaseUpdate=G,m===null&&(p.shared.lanes=0),Li|=v,i.lanes=v,i.memoizedState=$}}function Qg(i,s){if(typeof i!="function")throw Error(n(191,i));i.call(s)}function Zg(i,s){var l=i.callbacks;if(l!==null)for(i.callbacks=null,i=0;i<l.length;i++)Qg(l[i],s)}var ca=H(null),Al=H(0);function Jg(i,s){i=li,W(Al,i),W(ca,s),li=i|s.baseLanes}function oh(){W(Al,li),W(ca,ca.current)}function lh(){li=Al.current,X(ca),X(Al)}var xi=0,Et=null,Ut=null,ce=null,Sl=!1,ua=!1,_s=!1,El=0,Dr=0,ha=null,xS=0;function se(){throw Error(n(321))}function ch(i,s){if(s===null)return!1;for(var l=0;l<s.length&&l<i.length;l++)if(!nn(i[l],s[l]))return!1;return!0}function uh(i,s,l,u,p,m){return xi=m,Et=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,I.H=i===null||i.memoizedState===null?Pm:Bm,_s=!1,m=l(u,p),_s=!1,ua&&(m=em(s,l,u,p)),tm(i),m}function tm(i){I.H=Dl;var s=Ut!==null&&Ut.next!==null;if(xi=0,ce=Ut=Et=null,Sl=!1,Dr=0,ha=null,s)throw Error(n(300));i===null||be||(i=i.dependencies,i!==null&&ml(i)&&(be=!0))}function em(i,s,l,u){Et=i;var p=0;do{if(ua&&(ha=null),Dr=0,ua=!1,25<=p)throw Error(n(301));if(p+=1,ce=Ut=null,i.updateQueue!=null){var m=i.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}I.H=LS,m=s(l,u)}while(ua);return m}function RS(){var i=I.H,s=i.useState()[0];return s=typeof s.then=="function"?Mr(s):s,i=i.useState()[0],(Ut!==null?Ut.memoizedState:null)!==i&&(Et.flags|=1024),s}function hh(){var i=El!==0;return El=0,i}function dh(i,s,l){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~l}function fh(i){if(Sl){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Sl=!1}xi=0,ce=Ut=Et=null,ua=!1,Dr=El=0,ha=null}function qe(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ce===null?Et.memoizedState=ce=i:ce=ce.next=i,ce}function ue(){if(Ut===null){var i=Et.alternate;i=i!==null?i.memoizedState:null}else i=Ut.next;var s=ce===null?Et.memoizedState:ce.next;if(s!==null)ce=s,Ut=i;else{if(i===null)throw Et.alternate===null?Error(n(467)):Error(n(310));Ut=i,i={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},ce===null?Et.memoizedState=ce=i:ce=ce.next=i}return ce}function ph(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Mr(i){var s=Dr;return Dr+=1,ha===null&&(ha=[]),i=$g(ha,i,s),s=Et,(ce===null?s.memoizedState:ce.next)===null&&(s=s.alternate,I.H=s===null||s.memoizedState===null?Pm:Bm),i}function wl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Mr(i);if(i.$$typeof===x)return Ie(i)}throw Error(n(438,String(i)))}function gh(i){var s=null,l=Et.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var u=Et.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(s={data:u.data.map(function(p){return p.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=ph(),Et.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(i),u=0;u<i;u++)l[u]=it;return s.index++,l}function ni(i,s){return typeof s=="function"?s(i):s}function Cl(i){var s=ue();return mh(s,Ut,i)}function mh(i,s,l){var u=i.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=l;var p=i.baseQueue,m=u.pending;if(m!==null){if(p!==null){var v=p.next;p.next=m.next,m.next=v}s.baseQueue=p=m,u.pending=null}if(m=i.baseState,p===null)i.memoizedState=m;else{s=p.next;var E=v=null,R=null,F=s,G=!1;do{var $=F.lane&-536870913;if($!==F.lane?(kt&$)===$:(xi&$)===$){var z=F.revertLane;if(z===0)R!==null&&(R=R.next={lane:0,revertLane:0,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),$===oa&&(G=!0);else if((xi&z)===z){F=F.next,z===oa&&(G=!0);continue}else $={lane:0,revertLane:F.revertLane,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},R===null?(E=R=$,v=m):R=R.next=$,Et.lanes|=z,Li|=z;$=F.action,_s&&l(m,$),m=F.hasEagerState?F.eagerState:l(m,$)}else z={lane:$,revertLane:F.revertLane,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},R===null?(E=R=z,v=m):R=R.next=z,Et.lanes|=$,Li|=$;F=F.next}while(F!==null&&F!==s);if(R===null?v=m:R.next=E,!nn(m,i.memoizedState)&&(be=!0,G&&(l=la,l!==null)))throw l;i.memoizedState=m,i.baseState=v,i.baseQueue=R,u.lastRenderedState=m}return p===null&&(u.lanes=0),[i.memoizedState,u.dispatch]}function _h(i){var s=ue(),l=s.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=i;var u=l.dispatch,p=l.pending,m=s.memoizedState;if(p!==null){l.pending=null;var v=p=p.next;do m=i(m,v.action),v=v.next;while(v!==p);nn(m,s.memoizedState)||(be=!0),s.memoizedState=m,s.baseQueue===null&&(s.baseState=m),l.lastRenderedState=m}return[m,u]}function nm(i,s,l){var u=Et,p=ue(),m=It;if(m){if(l===void 0)throw Error(n(407));l=l()}else l=s();var v=!nn((Ut||p).memoizedState,l);v&&(p.memoizedState=l,be=!0),p=p.queue;var E=am.bind(null,u,p,i);if(Nr(2048,8,E,[i]),p.getSnapshot!==s||v||ce!==null&&ce.memoizedState.tag&1){if(u.flags|=2048,da(9,Tl(),sm.bind(null,u,p,l,s),null),Xt===null)throw Error(n(349));m||(xi&124)!==0||im(u,s,l)}return l}function im(i,s,l){i.flags|=16384,i={getSnapshot:s,value:l},s=Et.updateQueue,s===null?(s=ph(),Et.updateQueue=s,s.stores=[i]):(l=s.stores,l===null?s.stores=[i]:l.push(i))}function sm(i,s,l,u){s.value=l,s.getSnapshot=u,rm(s)&&om(i)}function am(i,s,l){return l(function(){rm(s)&&om(i)})}function rm(i){var s=i.getSnapshot;i=i.value;try{var l=s();return!nn(i,l)}catch{return!0}}function om(i){var s=ia(i,2);s!==null&&cn(s,i,2)}function yh(i){var s=qe();if(typeof i=="function"){var l=i;if(i=l(),_s){vi(!0);try{l()}finally{vi(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:i},s}function lm(i,s,l,u){return i.baseState=l,mh(i,Ut,typeof u=="function"?u:ni)}function DS(i,s,l,u,p){if(Rl(i))throw Error(n(485));if(i=s.action,i!==null){var m={payload:p,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){m.listeners.push(v)}};I.T!==null?l(!0):m.isTransition=!1,u(m),l=s.pending,l===null?(m.next=s.pending=m,cm(s,m)):(m.next=l.next,s.pending=l.next=m)}}function cm(i,s){var l=s.action,u=s.payload,p=i.state;if(s.isTransition){var m=I.T,v={};I.T=v;try{var E=l(p,u),R=I.S;R!==null&&R(v,E),um(i,s,E)}catch(F){bh(i,s,F)}finally{I.T=m}}else try{m=l(p,u),um(i,s,m)}catch(F){bh(i,s,F)}}function um(i,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){hm(i,s,u)},function(u){return bh(i,s,u)}):hm(i,s,l)}function hm(i,s,l){s.status="fulfilled",s.value=l,dm(s),i.state=l,s=i.pending,s!==null&&(l=s.next,l===s?i.pending=null:(l=l.next,s.next=l,cm(i,l)))}function bh(i,s,l){var u=i.pending;if(i.pending=null,u!==null){u=u.next;do s.status="rejected",s.reason=l,dm(s),s=s.next;while(s!==u)}i.action=null}function dm(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function fm(i,s){return s}function pm(i,s){if(It){var l=Xt.formState;if(l!==null){t:{var u=Et;if(It){if(ne){e:{for(var p=ne,m=In;p.nodeType!==8;){if(!m){p=null;break e}if(p=Rn(p.nextSibling),p===null){p=null;break e}}m=p.data,p=m==="F!"||m==="F"?p:null}if(p){ne=Rn(p.nextSibling),u=p.data==="F!";break t}}fs(u)}u=!1}u&&(s=l[0])}}return l=qe(),l.memoizedState=l.baseState=s,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fm,lastRenderedState:s},l.queue=u,l=km.bind(null,Et,u),u.dispatch=l,u=yh(!1),m=wh.bind(null,Et,!1,u.queue),u=qe(),p={state:s,dispatch:null,action:i,pending:null},u.queue=p,l=DS.bind(null,Et,p,m,l),p.dispatch=l,u.memoizedState=i,[s,l,!1]}function gm(i){var s=ue();return mm(s,Ut,i)}function mm(i,s,l){if(s=mh(i,s,fm)[0],i=Cl(ni)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var u=Mr(s)}catch(v){throw v===wr?bl:v}else u=s;s=ue();var p=s.queue,m=p.dispatch;return l!==s.memoizedState&&(Et.flags|=2048,da(9,Tl(),MS.bind(null,p,l),null)),[u,m,i]}function MS(i,s){i.action=s}function _m(i){var s=ue(),l=Ut;if(l!==null)return mm(s,l,i);ue(),s=s.memoizedState,l=ue();var u=l.queue.dispatch;return l.memoizedState=i,[s,u,!1]}function da(i,s,l,u){return i={tag:i,create:l,deps:u,inst:s,next:null},s=Et.updateQueue,s===null&&(s=ph(),Et.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=i.next=i:(u=l.next,l.next=i,i.next=u,s.lastEffect=i),i}function Tl(){return{destroy:void 0,resource:void 0}}function ym(){return ue().memoizedState}function xl(i,s,l,u){var p=qe();u=u===void 0?null:u,Et.flags|=i,p.memoizedState=da(1|s,Tl(),l,u)}function Nr(i,s,l,u){var p=ue();u=u===void 0?null:u;var m=p.memoizedState.inst;Ut!==null&&u!==null&&ch(u,Ut.memoizedState.deps)?p.memoizedState=da(s,m,l,u):(Et.flags|=i,p.memoizedState=da(1|s,m,l,u))}function bm(i,s){xl(8390656,8,i,s)}function vm(i,s){Nr(2048,8,i,s)}function Am(i,s){return Nr(4,2,i,s)}function Sm(i,s){return Nr(4,4,i,s)}function Em(i,s){if(typeof s=="function"){i=i();var l=s(i);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function wm(i,s,l){l=l!=null?l.concat([i]):null,Nr(4,4,Em.bind(null,s,i),l)}function vh(){}function Cm(i,s){var l=ue();s=s===void 0?null:s;var u=l.memoizedState;return s!==null&&ch(s,u[1])?u[0]:(l.memoizedState=[i,s],i)}function Tm(i,s){var l=ue();s=s===void 0?null:s;var u=l.memoizedState;if(s!==null&&ch(s,u[1]))return u[0];if(u=i(),_s){vi(!0);try{i()}finally{vi(!1)}}return l.memoizedState=[u,s],u}function Ah(i,s,l){return l===void 0||(xi&1073741824)!==0?i.memoizedState=s:(i.memoizedState=l,i=D_(),Et.lanes|=i,Li|=i,l)}function xm(i,s,l,u){return nn(l,s)?l:ca.current!==null?(i=Ah(i,l,u),nn(i,s)||(be=!0),i):(xi&42)===0?(be=!0,i.memoizedState=l):(i=D_(),Et.lanes|=i,Li|=i,s)}function Rm(i,s,l,u,p){var m=M.p;M.p=m!==0&&8>m?m:8;var v=I.T,E={};I.T=E,wh(i,!1,s,l);try{var R=p(),F=I.S;if(F!==null&&F(E,R),R!==null&&typeof R=="object"&&typeof R.then=="function"){var G=TS(R,u);Or(i,s,G,ln(i))}else Or(i,s,u,ln(i))}catch($){Or(i,s,{then:function(){},status:"rejected",reason:$},ln())}finally{M.p=m,I.T=v}}function NS(){}function Sh(i,s,l,u){if(i.tag!==5)throw Error(n(476));var p=Dm(i).queue;Rm(i,p,s,V,l===null?NS:function(){return Mm(i),l(u)})}function Dm(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:V,baseState:V,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:V},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:l},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Mm(i){var s=Dm(i).next.queue;Or(i,s,{},ln())}function Eh(){return Ie(Kr)}function Nm(){return ue().memoizedState}function Om(){return ue().memoizedState}function OS(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var l=ln();i=Ci(l);var u=Ti(s,i,l);u!==null&&(cn(u,s,l),Tr(u,s,l)),s={cache:Ju()},i.payload=s;return}s=s.return}}function kS(i,s,l){var u=ln();l={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},Rl(i)?Lm(s,l):(l=Gu(i,s,l,u),l!==null&&(cn(l,i,u),Im(l,s,u)))}function km(i,s,l){var u=ln();Or(i,s,l,u)}function Or(i,s,l,u){var p={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(Rl(i))Lm(s,p);else{var m=i.alternate;if(i.lanes===0&&(m===null||m.lanes===0)&&(m=s.lastRenderedReducer,m!==null))try{var v=s.lastRenderedState,E=m(v,l);if(p.hasEagerState=!0,p.eagerState=E,nn(E,v))return hl(i,s,p,0),Xt===null&&ul(),!1}catch{}finally{}if(l=Gu(i,s,p,u),l!==null)return cn(l,i,u),Im(l,s,u),!0}return!1}function wh(i,s,l,u){if(u={lane:2,revertLane:nd(),action:u,hasEagerState:!1,eagerState:null,next:null},Rl(i)){if(s)throw Error(n(479))}else s=Gu(i,l,u,2),s!==null&&cn(s,i,2)}function Rl(i){var s=i.alternate;return i===Et||s!==null&&s===Et}function Lm(i,s){ua=Sl=!0;var l=i.pending;l===null?s.next=s:(s.next=l.next,l.next=s),i.pending=s}function Im(i,s,l){if((l&4194048)!==0){var u=s.lanes;u&=i.pendingLanes,l|=u,s.lanes=l,Gp(i,l)}}var Dl={readContext:Ie,use:wl,useCallback:se,useContext:se,useEffect:se,useImperativeHandle:se,useLayoutEffect:se,useInsertionEffect:se,useMemo:se,useReducer:se,useRef:se,useState:se,useDebugValue:se,useDeferredValue:se,useTransition:se,useSyncExternalStore:se,useId:se,useHostTransitionStatus:se,useFormState:se,useActionState:se,useOptimistic:se,useMemoCache:se,useCacheRefresh:se},Pm={readContext:Ie,use:wl,useCallback:function(i,s){return qe().memoizedState=[i,s===void 0?null:s],i},useContext:Ie,useEffect:bm,useImperativeHandle:function(i,s,l){l=l!=null?l.concat([i]):null,xl(4194308,4,Em.bind(null,s,i),l)},useLayoutEffect:function(i,s){return xl(4194308,4,i,s)},useInsertionEffect:function(i,s){xl(4,2,i,s)},useMemo:function(i,s){var l=qe();s=s===void 0?null:s;var u=i();if(_s){vi(!0);try{i()}finally{vi(!1)}}return l.memoizedState=[u,s],u},useReducer:function(i,s,l){var u=qe();if(l!==void 0){var p=l(s);if(_s){vi(!0);try{l(s)}finally{vi(!1)}}}else p=s;return u.memoizedState=u.baseState=p,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:p},u.queue=i,i=i.dispatch=kS.bind(null,Et,i),[u.memoizedState,i]},useRef:function(i){var s=qe();return i={current:i},s.memoizedState=i},useState:function(i){i=yh(i);var s=i.queue,l=km.bind(null,Et,s);return s.dispatch=l,[i.memoizedState,l]},useDebugValue:vh,useDeferredValue:function(i,s){var l=qe();return Ah(l,i,s)},useTransition:function(){var i=yh(!1);return i=Rm.bind(null,Et,i.queue,!0,!1),qe().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,l){var u=Et,p=qe();if(It){if(l===void 0)throw Error(n(407));l=l()}else{if(l=s(),Xt===null)throw Error(n(349));(kt&124)!==0||im(u,s,l)}p.memoizedState=l;var m={value:l,getSnapshot:s};return p.queue=m,bm(am.bind(null,u,m,i),[i]),u.flags|=2048,da(9,Tl(),sm.bind(null,u,m,l,s),null),l},useId:function(){var i=qe(),s=Xt.identifierPrefix;if(It){var l=Jn,u=Zn;l=(u&~(1<<32-en(u)-1)).toString(32)+l,s="«"+s+"R"+l,l=El++,0<l&&(s+="H"+l.toString(32)),s+="»"}else l=xS++,s="«"+s+"r"+l.toString(32)+"»";return i.memoizedState=s},useHostTransitionStatus:Eh,useFormState:pm,useActionState:pm,useOptimistic:function(i){var s=qe();s.memoizedState=s.baseState=i;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=wh.bind(null,Et,!0,l),l.dispatch=s,[i,s]},useMemoCache:gh,useCacheRefresh:function(){return qe().memoizedState=OS.bind(null,Et)}},Bm={readContext:Ie,use:wl,useCallback:Cm,useContext:Ie,useEffect:vm,useImperativeHandle:wm,useInsertionEffect:Am,useLayoutEffect:Sm,useMemo:Tm,useReducer:Cl,useRef:ym,useState:function(){return Cl(ni)},useDebugValue:vh,useDeferredValue:function(i,s){var l=ue();return xm(l,Ut.memoizedState,i,s)},useTransition:function(){var i=Cl(ni)[0],s=ue().memoizedState;return[typeof i=="boolean"?i:Mr(i),s]},useSyncExternalStore:nm,useId:Nm,useHostTransitionStatus:Eh,useFormState:gm,useActionState:gm,useOptimistic:function(i,s){var l=ue();return lm(l,Ut,i,s)},useMemoCache:gh,useCacheRefresh:Om},LS={readContext:Ie,use:wl,useCallback:Cm,useContext:Ie,useEffect:vm,useImperativeHandle:wm,useInsertionEffect:Am,useLayoutEffect:Sm,useMemo:Tm,useReducer:_h,useRef:ym,useState:function(){return _h(ni)},useDebugValue:vh,useDeferredValue:function(i,s){var l=ue();return Ut===null?Ah(l,i,s):xm(l,Ut.memoizedState,i,s)},useTransition:function(){var i=_h(ni)[0],s=ue().memoizedState;return[typeof i=="boolean"?i:Mr(i),s]},useSyncExternalStore:nm,useId:Nm,useHostTransitionStatus:Eh,useFormState:_m,useActionState:_m,useOptimistic:function(i,s){var l=ue();return Ut!==null?lm(l,Ut,i,s):(l.baseState=i,[i,l.queue.dispatch])},useMemoCache:gh,useCacheRefresh:Om},fa=null,kr=0;function Ml(i){var s=kr;return kr+=1,fa===null&&(fa=[]),$g(fa,i,s)}function Lr(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function Nl(i,s){throw s.$$typeof===_?Error(n(525)):(i=Object.prototype.toString.call(s),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function Fm(i){var s=i._init;return s(i._payload)}function Hm(i){function s(L,N){if(i){var B=L.deletions;B===null?(L.deletions=[N],L.flags|=16):B.push(N)}}function l(L,N){if(!i)return null;for(;N!==null;)s(L,N),N=N.sibling;return null}function u(L){for(var N=new Map;L!==null;)L.key!==null?N.set(L.key,L):N.set(L.index,L),L=L.sibling;return N}function p(L,N){return L=Qn(L,N),L.index=0,L.sibling=null,L}function m(L,N,B){return L.index=B,i?(B=L.alternate,B!==null?(B=B.index,B<N?(L.flags|=67108866,N):B):(L.flags|=67108866,N)):(L.flags|=1048576,N)}function v(L){return i&&L.alternate===null&&(L.flags|=67108866),L}function E(L,N,B,q){return N===null||N.tag!==6?(N=qu(B,L.mode,q),N.return=L,N):(N=p(N,B),N.return=L,N)}function R(L,N,B,q){var st=B.type;return st===A?G(L,N,B.props.children,q,B.key):N!==null&&(N.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===Y&&Fm(st)===N.type)?(N=p(N,B.props),Lr(N,B),N.return=L,N):(N=fl(B.type,B.key,B.props,null,L.mode,q),Lr(N,B),N.return=L,N)}function F(L,N,B,q){return N===null||N.tag!==4||N.stateNode.containerInfo!==B.containerInfo||N.stateNode.implementation!==B.implementation?(N=Yu(B,L.mode,q),N.return=L,N):(N=p(N,B.children||[]),N.return=L,N)}function G(L,N,B,q,st){return N===null||N.tag!==7?(N=cs(B,L.mode,q,st),N.return=L,N):(N=p(N,B),N.return=L,N)}function $(L,N,B){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=qu(""+N,L.mode,B),N.return=L,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case y:return B=fl(N.type,N.key,N.props,null,L.mode,B),Lr(B,N),B.return=L,B;case b:return N=Yu(N,L.mode,B),N.return=L,N;case Y:var q=N._init;return N=q(N._payload),$(L,N,B)}if(bt(N)||ft(N))return N=cs(N,L.mode,B,null),N.return=L,N;if(typeof N.then=="function")return $(L,Ml(N),B);if(N.$$typeof===x)return $(L,_l(L,N),B);Nl(L,N)}return null}function z(L,N,B,q){var st=N!==null?N.key:null;if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return st!==null?null:E(L,N,""+B,q);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case y:return B.key===st?R(L,N,B,q):null;case b:return B.key===st?F(L,N,B,q):null;case Y:return st=B._init,B=st(B._payload),z(L,N,B,q)}if(bt(B)||ft(B))return st!==null?null:G(L,N,B,q,null);if(typeof B.then=="function")return z(L,N,Ml(B),q);if(B.$$typeof===x)return z(L,N,_l(L,B),q);Nl(L,B)}return null}function U(L,N,B,q,st){if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return L=L.get(B)||null,E(N,L,""+q,st);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case y:return L=L.get(q.key===null?B:q.key)||null,R(N,L,q,st);case b:return L=L.get(q.key===null?B:q.key)||null,F(N,L,q,st);case Y:var Ct=q._init;return q=Ct(q._payload),U(L,N,B,q,st)}if(bt(q)||ft(q))return L=L.get(B)||null,G(N,L,q,st,null);if(typeof q.then=="function")return U(L,N,B,Ml(q),st);if(q.$$typeof===x)return U(L,N,B,_l(N,q),st);Nl(N,q)}return null}function pt(L,N,B,q){for(var st=null,Ct=null,ot=N,ht=N=0,Ae=null;ot!==null&&ht<B.length;ht++){ot.index>ht?(Ae=ot,ot=null):Ae=ot.sibling;var Lt=z(L,ot,B[ht],q);if(Lt===null){ot===null&&(ot=Ae);break}i&&ot&&Lt.alternate===null&&s(L,ot),N=m(Lt,N,ht),Ct===null?st=Lt:Ct.sibling=Lt,Ct=Lt,ot=Ae}if(ht===B.length)return l(L,ot),It&&hs(L,ht),st;if(ot===null){for(;ht<B.length;ht++)ot=$(L,B[ht],q),ot!==null&&(N=m(ot,N,ht),Ct===null?st=ot:Ct.sibling=ot,Ct=ot);return It&&hs(L,ht),st}for(ot=u(ot);ht<B.length;ht++)Ae=U(ot,L,ht,B[ht],q),Ae!==null&&(i&&Ae.alternate!==null&&ot.delete(Ae.key===null?ht:Ae.key),N=m(Ae,N,ht),Ct===null?st=Ae:Ct.sibling=Ae,Ct=Ae);return i&&ot.forEach(function(Gi){return s(L,Gi)}),It&&hs(L,ht),st}function ut(L,N,B,q){if(B==null)throw Error(n(151));for(var st=null,Ct=null,ot=N,ht=N=0,Ae=null,Lt=B.next();ot!==null&&!Lt.done;ht++,Lt=B.next()){ot.index>ht?(Ae=ot,ot=null):Ae=ot.sibling;var Gi=z(L,ot,Lt.value,q);if(Gi===null){ot===null&&(ot=Ae);break}i&&ot&&Gi.alternate===null&&s(L,ot),N=m(Gi,N,ht),Ct===null?st=Gi:Ct.sibling=Gi,Ct=Gi,ot=Ae}if(Lt.done)return l(L,ot),It&&hs(L,ht),st;if(ot===null){for(;!Lt.done;ht++,Lt=B.next())Lt=$(L,Lt.value,q),Lt!==null&&(N=m(Lt,N,ht),Ct===null?st=Lt:Ct.sibling=Lt,Ct=Lt);return It&&hs(L,ht),st}for(ot=u(ot);!Lt.done;ht++,Lt=B.next())Lt=U(ot,L,ht,Lt.value,q),Lt!==null&&(i&&Lt.alternate!==null&&ot.delete(Lt.key===null?ht:Lt.key),N=m(Lt,N,ht),Ct===null?st=Lt:Ct.sibling=Lt,Ct=Lt);return i&&ot.forEach(function(IE){return s(L,IE)}),It&&hs(L,ht),st}function Gt(L,N,B,q){if(typeof B=="object"&&B!==null&&B.type===A&&B.key===null&&(B=B.props.children),typeof B=="object"&&B!==null){switch(B.$$typeof){case y:t:{for(var st=B.key;N!==null;){if(N.key===st){if(st=B.type,st===A){if(N.tag===7){l(L,N.sibling),q=p(N,B.props.children),q.return=L,L=q;break t}}else if(N.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===Y&&Fm(st)===N.type){l(L,N.sibling),q=p(N,B.props),Lr(q,B),q.return=L,L=q;break t}l(L,N);break}else s(L,N);N=N.sibling}B.type===A?(q=cs(B.props.children,L.mode,q,B.key),q.return=L,L=q):(q=fl(B.type,B.key,B.props,null,L.mode,q),Lr(q,B),q.return=L,L=q)}return v(L);case b:t:{for(st=B.key;N!==null;){if(N.key===st)if(N.tag===4&&N.stateNode.containerInfo===B.containerInfo&&N.stateNode.implementation===B.implementation){l(L,N.sibling),q=p(N,B.children||[]),q.return=L,L=q;break t}else{l(L,N);break}else s(L,N);N=N.sibling}q=Yu(B,L.mode,q),q.return=L,L=q}return v(L);case Y:return st=B._init,B=st(B._payload),Gt(L,N,B,q)}if(bt(B))return pt(L,N,B,q);if(ft(B)){if(st=ft(B),typeof st!="function")throw Error(n(150));return B=st.call(B),ut(L,N,B,q)}if(typeof B.then=="function")return Gt(L,N,Ml(B),q);if(B.$$typeof===x)return Gt(L,N,_l(L,B),q);Nl(L,B)}return typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint"?(B=""+B,N!==null&&N.tag===6?(l(L,N.sibling),q=p(N,B),q.return=L,L=q):(l(L,N),q=qu(B,L.mode,q),q.return=L,L=q),v(L)):l(L,N)}return function(L,N,B,q){try{kr=0;var st=Gt(L,N,B,q);return fa=null,st}catch(ot){if(ot===wr||ot===bl)throw ot;var Ct=sn(29,ot,null,L.mode);return Ct.lanes=q,Ct.return=L,Ct}finally{}}}var pa=Hm(!0),zm=Hm(!1),yn=H(null),Pn=null;function Ri(i){var s=i.alternate;W(_e,_e.current&1),W(yn,i),Pn===null&&(s===null||ca.current!==null||s.memoizedState!==null)&&(Pn=i)}function Um(i){if(i.tag===22){if(W(_e,_e.current),W(yn,i),Pn===null){var s=i.alternate;s!==null&&s.memoizedState!==null&&(Pn=i)}}else Di()}function Di(){W(_e,_e.current),W(yn,yn.current)}function ii(i){X(yn),Pn===i&&(Pn=null),X(_e)}var _e=H(0);function Ol(i){for(var s=i;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||pd(l)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Ch(i,s,l,u){s=i.memoizedState,l=l(u,s),l=l==null?s:g({},s,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var Th={enqueueSetState:function(i,s,l){i=i._reactInternals;var u=ln(),p=Ci(u);p.payload=s,l!=null&&(p.callback=l),s=Ti(i,p,u),s!==null&&(cn(s,i,u),Tr(s,i,u))},enqueueReplaceState:function(i,s,l){i=i._reactInternals;var u=ln(),p=Ci(u);p.tag=1,p.payload=s,l!=null&&(p.callback=l),s=Ti(i,p,u),s!==null&&(cn(s,i,u),Tr(s,i,u))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var l=ln(),u=Ci(l);u.tag=2,s!=null&&(u.callback=s),s=Ti(i,u,l),s!==null&&(cn(s,i,l),Tr(s,i,l))}};function jm(i,s,l,u,p,m,v){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(u,m,v):s.prototype&&s.prototype.isPureReactComponent?!mr(l,u)||!mr(p,m):!0}function Gm(i,s,l,u){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,u),s.state!==i&&Th.enqueueReplaceState(s,s.state,null)}function ys(i,s){var l=s;if("ref"in s){l={};for(var u in s)u!=="ref"&&(l[u]=s[u])}if(i=i.defaultProps){l===s&&(l=g({},l));for(var p in i)l[p]===void 0&&(l[p]=i[p])}return l}var kl=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Vm(i){kl(i)}function qm(i){console.error(i)}function Ym(i){kl(i)}function Ll(i,s){try{var l=i.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(u){setTimeout(function(){throw u})}}function Xm(i,s,l){try{var u=i.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function xh(i,s,l){return l=Ci(l),l.tag=3,l.payload={element:null},l.callback=function(){Ll(i,s)},l}function $m(i){return i=Ci(i),i.tag=3,i}function Wm(i,s,l,u){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var m=u.value;i.payload=function(){return p(m)},i.callback=function(){Xm(s,l,u)}}var v=l.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(i.callback=function(){Xm(s,l,u),typeof p!="function"&&(Ii===null?Ii=new Set([this]):Ii.add(this));var E=u.stack;this.componentDidCatch(u.value,{componentStack:E!==null?E:""})})}function IS(i,s,l,u,p){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(s=l.alternate,s!==null&&Ar(s,l,p,!0),l=yn.current,l!==null){switch(l.tag){case 13:return Pn===null?Qh():l.alternate===null&&ie===0&&(ie=3),l.flags&=-257,l.flags|=65536,l.lanes=p,u===nh?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([u]):s.add(u),Jh(i,u,p)),!1;case 22:return l.flags|=65536,u===nh?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([u]):l.add(u)),Jh(i,u,p)),!1}throw Error(n(435,l.tag))}return Jh(i,u,p),Qh(),!1}if(It)return s=yn.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=p,u!==Wu&&(i=Error(n(422),{cause:u}),vr(pn(i,l)))):(u!==Wu&&(s=Error(n(423),{cause:u}),vr(pn(s,l))),i=i.current.alternate,i.flags|=65536,p&=-p,i.lanes|=p,u=pn(u,l),p=xh(i.stateNode,u,p),ah(i,p),ie!==4&&(ie=2)),!1;var m=Error(n(520),{cause:u});if(m=pn(m,l),Ur===null?Ur=[m]:Ur.push(m),ie!==4&&(ie=2),s===null)return!0;u=pn(u,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,i=p&-p,l.lanes|=i,i=xh(l.stateNode,u,i),ah(l,i),!1;case 1:if(s=l.type,m=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Ii===null||!Ii.has(m))))return l.flags|=65536,p&=-p,l.lanes|=p,p=$m(p),Wm(p,i,l,u),ah(l,p),!1}l=l.return}while(l!==null);return!1}var Km=Error(n(461)),be=!1;function Te(i,s,l,u){s.child=i===null?zm(s,null,l,u):pa(s,i.child,l,u)}function Qm(i,s,l,u,p){l=l.render;var m=s.ref;if("ref"in u){var v={};for(var E in u)E!=="ref"&&(v[E]=u[E])}else v=u;return gs(s),u=uh(i,s,l,v,m,p),E=hh(),i!==null&&!be?(dh(i,s,p),si(i,s,p)):(It&&E&&Xu(s),s.flags|=1,Te(i,s,u,p),s.child)}function Zm(i,s,l,u,p){if(i===null){var m=l.type;return typeof m=="function"&&!Vu(m)&&m.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=m,Jm(i,s,m,u,p)):(i=fl(l.type,null,u,s,s.mode,p),i.ref=s.ref,i.return=s,s.child=i)}if(m=i.child,!Ih(i,p)){var v=m.memoizedProps;if(l=l.compare,l=l!==null?l:mr,l(v,u)&&i.ref===s.ref)return si(i,s,p)}return s.flags|=1,i=Qn(m,u),i.ref=s.ref,i.return=s,s.child=i}function Jm(i,s,l,u,p){if(i!==null){var m=i.memoizedProps;if(mr(m,u)&&i.ref===s.ref)if(be=!1,s.pendingProps=u=m,Ih(i,p))(i.flags&131072)!==0&&(be=!0);else return s.lanes=i.lanes,si(i,s,p)}return Rh(i,s,l,u,p)}function t_(i,s,l){var u=s.pendingProps,p=u.children,m=i!==null?i.memoizedState:null;if(u.mode==="hidden"){if((s.flags&128)!==0){if(u=m!==null?m.baseLanes|l:l,i!==null){for(p=s.child=i.child,m=0;p!==null;)m=m|p.lanes|p.childLanes,p=p.sibling;s.childLanes=m&~u}else s.childLanes=0,s.child=null;return e_(i,s,u,l)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&yl(s,m!==null?m.cachePool:null),m!==null?Jg(s,m):oh(),Um(s);else return s.lanes=s.childLanes=536870912,e_(i,s,m!==null?m.baseLanes|l:l,l)}else m!==null?(yl(s,m.cachePool),Jg(s,m),Di(),s.memoizedState=null):(i!==null&&yl(s,null),oh(),Di());return Te(i,s,p,l),s.child}function e_(i,s,l,u){var p=eh();return p=p===null?null:{parent:me._currentValue,pool:p},s.memoizedState={baseLanes:l,cachePool:p},i!==null&&yl(s,null),oh(),Um(s),i!==null&&Ar(i,s,u,!0),null}function Il(i,s){var l=s.ref;if(l===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(n(284));(i===null||i.ref!==l)&&(s.flags|=4194816)}}function Rh(i,s,l,u,p){return gs(s),l=uh(i,s,l,u,void 0,p),u=hh(),i!==null&&!be?(dh(i,s,p),si(i,s,p)):(It&&u&&Xu(s),s.flags|=1,Te(i,s,l,p),s.child)}function n_(i,s,l,u,p,m){return gs(s),s.updateQueue=null,l=em(s,u,l,p),tm(i),u=hh(),i!==null&&!be?(dh(i,s,m),si(i,s,m)):(It&&u&&Xu(s),s.flags|=1,Te(i,s,l,m),s.child)}function i_(i,s,l,u,p){if(gs(s),s.stateNode===null){var m=sa,v=l.contextType;typeof v=="object"&&v!==null&&(m=Ie(v)),m=new l(u,m),s.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Th,s.stateNode=m,m._reactInternals=s,m=s.stateNode,m.props=u,m.state=s.memoizedState,m.refs={},ih(s),v=l.contextType,m.context=typeof v=="object"&&v!==null?Ie(v):sa,m.state=s.memoizedState,v=l.getDerivedStateFromProps,typeof v=="function"&&(Ch(s,l,v,u),m.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(v=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),v!==m.state&&Th.enqueueReplaceState(m,m.state,null),Rr(s,u,m,p),xr(),m.state=s.memoizedState),typeof m.componentDidMount=="function"&&(s.flags|=4194308),u=!0}else if(i===null){m=s.stateNode;var E=s.memoizedProps,R=ys(l,E);m.props=R;var F=m.context,G=l.contextType;v=sa,typeof G=="object"&&G!==null&&(v=Ie(G));var $=l.getDerivedStateFromProps;G=typeof $=="function"||typeof m.getSnapshotBeforeUpdate=="function",E=s.pendingProps!==E,G||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(E||F!==v)&&Gm(s,m,u,v),wi=!1;var z=s.memoizedState;m.state=z,Rr(s,u,m,p),xr(),F=s.memoizedState,E||z!==F||wi?(typeof $=="function"&&(Ch(s,l,$,u),F=s.memoizedState),(R=wi||jm(s,l,R,u,z,F,v))?(G||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(s.flags|=4194308)):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=F),m.props=u,m.state=F,m.context=v,u=R):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{m=s.stateNode,sh(i,s),v=s.memoizedProps,G=ys(l,v),m.props=G,$=s.pendingProps,z=m.context,F=l.contextType,R=sa,typeof F=="object"&&F!==null&&(R=Ie(F)),E=l.getDerivedStateFromProps,(F=typeof E=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(v!==$||z!==R)&&Gm(s,m,u,R),wi=!1,z=s.memoizedState,m.state=z,Rr(s,u,m,p),xr();var U=s.memoizedState;v!==$||z!==U||wi||i!==null&&i.dependencies!==null&&ml(i.dependencies)?(typeof E=="function"&&(Ch(s,l,E,u),U=s.memoizedState),(G=wi||jm(s,l,G,u,z,U,R)||i!==null&&i.dependencies!==null&&ml(i.dependencies))?(F||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(u,U,R),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(u,U,R)),typeof m.componentDidUpdate=="function"&&(s.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof m.componentDidUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=U),m.props=u,m.state=U,m.context=R,u=G):(typeof m.componentDidUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(s.flags|=1024),u=!1)}return m=u,Il(i,s),u=(s.flags&128)!==0,m||u?(m=s.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:m.render(),s.flags|=1,i!==null&&u?(s.child=pa(s,i.child,null,p),s.child=pa(s,null,l,p)):Te(i,s,l,p),s.memoizedState=m.state,i=s.child):i=si(i,s,p),i}function s_(i,s,l,u){return br(),s.flags|=256,Te(i,s,l,u),s.child}var Dh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mh(i){return{baseLanes:i,cachePool:qg()}}function Nh(i,s,l){return i=i!==null?i.childLanes&~l:0,s&&(i|=bn),i}function a_(i,s,l){var u=s.pendingProps,p=!1,m=(s.flags&128)!==0,v;if((v=m)||(v=i!==null&&i.memoizedState===null?!1:(_e.current&2)!==0),v&&(p=!0,s.flags&=-129),v=(s.flags&32)!==0,s.flags&=-33,i===null){if(It){if(p?Ri(s):Di(),It){var E=ne,R;if(R=E){t:{for(R=E,E=In;R.nodeType!==8;){if(!E){E=null;break t}if(R=Rn(R.nextSibling),R===null){E=null;break t}}E=R}E!==null?(s.memoizedState={dehydrated:E,treeContext:us!==null?{id:Zn,overflow:Jn}:null,retryLane:536870912,hydrationErrors:null},R=sn(18,null,null,0),R.stateNode=E,R.return=s,s.child=R,Fe=s,ne=null,R=!0):R=!1}R||fs(s)}if(E=s.memoizedState,E!==null&&(E=E.dehydrated,E!==null))return pd(E)?s.lanes=32:s.lanes=536870912,null;ii(s)}return E=u.children,u=u.fallback,p?(Di(),p=s.mode,E=Pl({mode:"hidden",children:E},p),u=cs(u,p,l,null),E.return=s,u.return=s,E.sibling=u,s.child=E,p=s.child,p.memoizedState=Mh(l),p.childLanes=Nh(i,v,l),s.memoizedState=Dh,u):(Ri(s),Oh(s,E))}if(R=i.memoizedState,R!==null&&(E=R.dehydrated,E!==null)){if(m)s.flags&256?(Ri(s),s.flags&=-257,s=kh(i,s,l)):s.memoizedState!==null?(Di(),s.child=i.child,s.flags|=128,s=null):(Di(),p=u.fallback,E=s.mode,u=Pl({mode:"visible",children:u.children},E),p=cs(p,E,l,null),p.flags|=2,u.return=s,p.return=s,u.sibling=p,s.child=u,pa(s,i.child,null,l),u=s.child,u.memoizedState=Mh(l),u.childLanes=Nh(i,v,l),s.memoizedState=Dh,s=p);else if(Ri(s),pd(E)){if(v=E.nextSibling&&E.nextSibling.dataset,v)var F=v.dgst;v=F,u=Error(n(419)),u.stack="",u.digest=v,vr({value:u,source:null,stack:null}),s=kh(i,s,l)}else if(be||Ar(i,s,l,!1),v=(l&i.childLanes)!==0,be||v){if(v=Xt,v!==null&&(u=l&-l,u=(u&42)!==0?1:gu(u),u=(u&(v.suspendedLanes|l))!==0?0:u,u!==0&&u!==R.retryLane))throw R.retryLane=u,ia(i,u),cn(v,i,u),Km;E.data==="$?"||Qh(),s=kh(i,s,l)}else E.data==="$?"?(s.flags|=192,s.child=i.child,s=null):(i=R.treeContext,ne=Rn(E.nextSibling),Fe=s,It=!0,ds=null,In=!1,i!==null&&(mn[_n++]=Zn,mn[_n++]=Jn,mn[_n++]=us,Zn=i.id,Jn=i.overflow,us=s),s=Oh(s,u.children),s.flags|=4096);return s}return p?(Di(),p=u.fallback,E=s.mode,R=i.child,F=R.sibling,u=Qn(R,{mode:"hidden",children:u.children}),u.subtreeFlags=R.subtreeFlags&65011712,F!==null?p=Qn(F,p):(p=cs(p,E,l,null),p.flags|=2),p.return=s,u.return=s,u.sibling=p,s.child=u,u=p,p=s.child,E=i.child.memoizedState,E===null?E=Mh(l):(R=E.cachePool,R!==null?(F=me._currentValue,R=R.parent!==F?{parent:F,pool:F}:R):R=qg(),E={baseLanes:E.baseLanes|l,cachePool:R}),p.memoizedState=E,p.childLanes=Nh(i,v,l),s.memoizedState=Dh,u):(Ri(s),l=i.child,i=l.sibling,l=Qn(l,{mode:"visible",children:u.children}),l.return=s,l.sibling=null,i!==null&&(v=s.deletions,v===null?(s.deletions=[i],s.flags|=16):v.push(i)),s.child=l,s.memoizedState=null,l)}function Oh(i,s){return s=Pl({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function Pl(i,s){return i=sn(22,i,null,s),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function kh(i,s,l){return pa(s,i.child,null,l),i=Oh(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function r_(i,s,l){i.lanes|=s;var u=i.alternate;u!==null&&(u.lanes|=s),Qu(i.return,s,l)}function Lh(i,s,l,u,p){var m=i.memoizedState;m===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:p}:(m.isBackwards=s,m.rendering=null,m.renderingStartTime=0,m.last=u,m.tail=l,m.tailMode=p)}function o_(i,s,l){var u=s.pendingProps,p=u.revealOrder,m=u.tail;if(Te(i,s,u.children,l),u=_e.current,(u&2)!==0)u=u&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)t:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&r_(i,l,s);else if(i.tag===19)r_(i,l,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break t;for(;i.sibling===null;){if(i.return===null||i.return===s)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}u&=1}switch(W(_e,u),p){case"forwards":for(l=s.child,p=null;l!==null;)i=l.alternate,i!==null&&Ol(i)===null&&(p=l),l=l.sibling;l=p,l===null?(p=s.child,s.child=null):(p=l.sibling,l.sibling=null),Lh(s,!1,p,l,m);break;case"backwards":for(l=null,p=s.child,s.child=null;p!==null;){if(i=p.alternate,i!==null&&Ol(i)===null){s.child=p;break}i=p.sibling,p.sibling=l,l=p,p=i}Lh(s,!0,l,null,m);break;case"together":Lh(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function si(i,s,l){if(i!==null&&(s.dependencies=i.dependencies),Li|=s.lanes,(l&s.childLanes)===0)if(i!==null){if(Ar(i,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(n(153));if(s.child!==null){for(i=s.child,l=Qn(i,i.pendingProps),s.child=l,l.return=s;i.sibling!==null;)i=i.sibling,l=l.sibling=Qn(i,i.pendingProps),l.return=s;l.sibling=null}return s.child}function Ih(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&ml(i)))}function PS(i,s,l){switch(s.tag){case 3:Bt(s,s.stateNode.containerInfo),Ei(s,me,i.memoizedState.cache),br();break;case 27:case 5:nr(s);break;case 4:Bt(s,s.stateNode.containerInfo);break;case 10:Ei(s,s.type,s.memoizedProps.value);break;case 13:var u=s.memoizedState;if(u!==null)return u.dehydrated!==null?(Ri(s),s.flags|=128,null):(l&s.child.childLanes)!==0?a_(i,s,l):(Ri(s),i=si(i,s,l),i!==null?i.sibling:null);Ri(s);break;case 19:var p=(i.flags&128)!==0;if(u=(l&s.childLanes)!==0,u||(Ar(i,s,l,!1),u=(l&s.childLanes)!==0),p){if(u)return o_(i,s,l);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),W(_e,_e.current),u)break;return null;case 22:case 23:return s.lanes=0,t_(i,s,l);case 24:Ei(s,me,i.memoizedState.cache)}return si(i,s,l)}function l_(i,s,l){if(i!==null)if(i.memoizedProps!==s.pendingProps)be=!0;else{if(!Ih(i,l)&&(s.flags&128)===0)return be=!1,PS(i,s,l);be=(i.flags&131072)!==0}else be=!1,It&&(s.flags&1048576)!==0&&Fg(s,gl,s.index);switch(s.lanes=0,s.tag){case 16:t:{i=s.pendingProps;var u=s.elementType,p=u._init;if(u=p(u._payload),s.type=u,typeof u=="function")Vu(u)?(i=ys(u,i),s.tag=1,s=i_(null,s,u,i,l)):(s.tag=0,s=Rh(null,s,u,i,l));else{if(u!=null){if(p=u.$$typeof,p===k){s.tag=11,s=Qm(null,s,u,i,l);break t}else if(p===j){s.tag=14,s=Zm(null,s,u,i,l);break t}}throw s=vt(u)||u,Error(n(306,s,""))}}return s;case 0:return Rh(i,s,s.type,s.pendingProps,l);case 1:return u=s.type,p=ys(u,s.pendingProps),i_(i,s,u,p,l);case 3:t:{if(Bt(s,s.stateNode.containerInfo),i===null)throw Error(n(387));u=s.pendingProps;var m=s.memoizedState;p=m.element,sh(i,s),Rr(s,u,null,l);var v=s.memoizedState;if(u=v.cache,Ei(s,me,u),u!==m.cache&&Zu(s,[me],l,!0),xr(),u=v.element,m.isDehydrated)if(m={element:u,isDehydrated:!1,cache:v.cache},s.updateQueue.baseState=m,s.memoizedState=m,s.flags&256){s=s_(i,s,u,l);break t}else if(u!==p){p=pn(Error(n(424)),s),vr(p),s=s_(i,s,u,l);break t}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(ne=Rn(i.firstChild),Fe=s,It=!0,ds=null,In=!0,l=zm(s,null,u,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(br(),u===p){s=si(i,s,l);break t}Te(i,s,u,l)}s=s.child}return s;case 26:return Il(i,s),i===null?(l=dy(s.type,null,s.pendingProps,null))?s.memoizedState=l:It||(l=s.type,i=s.pendingProps,u=Kl(lt.current).createElement(l),u[Le]=s,u[Ge]=i,Re(u,l,i),ye(u),s.stateNode=u):s.memoizedState=dy(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return nr(s),i===null&&It&&(u=s.stateNode=cy(s.type,s.pendingProps,lt.current),Fe=s,In=!0,p=ne,Fi(s.type)?(gd=p,ne=Rn(u.firstChild)):ne=p),Te(i,s,s.pendingProps.children,l),Il(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&It&&((p=u=ne)&&(u=uE(u,s.type,s.pendingProps,In),u!==null?(s.stateNode=u,Fe=s,ne=Rn(u.firstChild),In=!1,p=!0):p=!1),p||fs(s)),nr(s),p=s.type,m=s.pendingProps,v=i!==null?i.memoizedProps:null,u=m.children,hd(p,m)?u=null:v!==null&&hd(p,v)&&(s.flags|=32),s.memoizedState!==null&&(p=uh(i,s,RS,null,null,l),Kr._currentValue=p),Il(i,s),Te(i,s,u,l),s.child;case 6:return i===null&&It&&((i=l=ne)&&(l=hE(l,s.pendingProps,In),l!==null?(s.stateNode=l,Fe=s,ne=null,i=!0):i=!1),i||fs(s)),null;case 13:return a_(i,s,l);case 4:return Bt(s,s.stateNode.containerInfo),u=s.pendingProps,i===null?s.child=pa(s,null,u,l):Te(i,s,u,l),s.child;case 11:return Qm(i,s,s.type,s.pendingProps,l);case 7:return Te(i,s,s.pendingProps,l),s.child;case 8:return Te(i,s,s.pendingProps.children,l),s.child;case 12:return Te(i,s,s.pendingProps.children,l),s.child;case 10:return u=s.pendingProps,Ei(s,s.type,u.value),Te(i,s,u.children,l),s.child;case 9:return p=s.type._context,u=s.pendingProps.children,gs(s),p=Ie(p),u=u(p),s.flags|=1,Te(i,s,u,l),s.child;case 14:return Zm(i,s,s.type,s.pendingProps,l);case 15:return Jm(i,s,s.type,s.pendingProps,l);case 19:return o_(i,s,l);case 31:return u=s.pendingProps,l=s.mode,u={mode:u.mode,children:u.children},i===null?(l=Pl(u,l),l.ref=s.ref,s.child=l,l.return=s,s=l):(l=Qn(i.child,u),l.ref=s.ref,s.child=l,l.return=s,s=l),s;case 22:return t_(i,s,l);case 24:return gs(s),u=Ie(me),i===null?(p=eh(),p===null&&(p=Xt,m=Ju(),p.pooledCache=m,m.refCount++,m!==null&&(p.pooledCacheLanes|=l),p=m),s.memoizedState={parent:u,cache:p},ih(s),Ei(s,me,p)):((i.lanes&l)!==0&&(sh(i,s),Rr(s,null,null,l),xr()),p=i.memoizedState,m=s.memoizedState,p.parent!==u?(p={parent:u,cache:u},s.memoizedState=p,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=p),Ei(s,me,u)):(u=m.cache,Ei(s,me,u),u!==p.cache&&Zu(s,[me],l,!0))),Te(i,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(n(156,s.tag))}function ai(i){i.flags|=4}function c_(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!_y(s)){if(s=yn.current,s!==null&&((kt&4194048)===kt?Pn!==null:(kt&62914560)!==kt&&(kt&536870912)===0||s!==Pn))throw Cr=nh,Yg;i.flags|=8192}}function Bl(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Up():536870912,i.lanes|=s,ya|=s)}function Ir(i,s){if(!It)switch(i.tailMode){case"hidden":s=i.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:u.sibling=null}}function Jt(i){var s=i.alternate!==null&&i.alternate.child===i.child,l=0,u=0;if(s)for(var p=i.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags&65011712,u|=p.flags&65011712,p.return=i,p=p.sibling;else for(p=i.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags,u|=p.flags,p.return=i,p=p.sibling;return i.subtreeFlags|=u,i.childLanes=l,s}function BS(i,s,l){var u=s.pendingProps;switch($u(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(s),null;case 1:return Jt(s),null;case 3:return l=s.stateNode,u=null,i!==null&&(u=i.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),ei(me),kn(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(yr(s)?ai(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ug())),Jt(s),null;case 26:return l=s.memoizedState,i===null?(ai(s),l!==null?(Jt(s),c_(s,l)):(Jt(s),s.flags&=-16777217)):l?l!==i.memoizedState?(ai(s),Jt(s),c_(s,l)):(Jt(s),s.flags&=-16777217):(i.memoizedProps!==u&&ai(s),Jt(s),s.flags&=-16777217),null;case 27:bi(s),l=lt.current;var p=s.type;if(i!==null&&s.stateNode!=null)i.memoizedProps!==u&&ai(s);else{if(!u){if(s.stateNode===null)throw Error(n(166));return Jt(s),null}i=rt.current,yr(s)?Hg(s):(i=cy(p,u,l),s.stateNode=i,ai(s))}return Jt(s),null;case 5:if(bi(s),l=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==u&&ai(s);else{if(!u){if(s.stateNode===null)throw Error(n(166));return Jt(s),null}if(i=rt.current,yr(s))Hg(s);else{switch(p=Kl(lt.current),i){case 1:i=p.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:i=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":i=p.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":i=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":i=p.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof u.is=="string"?p.createElement("select",{is:u.is}):p.createElement("select"),u.multiple?i.multiple=!0:u.size&&(i.size=u.size);break;default:i=typeof u.is=="string"?p.createElement(l,{is:u.is}):p.createElement(l)}}i[Le]=s,i[Ge]=u;t:for(p=s.child;p!==null;){if(p.tag===5||p.tag===6)i.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===s)break t;for(;p.sibling===null;){if(p.return===null||p.return===s)break t;p=p.return}p.sibling.return=p.return,p=p.sibling}s.stateNode=i;t:switch(Re(i,l,u),l){case"button":case"input":case"select":case"textarea":i=!!u.autoFocus;break t;case"img":i=!0;break t;default:i=!1}i&&ai(s)}}return Jt(s),s.flags&=-16777217,null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==u&&ai(s);else{if(typeof u!="string"&&s.stateNode===null)throw Error(n(166));if(i=lt.current,yr(s)){if(i=s.stateNode,l=s.memoizedProps,u=null,p=Fe,p!==null)switch(p.tag){case 27:case 5:u=p.memoizedProps}i[Le]=s,i=!!(i.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||ny(i.nodeValue,l)),i||fs(s)}else i=Kl(i).createTextNode(u),i[Le]=s,s.stateNode=i}return Jt(s),null;case 13:if(u=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(p=yr(s),u!==null&&u.dehydrated!==null){if(i===null){if(!p)throw Error(n(318));if(p=s.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(n(317));p[Le]=s}else br(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Jt(s),p=!1}else p=Ug(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=p),p=!0;if(!p)return s.flags&256?(ii(s),s):(ii(s),null)}if(ii(s),(s.flags&128)!==0)return s.lanes=l,s;if(l=u!==null,i=i!==null&&i.memoizedState!==null,l){u=s.child,p=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(p=u.alternate.memoizedState.cachePool.pool);var m=null;u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(m=u.memoizedState.cachePool.pool),m!==p&&(u.flags|=2048)}return l!==i&&l&&(s.child.flags|=8192),Bl(s,s.updateQueue),Jt(s),null;case 4:return kn(),i===null&&rd(s.stateNode.containerInfo),Jt(s),null;case 10:return ei(s.type),Jt(s),null;case 19:if(X(_e),p=s.memoizedState,p===null)return Jt(s),null;if(u=(s.flags&128)!==0,m=p.rendering,m===null)if(u)Ir(p,!1);else{if(ie!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(m=Ol(i),m!==null){for(s.flags|=128,Ir(p,!1),i=m.updateQueue,s.updateQueue=i,Bl(s,i),s.subtreeFlags=0,i=l,l=s.child;l!==null;)Bg(l,i),l=l.sibling;return W(_e,_e.current&1|2),s.child}i=i.sibling}p.tail!==null&&Ln()>zl&&(s.flags|=128,u=!0,Ir(p,!1),s.lanes=4194304)}else{if(!u)if(i=Ol(m),i!==null){if(s.flags|=128,u=!0,i=i.updateQueue,s.updateQueue=i,Bl(s,i),Ir(p,!0),p.tail===null&&p.tailMode==="hidden"&&!m.alternate&&!It)return Jt(s),null}else 2*Ln()-p.renderingStartTime>zl&&l!==536870912&&(s.flags|=128,u=!0,Ir(p,!1),s.lanes=4194304);p.isBackwards?(m.sibling=s.child,s.child=m):(i=p.last,i!==null?i.sibling=m:s.child=m,p.last=m)}return p.tail!==null?(s=p.tail,p.rendering=s,p.tail=s.sibling,p.renderingStartTime=Ln(),s.sibling=null,i=_e.current,W(_e,u?i&1|2:i&1),s):(Jt(s),null);case 22:case 23:return ii(s),lh(),u=s.memoizedState!==null,i!==null?i.memoizedState!==null!==u&&(s.flags|=8192):u&&(s.flags|=8192),u?(l&536870912)!==0&&(s.flags&128)===0&&(Jt(s),s.subtreeFlags&6&&(s.flags|=8192)):Jt(s),l=s.updateQueue,l!==null&&Bl(s,l.retryQueue),l=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),u=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),u!==l&&(s.flags|=2048),i!==null&&X(ms),null;case 24:return l=null,i!==null&&(l=i.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),ei(me),Jt(s),null;case 25:return null;case 30:return null}throw Error(n(156,s.tag))}function FS(i,s){switch($u(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return ei(me),kn(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return bi(s),null;case 13:if(ii(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(n(340));br()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return X(_e),null;case 4:return kn(),null;case 10:return ei(s.type),null;case 22:case 23:return ii(s),lh(),i!==null&&X(ms),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return ei(me),null;case 25:return null;default:return null}}function u_(i,s){switch($u(s),s.tag){case 3:ei(me),kn();break;case 26:case 27:case 5:bi(s);break;case 4:kn();break;case 13:ii(s);break;case 19:X(_e);break;case 10:ei(s.type);break;case 22:case 23:ii(s),lh(),i!==null&&X(ms);break;case 24:ei(me)}}function Pr(i,s){try{var l=s.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var p=u.next;l=p;do{if((l.tag&i)===i){u=void 0;var m=l.create,v=l.inst;u=m(),v.destroy=u}l=l.next}while(l!==p)}}catch(E){qt(s,s.return,E)}}function Mi(i,s,l){try{var u=s.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var m=p.next;u=m;do{if((u.tag&i)===i){var v=u.inst,E=v.destroy;if(E!==void 0){v.destroy=void 0,p=s;var R=l,F=E;try{F()}catch(G){qt(p,R,G)}}}u=u.next}while(u!==m)}}catch(G){qt(s,s.return,G)}}function h_(i){var s=i.updateQueue;if(s!==null){var l=i.stateNode;try{Zg(s,l)}catch(u){qt(i,i.return,u)}}}function d_(i,s,l){l.props=ys(i.type,i.memoizedProps),l.state=i.memoizedState;try{l.componentWillUnmount()}catch(u){qt(i,s,u)}}function Br(i,s){try{var l=i.ref;if(l!==null){switch(i.tag){case 26:case 27:case 5:var u=i.stateNode;break;case 30:u=i.stateNode;break;default:u=i.stateNode}typeof l=="function"?i.refCleanup=l(u):l.current=u}}catch(p){qt(i,s,p)}}function Bn(i,s){var l=i.ref,u=i.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(p){qt(i,s,p)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){qt(i,s,p)}else l.current=null}function f_(i){var s=i.type,l=i.memoizedProps,u=i.stateNode;try{t:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break t;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(p){qt(i,i.return,p)}}function Ph(i,s,l){try{var u=i.stateNode;aE(u,i.type,l,s),u[Ge]=s}catch(p){qt(i,i.return,p)}}function p_(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Fi(i.type)||i.tag===4}function Bh(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||p_(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Fi(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Fh(i,s,l){var u=i.tag;if(u===5||u===6)i=i.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(i,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(i),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Wl));else if(u!==4&&(u===27&&Fi(i.type)&&(l=i.stateNode,s=null),i=i.child,i!==null))for(Fh(i,s,l),i=i.sibling;i!==null;)Fh(i,s,l),i=i.sibling}function Fl(i,s,l){var u=i.tag;if(u===5||u===6)i=i.stateNode,s?l.insertBefore(i,s):l.appendChild(i);else if(u!==4&&(u===27&&Fi(i.type)&&(l=i.stateNode),i=i.child,i!==null))for(Fl(i,s,l),i=i.sibling;i!==null;)Fl(i,s,l),i=i.sibling}function g_(i){var s=i.stateNode,l=i.memoizedProps;try{for(var u=i.type,p=s.attributes;p.length;)s.removeAttributeNode(p[0]);Re(s,u,l),s[Le]=i,s[Ge]=l}catch(m){qt(i,i.return,m)}}var ri=!1,ae=!1,Hh=!1,m_=typeof WeakSet=="function"?WeakSet:Set,ve=null;function HS(i,s){if(i=i.containerInfo,cd=nc,i=xg(i),Bu(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else t:{l=(l=i.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var p=u.anchorOffset,m=u.focusNode;u=u.focusOffset;try{l.nodeType,m.nodeType}catch{l=null;break t}var v=0,E=-1,R=-1,F=0,G=0,$=i,z=null;e:for(;;){for(var U;$!==l||p!==0&&$.nodeType!==3||(E=v+p),$!==m||u!==0&&$.nodeType!==3||(R=v+u),$.nodeType===3&&(v+=$.nodeValue.length),(U=$.firstChild)!==null;)z=$,$=U;for(;;){if($===i)break e;if(z===l&&++F===p&&(E=v),z===m&&++G===u&&(R=v),(U=$.nextSibling)!==null)break;$=z,z=$.parentNode}$=U}l=E===-1||R===-1?null:{start:E,end:R}}else l=null}l=l||{start:0,end:0}}else l=null;for(ud={focusedElem:i,selectionRange:l},nc=!1,ve=s;ve!==null;)if(s=ve,i=s.child,(s.subtreeFlags&1024)!==0&&i!==null)i.return=s,ve=i;else for(;ve!==null;){switch(s=ve,m=s.alternate,i=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&m!==null){i=void 0,l=s,p=m.memoizedProps,m=m.memoizedState,u=l.stateNode;try{var pt=ys(l.type,p,l.elementType===l.type);i=u.getSnapshotBeforeUpdate(pt,m),u.__reactInternalSnapshotBeforeUpdate=i}catch(ut){qt(l,l.return,ut)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,l=i.nodeType,l===9)fd(i);else if(l===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":fd(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(n(163))}if(i=s.sibling,i!==null){i.return=s.return,ve=i;break}ve=s.return}}function __(i,s,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:Ni(i,l),u&4&&Pr(5,l);break;case 1:if(Ni(i,l),u&4)if(i=l.stateNode,s===null)try{i.componentDidMount()}catch(v){qt(l,l.return,v)}else{var p=ys(l.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(p,s,i.__reactInternalSnapshotBeforeUpdate)}catch(v){qt(l,l.return,v)}}u&64&&h_(l),u&512&&Br(l,l.return);break;case 3:if(Ni(i,l),u&64&&(i=l.updateQueue,i!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{Zg(i,s)}catch(v){qt(l,l.return,v)}}break;case 27:s===null&&u&4&&g_(l);case 26:case 5:Ni(i,l),s===null&&u&4&&f_(l),u&512&&Br(l,l.return);break;case 12:Ni(i,l);break;case 13:Ni(i,l),u&4&&v_(i,l),u&64&&(i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(l=$S.bind(null,l),dE(i,l))));break;case 22:if(u=l.memoizedState!==null||ri,!u){s=s!==null&&s.memoizedState!==null||ae,p=ri;var m=ae;ri=u,(ae=s)&&!m?Oi(i,l,(l.subtreeFlags&8772)!==0):Ni(i,l),ri=p,ae=m}break;case 30:break;default:Ni(i,l)}}function y_(i){var s=i.alternate;s!==null&&(i.alternate=null,y_(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&yu(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Kt=null,Ye=!1;function oi(i,s,l){for(l=l.child;l!==null;)b_(i,s,l),l=l.sibling}function b_(i,s,l){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(sr,l)}catch{}switch(l.tag){case 26:ae||Bn(l,s),oi(i,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:ae||Bn(l,s);var u=Kt,p=Ye;Fi(l.type)&&(Kt=l.stateNode,Ye=!1),oi(i,s,l),Yr(l.stateNode),Kt=u,Ye=p;break;case 5:ae||Bn(l,s);case 6:if(u=Kt,p=Ye,Kt=null,oi(i,s,l),Kt=u,Ye=p,Kt!==null)if(Ye)try{(Kt.nodeType===9?Kt.body:Kt.nodeName==="HTML"?Kt.ownerDocument.body:Kt).removeChild(l.stateNode)}catch(m){qt(l,s,m)}else try{Kt.removeChild(l.stateNode)}catch(m){qt(l,s,m)}break;case 18:Kt!==null&&(Ye?(i=Kt,oy(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,l.stateNode),to(i)):oy(Kt,l.stateNode));break;case 4:u=Kt,p=Ye,Kt=l.stateNode.containerInfo,Ye=!0,oi(i,s,l),Kt=u,Ye=p;break;case 0:case 11:case 14:case 15:ae||Mi(2,l,s),ae||Mi(4,l,s),oi(i,s,l);break;case 1:ae||(Bn(l,s),u=l.stateNode,typeof u.componentWillUnmount=="function"&&d_(l,s,u)),oi(i,s,l);break;case 21:oi(i,s,l);break;case 22:ae=(u=ae)||l.memoizedState!==null,oi(i,s,l),ae=u;break;default:oi(i,s,l)}}function v_(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{to(i)}catch(l){qt(s,s.return,l)}}function zS(i){switch(i.tag){case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new m_),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new m_),s;default:throw Error(n(435,i.tag))}}function zh(i,s){var l=zS(i);s.forEach(function(u){var p=WS.bind(null,i,u);l.has(u)||(l.add(u),u.then(p,p))})}function an(i,s){var l=s.deletions;if(l!==null)for(var u=0;u<l.length;u++){var p=l[u],m=i,v=s,E=v;t:for(;E!==null;){switch(E.tag){case 27:if(Fi(E.type)){Kt=E.stateNode,Ye=!1;break t}break;case 5:Kt=E.stateNode,Ye=!1;break t;case 3:case 4:Kt=E.stateNode.containerInfo,Ye=!0;break t}E=E.return}if(Kt===null)throw Error(n(160));b_(m,v,p),Kt=null,Ye=!1,m=p.alternate,m!==null&&(m.return=null),p.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)A_(s,i),s=s.sibling}var xn=null;function A_(i,s){var l=i.alternate,u=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:an(s,i),rn(i),u&4&&(Mi(3,i,i.return),Pr(3,i),Mi(5,i,i.return));break;case 1:an(s,i),rn(i),u&512&&(ae||l===null||Bn(l,l.return)),u&64&&ri&&(i=i.updateQueue,i!==null&&(u=i.callbacks,u!==null&&(l=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var p=xn;if(an(s,i),rn(i),u&512&&(ae||l===null||Bn(l,l.return)),u&4){var m=l!==null?l.memoizedState:null;if(u=i.memoizedState,l===null)if(u===null)if(i.stateNode===null){t:{u=i.type,l=i.memoizedProps,p=p.ownerDocument||p;e:switch(u){case"title":m=p.getElementsByTagName("title")[0],(!m||m[or]||m[Le]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=p.createElement(u),p.head.insertBefore(m,p.querySelector("head > title"))),Re(m,u,l),m[Le]=i,ye(m),u=m;break t;case"link":var v=gy("link","href",p).get(u+(l.href||""));if(v){for(var E=0;E<v.length;E++)if(m=v[E],m.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&m.getAttribute("rel")===(l.rel==null?null:l.rel)&&m.getAttribute("title")===(l.title==null?null:l.title)&&m.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){v.splice(E,1);break e}}m=p.createElement(u),Re(m,u,l),p.head.appendChild(m);break;case"meta":if(v=gy("meta","content",p).get(u+(l.content||""))){for(E=0;E<v.length;E++)if(m=v[E],m.getAttribute("content")===(l.content==null?null:""+l.content)&&m.getAttribute("name")===(l.name==null?null:l.name)&&m.getAttribute("property")===(l.property==null?null:l.property)&&m.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&m.getAttribute("charset")===(l.charSet==null?null:l.charSet)){v.splice(E,1);break e}}m=p.createElement(u),Re(m,u,l),p.head.appendChild(m);break;default:throw Error(n(468,u))}m[Le]=i,ye(m),u=m}i.stateNode=u}else my(p,i.type,i.stateNode);else i.stateNode=py(p,u,i.memoizedProps);else m!==u?(m===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):m.count--,u===null?my(p,i.type,i.stateNode):py(p,u,i.memoizedProps)):u===null&&i.stateNode!==null&&Ph(i,i.memoizedProps,l.memoizedProps)}break;case 27:an(s,i),rn(i),u&512&&(ae||l===null||Bn(l,l.return)),l!==null&&u&4&&Ph(i,i.memoizedProps,l.memoizedProps);break;case 5:if(an(s,i),rn(i),u&512&&(ae||l===null||Bn(l,l.return)),i.flags&32){p=i.stateNode;try{Ks(p,"")}catch(U){qt(i,i.return,U)}}u&4&&i.stateNode!=null&&(p=i.memoizedProps,Ph(i,p,l!==null?l.memoizedProps:p)),u&1024&&(Hh=!0);break;case 6:if(an(s,i),rn(i),u&4){if(i.stateNode===null)throw Error(n(162));u=i.memoizedProps,l=i.stateNode;try{l.nodeValue=u}catch(U){qt(i,i.return,U)}}break;case 3:if(Jl=null,p=xn,xn=Ql(s.containerInfo),an(s,i),xn=p,rn(i),u&4&&l!==null&&l.memoizedState.isDehydrated)try{to(s.containerInfo)}catch(U){qt(i,i.return,U)}Hh&&(Hh=!1,S_(i));break;case 4:u=xn,xn=Ql(i.stateNode.containerInfo),an(s,i),rn(i),xn=u;break;case 12:an(s,i),rn(i);break;case 13:an(s,i),rn(i),i.child.flags&8192&&i.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Yh=Ln()),u&4&&(u=i.updateQueue,u!==null&&(i.updateQueue=null,zh(i,u)));break;case 22:p=i.memoizedState!==null;var R=l!==null&&l.memoizedState!==null,F=ri,G=ae;if(ri=F||p,ae=G||R,an(s,i),ae=G,ri=F,rn(i),u&8192)t:for(s=i.stateNode,s._visibility=p?s._visibility&-2:s._visibility|1,p&&(l===null||R||ri||ae||bs(i)),l=null,s=i;;){if(s.tag===5||s.tag===26){if(l===null){R=l=s;try{if(m=R.stateNode,p)v=m.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{E=R.stateNode;var $=R.memoizedProps.style,z=$!=null&&$.hasOwnProperty("display")?$.display:null;E.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(U){qt(R,R.return,U)}}}else if(s.tag===6){if(l===null){R=s;try{R.stateNode.nodeValue=p?"":R.memoizedProps}catch(U){qt(R,R.return,U)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break t;for(;s.sibling===null;){if(s.return===null||s.return===i)break t;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}u&4&&(u=i.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,zh(i,l))));break;case 19:an(s,i),rn(i),u&4&&(u=i.updateQueue,u!==null&&(i.updateQueue=null,zh(i,u)));break;case 30:break;case 21:break;default:an(s,i),rn(i)}}function rn(i){var s=i.flags;if(s&2){try{for(var l,u=i.return;u!==null;){if(p_(u)){l=u;break}u=u.return}if(l==null)throw Error(n(160));switch(l.tag){case 27:var p=l.stateNode,m=Bh(i);Fl(i,m,p);break;case 5:var v=l.stateNode;l.flags&32&&(Ks(v,""),l.flags&=-33);var E=Bh(i);Fl(i,E,v);break;case 3:case 4:var R=l.stateNode.containerInfo,F=Bh(i);Fh(i,F,R);break;default:throw Error(n(161))}}catch(G){qt(i,i.return,G)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function S_(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;S_(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function Ni(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)__(i,s.alternate,s),s=s.sibling}function bs(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:Mi(4,s,s.return),bs(s);break;case 1:Bn(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&d_(s,s.return,l),bs(s);break;case 27:Yr(s.stateNode);case 26:case 5:Bn(s,s.return),bs(s);break;case 22:s.memoizedState===null&&bs(s);break;case 30:bs(s);break;default:bs(s)}i=i.sibling}}function Oi(i,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var u=s.alternate,p=i,m=s,v=m.flags;switch(m.tag){case 0:case 11:case 15:Oi(p,m,l),Pr(4,m);break;case 1:if(Oi(p,m,l),u=m,p=u.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(F){qt(u,u.return,F)}if(u=m,p=u.updateQueue,p!==null){var E=u.stateNode;try{var R=p.shared.hiddenCallbacks;if(R!==null)for(p.shared.hiddenCallbacks=null,p=0;p<R.length;p++)Qg(R[p],E)}catch(F){qt(u,u.return,F)}}l&&v&64&&h_(m),Br(m,m.return);break;case 27:g_(m);case 26:case 5:Oi(p,m,l),l&&u===null&&v&4&&f_(m),Br(m,m.return);break;case 12:Oi(p,m,l);break;case 13:Oi(p,m,l),l&&v&4&&v_(p,m);break;case 22:m.memoizedState===null&&Oi(p,m,l),Br(m,m.return);break;case 30:break;default:Oi(p,m,l)}s=s.sibling}}function Uh(i,s){var l=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==l&&(i!=null&&i.refCount++,l!=null&&Sr(l))}function jh(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Sr(i))}function Fn(i,s,l,u){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)E_(i,s,l,u),s=s.sibling}function E_(i,s,l,u){var p=s.flags;switch(s.tag){case 0:case 11:case 15:Fn(i,s,l,u),p&2048&&Pr(9,s);break;case 1:Fn(i,s,l,u);break;case 3:Fn(i,s,l,u),p&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Sr(i)));break;case 12:if(p&2048){Fn(i,s,l,u),i=s.stateNode;try{var m=s.memoizedProps,v=m.id,E=m.onPostCommit;typeof E=="function"&&E(v,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(R){qt(s,s.return,R)}}else Fn(i,s,l,u);break;case 13:Fn(i,s,l,u);break;case 23:break;case 22:m=s.stateNode,v=s.alternate,s.memoizedState!==null?m._visibility&2?Fn(i,s,l,u):Fr(i,s):m._visibility&2?Fn(i,s,l,u):(m._visibility|=2,ga(i,s,l,u,(s.subtreeFlags&10256)!==0)),p&2048&&Uh(v,s);break;case 24:Fn(i,s,l,u),p&2048&&jh(s.alternate,s);break;default:Fn(i,s,l,u)}}function ga(i,s,l,u,p){for(p=p&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var m=i,v=s,E=l,R=u,F=v.flags;switch(v.tag){case 0:case 11:case 15:ga(m,v,E,R,p),Pr(8,v);break;case 23:break;case 22:var G=v.stateNode;v.memoizedState!==null?G._visibility&2?ga(m,v,E,R,p):Fr(m,v):(G._visibility|=2,ga(m,v,E,R,p)),p&&F&2048&&Uh(v.alternate,v);break;case 24:ga(m,v,E,R,p),p&&F&2048&&jh(v.alternate,v);break;default:ga(m,v,E,R,p)}s=s.sibling}}function Fr(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=i,u=s,p=u.flags;switch(u.tag){case 22:Fr(l,u),p&2048&&Uh(u.alternate,u);break;case 24:Fr(l,u),p&2048&&jh(u.alternate,u);break;default:Fr(l,u)}s=s.sibling}}var Hr=8192;function ma(i){if(i.subtreeFlags&Hr)for(i=i.child;i!==null;)w_(i),i=i.sibling}function w_(i){switch(i.tag){case 26:ma(i),i.flags&Hr&&i.memoizedState!==null&&CE(xn,i.memoizedState,i.memoizedProps);break;case 5:ma(i);break;case 3:case 4:var s=xn;xn=Ql(i.stateNode.containerInfo),ma(i),xn=s;break;case 22:i.memoizedState===null&&(s=i.alternate,s!==null&&s.memoizedState!==null?(s=Hr,Hr=16777216,ma(i),Hr=s):ma(i));break;default:ma(i)}}function C_(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function zr(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];ve=u,x_(u,i)}C_(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)T_(i),i=i.sibling}function T_(i){switch(i.tag){case 0:case 11:case 15:zr(i),i.flags&2048&&Mi(9,i,i.return);break;case 3:zr(i);break;case 12:zr(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,Hl(i)):zr(i);break;default:zr(i)}}function Hl(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];ve=u,x_(u,i)}C_(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:Mi(8,s,s.return),Hl(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,Hl(s));break;default:Hl(s)}i=i.sibling}}function x_(i,s){for(;ve!==null;){var l=ve;switch(l.tag){case 0:case 11:case 15:Mi(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Sr(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,ve=u;else t:for(l=i;ve!==null;){u=ve;var p=u.sibling,m=u.return;if(y_(u),u===l){ve=null;break t}if(p!==null){p.return=m,ve=p;break t}ve=m}}}var US={getCacheForType:function(i){var s=Ie(me),l=s.data.get(i);return l===void 0&&(l=i(),s.data.set(i,l)),l}},jS=typeof WeakMap=="function"?WeakMap:Map,Ft=0,Xt=null,Dt=null,kt=0,Ht=0,on=null,ki=!1,_a=!1,Gh=!1,li=0,ie=0,Li=0,vs=0,Vh=0,bn=0,ya=0,Ur=null,Xe=null,qh=!1,Yh=0,zl=1/0,Ul=null,Ii=null,xe=0,Pi=null,ba=null,va=0,Xh=0,$h=null,R_=null,jr=0,Wh=null;function ln(){if((Ft&2)!==0&&kt!==0)return kt&-kt;if(I.T!==null){var i=oa;return i!==0?i:nd()}return Vp()}function D_(){bn===0&&(bn=(kt&536870912)===0||It?zp():536870912);var i=yn.current;return i!==null&&(i.flags|=32),bn}function cn(i,s,l){(i===Xt&&(Ht===2||Ht===9)||i.cancelPendingCommit!==null)&&(Aa(i,0),Bi(i,kt,bn,!1)),rr(i,l),((Ft&2)===0||i!==Xt)&&(i===Xt&&((Ft&2)===0&&(vs|=l),ie===4&&Bi(i,kt,bn,!1)),Hn(i))}function M_(i,s,l){if((Ft&6)!==0)throw Error(n(327));var u=!l&&(s&124)===0&&(s&i.expiredLanes)===0||ar(i,s),p=u?qS(i,s):Zh(i,s,!0),m=u;do{if(p===0){_a&&!u&&Bi(i,s,0,!1);break}else{if(l=i.current.alternate,m&&!GS(l)){p=Zh(i,s,!1),m=!1;continue}if(p===2){if(m=s,i.errorRecoveryDisabledLanes&m)var v=0;else v=i.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){s=v;t:{var E=i;p=Ur;var R=E.current.memoizedState.isDehydrated;if(R&&(Aa(E,v).flags|=256),v=Zh(E,v,!1),v!==2){if(Gh&&!R){E.errorRecoveryDisabledLanes|=m,vs|=m,p=4;break t}m=Xe,Xe=p,m!==null&&(Xe===null?Xe=m:Xe.push.apply(Xe,m))}p=v}if(m=!1,p!==2)continue}}if(p===1){Aa(i,0),Bi(i,s,0,!0);break}t:{switch(u=i,m=p,m){case 0:case 1:throw Error(n(345));case 4:if((s&4194048)!==s)break;case 6:Bi(u,s,bn,!ki);break t;case 2:Xe=null;break;case 3:case 5:break;default:throw Error(n(329))}if((s&62914560)===s&&(p=Yh+300-Ln(),10<p)){if(Bi(u,s,bn,!ki),Zo(u,0,!0)!==0)break t;u.timeoutHandle=ay(N_.bind(null,u,l,Xe,Ul,qh,s,bn,vs,ya,ki,m,2,-0,0),p);break t}N_(u,l,Xe,Ul,qh,s,bn,vs,ya,ki,m,0,-0,0)}}break}while(!0);Hn(i)}function N_(i,s,l,u,p,m,v,E,R,F,G,$,z,U){if(i.timeoutHandle=-1,$=s.subtreeFlags,($&8192||($&16785408)===16785408)&&(Wr={stylesheets:null,count:0,unsuspend:wE},w_(s),$=TE(),$!==null)){i.cancelPendingCommit=$(F_.bind(null,i,s,m,l,u,p,v,E,R,G,1,z,U)),Bi(i,m,v,!F);return}F_(i,s,m,l,u,p,v,E,R)}function GS(i){for(var s=i;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var p=l[u],m=p.getSnapshot;p=p.value;try{if(!nn(m(),p))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Bi(i,s,l,u){s&=~Vh,s&=~vs,i.suspendedLanes|=s,i.pingedLanes&=~s,u&&(i.warmLanes|=s),u=i.expirationTimes;for(var p=s;0<p;){var m=31-en(p),v=1<<m;u[m]=-1,p&=~v}l!==0&&jp(i,l,s)}function jl(){return(Ft&6)===0?(Gr(0),!1):!0}function Kh(){if(Dt!==null){if(Ht===0)var i=Dt.return;else i=Dt,ti=ps=null,fh(i),fa=null,kr=0,i=Dt;for(;i!==null;)u_(i.alternate,i),i=i.return;Dt=null}}function Aa(i,s){var l=i.timeoutHandle;l!==-1&&(i.timeoutHandle=-1,oE(l)),l=i.cancelPendingCommit,l!==null&&(i.cancelPendingCommit=null,l()),Kh(),Xt=i,Dt=l=Qn(i.current,null),kt=s,Ht=0,on=null,ki=!1,_a=ar(i,s),Gh=!1,ya=bn=Vh=vs=Li=ie=0,Xe=Ur=null,qh=!1,(s&8)!==0&&(s|=s&32);var u=i.entangledLanes;if(u!==0)for(i=i.entanglements,u&=s;0<u;){var p=31-en(u),m=1<<p;s|=i[p],u&=~m}return li=s,ul(),l}function O_(i,s){Et=null,I.H=Dl,s===wr||s===bl?(s=Wg(),Ht=3):s===Yg?(s=Wg(),Ht=4):Ht=s===Km?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,on=s,Dt===null&&(ie=1,Ll(i,pn(s,i.current)))}function k_(){var i=I.H;return I.H=Dl,i===null?Dl:i}function L_(){var i=I.A;return I.A=US,i}function Qh(){ie=4,ki||(kt&4194048)!==kt&&yn.current!==null||(_a=!0),(Li&134217727)===0&&(vs&134217727)===0||Xt===null||Bi(Xt,kt,bn,!1)}function Zh(i,s,l){var u=Ft;Ft|=2;var p=k_(),m=L_();(Xt!==i||kt!==s)&&(Ul=null,Aa(i,s)),s=!1;var v=ie;t:do try{if(Ht!==0&&Dt!==null){var E=Dt,R=on;switch(Ht){case 8:Kh(),v=6;break t;case 3:case 2:case 9:case 6:yn.current===null&&(s=!0);var F=Ht;if(Ht=0,on=null,Sa(i,E,R,F),l&&_a){v=0;break t}break;default:F=Ht,Ht=0,on=null,Sa(i,E,R,F)}}VS(),v=ie;break}catch(G){O_(i,G)}while(!0);return s&&i.shellSuspendCounter++,ti=ps=null,Ft=u,I.H=p,I.A=m,Dt===null&&(Xt=null,kt=0,ul()),v}function VS(){for(;Dt!==null;)I_(Dt)}function qS(i,s){var l=Ft;Ft|=2;var u=k_(),p=L_();Xt!==i||kt!==s?(Ul=null,zl=Ln()+500,Aa(i,s)):_a=ar(i,s);t:do try{if(Ht!==0&&Dt!==null){s=Dt;var m=on;e:switch(Ht){case 1:Ht=0,on=null,Sa(i,s,m,1);break;case 2:case 9:if(Xg(m)){Ht=0,on=null,P_(s);break}s=function(){Ht!==2&&Ht!==9||Xt!==i||(Ht=7),Hn(i)},m.then(s,s);break t;case 3:Ht=7;break t;case 4:Ht=5;break t;case 7:Xg(m)?(Ht=0,on=null,P_(s)):(Ht=0,on=null,Sa(i,s,m,7));break;case 5:var v=null;switch(Dt.tag){case 26:v=Dt.memoizedState;case 5:case 27:var E=Dt;if(!v||_y(v)){Ht=0,on=null;var R=E.sibling;if(R!==null)Dt=R;else{var F=E.return;F!==null?(Dt=F,Gl(F)):Dt=null}break e}}Ht=0,on=null,Sa(i,s,m,5);break;case 6:Ht=0,on=null,Sa(i,s,m,6);break;case 8:Kh(),ie=6;break t;default:throw Error(n(462))}}YS();break}catch(G){O_(i,G)}while(!0);return ti=ps=null,I.H=u,I.A=p,Ft=l,Dt!==null?0:(Xt=null,kt=0,ul(),ie)}function YS(){for(;Dt!==null&&!pA();)I_(Dt)}function I_(i){var s=l_(i.alternate,i,li);i.memoizedProps=i.pendingProps,s===null?Gl(i):Dt=s}function P_(i){var s=i,l=s.alternate;switch(s.tag){case 15:case 0:s=n_(l,s,s.pendingProps,s.type,void 0,kt);break;case 11:s=n_(l,s,s.pendingProps,s.type.render,s.ref,kt);break;case 5:fh(s);default:u_(l,s),s=Dt=Bg(s,li),s=l_(l,s,li)}i.memoizedProps=i.pendingProps,s===null?Gl(i):Dt=s}function Sa(i,s,l,u){ti=ps=null,fh(s),fa=null,kr=0;var p=s.return;try{if(IS(i,p,s,l,kt)){ie=1,Ll(i,pn(l,i.current)),Dt=null;return}}catch(m){if(p!==null)throw Dt=p,m;ie=1,Ll(i,pn(l,i.current)),Dt=null;return}s.flags&32768?(It||u===1?i=!0:_a||(kt&536870912)!==0?i=!1:(ki=i=!0,(u===2||u===9||u===3||u===6)&&(u=yn.current,u!==null&&u.tag===13&&(u.flags|=16384))),B_(s,i)):Gl(s)}function Gl(i){var s=i;do{if((s.flags&32768)!==0){B_(s,ki);return}i=s.return;var l=BS(s.alternate,s,li);if(l!==null){Dt=l;return}if(s=s.sibling,s!==null){Dt=s;return}Dt=s=i}while(s!==null);ie===0&&(ie=5)}function B_(i,s){do{var l=FS(i.alternate,i);if(l!==null){l.flags&=32767,Dt=l;return}if(l=i.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(i=i.sibling,i!==null)){Dt=i;return}Dt=i=l}while(i!==null);ie=6,Dt=null}function F_(i,s,l,u,p,m,v,E,R){i.cancelPendingCommit=null;do Vl();while(xe!==0);if((Ft&6)!==0)throw Error(n(327));if(s!==null){if(s===i.current)throw Error(n(177));if(m=s.lanes|s.childLanes,m|=ju,wA(i,l,m,v,E,R),i===Xt&&(Dt=Xt=null,kt=0),ba=s,Pi=i,va=l,Xh=m,$h=p,R_=u,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,KS(Wo,function(){return G_(),null})):(i.callbackNode=null,i.callbackPriority=0),u=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||u){u=I.T,I.T=null,p=M.p,M.p=2,v=Ft,Ft|=4;try{HS(i,s,l)}finally{Ft=v,M.p=p,I.T=u}}xe=1,H_(),z_(),U_()}}function H_(){if(xe===1){xe=0;var i=Pi,s=ba,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=I.T,I.T=null;var u=M.p;M.p=2;var p=Ft;Ft|=4;try{A_(s,i);var m=ud,v=xg(i.containerInfo),E=m.focusedElem,R=m.selectionRange;if(v!==E&&E&&E.ownerDocument&&Tg(E.ownerDocument.documentElement,E)){if(R!==null&&Bu(E)){var F=R.start,G=R.end;if(G===void 0&&(G=F),"selectionStart"in E)E.selectionStart=F,E.selectionEnd=Math.min(G,E.value.length);else{var $=E.ownerDocument||document,z=$&&$.defaultView||window;if(z.getSelection){var U=z.getSelection(),pt=E.textContent.length,ut=Math.min(R.start,pt),Gt=R.end===void 0?ut:Math.min(R.end,pt);!U.extend&&ut>Gt&&(v=Gt,Gt=ut,ut=v);var L=Cg(E,ut),N=Cg(E,Gt);if(L&&N&&(U.rangeCount!==1||U.anchorNode!==L.node||U.anchorOffset!==L.offset||U.focusNode!==N.node||U.focusOffset!==N.offset)){var B=$.createRange();B.setStart(L.node,L.offset),U.removeAllRanges(),ut>Gt?(U.addRange(B),U.extend(N.node,N.offset)):(B.setEnd(N.node,N.offset),U.addRange(B))}}}}for($=[],U=E;U=U.parentNode;)U.nodeType===1&&$.push({element:U,left:U.scrollLeft,top:U.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<$.length;E++){var q=$[E];q.element.scrollLeft=q.left,q.element.scrollTop=q.top}}nc=!!cd,ud=cd=null}finally{Ft=p,M.p=u,I.T=l}}i.current=s,xe=2}}function z_(){if(xe===2){xe=0;var i=Pi,s=ba,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=I.T,I.T=null;var u=M.p;M.p=2;var p=Ft;Ft|=4;try{__(i,s.alternate,s)}finally{Ft=p,M.p=u,I.T=l}}xe=3}}function U_(){if(xe===4||xe===3){xe=0,gA();var i=Pi,s=ba,l=va,u=R_;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?xe=5:(xe=0,ba=Pi=null,j_(i,i.pendingLanes));var p=i.pendingLanes;if(p===0&&(Ii=null),mu(l),s=s.stateNode,tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(sr,s,void 0,(s.current.flags&128)===128)}catch{}if(u!==null){s=I.T,p=M.p,M.p=2,I.T=null;try{for(var m=i.onRecoverableError,v=0;v<u.length;v++){var E=u[v];m(E.value,{componentStack:E.stack})}}finally{I.T=s,M.p=p}}(va&3)!==0&&Vl(),Hn(i),p=i.pendingLanes,(l&4194090)!==0&&(p&42)!==0?i===Wh?jr++:(jr=0,Wh=i):jr=0,Gr(0)}}function j_(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Sr(s)))}function Vl(i){return H_(),z_(),U_(),G_()}function G_(){if(xe!==5)return!1;var i=Pi,s=Xh;Xh=0;var l=mu(va),u=I.T,p=M.p;try{M.p=32>l?32:l,I.T=null,l=$h,$h=null;var m=Pi,v=va;if(xe=0,ba=Pi=null,va=0,(Ft&6)!==0)throw Error(n(331));var E=Ft;if(Ft|=4,T_(m.current),E_(m,m.current,v,l),Ft=E,Gr(0,!1),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(sr,m)}catch{}return!0}finally{M.p=p,I.T=u,j_(i,s)}}function V_(i,s,l){s=pn(l,s),s=xh(i.stateNode,s,2),i=Ti(i,s,2),i!==null&&(rr(i,2),Hn(i))}function qt(i,s,l){if(i.tag===3)V_(i,i,l);else for(;s!==null;){if(s.tag===3){V_(s,i,l);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Ii===null||!Ii.has(u))){i=pn(l,i),l=$m(2),u=Ti(s,l,2),u!==null&&(Wm(l,u,s,i),rr(u,2),Hn(u));break}}s=s.return}}function Jh(i,s,l){var u=i.pingCache;if(u===null){u=i.pingCache=new jS;var p=new Set;u.set(s,p)}else p=u.get(s),p===void 0&&(p=new Set,u.set(s,p));p.has(l)||(Gh=!0,p.add(l),i=XS.bind(null,i,s,l),s.then(i,i))}function XS(i,s,l){var u=i.pingCache;u!==null&&u.delete(s),i.pingedLanes|=i.suspendedLanes&l,i.warmLanes&=~l,Xt===i&&(kt&l)===l&&(ie===4||ie===3&&(kt&62914560)===kt&&300>Ln()-Yh?(Ft&2)===0&&Aa(i,0):Vh|=l,ya===kt&&(ya=0)),Hn(i)}function q_(i,s){s===0&&(s=Up()),i=ia(i,s),i!==null&&(rr(i,s),Hn(i))}function $S(i){var s=i.memoizedState,l=0;s!==null&&(l=s.retryLane),q_(i,l)}function WS(i,s){var l=0;switch(i.tag){case 13:var u=i.stateNode,p=i.memoizedState;p!==null&&(l=p.retryLane);break;case 19:u=i.stateNode;break;case 22:u=i.stateNode._retryCache;break;default:throw Error(n(314))}u!==null&&u.delete(s),q_(i,l)}function KS(i,s){return js(i,s)}var ql=null,Ea=null,td=!1,Yl=!1,ed=!1,As=0;function Hn(i){i!==Ea&&i.next===null&&(Ea===null?ql=Ea=i:Ea=Ea.next=i),Yl=!0,td||(td=!0,ZS())}function Gr(i,s){if(!ed&&Yl){ed=!0;do for(var l=!1,u=ql;u!==null;){if(i!==0){var p=u.pendingLanes;if(p===0)var m=0;else{var v=u.suspendedLanes,E=u.pingedLanes;m=(1<<31-en(42|i)+1)-1,m&=p&~(v&~E),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(l=!0,W_(u,m))}else m=kt,m=Zo(u,u===Xt?m:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(m&3)===0||ar(u,m)||(l=!0,W_(u,m));u=u.next}while(l);ed=!1}}function QS(){Y_()}function Y_(){Yl=td=!1;var i=0;As!==0&&(rE()&&(i=As),As=0);for(var s=Ln(),l=null,u=ql;u!==null;){var p=u.next,m=X_(u,s);m===0?(u.next=null,l===null?ql=p:l.next=p,p===null&&(Ea=l)):(l=u,(i!==0||(m&3)!==0)&&(Yl=!0)),u=p}Gr(i)}function X_(i,s){for(var l=i.suspendedLanes,u=i.pingedLanes,p=i.expirationTimes,m=i.pendingLanes&-62914561;0<m;){var v=31-en(m),E=1<<v,R=p[v];R===-1?((E&l)===0||(E&u)!==0)&&(p[v]=EA(E,s)):R<=s&&(i.expiredLanes|=E),m&=~E}if(s=Xt,l=kt,l=Zo(i,i===s?l:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),u=i.callbackNode,l===0||i===s&&(Ht===2||Ht===9)||i.cancelPendingCommit!==null)return u!==null&&u!==null&&ir(u),i.callbackNode=null,i.callbackPriority=0;if((l&3)===0||ar(i,l)){if(s=l&-l,s===i.callbackPriority)return s;switch(u!==null&&ir(u),mu(l)){case 2:case 8:l=Fp;break;case 32:l=Wo;break;case 268435456:l=Hp;break;default:l=Wo}return u=$_.bind(null,i),l=js(l,u),i.callbackPriority=s,i.callbackNode=l,s}return u!==null&&u!==null&&ir(u),i.callbackPriority=2,i.callbackNode=null,2}function $_(i,s){if(xe!==0&&xe!==5)return i.callbackNode=null,i.callbackPriority=0,null;var l=i.callbackNode;if(Vl()&&i.callbackNode!==l)return null;var u=kt;return u=Zo(i,i===Xt?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),u===0?null:(M_(i,u,s),X_(i,Ln()),i.callbackNode!=null&&i.callbackNode===l?$_.bind(null,i):null)}function W_(i,s){if(Vl())return null;M_(i,s,!0)}function ZS(){lE(function(){(Ft&6)!==0?js(Bp,QS):Y_()})}function nd(){return As===0&&(As=zp()),As}function K_(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:il(""+i)}function Q_(i,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,i.id&&l.setAttribute("form",i.id),s.parentNode.insertBefore(l,s),i=new FormData(i),l.parentNode.removeChild(l),i}function JS(i,s,l,u,p){if(s==="submit"&&l&&l.stateNode===p){var m=K_((p[Ge]||null).action),v=u.submitter;v&&(s=(s=v[Ge]||null)?K_(s.formAction):v.getAttribute("formAction"),s!==null&&(m=s,v=null));var E=new ol("action","action",null,u,p);i.push({event:E,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(As!==0){var R=v?Q_(p,v):new FormData(p);Sh(l,{pending:!0,data:R,method:p.method,action:m},null,R)}}else typeof m=="function"&&(E.preventDefault(),R=v?Q_(p,v):new FormData(p),Sh(l,{pending:!0,data:R,method:p.method,action:m},m,R))},currentTarget:p}]})}}for(var id=0;id<Uu.length;id++){var sd=Uu[id],tE=sd.toLowerCase(),eE=sd[0].toUpperCase()+sd.slice(1);Tn(tE,"on"+eE)}Tn(Mg,"onAnimationEnd"),Tn(Ng,"onAnimationIteration"),Tn(Og,"onAnimationStart"),Tn("dblclick","onDoubleClick"),Tn("focusin","onFocus"),Tn("focusout","onBlur"),Tn(yS,"onTransitionRun"),Tn(bS,"onTransitionStart"),Tn(vS,"onTransitionCancel"),Tn(kg,"onTransitionEnd"),Xs("onMouseEnter",["mouseout","mouseover"]),Xs("onMouseLeave",["mouseout","mouseover"]),Xs("onPointerEnter",["pointerout","pointerover"]),Xs("onPointerLeave",["pointerout","pointerover"]),as("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),as("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),as("onBeforeInput",["compositionend","keypress","textInput","paste"]),as("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vr));function Z_(i,s){s=(s&4)!==0;for(var l=0;l<i.length;l++){var u=i[l],p=u.event;u=u.listeners;t:{var m=void 0;if(s)for(var v=u.length-1;0<=v;v--){var E=u[v],R=E.instance,F=E.currentTarget;if(E=E.listener,R!==m&&p.isPropagationStopped())break t;m=E,p.currentTarget=F;try{m(p)}catch(G){kl(G)}p.currentTarget=null,m=R}else for(v=0;v<u.length;v++){if(E=u[v],R=E.instance,F=E.currentTarget,E=E.listener,R!==m&&p.isPropagationStopped())break t;m=E,p.currentTarget=F;try{m(p)}catch(G){kl(G)}p.currentTarget=null,m=R}}}}function Mt(i,s){var l=s[_u];l===void 0&&(l=s[_u]=new Set);var u=i+"__bubble";l.has(u)||(J_(s,i,2,!1),l.add(u))}function ad(i,s,l){var u=0;s&&(u|=4),J_(l,i,u,s)}var Xl="_reactListening"+Math.random().toString(36).slice(2);function rd(i){if(!i[Xl]){i[Xl]=!0,Yp.forEach(function(l){l!=="selectionchange"&&(nE.has(l)||ad(l,!1,i),ad(l,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[Xl]||(s[Xl]=!0,ad("selectionchange",!1,s))}}function J_(i,s,l,u){switch(Ey(s)){case 2:var p=DE;break;case 8:p=ME;break;default:p=vd}l=p.bind(null,s,l,i),p=void 0,!Ru||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),u?p!==void 0?i.addEventListener(s,l,{capture:!0,passive:p}):i.addEventListener(s,l,!0):p!==void 0?i.addEventListener(s,l,{passive:p}):i.addEventListener(s,l,!1)}function od(i,s,l,u,p){var m=u;if((s&1)===0&&(s&2)===0&&u!==null)t:for(;;){if(u===null)return;var v=u.tag;if(v===3||v===4){var E=u.stateNode.containerInfo;if(E===p)break;if(v===4)for(v=u.return;v!==null;){var R=v.tag;if((R===3||R===4)&&v.stateNode.containerInfo===p)return;v=v.return}for(;E!==null;){if(v=Vs(E),v===null)return;if(R=v.tag,R===5||R===6||R===26||R===27){u=m=v;continue t}E=E.parentNode}}u=u.return}rg(function(){var F=m,G=Tu(l),$=[];t:{var z=Lg.get(i);if(z!==void 0){var U=ol,pt=i;switch(i){case"keypress":if(al(l)===0)break t;case"keydown":case"keyup":U=KA;break;case"focusin":pt="focus",U=Ou;break;case"focusout":pt="blur",U=Ou;break;case"beforeblur":case"afterblur":U=Ou;break;case"click":if(l.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":U=cg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":U=FA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":U=JA;break;case Mg:case Ng:case Og:U=UA;break;case kg:U=eS;break;case"scroll":case"scrollend":U=PA;break;case"wheel":U=iS;break;case"copy":case"cut":case"paste":U=GA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":U=hg;break;case"toggle":case"beforetoggle":U=aS}var ut=(s&4)!==0,Gt=!ut&&(i==="scroll"||i==="scrollend"),L=ut?z!==null?z+"Capture":null:z;ut=[];for(var N=F,B;N!==null;){var q=N;if(B=q.stateNode,q=q.tag,q!==5&&q!==26&&q!==27||B===null||L===null||(q=cr(N,L),q!=null&&ut.push(qr(N,q,B))),Gt)break;N=N.return}0<ut.length&&(z=new U(z,pt,null,l,G),$.push({event:z,listeners:ut}))}}if((s&7)===0){t:{if(z=i==="mouseover"||i==="pointerover",U=i==="mouseout"||i==="pointerout",z&&l!==Cu&&(pt=l.relatedTarget||l.fromElement)&&(Vs(pt)||pt[Gs]))break t;if((U||z)&&(z=G.window===G?G:(z=G.ownerDocument)?z.defaultView||z.parentWindow:window,U?(pt=l.relatedTarget||l.toElement,U=F,pt=pt?Vs(pt):null,pt!==null&&(Gt=o(pt),ut=pt.tag,pt!==Gt||ut!==5&&ut!==27&&ut!==6)&&(pt=null)):(U=null,pt=F),U!==pt)){if(ut=cg,q="onMouseLeave",L="onMouseEnter",N="mouse",(i==="pointerout"||i==="pointerover")&&(ut=hg,q="onPointerLeave",L="onPointerEnter",N="pointer"),Gt=U==null?z:lr(U),B=pt==null?z:lr(pt),z=new ut(q,N+"leave",U,l,G),z.target=Gt,z.relatedTarget=B,q=null,Vs(G)===F&&(ut=new ut(L,N+"enter",pt,l,G),ut.target=B,ut.relatedTarget=Gt,q=ut),Gt=q,U&&pt)e:{for(ut=U,L=pt,N=0,B=ut;B;B=wa(B))N++;for(B=0,q=L;q;q=wa(q))B++;for(;0<N-B;)ut=wa(ut),N--;for(;0<B-N;)L=wa(L),B--;for(;N--;){if(ut===L||L!==null&&ut===L.alternate)break e;ut=wa(ut),L=wa(L)}ut=null}else ut=null;U!==null&&ty($,z,U,ut,!1),pt!==null&&Gt!==null&&ty($,Gt,pt,ut,!0)}}t:{if(z=F?lr(F):window,U=z.nodeName&&z.nodeName.toLowerCase(),U==="select"||U==="input"&&z.type==="file")var st=bg;else if(_g(z))if(vg)st=gS;else{st=fS;var Ct=dS}else U=z.nodeName,!U||U.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?F&&wu(F.elementType)&&(st=bg):st=pS;if(st&&(st=st(i,F))){yg($,st,l,G);break t}Ct&&Ct(i,z,F),i==="focusout"&&F&&z.type==="number"&&F.memoizedProps.value!=null&&Eu(z,"number",z.value)}switch(Ct=F?lr(F):window,i){case"focusin":(_g(Ct)||Ct.contentEditable==="true")&&(ta=Ct,Fu=F,_r=null);break;case"focusout":_r=Fu=ta=null;break;case"mousedown":Hu=!0;break;case"contextmenu":case"mouseup":case"dragend":Hu=!1,Rg($,l,G);break;case"selectionchange":if(_S)break;case"keydown":case"keyup":Rg($,l,G)}var ot;if(Lu)t:{switch(i){case"compositionstart":var ht="onCompositionStart";break t;case"compositionend":ht="onCompositionEnd";break t;case"compositionupdate":ht="onCompositionUpdate";break t}ht=void 0}else Js?gg(i,l)&&(ht="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(ht="onCompositionStart");ht&&(dg&&l.locale!=="ko"&&(Js||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&Js&&(ot=og()):(Si=G,Du="value"in Si?Si.value:Si.textContent,Js=!0)),Ct=$l(F,ht),0<Ct.length&&(ht=new ug(ht,i,null,l,G),$.push({event:ht,listeners:Ct}),ot?ht.data=ot:(ot=mg(l),ot!==null&&(ht.data=ot)))),(ot=oS?lS(i,l):cS(i,l))&&(ht=$l(F,"onBeforeInput"),0<ht.length&&(Ct=new ug("onBeforeInput","beforeinput",null,l,G),$.push({event:Ct,listeners:ht}),Ct.data=ot)),JS($,i,F,l,G)}Z_($,s)})}function qr(i,s,l){return{instance:i,listener:s,currentTarget:l}}function $l(i,s){for(var l=s+"Capture",u=[];i!==null;){var p=i,m=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||m===null||(p=cr(i,l),p!=null&&u.unshift(qr(i,p,m)),p=cr(i,s),p!=null&&u.push(qr(i,p,m))),i.tag===3)return u;i=i.return}return[]}function wa(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function ty(i,s,l,u,p){for(var m=s._reactName,v=[];l!==null&&l!==u;){var E=l,R=E.alternate,F=E.stateNode;if(E=E.tag,R!==null&&R===u)break;E!==5&&E!==26&&E!==27||F===null||(R=F,p?(F=cr(l,m),F!=null&&v.unshift(qr(l,F,R))):p||(F=cr(l,m),F!=null&&v.push(qr(l,F,R)))),l=l.return}v.length!==0&&i.push({event:s,listeners:v})}var iE=/\r\n?/g,sE=/\u0000|\uFFFD/g;function ey(i){return(typeof i=="string"?i:""+i).replace(iE,`
`).replace(sE,"")}function ny(i,s){return s=ey(s),ey(i)===s}function Wl(){}function jt(i,s,l,u,p,m){switch(l){case"children":typeof u=="string"?s==="body"||s==="textarea"&&u===""||Ks(i,u):(typeof u=="number"||typeof u=="bigint")&&s!=="body"&&Ks(i,""+u);break;case"className":tl(i,"class",u);break;case"tabIndex":tl(i,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":tl(i,l,u);break;case"style":sg(i,u,m);break;case"data":if(s!=="object"){tl(i,"data",u);break}case"src":case"href":if(u===""&&(s!=="a"||l!=="href")){i.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){i.removeAttribute(l);break}u=il(""+u),i.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){i.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(l==="formAction"?(s!=="input"&&jt(i,s,"name",p.name,p,null),jt(i,s,"formEncType",p.formEncType,p,null),jt(i,s,"formMethod",p.formMethod,p,null),jt(i,s,"formTarget",p.formTarget,p,null)):(jt(i,s,"encType",p.encType,p,null),jt(i,s,"method",p.method,p,null),jt(i,s,"target",p.target,p,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){i.removeAttribute(l);break}u=il(""+u),i.setAttribute(l,u);break;case"onClick":u!=null&&(i.onclick=Wl);break;case"onScroll":u!=null&&Mt("scroll",i);break;case"onScrollEnd":u!=null&&Mt("scrollend",i);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(n(60));i.innerHTML=l}}break;case"multiple":i.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":i.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){i.removeAttribute("xlink:href");break}l=il(""+u),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,""+u):i.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,""):i.removeAttribute(l);break;case"capture":case"download":u===!0?i.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,u):i.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?i.setAttribute(l,u):i.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?i.removeAttribute(l):i.setAttribute(l,u);break;case"popover":Mt("beforetoggle",i),Mt("toggle",i),Jo(i,"popover",u);break;case"xlinkActuate":Wn(i,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Wn(i,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Wn(i,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Wn(i,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Wn(i,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Wn(i,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Wn(i,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Wn(i,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Wn(i,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Jo(i,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=LA.get(l)||l,Jo(i,l,u))}}function ld(i,s,l,u,p,m){switch(l){case"style":sg(i,u,m);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(n(60));i.innerHTML=l}}break;case"children":typeof u=="string"?Ks(i,u):(typeof u=="number"||typeof u=="bigint")&&Ks(i,""+u);break;case"onScroll":u!=null&&Mt("scroll",i);break;case"onScrollEnd":u!=null&&Mt("scrollend",i);break;case"onClick":u!=null&&(i.onclick=Wl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Xp.hasOwnProperty(l))t:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),s=l.slice(2,p?l.length-7:void 0),m=i[Ge]||null,m=m!=null?m[l]:null,typeof m=="function"&&i.removeEventListener(s,m,p),typeof u=="function")){typeof m!="function"&&m!==null&&(l in i?i[l]=null:i.hasAttribute(l)&&i.removeAttribute(l)),i.addEventListener(s,u,p);break t}l in i?i[l]=u:u===!0?i.setAttribute(l,""):Jo(i,l,u)}}}function Re(i,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mt("error",i),Mt("load",i);var u=!1,p=!1,m;for(m in l)if(l.hasOwnProperty(m)){var v=l[m];if(v!=null)switch(m){case"src":u=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,s));default:jt(i,s,m,v,l,null)}}p&&jt(i,s,"srcSet",l.srcSet,l,null),u&&jt(i,s,"src",l.src,l,null);return;case"input":Mt("invalid",i);var E=m=v=p=null,R=null,F=null;for(u in l)if(l.hasOwnProperty(u)){var G=l[u];if(G!=null)switch(u){case"name":p=G;break;case"type":v=G;break;case"checked":R=G;break;case"defaultChecked":F=G;break;case"value":m=G;break;case"defaultValue":E=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(n(137,s));break;default:jt(i,s,u,G,l,null)}}tg(i,m,E,R,F,v,p,!1),el(i);return;case"select":Mt("invalid",i),u=v=m=null;for(p in l)if(l.hasOwnProperty(p)&&(E=l[p],E!=null))switch(p){case"value":m=E;break;case"defaultValue":v=E;break;case"multiple":u=E;default:jt(i,s,p,E,l,null)}s=m,l=v,i.multiple=!!u,s!=null?Ws(i,!!u,s,!1):l!=null&&Ws(i,!!u,l,!0);return;case"textarea":Mt("invalid",i),m=p=u=null;for(v in l)if(l.hasOwnProperty(v)&&(E=l[v],E!=null))switch(v){case"value":u=E;break;case"defaultValue":p=E;break;case"children":m=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(n(91));break;default:jt(i,s,v,E,l,null)}ng(i,u,p,m),el(i);return;case"option":for(R in l)if(l.hasOwnProperty(R)&&(u=l[R],u!=null))switch(R){case"selected":i.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:jt(i,s,R,u,l,null)}return;case"dialog":Mt("beforetoggle",i),Mt("toggle",i),Mt("cancel",i),Mt("close",i);break;case"iframe":case"object":Mt("load",i);break;case"video":case"audio":for(u=0;u<Vr.length;u++)Mt(Vr[u],i);break;case"image":Mt("error",i),Mt("load",i);break;case"details":Mt("toggle",i);break;case"embed":case"source":case"link":Mt("error",i),Mt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(F in l)if(l.hasOwnProperty(F)&&(u=l[F],u!=null))switch(F){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,s));default:jt(i,s,F,u,l,null)}return;default:if(wu(s)){for(G in l)l.hasOwnProperty(G)&&(u=l[G],u!==void 0&&ld(i,s,G,u,l,void 0));return}}for(E in l)l.hasOwnProperty(E)&&(u=l[E],u!=null&&jt(i,s,E,u,l,null))}function aE(i,s,l,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,m=null,v=null,E=null,R=null,F=null,G=null;for(U in l){var $=l[U];if(l.hasOwnProperty(U)&&$!=null)switch(U){case"checked":break;case"value":break;case"defaultValue":R=$;default:u.hasOwnProperty(U)||jt(i,s,U,null,u,$)}}for(var z in u){var U=u[z];if($=l[z],u.hasOwnProperty(z)&&(U!=null||$!=null))switch(z){case"type":m=U;break;case"name":p=U;break;case"checked":F=U;break;case"defaultChecked":G=U;break;case"value":v=U;break;case"defaultValue":E=U;break;case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(n(137,s));break;default:U!==$&&jt(i,s,z,U,u,$)}}Su(i,v,E,R,F,G,m,p);return;case"select":U=v=E=z=null;for(m in l)if(R=l[m],l.hasOwnProperty(m)&&R!=null)switch(m){case"value":break;case"multiple":U=R;default:u.hasOwnProperty(m)||jt(i,s,m,null,u,R)}for(p in u)if(m=u[p],R=l[p],u.hasOwnProperty(p)&&(m!=null||R!=null))switch(p){case"value":z=m;break;case"defaultValue":E=m;break;case"multiple":v=m;default:m!==R&&jt(i,s,p,m,u,R)}s=E,l=v,u=U,z!=null?Ws(i,!!l,z,!1):!!u!=!!l&&(s!=null?Ws(i,!!l,s,!0):Ws(i,!!l,l?[]:"",!1));return;case"textarea":U=z=null;for(E in l)if(p=l[E],l.hasOwnProperty(E)&&p!=null&&!u.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:jt(i,s,E,null,u,p)}for(v in u)if(p=u[v],m=l[v],u.hasOwnProperty(v)&&(p!=null||m!=null))switch(v){case"value":z=p;break;case"defaultValue":U=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(n(91));break;default:p!==m&&jt(i,s,v,p,u,m)}eg(i,z,U);return;case"option":for(var pt in l)if(z=l[pt],l.hasOwnProperty(pt)&&z!=null&&!u.hasOwnProperty(pt))switch(pt){case"selected":i.selected=!1;break;default:jt(i,s,pt,null,u,z)}for(R in u)if(z=u[R],U=l[R],u.hasOwnProperty(R)&&z!==U&&(z!=null||U!=null))switch(R){case"selected":i.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:jt(i,s,R,z,u,U)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ut in l)z=l[ut],l.hasOwnProperty(ut)&&z!=null&&!u.hasOwnProperty(ut)&&jt(i,s,ut,null,u,z);for(F in u)if(z=u[F],U=l[F],u.hasOwnProperty(F)&&z!==U&&(z!=null||U!=null))switch(F){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(n(137,s));break;default:jt(i,s,F,z,u,U)}return;default:if(wu(s)){for(var Gt in l)z=l[Gt],l.hasOwnProperty(Gt)&&z!==void 0&&!u.hasOwnProperty(Gt)&&ld(i,s,Gt,void 0,u,z);for(G in u)z=u[G],U=l[G],!u.hasOwnProperty(G)||z===U||z===void 0&&U===void 0||ld(i,s,G,z,u,U);return}}for(var L in l)z=l[L],l.hasOwnProperty(L)&&z!=null&&!u.hasOwnProperty(L)&&jt(i,s,L,null,u,z);for($ in u)z=u[$],U=l[$],!u.hasOwnProperty($)||z===U||z==null&&U==null||jt(i,s,$,z,u,U)}var cd=null,ud=null;function Kl(i){return i.nodeType===9?i:i.ownerDocument}function iy(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sy(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function hd(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var dd=null;function rE(){var i=window.event;return i&&i.type==="popstate"?i===dd?!1:(dd=i,!0):(dd=null,!1)}var ay=typeof setTimeout=="function"?setTimeout:void 0,oE=typeof clearTimeout=="function"?clearTimeout:void 0,ry=typeof Promise=="function"?Promise:void 0,lE=typeof queueMicrotask=="function"?queueMicrotask:typeof ry<"u"?function(i){return ry.resolve(null).then(i).catch(cE)}:ay;function cE(i){setTimeout(function(){throw i})}function Fi(i){return i==="head"}function oy(i,s){var l=s,u=0,p=0;do{var m=l.nextSibling;if(i.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"){if(0<u&&8>u){l=u;var v=i.ownerDocument;if(l&1&&Yr(v.documentElement),l&2&&Yr(v.body),l&4)for(l=v.head,Yr(l),v=l.firstChild;v;){var E=v.nextSibling,R=v.nodeName;v[or]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&v.rel.toLowerCase()==="stylesheet"||l.removeChild(v),v=E}}if(p===0){i.removeChild(m),to(s);return}p--}else l==="$"||l==="$?"||l==="$!"?p++:u=l.charCodeAt(0)-48;else u=0;l=m}while(l);to(s)}function fd(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":fd(l),yu(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}i.removeChild(l)}}function uE(i,s,l,u){for(;i.nodeType===1;){var p=l;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!u&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(u){if(!i[or])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(m=i.getAttribute("rel"),m==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(m!==p.rel||i.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||i.getAttribute("title")!==(p.title==null?null:p.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(m=i.getAttribute("src"),(m!==(p.src==null?null:p.src)||i.getAttribute("type")!==(p.type==null?null:p.type)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&m&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var m=p.name==null?null:""+p.name;if(p.type==="hidden"&&i.getAttribute("name")===m)return i}else return i;if(i=Rn(i.nextSibling),i===null)break}return null}function hE(i,s,l){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!l||(i=Rn(i.nextSibling),i===null))return null;return i}function pd(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function dE(i,s){var l=i.ownerDocument;if(i.data!=="$?"||l.readyState==="complete")s();else{var u=function(){s(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),i._reactRetry=u}}function Rn(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return i}var gd=null;function ly(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return i;s--}else l==="/$"&&s++}i=i.previousSibling}return null}function cy(i,s,l){switch(s=Kl(l),i){case"html":if(i=s.documentElement,!i)throw Error(n(452));return i;case"head":if(i=s.head,!i)throw Error(n(453));return i;case"body":if(i=s.body,!i)throw Error(n(454));return i;default:throw Error(n(451))}}function Yr(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);yu(i)}var vn=new Map,uy=new Set;function Ql(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var ci=M.d;M.d={f:fE,r:pE,D:gE,C:mE,L:_E,m:yE,X:vE,S:bE,M:AE};function fE(){var i=ci.f(),s=jl();return i||s}function pE(i){var s=qs(i);s!==null&&s.tag===5&&s.type==="form"?Mm(s):ci.r(i)}var Ca=typeof document>"u"?null:document;function hy(i,s,l){var u=Ca;if(u&&typeof s=="string"&&s){var p=fn(s);p='link[rel="'+i+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),uy.has(p)||(uy.add(p),i={rel:i,crossOrigin:l,href:s},u.querySelector(p)===null&&(s=u.createElement("link"),Re(s,"link",i),ye(s),u.head.appendChild(s)))}}function gE(i){ci.D(i),hy("dns-prefetch",i,null)}function mE(i,s){ci.C(i,s),hy("preconnect",i,s)}function _E(i,s,l){ci.L(i,s,l);var u=Ca;if(u&&i&&s){var p='link[rel="preload"][as="'+fn(s)+'"]';s==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+fn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+fn(l.imageSizes)+'"]')):p+='[href="'+fn(i)+'"]';var m=p;switch(s){case"style":m=Ta(i);break;case"script":m=xa(i)}vn.has(m)||(i=g({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:i,as:s},l),vn.set(m,i),u.querySelector(p)!==null||s==="style"&&u.querySelector(Xr(m))||s==="script"&&u.querySelector($r(m))||(s=u.createElement("link"),Re(s,"link",i),ye(s),u.head.appendChild(s)))}}function yE(i,s){ci.m(i,s);var l=Ca;if(l&&i){var u=s&&typeof s.as=="string"?s.as:"script",p='link[rel="modulepreload"][as="'+fn(u)+'"][href="'+fn(i)+'"]',m=p;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=xa(i)}if(!vn.has(m)&&(i=g({rel:"modulepreload",href:i},s),vn.set(m,i),l.querySelector(p)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector($r(m)))return}u=l.createElement("link"),Re(u,"link",i),ye(u),l.head.appendChild(u)}}}function bE(i,s,l){ci.S(i,s,l);var u=Ca;if(u&&i){var p=Ys(u).hoistableStyles,m=Ta(i);s=s||"default";var v=p.get(m);if(!v){var E={loading:0,preload:null};if(v=u.querySelector(Xr(m)))E.loading=5;else{i=g({rel:"stylesheet",href:i,"data-precedence":s},l),(l=vn.get(m))&&md(i,l);var R=v=u.createElement("link");ye(R),Re(R,"link",i),R._p=new Promise(function(F,G){R.onload=F,R.onerror=G}),R.addEventListener("load",function(){E.loading|=1}),R.addEventListener("error",function(){E.loading|=2}),E.loading|=4,Zl(v,s,u)}v={type:"stylesheet",instance:v,count:1,state:E},p.set(m,v)}}}function vE(i,s){ci.X(i,s);var l=Ca;if(l&&i){var u=Ys(l).hoistableScripts,p=xa(i),m=u.get(p);m||(m=l.querySelector($r(p)),m||(i=g({src:i,async:!0},s),(s=vn.get(p))&&_d(i,s),m=l.createElement("script"),ye(m),Re(m,"link",i),l.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(p,m))}}function AE(i,s){ci.M(i,s);var l=Ca;if(l&&i){var u=Ys(l).hoistableScripts,p=xa(i),m=u.get(p);m||(m=l.querySelector($r(p)),m||(i=g({src:i,async:!0,type:"module"},s),(s=vn.get(p))&&_d(i,s),m=l.createElement("script"),ye(m),Re(m,"link",i),l.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(p,m))}}function dy(i,s,l,u){var p=(p=lt.current)?Ql(p):null;if(!p)throw Error(n(446));switch(i){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=Ta(l.href),l=Ys(p).hoistableStyles,u=l.get(s),u||(u={type:"style",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){i=Ta(l.href);var m=Ys(p).hoistableStyles,v=m.get(i);if(v||(p=p.ownerDocument||p,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(i,v),(m=p.querySelector(Xr(i)))&&!m._p&&(v.instance=m,v.state.loading=5),vn.has(i)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},vn.set(i,l),m||SE(p,i,l,v.state))),s&&u===null)throw Error(n(528,""));return v}if(s&&u!==null)throw Error(n(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=xa(l),l=Ys(p).hoistableScripts,u=l.get(s),u||(u={type:"script",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,i))}}function Ta(i){return'href="'+fn(i)+'"'}function Xr(i){return'link[rel="stylesheet"]['+i+"]"}function fy(i){return g({},i,{"data-precedence":i.precedence,precedence:null})}function SE(i,s,l,u){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?u.loading=1:(s=i.createElement("link"),u.preload=s,s.addEventListener("load",function(){return u.loading|=1}),s.addEventListener("error",function(){return u.loading|=2}),Re(s,"link",l),ye(s),i.head.appendChild(s))}function xa(i){return'[src="'+fn(i)+'"]'}function $r(i){return"script[async]"+i}function py(i,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var u=i.querySelector('style[data-href~="'+fn(l.href)+'"]');if(u)return s.instance=u,ye(u),u;var p=g({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(i.ownerDocument||i).createElement("style"),ye(u),Re(u,"style",p),Zl(u,l.precedence,i),s.instance=u;case"stylesheet":p=Ta(l.href);var m=i.querySelector(Xr(p));if(m)return s.state.loading|=4,s.instance=m,ye(m),m;u=fy(l),(p=vn.get(p))&&md(u,p),m=(i.ownerDocument||i).createElement("link"),ye(m);var v=m;return v._p=new Promise(function(E,R){v.onload=E,v.onerror=R}),Re(m,"link",u),s.state.loading|=4,Zl(m,l.precedence,i),s.instance=m;case"script":return m=xa(l.src),(p=i.querySelector($r(m)))?(s.instance=p,ye(p),p):(u=l,(p=vn.get(m))&&(u=g({},l),_d(u,p)),i=i.ownerDocument||i,p=i.createElement("script"),ye(p),Re(p,"link",u),i.head.appendChild(p),s.instance=p);case"void":return null;default:throw Error(n(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(u=s.instance,s.state.loading|=4,Zl(u,l.precedence,i));return s.instance}function Zl(i,s,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=u.length?u[u.length-1]:null,m=p,v=0;v<u.length;v++){var E=u[v];if(E.dataset.precedence===s)m=E;else if(m!==p)break}m?m.parentNode.insertBefore(i,m.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(i,s.firstChild))}function md(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function _d(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var Jl=null;function gy(i,s,l){if(Jl===null){var u=new Map,p=Jl=new Map;p.set(l,u)}else p=Jl,u=p.get(l),u||(u=new Map,p.set(l,u));if(u.has(i))return u;for(u.set(i,null),l=l.getElementsByTagName(i),p=0;p<l.length;p++){var m=l[p];if(!(m[or]||m[Le]||i==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var v=m.getAttribute(s)||"";v=i+v;var E=u.get(v);E?E.push(m):u.set(v,[m])}}return u}function my(i,s,l){i=i.ownerDocument||i,i.head.insertBefore(l,s==="title"?i.querySelector("head > title"):null)}function EE(i,s,l){if(l===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function _y(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var Wr=null;function wE(){}function CE(i,s,l){if(Wr===null)throw Error(n(475));var u=Wr;if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var p=Ta(l.href),m=i.querySelector(Xr(p));if(m){i=m._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(u.count++,u=tc.bind(u),i.then(u,u)),s.state.loading|=4,s.instance=m,ye(m);return}m=i.ownerDocument||i,l=fy(l),(p=vn.get(p))&&md(l,p),m=m.createElement("link"),ye(m);var v=m;v._p=new Promise(function(E,R){v.onload=E,v.onerror=R}),Re(m,"link",l),s.instance=m}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(u.count++,s=tc.bind(u),i.addEventListener("load",s),i.addEventListener("error",s))}}function TE(){if(Wr===null)throw Error(n(475));var i=Wr;return i.stylesheets&&i.count===0&&yd(i,i.stylesheets),0<i.count?function(s){var l=setTimeout(function(){if(i.stylesheets&&yd(i,i.stylesheets),i.unsuspend){var u=i.unsuspend;i.unsuspend=null,u()}},6e4);return i.unsuspend=s,function(){i.unsuspend=null,clearTimeout(l)}}:null}function tc(){if(this.count--,this.count===0){if(this.stylesheets)yd(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var ec=null;function yd(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,ec=new Map,s.forEach(xE,i),ec=null,tc.call(i))}function xE(i,s){if(!(s.state.loading&4)){var l=ec.get(i);if(l)var u=l.get(null);else{l=new Map,ec.set(i,l);for(var p=i.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<p.length;m++){var v=p[m];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(l.set(v.dataset.precedence,v),u=v)}u&&l.set(null,u)}p=s.instance,v=p.getAttribute("data-precedence"),m=l.get(v)||u,m===u&&l.set(null,p),l.set(v,p),this.count++,u=tc.bind(this),p.addEventListener("load",u),p.addEventListener("error",u),m?m.parentNode.insertBefore(p,m.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(p,i.firstChild)),s.state.loading|=4}}var Kr={$$typeof:x,Provider:null,Consumer:null,_currentValue:V,_currentValue2:V,_threadCount:0};function RE(i,s,l,u,p,m,v,E){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=pu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pu(0),this.hiddenUpdates=pu(null),this.identifierPrefix=u,this.onUncaughtError=p,this.onCaughtError=m,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=E,this.incompleteTransitions=new Map}function yy(i,s,l,u,p,m,v,E,R,F,G,$){return i=new RE(i,s,l,v,E,R,F,$),s=1,m===!0&&(s|=24),m=sn(3,null,null,s),i.current=m,m.stateNode=i,s=Ju(),s.refCount++,i.pooledCache=s,s.refCount++,m.memoizedState={element:u,isDehydrated:l,cache:s},ih(m),i}function by(i){return i?(i=sa,i):sa}function vy(i,s,l,u,p,m){p=by(p),u.context===null?u.context=p:u.pendingContext=p,u=Ci(s),u.payload={element:l},m=m===void 0?null:m,m!==null&&(u.callback=m),l=Ti(i,u,s),l!==null&&(cn(l,i,s),Tr(l,i,s))}function Ay(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<s?l:s}}function bd(i,s){Ay(i,s),(i=i.alternate)&&Ay(i,s)}function Sy(i){if(i.tag===13){var s=ia(i,67108864);s!==null&&cn(s,i,67108864),bd(i,67108864)}}var nc=!0;function DE(i,s,l,u){var p=I.T;I.T=null;var m=M.p;try{M.p=2,vd(i,s,l,u)}finally{M.p=m,I.T=p}}function ME(i,s,l,u){var p=I.T;I.T=null;var m=M.p;try{M.p=8,vd(i,s,l,u)}finally{M.p=m,I.T=p}}function vd(i,s,l,u){if(nc){var p=Ad(u);if(p===null)od(i,s,u,ic,l),wy(i,u);else if(OE(p,i,s,l,u))u.stopPropagation();else if(wy(i,u),s&4&&-1<NE.indexOf(i)){for(;p!==null;){var m=qs(p);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var v=ss(m.pendingLanes);if(v!==0){var E=m;for(E.pendingLanes|=2,E.entangledLanes|=2;v;){var R=1<<31-en(v);E.entanglements[1]|=R,v&=~R}Hn(m),(Ft&6)===0&&(zl=Ln()+500,Gr(0))}}break;case 13:E=ia(m,2),E!==null&&cn(E,m,2),jl(),bd(m,2)}if(m=Ad(u),m===null&&od(i,s,u,ic,l),m===p)break;p=m}p!==null&&u.stopPropagation()}else od(i,s,u,null,l)}}function Ad(i){return i=Tu(i),Sd(i)}var ic=null;function Sd(i){if(ic=null,i=Vs(i),i!==null){var s=o(i);if(s===null)i=null;else{var l=s.tag;if(l===13){if(i=c(s),i!==null)return i;i=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return ic=i,null}function Ey(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(mA()){case Bp:return 2;case Fp:return 8;case Wo:case _A:return 32;case Hp:return 268435456;default:return 32}default:return 32}}var Ed=!1,Hi=null,zi=null,Ui=null,Qr=new Map,Zr=new Map,ji=[],NE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function wy(i,s){switch(i){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":zi=null;break;case"mouseover":case"mouseout":Ui=null;break;case"pointerover":case"pointerout":Qr.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zr.delete(s.pointerId)}}function Jr(i,s,l,u,p,m){return i===null||i.nativeEvent!==m?(i={blockedOn:s,domEventName:l,eventSystemFlags:u,nativeEvent:m,targetContainers:[p]},s!==null&&(s=qs(s),s!==null&&Sy(s)),i):(i.eventSystemFlags|=u,s=i.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),i)}function OE(i,s,l,u,p){switch(s){case"focusin":return Hi=Jr(Hi,i,s,l,u,p),!0;case"dragenter":return zi=Jr(zi,i,s,l,u,p),!0;case"mouseover":return Ui=Jr(Ui,i,s,l,u,p),!0;case"pointerover":var m=p.pointerId;return Qr.set(m,Jr(Qr.get(m)||null,i,s,l,u,p)),!0;case"gotpointercapture":return m=p.pointerId,Zr.set(m,Jr(Zr.get(m)||null,i,s,l,u,p)),!0}return!1}function Cy(i){var s=Vs(i.target);if(s!==null){var l=o(s);if(l!==null){if(s=l.tag,s===13){if(s=c(l),s!==null){i.blockedOn=s,CA(i.priority,function(){if(l.tag===13){var u=ln();u=gu(u);var p=ia(l,u);p!==null&&cn(p,l,u),bd(l,u)}});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function sc(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var l=Ad(i.nativeEvent);if(l===null){l=i.nativeEvent;var u=new l.constructor(l.type,l);Cu=u,l.target.dispatchEvent(u),Cu=null}else return s=qs(l),s!==null&&Sy(s),i.blockedOn=l,!1;s.shift()}return!0}function Ty(i,s,l){sc(i)&&l.delete(s)}function kE(){Ed=!1,Hi!==null&&sc(Hi)&&(Hi=null),zi!==null&&sc(zi)&&(zi=null),Ui!==null&&sc(Ui)&&(Ui=null),Qr.forEach(Ty),Zr.forEach(Ty)}function ac(i,s){i.blockedOn===s&&(i.blockedOn=null,Ed||(Ed=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,kE)))}var rc=null;function xy(i){rc!==i&&(rc=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){rc===i&&(rc=null);for(var s=0;s<i.length;s+=3){var l=i[s],u=i[s+1],p=i[s+2];if(typeof u!="function"){if(Sd(u||l)===null)continue;break}var m=qs(l);m!==null&&(i.splice(s,3),s-=3,Sh(m,{pending:!0,data:p,method:l.method,action:u},u,p))}}))}function to(i){function s(R){return ac(R,i)}Hi!==null&&ac(Hi,i),zi!==null&&ac(zi,i),Ui!==null&&ac(Ui,i),Qr.forEach(s),Zr.forEach(s);for(var l=0;l<ji.length;l++){var u=ji[l];u.blockedOn===i&&(u.blockedOn=null)}for(;0<ji.length&&(l=ji[0],l.blockedOn===null);)Cy(l),l.blockedOn===null&&ji.shift();if(l=(i.ownerDocument||i).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var p=l[u],m=l[u+1],v=p[Ge]||null;if(typeof m=="function")v||xy(l);else if(v){var E=null;if(m&&m.hasAttribute("formAction")){if(p=m,v=m[Ge]||null)E=v.formAction;else if(Sd(p)!==null)continue}else E=v.action;typeof E=="function"?l[u+1]=E:(l.splice(u,3),u-=3),xy(l)}}}function wd(i){this._internalRoot=i}oc.prototype.render=wd.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(n(409));var l=s.current,u=ln();vy(l,u,i,s,null,null)},oc.prototype.unmount=wd.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;vy(i.current,2,null,i,null,null),jl(),s[Gs]=null}};function oc(i){this._internalRoot=i}oc.prototype.unstable_scheduleHydration=function(i){if(i){var s=Vp();i={blockedOn:null,target:i,priority:s};for(var l=0;l<ji.length&&s!==0&&s<ji[l].priority;l++);ji.splice(l,0,i),l===0&&Cy(i)}};var Ry=t.version;if(Ry!=="19.1.1")throw Error(n(527,Ry,"19.1.1"));M.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=d(s),i=i!==null?f(i):null,i=i===null?null:i.stateNode,i};var LE={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{sr=lc.inject(LE),tn=lc}catch{}}return no.createRoot=function(i,s){if(!a(i))throw Error(n(299));var l=!1,u="",p=Vm,m=qm,v=Ym,E=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(p=s.onUncaughtError),s.onCaughtError!==void 0&&(m=s.onCaughtError),s.onRecoverableError!==void 0&&(v=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(E=s.unstable_transitionCallbacks)),s=yy(i,1,!1,null,null,l,u,p,m,v,E,null),i[Gs]=s.current,rd(i),new wd(s)},no.hydrateRoot=function(i,s,l){if(!a(i))throw Error(n(299));var u=!1,p="",m=Vm,v=qm,E=Ym,R=null,F=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(m=l.onUncaughtError),l.onCaughtError!==void 0&&(v=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(R=l.unstable_transitionCallbacks),l.formState!==void 0&&(F=l.formState)),s=yy(i,1,!0,s,l??null,u,p,m,v,E,R,F),s.context=by(null),l=s.current,u=ln(),u=gu(u),p=Ci(u),p.callback=null,Ti(l,p,u),l=u,s.current.lanes=l,rr(s,l),Hn(s),i[Gs]=s.current,rd(i),new oc(s)},no.version="19.1.1",no}var zy;function VE(){if(zy)return Rd.exports;zy=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Rd.exports=GE(),Rd.exports}var qE=VE();const ze=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Jd=[.001,0,0,.001,0,0],Od=1.35,un={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Xi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},lv="pdfjs_internal_editor_",mt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Ot={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},YE={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},De={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},vc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},de={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Na={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},$c={ERRORS:0,WARNINGS:1,INFOS:5},So={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},cc={moveTo:0,lineTo:1,curveTo:2,closePath:3},XE={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Wc=$c.WARNINGS;function $E(r){Number.isInteger(r)&&(Wc=r)}function WE(){return Wc}function Kc(r){Wc>=$c.INFOS&&console.log(`Info: ${r}`)}function yt(r){Wc>=$c.WARNINGS&&console.log(`Warning: ${r}`)}function Vt(r){throw new Error(r)}function ge(r,t){r||Vt(t)}function KE(r){switch(r?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function cv(r,t=null,e=null){if(!r)return null;if(e&&typeof r=="string"&&(e.addDefaultProtocol&&r.startsWith("www.")&&r.match(/\./g)?.length>=2&&(r=`http://${r}`),e.tryConvertEncoding))try{r=e1(r)}catch{}const n=t?URL.parse(r,t):URL.parse(r);return KE(n)?n:null}function uv(r,t,e=!1){const n=URL.parse(r);return n?(n.hash=t,n.href):e&&cv(r,"http://example.com")?r.split("#",1)[0]+`${t?`#${t}`:""}`:""}function Tt(r,t,e,n=!1){return Object.defineProperty(r,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}const Bs=(function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t})();class Uy extends Bs{constructor(t,e){super(t,"PasswordException"),this.code=e}}class kd extends Bs{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class tf extends Bs{constructor(t){super(t,"InvalidPDFException")}}class Cc extends Bs{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class QE extends Bs{constructor(t){super(t,"FormatError")}}class Zi extends Bs{constructor(t){super(t,"AbortException")}}function hv(r){(typeof r!="object"||r?.length===void 0)&&Vt("Invalid argument for bytesToString");const t=r.length,e=8192;if(t<e)return String.fromCharCode.apply(null,r);const n=[];for(let a=0;a<t;a+=e){const o=Math.min(a+e,t),c=r.subarray(a,o);n.push(String.fromCharCode.apply(null,c))}return n.join("")}function Bo(r){typeof r!="string"&&Vt("Invalid argument for stringToBytes");const t=r.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=r.charCodeAt(n)&255;return e}function ZE(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,r&255)}function JE(){const r=new Uint8Array(4);return r[0]=1,new Uint32Array(r.buffer,0,1)[0]===1}function t1(){try{return new Function(""),!0}catch{return!1}}class ke{static get isLittleEndian(){return Tt(this,"isLittleEndian",JE())}static get isEvalSupported(){return Tt(this,"isEvalSupported",t1())}static get isOffscreenCanvasSupported(){return Tt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Tt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return Tt(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return Tt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Ld=Array.from(Array(256).keys(),r=>r.toString(16).padStart(2,"0"));class at{static makeHexColor(t,e,n){return`#${Ld[t]}${Ld[e]}${Ld[n]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,n=0){const a=t[n],o=t[n+1];t[n]=a*e[0]+o*e[2]+e[4],t[n+1]=a*e[1]+o*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const a=e[0],o=e[1],c=e[2],h=e[3],d=e[4],f=e[5];for(let g=0;g<6;g+=2){const _=t[n+g],y=t[n+g+1];t[n+g]=_*a+y*c+d,t[n+g+1]=_*o+y*h+f}}static applyInverseTransform(t,e){const n=t[0],a=t[1],o=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-a*e[2]+e[2]*e[5]-e[4]*e[3])/o,t[1]=(-n*e[1]+a*e[0]+e[4]*e[1]-e[5]*e[0])/o}static axialAlignedBoundingBox(t,e,n){const a=e[0],o=e[1],c=e[2],h=e[3],d=e[4],f=e[5],g=t[0],_=t[1],y=t[2],b=t[3];let A=a*g+d,S=A,C=a*y+d,w=C,D=h*_+f,x=D,k=h*b+f,O=k;if(o!==0||c!==0){const P=o*g,j=o*y,Y=c*_,K=c*b;A+=Y,w+=Y,C+=K,S+=K,D+=P,O+=P,k+=j,x+=j}n[0]=Math.min(n[0],A,C,S,w),n[1]=Math.min(n[1],D,k,x,O),n[2]=Math.max(n[2],A,C,S,w),n[3]=Math.max(n[3],D,k,x,O)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],a=t[1],o=t[2],c=t[3],h=n**2+a**2,d=n*o+a*c,f=o**2+c**2,g=(h+f)/2,_=Math.sqrt(g**2-(h*f-d**2));e[0]=Math.sqrt(g+_||1),e[1]=Math.sqrt(g-_||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),a=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>a)return null;const o=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),c=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return o>c?null:[n,o,a,c]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,a,o){o[0]=Math.min(o[0],t,n),o[1]=Math.min(o[1],e,a),o[2]=Math.max(o[2],t,n),o[3]=Math.max(o[3],e,a)}static#t(t,e,n,a,o,c,h,d,f,g){if(f<=0||f>=1)return;const _=1-f,y=f*f,b=y*f,A=_*(_*(_*t+3*f*e)+3*y*n)+b*a,S=_*(_*(_*o+3*f*c)+3*y*h)+b*d;g[0]=Math.min(g[0],A),g[1]=Math.min(g[1],S),g[2]=Math.max(g[2],A),g[3]=Math.max(g[3],S)}static#e(t,e,n,a,o,c,h,d,f,g,_,y){if(Math.abs(f)<1e-12){Math.abs(g)>=1e-12&&this.#t(t,e,n,a,o,c,h,d,-_/g,y);return}const b=g**2-4*_*f;if(b<0)return;const A=Math.sqrt(b),S=2*f;this.#t(t,e,n,a,o,c,h,d,(-g+A)/S,y),this.#t(t,e,n,a,o,c,h,d,(-g-A)/S,y)}static bezierBoundingBox(t,e,n,a,o,c,h,d,f){f[0]=Math.min(f[0],t,h),f[1]=Math.min(f[1],e,d),f[2]=Math.max(f[2],t,h),f[3]=Math.max(f[3],e,d),this.#e(t,n,o,h,e,a,c,d,3*(-t+3*(n-o)+h),6*(t-2*n+o),3*(n-t),f),this.#e(t,n,o,h,e,a,c,d,3*(-e+3*(a-c)+d),6*(e-2*a+c),3*(a-e),f)}}function e1(r){return decodeURIComponent(escape(r))}let Id=null,jy=null;function n1(r){return Id||(Id=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,jy=new Map([["ﬅ","ſt"]])),r.replaceAll(Id,(t,e,n)=>e?e.normalize("NFKC"):jy.get(n))}function dv(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const r=new Uint8Array(32);return crypto.getRandomValues(r),hv(r)}const Bf="pdfjs_internal_id_";function i1(r,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[n,a,...o]=e;if(!r(n)&&!Number.isInteger(n)||!t(a))return!1;const c=o.length;let h=!0;switch(a.name){case"XYZ":if(c<2||c>3)return!1;break;case"Fit":case"FitB":return c===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(c>1)return!1;break;case"FitR":if(c!==4)return!1;h=!1;break;default:return!1}for(const d of o)if(!(typeof d=="number"||h&&d===null))return!1;return!0}function Ue(r,t,e){return Math.min(Math.max(r,t),e)}function fv(r){return Uint8Array.prototype.toBase64?r.toBase64():btoa(hv(r))}function s1(r){return Uint8Array.fromBase64?Uint8Array.fromBase64(r):Bo(atob(r))}typeof Promise.try!="function"&&(Promise.try=function(r,...t){return new Promise(e=>{e(r(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(r){return r.reduce((t,e)=>t+e,0)});const ui="http://www.w3.org/2000/svg";class qa{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Fo(r,t="text"){if(ho(r,document.baseURI)){const e=await fetch(r);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{const a=new XMLHttpRequest;a.open("GET",r,!0),a.responseType=t,a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE){if(a.status===200||a.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(a.response);return}e(a.responseText);return}n(new Error(a.statusText))}},a.send(null)})}class Ho{constructor({viewBox:t,userUnit:e,scale:n,rotation:a,offsetX:o=0,offsetY:c=0,dontFlip:h=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=a,this.offsetX=o,this.offsetY=c,n*=e;const d=(t[2]+t[0])/2,f=(t[3]+t[1])/2;let g,_,y,b;switch(a%=360,a<0&&(a+=360),a){case 180:g=-1,_=0,y=0,b=1;break;case 90:g=0,_=1,y=1,b=0;break;case 270:g=0,_=-1,y=-1,b=0;break;case 0:g=1,_=0,y=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}h&&(y=-y,b=-b);let A,S,C,w;g===0?(A=Math.abs(f-t[1])*n+o,S=Math.abs(d-t[0])*n+c,C=(t[3]-t[1])*n,w=(t[2]-t[0])*n):(A=Math.abs(d-t[0])*n+o,S=Math.abs(f-t[1])*n+c,C=(t[2]-t[0])*n,w=(t[3]-t[1])*n),this.transform=[g*n,_*n,y*n,b*n,A-g*n*d-y*n*f,S-_*n*d-b*n*f],this.width=C,this.height=w}get rawDims(){const t=this.viewBox;return Tt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:a=this.offsetY,dontFlip:o=!1}={}){return new Ho({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:a,dontFlip:o})}convertToViewportPoint(t,e){const n=[t,e];return at.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];at.applyTransform(e,this.transform);const n=[t[2],t[3]];return at.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return at.applyInverseTransform(n,this.transform),n}}class Ff extends Bs{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Qc(r){const t=r.length;let e=0;for(;e<t&&r[e].trim()==="";)e++;return r.substring(e,e+5).toLowerCase()==="data:"}function Hf(r){return typeof r=="string"&&/\.pdf$/i.test(r)}function a1(r){return[r]=r.split(/[#?]/,1),r.substring(r.lastIndexOf("/")+1)}function r1(r,t="document.pdf"){if(typeof r!="string")return t;if(Qc(r))return yt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(h=>{try{return new URL(h)}catch{try{return new URL(decodeURIComponent(h))}catch{try{return new URL(h,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(h),"https://foo.bar")}catch{return null}}}}})(r);if(!n)return t;const a=h=>{try{let d=decodeURIComponent(h);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:h):d}catch{return h}},o=/\.pdf$/i,c=n.pathname.split("/").at(-1);if(o.test(c))return a(c);if(n.searchParams.size>0){const h=Array.from(n.searchParams.values()).reverse();for(const f of h)if(o.test(f))return a(f);const d=Array.from(n.searchParams.keys()).reverse();for(const f of d)if(o.test(f))return a(f)}if(n.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(d)return a(d[0])}return t}class Gy{started=Object.create(null);times=[];time(t){t in this.started&&yt(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||yt(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:a,end:o}of this.times)t.push(`${n.padEnd(e)} ${o-a}ms
`);return t.join("")}}function ho(r,t){const e=t?URL.parse(r,t):URL.parse(r);return e?.protocol==="http:"||e?.protocol==="https:"}function Cn(r){r.preventDefault()}function fe(r){r.preventDefault(),r.stopPropagation()}function o1(r){console.log("Deprecated API usage: "+r)}class ef{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const n=parseInt(e[1],10);let a=parseInt(e[2],10);a=a>=1&&a<=12?a-1:0;let o=parseInt(e[3],10);o=o>=1&&o<=31?o:1;let c=parseInt(e[4],10);c=c>=0&&c<=23?c:0;let h=parseInt(e[5],10);h=h>=0&&h<=59?h:0;let d=parseInt(e[6],10);d=d>=0&&d<=59?d:0;const f=e[7]||"Z";let g=parseInt(e[8],10);g=g>=0&&g<=23?g:0;let _=parseInt(e[9],10)||0;return _=_>=0&&_<=59?_:0,f==="-"?(c+=g,h+=_):f==="+"&&(c-=g,h-=_),new Date(Date.UTC(n,a,o,c,h,d))}}function l1(r,{scale:t=1,rotation:e=0}){const{width:n,height:a}=r.attributes.style,o=[0,0,parseInt(n),parseInt(a)];return new Ho({viewBox:o,userUnit:1,scale:t,rotation:e})}function Zc(r){if(r.startsWith("#")){const t=parseInt(r.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return r.startsWith("rgb(")?r.slice(4,-1).split(",").map(t=>parseInt(t)):r.startsWith("rgba(")?r.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(yt(`Not a valid color format: "${r}"`),[0,0,0])}function c1(r){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of r.keys()){t.style.color=e;const n=window.getComputedStyle(t).color;r.set(e,Zc(n))}t.remove()}function te(r){const{a:t,b:e,c:n,d:a,e:o,f:c}=r.getTransform();return[t,e,n,a,o,c]}function jn(r){const{a:t,b:e,c:n,d:a,e:o,f:c}=r.getTransform().invertSelf();return[t,e,n,a,o,c]}function Ns(r,t,e=!1,n=!0){if(t instanceof Ho){const{pageWidth:a,pageHeight:o}=t.rawDims,{style:c}=r,h=ke.isCSSRoundSupported,d=`var(--total-scale-factor) * ${a}px`,f=`var(--total-scale-factor) * ${o}px`,g=h?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,_=h?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!e||t.rotation%180===0?(c.width=g,c.height=_):(c.width=_,c.height=g)}n&&r.setAttribute("data-main-rotation",t.rotation)}class Xn{constructor(){const{pixelRatio:t}=Xn;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,a,o=-1){let c=1/0,h=1/0,d=1/0;n=Xn.capPixels(n,o),n>0&&(c=Math.sqrt(n/(t*e))),a!==-1&&(h=a/t,d=a/e);const f=Math.min(c,h,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const nf=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class go{#t=null;#e=null;#n;#i=null;#a=null;#s=null;#r=null;static#o=null;constructor(t){this.#n=t,go.#o||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#n._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Cn,{signal:e}),t.addEventListener("pointerdown",go.#l,{signal:e}));const n=this.#i=document.createElement("div");n.className="buttons",t.append(n);const a=this.#n.toolbarPosition;if(a){const{style:o}=t,c=this.#n._uiManager.direction==="ltr"?1-a[0]:a[0];o.insetInlineEnd=`${100*c}%`,o.top=`calc(${100*a[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#c(t){this.#n._focusEventsAllowed=!1,fe(t)}#d(t){this.#n._focusEventsAllowed=!0,fe(t)}#u(t){const e=this.#n._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#c.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Cn,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#s?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#n,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",go.#o[t]),this.#u(n)&&n.addEventListener("click",a=>{e.delete()},{signal:e._signal}),this.#i.append(n)}get#f(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#u(e),this.#i.append(e,this.#f),this.#a=t}addComment(t){if(this.#s)return;const e=t.render();e&&(this.#u(e),this.#i.append(e,this.#f),this.#s=t,t.toolbar=this)}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#u(e),this.#i.append(e,this.#f)}async addEditSignatureButton(t){const e=this.#r=await t.renderEditButton(this.#n);this.#u(e),this.#i.append(e,this.#f)}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}updateEditSignatureButton(t){this.#r&&(this.#r.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class u1{#t=null;#e=null;#n;constructor(t){this.#n=t}#i(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#n._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Cn,{signal:e});const n=this.#t=document.createElement("div");return n.className="buttons",t.append(n),this.#n.hasCommentManager()&&this.#s("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#s("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),t}#a(t,e){let n=0,a=0;for(const o of t){const c=o.y+o.height;if(c<n)continue;const h=o.x+(e?o.width:0);if(c>n){a=h,n=c;continue}e?h>a&&(a=h):h<a&&(a=h)}return[e?1-a:a,n]}show(t,e,n){const[a,o]=this.#a(e,n),{style:c}=this.#e||=this.#i();t.append(this.#e),c.insetInlineEnd=`${100*a}%`,c.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#s(t,e,n,a){const o=document.createElement("button");o.classList.add("basic",t),o.tabIndex=0,o.setAttribute("data-l10n-id",e);const c=document.createElement("span");o.append(c),c.className="visuallyHidden",c.setAttribute("data-l10n-id",n);const h=this.#n._signal;h instanceof AbortSignal&&!h.aborted&&(o.addEventListener("contextmenu",Cn,{signal:h}),o.addEventListener("click",a,{signal:h})),this.#t.append(o)}}function pv(r,t,e){for(const n of e)t.addEventListener(n,r[n].bind(r))}class h1{#t=0;get id(){return`${lv}${this.#t++}`}}class zf{#t=dv();#e=0;#n=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),a=new Image;a.src=t;const o=a.decode().then(()=>(n.drawImage(a,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Tt(this,"_isSVGFittingCanvas",o)}async#i(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let a;if(typeof e=="string"?(n.url=e,a=await Fo(e,"blob")):e instanceof File?a=n.file=e:e instanceof Blob&&(a=e),a.type==="image/svg+xml"){const o=zf._isSVGFittingCanvas,c=new FileReader,h=new Image,d=new Promise((f,g)=>{h.onload=()=>{n.bitmap=h,n.isSvg=!0,f()},c.onload=async()=>{const _=n.svgUrl=c.result;h.src=await o?`${_}#svgView(preserveAspectRatio(none))`:_},h.onerror=c.onerror=g});c.readAsDataURL(a),await d}else n.bitmap=await createImageBitmap(a);n.refCounter=1}catch(a){yt(a),n=null}return this.#n.set(t,n),n&&this.#n.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:a,type:o}=t;return this.#i(`${e}_${n}_${a}_${o}`,t)}async getFromUrl(t){return this.#i(t,t)}async getFromBlob(t,e){const n=await e;return this.#i(t,n)}async getFromId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n?.bitmap)return n.refCounter+=1,n;const a=new OffscreenCanvas(e.width,e.height);return a.getContext("2d").drawImage(e,0,0),n={bitmap:a.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#n.set(t,n),this.#n.set(n.id,n),n}getSvgUrl(t){const e=this.#n.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:n}=e;if(!e.url&&!e.file){const a=new OffscreenCanvas(n.width,n.height);a.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=a.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class d1{#t=[];#e=!1;#n;#i=-1;constructor(t=128){this.#n=t}add({cmd:t,undo:e,post:n,mustExec:a,type:o=NaN,overwriteIfSameType:c=!1,keepUndo:h=!1}){if(a&&t(),this.#e)return;const d={cmd:t,undo:e,post:n,type:o};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(d);return}if(c&&this.#t[this.#i].type===o){h&&(d.undo=this.#t[this.#i].undo),this.#t[this.#i]=d;return}const f=this.#i+1;f===this.#n?this.#t.splice(0,1):(this.#i=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(d)}undo(){if(this.#i===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(t){if(this.#i!==-1){for(let e=this.#i;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#i-e),this.#i=e;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}}class zo{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=ke.platform;for(const[n,a,o={}]of t)for(const c of n){const h=c.startsWith("mac+");e&&h?(this.callbacks.set(c.slice(4),{callback:a,options:o}),this.allKeys.add(c.split("+").at(-1))):!e&&!h&&(this.callbacks.set(c,{callback:a,options:o}),this.allKeys.add(c.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#t(e));if(!n)return;const{callback:a,options:{bubbles:o=!1,args:c=[],checker:h=null}}=n;h&&!h(t,e)||(a.bind(t,...c,e)(),o||fe(e))}}class Uf{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return c1(t),Tt(this,"_colors",t)}convert(t){const e=Zc(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,a]of this._colors)if(a.every((o,c)=>o===e[c]))return Uf._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?at.makeHexColor(...e):t}}class Ji{#t=new AbortController;#e=null;#n=null;#i=new Map;#a=new Map;#s=null;#r=null;#o=null;#l=new d1;#c=null;#d=null;#u=null;#f=0;#g=new Set;#p=null;#h=null;#m=new Set;_editorUndoBar=null;#b=!1;#_=!1;#A=!1;#S=null;#y=null;#E=null;#R=null;#T=!1;#w=null;#O=new h1;#x=!1;#D=!1;#I=!1;#k=null;#L=null;#P=null;#N=null;#H=null;#C=mt.NONE;#v=new Set;#z=null;#U=null;#G=null;#$=null;#Y=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#B=[0,0];#V=null;#q=null;#Z=null;#J=null;#F=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Ji.prototype,e=c=>c.#q.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&c.hasSomethingToControl(),n=(c,{target:h})=>{if(h instanceof HTMLInputElement){const{type:d}=h;return d!=="text"&&d!=="number"}return!0},a=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Tt(this,"_keyboardManager",new zo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(c,{target:h})=>!(h instanceof HTMLButtonElement)&&c.#q.contains(h)&&!c.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(c,{target:h})=>!(h instanceof HTMLButtonElement)&&c.#q.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:e}]]))}constructor(t,e,n,a,o,c,h,d,f,g,_,y,b,A,S,C){const w=this._signal=this.#t.signal;this.#q=t,this.#Z=e,this.#J=n,this.#s=a,this.#c=o,this.#U=c,this.#Y=d,this._eventBus=h,h._on("editingaction",this.onEditingAction.bind(this),{signal:w}),h._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),h._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),h._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),h._on("setpreference",this.onSetPreference.bind(this),{signal:w}),h._on("switchannotationeditorparams",D=>this.updateParams(D.type,D.value),{signal:w}),window.addEventListener("pointerdown",()=>{this.#D=!0},{capture:!0,signal:w}),window.addEventListener("pointerup",()=>{this.#D=!1},{capture:!0,signal:w}),this.#lt(),this.#dt(),this.#et(),this.#r=d.annotationStorage,this.#S=d.filterFactory,this.#G=f,this.#R=g||null,this.#b=_,this.#_=y,this.#A=b,this.#H=A||null,this.viewParameters={realScale:qa.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=S||null,this._supportsPinchToZoom=C!==!1}destroy(){this.#F?.resolve(),this.#F=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#i.clear(),this.#m.clear(),this.#N?.clear(),this.#e=null,this.#v.clear(),this.#l.destroy(),this.#s?.destroy(),this.#c?.destroy(),this.#U?.destroy(),this.#w?.hide(),this.#w=null,this.#P?.destroy(),this.#P=null,this.#n=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#V&&(clearTimeout(this.#V),this.#V=null),this._editorUndoBar?.destroy(),this.#Y=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#_}get useNewAltTextWhenAddingImage(){return this.#A}get hcmFilter(){return Tt(this,"hcmFilter",this.#G?this.#S.addHCMFilter(this.#G.foreground,this.#G.background):"none")}get direction(){return Tt(this,"direction",getComputedStyle(this.#q).direction)}get _highlightColors(){return Tt(this,"_highlightColors",this.#R?new Map(this.#R.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return Tt(this,"highlightColors",null);const e=new Map,n=!!this.#G;for(const[a,o]of t){const c=a.endsWith("_HCM");if(n&&c){e.set(a.replace("_HCM",""),o);continue}!n&&!c&&e.set(a,o)}return Tt(this,"highlightColors",e)}get highlightColorNames(){return Tt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#u=t}setMainHighlightColorPicker(t){this.#P=t}editAltText(t,e=!1){this.#s?.editAltText(this,t,e)}hasCommentManager(){return!!this.#c}editComment(t,e){this.#c?.open(this,t,e)}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#A=e;break}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#q.focus()}findParent(t,e){for(const n of this.#a.values()){const{x:a,y:o,width:c,height:h}=n.div.getBoundingClientRect();if(t>=a&&t<=a+c&&e>=o&&e<=o+h)return n}return null}disableUserSelect(t=!1){this.#Z.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#m.add(t)}removeShouldRescale(t){this.#m.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*qa.PDF_TO_CSS_UNITS;for(const e of this.#m)e.onScaleChanging();this.#u?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of this.#a.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(t="",e=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:a,anchorOffset:o,focusNode:c,focusOffset:h}=n,d=n.toString(),g=this.#Q(n).closest(".textLayer"),_=this.getSelectionBoxes(g);if(!_)return;n.empty();const y=this.#tt(g),b=this.#C===mt.NONE,A=()=>{const S=y?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:_,anchorNode:a,anchorOffset:o,focusNode:c,focusOffset:h,text:d});b&&this.showAllEditors("highlight",!0,!0),e&&S?.editComment()};if(b){this.switchToMode(mt.HIGHLIGHT,A);return}A()}commentSelection(t=""){this.highlightSelection(t,!0)}#rt(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=this.#Q(t).closest(".textLayer"),a=this.getSelectionBoxes(n);a&&(this.#w||=new u1(this),this.#w.show(n,a,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#r&&!this.#r.has(t.id)&&this.#r.setValue(t.id,t)}a11yAlert(t,e=null){const n=this.#J;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#ot(){const t=document.getSelection();if(!t||t.isCollapsed){this.#z&&(this.#w?.hide(),this.#z=null,this.#M({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#z)return;const a=this.#Q(t).closest(".textLayer");if(!a){this.#z&&(this.#w?.hide(),this.#z=null,this.#M({hasSelectedText:!1}));return}if(this.#w?.hide(),this.#z=e,this.#M({hasSelectedText:!0}),!(this.#C!==mt.HIGHLIGHT&&this.#C!==mt.NONE)&&(this.#C===mt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#T=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#C===mt.HIGHLIGHT?this.#tt(a):null;if(o?.toggleDrawing(),this.#D){const c=new AbortController,h=this.combinedSignal(c),d=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),o?.toggleDrawing(!0),f.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("blur",d,{signal:h})}else o?.toggleDrawing(!0),this.#W("main_toolbar")}}#W(t=""){this.#C===mt.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#rt()}#lt(){document.addEventListener("selectionchange",this.#ot.bind(this),{signal:this._signal})}#ct(){if(this.#E)return;this.#E=new AbortController;const t=this.combinedSignal(this.#E);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ut(){this.#E?.abort(),this.#E=null}blur(){if(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#v)if(e.div.contains(t)){this.#L=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#L)return;const[t,e]=this.#L;this.#L=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#k)return;this.#k=new AbortController;const t=this.combinedSignal(this.#k);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ht(){this.#k?.abort(),this.#k=null}#nt(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#it(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.#nt()}removeEditListeners(){this.#ht(),this.#it()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#h)if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#h)if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of this.#v){const a=n.serialize(!0);a&&e.push(a)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const o of e.items)for(const c of this.#h)if(c.isHandlingMimeForPasting(o.type)){c.paste(o,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){yt(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const a=this.currentLayer;try{const o=[];for(const d of n){const f=await a.deserialize(d);if(!f)return;o.push(f)}const c=()=>{for(const d of o)this.#st(d);this.#at(o)},h=()=>{for(const d of o)d.remove()};this.addCommands({cmd:c,undo:h,mustExec:!0})}catch(o){yt(`paste: "${o.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==mt.NONE&&!this.isEditorHandlingKeyboard&&Ji._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#M(t){Object.entries(t).some(([n,a])=>this.#X[n]!==a)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#C===mt.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#j([[Ot.HIGHLIGHT_FREE,!0]]))}#j(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ct(),this.#nt(),this.#M({isEditing:this.#C!==mt.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ut(),this.#it(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#h){this.#h=t;for(const e of this.#h)this.#j(e.defaultPropertiesToUpdate)}}getId(){return this.#O.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#a.set(t.pageIndex,t),this.#x?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,n=!1,a=!1,o=!1){if(this.#C!==t&&!(this.#F&&(await this.#F.promise,!this.#F))){if(this.#F=Promise.withResolvers(),this.#u?.commitOrRemove(),this.#C===mt.POPUP&&this.#c?.hideSidebar(),this.#C=t,t===mt.NONE){this.setEditingState(!1),this.#pt(),this._editorUndoBar?.hide(),this.#F.resolve();return}t===mt.SIGNATURE&&await this.#U?.loadSignatures(),t===mt.POPUP&&(this.#n||=await this.#Y.getAnnotationsByType(new Set(this.#h.map(c=>c._editorType))),this.#c?.showSidebar(this.#n)),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const c of this.#a.values())c.updateMode(t);if(!e){n&&this.addNewEditorFromKeyboard(),this.#F.resolve();return}for(const c of this.#i.values())c.annotationElementId===e||c.id===e?(this.setSelected(c),o?c.editComment():a&&c.enterInEditMode()):c.unselect();this.#F.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#h){switch(t){case Ot.CREATE:this.currentLayer.addNewEditor(e);return;case Ot.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#$||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const n of this.#v)n.updateParams(t,e);else for(const n of this.#h)n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){for(const o of this.#i.values())o.editorType===t&&o.show(e);(this.#$?.get(Ot.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#j([[Ot.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#I!==t){this.#I=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#x){this.#x=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#pt(){if(this.unselectAll(),this.#x){this.#x=!1;for(const t of this.#a.values())t.disable();for(const t of this.#i.values())t.disable()}}getEditors(t){const e=[];for(const n of this.#i.values())n.pageIndex===t&&e.push(n);return e}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#N?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#g.has(t.annotationElementId))&&this.#r?.remove(t.id)}addDeletedAnnotationElement(t){this.#g.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#g.has(t)}removeDeletedAnnotationElement(t){this.#g.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#j(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#v);return t}updateUI(t){this.#gt===t&&this.#j(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#j(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#u?.commitOrRemove();for(const e of this.#v)e!==t&&e.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#M({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#l.add(t),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#l.cleanType(t)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#v],n=()=>{this._editorUndoBar?.show(a,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},a=()=>{for(const o of e)this.#st(o)};this.addCommands({cmd:n,undo:a,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#at(t){for(const e of this.#v)e.unselect();this.#v.clear();for(const e of t)e.isEmpty()||(this.#v.add(e),e.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#v)t.commit();this.#at(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#C!==mt.NONE))&&!this.#u?.commitOrRemove()&&this.hasSelection){for(const t of this.#v)t.unselect();this.#v.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#B[0]+=t,this.#B[1]+=e;const[a,o]=this.#B,c=[...this.#v],h=1e3;this.#V&&clearTimeout(this.#V),this.#V=setTimeout(()=>{this.#V=null,this.#B[0]=this.#B[1]=0,this.addCommands({cmd:()=>{for(const d of c)this.#i.has(d.id)&&(d.translateInPage(a,o),d.translationDone())},undo:()=>{for(const d of c)this.#i.has(d.id)&&(d.translateInPage(-a,-o),d.translationDone())},mustExec:!1})},h);for(const d of c)d.translateInPage(t,e),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const t of this.#v)this.#p.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const t=this.#p;this.#p=null;let e=!1;for(const[{x:a,y:o,pageIndex:c},h]of t)h.newX=a,h.newY=o,h.newPageIndex=c,e||=a!==h.savedX||o!==h.savedY||c!==h.savedPageIndex;if(!e)return!1;const n=(a,o,c,h)=>{if(this.#i.has(a.id)){const d=this.#a.get(h);d?a._setParentAndPosition(d,o,c):(a.pageIndex=h,a.x=o,a.y=c)}};return this.addCommands({cmd:()=>{for(const[a,{newX:o,newY:c,newPageIndex:h}]of t)n(a,o,c,h)},undo:()=>{for(const[a,{savedX:o,savedY:c,savedPageIndex:h}]of t)n(a,o,c,h)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#p)for(const n of this.#p.keys())n.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#C}get imageManager(){return Tt(this,"imageManager",new zf)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let f=0,g=e.rangeCount;f<g;f++)if(!t.contains(e.getRangeAt(f).commonAncestorContainer))return null;const{x:n,y:a,width:o,height:c}=t.getBoundingClientRect();let h;switch(t.getAttribute("data-main-rotation")){case"90":h=(f,g,_,y)=>({x:(g-a)/c,y:1-(f+_-n)/o,width:y/c,height:_/o});break;case"180":h=(f,g,_,y)=>({x:1-(f+_-n)/o,y:1-(g+y-a)/c,width:_/o,height:y/c});break;case"270":h=(f,g,_,y)=>({x:1-(g+y-a)/c,y:(f-n)/o,width:y/c,height:_/o});break;default:h=(f,g,_,y)=>({x:(f-n)/o,y:(g-a)/c,width:_/o,height:y/c});break}const d=[];for(let f=0,g=e.rangeCount;f<g;f++){const _=e.getRangeAt(f);if(!_.collapsed)for(const{x:y,y:b,width:A,height:S}of _.getClientRects())A===0||S===0||d.push(h(y,b,A,S))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const n=this.#r.getRawValue(e);n&&(this.#C===mt.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,e,n){const a=this.#N?.get(t);a&&(a.setCanvas(e,n),this.#N.delete(t))}addMissingCanvas(t,e){(this.#N||=new Map).set(t,e)}}class Yn{#t=null;#e=!1;#n=null;#i=null;#a=null;#s=null;#r=!1;#o=null;#l=null;#c=null;#d=null;#u=!1;static#f=null;static _l10n=null;constructor(t){this.#l=t,this.#u=t._uiManager.useNewAltTextFlow,Yn.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Yn._l10n??=t}async render(){const t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#i=document.createElement("span");t.append(e),this.#u?(t.classList.add("new"),t.setAttribute("data-l10n-id",Yn.#f.missing),e.setAttribute("data-l10n-id",Yn.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#l._uiManager._signal;t.addEventListener("contextmenu",Cn,{signal:n}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});const a=o=>{o.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#u&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",a,{capture:!0,signal:n}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(this.#r=!0,a(o))},{signal:n}),await this.#p(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#u?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#u?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(t){this.#t===null&&(this.#c=t,this.#d=await Yn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())}toggleAltTextBadge(t=!1){if(!this.#u||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#l.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#c===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:a,cancel:o=!1}){n&&(this.#c=n,this.#d=a),!(this.#t===t&&this.#e===e)&&(o||(this.#t=t,this.#e=e),this.#p())}toggle(t=!1){this.#n&&(!t&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!t)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#a=null,this.#o?.remove(),this.#o=null}async#p(){const t=this.#n;if(!t)return;if(this.#u){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Yn.#f[this.#g]),this.#i?.setAttribute("data-l10n-id",Yn.#f[`${this.#g}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#l.id}`;const a=100,o=this.#l._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#a.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},a)},{signal:o}),t.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#a?.classList.remove("show")},{signal:o})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#l.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class uc{#t=null;#e=!1;#n=null;#i=null;#a=null;#s=null;#r=!1;constructor(t){this.#n=t,this.toolbar=null}render(){if(!this.#n._uiManager.hasCommentManager())return null;const t=this.#t=document.createElement("button");t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=this.#n._uiManager._signal;if(!(e instanceof AbortSignal)||e.aborted)return t;t.addEventListener("contextmenu",Cn,{signal:e}),t.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:e});const n=a=>{a.preventDefault(),this.edit()};return t.addEventListener("click",n,{capture:!0,signal:e}),t.addEventListener("keydown",a=>{a.target===t&&a.key==="Enter"&&(this.#e=!0,n(a))},{signal:e}),t}edit(){const{bottom:t,left:e,right:n}=this.#n.getClientDimensions(),a={top:t};this.#n._uiManager.direction==="ltr"?a.right=n:a.left=e,this.#n._uiManager.editComment(this.#n,a)}finish(){this.#t&&(this.#t.focus({focusVisible:this.#e}),this.#e=!1)}isDeleted(){return this.#r||this.#a===""}hasBeenEdited(){return this.isDeleted()||this.#a!==this.#i}serialize(){return this.data}get data(){return{text:this.#a,date:this.#s,deleted:this.#r}}set data(t){if(t===null){this.#a="",this.#r=!0;return}this.#a=t,this.#s=new Date,this.#r=!1}setInitialText(t){this.#i=t,this.data=t}toggle(t=!1){this.#t&&(this.#t.disabled=!t)}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#a="",this.#s=null,this.#n=null,this.#e=!1,this.#r=!1}}class Jc{#t;#e=!1;#n=null;#i;#a;#s;#r;#o=null;#l;#c=null;#d;#u=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:a=null,onPinching:o=null,onPinchEnd:c=null,signal:h}){this.#t=t,this.#n=n,this.#i=e,this.#a=a,this.#s=o,this.#r=c,this.#d=new AbortController,this.#l=AbortSignal.any([h,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Xn.pixelRatio}#f(t){if(this.#i?.())return;if(t.touches.length===1){if(this.#o)return;const a=this.#o=new AbortController,o=AbortSignal.any([this.#l,a.signal]),c=this.#t,h={capture:!0,signal:o,passive:!1},d=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};c.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(fe(f),d(f))},h),c.addEventListener("pointerup",d,h),c.addEventListener("pointercancel",d,h);return}if(!this.#u){this.#u=new AbortController;const a=AbortSignal.any([this.#l,this.#u.signal]),o=this.#t,c={signal:a,capture:!1,passive:!1};o.addEventListener("touchmove",this.#g.bind(this),c);const h=this.#p.bind(this);o.addEventListener("touchend",h,c),o.addEventListener("touchcancel",h,c),c.capture=!0,o.addEventListener("pointerdown",fe,c),o.addEventListener("pointermove",fe,c),o.addEventListener("pointercancel",fe,c),o.addEventListener("pointerup",fe,c),this.#a?.()}if(fe(t),t.touches.length!==2||this.#n?.()){this.#c=null;return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#c={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#g(t){if(!this.#c||t.touches.length!==2)return;fe(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:a,screenY:o}=e,{screenX:c,screenY:h}=n,d=this.#c,{touch0X:f,touch0Y:g,touch1X:_,touch1Y:y}=d,b=_-f,A=y-g,S=c-a,C=h-o,w=Math.hypot(S,C)||1,D=Math.hypot(b,A)||1;if(!this.#e&&Math.abs(D-w)<=Jc.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=a,d.touch0Y=o,d.touch1X=c,d.touch1Y=h,!this.#e){this.#e=!0;return}const x=[(a+c)/2,(o+h)/2];this.#s?.(x,D,w)}#p(t){t.touches.length>=2||(this.#u&&(this.#u.abort(),this.#u=null,this.#r?.()),this.#c&&(fe(t),this.#c=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class ct{#t=null;#e=null;#n=null;#i=null;#a=!1;#s=null;#r="";#o=!1;#l=null;#c=null;#d=null;#u=null;#f="";#g=!1;#p=null;#h=!1;#m=!1;#b=!1;#_=null;#A=0;#S=0;#y=null;#E=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#R=!1;#T=ct._zIndex++;static _borderLineWidth=-1;static _colorManager=new Uf;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=ct.prototype._resizeWithKeyboard,e=Ji.TRANSLATE_SMALL,n=Ji.TRANSLATE_BIG;return Tt(this,"_resizerKeyboardManager",new zo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],ct.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:c}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,a],this.pageTranslation=[o,c];const[h,d]=this.parentDimensions;this.x=t.x/h,this.y=t.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Tt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new f1({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(ct._l10n??=t,ct._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),ct._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);ct._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Vt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#R}set _isDraggable(t){this.#R=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#B(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,a){const[o,c]=this.parentDimensions;[n,a]=this.screenToPageTranslation(n,a),this.x=(t+n)/o,this.y=(e+a)/c,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,a]=this.parentDimensions;this.setAt(t*n,e*a,this.width*n,this.height*a),this._onTranslated()}#w([t,e],n,a){[n,a]=this.screenToPageTranslation(n,a),this.x+=n/t,this.y+=a/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#w(this.parentDimensions,t,e)}translateInPage(t,e){this.#p||=[this.x,this.y,this.width,this.height],this.#w(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#p||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[a,o]}=this;if(this.x+=t/a,this.y+=e/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:_,y}=this.div.getBoundingClientRect();this.parent.findNewParent(this,_,y)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:c,y:h}=this;const[d,f]=this.getBaseTranslation();c+=d,h+=f;const{style:g}=n;g.left=`${(100*c).toFixed(2)}%`,g.top=`${(100*h).toFixed(2)}%`,this._onTranslating(c,h),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#p&&(this.#p[0]!==this.x||this.#p[1]!==this.y)}get _hasBeenResized(){return!!this.#p&&(this.#p[2]!==this.width||this.#p[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=ct,a=n/t,o=n/e;switch(this.rotation){case 90:return[-a,o];case 180:return[a,o];case 270:return[a,-o];default:return[-a,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,a]}=this;let{x:o,y:c,width:h,height:d}=this;if(h*=n,d*=a,o*=n,c*=a,this._mustFixPosition)switch(t){case 0:o=Ue(o,0,n-h),c=Ue(c,0,a-d);break;case 90:o=Ue(o,0,n-d),c=Ue(c,h,a);break;case 180:o=Ue(o,h,n),c=Ue(c,d,a);break;case 270:o=Ue(o,d,n),c=Ue(c,0,a-h);break}this.x=o/=n,this.y=c/=a;const[f,g]=this.getBaseTranslation();o+=f,c+=g,e.left=`${(100*o).toFixed(2)}%`,e.top=`${(100*c).toFixed(2)}%`,this.moveInDOM()}static#O(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return ct.#O(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return ct.#O(t,e,360-this.parentRotation)}#x(t){switch(t){case 90:{const[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(t,e){const[n,a]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*t/n).toFixed(2)}%`,this.#o||(o.height=`${(100*e/a).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:n}=t,a=n.endsWith("%"),o=!this.#o&&e.endsWith("%");if(a&&o)return;const[c,h]=this.parentDimensions;a||(t.width=`${(100*parseFloat(n)/c).toFixed(2)}%`),!this.#o&&!o&&(t.height=`${(100*parseFloat(e)/h).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#D(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const a=document.createElement("div");this.#l.append(a),a.classList.add("resizer",n),a.setAttribute("data-resizer-name",n),a.addEventListener("pointerdown",this.#I.bind(this,n),{signal:e}),a.addEventListener("contextmenu",Cn,{signal:e}),a.tabIndex=-1}this.div.prepend(this.#l)}#I(t,e){e.preventDefault();const{isMac:n}=ke.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#n?.toggle(!1);const a=this._isDraggable;this._isDraggable=!1,this.#c=[e.screenX,e.screenY];const o=new AbortController,c=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#P.bind(this,t),{passive:!0,capture:!0,signal:c}),window.addEventListener("touchmove",fe,{passive:!1,signal:c}),window.addEventListener("contextmenu",Cn,{signal:c}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const h=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const f=()=>{o.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=a,this.parent.div.style.cursor=h,this.div.style.cursor=d,this.#L()};window.addEventListener("pointerup",f,{signal:c}),window.addEventListener("blur",f,{signal:c})}#k(t,e,n,a){this.width=n,this.height=a,this.x=t,this.y=e;const[o,c]=this.parentDimensions;this.setDims(o*n,c*a),this.fixAndSetPosition(),this._onResized()}_onResized(){}#L(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:a}=this.#d;this.#d=null;const o=this.x,c=this.y,h=this.width,d=this.height;o===t&&c===e&&h===n&&d===a||this.addCommands({cmd:this.#k.bind(this,o,c,h,d),undo:this.#k.bind(this,t,e,n,a),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#P(t,e){const[n,a]=this.parentDimensions,o=this.x,c=this.y,h=this.width,d=this.height,f=ct.MIN_SIZE/n,g=ct.MIN_SIZE/a,_=this.#x(this.rotation),y=(I,M)=>[_[0]*I+_[2]*M,_[1]*I+_[3]*M],b=this.#x(360-this.rotation),A=(I,M)=>[b[0]*I+b[2]*M,b[1]*I+b[3]*M];let S,C,w=!1,D=!1;switch(t){case"topLeft":w=!0,S=(I,M)=>[0,0],C=(I,M)=>[I,M];break;case"topMiddle":S=(I,M)=>[I/2,0],C=(I,M)=>[I/2,M];break;case"topRight":w=!0,S=(I,M)=>[I,0],C=(I,M)=>[0,M];break;case"middleRight":D=!0,S=(I,M)=>[I,M/2],C=(I,M)=>[0,M/2];break;case"bottomRight":w=!0,S=(I,M)=>[I,M],C=(I,M)=>[0,0];break;case"bottomMiddle":S=(I,M)=>[I/2,M],C=(I,M)=>[I/2,0];break;case"bottomLeft":w=!0,S=(I,M)=>[0,M],C=(I,M)=>[I,0];break;case"middleLeft":D=!0,S=(I,M)=>[0,M/2],C=(I,M)=>[I,M/2];break}const x=S(h,d),k=C(h,d);let O=y(...k);const P=ct._round(o+O[0]),j=ct._round(c+O[1]);let Y=1,K=1,it,J;if(e.fromKeyboard)({deltaX:it,deltaY:J}=e);else{const{screenX:I,screenY:M}=e,[V,Z]=this.#c;[it,J]=this.screenToPageTranslation(I-V,M-Z),this.#c[0]=I,this.#c[1]=M}if([it,J]=A(it/n,J/a),w){const I=Math.hypot(h,d);Y=K=Math.max(Math.min(Math.hypot(k[0]-x[0]-it,k[1]-x[1]-J)/I,1/h,1/d),f/h,g/d)}else D?Y=Ue(Math.abs(k[0]-x[0]-it),f,1)/h:K=Ue(Math.abs(k[1]-x[1]-J),g,1)/d;const ft=ct._round(h*Y),tt=ct._round(d*K);O=y(...C(ft,tt));const vt=P-O[0],bt=j-O[1];this.#p||=[this.x,this.y,this.width,this.height],this.width=ft,this.height=tt,this.x=vt,this.y=bt,this.setDims(n*ft,a*tt),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#m)return this._editToolbar;this._editToolbar=new go(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#n?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(Yn.initialize(ct._l10n),this.#n=new Yn(this),this.#t&&(this.#n.data=this.#t,this.#t=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(t){this.#n&&(this.#n.data=t)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(t){await this.#n?.setGuessedText(t)}serializeAltText(t){return this.#n?.serialize(t)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}addCommentButton(){return this.#i?this.#i:this.#i=new uc(this)}get commentColor(){return null}get comment(){const t=this.#i;return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){this.#i||(this.#i=new uc(this)),this.#i.data=t}setCommentData(t){this.#i||(this.#i=new uc(this)),this.#i.setInitialText(t)}get hasEditedComment(){return this.#i?.hasBeenEdited()}async editComment(){this.#i||(this.#i=new uc(this)),this.#i.edit()}addComment(t){if(this.hasEditedComment){const[,,,a]=t.rect,[o]=this.pageDimensions,[c]=this.pageTranslation,h=c+o+1,d=a-100,f=h+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[h,d,f,a]}}}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#a?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#U();const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[a,o]=this.getInitialTranslation();return this.translate(a,o),pv(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#E||=new Jc({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#N.bind(this),onPinching:this.#H.bind(this),onPinchEnd:this.#C.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),t}#N(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#H(t,e,n){let o=.7*(n/e)+1-.7;if(o===1)return;const c=this.#x(this.rotation),h=(P,j)=>[c[0]*P+c[2]*j,c[1]*P+c[3]*j],[d,f]=this.parentDimensions,g=this.x,_=this.y,y=this.width,b=this.height,A=ct.MIN_SIZE/d,S=ct.MIN_SIZE/f;o=Math.max(Math.min(o,1/y,1/b),A/y,S/b);const C=ct._round(y*o),w=ct._round(b*o);if(C===y&&w===b)return;this.#p||=[g,_,y,b];const D=h(y/2,b/2),x=ct._round(g+D[0]),k=ct._round(_+D[1]),O=h(C/2,w/2);this.x=x-O[0],this.y=k-O[1],this.width=C,this.height=w,this.setDims(d*C,f*w),this.fixAndSetPosition(),this._onResizing()}#C(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#L()}pointerdown(t){const{isMac:e}=ke.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#z(t);return}this.#v(t)}#v(t){const{isMac:e}=ke.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#z(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const a=new AbortController,o=this._uiManager.combinedSignal(a),c={capture:!0,passive:!1,signal:o},h=f=>{a.abort(),this.#s=null,this.#g=!1,this._uiManager.endDragSession()||this.#v(f),n&&this._onStopDragging()};e&&(this.#A=t.clientX,this.#S=t.clientY,this.#s=t.pointerId,this.#r=t.pointerType,window.addEventListener("pointermove",f=>{n||(n=!0,this._onStartDragging());const{clientX:g,clientY:_,pointerId:y}=f;if(y!==this.#s){fe(f);return}const[b,A]=this.screenToPageTranslation(g-this.#A,_-this.#S);this.#A=g,this.#S=_,this._uiManager.dragSelectedEditors(b,A)},c),window.addEventListener("touchmove",fe,c),window.addEventListener("pointerdown",f=>{f.pointerType===this.#r&&(this.#E||f.isPrimary)&&h(f),fe(f)},c));const d=f=>{if(!this.#s||this.#s===f.pointerId){h(f);return}fe(f)};window.addEventListener("pointerup",d,{signal:o}),window.addEventListener("blur",d,{signal:o})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.#_=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const a=this.parentScale,[o,c]=this.pageDimensions,[h,d]=this.pageTranslation,f=t/a,g=e/a,_=this.x*o,y=this.y*c,b=this.width*o,A=this.height*c;switch(n){case 0:return[_+f+h,c-y-g-A+d,_+f+b+h,c-y-g+d];case 90:return[_+g+h,c-y+f+d,_+g+A+h,c-y+f+b+d];case 180:return[_-f-b+h,c-y+g+d,_-f+h,c-y+g+A+d];case 270:return[_-g-A+h,c-y-f-b+d,_-g+h,c-y-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,a,o,c]=t,h=o-n,d=c-a;switch(this.rotation){case 0:return[n,e-c,h,d];case 90:return[n,e-a,d,h];case 180:return[o,e-a,h,d];case 270:return[o,e-c,d,h];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#m=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#m=!1,!0):!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#b}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:a}=this.getClientDimensions(),{innerHeight:o,innerWidth:c}=window;return e<c&&a>0&&t<o&&n>0}#U(){if(this.#u||!this.div)return;this.#u=new AbortController;const t=this._uiManager.combinedSignal(this.#u);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#U()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){Vt("An editor must be serializable")}static async deserialize(t,e,n){const a=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId});a.rotation=t.rotation,a.#t=t.accessibilityData,a._isCopy=t.isCopy||!1;const[o,c]=a.pageDimensions,[h,d,f,g]=a.getRectInCurrentCoords(t.rect,c);return a.x=h/o,a.y=d/c,a.width=f/o,a.height=g/c,a}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#u?.abort(),this.#u=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#_&&(clearTimeout(this.#_),this.#_=null),this.#B(),this.removeEditToolbar(),this.#y){for(const t of this.#y.values())clearTimeout(t);this.#y=null}this.parent=null,this.#E?.destroy(),this.#E=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#D(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#l.children;if(!this.#e){this.#e=Array.from(e);const c=this.#G.bind(this),h=this.#$.bind(this),d=this._uiManager._signal;for(const f of this.#e){const g=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",c,{signal:d}),f.addEventListener("blur",h,{signal:d}),f.addEventListener("focus",this.#Y.bind(this,g),{signal:d}),f.setAttribute("data-l10n-id",ct._l10nResizer[g])}}const n=this.#e[0];let a=0;for(const c of e){if(c===n)break;a++}const o=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(o!==a){if(o<a)for(let h=0;h<a-o;h++)this.#l.append(this.#l.firstChild);else if(o>a)for(let h=0;h<o-a;h++)this.#l.firstChild.before(this.#l.lastChild);let c=0;for(const h of e){const f=this.#e[c++].getAttribute("data-resizer-name");h.setAttribute("data-l10n-id",ct._l10nResizer[f])}}this.#X(0),this.#b=!0,this.#l.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#G(t){ct._resizerKeyboardManager.exec(this,t)}#$(t){this.#b&&t.relatedTarget?.parentNode!==this.#l&&this.#B()}#Y(t){this.#f=this.#b?t:""}#X(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#b&&this.#P(this.#f,{deltaX:t,deltaY:e,fromKeyboard:!0})}#B(){this.#b=!1,this.#X(-1),this.#L()}_stopResizingWithKeyboard(){this.#B(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#h}set isEditing(t){this.#h=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#o=!0;const n=t/e,{style:a}=this.div;a.aspectRatio=n,a.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#y||=new Map;const{action:n}=t;let a=this.#y.get(n);a&&clearTimeout(a),a=setTimeout(()=>{this._reportTelemetry(t),this.#y.delete(n),this.#y.size===0&&(this.#y=null)},ct._telemetryTimeout),this.#y.set(n,a);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#a=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#a=!0}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class f1 extends ct{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Vy=3285377520,An=4294901760,Gn=65535;class gv{constructor(t){this.h1=t?t&4294967295:Vy,this.h2=t?t&4294967295:Vy}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let S=0,C=t.length;S<C;S++){const w=t.charCodeAt(S);w<=255?e[n++]=w:(e[n++]=w>>>8,e[n++]=w&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const a=n>>2,o=n-a*4,c=new Uint32Array(e.buffer,0,a);let h=0,d=0,f=this.h1,g=this.h2;const _=3432918353,y=461845907,b=_&Gn,A=y&Gn;for(let S=0;S<a;S++)S&1?(h=c[S],h=h*_&An|h*b&Gn,h=h<<15|h>>>17,h=h*y&An|h*A&Gn,f^=h,f=f<<13|f>>>19,f=f*5+3864292196):(d=c[S],d=d*_&An|d*b&Gn,d=d<<15|d>>>17,d=d*y&An|d*A&Gn,g^=d,g=g<<13|g>>>19,g=g*5+3864292196);switch(h=0,o){case 3:h^=e[a*4+2]<<16;case 2:h^=e[a*4+1]<<8;case 1:h^=e[a*4],h=h*_&An|h*b&Gn,h=h<<15|h>>>17,h=h*y&An|h*A&Gn,a&1?f^=h:g^=h}this.h1=f,this.h2=g}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&An|t*36045&Gn,e=e*4283543511&An|((e<<16|t>>>16)*2950163797&An)>>>16,t^=e>>>1,t=t*444984403&An|t*60499&Gn,e=e*3301882366&An|((e<<16|t>>>16)*3120437893&An)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const sf=Object.freeze({map:null,hash:"",transfer:void 0});class jf{#t=!1;#e=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#n.get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return this.#n.get(t)}remove(t){if(this.#n.delete(t),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of this.#n.values())if(e instanceof ct)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#n.get(t);let a=!1;if(n!==void 0)for(const[o,c]of Object.entries(e))n[o]!==c&&(a=!0,n[o]=c);else a=!0,this.#n.set(t,e);a&&this.#i(),e instanceof ct&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#n.has(t)}get size(){return this.#n.size}#i(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new mv(this)}get serializable(){if(this.#n.size===0)return sf;const t=new Map,e=new gv,n=[],a=Object.create(null);let o=!1;for(const[c,h]of this.#n){const d=h instanceof ct?h.serialize(!1,a):h;d&&(t.set(c,d),e.update(`${c}:${JSON.stringify(d)}`),o||=!!d.bitmap)}if(o)for(const c of t.values())c.bitmap&&n.push(c.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:sf}get editorStats(){let t=null;const e=new Map;for(const n of this.#n.values()){if(!(n instanceof ct))continue;const a=n.telemetryFinalData;if(!a)continue;const{type:o}=a;e.has(o)||e.set(o,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const c=t[o]||=new Map;for(const[h,d]of Object.entries(a)){if(h==="type")continue;let f=c.get(h);f||(f=new Map,c.set(h,f));const g=f.get(d)??0;f.set(d,g+1)}}for(const[n,a]of e)t[n]=a.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;const t=[];for(const e of this.#n.values())!(e instanceof ct)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class mv extends jf{#t;constructor(t){super();const{map:e,hash:n,transfer:a}=t.serializable,o=structuredClone(e,a?{transfer:a}:null);this.#t={map:o,hash:n,transfer:a}}get print(){Vt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return Tt(this,"modifiedIds",{ids:new Set,hash:""})}}class p1{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(!(!t||this.#t.has(t.loadedName))){if(ge(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:a,src:o,style:c}=t,h=new FontFace(a,o,c);this.addNativeFontFace(h);try{await h.load(),this.#t.add(a),n?.(t)}catch{yt(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(h)}return}Vt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(a){throw yt(`Failed to load font '${n.family}': '${a}'.`),t.disableFontFace=!0,a}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const a=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,a)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return Tt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Tt(this,"isSyncFontLoadingSupported",ze||ke.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(ge(!a.done,"completeRequest() cannot be called twice."),a.done=!0;n.length>0&&n[0].done;){const o=n.shift();setTimeout(o.callback,0)}}const{loadingRequests:n}=this,a={done:!1,complete:e,callback:t};return n.push(a),a}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Tt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(k,O){return k.charCodeAt(O)<<24|k.charCodeAt(O+1)<<16|k.charCodeAt(O+2)<<8|k.charCodeAt(O+3)&255}function a(k,O,P,j){const Y=k.substring(0,O),K=k.substring(O+P);return Y+j+K}let o,c;const h=this._document.createElement("canvas");h.width=1,h.height=1;const d=h.getContext("2d");let f=0;function g(k,O){if(++f>30){yt("Load test font never loaded."),O();return}if(d.font="30px "+k,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){O();return}setTimeout(g.bind(null,k,O))}const _=`lt${Date.now()}${this.loadTestFontId++}`;let y=this._loadTestFont;y=a(y,976,_.length,_);const A=16,S=1482184792;let C=n(y,A);for(o=0,c=_.length-3;o<c;o+=4)C=C-S+n(_,o)|0;o<_.length&&(C=C-S+n(_+"XXX",o)|0),y=a(y,A,4,ZE(C));const w=`url(data:font/opentype;base64,${btoa(y)});`,D=`@font-face {font-family:"${_}";src:${w}}`;this.insertRule(D);const x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(const k of[t.loadedName,_]){const O=this._document.createElement("span");O.textContent="Hi",O.style.fontFamily=k,x.append(O)}this._document.body.append(x),g(_,()=>{x.remove(),e.complete()})}}class g1{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const n in t)this[n]=t[n];this._inspectFont=e}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${fv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let a;try{a=t.get(n)}catch(c){yt(`getPathGenerator - ignoring character: "${c}".`)}const o=new Path2D(a||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=o}}function m1(r){if(r instanceof URL)return r.href;if(typeof r=="string"){if(ze)return r;const t=URL.parse(r,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function _1(r){if(ze&&typeof Buffer<"u"&&r instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength)return r;if(typeof r=="string")return Bo(r);if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)||typeof r=="object"&&!isNaN(r?.length))return new Uint8Array(r);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function hc(r){if(typeof r!="string")return null;if(r.endsWith("/"))return r;throw new Error(`Invalid factory url: "${r}" must include trailing slash.`)}const af=r=>typeof r=="object"&&Number.isInteger(r?.num)&&r.num>=0&&Number.isInteger(r?.gen)&&r.gen>=0,y1=r=>typeof r=="object"&&typeof r?.name=="string",b1=i1.bind(null,af,y1);class v1{#t=new Map;#e=Promise.resolve();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[a]of this.#t)a.call(this,n)})}addEventListener(t,e,n=null){let a=null;if(n?.signal instanceof AbortSignal){const{signal:o}=n;if(o.aborted){yt("LoopbackPort - cannot use an `aborted` signal.");return}const c=()=>this.removeEventListener(t,e);a=()=>o.removeEventListener("abort",c),o.addEventListener("abort",c)}this.#t.set(e,a)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const dc={DATA:1,ERROR:2},he={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function qy(){}function We(r){if(r instanceof Zi||r instanceof tf||r instanceof Uy||r instanceof Cc||r instanceof kd)return r;switch(r instanceof Error||typeof r=="object"&&r!==null||Vt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),r.name){case"AbortException":return new Zi(r.message);case"InvalidPDFException":return new tf(r.message);case"PasswordException":return new Uy(r.message,r.code);case"ResponseException":return new Cc(r.message,r.status,r.missing);case"UnknownErrorException":return new kd(r.message,r.details)}return new kd(r.message,r.toString())}class fo{#t=new AbortController;constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#i(t);return}if(t.callback){const n=t.callbackId,a=this.callbackCapabilities[n];if(!a)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===dc.DATA)a.resolve(t.data);else if(t.callback===dc.ERROR)a.reject(We(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,a=t.sourceName,o=this.comObj;Promise.try(e,t.data).then(function(c){o.postMessage({sourceName:n,targetName:a,callback:dc.DATA,callbackId:t.callbackId,data:c})},function(c){o.postMessage({sourceName:n,targetName:a,callback:dc.ERROR,callbackId:t.callbackId,reason:We(c)})});return}if(t.streamId){this.#n(t);return}e(t.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const a=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[a]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:a,data:e},n)}catch(c){o.reject(c)}return o.promise}sendWithStream(t,e,n,a){const o=this.streamId++,c=this.sourceName,h=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const g=Promise.withResolvers();return this.streamControllers[o]={controller:f,startCall:g,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:c,targetName:h,action:t,streamId:o,data:e,desiredSize:f.desiredSize},a),g.promise},pull:f=>{const g=Promise.withResolvers();return this.streamControllers[o].pullCall=g,d.postMessage({sourceName:c,targetName:h,stream:he.PULL,streamId:o,desiredSize:f.desiredSize}),g.promise},cancel:f=>{ge(f instanceof Error,"cancel must have a valid reason");const g=Promise.withResolvers();return this.streamControllers[o].cancelCall=g,this.streamControllers[o].isClosed=!0,d.postMessage({sourceName:c,targetName:h,stream:he.CANCEL,streamId:o,reason:We(f)}),g.promise}},n)}#n(t){const e=t.streamId,n=this.sourceName,a=t.sourceName,o=this.comObj,c=this,h=this.actionHandler[t.action],d={enqueue(f,g=1,_){if(this.isCancelled)return;const y=this.desiredSize;this.desiredSize-=g,y>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:a,stream:he.ENQUEUE,streamId:e,chunk:f},_)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:a,stream:he.CLOSE,streamId:e}),delete c.streamSinks[e])},error(f){ge(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:a,stream:he.ERROR,streamId:e,reason:We(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[e]=d,Promise.try(h,t.data,d).then(function(){o.postMessage({sourceName:n,targetName:a,stream:he.START_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:a,stream:he.START_COMPLETE,streamId:e,reason:We(f)})})}#i(t){const e=t.streamId,n=this.sourceName,a=t.sourceName,o=this.comObj,c=this.streamControllers[e],h=this.streamSinks[e];switch(t.stream){case he.START_COMPLETE:t.success?c.startCall.resolve():c.startCall.reject(We(t.reason));break;case he.PULL_COMPLETE:t.success?c.pullCall.resolve():c.pullCall.reject(We(t.reason));break;case he.PULL:if(!h){o.postMessage({sourceName:n,targetName:a,stream:he.PULL_COMPLETE,streamId:e,success:!0});break}h.desiredSize<=0&&t.desiredSize>0&&h.sinkCapability.resolve(),h.desiredSize=t.desiredSize,Promise.try(h.onPull||qy).then(function(){o.postMessage({sourceName:n,targetName:a,stream:he.PULL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:a,stream:he.PULL_COMPLETE,streamId:e,reason:We(f)})});break;case he.ENQUEUE:if(ge(c,"enqueue should have stream controller"),c.isClosed)break;c.controller.enqueue(t.chunk);break;case he.CLOSE:if(ge(c,"close should have stream controller"),c.isClosed)break;c.isClosed=!0,c.controller.close(),this.#a(c,e);break;case he.ERROR:ge(c,"error should have stream controller"),c.controller.error(We(t.reason)),this.#a(c,e);break;case he.CANCEL_COMPLETE:t.success?c.cancelCall.resolve():c.cancelCall.reject(We(t.reason)),this.#a(c,e);break;case he.CANCEL:if(!h)break;const d=We(t.reason);Promise.try(h.onCancel||qy,d).then(function(){o.postMessage({sourceName:n,targetName:a,stream:he.CANCEL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:a,stream:he.CANCEL_COMPLETE,streamId:e,reason:We(f)})}),h.sinkCapability.reject(d),h.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class _v{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Vt("Abstract method `_createCanvas` called.")}}class A1 extends _v{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class yv{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Vt("Abstract method `_fetch` called.")}}class Yy extends yv{async _fetch(t){const e=await Fo(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Bo(e)}}class bv{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,a,o){return"none"}destroy(t=!1){}}class S1 extends bv{#t;#e;#n;#i;#a;#s;#r=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#i=t,this.#a=e}get#o(){return this.#e||=new Map}get#l(){return this.#s||=new Map}get#c(){if(!this.#n){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#a.createElementNS(ui,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#n=this.#a.createElementNS(ui,"defs"),t.append(n),n.append(this.#n),this.#a.body.append(t)}return this.#n}#d(t){if(t.length===1){const d=t[0],f=new Array(256);for(let _=0;_<256;_++)f[_]=d[_]/255;const g=f.join(",");return[g,g,g]}const[e,n,a]=t,o=new Array(256),c=new Array(256),h=new Array(256);for(let d=0;d<256;d++)o[d]=e[d]/255,c[d]=n[d]/255,h[d]=a[d]/255;return[o.join(","),c.join(","),h.join(",")]}#u(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(Qc(e)?yt('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=uv(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[n,a,o]=this.#d(t),c=t.length===1?n:`${n}${a}${o}`;if(e=this.#o.get(c),e)return this.#o.set(t,e),e;const h=`g_${this.#i}_transfer_map_${this.#r++}`,d=this.#u(h);this.#o.set(t,d),this.#o.set(c,d);const f=this.#p(h);return this.#m(n,a,o,f),d}addHCMFilter(t,e){const n=`${t}-${e}`,a="base";let o=this.#l.get(a);if(o?.key===n||(o?(o.filter?.remove(),o.key=n,o.url="none",o.filter=null):(o={key:n,url:"none",filter:null},this.#l.set(a,o)),!t||!e))return o.url;const c=this.#_(t);t=at.makeHexColor(...c);const h=this.#_(e);if(e=at.makeHexColor(...h),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return o.url;const d=new Array(256);for(let b=0;b<=255;b++){const A=b/255;d[b]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const f=d.join(","),g=`g_${this.#i}_hcm_filter`,_=o.filter=this.#p(g);this.#m(f,f,f,_),this.#g(_);const y=(b,A)=>{const S=c[b]/255,C=h[b]/255,w=new Array(A+1);for(let D=0;D<=A;D++)w[D]=S+D/A*(C-S);return w.join(",")};return this.#m(y(0,5),y(1,5),y(2,5),_),o.url=this.#u(g),o.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[n]=this.#d([t]),a=`alpha_${n}`;if(e=this.#o.get(a),e)return this.#o.set(t,e),e;const o=`g_${this.#i}_alpha_map_${this.#r++}`,c=this.#u(o);this.#o.set(t,c),this.#o.set(a,c);const h=this.#p(o);return this.#b(n,h),c}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let n,a;if(t?([n]=this.#d([t]),a=`luminosity_${n}`):a="luminosity",e=this.#o.get(a),e)return this.#o.set(t,e),e;const o=`g_${this.#i}_luminosity_map_${this.#r++}`,c=this.#u(o);this.#o.set(t,c),this.#o.set(a,c);const h=this.#p(o);return this.#f(h),t&&this.#b(n,h),c}addHighlightHCMFilter(t,e,n,a,o){const c=`${e}-${n}-${a}-${o}`;let h=this.#l.get(t);if(h?.key===c||(h?(h.filter?.remove(),h.key=c,h.url="none",h.filter=null):(h={key:c,url:"none",filter:null},this.#l.set(t,h)),!e||!n))return h.url;const[d,f]=[e,n].map(this.#_.bind(this));let g=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),_=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[y,b]=[a,o].map(this.#_.bind(this));_<g&&([g,_,y,b]=[_,g,b,y]),this.#c.style.color="";const A=(w,D,x)=>{const k=new Array(256),O=(_-g)/x,P=w/255,j=(D-w)/(255*x);let Y=0;for(let K=0;K<=x;K++){const it=Math.round(g+K*O),J=P+K*j;for(let ft=Y;ft<=it;ft++)k[ft]=J;Y=it+1}for(let K=Y;K<256;K++)k[K]=k[Y-1];return k.join(",")},S=`g_${this.#i}_hcm_${t}_filter`,C=h.filter=this.#p(S);return this.#g(C),this.#m(A(y[0],b[0],5),A(y[1],b[1],5),A(y[2],b[2],5),C),h.url=this.#u(S),h.url}destroy(t=!1){t&&this.#s?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#e?.clear(),this.#e=null,this.#s?.clear(),this.#s=null,this.#r=0)}#f(t){const e=this.#a.createElementNS(ui,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#a.createElementNS(ui,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){const e=this.#a.createElementNS(ui,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#h(t,e,n){const a=this.#a.createElementNS(ui,e);a.setAttribute("type","discrete"),a.setAttribute("tableValues",n),t.append(a)}#m(t,e,n,a){const o=this.#a.createElementNS(ui,"feComponentTransfer");a.append(o),this.#h(o,"feFuncR",t),this.#h(o,"feFuncG",e),this.#h(o,"feFuncB",n)}#b(t,e){const n=this.#a.createElementNS(ui,"feComponentTransfer");e.append(n),this.#h(n,"feFuncA",t)}#_(t){return this.#c.style.color=t,Zc(getComputedStyle(this.#c).getPropertyValue("color"))}}class vv{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Vt("Abstract method `_fetch` called.")}}class Xy extends vv{async _fetch(t){const e=await Fo(t,"arraybuffer");return new Uint8Array(e)}}class Av{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Vt("Abstract method `_fetch` called.")}}class $y extends Av{async _fetch(t){const e=await Fo(t,"arraybuffer");return new Uint8Array(e)}}ze&&yt("Please use the `legacy` build in Node.js environments.");async function Gf(r){const e=await process.getBuiltinModule("fs").promises.readFile(r);return new Uint8Array(e)}class E1 extends bv{}class w1 extends _v{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class C1 extends yv{async _fetch(t){return Gf(t)}}class T1 extends vv{async _fetch(t){return Gf(t)}}class x1 extends Av{async _fetch(t){return Gf(t)}}const Ra="__forcedDependency";class R1{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Ra]:[]};#n=new Map;#i=[];#a=[];#s=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#c=new Set;#d=new Map;#u=new Map;#f;#g;constructor(t){this.#f=t.width,this.#g=t.height}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Ra]:{__proto__:this.#e[Ra]}},this.#r={__proto__:this.#r},this.#i.push([t,null]),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#r=Object.getPrototypeOf(this.#r);const n=this.#i.pop();return n!==void 0&&(n[1]=t),this}recordOpenMarker(t){return this.#i.push([t,null]),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)[0]}recordCloseMarker(t){const e=this.#i.pop();return e!==void 0&&(e[1]=t),this}beginMarkedContent(t){return this.#a.push([t,null]),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(e[1]=t),this}pushBaseTransform(t){return this.#s.push(at.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform())),this}popBaseTransform(){return this.#s.length>1&&this.#s.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#n.set(t,e),this}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Ra,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#c)this.recordFutureForcedDependency(Ra,t);return this}resetBBox(t){return this.#l=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0,this}get hasPendingBBox(){return this.#l!==-1}recordClipBox(t,e,n,a,o,c){const h=at.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform()),d=[1/0,1/0,-1/0,-1/0];at.axialAlignedBoundingBox([n,o,a,c],h,d);const f=at.intersect(this.#r,d);return f?(this.#r[0]=f[0],this.#r[1]=f[1],this.#r[2]=f[2],this.#r[3]=f[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(t,e,n,a,o,c){const h=this.#r;if(h[0]===1/0)return this;const d=at.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform());if(h[0]===-1/0)return at.axialAlignedBoundingBox([n,o,a,c],d,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return at.axialAlignedBoundingBox([n,o,a,c],d,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],h[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],h[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],h[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],h[3])),this}recordCharacterBBox(t,e,n,a=1,o=0,c=0,h){const d=n.bbox;let f,g;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&this.#u.get(n),f!==!1&&(g=[0,0,0,0],at.axialAlignedBoundingBox(d,n.fontMatrix,g),(a!==1||o!==0||c!==0)&&at.scaleMinMax([a,0,0,-a,o,c],g),f)))return this.recordBBox(t,e,g[0],g[2],g[1],g[3]);if(!h)return this.recordFullPageBBox(t);const _=h();return d&&g&&f===void 0&&(f=g[0]<=o-_.actualBoundingBoxLeft&&g[2]>=o+_.actualBoundingBoxRight&&g[1]<=c-_.actualBoundingBoxAscent&&g[3]>=c+_.actualBoundingBoxDescent,this.#u.set(n,f),f)?this.recordBBox(t,e,g[0],g[2],g[1],g[3]):this.recordBBox(t,e,o-_.actualBoundingBoxLeft,o+_.actualBoundingBoxRight,c-_.actualBoundingBoxAscent,c+_.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#f,this.#r[2]),this.#o[3]=Math.min(this.#g,this.#r[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const n=this.#c,a=this.#t,o=this.#e;for(const c of e)c in this.#t?n.add(a[c]):c in o&&o[c].forEach(n.add,n);return this}copyDependenciesFromIncrementalOperation(t,e){const n=this.#d,a=this.#c;for(const o of this.#e[e])n.get(o).dependencies.forEach(a.add,a.add(o));return this}recordNamedDependency(t,e){return this.#n.has(e)&&this.#c.add(this.#n.get(e)),this}recordOperation(t,e=!1){this.recordDependencies(t,[Ra]);const n=new Set(this.#c),a=this.#i.concat(this.#a),o=this.#l===t?{minX:this.#o[0],minY:this.#o[1],maxX:this.#o[2],maxY:this.#o[3]}:null;return this.#d.set(t,{bbox:o,pairs:a,dependencies:n}),e||(this.#l=-1),this.#c.clear(),this}bboxToClipBoxDropOperation(t){return this.#l!==-1&&(this.#l=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3])),this.#c.clear(),this}_takePendingDependencies(){const t=this.#c;return this.#c=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#c.add(e)}take(){return this.#u.clear(),Array.from(this.#d,([t,{bbox:e,pairs:n,dependencies:a}])=>(n.forEach(o=>o.forEach(a.add,a)),a.delete(t),{minX:(e?.minX??0)/this.#f,maxX:(e?.maxX??this.#f)/this.#f,minY:(e?.minY??0)/this.#g,maxY:(e?.maxY??this.#g)/this.#g,dependencies:Array.from(a).sort((o,c)=>o-c),idx:t}))}}class Tc{#t;#e;#n=0;#i;#a=0;constructor(t,e){if(t instanceof Tc)return t;this.#t=t,this.#i=t._takePendingDependencies(),this.#e=e}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#n--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#t.hasPendingBBox||this.#t.resetBBox(this.#e),this}get hasPendingBBox(){return this.#t.hasPendingBBox}recordClipBox(t,e,n,a,o,c){return this.#t.recordClipBox(this.#e,e,n,a,o,c),this}recordBBox(t,e,n,a,o,c){return this.#t.recordBBox(this.#e,e,n,a,o,c),this}recordCharacterBBox(t,e,n,a,o,c,h){return this.#t.recordCharacterBBox(this.#e,e,n,a,o,c,h),this}recordFullPageBBox(t){return this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}copyDependenciesFromIncrementalOperation(t,e){return this.#t.copyDependenciesFromIncrementalOperation(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){this.#t.recordOperation(this.#e,!0);const e=this.#t._extractOperation(this.#e);for(const n of e.dependencies)this.#i.add(n);return this.#i.delete(this.#e),this.#i.delete(null),this}bboxToClipBoxDropOperation(t){return this.#t.bboxToClipBoxDropOperation(this.#e),this}recordNestedDependencies(){this.#t._pushPendingDependencies(this.#i)}take(){throw new Error("Unreachable")}}const Sn={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation"],transform:["transform"],transformAndFill:["transform","fillColor"]},Ne={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function rf(r,t){if(!t)return;const e=t[2]-t[0],n=t[3]-t[1],a=new Path2D;a.rect(t[0],t[1],e,n),r.clip(a)}class Vf{isModifyingCurrentTransform(){return!1}getPattern(){Vt("Abstract method `getPattern` called.")}}class D1 extends Vf{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,a){let o;if(a===Ne.STROKE||a===Ne.FILL){const c=e.current.getClippedPathBoundingBox(a,te(t))||[0,0,0,0],h=Math.ceil(c[2]-c[0])||1,d=Math.ceil(c[3]-c[1])||1,f=e.cachedCanvases.getCanvas("pattern",h,d),g=f.context;g.clearRect(0,0,g.canvas.width,g.canvas.height),g.beginPath(),g.rect(0,0,g.canvas.width,g.canvas.height),g.translate(-c[0],-c[1]),n=at.transform(n,[1,0,0,1,c[0],c[1]]),g.transform(...e.baseTransform),this.matrix&&g.transform(...this.matrix),rf(g,this._bbox),g.fillStyle=this._createGradient(g),g.fill(),o=t.createPattern(f.canvas,"no-repeat");const _=new DOMMatrix(n);o.setTransform(_)}else rf(t,this._bbox),o=this._createGradient(t);return o}}function Pd(r,t,e,n,a,o,c,h){const d=t.coords,f=t.colors,g=r.data,_=r.width*4;let y;d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=o,o=c,c=y),d[n+1]>d[a+1]&&(y=n,n=a,a=y,y=c,c=h,h=y),d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=o,o=c,c=y);const b=(d[e]+t.offsetX)*t.scaleX,A=(d[e+1]+t.offsetY)*t.scaleY,S=(d[n]+t.offsetX)*t.scaleX,C=(d[n+1]+t.offsetY)*t.scaleY,w=(d[a]+t.offsetX)*t.scaleX,D=(d[a+1]+t.offsetY)*t.scaleY;if(A>=D)return;const x=f[o],k=f[o+1],O=f[o+2],P=f[c],j=f[c+1],Y=f[c+2],K=f[h],it=f[h+1],J=f[h+2],ft=Math.round(A),tt=Math.round(D);let vt,bt,I,M,V,Z,T,H;for(let X=ft;X<=tt;X++){if(X<C){const Nt=X<A?0:(A-X)/(A-C);vt=b-(b-S)*Nt,bt=x-(x-P)*Nt,I=k-(k-j)*Nt,M=O-(O-Y)*Nt}else{let Nt;X>D?Nt=1:C===D?Nt=0:Nt=(C-X)/(C-D),vt=S-(S-w)*Nt,bt=P-(P-K)*Nt,I=j-(j-it)*Nt,M=Y-(Y-J)*Nt}let W;X<A?W=0:X>D?W=1:W=(A-X)/(A-D),V=b-(b-w)*W,Z=x-(x-K)*W,T=k-(k-it)*W,H=O-(O-J)*W;const rt=Math.round(Math.min(vt,V)),_t=Math.round(Math.max(vt,V));let lt=_*X+rt*4;for(let Nt=rt;Nt<=_t;Nt++)W=(vt-Nt)/(vt-V),W<0?W=0:W>1&&(W=1),g[lt++]=bt-(bt-Z)*W|0,g[lt++]=I-(I-T)*W|0,g[lt++]=M-(M-H)*W|0,g[lt++]=255}}function M1(r,t,e){const n=t.coords,a=t.colors;let o,c;switch(t.type){case"lattice":const h=t.verticesPerRow,d=Math.floor(n.length/h)-1,f=h-1;for(o=0;o<d;o++){let g=o*h;for(let _=0;_<f;_++,g++)Pd(r,e,n[g],n[g+1],n[g+h],a[g],a[g+1],a[g+h]),Pd(r,e,n[g+h+1],n[g+1],n[g+h],a[g+h+1],a[g+1],a[g+h])}break;case"triangles":for(o=0,c=n.length;o<c;o+=3)Pd(r,e,n[o],n[o+1],n[o+2],a[o],a[o+1],a[o+2]);break;default:throw new Error("illegal figure")}}class N1 extends Vf{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const h=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-h,g=Math.ceil(this._bounds[3])-d,_=Math.min(Math.ceil(Math.abs(f*t[0]*1.1)),3e3),y=Math.min(Math.ceil(Math.abs(g*t[1]*1.1)),3e3),b=f/_,A=g/y,S={coords:this._coords,colors:this._colors,offsetX:-h,offsetY:-d,scaleX:1/b,scaleY:1/A},C=_+4,w=y+4,D=n.getCanvas("mesh",C,w),x=D.context,k=x.createImageData(_,y);if(e){const P=k.data;for(let j=0,Y=P.length;j<Y;j+=4)P[j]=e[0],P[j+1]=e[1],P[j+2]=e[2],P[j+3]=255}for(const P of this._figures)M1(k,P,S);return x.putImageData(k,2,2),{canvas:D.canvas,offsetX:h-2*b,offsetY:d-2*A,scaleX:b,scaleY:A}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,a){rf(t,this._bbox);const o=new Float32Array(2);if(a===Ne.SHADING)at.singularValueDecompose2dScale(te(t),o);else if(this.matrix){at.singularValueDecompose2dScale(this.matrix,o);const[h,d]=o;at.singularValueDecompose2dScale(e.baseTransform,o),o[0]*=h,o[1]*=d}else at.singularValueDecompose2dScale(e.baseTransform,o);const c=this._createMeshCanvas(o,a===Ne.SHADING?null:this._background,e.cachedCanvases);return a!==Ne.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(c.offsetX,c.offsetY),t.scale(c.scaleX,c.scaleY),t.createPattern(c.canvas,"no-repeat")}}class O1 extends Vf{getPattern(){return"hotpink"}}function k1(r){switch(r[0]){case"RadialAxial":return new D1(r);case"Mesh":return new N1(r);case"Dummy":return new O1}throw new Error(`Unknown IR type: ${r[0]}`)}const Wy={COLORED:1,UNCOLORED:2};class qf{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,a){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=a}createPatternCanvas(t){const{bbox:e,operatorList:n,paintType:a,tilingType:o,color:c,canvasGraphicsFactory:h}=this;let{xstep:d,ystep:f}=this;d=Math.abs(d),f=Math.abs(f),Kc("TilingType: "+o);const g=e[0],_=e[1],y=e[2],b=e[3],A=y-g,S=b-_,C=new Float32Array(2);at.singularValueDecompose2dScale(this.matrix,C);const[w,D]=C;at.singularValueDecompose2dScale(this.baseTransform,C);const x=w*C[0],k=D*C[1];let O=A,P=S,j=!1,Y=!1;const K=Math.ceil(d*x),it=Math.ceil(f*k),J=Math.ceil(A*x),ft=Math.ceil(S*k);K>=J?O=d:j=!0,it>=ft?P=f:Y=!0;const tt=this.getSizeAndScale(O,this.ctx.canvas.width,x),vt=this.getSizeAndScale(P,this.ctx.canvas.height,k),bt=t.cachedCanvases.getCanvas("pattern",tt.size,vt.size),I=bt.context,M=h.createCanvasGraphics(I);if(M.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(M,a,c),I.translate(-tt.scale*g,-vt.scale*_),M.transform(0,tt.scale,0,0,vt.scale,0,0),I.save(),M.dependencyTracker?.save(),this.clipBbox(M,g,_,y,b),M.baseTransform=te(M.ctx),M.executeOperatorList(n),M.endDrawing(),M.dependencyTracker?.restore().recordNestedDependencies?.(),I.restore(),j||Y){const V=bt.canvas;j&&(O=d),Y&&(P=f);const Z=this.getSizeAndScale(O,this.ctx.canvas.width,x),T=this.getSizeAndScale(P,this.ctx.canvas.height,k),H=Z.size,X=T.size,W=t.cachedCanvases.getCanvas("pattern-workaround",H,X),rt=W.context,_t=j?Math.floor(A/d):0,lt=Y?Math.floor(S/f):0;for(let Nt=0;Nt<=_t;Nt++)for(let Bt=0;Bt<=lt;Bt++)rt.drawImage(V,H*Nt,X*Bt,H,X,0,0,H,X);return{canvas:W.canvas,scaleX:Z.scale,scaleY:T.scale,offsetX:g,offsetY:_}}return{canvas:bt.canvas,scaleX:tt.scale,scaleY:vt.scale,offsetX:g,offsetY:_}}getSizeAndScale(t,e,n){const a=Math.max(qf.MAX_PATTERN_SIZE,e);let o=Math.ceil(t*n);return o>=a?o=a:n=o/t,{scale:n,size:o}}clipBbox(t,e,n,a,o){const c=a-e,h=o-n;t.ctx.rect(e,n,c,h),at.axialAlignedBoundingBox([e,n,a,o],te(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const a=t.ctx,o=t.current;switch(e){case Wy.COLORED:const{fillStyle:c,strokeStyle:h}=this.ctx;a.fillStyle=o.fillColor=c,a.strokeStyle=o.strokeColor=h;break;case Wy.UNCOLORED:a.fillStyle=a.strokeStyle=n,o.fillColor=o.strokeColor=n;break;default:throw new QE(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,a){let o=n;a!==Ne.SHADING&&(o=at.transform(o,e.baseTransform),this.matrix&&(o=at.transform(o,this.matrix)));const c=this.createPatternCanvas(e);let h=new DOMMatrix(o);h=h.translate(c.offsetX,c.offsetY),h=h.scale(1/c.scaleX,1/c.scaleY);const d=t.createPattern(c.canvas,"repeat");return d.setTransform(h),d}}function L1({src:r,srcPos:t=0,dest:e,width:n,height:a,nonBlackColor:o=4294967295,inverseDecode:c=!1}){const h=ke.isLittleEndian?4278190080:255,[d,f]=c?[o,h]:[h,o],g=n>>3,_=n&7,y=r.length;e=new Uint32Array(e.buffer);let b=0;for(let A=0;A<a;A++){for(const C=t+g;t<C;t++){const w=t<y?r[t]:255;e[b++]=w&128?f:d,e[b++]=w&64?f:d,e[b++]=w&32?f:d,e[b++]=w&16?f:d,e[b++]=w&8?f:d,e[b++]=w&4?f:d,e[b++]=w&2?f:d,e[b++]=w&1?f:d}if(_===0)continue;const S=t<y?r[t++]:255;for(let C=0;C<_;C++)e[b++]=S&1<<7-C?f:d}return{srcPos:t,destPos:b}}const Ky=16,Qy=100,I1=15,Zy=10,Ke=16,Bd=new DOMMatrix,hn=new Float32Array(2),La=new Float32Array([1/0,1/0,-1/0,-1/0]);function P1(r,t){if(r._removeMirroring)throw new Error("Context is already forwarding operations.");r.__originalSave=r.save,r.__originalRestore=r.restore,r.__originalRotate=r.rotate,r.__originalScale=r.scale,r.__originalTranslate=r.translate,r.__originalTransform=r.transform,r.__originalSetTransform=r.setTransform,r.__originalResetTransform=r.resetTransform,r.__originalClip=r.clip,r.__originalMoveTo=r.moveTo,r.__originalLineTo=r.lineTo,r.__originalBezierCurveTo=r.bezierCurveTo,r.__originalRect=r.rect,r.__originalClosePath=r.closePath,r.__originalBeginPath=r.beginPath,r._removeMirroring=()=>{r.save=r.__originalSave,r.restore=r.__originalRestore,r.rotate=r.__originalRotate,r.scale=r.__originalScale,r.translate=r.__originalTranslate,r.transform=r.__originalTransform,r.setTransform=r.__originalSetTransform,r.resetTransform=r.__originalResetTransform,r.clip=r.__originalClip,r.moveTo=r.__originalMoveTo,r.lineTo=r.__originalLineTo,r.bezierCurveTo=r.__originalBezierCurveTo,r.rect=r.__originalRect,r.closePath=r.__originalClosePath,r.beginPath=r.__originalBeginPath,delete r._removeMirroring},r.save=function(){t.save(),this.__originalSave()},r.restore=function(){t.restore(),this.__originalRestore()},r.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},r.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},r.transform=function(e,n,a,o,c,h){t.transform(e,n,a,o,c,h),this.__originalTransform(e,n,a,o,c,h)},r.setTransform=function(e,n,a,o,c,h){t.setTransform(e,n,a,o,c,h),this.__originalSetTransform(e,n,a,o,c,h)},r.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},r.rotate=function(e){t.rotate(e),this.__originalRotate(e)},r.clip=function(e){t.clip(e),this.__originalClip(e)},r.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},r.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},r.bezierCurveTo=function(e,n,a,o,c,h){t.bezierCurveTo(e,n,a,o,c,h),this.__originalBezierCurveTo(e,n,a,o,c,h)},r.rect=function(e,n,a,o){t.rect(e,n,a,o),this.__originalRect(e,n,a,o)},r.closePath=function(){t.closePath(),this.__originalClosePath()},r.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class B1{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let a;return this.cache[t]!==void 0?(a=this.cache[t],this.canvasFactory.reset(a,e,n)):(a=this.canvasFactory.create(e,n),this.cache[t]=a),a}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function fc(r,t,e,n,a,o,c,h,d,f){const[g,_,y,b,A,S]=te(r);if(_===0&&y===0){const D=c*g+A,x=Math.round(D),k=h*b+S,O=Math.round(k),P=(c+d)*g+A,j=Math.abs(Math.round(P)-x)||1,Y=(h+f)*b+S,K=Math.abs(Math.round(Y)-O)||1;return r.setTransform(Math.sign(g),0,0,Math.sign(b),x,O),r.drawImage(t,e,n,a,o,0,0,j,K),r.setTransform(g,_,y,b,A,S),[j,K]}if(g===0&&b===0){const D=h*y+A,x=Math.round(D),k=c*_+S,O=Math.round(k),P=(h+f)*y+A,j=Math.abs(Math.round(P)-x)||1,Y=(c+d)*_+S,K=Math.abs(Math.round(Y)-O)||1;return r.setTransform(0,Math.sign(_),Math.sign(y),0,x,O),r.drawImage(t,e,n,a,o,0,0,K,j),r.setTransform(g,_,y,b,A,S),[K,j]}r.drawImage(t,e,n,a,o,c,h,d,f);const C=Math.hypot(g,_),w=Math.hypot(y,b);return[C*d,w*f]}class Jy{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Jd;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=De.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,n){n?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=La.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Ne.FILL,e=null){const n=this.minMax.slice();if(t===Ne.STROKE){e||Vt("Stroke bounding box must include transform."),at.singularValueDecompose2dScale(e,hn);const a=hn[0]*this.lineWidth/2,o=hn[1]*this.lineWidth/2;n[0]-=a,n[1]-=o,n[2]+=a,n[3]+=o}return n}updateClipFromPath(){const t=at.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(La,0)}getClippedPathBoundingBox(t=Ne.FILL,e=null){return at.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function tb(r,t){if(t instanceof ImageData){r.putImageData(t,0,0);return}const e=t.height,n=t.width,a=e%Ke,o=(e-a)/Ke,c=a===0?o:o+1,h=r.createImageData(n,Ke);let d=0,f;const g=t.data,_=h.data;let y,b,A,S;if(t.kind===vc.GRAYSCALE_1BPP){const C=g.byteLength,w=new Uint32Array(_.buffer,0,_.byteLength>>2),D=w.length,x=n+7>>3,k=4294967295,O=ke.isLittleEndian?4278190080:255;for(y=0;y<c;y++){for(A=y<o?Ke:a,f=0,b=0;b<A;b++){const P=C-d;let j=0;const Y=P>x?n:P*8-7,K=Y&-8;let it=0,J=0;for(;j<K;j+=8)J=g[d++],w[f++]=J&128?k:O,w[f++]=J&64?k:O,w[f++]=J&32?k:O,w[f++]=J&16?k:O,w[f++]=J&8?k:O,w[f++]=J&4?k:O,w[f++]=J&2?k:O,w[f++]=J&1?k:O;for(;j<Y;j++)it===0&&(J=g[d++],it=128),w[f++]=J&it?k:O,it>>=1}for(;f<D;)w[f++]=0;r.putImageData(h,0,y*Ke)}}else if(t.kind===vc.RGBA_32BPP){for(b=0,S=n*Ke*4,y=0;y<o;y++)_.set(g.subarray(d,d+S)),d+=S,r.putImageData(h,0,b),b+=Ke;y<c&&(S=n*a*4,_.set(g.subarray(d,d+S)),r.putImageData(h,0,b))}else if(t.kind===vc.RGB_24BPP)for(A=Ke,S=n*A,y=0;y<c;y++){for(y>=o&&(A=a,S=n*A),f=0,b=S;b--;)_[f++]=g[d++],_[f++]=g[d++],_[f++]=g[d++],_[f++]=255;r.putImageData(h,0,y*Ke)}else throw new Error(`bad image kind: ${t.kind}`)}function eb(r,t){if(t.bitmap){r.drawImage(t.bitmap,0,0);return}const e=t.height,n=t.width,a=e%Ke,o=(e-a)/Ke,c=a===0?o:o+1,h=r.createImageData(n,Ke);let d=0;const f=t.data,g=h.data;for(let _=0;_<c;_++){const y=_<o?Ke:a;({srcPos:d}=L1({src:f,srcPos:d,dest:g,width:n,height:y,nonBlackColor:0})),r.putImageData(h,0,_*Ke)}}function io(r,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of e)r[n]!==void 0&&(t[n]=r[n]);r.setLineDash!==void 0&&(t.setLineDash(r.getLineDash()),t.lineDashOffset=r.lineDashOffset)}function pc(r){r.strokeStyle=r.fillStyle="#000000",r.fillRule="nonzero",r.globalAlpha=1,r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.miterLimit=10,r.globalCompositeOperation="source-over",r.font="10px sans-serif",r.setLineDash!==void 0&&(r.setLineDash([]),r.lineDashOffset=0);const{filter:t}=r;t!=="none"&&t!==""&&(r.filter="none")}function nb(r,t){if(t)return!0;at.singularValueDecompose2dScale(r,hn);const e=Math.fround(Xn.pixelRatio*qa.PDF_TO_CSS_UNITS);return hn[0]<=e&&hn[1]<=e}const F1=["butt","round","square"],H1=["miter","round","bevel"],z1={},ib={};class Fa{constructor(t,e,n,a,o,{optionalContentConfig:c,markedContentStack:h=null},d,f,g){this.ctx=t,this.current=new Jy(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=a,this.filterFactory=o,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=h||[],this.optionalContentConfig=c,this.cachedCanvases=new B1(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=g??null}getObject(t,e,n=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):n}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:a=null}){const o=this.ctx.canvas.width,c=this.ctx.canvas.height,h=this.ctx.fillStyle;if(this.ctx.fillStyle=a||"#ffffff",this.ctx.fillRect(0,0,o,c),this.ctx.fillStyle=h,n){const d=this.cachedCanvases.getCanvas("transparent",o,c);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...te(this.compositeCtx))}this.ctx.save(),pc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=te(this.ctx)}executeOperatorList(t,e,n,a,o){const c=t.argsArray,h=t.fnArray;let d=e||0;const f=c.length;if(f===d)return d;const g=f-d>Zy&&typeof n=="function",_=g?Date.now()+I1:0;let y=0;const b=this.commonObjs,A=this.objs;let S,C;for(;;){if(a!==void 0&&d===a.nextBreakPoint)return a.breakIt(d,n),d;if(!o||o.has(d))if(S=h[d],C=c[d]??null,S!==So.dependency)C===null?this[S](d):this[S](d,...C);else for(const w of C){this.dependencyTracker?.recordNamedData(w,d);const D=w.startsWith("g_")?b:A;if(!D.has(w))return D.get(w,n),d}if(d++,d===f)return d;if(g&&++y>Zy){if(Date.now()>_)return n(),d;y=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,a=t.height??t.displayHeight;let o=Math.max(Math.hypot(e[0],e[1]),1),c=Math.max(Math.hypot(e[2],e[3]),1),h=n,d=a,f="prescale1",g,_;for(;o>2&&h>1||c>2&&d>1;){let y=h,b=d;o>2&&h>1&&(y=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2),o/=h/y),c>2&&d>1&&(b=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,c/=d/b),g=this.cachedCanvases.getCanvas(f,y,b),_=g.context,_.clearRect(0,0,y,b),_.drawImage(t,0,0,h,d,0,0,y,b),t=g.canvas,h=y,d=b,f=f==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:h,paintHeight:d}}_createMaskCanvas(t,e){const n=this.ctx,{width:a,height:o}=e,c=this.current.fillColor,h=this.current.patternFill,d=te(n);let f,g,_,y;if((e.bitmap||e.data)&&e.count>1){const it=e.bitmap||e.data.buffer;g=JSON.stringify(h?d:[d.slice(0,4),c]),f=this._cachedBitmapsMap.get(it),f||(f=new Map,this._cachedBitmapsMap.set(it,f));const J=f.get(g);if(J&&!h){const ft=Math.round(Math.min(d[0],d[2])+d[4]),tt=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(t,Sn.transformAndFill),{canvas:J,offsetX:ft,offsetY:tt}}_=J}_||(y=this.cachedCanvases.getCanvas("maskCanvas",a,o),eb(y.context,e));let b=at.transform(d,[1/a,0,0,-1/o,0,0]);b=at.transform(b,[1,0,0,1,0,-o]);const A=La.slice();at.axialAlignedBoundingBox([0,0,a,o],b,A);const[S,C,w,D]=A,x=Math.round(w-S)||1,k=Math.round(D-C)||1,O=this.cachedCanvases.getCanvas("fillCanvas",x,k),P=O.context,j=S,Y=C;P.translate(-j,-Y),P.transform(...b),_||(_=this._scaleImage(y.canvas,jn(P)),_=_.img,f&&h&&f.set(g,_)),P.imageSmoothingEnabled=nb(te(P),e.interpolate),fc(P,_,0,0,_.width,_.height,0,0,a,o),P.globalCompositeOperation="source-in";const K=at.transform(jn(P),[1,0,0,1,-j,-Y]);return P.fillStyle=h?c.getPattern(n,this,K,Ne.FILL):c,P.fillRect(0,0,a,o),f&&!h&&(this.cachedCanvases.delete("fillCanvas"),f.set(g,O.canvas)),this.dependencyTracker?.recordDependencies(t,Sn.transformAndFill),{canvas:O.canvas,offsetX:Math.round(j),offsetY:Math.round(Y)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=F1[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=H1[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,n){this.dependencyTracker?.recordSimpleData("dash",t);const a=this.ctx;a.setLineDash!==void 0&&(a.setLineDash(e),a.lineDashOffset=n)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[n,a]of e)switch(n){case"LW":this.setLineWidth(t,a);break;case"LC":this.setLineCap(t,a);break;case"LJ":this.setLineJoin(t,a);break;case"ML":this.setMiterLimit(t,a);break;case"D":this.setDash(t,a[0],a[1]);break;case"RI":this.setRenderingIntent(t,a);break;case"FL":this.setFlatness(t,a);break;case"Font":this.setFont(t,a[0],a[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=a;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=a;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=a;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=a?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(a);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,a="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(a,e,n);this.suspendedCtx=this.ctx;const c=this.ctx=o.context;c.setTransform(this.suspendedCtx.getTransform()),io(this.suspendedCtx,c),P1(c,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),io(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,a){const o=a[0],c=a[1],h=a[2]-o,d=a[3]-c;h===0||d===0||(this.genericComposeSMask(e.context,n,h,d,e.subtype,e.backdrop,e.transferMap,o,c,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,a,o,c,h,d,f,g,_){let y=t.canvas,b=d-g,A=f-_;if(c)if(b<0||A<0||b+n>y.width||A+a>y.height){const C=this.cachedCanvases.getCanvas("maskExtension",n,a),w=C.context;w.drawImage(y,-b,-A),w.globalCompositeOperation="destination-atop",w.fillStyle=c,w.fillRect(0,0,n,a),w.globalCompositeOperation="source-over",y=C.canvas,b=A=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const C=new Path2D;C.rect(b,A,n,a),t.clip(C),t.globalCompositeOperation="destination-atop",t.fillStyle=c,t.fillRect(b,A,n,a),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),o==="Alpha"&&h?e.filter=this.filterFactory.addAlphaFilter(h):o==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(h));const S=new Path2D;S.rect(d,f,n,a),e.clip(S),e.globalCompositeOperation="destination-in",e.drawImage(y,b,A,n,a,d,f,n,a),e.restore()}save(t){this.inSMaskMode&&io(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&io(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,n,a,o,c,h){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,n,a,o,c,h),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n,a){let[o]=n;if(!a){o||=n[0]=new Path2D,this[e](t,o);return}if(this.dependencyTracker!==null){const c=e===So.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,a[0]-c,a[2]+c,a[1]-c,a[3]+c).recordDependencies(t,["transform"])}if(!(o instanceof Path2D)){const c=n[0]=new Path2D;for(let h=0,d=o.length;h<d;)switch(o[h++]){case cc.moveTo:c.moveTo(o[h++],o[h++]);break;case cc.lineTo:c.lineTo(o[h++],o[h++]);break;case cc.curveTo:c.bezierCurveTo(o[h++],o[h++],o[h++],o[h++],o[h++],o[h++]);break;case cc.closePath:c.closePath();break;default:yt(`Unrecognized drawing path operator: ${o[h-1]}`);break}o=c}at.axialAlignedBoundingBox(a,te(this.ctx),this.current.minMax),this[e](t,o),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,n=!0){const a=this.ctx,o=this.current.strokeColor;if(a.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof o=="object"&&o?.getPattern){const c=o.isModifyingCurrentTransform()?a.getTransform():null;if(a.save(),a.strokeStyle=o.getPattern(a,this,jn(a),Ne.STROKE),c){const h=new Path2D;h.addPath(e,a.getTransform().invertSelf().multiplySelf(c)),e=h}this.rescaleAndStroke(e,!1),a.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Sn.stroke),n&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(Ne.STROKE,te(this.ctx))),a.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,n=!0){const a=this.ctx,o=this.current.fillColor,c=this.current.patternFill;let h=!1;if(c){const f=o.isModifyingCurrentTransform()?a.getTransform():null;if(this.dependencyTracker?.save(t),a.save(),a.fillStyle=o.getPattern(a,this,jn(a),Ne.FILL),f){const g=new Path2D;g.addPath(e,a.getTransform().invertSelf().multiplySelf(f)),e=g}h=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(a.fill(e,"evenodd"),this.pendingEOFill=!1):a.fill(e)),this.dependencyTracker?.recordDependencies(t,Sn.fill),h&&(a.restore(),this.dependencyTracker?.restore(t)),n&&this.consumePath(t,e,d)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Sn.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=z1}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=ib}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:a}=this;e!==void 0&&a.recordFutureForcedDependency("textClip",a.getOpenMarker()).recordFutureForcedDependency("textClip",t),a.recordCloseMarker(t)}if(e!==void 0){const a=new Path2D,o=n.getTransform().invertSelf();for(const{transform:c,x:h,y:d,fontSize:f,path:g}of e)g&&a.addPath(g,new DOMMatrix(c).preMultiplySelf(o).translate(h,d).scale(f,-f));n.clip(a)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,n){this.dependencyTracker?.recordSimpleData("font",t).recordNamedDependency(t,e);const a=this.commonObjs.get(e),o=this.current;if(!a)throw new Error(`Can't find font for ${e}`);if(o.fontMatrix=a.fontMatrix||Jd,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&yt("Invalid font matrix for font "+e),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=a,this.current.fontSize=n,a.isType3Font)return;const c=a.loadedName||"sans-serif",h=a.systemFontInfo?.css||`"${c}", ${a.fallbackName}`;let d="normal";a.black?d="900":a.bold&&(d="bold");const f=a.italic?"italic":"normal";let g=n;n<Ky?g=Ky:n>Qy&&(g=Qy),this.current.fontSizeScale=n/g,this.ctx.font=`${f} ${d} ${g}px ${h}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(t,e,n){this.setLeading(t,-n),this.moveText(t,e,n)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:n}=this;n.textMatrix=e,n.textMatrixScale=Math.hypot(e[0],e[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#n(t,e,n){const a=new Path2D;return a.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),a}paintChar(t,e,n,a,o,c){const h=this.ctx,d=this.current,f=d.font,g=d.textRenderingMode,_=d.fontSize/d.fontSizeScale,y=g&De.FILL_STROKE_MASK,b=!!(g&De.ADD_TO_PATH_FLAG),A=d.patternFill&&!f.missingFile,S=d.patternStroke&&!f.missingFile;let C;if((f.disableFontFace||b||A||S)&&!f.missingFile&&(C=f.getPathGenerator(this.commonObjs,e)),C&&(f.disableFontFace||A||S)){h.save(),h.translate(n,a),h.scale(_,-_),this.dependencyTracker?.recordCharacterBBox(t,h,f);let w;if(y===De.FILL||y===De.FILL_STROKE)if(o){w=h.getTransform(),h.setTransform(...o);const D=this.#n(C,w,o);h.fill(D)}else h.fill(C);if(y===De.STROKE||y===De.FILL_STROKE)if(c){w||=h.getTransform(),h.setTransform(...c);const{a:D,b:x,c:k,d:O}=w,P=at.inverseTransform(c),j=at.transform([D,x,k,O,0,0],P);at.singularValueDecompose2dScale(j,hn),h.lineWidth*=Math.max(hn[0],hn[1])/_,h.stroke(this.#n(C,w,c))}else h.lineWidth/=_,h.stroke(C);h.restore()}else(y===De.FILL||y===De.FILL_STROKE)&&(h.fillText(e,n,a),this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,a,()=>h.measureText(e))),(y===De.STROKE||y===De.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,a,()=>h.measureText(e)).recordDependencies(t,Sn.stroke),h.strokeText(e,n,a));b&&((this.pendingTextPaths||=[]).push({transform:te(h),x:n,y:a,fontSize:_,path:C}),this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,a))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let a=3;a<e.length;a+=4)if(e[a]>0&&e[a]<255){n=!0;break}return Tt(this,"isFontSubpixelAAEnabled",n)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Sn.showText).copyDependenciesFromIncrementalOperation(t,"sameLineText").resetBBox(t),this.current.textRenderingMode&De.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,a=n.font;if(a.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t);return}const o=n.fontSize;if(o===0){this.dependencyTracker?.recordOperation(t);return}const c=this.ctx,h=n.fontSizeScale,d=n.charSpacing,f=n.wordSpacing,g=n.fontDirection,_=n.textHScale*g,y=e.length,b=a.vertical,A=b?1:-1,S=a.defaultVMetrics,C=o*n.fontMatrix[0],w=n.textRenderingMode===De.FILL&&!a.disableFontFace&&!n.patternFill;c.save(),n.textMatrix&&c.transform(...n.textMatrix),c.translate(n.x,n.y+n.textRise),g>0?c.scale(_,-1):c.scale(_,1);let D,x;if(n.patternFill){c.save();const Y=n.fillColor.getPattern(c,this,jn(c),Ne.FILL);D=te(c),c.restore(),c.fillStyle=Y}if(n.patternStroke){c.save();const Y=n.strokeColor.getPattern(c,this,jn(c),Ne.STROKE);x=te(c),c.restore(),c.strokeStyle=Y}let k=n.lineWidth;const O=n.textMatrixScale;if(O===0||k===0){const Y=n.textRenderingMode&De.FILL_STROKE_MASK;(Y===De.STROKE||Y===De.FILL_STROKE)&&(k=this.getSinglePixelWidth())}else k/=O;if(h!==1&&(c.scale(h,h),k/=h),c.lineWidth=k,a.isInvalidPDFjsFont){const Y=[];let K=0;for(const J of e)Y.push(J.unicode),K+=J.width;const it=Y.join("");if(c.fillText(it,0,0),this.dependencyTracker!==null){const J=c.measureText(it);this.dependencyTracker.recordBBox(t,this.ctx,-J.actualBoundingBoxLeft,J.actualBoundingBoxRight,-J.actualBoundingBoxAscent,J.actualBoundingBoxDescent).recordOperation(t).recordIncrementalData("sameLineText",t)}n.x+=K*C*_,c.restore(),this.compose();return}let P=0,j;for(j=0;j<y;++j){const Y=e[j];if(typeof Y=="number"){P+=A*Y*o/1e3;continue}let K=!1;const it=(Y.isSpace?f:0)+d,J=Y.fontChar,ft=Y.accent;let tt,vt,bt=Y.width;if(b){const V=Y.vmetric||S,Z=-(Y.vmetric?V[1]:bt*.5)*C,T=V[2]*C;bt=V?-V[0]:bt,tt=Z/h,vt=(P+T)/h}else tt=P/h,vt=0;let I;if(a.remeasure&&bt>0){I=c.measureText(J);const V=I.width*1e3/o*h;if(bt<V&&this.isFontSubpixelAAEnabled){const Z=bt/V;K=!0,c.save(),c.scale(Z,1),tt/=Z}else bt!==V&&(tt+=(bt-V)/2e3*o/h)}if(this.contentVisible&&(Y.isInFont||a.missingFile)){if(w&&!ft)c.fillText(J,tt,vt),this.dependencyTracker?.recordCharacterBBox(t,c,I?{bbox:null}:a,o/h,tt,vt,()=>I??c.measureText(J));else if(this.paintChar(t,J,tt,vt,D,x),ft){const V=tt+o*ft.offset.x/h,Z=vt-o*ft.offset.y/h;this.paintChar(t,ft.fontChar,V,Z,D,x)}}const M=b?bt*C-it*g:bt*C+it*g;P+=M,K&&c.restore()}b?n.y-=P:n.x+=P*_,c.restore(),this.compose(),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t)}showType3Text(t,e){const n=this.ctx,a=this.current,o=a.font,c=a.fontSize,h=a.fontDirection,d=o.vertical?1:-1,f=a.charSpacing,g=a.wordSpacing,_=a.textHScale*h,y=a.fontMatrix||Jd,b=e.length,A=a.textRenderingMode===De.INVISIBLE;let S,C,w,D;if(A||c===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),a.textMatrix&&n.transform(...a.textMatrix),n.translate(a.x,a.y+a.textRise),n.scale(_,h);const x=this.dependencyTracker;for(this.dependencyTracker=x?new Tc(x,t):null,S=0;S<b;++S){if(C=e[S],typeof C=="number"){D=d*C*c/1e3,this.ctx.translate(D,0),a.x+=D*_;continue}const k=(C.isSpace?g:0)+f,O=o.charProcOperatorList[C.operatorListId];O?this.contentVisible&&(this.save(),n.scale(c,c),n.transform(...y),this.executeOperatorList(O),this.restore()):yt(`Type3 character "${C.operatorListId}" is not available.`);const P=[C.width,0];at.applyTransform(P,y),w=P[0]*c+k,n.translate(w,0),a.x+=w*_}n.restore(),x&&(this.dependencyTracker.recordNestedDependencies(),this.dependencyTracker=x)}setCharWidth(t,e,n){}setCharWidthAndBounds(t,e,n,a,o,c,h){const d=new Path2D;d.rect(a,o,c-a,h-o),this.ctx.clip(d),this.dependencyTracker?.recordBBox(t,this.ctx,a,c,o,h).recordClipBox(t,this.ctx,a,c,o,h),this.endPath(t)}getColorN_Pattern(t,e){let n;if(e[0]==="TilingPattern"){const a=this.baseTransform||te(this.ctx),o={createCanvasGraphics:c=>new Fa(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Tc(this.dependencyTracker,t):null)};n=new qf(e,this.ctx,o,a)}else n=this._getPattern(t,e[1],e[2]);return n}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,n=null){let a;return this.cachedPatterns.has(e)?a=this.cachedPatterns.get(e):(a=k1(this.getObject(t,e)),this.cachedPatterns.set(e,a)),n&&(a.matrix=n),a}shadingFill(t,e){if(!this.contentVisible)return;const n=this.ctx;this.save(t);const a=this._getPattern(t,e);n.fillStyle=a.getPattern(n,this,jn(n),Ne.SHADING);const o=jn(n);if(o){const{width:c,height:h}=n.canvas,d=La.slice();at.axialAlignedBoundingBox([0,0,c,h],o,d);const[f,g,_,y]=d;this.ctx.fillRect(f,g,_-f,y-g)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Sn.transform).recordDependencies(t,Sn.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Vt("Should not call beginInlineImage")}beginImageData(){Vt("Should not call beginImageData")}paintFormXObjectBegin(t,e,n){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=te(this.ctx),n)){at.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[a,o,c,h]=n,d=new Path2D;d.rect(a,o,c-a,h-o),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(t,this.ctx,a,c,o,h),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||Kc("TODO: Support non-isolated groups."),e.knockout&&yt("Knockout groups not supported.");const a=te(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let o=La.slice();at.axialAlignedBoundingBox(e.bbox,te(n),o);const c=[0,0,n.canvas.width,n.canvas.height];o=at.intersect(o,c)||[0,0,0,0];const h=Math.floor(o[0]),d=Math.floor(o[1]),f=Math.max(Math.ceil(o[2])-h,1),g=Math.max(Math.ceil(o[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,g]);let _="groupAt"+this.groupLevel;e.smask&&(_+="_smask_"+this.smaskCounter++%2);const y=this.cachedCanvases.getCanvas(_,f,g),b=y.context;b.translate(-h,-d),b.transform(...a);let A=new Path2D;const[S,C,w,D]=e.bbox;if(A.rect(S,C,w-S,D-C),e.matrix){const x=new Path2D;x.addPath(A,new DOMMatrix(e.matrix)),A=x}b.clip(A),e.smask&&this.smaskStack.push({canvas:y.canvas,context:b,offsetX:h,offsetY:d,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(h,d),n.save()),io(n,b),this.ctx=b,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,a=this.groupStack.pop();if(this.ctx=a,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=te(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...o);const c=La.slice();at.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,c),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(c)}}beginAnnotation(t,e,n,a,o,c){if(this.#t(),pc(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const h=n[2]-n[0],d=n[3]-n[1];if(c&&this.annotationCanvasMap){a=a.slice(),a[4]-=n[0],a[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=h,n[3]=d,at.singularValueDecompose2dScale(te(this.ctx),hn);const{viewportScale:f}=this,g=Math.ceil(h*this.outputScaleX*f),_=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(g,_);const{canvas:y,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(e,y),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(hn[0],0,0,-hn[1],0,d*hn[1]),pc(this.ctx)}else{pc(this.ctx),this.endPath(t);const f=new Path2D;f.rect(n[0],n[1],h,d),this.ctx.clip(f)}}this.current=new Jy(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...a),this.transform(t,...o)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(t,e.data,e),e.count=n;const a=this.ctx,o=this._createMaskCanvas(t,e),c=o.canvas;a.save(),a.setTransform(1,0,0,1,0,0),a.drawImage(c,o.offsetX,o.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,o.offsetX,o.offsetX+c.width,o.offsetY,o.offsetY+c.height).recordOperation(t),a.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n,a=0,o=0,c,h){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const d=this.ctx;d.save();const f=te(d);d.transform(n,a,o,c,0,0);const g=this._createMaskCanvas(t,e);d.setTransform(1,0,0,1,g.offsetX-f[4],g.offsetY-f[5]),this.dependencyTracker?.resetBBox(t);for(let _=0,y=h.length;_<y;_+=2){const b=at.transform(f,[n,a,o,c,h[_],h[_+1]]);d.drawImage(g.canvas,b[4],b[5]),this.dependencyTracker?.recordBBox(t,this.ctx,b[4],b[4]+g.canvas.width,b[5],b[5]+g.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx,a=this.current.fillColor,o=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Sn.transformAndFill);for(const c of e){const{data:h,width:d,height:f,transform:g}=c,_=this.cachedCanvases.getCanvas("maskCanvas",d,f),y=_.context;y.save();const b=this.getObject(t,h,c);eb(y,b),y.globalCompositeOperation="source-in",y.fillStyle=o?a.getPattern(y,this,jn(n),Ne.FILL):a,y.fillRect(0,0,d,f),y.restore(),n.save(),n.transform(...g),n.scale(1,-1),fc(n,_.canvas,0,0,d,f,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,d,0,f),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const n=this.getObject(t,e);if(!n){yt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,n)}paintImageXObjectRepeat(t,e,n,a,o){if(!this.contentVisible)return;const c=this.getObject(t,e);if(!c){yt("Dependent image isn't ready yet");return}const h=c.width,d=c.height,f=[];for(let g=0,_=o.length;g<_;g+=2)f.push({transform:[n,0,0,a,o[g],o[g+1]],x:0,y:0,w:h,h:d});this.paintInlineImageXObjectGroup(t,c,f)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:n,height:a}=t,o=this.cachedCanvases.getCanvas("inlineImage",n,a),c=o.context;return c.filter=this.current.transferMaps,c.drawImage(e,0,0),c.filter="none",o.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const n=e.width,a=e.height,o=this.ctx;this.save(t);const{filter:c}=o;c!=="none"&&c!==""&&(o.filter="none"),o.scale(1/n,-1/a);let h;if(e.bitmap)h=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)h=e;else{const g=this.cachedCanvases.getCanvas("inlineImage",n,a).context;tb(g,e),h=this.applyTransferMapsToCanvas(g)}const d=this._scaleImage(h,jn(o));o.imageSmoothingEnabled=nb(te(o),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,o,0,n,-a,0).recordDependencies(t,Sn.imageXObject).recordOperation(t),fc(o,d.img,0,0,d.paintWidth,d.paintHeight,0,-a,n,a),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,n){if(!this.contentVisible)return;const a=this.ctx;let o;if(e.bitmap)o=e.bitmap;else{const c=e.width,h=e.height,f=this.cachedCanvases.getCanvas("inlineImage",c,h).context;tb(f,e),o=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(t);for(const c of n)a.save(),a.transform(...c.transform),a.scale(1,-1),fc(a,o,c.x,c.y,c.w,c.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,a,0,1,-1,0),a.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Sn.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,n){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,n){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,n){const a=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const o=this.ctx;this.pendingClip?(a||(this.pendingClip===ib?o.clip(e,"evenodd"):o.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=te(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),a=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,a)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:n,c:a,d:o}=this.ctx.getTransform();let c,h;if(n===0&&a===0){const d=Math.abs(e),f=Math.abs(o);if(d===f)if(t===0)c=h=1/d;else{const g=d*t;c=h=g<1?1/g:1}else if(t===0)c=1/d,h=1/f;else{const g=d*t,_=f*t;c=g<1?1/g:1,h=_<1?1/_:1}}else{const d=Math.abs(e*o-n*a),f=Math.hypot(e,n),g=Math.hypot(a,o);if(t===0)c=g/d,h=f/d;else{const _=t*d;c=g>_?g/_:1,h=f>_?f/_:1}}this._cachedScaleForStroking[0]=c,this._cachedScaleForStroking[1]=h}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:a}}=this,[o,c]=this.getScaleForStroking();if(o===c){n.lineWidth=(a||1)*o,n.stroke(t);return}const h=n.getLineDash();e&&n.save(),n.scale(o,c),Bd.a=1/o,Bd.d=1/c;const d=new Path2D;if(d.addPath(t,Bd),h.length>0){const f=Math.max(o,c);n.setLineDash(h.map(g=>g/f)),n.lineDashOffset/=f}n.lineWidth=a||1,n.stroke(d),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const r in So)Fa.prototype[r]!==void 0&&(Fa.prototype[So[r]]=Fa.prototype[r]);class Ha{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class U1{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Oa=Symbol("INTERNAL");class j1{#t=!1;#e=!1;#n=!1;#i=!0;constructor(t,{name:e,intent:n,usage:a,rbGroups:o}){this.#t=!!(t&un.DISPLAY),this.#e=!!(t&un.PRINT),this.name=e,this.intent=n,this.usage=a,this.rbGroups=o}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,n=!1){t!==Oa&&Vt("Internal method `_setVisible` called."),this.#n=n,this.#i=e}}class G1{#t=null;#e=new Map;#n=null;#i=null;constructor(t,e=un.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#i=t.order;for(const n of t.groups)this.#e.set(n.id,new j1(e,n));if(t.baseState==="OFF")for(const n of this.#e.values())n._setVisible(Oa,!1);for(const n of t.on)this.#e.get(n)._setVisible(Oa,!0);for(const n of t.off)this.#e.get(n)._setVisible(Oa,!1);this.#n=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let a=1;a<e;a++){const o=t[a];let c;if(Array.isArray(o))c=this.#a(o);else if(this.#e.has(o))c=this.#e.get(o).visible;else return yt(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!c)return!1;break;case"Or":if(c)return!0;break;case"Not":return!c;default:return!0}}return n==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Kc("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(yt(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return yt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return yt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return yt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return yt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return yt(`Unknown optional content policy ${t.policy}.`),!0}return yt(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){const a=this.#e.get(t);if(!a){yt(`Optional content group not found: ${t}`);return}if(n&&e&&a.rbGroups.length)for(const o of a.rbGroups)for(const c of o)c!==t&&this.#e.get(c)?._setVisible(Oa,!1,!0);a._setVisible(Oa,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let n;for(const a of t){switch(a){case"ON":case"OFF":case"Toggle":n=a;continue}const o=this.#e.get(a);if(o)switch(n){case"ON":this.setVisibility(a,!0,e);break;case"OFF":this.setVisibility(a,!1,e);break;case"Toggle":this.setVisibility(a,!o.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new gv;for(const[e,n]of this.#e)t.update(`${e}:${n.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class V1{constructor(t,{disableRange:e=!1,disableStream:n=!1}){ge(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:a,initialData:o,progressiveDone:c,contentDispositionFilename:h}=t;if(this._queuedChunks=[],this._progressiveDone=c,this._contentDispositionFilename=h,o?.length>0){const d=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=a,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),t.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),t.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const a=this._rangeReaders.some(function(o){return o._begin!==t?!1:(o._enqueue(n),!0)});ge(a,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){ge(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new q1(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new Y1(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class q1{constructor(t,e,n=!1,a=null){this._stream=t,this._done=n||!1,this._filename=Hf(a)?a:null,this._queuedChunks=e||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Y1{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function X1(r){let t=!0,e=n("filename\\*","i").exec(r);if(e){e=e[1];let g=h(e);return g=unescape(g),g=d(g),g=f(g),o(g)}if(e=c(r),e){const g=f(e);return o(g)}if(e=n("filename","i").exec(r),e){e=e[1];let g=h(e);return g=f(g),o(g)}function n(g,_){return new RegExp("(?:^|;)\\s*"+g+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',_)}function a(g,_){if(g){if(!/^[\x00-\xFF]+$/.test(_))return _;try{const y=new TextDecoder(g,{fatal:!0}),b=Bo(_);_=y.decode(b),t=!1}catch{}}return _}function o(g){return t&&/[\x80-\xff]/.test(g)&&(g=a("utf-8",g),t&&(g=a("iso-8859-1",g))),g}function c(g){const _=[];let y;const b=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(y=b.exec(g))!==null;){let[,S,C,w]=y;if(S=parseInt(S,10),S in _){if(S===0)break;continue}_[S]=[C,w]}const A=[];for(let S=0;S<_.length&&S in _;++S){let[C,w]=_[S];w=h(w),C&&(w=unescape(w),S===0&&(w=d(w))),A.push(w)}return A.join("")}function h(g){if(g.startsWith('"')){const _=g.slice(1).split('\\"');for(let y=0;y<_.length;++y){const b=_[y].indexOf('"');b!==-1&&(_[y]=_[y].slice(0,b),_.length=y+1),_[y]=_[y].replaceAll(/\\(.)/g,"$1")}g=_.join('"')}return g}function d(g){const _=g.indexOf("'");if(_===-1)return g;const y=g.slice(0,_),A=g.slice(_+1).replace(/^[^']*'/,"");return a(y,A)}function f(g){return!g.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(g)?g:g.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(_,y,b,A){if(b==="q"||b==="Q")return A=A.replaceAll("_"," "),A=A.replaceAll(/=([0-9a-fA-F]{2})/g,function(S,C){return String.fromCharCode(parseInt(C,16))}),a(y,A);try{A=atob(A)}catch{}return a(y,A)})}return""}function Sv(r,t){const e=new Headers;if(!r||!t||typeof t!="object")return e;for(const n in t){const a=t[n];a!==void 0&&e.append(n,a)}return e}function tu(r){return URL.parse(r)?.origin??null}function Ev({responseHeaders:r,isHttp:t,rangeChunkSize:e,disableRange:n}){const a={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(r.get("Content-Length"),10);return!Number.isInteger(o)||(a.suggestedLength=o,o<=2*e)||n||!t||r.get("Accept-Ranges")!=="bytes"||(r.get("Content-Encoding")||"identity")!=="identity"||(a.allowRangeRequests=!0),a}function wv(r){const t=r.get("Content-Disposition");if(t){let e=X1(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Hf(e))return e}return null}function Uo(r,t){return new Cc(`Unexpected server response (${r}) while retrieving PDF "${t}".`,r,r===404||r===0&&t.startsWith("file:"))}function Cv(r){return r===200||r===206}function Tv(r,t,e){return{method:"GET",headers:r,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function xv(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:(yt(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class $1{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Sv(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ge(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new W1(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new K1(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class W1{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),a=e.url;fetch(a,Tv(n,this._withCredentials,this._abortController)).then(o=>{if(t._responseOrigin=tu(o.url),!Cv(o.status))throw Uo(o.status,a);this._reader=o.body.getReader(),this._headersCapability.resolve();const c=o.headers,{allowRangeRequests:h,suggestedLength:d}=Ev({responseHeaders:c,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=d||this._contentLength,this._filename=wv(c),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Zi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:xv(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class K1{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const a=t.source;this._withCredentials=a.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!a.disableStream,this._abortController=new AbortController;const o=new Headers(t.headers);o.append("Range",`bytes=${e}-${n-1}`);const c=a.url;fetch(c,Tv(o,this._withCredentials,this._abortController)).then(h=>{const d=tu(h.url);if(d!==t._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${t._responseOrigin}".`);if(!Cv(h.status))throw Uo(h.status,c);this._readCapability.resolve(),this._reader=h.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:xv(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const Fd=200,Hd=206;function Q1(r){const t=r.response;return typeof t!="string"?t:Bo(t).buffer}class Z1{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:n}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Sv(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,a=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[o,c]of this.headers)e.setRequestHeader(o,c);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),a.expectedStatus=Hd):a.expectedStatus=Fd,e.responseType="arraybuffer",ge(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),a.onHeadersReceived=t.onHeadersReceived,a.onDone=t.onDone,a.onError=t.onError,a.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const a=n.xhr;if(a.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),a.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],a.status===0&&this.isHttp){n.onError(a.status);return}const o=a.status||Fd;if(!(o===Fd&&n.expectedStatus===Hd)&&o!==n.expectedStatus){n.onError(a.status);return}const h=Q1(a);if(o===Hd){const d=a.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?n.onDone({begin:parseInt(f[1],10),chunk:h}):(yt('Missing or invalid "Content-Range" header.'),n.onError(0))}else h?n.onDone({begin:0,chunk:h}):n.onError(a.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class J1{constructor(t){this._source=t,this._manager=new Z1(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return ge(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new tw(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new ew(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class tw{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=tu(e.responseURL);const n=e.getAllResponseHeaders(),a=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(h=>{const[d,...f]=h.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:c}=Ev({responseHeaders:a,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=c||this._contentLength,this._filename=wv(a),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Uo(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class ew{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=tu(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Uo(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const nw=/^[a-z][a-z0-9\-+.]+:/i;function iw(r){if(nw.test(r))return new URL(r);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(r))}class sw{constructor(t){this.source=t,this.url=iw(t.url),ge(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ge(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new aw(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new rw(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class aw{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(a=>{this._contentLength=a.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},a=>{a.code==="ENOENT"&&(a=Uo(0,this._url.href)),this._storedError=a,this._headersCapability.reject(a)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Zi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class rw{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const a=t.source;this._isStreamingSupported=!a.disableStream;const o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const so=Symbol("INITIAL_DATA");class Rv{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:so}}get(t,e=null){if(e){const a=this.#e(t);return a.promise.then(()=>e(a.data)),null}const n=this.#t[t];if(!n||n.data===so)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#t[t];return!!e&&e.data!==so}delete(t){const e=this.#t[t];return!e||e.data===so?!1:(delete this.#t[t],!0)}resolve(t,e=null){const n=this.#e(t);n.data=e,n.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==so&&(yield[t,e])}}}const ow=1e5,sb=30;class He{#t=Promise.withResolvers();#e=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#a=null;#s=null;#r=0;#o=0;#l=null;#c=null;#d=0;#u=0;#f=Object.create(null);#g=[];#p=null;#h=[];#m=new WeakMap;#b=null;static#_=new Map;static#A=new Map;static#S=new WeakMap;static#y=null;static#E=new Set;constructor({textContentSource:t,container:e,viewport:n}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(d){d.enqueue(t),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#u=n.scale*Xn.pixelRatio,this.#d=n.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:a,pageHeight:o,pageX:c,pageY:h}=n.rawDims;this.#b=[1,0,0,-1,-c,h+o],this.#o=a,this.#r=o,He.#D(),Ns(e,n),this.#t.promise.finally(()=>{He.#E.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=ke.platform;return Tt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#l.read().then(({value:e,done:n})=>{if(n){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#f,e.styles),this.#R(e.items),t()},this.#t.reject)};return this.#l=this.#p.getReader(),He.#E.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const n=t.scale*Xn.pixelRatio,a=t.rotation;if(a!==this.#d&&(e?.(),this.#d=a,Ns(this.#c,{rotation:a})),n!==this.#u){e?.(),this.#u=n;const o={div:null,properties:null,ctx:He.#O(this.#a)};for(const c of this.#h)o.properties=this.#m.get(c),o.div=c,this.#w(o)}}cancel(){const t=new Zi("TextLayer task cancelled.");this.#l?.cancel(t).catch(()=>{}),this.#l=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#g}#R(t){if(this.#n)return;this.#s.ctx??=He.#O(this.#a);const e=this.#h,n=this.#g;for(const a of t){if(e.length>ow){yt("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),a.id&&this.#e.setAttribute("id",`${a.id}`),o.append(this.#e)}else a.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}n.push(a.str),this.#T(a)}}#T(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const a=at.transform(this.#b,t.transform);let o=Math.atan2(a[1],a[0]);const c=this.#f[t.fontName];c.vertical&&(o+=Math.PI/2);let h=this.#i&&c.fontSubstitution||c.fontFamily;h=He.fontFamilyMap.get(h)||h;const d=Math.hypot(a[2],a[3]),f=d*He.#I(h,c,this.#a);let g,_;o===0?(g=a[4],_=a[5]-f):(g=a[4]+f*Math.sin(o),_=a[5]-f*Math.cos(o));const y="calc(var(--total-scale-factor) *",b=e.style;this.#e===this.#c?(b.left=`${(100*g/this.#o).toFixed(2)}%`,b.top=`${(100*_/this.#r).toFixed(2)}%`):(b.left=`${y}${g.toFixed(2)}px)`,b.top=`${y}${_.toFixed(2)}px)`),b.fontSize=`${y}${(He.#y*d).toFixed(2)}px)`,b.fontFamily=h,n.fontSize=d,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#i&&(e.dataset.fontName=c.fontSubstitutionLoadedName||t.fontName),o!==0&&(n.angle=o*(180/Math.PI));let A=!1;if(t.str.length>1)A=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const S=Math.abs(t.transform[0]),C=Math.abs(t.transform[3]);S!==C&&Math.max(S,C)/Math.min(S,C)>1.5&&(A=!0)}if(A&&(n.canvasWidth=c.vertical?t.height:t.width),this.#m.set(e,n),this.#s.div=e,this.#s.properties=n,this.#w(this.#s),n.hasText&&this.#e.append(e),n.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),this.#e.append(S)}}#w(t){const{div:e,properties:n,ctx:a}=t,{style:o}=e;let c="";if(He.#y>1&&(c=`scale(${1/He.#y})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:h}=o,{canvasWidth:d,fontSize:f}=n;He.#x(a,f*this.#u,h);const{width:g}=a.measureText(e.textContent);g>0&&(c=`scaleX(${d*this.#u/g}) ${c}`)}n.angle!==0&&(c=`rotate(${n.angle}deg) ${c}`),c.length>0&&(o.transform=c)}static cleanup(){if(!(this.#E.size>0)){this.#_.clear();for(const{canvas:t}of this.#A.values())t.remove();this.#A.clear()}}static#O(t=null){let e=this.#A.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#A.set(t,e),this.#S.set(e,{size:0,family:""})}return e}static#x(t,e,n){const a=this.#S.get(t);e===a.size&&n===a.family||(t.font=`${e}px ${n}`,a.size=e,a.family=n)}static#D(){if(this.#y!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#y=t.getBoundingClientRect().height,t.remove()}static#I(t,e,n){const a=this.#_.get(t);if(a)return a;const o=this.#O(n);o.canvas.width=o.canvas.height=sb,this.#x(o,sb,t);const c=o.measureText(""),h=c.fontBoundingBoxAscent,d=Math.abs(c.fontBoundingBoxDescent);o.canvas.width=o.canvas.height=0;let f=.8;return h?f=h/(h+d):(ke.platform.isFirefox&&yt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?f=e.ascent:e.descent&&(f=1+e.descent)),this.#_.set(t,f),f}}class Eo{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};function a(o){if(!o)return;let c=null;const h=o.name;if(h==="#text")c=o.value;else if(Eo.shouldBuildText(h))o?.attributes?.textContent?c=o.attributes.textContent:o.value&&(c=o.value);else return;if(c!==null&&e.push({str:c}),!!o.children)for(const d of o.children)a(d)}return a(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const lw=100;function Dv(r={}){typeof r=="string"||r instanceof URL?r={url:r}:(r instanceof ArrayBuffer||ArrayBuffer.isView(r))&&(r={data:r});const t=new Yf,{docId:e}=t,n=r.url?m1(r.url):null,a=r.data?_1(r.data):null,o=r.httpHeaders||null,c=r.withCredentials===!0,h=r.password??null,d=r.range instanceof Mv?r.range:null,f=Number.isInteger(r.rangeChunkSize)&&r.rangeChunkSize>0?r.rangeChunkSize:2**16;let g=r.worker instanceof wo?r.worker:null;const _=r.verbosity,y=typeof r.docBaseUrl=="string"&&!Qc(r.docBaseUrl)?r.docBaseUrl:null,b=hc(r.cMapUrl),A=r.cMapPacked!==!1,S=r.CMapReaderFactory||(ze?C1:Yy),C=hc(r.iccUrl),w=hc(r.standardFontDataUrl),D=r.StandardFontDataFactory||(ze?T1:Xy),x=hc(r.wasmUrl),k=r.WasmFactory||(ze?x1:$y),O=r.stopAtErrors!==!0,P=Number.isInteger(r.maxImageSize)&&r.maxImageSize>-1?r.maxImageSize:-1,j=r.isEvalSupported!==!1,Y=typeof r.isOffscreenCanvasSupported=="boolean"?r.isOffscreenCanvasSupported:!ze,K=typeof r.isImageDecoderSupported=="boolean"?r.isImageDecoderSupported:!ze&&(ke.platform.isFirefox||!globalThis.chrome),it=Number.isInteger(r.canvasMaxAreaInBytes)?r.canvasMaxAreaInBytes:-1,J=typeof r.disableFontFace=="boolean"?r.disableFontFace:ze,ft=r.fontExtraProperties===!0,tt=r.enableXfa===!0,vt=r.ownerDocument||globalThis.document,bt=r.disableRange===!0,I=r.disableStream===!0,M=r.disableAutoFetch===!0,V=r.pdfBug===!0,Z=r.CanvasFactory||(ze?w1:A1),T=r.FilterFactory||(ze?E1:S1),H=r.enableHWA===!0,X=r.useWasm!==!1,W=d?d.length:r.length??NaN,rt=typeof r.useSystemFonts=="boolean"?r.useSystemFonts:!ze&&!J,_t=typeof r.useWorkerFetch=="boolean"?r.useWorkerFetch:!!(S===Yy&&D===Xy&&k===$y&&b&&w&&x&&ho(b,document.baseURI)&&ho(w,document.baseURI)&&ho(x,document.baseURI)),lt=null;$E(_);const Nt={canvasFactory:new Z({ownerDocument:vt,enableHWA:H}),filterFactory:new T({docId:e,ownerDocument:vt}),cMapReaderFactory:_t?null:new S({baseUrl:b,isCompressed:A}),standardFontDataFactory:_t?null:new D({baseUrl:w}),wasmFactory:_t?null:new k({baseUrl:x})};g||(g=wo.create({verbosity:_,port:Ha.workerPort}),t._worker=g);const Bt={docId:e,apiVersion:"5.4.149",data:a,password:h,disableAutoFetch:M,rangeChunkSize:f,length:W,docBaseUrl:y,enableXfa:tt,evaluatorOptions:{maxImageSize:P,disableFontFace:J,ignoreErrors:O,isEvalSupported:j,isOffscreenCanvasSupported:Y,isImageDecoderSupported:K,canvasMaxAreaInBytes:it,fontExtraProperties:ft,useSystemFonts:rt,useWasm:X,useWorkerFetch:_t,cMapUrl:b,iccUrl:C,standardFontDataUrl:w,wasmUrl:x}},kn={ownerDocument:vt,pdfBug:V,styleElement:lt,loadingParams:{disableAutoFetch:M,enableXfa:tt}};return g.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const nr=g.messageHandler.sendWithPromise("GetDocRequest",Bt,a?[a.buffer]:null);let bi;if(d)bi=new V1(d,{disableRange:bt,disableStream:I});else if(!a){if(!n)throw new Error("getDocument - no `url` parameter provided.");const is=ho(n)?$1:ze?sw:J1;bi=new is({url:n,length:W,httpHeaders:o,withCredentials:c,rangeChunkSize:f,disableRange:bt,disableStream:I})}return nr.then(is=>{if(t.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const js=new fo(e,is,g.port),ir=new hw(js,t,bi,kn,Nt,H);t._transport=ir,js.send("Ready",null)})}).catch(t._capability.reject),t}class Yf{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Yf.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Mv{#t=Promise.withResolvers();#e=[];#n=[];#i=[];#a=[];constructor(t,e,n=!1,a=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=a}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#i.push(t)}addProgressiveReadListener(t){this.#n.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const n of this.#a)n(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const n of this.#i)n(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#n)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Vt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class cw{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Tt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class uw{#t=!1;constructor(t,e,n,a=!1){this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=a?new Gy:null,this._pdfBug=a,this.commonObjs=n.commonObjs,this.objs=new Rv,this._intentStates=new Map,this.destroyed=!1,this.recordedGroups=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}={}){return new Ho({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:a,dontFlip:o})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Tt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:a="display",annotationMode:o=Xi.ENABLE,transform:c=null,background:h=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:g=null,printAnnotationStorage:_=null,isEditing:y=!1,recordOperations:b=!1,filteredOperationIndexes:A=null}){this._stats?.time("Overall");const S=this._transport.getRenderingIntent(a,o,_,y),{renderingIntent:C,cacheKey:w}=S;this.#t=!1,d||=this._transport.getOptionalContentConfig(C);let D=this._intentStates.get(w);D||(D=Object.create(null),this._intentStates.set(w,D)),D.streamReaderCancelTimeout&&(clearTimeout(D.streamReaderCancelTimeout),D.streamReaderCancelTimeout=null);const x=!!(C&un.PRINT);D.displayReadyCapability||(D.displayReadyCapability=Promise.withResolvers(),D.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(S));const k=!this.recordedGroups&&(b||this._pdfBug&&globalThis.StepperManager?.enabled),O=Y=>{if(D.renderTasks.delete(P),k){const K=P.gfx?.dependencyTracker.take();K?(P.stepper?.setOperatorGroups(K),b&&(this.recordedGroups=K)):b&&(this.recordedGroups=[])}x&&(this.#t=!0),this.#e(),Y?(P.capability.reject(Y),this._abortOperatorList({intentState:D,reason:Y instanceof Error?Y:new Error(Y)})):P.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},P=new Ia({callback:O,params:{canvas:e,canvasContext:t,dependencyTracker:k?new R1(e):null,viewport:n,transform:c,background:h},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:D.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!x,pdfBug:this._pdfBug,pageColors:g,enableHWA:this._transport.enableHWA,filteredOperationIndexes:A});(D.renderTasks||=new Set).add(P);const j=P.task;return Promise.all([D.displayReadyCapability.promise,d]).then(([Y,K])=>{if(this.destroyed){O();return}if(this._stats?.time("Rendering"),!(K.renderingIntent&C))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");P.initializeGraphics({transparency:Y,optionalContentConfig:K}),P.operatorListChanged()}).catch(O),j}getOperatorList({intent:t="display",annotationMode:e=Xi.ENABLE,printAnnotationStorage:n=null,isEditing:a=!1}={}){function o(){h.operatorList.lastChunk&&(h.opListReadCapability.resolve(h.operatorList),h.renderTasks.delete(d))}const c=this._transport.getRenderingIntent(t,e,n,a,!0);let h=this._intentStates.get(c.cacheKey);h||(h=Object.create(null),this._intentStates.set(c.cacheKey,h));let d;return h.opListReadCapability||(d=Object.create(null),d.operatorListChanged=o,h.opListReadCapability=Promise.withResolvers(),(h.renderTasks||=new Set).add(d),h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(c)),h.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(a){return a.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Eo.textContent(n));const e=this.streamTextContent(t);return new Promise(function(n,a){function o(){c.read().then(function({value:d,done:f}){if(f){n(h);return}h.lang??=d.lang,Object.assign(h.styles,d.styles),h.items.push(...d.items),o()},a)}const c=e.getReader(),h={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new Gy),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,a=t.length;n<a;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:a}){const{map:o,transfer:c}=n,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:o,modifiedIds:a},c).getReader(),f=this._intentStates.get(e);f.streamReader=d;const g=()=>{d.read().then(({value:_,done:y})=>{if(y){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(_,f),g())},_=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const y of f.renderTasks)y.operatorListChanged();this.#e()}if(f.displayReadyCapability)f.displayReadyCapability.reject(_);else if(f.opListReadCapability)f.opListReadCapability.reject(_);else throw _}})};g()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof Ff){let a=lw;e.extraDelay>0&&e.extraDelay<1e3&&(a+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},a);return}}if(t.streamReader.cancel(new Zi(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[a,o]of this._intentStates)if(o===t){this._intentStates.delete(a);break}this.cleanup()}}}get stats(){return this._stats}}var $i,Dn,di,xs,Xc,Rs,Ds,je,Ac,Nv,Ov,po,Va,Sc;const Zt=class Zt{constructor({name:t=null,port:e=null,verbosity:n=WE()}={}){zn(this,je);zn(this,$i,Promise.withResolvers());zn(this,Dn,null);zn(this,di,null);zn(this,xs,null);if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(Qt(Zt,Ds).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Qt(Zt,Ds).set(e,this),Un(this,je,Nv).call(this,e)}else Un(this,je,Ov).call(this)}get promise(){return Qt(this,$i).promise}get port(){return Qt(this,di)}get messageHandler(){return Qt(this,Dn)}destroy(){this.destroyed=!0,Qt(this,xs)?.terminate(),$e(this,xs,null),Qt(Zt,Ds).delete(Qt(this,di)),$e(this,di,null),Qt(this,Dn)?.destroy(),$e(this,Dn,null)}static create(t){const e=Qt(this,Ds).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Zt(t)}static get workerSrc(){if(Ha.workerSrc)return Ha.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Tt(this,"_setupFakeWorkerGlobal",(async()=>Qt(this,Va,Sc)?Qt(this,Va,Sc):(await import(this.workerSrc)).WorkerMessageHandler)())}};$i=new WeakMap,Dn=new WeakMap,di=new WeakMap,xs=new WeakMap,Xc=new WeakMap,Rs=new WeakMap,Ds=new WeakMap,je=new WeakSet,Ac=function(){Qt(this,$i).resolve(),Qt(this,Dn).send("configure",{verbosity:this.verbosity})},Nv=function(t){$e(this,di,t),$e(this,Dn,new fo("main","worker",t)),Qt(this,Dn).on("ready",()=>{}),Un(this,je,Ac).call(this)},Ov=function(){if(Qt(Zt,Rs)||Qt(Zt,Va,Sc)){Un(this,je,po).call(this);return}let{workerSrc:t}=Zt;try{Zt._isSameOrigin(window.location,t)||(t=Zt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new fo("main","worker",e),a=()=>{o.abort(),n.destroy(),e.terminate(),this.destroyed?Qt(this,$i).reject(new Error("Worker was destroyed")):Un(this,je,po).call(this)},o=new AbortController;e.addEventListener("error",()=>{Qt(this,xs)||a()},{signal:o.signal}),n.on("test",h=>{if(o.abort(),this.destroyed||!h){a();return}$e(this,Dn,n),$e(this,di,e),$e(this,xs,e),Un(this,je,Ac).call(this)}),n.on("ready",h=>{if(o.abort(),this.destroyed){a();return}try{c()}catch{Un(this,je,po).call(this)}});const c=()=>{const h=new Uint8Array;n.send("test",h,[h.buffer])};c();return}catch{Kc("The worker has been disabled.")}Un(this,je,po).call(this)},po=function(){Qt(Zt,Rs)||(yt("Setting up fake worker."),$e(Zt,Rs,!0)),Zt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Qt(this,$i).reject(new Error("Worker was destroyed"));return}const e=new v1;$e(this,di,e);const n=`fake${My(Zt,Xc)._++}`,a=new fo(n+"_worker",n,e);t.setup(a,e),$e(this,Dn,new fo(n,n+"_worker",e)),Un(this,je,Ac).call(this)}).catch(t=>{Qt(this,$i).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},Va=new WeakSet,Sc=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},zn(Zt,Va),zn(Zt,Xc,0),zn(Zt,Rs,!1),zn(Zt,Ds,new WeakMap),ze&&($e(Zt,Rs,!0),Ha.workerSrc||="./pdf.worker.mjs"),Zt._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||n.origin==="null")return!1;const a=new URL(e,n);return n.origin===a.origin},Zt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Zt.fromPort=t=>{if(o1("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Zt.create(t)};let wo=Zt;class hw{#t=new Map;#e=new Map;#n=new Map;#i=new Map;#a=null;constructor(t,e,n,a,o,c){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Rv,this.fontLoader=new p1({ownerDocument:a.ownerDocument,styleElement:a.styleElement}),this.loadingParams=a.loadingParams,this._params=a,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.wasmFactory=o.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=c,this.setupMessageHandler()}#s(t,e=null){const n=this.#t.get(t);if(n)return n;const a=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,a),a}get annotationStorage(){return Tt(this,"annotationStorage",new jf)}getRenderingIntent(t,e=Xi.ENABLE,n=null,a=!1,o=!1){let c=un.DISPLAY,h=sf;switch(t){case"any":c=un.ANY;break;case"display":break;case"print":c=un.PRINT;break;default:yt(`getRenderingIntent - invalid intent: ${t}`)}const d=c&un.PRINT&&n instanceof mv?n:this.annotationStorage;switch(e){case Xi.DISABLE:c+=un.ANNOTATIONS_DISABLE;break;case Xi.ENABLE:break;case Xi.ENABLE_FORMS:c+=un.ANNOTATIONS_FORMS;break;case Xi.ENABLE_STORAGE:c+=un.ANNOTATIONS_STORAGE,h=d.serializable;break;default:yt(`getRenderingIntent - invalid annotationMode: ${e}`)}a&&(c+=un.IS_EDITING),o&&(c+=un.OPLIST);const{ids:f,hash:g}=d.modifiedIds,_=[c,h.hash,g];return{renderingIntent:c,cacheKey:_.join("_"),annotationStorageSerializable:h,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#e.values())t.push(n._destroy());this.#e.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),He.cleanup(),this._networkStream?.cancelAllRequests(new Zi("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,a)=>{ge(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},a.onPull=()=>{this._fullReader.read().then(function({value:o,done:c}){if(c){a.close();return}ge(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{a.error(o)})},a.onCancel=o=>{this._fullReader.cancel(o),a.ready.catch(c=>{if(!this.destroyed)throw c})}}),t.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:a,isRangeSupported:o,contentLength:c}=this._fullReader;return(!a||!o)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=h=>{e.onProgress?.({loaded:h.loaded,total:h.total})}),{isStreamingSupported:a,isRangeSupported:o,contentLength:c}}),t.on("GetRangeReader",(n,a)=>{ge(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){a.close();return}a.onPull=()=>{o.read().then(function({value:c,done:h}){if(h){a.close();return}ge(c instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(c),1,[c])}).catch(c=>{a.error(c)})},a.onCancel=c=>{o.cancel(c),a.ready.catch(h=>{if(!this.destroyed)throw h})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new cw(n,this))}),t.on("DocException",n=>{e._capability.reject(We(n))}),t.on("PasswordRequest",n=>{this.#a=Promise.withResolvers();try{if(!e.onPassword)throw We(n);const a=o=>{o instanceof Error?this.#a.reject(o):this.#a.resolve({password:o})};e.onPassword(a,n.code)}catch(a){this.#a.reject(a)}return this.#a.promise}),t.on("DataLoaded",n=>{e.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;this.#e.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,a,o])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(a){case"Font":if("error"in o){const f=o.error;yt(`Error during font loading: ${f}`),this.commonObjs.resolve(n,f);break}const c=this._params.pdfBug&&globalThis.FontInspector?.enabled?(f,g)=>globalThis.FontInspector.fontAdded(f,g):null,h=new g1(o,c);this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!h.fontExtraProperties&&h.data&&(h.data=null),this.commonObjs.resolve(n,h)});break;case"CopyLocalImage":const{imageRef:d}=o;ge(d,"The imageRef must be defined.");for(const f of this.#e.values())for(const[,g]of f.objs)if(g?.ref===d)return g.dataLen?(this.commonObjs.resolve(n,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${a}`)}return null}),t.on("obj",([n,a,o,c])=>{if(this.destroyed)return;const h=this.#e.get(a);if(!h.objs.has(n)){if(h._intentStates.size===0){c?.bitmap?.close();return}switch(o){case"Image":case"Pattern":h.objs.resolve(n,c);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",n=>{this.destroyed||e.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const a=this[n.type];if(!a)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return a.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&yt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#n.get(e);if(n)return n;const a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#i.set(o.refStr,t);const c=new uw(e,o,this,this._params.pdfBug);return this.#e.set(e,c),c});return this.#n.set(e,a),a}getPageIndex(t){return af(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#s("GetOptionalContentConfig").then(e=>new G1(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(a=>({info:a[0],metadata:a[1]?new U1(a[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),He.cleanup()}}cachedPageNumber(t){if(!af(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#i.get(e)??null}}class dw{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Ia{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:n,commonObjs:a,annotationCanvasMap:o,operatorList:c,pageIndex:h,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:g=!1,pdfBug:_=!1,pageColors:y=null,enableHWA:b=!1,filteredOperationIndexes:A=null}){this.callback=t,this.params=e,this.objs=n,this.commonObjs=a,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=c,this._pageIndex=h,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=_,this.pageColors=y,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=g===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new dw(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=b,this._dependencyTracker=e.dependencyTracker,this._filteredOperationIndexes=A}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Ia.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ia.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:a,background:o,dependencyTracker:c}=this.params,h=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Fa(h,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,c),this.gfx.beginDrawing({transform:a,viewport:n,transparency:t,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Ia.#e.delete(this._canvas),t||=new Ff(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._filteredOperationIndexes),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ia.#e.delete(this._canvas),this.callback())))}}const fw="5.4.149",pw="9e2e9e209";class En{#t=null;#e=null;#n;#i=null;#a=!1;#s=!1;#r=null;#o;#l=null;#c=null;static#d=null;static get _keyboardManager(){return Tt(this,"_keyboardManager",new zo([[["Escape","mac+Escape"],En.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],En.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],En.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],En.prototype._moveToPrevious],[["Home","mac+Home"],En.prototype._moveToBeginning],[["End","mac+End"],En.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#s=!1,this.#r=t):this.#s=!0,this.#c=t?._uiManager||e,this.#o=this.#c._eventBus,this.#n=t?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",En.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#c._signal;t.addEventListener("click",this.#p.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const n=this.#e=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#n,t.append(n),t}renderMainDropdown(){const t=this.#i=this.#u();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#u(){const t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",Cn,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,a]of this.#c.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",a),o.title=n,o.setAttribute("data-l10n-id",En.#d[n]);const c=document.createElement("span");o.append(c),c.className="swatch",c.style.backgroundColor=a,o.ariaSelected=a===this.#n,o.addEventListener("click",this.#f.bind(this,a),{signal:e}),t.append(o)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:Ot.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#p(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#m){this.#p(t);return}if(t.target===this.#t){this.#i.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#i?.firstChild||t.target===this.#t){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#p(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#m){this.#p(t);return}this.#i.firstChild?.focus()}_moveToEnd(t){if(!this.#m){this.#p(t);return}this.#i.lastChild?.focus()}#g(t){En._keyboardManager.exec(this,t)}#p(t){if(this.#m){this.hideDropdown();return}if(this.#a=t.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#c.combinedSignal(this.#l)})),this.#t.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const e=this.#i=this.#u();this.#t.append(e)}#h(t){this.#i?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#m(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#m){this.#r?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#i)return;const e=this.#c.highlightColors.values();for(const n of this.#i.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}}class Co{#t=null;#e=null;#n=null;static#i=null;constructor(t){this.#e=t,this.#n=t._uiManager,Co.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:n}=this.#e,a=this.#t=document.createElement("input");return a.type="color",a.value=n||"#000000",a.className="basicColorPicker",a.tabIndex=0,a.setAttribute("data-l10n-id",Co.#i[t]),a.addEventListener("input",()=>{this.#n.updateParams(e,a.value)},{signal:this.#n._signal}),a}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function ab(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function ao(r){return Math.max(0,Math.min(255,255*r))}class rb{static CMYK_G([t,e,n,a]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+a)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=ao(t),[t,t,t]}static G_HTML([t]){const e=ab(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(ao)}static RGB_HTML(t){return`#${t.map(ab).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,a]){return["RGB",1-Math.min(1,t+a),1-Math.min(1,n+a),1-Math.min(1,e+a)]}static CMYK_rgb([t,e,n,a]){return[ao(1-Math.min(1,t+a)),ao(1-Math.min(1,n+a)),ao(1-Math.min(1,e+a))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const a=1-t,o=1-e,c=1-n,h=Math.min(a,o,c);return["CMYK",a,o,c,h]}}class gw{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const a=this._createSVG("svg:svg");return a.setAttribute("version","1.1"),n||(a.setAttribute("width",`${t}px`),a.setAttribute("height",`${e}px`)),a.setAttribute("preserveAspectRatio","none"),a.setAttribute("viewBox",`0 0 ${t} ${e}`),a}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Vt("Abstract method `_createSVG` called.")}}class xc extends gw{_createSVG(t){return document.createElementNS(ui,t)}}class kv{static setupStorage(t,e,n,a,o){const c=a.getValue(e,{value:null});switch(n.name){case"textarea":if(c.value!==null&&(t.textContent=c.value),o==="print")break;t.addEventListener("input",h=>{a.setValue(e,{value:h.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(c.value===n.attributes.xfaOn?t.setAttribute("checked",!0):c.value===n.attributes.xfaOff&&t.removeAttribute("checked"),o==="print")break;t.addEventListener("change",h=>{a.setValue(e,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(c.value!==null&&t.setAttribute("value",c.value),o==="print")break;t.addEventListener("input",h=>{a.setValue(e,{value:h.target.value})})}break;case"select":if(c.value!==null){t.setAttribute("value",c.value);for(const h of n.children)h.attributes.value===c.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}t.addEventListener("input",h=>{const d=h.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;a.setValue(e,{value:f})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:a,linkService:o}){const{attributes:c}=e,h=t instanceof HTMLAnchorElement;c.type==="radio"&&(c.name=`${c.name}-${a}`);for(const[d,f]of Object.entries(c))if(f!=null)switch(d){case"class":f.length&&t.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",f);break;case"style":Object.assign(t.style,f);break;case"textContent":t.textContent=f;break;default:(!h||d!=="href"&&d!=="newWindow")&&t.setAttribute(d,f)}h&&o.addLinkAttributes(t,c.href,c.newWindow),n&&c.dataId&&this.setupStorage(t,c.dataId,e,n)}static render(t){const e=t.annotationStorage,n=t.linkService,a=t.xfaHtml,o=t.intent||"display",c=document.createElement(a.name);a.attributes&&this.setAttributes({html:c,element:a,intent:o,linkService:n});const h=o!=="richText",d=t.div;if(d.append(c),t.viewport){const _=`matrix(${t.viewport.transform.join(",")})`;d.style.transform=_}h&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(a.children.length===0){if(a.value){const _=document.createTextNode(a.value);c.append(_),h&&Eo.shouldBuildText(a.name)&&f.push(_)}return{textDivs:f}}const g=[[a,-1,c]];for(;g.length>0;){const[_,y,b]=g.at(-1);if(y+1===_.children.length){g.pop();continue}const A=_.children[++g.at(-1)[1]];if(A===null)continue;const{name:S}=A;if(S==="#text"){const w=document.createTextNode(A.value);f.push(w),b.append(w);continue}const C=A?.attributes?.xmlns?document.createElementNS(A.attributes.xmlns,S):document.createElement(S);if(b.append(C),A.attributes&&this.setAttributes({html:C,element:A,storage:e,intent:o,linkService:n}),A.children?.length>0)g.push([A,-1,C]);else if(A.value){const w=document.createTextNode(A.value);h&&Eo.shouldBuildText(S)&&f.push(w),C.append(w)}}for(const _ of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))_.setAttribute("readOnly",!0);return{textDivs:f}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const mw=9,Os=new WeakSet,_w=new Date().getTimezoneOffset()*60*1e3;class ob{static create(t){switch(t.data.annotationType){case de.LINK:return new Xf(t);case de.TEXT:return new yw(t);case de.WIDGET:switch(t.data.fieldType){case"Tx":return new bw(t);case"Btn":return t.data.radioButton?new Lv(t):t.data.checkBox?new Aw(t):new Sw(t);case"Ch":return new Ew(t);case"Sig":return new vw(t)}return new Fs(t);case de.POPUP:return new of(t);case de.FREETEXT:return new Iv(t);case de.LINE:return new Cw(t);case de.SQUARE:return new Tw(t);case de.CIRCLE:return new xw(t);case de.POLYLINE:return new Pv(t);case de.CARET:return new Dw(t);case de.INK:return new $f(t);case de.POLYGON:return new Rw(t);case de.HIGHLIGHT:return new Bv(t);case de.UNDERLINE:return new Mw(t);case de.SQUIGGLY:return new Nw(t);case de.STRIKEOUT:return new Ow(t);case de.STAMP:return new Fv(t);case de.FILEATTACHMENT:return new kw(t);default:return new le(t)}}}class le{#t=null;#e=!1;#n=null;constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:a=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),a&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return le._hasPopupData(this.data)}get hasCommentButton(){return this.enableComment&&this._isEditable&&this.hasPopupElement}get commentButtonPosition(){const{quadPoints:t,rect:e}=this.data;let n=-1/0,a=-1/0;if(t?.length>=8){for(let o=0;o<t.length;o+=8)t[o+1]>a?(a=t[o+1],n=t[o+2]):t[o+1]===a&&(n=Math.max(n,t[o+2]));return[n,a]}return e?[e[2],e[3]]:null}get commentButtonColor(){if(!this.data.color)return null;const[t,e,n]=this.data.color,o=255*(1-(this.data.opacity??1));return this.#i(Math.min(t+o,255),Math.min(e+o,255),Math.min(n+o,255))}#i(t,e,n){t/=255,e/=255,n/=255;const a=Math.max(t,e,n),o=Math.min(t,e,n),c=(a+o)/2,h=((1+Math.sqrt(c))/2*100).toFixed(2);if(a===o)return`hsl(0, 0%, ${h}%)`;const d=a-o;let f;a===t?f=(e-n)/d+(e<n?6:0):a===e?f=(n-t)/d+2:f=(t-e)/d+4,f=(f*60).toFixed(2);const g=(d/(1-Math.abs(2*c-1))*100).toFixed(2);return`hsl(${f}, ${g}%, ${h}%)`}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:c}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-o)/n,t[1]=100*(t[1]-c)/a,t}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#a(e);let a=this.#n?.popup||this.popup;!a&&n?.text&&(this._createPopup(n),a=this.#n.popup),a&&(a.updateEdited(t),n?.deleted&&(a.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#t&&(this.#a(this.#t.rect),this.#n?.popup.resetEdited(),this.#t=null)}#a(t){const{container:{style:e},data:{rect:n,rotation:a},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:c,pageX:h,pageY:d}}}}=this;n?.splice(0,4,...t),e.left=`${100*(t[0]-h)/o}%`,e.top=`${100*(c-t[3]+d)/c}%`,a===0?(e.width=`${100*(t[2]-t[0])/o}%`,e.height=`${100*(t[3]-t[1])/c}%`):this.setRotation(a)}_createContainer(t){const{data:e,parent:{page:n,viewport:a}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",e.id),!(this instanceof Fs)&&!(this instanceof Xf)&&(o.tabIndex=0);const{style:c}=o;if(c.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(o.title=e.alternativeText),e.noRotate&&o.classList.add("norotate"),!e.rect||this instanceof of){const{rotation:S}=e;return!e.hasOwnCanvas&&S!==0&&this.setRotation(S,o),o}const{width:h,height:d}=this;if(!t&&e.borderStyle.width>0){c.borderWidth=`${e.borderStyle.width}px`;const S=e.borderStyle.horizontalCornerRadius,C=e.borderStyle.verticalCornerRadius;if(S>0||C>0){const D=`calc(${S}px * var(--total-scale-factor)) / calc(${C}px * var(--total-scale-factor))`;c.borderRadius=D}else if(this instanceof Lv){const D=`calc(${h}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;c.borderRadius=D}switch(e.borderStyle.style){case Na.SOLID:c.borderStyle="solid";break;case Na.DASHED:c.borderStyle="dashed";break;case Na.BEVELED:yt("Unimplemented border style: beveled");break;case Na.INSET:yt("Unimplemented border style: inset");break;case Na.UNDERLINE:c.borderBottomStyle="solid";break}const w=e.borderColor||null;w?(this.#e=!0,c.borderColor=at.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):c.borderWidth=0}const f=at.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:g,pageHeight:_,pageX:y,pageY:b}=a.rawDims;c.left=`${100*(f[0]-y)/g}%`,c.top=`${100*(f[1]-b)/_}%`;const{rotation:A}=e;return e.hasOwnCanvas||A===0?(c.width=`${100*h/g}%`,c.height=`${100*d/_}%`):this.setRotation(A,o),o}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:a}=this.parent.viewport.rawDims;let{width:o,height:c}=this;t%180!==0&&([o,c]=[c,o]),e.style.width=`${100*o/n}%`,e.style.height=`${100*c/a}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,n,a)=>{const o=a.detail[e],c=o[0],h=o.slice(1);a.target.style[n]=rb[`${c}_HTML`](h),this.annotationStorage.setValue(this.data.id,{[n]:rb[`${c}_rgb`](h)})};return Tt(this,"_commonActions",{display:e=>{const{display:n}=e.detail,a=n%2===1;this.container.style.visibility=a?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:a,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const a of Object.keys(e.detail))(t[a]||n[a])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[a,o]of Object.entries(e)){const c=n[a];if(c){const h={detail:{[a]:o},target:t};c(h),delete e[a]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,a,o]=this.data.rect.map(S=>Math.fround(S));if(t.length===8){const[S,C,w,D]=t.subarray(2,6);if(a===S&&o===C&&e===w&&n===D)return}const{style:c}=this.container;let h;if(this.#e){const{borderColor:S,borderWidth:C}=c;c.borderWidth=0,h=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${S}" stroke-width="${C}">`],this.container.classList.add("hasBorder")}const d=a-e,f=o-n,{svgFactory:g}=this,_=g.createElement("svg");_.classList.add("quadrilateralsContainer"),_.setAttribute("width",0),_.setAttribute("height",0),_.role="none";const y=g.createElement("defs");_.append(y);const b=g.createElement("clipPath"),A=`clippath_${this.data.id}`;b.setAttribute("id",A),b.setAttribute("clipPathUnits","objectBoundingBox"),y.append(b);for(let S=2,C=t.length;S<C;S+=8){const w=t[S],D=t[S+1],x=t[S+2],k=t[S+3],O=g.createElement("rect"),P=(x-e)/d,j=(o-D)/f,Y=(w-x)/d,K=(D-k)/f;O.setAttribute("x",P),O.setAttribute("y",j),O.setAttribute("width",Y),O.setAttribute("height",K),b.append(O),h?.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${j}" width="${Y}" height="${K}"/>`)}this.#e&&(h.push("</g></svg>')"),c.backgroundImage=h.join("")),this.container.append(_),this.container.style.clipPath=`url(#${A})`}_createPopup(t=null){const{data:e}=this;let n,a;t?(n={str:t.text},a=t.date):(n=e.contentsObj,a=e.modificationDate);const o=this.#n=new of({data:{color:e.color,titleObj:e.titleObj,modificationDate:a,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(o.render())}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}render(){Vt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const a=this._fieldObjects[t];if(a)for(const{page:o,id:c,exportValues:h}of a){if(o===-1||c===e)continue;const d=typeof h=="string"?h:null,f=document.querySelector(`[data-element-id="${c}"]`);if(f&&!Os.has(f)){yt(`_getElementsByName - element not allowed: ${c}`);continue}n.push({id:c,exportValue:d,domElement:f})}return n}for(const a of document.getElementsByName(t)){const{exportValue:o}=a,c=a.getAttribute("data-element-id");c!==e&&Os.has(a)&&n.push({id:c,exportValue:o,domElement:a})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Xf extends le{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let a=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),a=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),a=!0):t.attachment?(this.#e(n,t.attachment,t.overlaidText,t.attachmentDest),a=!0):t.setOCGState?(this.#n(n,t.setOCGState,t.overlaidText),a=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),a=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),a=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),a=!0):this.isTooltipOnly&&!a&&(this._bindLink(n,""),a=!0)),this.container.classList.add("linkAnnotation"),a&&this.container.append(n),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,n=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),n&&(t.title=n)}_bindNamedAction(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#t()}#e(t,e,n="",a=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,a),!1),this.#t()}#n(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const a of Object.keys(e.actions)){const o=n.get(a);o&&(t[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:a}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){yt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(t.onclick=()=>!1);return}t.onclick=()=>{n?.();const{fields:a,refs:o,include:c}=e,h=[];if(a.length!==0||o.length!==0){const g=new Set(o);for(const _ of a){const y=this._fieldObjects[_]||[];for(const{id:b}of y)g.add(b)}for(const _ of Object.values(this._fieldObjects))for(const y of _)g.has(y.id)===c&&h.push(y)}else for(const g of Object.values(this._fieldObjects))h.push(...g);const d=this.annotationStorage,f=[];for(const g of h){const{id:_}=g;switch(f.push(_),g.type){case"text":{const b=g.defaultValue||"";d.setValue(_,{value:b});break}case"checkbox":case"radiobutton":{const b=g.defaultValue===g.exportValues;d.setValue(_,{value:b});break}case"combobox":case"listbox":{const b=g.defaultValue||"";d.setValue(_,{value:b});break}default:continue}const y=document.querySelector(`[data-element-id="${_}"]`);if(y){if(!Os.has(y)){yt(`_bindResetFormAction - element not allowed: ${_}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class yw extends le{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Fs extends le{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return ke.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,a,o){n.includes("mouse")?t.addEventListener(n,c=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:a,value:o(c),shift:c.shiftKey,modifier:this._getKeyModifier(c)}})}):t.addEventListener(n,c=>{if(n==="blur"){if(!e.focused||!c.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}o&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:a,value:o(c)}})})}_setEventListeners(t,e,n,a){for(const[o,c]of n)(c==="Action"||this.data.actions?.[c])&&((c==="Focus"||c==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,o,c,a),c==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":at.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,a=this.data.defaultAppearanceData.fontSize||mw,o=t.style;let c;const h=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h),g=Math.round(f/(Od*a))||1,_=f/g;c=Math.min(a,d(_/Od))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h);c=Math.min(a,d(f/Od))}o.fontSize=`calc(${c}px * var(--total-scale-factor))`,o.color=at.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class bw extends Fs{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,a){const o=this.annotationStorage;for(const c of this._getElementsByName(t.name,t.id))c.domElement&&(c.domElement[e]=n),o.setValue(c.id,{[a]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const a=t.getValue(e,{value:this.data.fieldValue});let o=a.value||"";const c=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;c&&o.length>c&&(o=o.slice(0,c));let h=a.formattedValue||this.data.textContent?.join(`
`)||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=h??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",h??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Os.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:f,datetimeType:g,timeStep:_}=this.data,y=!!g&&this.enableScripting;f&&(n.title=f),this._setRequired(n,this.data.required),c&&(n.maxLength=c),n.addEventListener("input",A=>{t.setValue(e,{value:A.target.value}),this.setPropertyOnSiblings(n,"value",A.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",A=>{const S=this.data.defaultFieldValue??"";n.value=d.userValue=S,d.formattedValue=null});let b=A=>{const{formattedValue:S}=d;S!=null&&(A.target.value=S),A.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",S=>{if(d.focused)return;const{target:C}=S;if(y&&(C.type=g,_&&(C.step=_)),d.userValue){const w=d.userValue;if(y)if(g==="time"){const D=new Date(w),x=[D.getHours(),D.getMinutes(),D.getSeconds()];C.value=x.map(k=>k.toString().padStart(2,"0")).join(":")}else C.value=new Date(w-_w).toISOString().split(g==="date"?"T":".",1)[0];else C.value=w}d.lastCommittedValue=C.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",S=>{this.showElementAndHideCanvas(S.target);const C={value(w){d.userValue=w.detail.value??"",y||t.setValue(e,{value:d.userValue.toString()}),w.target.value=d.userValue},formattedValue(w){const{formattedValue:D}=w.detail;d.formattedValue=D,D!=null&&w.target!==document.activeElement&&(w.target.value=D);const x={formattedValue:D};y&&(x.value=D),t.setValue(e,x)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{const{charLimit:D}=w.detail,{target:x}=w;if(D===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",D);let k=d.userValue;!k||k.length<=D||(k=k.slice(0,D),x.value=d.userValue=k,t.setValue(e,{value:k}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:k,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(C,S)}),n.addEventListener("keydown",S=>{d.commitKey=1;let C=-1;if(S.key==="Escape"?C=0:S.key==="Enter"&&!this.data.multiLine?C=2:S.key==="Tab"&&(d.commitKey=3),C===-1)return;const{value:w}=S.target;d.lastCommittedValue!==w&&(d.lastCommittedValue=w,d.userValue=w,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:C,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}}))});const A=b;b=null,n.addEventListener("blur",S=>{if(!d.focused||!S.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:C}=S;let{value:w}=C;if(y){if(w&&g==="time"){const D=w.split(":").map(x=>parseInt(x,10));w=new Date(2e3,0,1,D[0],D[1],D[2]||0).valueOf(),C.step=""}else w=new Date(w).valueOf();C.type="text"}d.userValue=w,d.lastCommittedValue!==w&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:d.commitKey,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}}),A(S)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",S=>{d.lastCommittedValue=null;const{data:C,target:w}=S,{value:D,selectionStart:x,selectionEnd:k}=w;let O=x,P=k;switch(S.inputType){case"deleteWordBackward":{const j=D.substring(0,x).match(/\w*[^\w]*$/);j&&(O-=j[0].length);break}case"deleteWordForward":{const j=D.substring(x).match(/^[^\w]*\w*/);j&&(P+=j[0].length);break}case"deleteContentBackward":x===k&&(O-=1);break;case"deleteContentForward":x===k&&(P+=1);break}S.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:D,change:C||"",willCommit:!1,selStart:O,selEnd:P}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],S=>S.target.value)}if(b&&n.addEventListener("blur",b),this.data.comb){const S=(this.data.rect[2]-this.data.rect[0])/c;n.classList.add("comb"),n.style.letterSpacing=`calc(${S}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class vw extends Fs{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Aw extends Fs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let a=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof a=="string"&&(a=a!=="Off",t.setValue(n,{value:a})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return Os.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=e.fieldName,a&&o.setAttribute("checked",!0),o.setAttribute("exportValue",e.exportValue),o.tabIndex=0,o.addEventListener("change",c=>{const{name:h,checked:d}=c.target;for(const f of this._getElementsByName(h,n)){const g=d&&f.exportValue===e.exportValue;f.domElement&&(f.domElement.checked=g),t.setValue(f.id,{value:g})}t.setValue(n,{value:d})}),o.addEventListener("resetform",c=>{const h=e.defaultFieldValue||"Off";c.target.checked=h===e.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",c=>{const h={value(d){d.target.checked=d.detail.value!=="Off",t.setValue(n,{value:d.target.checked})}};this._dispatchEventFromSandbox(h,c)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class Lv extends Fs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let a=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof a=="string"&&(a=a!==e.buttonValue,t.setValue(n,{value:a})),a)for(const c of this._getElementsByName(e.fieldName,n))t.setValue(c.id,{value:!1});const o=document.createElement("input");if(Os.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=e.fieldName,a&&o.setAttribute("checked",!0),o.tabIndex=0,o.addEventListener("change",c=>{const{name:h,checked:d}=c.target;for(const f of this._getElementsByName(h,n))t.setValue(f.id,{value:!1});t.setValue(n,{value:d})}),o.addEventListener("resetform",c=>{const h=e.defaultFieldValue;c.target.checked=h!=null&&h===e.buttonValue}),this.enableScripting&&this.hasJSActions){const c=e.buttonValue;o.addEventListener("updatefromsandbox",h=>{const d={value:f=>{const g=c===f.detail.value;for(const _ of this._getElementsByName(f.target.name)){const y=g&&_.id===n;_.domElement&&(_.domElement.checked=y),t.setValue(_.id,{value:y})}}};this._dispatchEventFromSandbox(d,h)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class Sw extends Xf{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}}class Ew extends Fs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),a=document.createElement("select");Os.add(a),a.setAttribute("data-element-id",e),a.disabled=this.data.readOnly,this._setRequired(a,this.data.required),a.name=this.data.fieldName,a.tabIndex=0;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(a.size=this.data.options.length,this.data.multiSelect&&(a.multiple=!0)),a.addEventListener("resetform",g=>{const _=this.data.defaultFieldValue;for(const y of a.options)y.selected=y.value===_});for(const g of this.data.options){const _=document.createElement("option");_.textContent=g.displayValue,_.value=g.exportValue,n.value.includes(g.exportValue)&&(_.setAttribute("selected",!0),o=!1),a.append(_)}let c=null;if(o){const g=document.createElement("option");g.value=" ",g.setAttribute("hidden",!0),g.setAttribute("selected",!0),a.prepend(g),c=()=>{g.remove(),a.removeEventListener("input",c),c=null},a.addEventListener("input",c)}const h=g=>{const _=g?"value":"textContent",{options:y,multiple:b}=a;return b?Array.prototype.filter.call(y,A=>A.selected).map(A=>A[_]):y.selectedIndex===-1?null:y[y.selectedIndex][_]};let d=h(!1);const f=g=>{const _=g.target.options;return Array.prototype.map.call(_,y=>({displayValue:y.textContent,exportValue:y.value}))};return this.enableScripting&&this.hasJSActions?(a.addEventListener("updatefromsandbox",g=>{const _={value(y){c?.();const b=y.detail.value,A=new Set(Array.isArray(b)?b:[b]);for(const S of a.options)S.selected=A.has(S.value);t.setValue(e,{value:h(!0)}),d=h(!1)},multipleSelection(y){a.multiple=!0},remove(y){const b=a.options,A=y.detail.remove;b[A].selected=!1,a.remove(A),b.length>0&&Array.prototype.findIndex.call(b,C=>C.selected)===-1&&(b[0].selected=!0),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},clear(y){for(;a.length!==0;)a.remove(0);t.setValue(e,{value:null,items:[]}),d=h(!1)},insert(y){const{index:b,displayValue:A,exportValue:S}=y.detail.insert,C=a.children[b],w=document.createElement("option");w.textContent=A,w.value=S,C?C.before(w):a.append(w),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},items(y){const{items:b}=y.detail;for(;a.length!==0;)a.remove(0);for(const A of b){const{displayValue:S,exportValue:C}=A,w=document.createElement("option");w.textContent=S,w.value=C,a.append(w)}a.options.length>0&&(a.options[0].selected=!0),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},indices(y){const b=new Set(y.detail.indices);for(const A of y.target.options)A.selected=b.has(A.index);t.setValue(e,{value:h(!0)}),d=h(!1)},editable(y){y.target.disabled=!y.detail.editable}};this._dispatchEventFromSandbox(_,g)}),a.addEventListener("input",g=>{const _=h(!0),y=h(!1);t.setValue(e,{value:_}),g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:d,change:y,changeEx:_,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(a,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],g=>g.target.value)):a.addEventListener("input",function(g){t.setValue(e,{value:h(!0)})}),this.data.combo&&this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class of extends le{constructor(t){const{data:e,elements:n}=t;super(t,{isRenderable:le._hasPopupData(e)}),this.elements=n,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new ww({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,eventBus:this.linkService.eventBus}),n=[];for(const a of this.elements)a.popup=e,a.container.ariaHasPopup="dialog",n.push(a.data.id),a.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(a=>`${Bf}${a}`).join(",")),this.container}}class ww{#t=this.#L.bind(this);#e=this.#C.bind(this);#n=this.#H.bind(this);#i=this.#N.bind(this);#a=null;#s=null;#r=null;#o=null;#l=null;#c=null;#d=null;#u=null;#f=!1;#g=null;#p=null;#h=null;#m=null;#b=null;#_=null;#A=null;#S=null;#y=null;#E=null;#R=!1;constructor({container:t,color:e,elements:n,titleObj:a,modificationDate:o,contentsObj:c,richText:h,parent:d,rect:f,parentRect:g,open:_,eventBus:y=null}){this.#s=t,this.#y=a,this.#r=c,this.#S=h,this.#d=d,this.#a=e,this.#A=f,this.#u=g,this.#l=n,this.#c=y,this.#o=ef.toDateObject(o),this.trigger=n.flatMap(b=>b.getElementsToTriggerPopup()),this.#T(),this.#s.hidden=!0,_&&this.#N()}#T(){if(this.#p)return;this.#p=new AbortController;const{signal:t}=this.#p;for(const e of this.trigger)e.addEventListener("click",this.#i,{signal:t}),e.addEventListener("mouseenter",this.#n,{signal:t}),e.addEventListener("mouseleave",this.#e,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#t,{signal:t});this.#O()}#w(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition),this.#_=t.commentButtonColor)}#O(){if(this.#m||(this.#b||this.#w(),!this.#b))return;const t=this.#m=document.createElement("button");t.className="annotationCommentButton";const e=this.#l[0].container;t.style.zIndex=e.style.zIndex+1,t.tabIndex=0;const{signal:n}=this.#p;t.addEventListener("hover",this.#i,{signal:n}),t.addEventListener("keydown",this.#t,{signal:n}),t.addEventListener("click",()=>{const[{data:{id:o},annotationEditorType:c}]=this.#l;this.#c?.dispatch("switchannotationeditormode",{source:this,editId:o,mode:c,editComment:!0})},{signal:n});const{style:a}=t;a.left=`calc(${this.#b[0]}%)`,a.top=`calc(${this.#b[1]}% - var(--comment-button-dim))`,this.#_&&(a.backgroundColor=this.#_),e.after(t)}render(){if(this.#g)return;const t=this.#g=document.createElement("div");if(t.className="popup",this.#a){const a=t.style.outlineColor=at.makeHexColor(...this.#a);t.style.backgroundColor=`color-mix(in srgb, ${a} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#y?.str){const a=document.createElement("span");a.className="title",e.append(a),{dir:a.dir,str:a.textContent}=this.#y}if(t.append(e),this.#o){const a=document.createElement("time");a.className="popupDate",a.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),a.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),a.dateTime=this.#o.toISOString(),e.append(a)}const n=this.#x;if(n)kv.render({xfaHtml:n,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const a=this._formatContents(this.#r);t.append(a)}this.#s.append(t)}get#x(){const t=this.#S,e=this.#r;return t?.str&&(!e?.str||e.str===t.str)&&this.#S.html||null}get#D(){return this.#x?.attributes?.style?.fontSize||0}get#I(){return this.#x?.attributes?.style?.color||null}#k(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},a={style:{color:this.#I,fontSize:this.#D?`calc(${this.#D}px * var(--total-scale-factor))`:""}};for(const o of t.split(`
`))e.push({name:"span",value:o,attributes:a});return n}_formatContents({str:t,dir:e}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=e;const a=t.split(/(?:\r\n?|\n)/);for(let o=0,c=a.length;o<c;++o){const h=a[o];n.append(document.createTextNode(h)),o<c-1&&n.append(document.createElement("br"))}return n}#L(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#N()}updateEdited({rect:t,popup:e,deleted:n}){if(n||e?.deleted){this.remove();return}this.#T(),this.#E||={contentsObj:this.#r,richText:this.#S},t&&(this.#h=null),e&&(this.#S=this.#k(e.text),this.#o=ef.toDateObject(e.date),this.#r=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#E&&({contentsObj:this.#r,richText:this.#S}=this.#E,this.#E=null,this.#g?.remove(),this.#g=null,this.#h=null)}remove(){this.#p?.abort(),this.#p=null,this.#g?.remove(),this.#g=null,this.#R=!1,this.#f=!1;for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#P(){if(this.#h!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:a,pageY:o}}}=this.#d;let c=!!this.#u,h=c?this.#u:this.#A;for(const A of this.#l)if(!h||at.intersect(A.data.rect,h)!==null){h=A.data.rect,c=!0;break}const d=at.normalizeRect([h[0],t[3]-h[1]+t[1],h[2],t[3]-h[3]+t[1]]),g=c?h[2]-h[0]+5:0,_=d[0]+g,y=d[1];this.#h=[100*(_-a)/e,100*(y-o)/n];const{style:b}=this.#s;b.left=`${this.#h[0]}%`,b.top=`${this.#h[1]}%`}#N(){this.#f=!this.#f,this.#f?(this.#H(),this.#s.addEventListener("click",this.#i),this.#s.addEventListener("keydown",this.#t)):(this.#C(),this.#s.removeEventListener("click",this.#i),this.#s.removeEventListener("keydown",this.#t))}#H(){this.#g||this.render(),this.isVisible?this.#f&&this.#s.classList.add("focused"):(this.#P(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#C(){this.#s.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#R=this.isVisible,this.#R&&(this.#s.hidden=!0)}maybeShow(){this.#T(),this.#R&&(this.#g||this.#H(),this.#R=!1,this.#s.hidden=!1)}get isVisible(){return this.#s.hidden===!1}}class Iv extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=mt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Cw extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,a=this.svgFactory.create(e,n,!0),o=this.#t=this.svgFactory.createElement("svg:line");return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),a.append(o),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Tw extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,a=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,c=this.#t=this.svgFactory.createElement("svg:rect");return c.setAttribute("x",o/2),c.setAttribute("y",o/2),c.setAttribute("width",e-o),c.setAttribute("height",n-o),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class xw extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,a=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,c=this.#t=this.svgFactory.createElement("svg:ellipse");return c.setAttribute("cx",e/2),c.setAttribute("cy",n/2),c.setAttribute("rx",e/2-o/2),c.setAttribute("ry",n/2-o/2),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Pv extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:a},width:o,height:c}=this;if(!e)return this.container;const h=this.svgFactory.create(o,c,!0);let d=[];for(let g=0,_=e.length;g<_;g+=2){const y=e[g]-t[0],b=t[3]-e[g+1];d.push(`${y},${b}`)}d=d.join(" ");const f=this.#t=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",d),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),h.append(f),this.container.append(h),!a&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Rw extends Pv{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Dw extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class $f extends le{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?mt.HIGHLIGHT:mt.INK}#n(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:a,popupRef:o}}=this,{transform:c,width:h,height:d}=this.#n(e,t),f=this.svgFactory.create(h,d,!0),g=this.#t=this.svgFactory.createElement("svg:g");f.append(g),g.setAttribute("stroke-width",a.width||1),g.setAttribute("stroke-linecap","round"),g.setAttribute("stroke-linejoin","round"),g.setAttribute("stroke-miterlimit",10),g.setAttribute("stroke","transparent"),g.setAttribute("fill","transparent"),g.setAttribute("transform",c);for(let _=0,y=n.length;_<y;_++){const b=this.svgFactory.createElement(this.svgElementName);this.#e.push(b),b.setAttribute("points",n[_].join(",")),g.append(b)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:a}=t,o=this.#t;if(e>=0&&o.setAttribute("stroke-width",e||1),n)for(let c=0,h=this.#e.length;c<h;c++)this.#e[c].setAttribute("points",n[c].join(","));if(a){const{transform:c,width:h,height:d}=this.#n(this.data.rotation,a);o.parentElement.setAttribute("viewBox",`0 0 ${h} ${d}`),o.setAttribute("transform",c)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}get commentButtonPosition(){const{inkLists:t,rect:e}=this.data;if(t?.length>=1){let n=-1/0,a=-1/0;for(const o of t)for(let c=0,h=o.length;c<h;c+=2)o[c+1]>a?(a=o[c+1],n=o[c]):o[c+1]===a&&(n=Math.max(n,o[c]));if(n!==1/0)return[n,a]}return e?[e[2],e[3]]:null}}class Bv extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=mt.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Mw extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Nw extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Ow extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Fv extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=mt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class kw extends le{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||e.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#e.bind(this)),this.#t=n;const{isMac:a}=ke.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(a?o.metaKey:o.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Wf{#t=null;#e=null;#n=new Map;#i=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:a,page:o,viewport:c,structTreeLayer:h}){this.div=t,this.#t=e,this.#e=n,this.#i=h||null,this.page=o,this.viewport=c,this.zIndex=0,this._annotationEditorUIManager=a}hasEditableAnnotations(){return this.#n.size>0}async#a(t,e,n){const a=t.firstChild||t,o=a.id=`${Bf}${e}`,c=await this.#i?.getAriaAttributes(o);if(c)for(const[h,d]of c)a.setAttribute(h,d);n?n.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,a,!1))}async render(t){const{annotations:e}=t,n=this.div;Ns(n,this.viewport);const a=new Map,o={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new xc,annotationStorage:t.annotationStorage||new jf,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const c of e){if(c.noHTML)continue;const h=c.annotationType===de.POPUP;if(h){const g=a.get(c.id);if(!g)continue;o.elements=g}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;o.data=c;const d=ob.create(o);if(!d.isRenderable)continue;if(!h&&c.popupRef){const g=a.get(c.popupRef);g?g.push(d):a.set(c.popupRef,[d])}const f=d.render();c.hidden&&(f.style.visibility="hidden"),await this.#a(f,c.id,o.elements),d._isEditable&&(this.#n.set(d.data.id,d),this._annotationEditorUIManager?.renderAnnotationElement(d))}this.#s()}async addLinkAnnotations(t,e){const n={data:null,layer:this.div,linkService:e,svgFactory:new xc,parent:this};for(const a of t){a.borderStyle||=Wf._defaultBorderStyle,n.data=a;const o=ob.create(n);if(!o.isRenderable)continue;const c=o.render();await this.#a(c,a.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,Ns(e,{rotation:t.rotation}),this.#s(),e.hidden=!1}#s(){if(!this.#e)return;const t=this.div;for(const[e,n]of this.#e){const a=t.querySelector(`[data-annotation-id="${e}"]`);if(!a)continue;n.className="annotationContent";const{firstChild:o}=a;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):a.append(n);const c=this.#n.get(e);c&&(c._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,a.id,n),c._hasNoCanvas=!1):c.canvas=n)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(t){return this.#n.get(t)}static get _defaultBorderStyle(){return Tt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Na.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const gc=/\r\n?|\n/g;class Se extends ct{#t;#e="";#n=`${this.id}-editor`;#i=null;#a;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Se.prototype,e=o=>o.isEmpty(),n=Ji.TRANSLATE_SMALL,a=Ji.TRANSLATE_BIG;return Tt(this,"_keyboardManager",new zo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-a,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[a,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-a],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,a],checker:e}]]))}static _type="freetext";static _editorType=mt.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#t=t.color||Se._defaultColor||ct._defaultLineColor,this.#a=t.fontSize||Se._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){ct.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case Ot.FREETEXT_SIZE:Se._defaultFontSize=e;break;case Ot.FREETEXT_COLOR:Se._defaultColor=e;break}}updateParams(t,e){switch(t){case Ot.FREETEXT_SIZE:this.#s(e);break;case Ot.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[Ot.FREETEXT_SIZE,Se._defaultFontSize],[Ot.FREETEXT_COLOR,Se._defaultColor||ct._defaultLineColor]]}get propertiesToUpdate(){return[[Ot.FREETEXT_SIZE,this.#a],[Ot.FREETEXT_COLOR,this.#t]]}get toolbarButtons(){return this._colorPicker||=new Co(this),[["colorPicker",this._colorPicker]]}get colorType(){return Ot.FREETEXT_COLOR}get colorValue(){return this.#t}#s(t){const e=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--total-scale-factor))`,this.translate(0,-(a-this.#a)*this.parentScale),this.#a=a,this.#l()},n=this.#a;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#r(t){const e=a=>{this.#t=this.editorDiv.style.color=a,this._colorPicker?.update(a)},n=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Se._internalPadding*t,-(Se._internalPadding+this.#a)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(Se.#c(n)),e=n);return t.join(`
`)}#l(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:a,div:o}=this,c=o.style.display,h=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",a.div.append(this.div),n=o.getBoundingClientRect(),o.remove(),o.style.display=c,o.classList.toggle("hidden",h)}this.rotation%180===this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;const n=a=>{if(this.#e=a,!a){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#l()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#l()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Se._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#a}px * var(--total-scale-factor))`,n.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[a,o]=this.parentDimensions;if(this.annotationElementId){const{position:c}=this._initialData;let[h,d]=this.getInitialTranslation();[h,d]=this.pageTranslationToScreen(h,d);const[f,g]=this.pageDimensions,[_,y]=this.pageTranslation;let b,A;switch(this.rotation){case 0:b=t+(c[0]-_)/f,A=e+this.height-(c[1]-y)/g;break;case 90:b=t+(c[0]-_)/f,A=e-(c[1]-y)/g,[h,d]=[d,-h];break;case 180:b=t-this.width+(c[0]-_)/f,A=e-(c[1]-y)/g,[h,d]=[-h,-d];break;case 270:b=t+(c[0]-_-this.height*g)/f,A=e+(c[1]-y-this.width*f)/g,[h,d]=[-d,h];break}this.setAt(b*a,A*o,h,d)}else this._moveAfterPaste(t,e);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(gc,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(n.length===1&&n[0]==="text/plain")return;t.preventDefault();const a=Se.#f(e.getData("text")||"").replaceAll(gc,`
`);if(!a)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const c=o.getRangeAt(0);if(!a.includes(`
`)){c.insertNode(document.createTextNode(a)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:h,startOffset:d}=c,f=[],g=[];if(h.nodeType===Node.TEXT_NODE){const b=h.parentElement;if(g.push(h.nodeValue.slice(d).replaceAll(gc,"")),b!==this.editorDiv){let A=f;for(const S of this.editorDiv.childNodes){if(S===b){A=g;continue}A.push(Se.#c(S))}}f.push(h.nodeValue.slice(0,d).replaceAll(gc,""))}else if(h===this.editorDiv){let b=f,A=0;for(const S of this.editorDiv.childNodes)A++===d&&(b=g),b.push(Se.#c(S))}this.#e=`${f.join(`
`)}${a}${g.join(`
`)}`,this.#d();const _=new Range;let y=Math.sumPrecise(f.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const A=b.nodeValue.length;if(y<=A){_.setStart(b,y),_.setEnd(b,y);break}y-=A}o.removeAllRanges(),o.addRange(_)}#d(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const t of this.#e.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#e.replaceAll(" "," ")}static#f(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Se._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,n){let a=null;if(t instanceof Iv){const{data:{defaultAppearanceData:{fontSize:c,fontColor:h},rect:d,rotation:f,id:g,popupRef:_,contentsObj:y},textContent:b,textPosition:A,parent:{page:{pageNumber:S}}}=t;if(!b||b.length===0)return null;a=t={annotationType:mt.FREETEXT,color:Array.from(h),fontSize:c,value:b.join(`
`),position:A,pageIndex:S-1,rect:d.slice(0),rotation:f,annotationElementId:g,id:g,deleted:!1,popupRef:_,comment:y?.str||null}}const o=await super.deserialize(t,e,n);return o.#a=t.fontSize,o.#t=at.makeHexColor(...t.color),o.#e=Se.#f(t.value),o._initialData=a,t.comment&&o.setCommentData(t.comment),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),n=ct._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),a={annotationType:mt.FREETEXT,color:n,fontSize:this.#a,value:this.#u(),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#g(a)?null:(a.id=this.annotationElementId,a)}#g(t){const{value:e,fontSize:n,color:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((c,h)=>c!==a[h])||t.pageIndex!==o}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:n}=e;n.fontSize=`calc(${this.#a}px * var(--total-scale-factor))`,n.color=this.#t,e.replaceChildren();for(const o of this.#e.split(`
`)){const c=document.createElement("div");c.append(o?document.createTextNode(o):document.createElement("br")),e.append(c)}const a={rect:this.getPDFRect()};return a.popup=this.hasEditedComment?this.comment:{text:this.#e},t.updateEdited(a),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class nt{static PRECISION=1e-4;toSVGPath(){Vt("Abstract method `toSVGPath` must be implemented.")}get box(){Vt("Abstract getter `box` must be implemented.")}serialize(t,e){Vt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,a,o,c){c||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)c[h]=e+t[h]*a,c[h+1]=n+t[h+1]*o;return c}static _rescaleAndSwap(t,e,n,a,o,c){c||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)c[h]=e+t[h+1]*a,c[h+1]=n+t[h]*o;return c}static _translate(t,e,n,a){a||=new Float32Array(t.length);for(let o=0,c=t.length;o<c;o+=2)a[o]=e+t[o],a[o+1]=n+t[o+1];return a}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,a,o){switch(o){case 90:return[1-e/n,t/a];case 180:return[1-t/n,1-e/a];case 270:return[e/n,1-t/a];default:return[t/n,e/a]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,a,o,c){return[(t+5*n)/6,(e+5*a)/6,(5*n+o)/6,(5*a+c)/6,(n+o)/2,(a+c)/2]}}class ws{#t;#e=[];#n;#i;#a=[];#s=new Float32Array(18);#r;#o;#l;#c;#d;#u;#f=[];static#g=8;static#p=2;static#h=ws.#g+ws.#p;constructor({x:t,y:e},n,a,o,c,h=0){this.#t=n,this.#u=o*a,this.#i=c,this.#s.set([NaN,NaN,NaN,NaN,t,e],6),this.#n=h,this.#c=ws.#g*a,this.#l=ws.#h*a,this.#d=a,this.#f.push(t,e)}isEmpty(){return isNaN(this.#s[8])}#m(){const t=this.#s.subarray(4,6),e=this.#s.subarray(16,18),[n,a,o,c]=this.#t;return[(this.#r+(t[0]-e[0])/2-n)/o,(this.#o+(t[1]-e[1])/2-a)/c,(this.#r+(e[0]-t[0])/2-n)/o,(this.#o+(e[1]-t[1])/2-a)/c]}add({x:t,y:e}){this.#r=t,this.#o=e;const[n,a,o,c]=this.#t;let[h,d,f,g]=this.#s.subarray(8,12);const _=t-f,y=e-g,b=Math.hypot(_,y);if(b<this.#l)return!1;const A=b-this.#c,S=A/b,C=S*_,w=S*y;let D=h,x=d;h=f,d=g,f+=C,g+=w,this.#f?.push(t,e);const k=-w/A,O=C/A,P=k*this.#u,j=O*this.#u;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([f+P,g+j],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([f-P,g-j],16),isNaN(this.#s[6])?(this.#a.length===0&&(this.#s.set([h+P,d+j],2),this.#a.push(NaN,NaN,NaN,NaN,(h+P-n)/o,(d+j-a)/c),this.#s.set([h-P,d-j],14),this.#e.push(NaN,NaN,NaN,NaN,(h-P-n)/o,(d-j-a)/c)),this.#s.set([D,x,h,d,f,g],6),!this.isEmpty()):(this.#s.set([D,x,h,d,f,g],6),Math.abs(Math.atan2(x-d,D-h)-Math.atan2(w,C))<Math.PI/2?([h,d,f,g]=this.#s.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((h+f)/2-n)/o,((d+g)/2-a)/c),[h,d,D,x]=this.#s.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((D+h)/2-n)/o,((x+d)/2-a)/c),!0):([D,x,h,d,f,g]=this.#s.subarray(0,6),this.#a.push(((D+5*h)/6-n)/o,((x+5*d)/6-a)/c,((5*h+f)/6-n)/o,((5*d+g)/6-a)/c,((h+f)/2-n)/o,((d+g)/2-a)/c),[f,g,h,d,D,x]=this.#s.subarray(12,18),this.#e.push(((D+5*h)/6-n)/o,((x+5*d)/6-a)/c,((5*h+f)/6-n)/o,((5*d+g)/6-a)/c,((h+f)/2-n)/o,((d+g)/2-a)/c),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#b();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let a=6;a<t.length;a+=6)isNaN(t[a])?n.push(`L${t[a+4]} ${t[a+5]}`):n.push(`C${t[a]} ${t[a+1]} ${t[a+2]} ${t[a+3]} ${t[a+4]} ${t[a+5]}`);this.#A(n);for(let a=e.length-6;a>=6;a-=6)isNaN(e[a])?n.push(`L${e[a+4]} ${e[a+5]}`):n.push(`C${e[a]} ${e[a+1]} ${e[a+2]} ${e[a+3]} ${e[a+4]} ${e[a+5]}`);return this.#_(n),n.join(" ")}#b(){const[t,e,n,a]=this.#t,[o,c,h,d]=this.#m();return`M${(this.#s[2]-t)/n} ${(this.#s[3]-e)/a} L${(this.#s[4]-t)/n} ${(this.#s[5]-e)/a} L${o} ${c} L${h} ${d} L${(this.#s[16]-t)/n} ${(this.#s[17]-e)/a} L${(this.#s[14]-t)/n} ${(this.#s[15]-e)/a} Z`}#_(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#A(t){const[e,n,a,o]=this.#t,c=this.#s.subarray(4,6),h=this.#s.subarray(16,18),[d,f,g,_]=this.#m();t.push(`L${(c[0]-e)/a} ${(c[1]-n)/o} L${d} ${f} L${g} ${_} L${(h[0]-e)/a} ${(h[1]-n)/o}`)}newFreeDrawOutline(t,e,n,a,o,c){return new Hv(t,e,n,a,o,c)}getOutlines(){const t=this.#a,e=this.#e,n=this.#s,[a,o,c,h]=this.#t,d=new Float32Array((this.#f?.length??0)+2);for(let _=0,y=d.length-2;_<y;_+=2)d[_]=(this.#f[_]-a)/c,d[_+1]=(this.#f[_+1]-o)/h;if(d[d.length-2]=(this.#r-a)/c,d[d.length-1]=(this.#o-o)/h,isNaN(n[6])&&!this.isEmpty())return this.#S(d);const f=new Float32Array(this.#a.length+24+this.#e.length);let g=t.length;for(let _=0;_<g;_+=2){if(isNaN(t[_])){f[_]=f[_+1]=NaN;continue}f[_]=t[_],f[_+1]=t[_+1]}g=this.#E(f,g);for(let _=e.length-6;_>=6;_-=6)for(let y=0;y<6;y+=2){if(isNaN(e[_+y])){f[g]=f[g+1]=NaN,g+=2;continue}f[g]=e[_+y],f[g+1]=e[_+y+1],g+=2}return this.#y(f,g),this.newFreeDrawOutline(f,d,this.#t,this.#d,this.#n,this.#i)}#S(t){const e=this.#s,[n,a,o,c]=this.#t,[h,d,f,g]=this.#m(),_=new Float32Array(36);return _.set([NaN,NaN,NaN,NaN,(e[2]-n)/o,(e[3]-a)/c,NaN,NaN,NaN,NaN,(e[4]-n)/o,(e[5]-a)/c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,f,g,NaN,NaN,NaN,NaN,(e[16]-n)/o,(e[17]-a)/c,NaN,NaN,NaN,NaN,(e[14]-n)/o,(e[15]-a)/c],0),this.newFreeDrawOutline(_,t,this.#t,this.#d,this.#n,this.#i)}#y(t,e){const n=this.#e;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6}#E(t,e){const n=this.#s.subarray(4,6),a=this.#s.subarray(16,18),[o,c,h,d]=this.#t,[f,g,_,y]=this.#m();return t.set([NaN,NaN,NaN,NaN,(n[0]-o)/h,(n[1]-c)/d,NaN,NaN,NaN,NaN,f,g,NaN,NaN,NaN,NaN,_,y,NaN,NaN,NaN,NaN,(a[0]-o)/h,(a[1]-c)/d],e),e+=24}}class Hv extends nt{#t;#e=new Float32Array(4);#n;#i;#a;#s;#r;constructor(t,e,n,a,o,c){super(),this.#r=t,this.#a=e,this.#t=n,this.#s=a,this.#n=o,this.#i=c,this.lastPoint=[NaN,NaN],this.#o(c);const[h,d,f,g]=this.#e;for(let _=0,y=t.length;_<y;_+=2)t[_]=(t[_]-h)/f,t[_+1]=(t[_+1]-d)/g;for(let _=0,y=e.length;_<y;_+=2)e[_]=(e[_]-h)/f,e[_+1]=(e[_+1]-d)/g}toSVGPath(){const t=[`M${this.#r[4]} ${this.#r[5]}`];for(let e=6,n=this.#r.length;e<n;e+=6){if(isNaN(this.#r[e])){t.push(`L${this.#r[e+4]} ${this.#r[e+5]}`);continue}t.push(`C${this.#r[e]} ${this.#r[e+1]} ${this.#r[e+2]} ${this.#r[e+3]} ${this.#r[e+4]} ${this.#r[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,n,a],o){const c=n-t,h=a-e;let d,f;switch(o){case 0:d=nt._rescale(this.#r,t,a,c,-h),f=nt._rescale(this.#a,t,a,c,-h);break;case 90:d=nt._rescaleAndSwap(this.#r,t,e,c,h),f=nt._rescaleAndSwap(this.#a,t,e,c,h);break;case 180:d=nt._rescale(this.#r,n,e,-c,h),f=nt._rescale(this.#a,n,e,-c,h);break;case 270:d=nt._rescaleAndSwap(this.#r,n,a,-c,-h),f=nt._rescaleAndSwap(this.#a,n,a,-c,-h);break}return{outline:Array.from(d),points:[Array.from(f)]}}#o(t){const e=this.#r;let n=e[4],a=e[5];const o=[n,a,n,a];let c=n,h=a;const d=t?Math.max:Math.min;for(let g=6,_=e.length;g<_;g+=6){const y=e[g+4],b=e[g+5];if(isNaN(e[g]))at.pointBoundingBox(y,b,o),h<b?(c=y,h=b):h===b&&(c=d(c,y));else{const A=[1/0,1/0,-1/0,-1/0];at.bezierBoundingBox(n,a,...e.slice(g,g+6),A),at.rectBoundingBox(...A,o),h<A[3]?(c=A[2],h=A[3]):h===A[3]&&(c=d(c,A[2]))}n=y,a=b}const f=this.#e;f[0]=o[0]-this.#n,f[1]=o[1]-this.#n,f[2]=o[2]-o[0]+2*this.#n,f[3]=o[3]-o[1]+2*this.#n,this.lastPoint=[c,h]}get box(){return this.#e}newOutliner(t,e,n,a,o,c=0){return new ws(t,e,n,a,o,c)}getNewOutline(t,e){const[n,a,o,c]=this.#e,[h,d,f,g]=this.#t,_=o*f,y=c*g,b=n*f+h,A=a*g+d,S=this.newOutliner({x:this.#a[0]*_+b,y:this.#a[1]*y+A},this.#t,this.#s,t,this.#i,e??this.#n);for(let C=2;C<this.#a.length;C+=2)S.add({x:this.#a[C]*_+b,y:this.#a[C+1]*y+A});return S.getOutlines()}}class lf{#t;#e;#n=[];#i=[];constructor(t,e=0,n=0,a=!0){const o=[1/0,1/0,-1/0,-1/0],c=10**-4;for(const{x:b,y:A,width:S,height:C}of t){const w=Math.floor((b-e)/c)*c,D=Math.ceil((b+S+e)/c)*c,x=Math.floor((A-e)/c)*c,k=Math.ceil((A+C+e)/c)*c,O=[w,x,k,!0],P=[D,x,k,!1];this.#n.push(O,P),at.rectBoundingBox(w,x,D,k,o)}const h=o[2]-o[0]+2*n,d=o[3]-o[1]+2*n,f=o[0]-n,g=o[1]-n,_=this.#n.at(a?-1:-2),y=[_[0],_[2]];for(const b of this.#n){const[A,S,C]=b;b[0]=(A-f)/h,b[1]=(S-g)/d,b[2]=(C-g)/d}this.#t=new Float32Array([f,g,h,d]),this.#e=y}getOutlines(){this.#n.sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);const t=[];for(const e of this.#n)e[3]?(t.push(...this.#l(e)),this.#r(e)):(this.#o(e),t.push(...this.#l(e)));return this.#a(t)}#a(t){const e=[],n=new Set;for(const c of t){const[h,d,f]=c;e.push([h,d,c],[h,f,c])}e.sort((c,h)=>c[1]-h[1]||c[0]-h[0]);for(let c=0,h=e.length;c<h;c+=2){const d=e[c][2],f=e[c+1][2];d.push(f),f.push(d),n.add(d),n.add(f)}const a=[];let o;for(;n.size>0;){const c=n.values().next().value;let[h,d,f,g,_]=c;n.delete(c);let y=h,b=d;for(o=[h,f],a.push(o);;){let A;if(n.has(g))A=g;else if(n.has(_))A=_;else break;n.delete(A),[h,d,f,g,_]=A,y!==h&&(o.push(y,b,h,b===d?d:f),y=h),b=b===d?f:d}o.push(y,b)}return new Lw(a,this.#t,this.#e)}#s(t){const e=this.#i;let n=0,a=e.length-1;for(;n<=a;){const o=n+a>>1,c=e[o][0];if(c===t)return o;c<t?n=o+1:a=o-1}return a+1}#r([,t,e]){const n=this.#s(t);this.#i.splice(n,0,[t,e])}#o([,t,e]){const n=this.#s(t);for(let a=n;a<this.#i.length;a++){const[o,c]=this.#i[a];if(o!==t)break;if(o===t&&c===e){this.#i.splice(a,1);return}}for(let a=n-1;a>=0;a--){const[o,c]=this.#i[a];if(o!==t)break;if(o===t&&c===e){this.#i.splice(a,1);return}}}#l(t){const[e,n,a]=t,o=[[e,n,a]],c=this.#s(a);for(let h=0;h<c;h++){const[d,f]=this.#i[h];for(let g=0,_=o.length;g<_;g++){const[,y,b]=o[g];if(!(f<=y||b<=d)){if(y>=d){if(b>f)o[g][1]=f;else{if(_===1)return[];o.splice(g,1),g--,_--}continue}o[g][2]=d,b>f&&o.push([e,f,b])}}}return o}}class Lw extends nt{#t;#e;constructor(t,e,n){super(),this.#e=t,this.#t=e,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#e){let[n,a]=e;t.push(`M${n} ${a}`);for(let o=2;o<e.length;o+=2){const c=e[o],h=e[o+1];c===n?(t.push(`V${h}`),a=h):h===a&&(t.push(`H${c}`),n=c)}t.push("Z")}return t.join(" ")}serialize([t,e,n,a],o){const c=[],h=n-t,d=a-e;for(const f of this.#e){const g=new Array(f.length);for(let _=0;_<f.length;_+=2)g[_]=t+f[_]*h,g[_+1]=a-f[_+1]*d;c.push(g)}return c}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class cf extends ws{newFreeDrawOutline(t,e,n,a,o,c){return new Iw(t,e,n,a,o,c)}}class Iw extends Hv{newOutliner(t,e,n,a,o,c=0){return new cf(t,e,n,a,o,c)}}class re extends ct{#t=null;#e=0;#n;#i=null;#a=null;#s=null;#r=null;#o=0;#l=null;#c=null;#d=null;#u=!1;#f=null;#g;#p=null;#h="";#m;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=mt.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=re.prototype;return Tt(this,"_keyboardManager",new zo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||re._defaultColor,this.#m=t.thickness||re._defaultThickness,this.#g=t.opacity||re._defaultOpacity,this.#n=t.boxes||null,this.#b=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#u=!0,this.#A(t),this.#T()):this.#n&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#r=t.focusNode,this.#o=t.focusOffset,this.#_(),this.#T(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#m,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#_(){const t=new lf(this.#n,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const e=new lf(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#s=e.getOutlines();const{lastPoint:n}=this.#s;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#A({highlightOutlines:t,highlightId:e,clipPathId:n}){this.#c=t;const a=1.5;if(this.#s=t.getNewOutline(this.#m/2+a,.0025),e>=0)this.#d=e,this.#i=n,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:re.#w(this.#c.box,(g-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:re.#w(this.#s.box,g),path:{d:this.#s.toSVGPath()}})}const[o,c,h,d]=t.box;switch(this.rotation){case 0:this.x=o,this.y=c,this.width=h,this.height=d;break;case 90:{const[g,_]=this.parentDimensions;this.x=c,this.y=1-o,this.width=h*_/g,this.height=d*g/_;break}case 180:this.x=1-o,this.y=1-c,this.width=h,this.height=d;break;case 270:{const[g,_]=this.parentDimensions;this.x=1-c,this.y=o,this.width=h*_/g,this.height=d*g/_;break}}const{lastPoint:f}=this.#s;this.#f=[(f[0]-o)/h,(f[1]-c)/d]}static initialize(t,e){ct.initialize(t,e),re._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case Ot.HIGHLIGHT_COLOR:re._defaultColor=e;break;case Ot.HIGHLIGHT_THICKNESS:re._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#f}updateParams(t,e){switch(t){case Ot.HIGHLIGHT_COLOR:this.#S(e);break;case Ot.HIGHLIGHT_THICKNESS:this.#y(e);break}}static get defaultPropertiesToUpdate(){return[[Ot.HIGHLIGHT_COLOR,re._defaultColor],[Ot.HIGHLIGHT_THICKNESS,re._defaultThickness]]}get propertiesToUpdate(){return[[Ot.HIGHLIGHT_COLOR,this.color||re._defaultColor],[Ot.HIGHLIGHT_THICKNESS,this.#m||re._defaultThickness],[Ot.HIGHLIGHT_FREE,this.#u]]}#S(t){const e=(o,c)=>{this.color=o,this.#g=c,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:o,"fill-opacity":c}}),this.#a?.updateColor(o)},n=this.color,a=this.#g;this.addCommands({cmd:e.bind(this,t,re._defaultOpacity),undo:e.bind(this,n,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#y(t){const e=this.#m,n=a=>{this.#m=a,this.#E(a)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new En({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#D())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#D())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#R(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#T(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#R():t&&(this.#T(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#E(t){if(!this.#u)return;this.#A({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}#R(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#T(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#i}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#g},rootClass:{highlight:!0,free:this.#u},path:{d:this.#c.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#u),this.#l&&(this.#l.style.clipPath=this.#i))}static#w([t,e,n,a],o){switch(o){case 90:return[1-e-a,t,a,n];case 180:return[1-t-n,1-e-a,n,a];case 270:return[e,1-t-n,a,n]}return[t,e,n,a]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#u?(t=(t-this.rotation+360)%360,n=re.#w(this.#c.box,t)):n=re.#w([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:re.#w(this.#s.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#u?t.classList.add("free"):this.div.addEventListener("keydown",this.#O.bind(this),{signal:this._uiManager._signal});const e=this.#l=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#i;const[n,a]=this.parentDimensions;return this.setDims(this.width*n,this.height*a),pv(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#O(t){re._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#x(!0);break;case 1:case 3:this.#x(!1);break}}#x(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#r,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#u||this.#x(!1))}get _mustFixPosition(){return!this.#u}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#D(){return this.#u?this.rotation:0}#I(){if(this.#u)return null;const[t,e]=this.pageDimensions,[n,a]=this.pageTranslation,o=this.#n,c=new Float32Array(o.length*8);let h=0;for(const{x:d,y:f,width:g,height:_}of o){const y=d*t+n,b=(1-f)*e+a;c[h]=c[h+4]=y,c[h+1]=c[h+3]=b,c[h+2]=c[h+6]=y+g*t,c[h+5]=c[h+7]=b-_*e,h+=8}return c}#k(t){return this.#c.serialize(t,this.#D())}static startHighlighting(t,e,{target:n,x:a,y:o}){const{x:c,y:h,width:d,height:f}=n.getBoundingClientRect(),g=new AbortController,_=t.combinedSignal(g),y=b=>{g.abort(),this.#P(t,b)};window.addEventListener("blur",y,{signal:_}),window.addEventListener("pointerup",y,{signal:_}),window.addEventListener("pointerdown",fe,{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",Cn,{signal:_}),n.addEventListener("pointermove",this.#L.bind(this,t),{signal:_}),this._freeHighlight=new cf({x:a,y:o},[c,h,d,f],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#L(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#P(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let a=null;if(t instanceof Bv){const{data:{quadPoints:A,rect:S,rotation:C,id:w,color:D,opacity:x,popupRef:k,contentsObj:O},parent:{page:{pageNumber:P}}}=t;a=t={annotationType:mt.HIGHLIGHT,color:Array.from(D),opacity:x,quadPoints:A,boxes:null,pageIndex:P-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,popupRef:k,comment:O?.str||null}}else if(t instanceof $f){const{data:{inkLists:A,rect:S,rotation:C,id:w,color:D,borderStyle:{rawWidth:x},popupRef:k,contentsObj:O},parent:{page:{pageNumber:P}}}=t;a=t={annotationType:mt.HIGHLIGHT,color:Array.from(D),thickness:x,inkLists:A,boxes:null,pageIndex:P-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,popupRef:k,comment:O?.str||null}}const{color:o,quadPoints:c,inkLists:h,opacity:d}=t,f=await super.deserialize(t,e,n);f.color=at.makeHexColor(...o),f.#g=d||1,h&&(f.#m=t.thickness),f._initialData=a,t.comment&&f.setCommentData(t.comment);const[g,_]=f.pageDimensions,[y,b]=f.pageTranslation;if(c){const A=f.#n=[];for(let S=0;S<c.length;S+=8)A.push({x:(c[S]-y)/g,y:1-(c[S+1]-b)/_,width:(c[S+2]-c[S])/g,height:(c[S+1]-c[S+5])/_});f.#_(),f.#T(),f.rotate(f.rotation)}else if(h){f.#u=!0;const A=h[0],S={x:A[0]-y,y:_-(A[1]-b)},C=new cf(S,[0,0,g,_],1,f.#m/2,!0,.001);for(let x=0,k=A.length;x<k;x+=2)S.x=A[x]-y,S.y=_-(A[x+1]-b),C.add(S);const{id:w,clipPathId:D}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);f.#A({highlightOutlines:C.getOutlines(),highlightId:w,clipPathId:D}),f.#T(),f.rotate(f.parentRotation)}return f}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),n=ct._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),a={annotationType:mt.HIGHLIGHT,color:n,opacity:this.#g,thickness:this.#m,quadPoints:this.#I(),outlines:this.#k(e),pageIndex:this.pageIndex,rect:e,rotation:this.#D(),structTreeParentId:this._structTreeParentId};return this.addComment(a),this.annotationElementId&&!this.#N(a)?null:(a.id=this.annotationElementId,a)}#N(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((n,a)=>n!==e[a])}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}static canCreateNewEmptyEditor(){return!1}}class zv{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Vt("Not implemented")}}class dt extends ct{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#a=null;static#s=NaN;static#r=null;static#o=null;static#l=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(this.#c(t),this.#f())}#c({drawOutlines:t,drawId:e,drawingOptions:n}){this.#t=t,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#d(t,this.parent),this.#h(t.box)}#d(t,e){const{id:n}=e.drawLayer.draw(dt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[a,o]of Object.entries(e))n.has(a)?Object.assign(t[a],o):t[a]=o;return t}static getDefaultDrawingOptions(t){Vt("Not implemented")}static get typesMap(){Vt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(dt.#n.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,a]of this.typesMap)t.push([n,e[a]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,a]of this.constructor.typesMap)t.push([n,e[a]]);return t}_updateProperty(t,e,n){const a=this._drawingOptions,o=a[e],c=h=>{a.updateProperty(e,h);const d=this.#t.updateProperty(e,h);d&&this.#h(d),this.parent?.drawLayer.updateProperties(this._drawId,a.toSVGProperties()),t===this.colorType&&this._colorPicker?.update(h)};this.addCommands({cmd:c.bind(this,n),undo:c.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,dt._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,dt._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#m()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,dt._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#u(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#u()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#u(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#t,t)}}#g([t,e,n,a]){const{parentDimensions:[o,c],rotation:h}=this;switch(h){case 90:return[e,1-t,n*(c/o),a*(o/c)];case 180:return[1-t,1-e,n,a];case 270:return[1-e,t,n*(c/o),a*(o/c)];default:return[t,e,n,a]}}#p(){const{x:t,y:e,width:n,height:a,parentDimensions:[o,c],rotation:h}=this;switch(h){case 90:return[1-e,t,n*(o/c),a*(c/o)];case 180:return[1-t,1-e,n,a];case 270:return[e,1-t,n*(o/c),a*(c/o)];default:return[t,e,n,a]}}#h(t){if([this.x,this.y,this.width,this.height]=this.#g(t),this.div){this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}this._onResized()}#m(){const{x:t,y:e,width:n,height:a,rotation:o,parentRotation:c,parentDimensions:[h,d]}=this;switch((o*4+c)/90){case 1:return[1-e-a,t,a,n];case 2:return[1-t-n,1-e-a,n,a];case 3:return[e,1-t-n,a,n];case 4:return[t,e-n*(h/d),a*(d/h),n*(h/d)];case 5:return[1-e,t,n*(h/d),a*(d/h)];case 6:return[1-t-a*(d/h),1-e,a*(d/h),n*(h/d)];case 7:return[e-n*(h/d),1-t-a*(d/h),n*(h/d),a*(d/h)];case 8:return[t-n,e-a,n,a];case 9:return[1-e,t-n,a,n];case 10:return[1-t,1-e,n,a];case 11:return[e-a,1-t,a,n];case 12:return[t-a*(d/h),e,a*(d/h),n*(h/d)];case 13:return[1-e-n*(h/d),t-a*(d/h),n*(h/d),a*(d/h)];case 14:return[1-t,1-e-n*(h/d),a*(d/h),n*(h/d)];case 15:return[e,1-t,n*(h/d),a*(d/h)];default:return[t,e,n,a]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,dt._mergeSVGProperties({bbox:this.#m()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const a=document.createElement("div");n.append(a),a.setAttribute("aria-hidden","true"),a.className="internal";const[o,c]=this.parentDimensions;return this.setDims(this.width*o,this.height*c),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,a,o){Vt("Not implemented")}static startDrawing(t,e,n,a){const{target:o,offsetX:c,offsetY:h,pointerId:d,pointerType:f}=a;if(dt.#r&&dt.#r!==f)return;const{viewport:{rotation:g}}=t,{width:_,height:y}=o.getBoundingClientRect(),b=dt.#i=new AbortController,A=t.combinedSignal(b);if(dt.#s||=d,dt.#r??=f,window.addEventListener("pointerup",S=>{dt.#s===S.pointerId?this._endDraw(S):dt.#o?.delete(S.pointerId)},{signal:A}),window.addEventListener("pointercancel",S=>{dt.#s===S.pointerId?this._currentParent.endDrawingSession():dt.#o?.delete(S.pointerId)},{signal:A}),window.addEventListener("pointerdown",S=>{dt.#r===S.pointerType&&((dt.#o||=new Set).add(S.pointerId),dt.#n.isCancellable()&&(dt.#n.removeLastElement(),dt.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:A}),window.addEventListener("contextmenu",Cn,{signal:A}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:A}),o.addEventListener("touchmove",S=>{S.timeStamp===dt.#l&&fe(S)},{signal:A}),t.toggleDrawing(),e._editorUndoBar?.hide(),dt.#n){t.drawLayer.updateProperties(this._currentDrawId,dt.#n.startNew(c,h,_,y,g));return}e.updateUIForDefaultProperties(this),dt.#n=this.createDrawerInstance(c,h,_,y,g),dt.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(dt.#a.toSVGProperties(),dt.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(dt.#l=-1,!dt.#n)return;const{offsetX:e,offsetY:n,pointerId:a}=t;if(dt.#s===a){if(dt.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,dt.#n.add(e,n)),dt.#l=t.timeStamp,fe(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,dt.#n=null,dt.#a=null,dt.#r=null,dt.#l=NaN),dt.#i&&(dt.#i.abort(),dt.#i=null,dt.#s=NaN,dt.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,dt.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const n=dt.#n,a=this._currentDrawId,o=n.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(a,n.setLastElement(o))},undo:()=>{e.drawLayer.updateProperties(a,n.removeLastElement())},mustExec:!1,type:Ot.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(Ot.DRAW_STEP),!dt.#n.isEmpty()){const{pageDimensions:[n,a],scale:o}=e,c=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:dt.#n.getOutlines(n*o,a*o,o,this._INNER_MARGIN),drawingOptions:dt.#a,mustBeCommitted:!t});return this._cleanup(!0),c}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,a,o,c){Vt("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:a,pageHeight:o,pageX:c,pageY:h}}=e.viewport,d=this.deserializeDraw(c,h,a,o,this._INNER_MARGIN,t),f=await super.deserialize(t,e,n);return f.createDrawingOptions(t),f.#c({drawOutlines:d}),f.#f(),f.onScaleChanging(),f.rotate(),f}serializeDraw(t){const[e,n]=this.pageTranslation,[a,o]=this.pageDimensions;return this.#t.serialize([e,n,a,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Pw{#t=new Float64Array(6);#e;#n;#i;#a;#s;#r="";#o=0;#l=new jo;#c;#d;constructor(t,e,n,a,o,c){this.#c=n,this.#d=a,this.#i=o,this.#a=c,[t,e]=this.#u(t,e);const h=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e],this.#n=[{line:h,points:this.#s}],this.#t.set(h,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#u(t,e){return nt._normalizePoint(t,e,this.#c,this.#d,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#s.length<=10}add(t,e){[t,e]=this.#u(t,e);const[n,a,o,c]=this.#t.subarray(2,6),h=t-o,d=e-c;return Math.hypot(this.#c*h,this.#d*d)<=2?null:(this.#s.push(t,e),isNaN(n)?(this.#t.set([o,c,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([n,a,o,c,t,e],0),this.#e.push(...nt.createBezierPoints(n,a,o,c,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,a,o){this.#c=n,this.#d=a,this.#i=o,[t,e]=this.#u(t,e);const c=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e];const h=this.#n.at(-1);return h&&(h.line=new Float32Array(h.line),h.points=new Float32Array(h.points)),this.#n.push({line:c,points:this.#s}),this.#t.set(c,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(t){return this.#n?(this.#n.push(t),this.#e=t.line,this.#s=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(t)}removeLastElement(){if(!this.#n)return this.#l.removeLastElement();this.#n.pop(),this.#r="";for(let t=0,e=this.#n.length;t<e;t++){const{line:n,points:a}=this.#n[t];this.#e=n,this.#s=a,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const t=nt.svgRound(this.#e[4]),e=nt.svgRound(this.#e[5]);if(this.#s.length===2)return this.#r=`${this.#r} M ${t} ${e} Z`,this.#r;if(this.#s.length<=6){const a=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,a)} M ${t} ${e}`,this.#o=6}if(this.#s.length===4){const a=nt.svgRound(this.#e[10]),o=nt.svgRound(this.#e[11]);return this.#r=`${this.#r} L ${a} ${o}`,this.#o=12,this.#r}const n=[];this.#o===0&&(n.push(`M ${t} ${e}`),this.#o=6);for(let a=this.#o,o=this.#e.length;a<o;a+=6){const[c,h,d,f,g,_]=this.#e.slice(a,a+6).map(nt.svgRound);n.push(`C${c} ${h} ${d} ${f} ${g} ${_}`)}return this.#r+=n.join(" "),this.#o=this.#e.length,this.#r}getOutlines(t,e,n,a){const o=this.#n.at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),this.#l.build(this.#n,t,e,n,this.#i,this.#a,a),this.#t=null,this.#e=null,this.#n=null,this.#r=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class jo extends nt{#t;#e=0;#n;#i;#a;#s;#r;#o;#l;build(t,e,n,a,o,c,h){this.#a=e,this.#s=n,this.#r=a,this.#o=o,this.#l=c,this.#n=h??0,this.#i=t,this.#u()}get thickness(){return this.#l}setLastElement(t){return this.#i.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#i){if(t.push(`M${nt.svgRound(e[4])} ${nt.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${nt.svgRound(e[10])} ${nt.svgRound(e[11])}`);continue}for(let n=6,a=e.length;n<a;n+=6){const[o,c,h,d,f,g]=e.subarray(n,n+6).map(nt.svgRound);t.push(`C${o} ${c} ${h} ${d} ${f} ${g}`)}}return t.join("")}serialize([t,e,n,a],o){const c=[],h=[],[d,f,g,_]=this.#d();let y,b,A,S,C,w,D,x,k;switch(this.#o){case 0:k=nt._rescale,y=t,b=e+a,A=n,S=-a,C=t+d*n,w=e+(1-f-_)*a,D=t+(d+g)*n,x=e+(1-f)*a;break;case 90:k=nt._rescaleAndSwap,y=t,b=e,A=n,S=a,C=t+f*n,w=e+d*a,D=t+(f+_)*n,x=e+(d+g)*a;break;case 180:k=nt._rescale,y=t+n,b=e,A=-n,S=a,C=t+(1-d-g)*n,w=e+f*a,D=t+(1-d)*n,x=e+(f+_)*a;break;case 270:k=nt._rescaleAndSwap,y=t+n,b=e+a,A=-n,S=-a,C=t+(1-f-_)*n,w=e+(1-d-g)*a,D=t+(1-f)*n,x=e+(1-d)*a;break}for(const{line:O,points:P}of this.#i)c.push(k(O,y,b,A,S,o?new Array(O.length):null)),h.push(k(P,y,b,A,S,o?new Array(P.length):null));return{lines:c,points:h,rect:[C,w,D,x]}}static deserialize(t,e,n,a,o,{paths:{lines:c,points:h},rotation:d,thickness:f}){const g=[];let _,y,b,A,S;switch(d){case 0:S=nt._rescale,_=-t/n,y=e/a+1,b=1/n,A=-1/a;break;case 90:S=nt._rescaleAndSwap,_=-e/a,y=-t/n,b=1/a,A=1/n;break;case 180:S=nt._rescale,_=t/n+1,y=-e/a,b=-1/n,A=1/a;break;case 270:S=nt._rescaleAndSwap,_=e/a+1,y=t/n+1,b=-1/a,A=-1/n;break}if(!c){c=[];for(const w of h){const D=w.length;if(D===2){c.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(D===4){c.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const x=new Float32Array(3*(D-2));c.push(x);let[k,O,P,j]=w.subarray(0,4);x.set([NaN,NaN,NaN,NaN,k,O],0);for(let Y=4;Y<D;Y+=2){const K=w[Y],it=w[Y+1];x.set(nt.createBezierPoints(k,O,P,j,K,it),(Y-2)*3),[k,O,P,j]=[P,j,K,it]}}}for(let w=0,D=c.length;w<D;w++)g.push({line:S(c[w].map(x=>x??NaN),_,y,b,A),points:S(h[w].map(x=>x??NaN),_,y,b,A)});const C=new this.prototype.constructor;return C.build(g,n,a,1,d,f,o),C}#c(t=this.#l){const e=this.#n+t/2*this.#r;return this.#o%180===0?[e/this.#a,e/this.#s]:[e/this.#s,e/this.#a]}#d(){const[t,e,n,a]=this.#t,[o,c]=this.#c(0);return[t+o,e+c,n-2*o,a-2*c]}#u(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:a}of this.#i){if(a.length<=12){for(let h=4,d=a.length;h<d;h+=6)at.pointBoundingBox(a[h],a[h+1],t);continue}let o=a[4],c=a[5];for(let h=6,d=a.length;h<d;h+=6){const[f,g,_,y,b,A]=a.subarray(h,h+6);at.bezierBoundingBox(o,c,f,g,_,y,b,A,t),o=b,c=A}}const[e,n]=this.#c();t[0]=Ue(t[0]-e,0,1),t[1]=Ue(t[1]-n,0,1),t[2]=Ue(t[2]+e,0,1),t[3]=Ue(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,n]=this.#c();this.#l=t;const[a,o]=this.#c(),[c,h]=[a-e,o-n],d=this.#t;return d[0]-=c,d[1]-=h,d[2]+=2*c,d[3]+=2*h,d}updateParentDimensions([t,e],n){const[a,o]=this.#c();this.#a=t,this.#s=e,this.#r=n;const[c,h]=this.#c(),d=c-a,f=h-o,g=this.#t;return g[0]-=d,g[1]-=f,g[2]+=2*d,g[3]+=2*f,g}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(nt.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let n=0,a=0,o=0,c=0,h=0,d=0;switch(this.#e){case 90:a=e/t,o=-t/e,h=t;break;case 180:n=-1,c=-1,h=t,d=e;break;case 270:a=-e/t,o=t/e,d=e;break;default:return""}return`matrix(${n} ${a} ${o} ${c} ${nt.svgRound(h)} ${nt.svgRound(d)})`}getPathResizingSVGProperties([t,e,n,a]){const[o,c]=this.#c(),[h,d,f,g]=this.#t;if(Math.abs(f-o)<=nt.PRECISION||Math.abs(g-c)<=nt.PRECISION){const S=t+n/2-(h+f/2),C=e+a/2-(d+g/2);return{path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`,transform:`${this.rotationTransform} translate(${S} ${C})`}}}const _=(n-2*o)/(f-2*o),y=(a-2*c)/(g-2*c),b=f/n,A=g/a;return{path:{"transform-origin":`${nt.svgRound(h)} ${nt.svgRound(d)}`,transform:`${this.rotationTransform} scale(${b} ${A}) translate(${nt.svgRound(o)} ${nt.svgRound(c)}) scale(${_} ${y}) translate(${nt.svgRound(-o)} ${nt.svgRound(-c)})`}}}getPathResizedSVGProperties([t,e,n,a]){const[o,c]=this.#c(),h=this.#t,[d,f,g,_]=h;if(h[0]=t,h[1]=e,h[2]=n,h[3]=a,Math.abs(g-o)<=nt.PRECISION||Math.abs(_-c)<=nt.PRECISION){const C=t+n/2-(d+g/2),w=e+a/2-(f+_/2);for(const{line:D,points:x}of this.#i)nt._translate(D,C,w,D),nt._translate(x,C,w,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const y=(n-2*o)/(g-2*o),b=(a-2*c)/(_-2*c),A=-y*(d+o)+t+o,S=-b*(f+c)+e+c;if(y!==1||b!==1||A!==0||S!==0)for(const{line:C,points:w}of this.#i)nt._rescale(C,A,S,y,b,C),nt._rescale(w,A,S,y,b,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],n){const[a,o]=n,c=this.#t,h=t-c[0],d=e-c[1];if(this.#a===a&&this.#s===o)for(const{line:f,points:g}of this.#i)nt._translate(f,h,d,f),nt._translate(g,h,d,g);else{const f=this.#a/a,g=this.#s/o;this.#a=a,this.#s=o;for(const{line:_,points:y}of this.#i)nt._rescale(_,h,d,f,g,_),nt._rescale(y,h,d,f,g,y);c[2]*=f,c[3]*=g}return c[0]=t,c[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${nt.svgRound(t[0])} ${nt.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class eu extends zv{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:ct._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new eu(this._viewParameters);return t.updateAll(this),t}}class Kf extends dt{static _type="ink";static _editorType=mt.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){ct.initialize(t,e),this._defaultDrawingOptions=new eu(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return Tt(this,"typesMap",new Map([[Ot.INK_THICKNESS,"stroke-width"],[Ot.INK_COLOR,"stroke"],[Ot.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,a,o){return new Pw(t,e,n,a,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,a,o,c){return jo.deserialize(t,e,n,a,o,c)}static async deserialize(t,e,n){let a=null;if(t instanceof $f){const{data:{inkLists:c,rect:h,rotation:d,id:f,color:g,opacity:_,borderStyle:{rawWidth:y},popupRef:b,contentsObj:A},parent:{page:{pageNumber:S}}}=t;a=t={annotationType:mt.INK,color:Array.from(g),thickness:y,opacity:_,paths:{points:c},boxes:null,pageIndex:S-1,rect:h.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:b,comment:A?.str||null}}const o=await super.deserialize(t,e,n);return o._initialData=a,t.comment&&o.setCommentData(t.comment),o}get toolbarButtons(){return this._colorPicker||=new Co(this),[["colorPicker",this._colorPicker]]}get colorType(){return Ot.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:n}){this._drawingOptions=Kf.getDefaultDrawingOptions({stroke:at.makeHexColor(...t),"stroke-width":e,"stroke-opacity":n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n,rect:a}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":c,"stroke-width":h}}=this,d={annotationType:mt.INK,color:ct._colorManager.convert(o),opacity:c,thickness:h,paths:{lines:e,points:n},pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(d),t?(d.isCopy=!0,d):this.annotationElementId&&!this.#t(d)?null:(d.id=this.annotationElementId,d)}#t(t){const{color:e,thickness:n,opacity:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((c,h)=>c!==e[h])||t.thickness!==n||t.opacity!==a||t.pageIndex!==o}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:n}=this.serializeDraw(!1),a={rect:n,thickness:this._drawingOptions["stroke-width"],points:e};return this.hasEditedComment&&(a.popup=this.comment),t.updateEdited(a),null}}class uf extends jo{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const mc=8,ro=3;class ka{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,n,a){return n-=t,a-=e,n===0?a>0?0:4:n===1?a+6:2-a}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(t,e,n,a,o,c,h){const d=this.#e(n,a,o,c);for(let f=0;f<8;f++){const g=(-f+d-h+16)%8,_=this.#n[2*g],y=this.#n[2*g+1];if(t[(n+_)*e+(a+y)]!==0)return g}return-1}static#a(t,e,n,a,o,c,h){const d=this.#e(n,a,o,c);for(let f=0;f<8;f++){const g=(f+d+h+16)%8,_=this.#n[2*g],y=this.#n[2*g+1];if(t[(n+_)*e+(a+y)]!==0)return g}return-1}static#s(t,e,n,a){const o=t.length,c=new Int32Array(o);for(let g=0;g<o;g++)c[g]=t[g]<=a?1:0;for(let g=1;g<n-1;g++)c[g*e]=c[g*e+e-1]=0;for(let g=0;g<e;g++)c[g]=c[e*n-1-g]=0;let h=1,d;const f=[];for(let g=1;g<n-1;g++){d=1;for(let _=1;_<e-1;_++){const y=g*e+_,b=c[y];if(b===0)continue;let A=g,S=_;if(b===1&&c[y-1]===0)h+=1,S-=1;else if(b>=1&&c[y+1]===0)h+=1,S+=1,b>1&&(d=b);else{b!==1&&(d=Math.abs(b));continue}const C=[_,g],w=S===_+1,D={isHole:w,points:C,id:h,parent:0};f.push(D);let x;for(const J of f)if(J.id===d){x=J;break}x?x.isHole?D.parent=w?x.parent:d:D.parent=w?d:x.parent:D.parent=w?d:0;const k=this.#i(c,e,g,_,A,S,0);if(k===-1){c[y]=-h,c[y]!==1&&(d=Math.abs(c[y]));continue}let O=this.#n[2*k],P=this.#n[2*k+1];const j=g+O,Y=_+P;A=j,S=Y;let K=g,it=_;for(;;){const J=this.#a(c,e,K,it,A,S,1);O=this.#n[2*J],P=this.#n[2*J+1];const ft=K+O,tt=it+P;C.push(tt,ft);const vt=K*e+it;if(c[vt+1]===0?c[vt]=-h:c[vt]===1&&(c[vt]=h),ft===g&&tt===_&&K===j&&it===Y){c[y]!==1&&(d=Math.abs(c[y]));break}else A=K,S=it,K=ft,it=tt}}}return f}static#r(t,e,n,a){if(n-e<=4){for(let j=e;j<n-2;j+=2)a.push(t[j],t[j+1]);return}const o=t[e],c=t[e+1],h=t[n-4]-o,d=t[n-3]-c,f=Math.hypot(h,d),g=h/f,_=d/f,y=g*c-_*o,b=d/h,A=1/f,S=Math.atan(b),C=Math.cos(S),w=Math.sin(S),D=A*(Math.abs(C)+Math.abs(w)),x=A*(1-D+D**2),k=Math.max(Math.atan(Math.abs(w+C)*x),Math.atan(Math.abs(w-C)*x));let O=0,P=e;for(let j=e+2;j<n-2;j+=2){const Y=Math.abs(y-g*t[j+1]+_*t[j]);Y>O&&(P=j,O=Y)}O>(f*k)**2?(this.#r(t,e,P+2,a),this.#r(t,P,n,a)):a.push(o,c)}static#o(t){const e=[],n=t.length;return this.#r(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#l(t,e,n,a,o,c){const h=new Float32Array(c**2),d=-2*a**2,f=c>>1;for(let S=0;S<c;S++){const C=(S-f)**2;for(let w=0;w<c;w++)h[S*c+w]=Math.exp((C+(w-f)**2)/d)}const g=new Float32Array(256),_=-2*o**2;for(let S=0;S<256;S++)g[S]=Math.exp(S**2/_);const y=t.length,b=new Uint8Array(y),A=new Uint32Array(256);for(let S=0;S<n;S++)for(let C=0;C<e;C++){const w=S*e+C,D=t[w];let x=0,k=0;for(let P=0;P<c;P++){const j=S+P-f;if(!(j<0||j>=n))for(let Y=0;Y<c;Y++){const K=C+Y-f;if(K<0||K>=e)continue;const it=t[j*e+K],J=h[P*c+Y]*g[Math.abs(it-D)];x+=it*J,k+=J}}const O=b[w]=Math.round(x/k);A[O]++}return[b,A]}static#c(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#d(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let a=-1/0,o=1/0;for(let h=0,d=n.length;h<d;h++){const f=n[h]=t[h<<2];a=Math.max(a,f),o=Math.min(o,f)}const c=255/(a-o);for(let h=0,d=n.length;h<d;h++)n[h]=(n[h]-o)*c;return n}static#u(t){let e,n=-1/0,a=-1/0;const o=t.findIndex(d=>d!==0);let c=o,h=o;for(e=o;e<256;e++){const d=t[e];d>n&&(e-c>a&&(a=e-c,h=e-1),n=d,c=e)}for(e=h-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:n,height:a}=t,{maxDim:o}=this.#t;let c=n,h=a;if(n>o||a>o){let y=n,b=a,A=Math.log2(Math.max(n,a)/o);const S=Math.floor(A);A=A===S?S-1:S;for(let w=0;w<A;w++){c=Math.ceil(y/2),h=Math.ceil(b/2);const D=new OffscreenCanvas(c,h);D.getContext("2d").drawImage(t,0,0,y,b,0,0,c,h),y=c,b=h,t!==e&&t.close(),t=D.transferToImageBitmap()}const C=Math.min(o/c,o/h);c=Math.round(c*C),h=Math.round(h*C)}const f=new OffscreenCanvas(c,h).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,c,h),f.filter="grayscale(1)",f.drawImage(t,0,0,t.width,t.height,0,0,c,h);const g=f.getImageData(0,0,c,h).data;return[this.#d(g),c,h]}static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:a},o,c,h,d){let f=new OffscreenCanvas(1,1),g=f.getContext("2d",{alpha:!1});const _=200,y=g.font=`${n} ${a} ${_}px ${e}`,{actualBoundingBoxLeft:b,actualBoundingBoxRight:A,actualBoundingBoxAscent:S,actualBoundingBoxDescent:C,fontBoundingBoxAscent:w,fontBoundingBoxDescent:D,width:x}=g.measureText(t),k=1.5,O=Math.ceil(Math.max(Math.abs(b)+Math.abs(A)||0,x)*k),P=Math.ceil(Math.max(Math.abs(S)+Math.abs(C)||_,Math.abs(w)+Math.abs(D)||_)*k);f=new OffscreenCanvas(O,P),g=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),g.font=y,g.filter="grayscale(1)",g.fillStyle="white",g.fillRect(0,0,O,P),g.fillStyle="black",g.fillText(t,O*(k-1)/2,P*(3-k)/2);const j=this.#d(g.getImageData(0,0,O,P).data),Y=this.#c(j),K=this.#u(Y),it=this.#s(j,O,P,K);return this.processDrawnLines({lines:{curves:it,width:O,height:P},pageWidth:o,pageHeight:c,rotation:h,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(t,e,n,a,o){const[c,h,d]=this.#f(t),[f,g]=this.#l(c,h,d,Math.hypot(h,d)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),_=this.#u(g),y=this.#s(f,h,d,_);return this.processDrawnLines({lines:{curves:y,width:h,height:d},pageWidth:e,pageHeight:n,rotation:a,innerMargin:o,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:a,innerMargin:o,mustSmooth:c,areContours:h}){a%180!==0&&([e,n]=[n,e]);const{curves:d,width:f,height:g}=t,_=t.thickness??0,y=[],b=Math.min(e/f,n/g),A=b/e,S=b/n,C=[];for(const{points:D}of d){const x=c?this.#o(D):D;if(!x)continue;C.push(x);const k=x.length,O=new Float32Array(k),P=new Float32Array(3*(k===2?2:k-2));if(y.push({line:P,points:O}),k===2){O[0]=x[0]*A,O[1]=x[1]*S,P.set([NaN,NaN,NaN,NaN,O[0],O[1]],0);continue}let[j,Y,K,it]=x;j*=A,Y*=S,K*=A,it*=S,O.set([j,Y,K,it],0),P.set([NaN,NaN,NaN,NaN,j,Y],0);for(let J=4;J<k;J+=2){const ft=O[J]=x[J]*A,tt=O[J+1]=x[J+1]*S;P.set(nt.createBezierPoints(j,Y,K,it,ft,tt),(J-2)*3),[j,Y,K,it]=[K,it,ft,tt]}}if(y.length===0)return null;const w=h?new uf:new jo;return w.build(y,e,n,1,a,h?0:_,o),{outline:w,newCurves:C,areContours:h,thickness:_,width:f,height:g}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:a,height:o}){let c=1/0,h=-1/0,d=0;for(const x of t){d+=x.length;for(let k=2,O=x.length;k<O;k++){const P=x[k]-x[k-2];c=Math.min(c,P),h=Math.max(h,P)}}let f;c>=-128&&h<=127?f=Int8Array:c>=-32768&&h<=32767?f=Int16Array:f=Int32Array;const g=t.length,_=mc+ro*g,y=new Uint32Array(_);let b=0;y[b++]=_*Uint32Array.BYTES_PER_ELEMENT+(d-2*g)*f.BYTES_PER_ELEMENT,y[b++]=0,y[b++]=a,y[b++]=o,y[b++]=e?0:1,y[b++]=Math.max(0,Math.floor(n??0)),y[b++]=g,y[b++]=f.BYTES_PER_ELEMENT;for(const x of t)y[b++]=x.length-2,y[b++]=x[0],y[b++]=x[1];const A=new CompressionStream("deflate-raw"),S=A.writable.getWriter();await S.ready,S.write(y);const C=f.prototype.constructor;for(const x of t){const k=new C(x.length-2);for(let O=2,P=x.length;O<P;O++)k[O-2]=x[O]-x[O-2];S.write(k)}S.close();const w=await new Response(A.readable).arrayBuffer(),D=new Uint8Array(w);return fv(D)}static async decompressSignature(t){try{const e=s1(t),{readable:n,writable:a}=new DecompressionStream("deflate-raw"),o=a.getWriter();await o.ready,o.write(e).then(async()=>{await o.ready,await o.close()}).catch(()=>{});let c=null,h=0;for await(const x of n)c||=new Uint8Array(new Uint32Array(x.buffer,0,4)[0]),c.set(x,h),h+=x.length;const d=new Uint32Array(c.buffer,0,c.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const g=d[2],_=d[3],y=d[4]===0,b=d[5],A=d[6],S=d[7],C=[],w=(mc+ro*A)*Uint32Array.BYTES_PER_ELEMENT;let D;switch(S){case Int8Array.BYTES_PER_ELEMENT:D=new Int8Array(c.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:D=new Int16Array(c.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:D=new Int32Array(c.buffer,w);break}h=0;for(let x=0;x<A;x++){const k=d[ro*x+mc],O=new Float32Array(k+2);C.push(O);for(let P=0;P<ro-1;P++)O[P]=d[ro*x+mc+P+1];for(let P=0;P<k;P++)O[P+2]=O[P]+D[h++]}return{areContours:y,thickness:b,outlines:C,width:g,height:_}}catch(e){return yt(`decompressSignature: ${e}`),null}}}class Qf extends zv{constructor(){super(),super.updateProperties({fill:ct._defaultLineColor,"stroke-width":0})}clone(){const t=new Qf;return t.updateAll(this),t}}class Zf extends eu{constructor(t){super(t),super.updateProperties({stroke:ct._defaultLineColor,"stroke-width":1})}clone(){const t=new Zf(this._viewParameters);return t.updateAll(this),t}}class Vn extends dt{#t=!1;#e=null;#n=null;#i=null;static _type="signature";static _editorType=mt.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){ct.initialize(t,e),this._defaultDrawingOptions=new Qf,this._defaultDrawnSignatureOptions=new Zf(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return Tt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:a,mustSmooth:o,areContours:c,description:h,uuid:d,heightInPage:f}=this.#n,{rawDims:{pageWidth:g,pageHeight:_},rotation:y}=this.parent.viewport,b=ka.processDrawnLines({lines:a,pageWidth:g,pageHeight:_,rotation:y,innerMargin:Vn._INNER_MARGIN,mustSmooth:o,areContours:c});this.addSignature(b,f,h,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#i=t,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:a,height:o}=this.#n,c=Math.max(a,o),h=ka.processDrawnLines({lines:{curves:t.map(d=>({points:d})),thickness:n,width:a,height:o},pageWidth:c,pageHeight:c,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:h.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,a){const{x:o,y:c}=this,{outline:h}=this.#n=t;this.#t=h instanceof uf,this.description=n;let d;this.#t?d=Vn.getDefaultDrawingOptions():(d=Vn._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":h.thickness})),this._addOutlines({drawOutlines:h,drawingOptions:d});const[f,g]=this.parentDimensions,[,_]=this.pageDimensions;let y=e/_;y=y>=1?.5:y,this.width*=y/this.height,this.width>=1&&(y*=.9/this.width,this.width=.9),this.height=y,this.setDims(f*this.width,g*this.height),this.x=o,this.y=c,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(a),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!a,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:a}=this.parent.viewport;return ka.process(t,e,n,a,Vn._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:a},rotation:o}=this.parent.viewport;return ka.extractContoursFromText(t,e,n,a,o,Vn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:a}=this.parent.viewport;return ka.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:a,innerMargin:Vn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Vn.getDefaultDrawingOptions():(this._drawingOptions=Vn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:n,rect:a}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":o}}=this,c={annotationType:mt.SIGNATURE,isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:o,pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(c),t?(c.paths={lines:e,points:n},c.uuid=this.#i,c.isCopy=!0):c.lines=e,this.#e&&(c.accessibilityData={type:"Figure",alt:this.#e}),c}static deserializeDraw(t,e,n,a,o,c){return c.areContours?uf.deserialize(t,e,n,a,o,c):jo.deserialize(t,e,n,a,o,c)}static async deserialize(t,e,n){const a=await super.deserialize(t,e,n);return a.#t=t.areContours,a.description=t.accessibilityData?.alt||"",a.#i=t.uuid,a}}class Bw extends ct{#t=null;#e=null;#n=null;#i=null;#a=null;#s="";#r=null;#o=!1;#l=null;#c=!1;#d=!1;static _type="stamp";static _editorType=mt.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#i=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){ct.initialize(t,e)}static isHandlingMimeForPasting(t){return nf.includes(t)}static paste(t,e){e.pasteEditor({mode:mt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#u(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#c=t.isSvg),t.file&&(this.#s=t.file.name),this.#p()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:a,width:o,height:c}=t||this.copyCanvas(null,null,!0).imageData,h=await n.guess({name:"altText",request:{data:a,width:o,height:c,channels:a.length/(o*c)}});if(!h)throw new Error("No response from the AI service.");if(h.error)throw new Error("Error from the AI service.");if(h.cancel)return null;if(!h.output)throw new Error("No valid response from the AI service.");const d=h.output;return await this.setGuessedAltText(d),e&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(n=>this.#u(n,!0)).finally(()=>this.#f());return}if(this.#i){const n=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(n).then(a=>this.#u(a)).finally(()=>this.#f());return}if(this.#a){const n=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(n).then(a=>this.#u(a)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=nf.join(",");const e=this._uiManager._signal;this.#n=new Promise(n=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const a=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(a)}n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#r?.remove(),this.#r=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#r===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#n||this.#t||this.#i||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#p():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:a}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#e=n,a&&(this.#t=a),this.#o=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const t=200;this.#l=setTimeout(()=>{this.#l=null,this.#m()},t)}#p(){const{div:t}=this;let{width:e,height:n}=this.#t;const[a,o]=this.pageDimensions,c=.75;if(this.width)e=this.width*a,n=this.height*o;else if(e>c*a||n>c*o){const g=Math.min(c*a/e,c*o/n);e*=g,n*=g}const[h,d]=this.parentDimensions;this.setDims(e*h/a,n*d/o),this._uiManager.enableWaiting(!1);const f=this.#r=document.createElement("canvas");f.setAttribute("role","img"),this.addContainer(f),this.width=e/a,this.height=n/o,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,n=!1){t||(t=224);const{width:a,height:o}=this.#t,c=new Xn;let h=this.#t,d=a,f=o,g=null;if(e){if(a>e||o>e){const P=Math.min(e/a,e/o);d=Math.floor(a*P),f=Math.floor(o*P)}g=document.createElement("canvas");const y=g.width=Math.ceil(d*c.sx),b=g.height=Math.ceil(f*c.sy);this.#c||(h=this.#h(y,b));const A=g.getContext("2d");A.filter=this._uiManager.hcmFilter;let S="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(S="#8f8f9d",C="#42414d");const w=15,D=w*c.sx,x=w*c.sy,k=new OffscreenCanvas(D*2,x*2),O=k.getContext("2d");O.fillStyle=S,O.fillRect(0,0,D*2,x*2),O.fillStyle=C,O.fillRect(0,0,D,x),O.fillRect(D,x,D,x),A.fillStyle=A.createPattern(k,"repeat"),A.fillRect(0,0,y,b),A.drawImage(h,0,0,h.width,h.height,0,0,y,b)}let _=null;if(n){let y,b;if(c.symmetric&&h.width<t&&h.height<t)y=h.width,b=h.height;else if(h=this.#t,a>t||o>t){const C=Math.min(t/a,t/o);y=Math.floor(a*C),b=Math.floor(o*C),this.#c||(h=this.#h(y,b))}const S=new OffscreenCanvas(y,b).getContext("2d",{willReadFrequently:!0});S.drawImage(h,0,0,h.width,h.height,0,0,y,b),_={width:y,height:b,data:S.getImageData(0,0,y,b).data}}return{canvas:g,width:d,height:f,imageData:_}}#h(t,e){const{width:n,height:a}=this.#t;let o=n,c=a,h=this.#t;for(;o>2*t||c>2*e;){const d=o,f=c;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),c>2*e&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2));const g=new OffscreenCanvas(o,c);g.getContext("2d").drawImage(h,0,0,d,f,0,0,o,c),h=g.transferToImageBitmap()}return h}#m(){const[t,e]=this.parentDimensions,{width:n,height:a}=this,o=new Xn,c=Math.ceil(n*t*o.sx),h=Math.ceil(a*e*o.sy),d=this.#r;if(!d||d.width===c&&d.height===h)return;d.width=c,d.height=h;const f=this.#c?this.#t:this.#h(c,h),g=d.getContext("2d");g.filter=this._uiManager.hcmFilter,g.drawImage(f,0,0,f.width,f.height,0,0,c,h)}#b(t){if(t){if(this.#c){const a=this._uiManager.imageManager.getSvgUrl(this.#e);if(a)return a}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#c){const[e,n]=this.pageDimensions,a=Math.round(this.width*e*qa.PDF_TO_CSS_UNITS),o=Math.round(this.height*n*qa.PDF_TO_CSS_UNITS),c=new OffscreenCanvas(a,o);return c.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,a,o),c.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,n){let a=null,o=!1;if(t instanceof Fv){const{data:{rect:S,rotation:C,id:w,structParent:D,popupRef:x,contentsObj:k},container:O,parent:{page:{pageNumber:P}},canvas:j}=t;let Y,K;j?(delete t.canvas,{id:Y,bitmap:K}=n.imageManager.getFromCanvas(O.id,j),j.remove()):(o=!0,t._hasNoCanvas=!0);const it=(await e._structTree.getAriaAttributes(`${Bf}${w}`))?.get("aria-label")||"";a=t={annotationType:mt.STAMP,bitmapId:Y,bitmap:K,pageIndex:P-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:it},isSvg:!1,structParent:D,popupRef:x,comment:k?.str||null}}const c=await super.deserialize(t,e,n),{rect:h,bitmap:d,bitmapUrl:f,bitmapId:g,isSvg:_,accessibilityData:y}=t;o?(n.addMissingCanvas(t.id,c),c.#o=!0):g&&n.imageManager.isValidId(g)?(c.#e=g,d&&(c.#t=d)):c.#i=f,c.#c=_;const[b,A]=c.pageDimensions;return c.width=(h[2]-h[0])/b,c.height=(h[3]-h[1])/A,y&&(c.altTextData=y),c._initialData=a,t.comment&&c.setCommentData(t.comment),c.#d=!!a,c}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:mt.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(this.addComment(n),t)return n.bitmapUrl=this.#b(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:a,altText:o}=this.serializeAltText(!1);if(!a&&o&&(n.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const h=this.#_(n);if(h.isSame)return null;h.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,e===null)return n;e.stamps||=new Map;const c=this.#c?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:c,serialized:n}),n.bitmap=this.#b(!1);else if(this.#c){const h=e.stamps.get(this.#e);c>h.area&&(h.area=c,h.serialized.bitmap.close(),h.serialized.bitmap=this.#b(!1))}return n}#_(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,a=t.pageIndex===e,o=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&a&&o,isSameAltText:o}}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}}class hi{#t;#e=!1;#n=null;#i=null;#a=null;#s=new Map;#r=!1;#o=!1;#l=!1;#c=null;#d=null;#u=null;#f=null;#g=null;#p=-1;#h;static _initialized=!1;static#m=new Map([Se,Kf,Bw,re,Vn].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:a,accessibilityManager:o,annotationLayer:c,drawLayer:h,textLayer:d,viewport:f,l10n:g}){const _=[...hi.#m.values()];if(!hi._initialized){hi._initialized=!0;for(const y of _)y.initialize(g,t)}t.registerEditorTypes(_),this.#h=t,this.pageIndex=e,this.div=n,this.#t=o,this.#n=c,this.viewport=f,this.#u=d,this.drawLayer=h,this._structTree=a,this.#h.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===mt.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#y(),t){case mt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case mt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case mt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const n of hi.#m.values())e.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#u?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.div.classList.toggle("disabled",!t)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#g?.abort(),this.#g=null;const t=new Set;for(const n of this.#s.values())n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#h.removeChangedExistingAnnotation(n),t.add(n.annotationElementId));if(!this.#n){this.#l=!1;return}const e=this.#n.getEditableAnnotations();for(const n of e){if(n.hide(),this.#h.isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;const a=await this.deserialize(n);a&&(this.addOrRebuild(a),a.enableEditing())}this.#l=!1}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#u&&!this.#g){this.#g=new AbortController;const a=this.#h.combinedSignal(this.#g);this.#u.div.addEventListener("pointerdown",o=>{const{clientX:h,clientY:d,timeStamp:f}=o,g=this.#p;if(f-g>500){this.#p=f;return}this.#p=-1;const{classList:_}=this.div;_.toggle("getElements",!0);const y=document.elementsFromPoint(h,d);if(_.toggle("getElements",!1),!this.div.contains(y[0]))return;let b;const A=new RegExp(`^${lv}[0-9]+$`);for(const C of y)if(A.test(C.id)){b=C.id;break}if(!b)return;const S=this.#s.get(b);S?.annotationElementId===null&&(o.stopPropagation(),o.preventDefault(),S.dblclick())},{signal:a,capture:!0})}const t=new Map,e=new Map;for(const a of this.#s.values())if(a.disableEditing(),!!a.annotationElementId){if(a.serialize()!==null){t.set(a.annotationElementId,a);continue}else e.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}if(this.#n){const a=this.#n.getEditableAnnotations();for(const o of a){const{id:c}=o.data;if(this.#h.isDeletedAnnotationElement(c)){o.updateEdited({deleted:!0});continue}let h=e.get(c);if(h){h.resetAnnotationElement(o),h.show(!1),o.show();continue}h=t.get(c),h&&(this.#h.addChangedExistingAnnotation(h),h.renderAnnotationElement(o)&&h.show(!1)),o.show()}}this.#y(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const a of hi.#m.values())n.remove(`${a._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#f){this.#f=new AbortController;const t=this.#h.combinedSignal(this.#f);this.#u.div.addEventListener("pointerdown",this.#b.bind(this),{signal:t}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#u.div.classList.remove("highlighting"))}#b(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#u.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#u.div.contains(e)){const{isMac:n}=ke.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#h.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),re.startHighlighting(this,this.#h.direction==="ltr",{target:this.#u.div,x:t.x,y:t.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const t=this.#h.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#s.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#s.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t.annotationElementId),ct.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#l),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getNextId(){return this.#h.getId()}get#_(){return hi.#m.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#A(t){const e=this.#_;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#_?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:n,offsetY:a}=this.#S(),o=this.getNextId(),c=this.#A({parent:this,id:o,x:n,y:a,uiManager:this.#h,isCentered:!0,...e});c&&this.add(c)}async deserialize(t){return await hi.#m.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,n={}){const a=this.getNextId(),o=this.#A({parent:this,id:a,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...n});return o&&this.add(o),o}#S(){const{x:t,y:e,width:n,height:a}=this.div.getBoundingClientRect(),o=Math.max(0,t),c=Math.max(0,e),h=Math.min(window.innerWidth,t+n),d=Math.min(window.innerHeight,e+a),f=(o+h)/2-t,g=(c+d)/2-e,[_,y]=this.viewport.rotation%180===0?[f,g]:[g,f];return{offsetX:_,offsetY:y}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=ke.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#r||(this.#r=!1,this.#_?.isDrawer&&this.#_.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const n=this.#h.getMode();if(n===mt.STAMP||n===mt.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===mt.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:e}=ke.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#r=!0,this.#_?.isDrawer){this.startDrawingSession(t);return}const n=this.#h.getActive();this.#e=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#c){this.#_.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#c=new AbortController;const e=this.#h.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#_.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#c?(this.#h.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#_.endDrawing(t)):null}findNewParent(t,e,n){const a=this.#h.findParent(e,n);return a===null||a===this?!1:(a.changeParent(t),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#_.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#s.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#s.clear(),this.#h.removeLayer(this)}#y(){for(const t of this.#s.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Ns(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#y();const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Ns(this.div,{rotation:n}),e!==n)for(const a of this.#s.values())a.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class Me{#t=null;#e=new Map;#n=new Map;static#i=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return Tt(this,"_svgFactory",new xc)}static#a(t,[e,n,a,o]){const{style:c}=t;c.top=`${100*n}%`,c.left=`${100*e}%`,c.width=`${100*a}%`,c.height=`${100*o}%`}#s(){const t=Me._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#r(t,e){const n=Me._svgFactory.createElement("clipPath");t.append(n);const a=`clip_${e}`;n.setAttribute("id",a),n.setAttribute("clipPathUnits","objectBoundingBox");const o=Me._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${e}`),o.classList.add("clip"),a}#o(t,e){for(const[n,a]of Object.entries(e))a===null?t.removeAttribute(n):t.setAttribute(n,a)}draw(t,e=!1,n=!1){const a=Me.#i++,o=this.#s(),c=Me._svgFactory.createElement("defs");o.append(c);const h=Me._svgFactory.createElement("path");c.append(h);const d=`path_p${this.pageIndex}_${a}`;h.setAttribute("id",d),h.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(a,h);const f=n?this.#r(c,d):null,g=Me._svgFactory.createElement("use");return o.append(g),g.setAttribute("href",`#${d}`),this.updateProperties(o,t),this.#e.set(a,o),{id:a,clipPathId:`url(#${f})`}}drawOutline(t,e){const n=Me.#i++,a=this.#s(),o=Me._svgFactory.createElement("defs");a.append(o);const c=Me._svgFactory.createElement("path");o.append(c);const h=`path_p${this.pageIndex}_${n}`;c.setAttribute("id",h),c.setAttribute("vector-effect","non-scaling-stroke");let d;if(e){const _=Me._svgFactory.createElement("mask");o.append(_),d=`mask_p${this.pageIndex}_${n}`,_.setAttribute("id",d),_.setAttribute("maskUnits","objectBoundingBox");const y=Me._svgFactory.createElement("rect");_.append(y),y.setAttribute("width","1"),y.setAttribute("height","1"),y.setAttribute("fill","white");const b=Me._svgFactory.createElement("use");_.append(b),b.setAttribute("href",`#${h}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const f=Me._svgFactory.createElement("use");a.append(f),f.setAttribute("href",`#${h}`),d&&f.setAttribute("mask",`url(#${d})`);const g=f.cloneNode();return a.append(g),f.classList.add("mainOutline"),g.classList.add("secondaryOutline"),this.updateProperties(a,t),this.#e.set(n,a),n}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:a,rootClass:o,path:c}=e,h=typeof t=="number"?this.#e.get(t):t;if(h){if(n&&this.#o(h,n),a&&Me.#a(h,a),o){const{classList:d}=h;for(const[f,g]of Object.entries(o))d.toggle(f,g)}if(c){const f=h.firstChild.firstChild;this.#o(f,c)}}}updateParent(t,e){if(e===this)return;const n=this.#e.get(t);n&&(e.#t.append(n),this.#e.delete(t),e.#e.set(t,n))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:lf};globalThis.pdfjsLib={AbortException:Zi,AnnotationEditorLayer:hi,AnnotationEditorParamsType:Ot,AnnotationEditorType:mt,AnnotationEditorUIManager:Ji,AnnotationLayer:Wf,AnnotationMode:Xi,AnnotationType:de,build:pw,ColorPicker:En,createValidAbsoluteUrl:cv,DOMSVGFactory:xc,DrawLayer:Me,FeatureTest:ke,fetchData:Fo,getDocument:Dv,getFilenameFromUrl:a1,getPdfFilenameFromUrl:r1,getRGB:Zc,getUuid:dv,getXfaPageViewport:l1,GlobalWorkerOptions:Ha,ImageKind:vc,InvalidPDFException:tf,isDataScheme:Qc,isPdfFile:Hf,isValidExplicitDest:b1,MathClamp:Ue,noContextMenu:Cn,normalizeUnicode:n1,OPS:So,OutputScale:Xn,PasswordResponses:XE,PDFDataRangeTransport:Mv,PDFDateString:ef,PDFWorker:wo,PermissionFlag:YE,PixelsPerInch:qa,RenderingCancelledException:Ff,ResponseException:Cc,setLayerDimensions:Ns,shadow:Tt,SignatureExtractor:ka,stopEvent:fe,SupportedImageMimeTypes:nf,TextLayer:He,TouchManager:Jc,updateUrlHash:uv,Util:at,VerbosityLevel:$c,version:fw,XfaLayer:kv};const hf=(r,t)=>t.some(e=>r instanceof e);let lb,cb;function Fw(){return lb||(lb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Hw(){return cb||(cb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const df=new WeakMap,zd=new WeakMap,nu=new WeakMap;function zw(r){const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("success",o),r.removeEventListener("error",c)},o=()=>{e(Ms(r.result)),a()},c=()=>{n(r.error),a()};r.addEventListener("success",o),r.addEventListener("error",c)});return nu.set(t,r),t}function Uw(r){if(df.has(r))return;const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",c),r.removeEventListener("abort",c)},o=()=>{e(),a()},c=()=>{n(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",o),r.addEventListener("error",c),r.addEventListener("abort",c)});df.set(r,t)}let ff={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return df.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ms(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Uv(r){ff=r(ff)}function jw(r){return Hw().includes(r)?function(...t){return r.apply(pf(this),t),Ms(this.request)}:function(...t){return Ms(r.apply(pf(this),t))}}function Gw(r){return typeof r=="function"?jw(r):(r instanceof IDBTransaction&&Uw(r),hf(r,Fw())?new Proxy(r,ff):r)}function Ms(r){if(r instanceof IDBRequest)return zw(r);if(zd.has(r))return zd.get(r);const t=Gw(r);return t!==r&&(zd.set(r,t),nu.set(t,r)),t}const pf=r=>nu.get(r);function Jf(r,t,{blocked:e,upgrade:n,blocking:a,terminated:o}={}){const c=indexedDB.open(r,t),h=Ms(c);return n&&c.addEventListener("upgradeneeded",d=>{n(Ms(c.result),d.oldVersion,d.newVersion,Ms(c.transaction),d)}),e&&c.addEventListener("blocked",d=>e(d.oldVersion,d.newVersion,d)),h.then(d=>{o&&d.addEventListener("close",()=>o()),a&&d.addEventListener("versionchange",f=>a(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}const Vw=["get","getKey","getAll","getAllKeys","count"],qw=["put","add","delete","clear"],Ud=new Map;function ub(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Ud.get(t))return Ud.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,a=qw.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Vw.includes(e)))return;const o=async function(c,...h){const d=this.transaction(c,a?"readwrite":"readonly");let f=d.store;return n&&(f=f.index(h.shift())),(await Promise.all([f[e](...h),a&&d.done]))[0]};return Ud.set(t,o),o}Uv(r=>({...r,get:(t,e,n)=>ub(t,e)||r.get(t,e,n),has:(t,e)=>!!ub(t,e)||r.has(t,e)}));const Yw=["continue","continuePrimaryKey","advance"],hb={},gf=new WeakMap,jv=new WeakMap,Xw={get(r,t){if(!Yw.includes(t))return r[t];let e=hb[t];return e||(e=hb[t]=function(...n){gf.set(this,jv.get(this)[t](...n))}),e}};async function*$w(...r){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...r)),!t)return;t=t;const e=new Proxy(t,Xw);for(jv.set(e,t),nu.set(e,pf(t));t;)yield e,t=await(gf.get(e)||t.continue()),gf.delete(e)}function db(r,t){return t===Symbol.asyncIterator&&hf(r,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&hf(r,[IDBIndex,IDBObjectStore])}Uv(r=>({...r,get(t,e,n){return db(t,e)?$w:r.get(t,e,n)},has(t,e){return db(t,e)||r.has(t,e)}}));Ha.workerSrc="./pdf.worker.min.js";async function Ww(r){const t=await Dv({url:URL.createObjectURL(r)}).promise,e=[];for(let n=0;n<t.numPages;n++){const a=await t.getPage(n+1),o=await Kw(a);e.push(o)}return e}async function Kw(r){const n=(await r.getTextContent()).items.map(f=>{const[g,_,y,b,A,S]=f.transform;return{text:f.str,x:A,y:S,width:f.width,height:b}}).sort((f,g)=>Math.abs(f.y-g.y)>5?g.y-f.y:f.x-g.x),a=[];let o=[],c=null;const h=5;for(let f of n)c===null||Math.abs(f.y-c)<=h?(o.push(f),c===null?c=f.y:c=o.reduce((g,_)=>g+_.y,0)/o.length):(o.length&&a.push(o),o=[f],c=f.y);o.length&&a.push(o);let d="";for(let f of a){f.sort((y,b)=>y.x-b.x);let g="",_=null;for(let y of f)_!==null&&y.x-_>y.height*.2&&(g+=" "),g+=y.text,_=y.x+y.width;g.trim()&&(d+=g+`
`)}return d.trim()}function Qw(r){return!r||!Array.isArray(r)||r.length===0?(console.warn("No se pudo extraer texto del PDF"),{}):r}function Zw(r){const t=["Fecha Fin","Frec. Horas","F. Real de Ejecucion","Frec. Comb.","Incidencia"],e={"Numero orden":/Número orden\s+?(\d+)/,"Tipo de Orden":/[A-Z0-9]\nClase/,Clase:/Clase (.+?) Asignado a/,"Asignado a":/Asignado a (.+?)\n/,Descripcion:/Descripción (.+?) Tipo/,Tipo:/Tipo (.+?) Estado/,Estado:/Estado (.+?) Frec/,"Frec. Dias":/Frec\. D[ií]as ([0-9]+)/,"N Unidad":/Nº Unidad (.+?) Parte/,Parte:/Parte (.+?) F inicial/,"F inicial":/F inicial ([0-9/]+)/,"Frec. Comb.":/Frec\. Comb\. (.+?)/,Especialidad:/Especialidad (.+?) Elemento/,Elemento:/Elemento (.+?) FF\.\.RReeaall/,"F. Real de Ejecucion":/FF\.\.RReeaall EEjjeeccuucciioonn (.+?) Frec\. Km/,"Frec. Km":/Frec\. Km ([^ ]*)/,Modo:/Modo ([^ ]*?)(?:\s+(?:Fecha Fin|Frec\. Horas))/,"Fecha Fin":/Fecha Fin ([0-9/]+)/,"Frec. Horas":/Frec\. Horas ([^ ]*)/,Originador:/Originador\s+?([A-Z]+ [A-ZÁÉÍÓÚÑa-z\s]+)\nIncidencia/,Incidencia:/Incidencia (.+?) Fecha Venc\./,"Fecha Venc.":/Fecha Venc\. ([0-9/]+)/,"Ultima Realiz.":/Ultima Realiz\.\s+?([0-9/]+)/,Linea:/Linea (.+?) Kit de Tareas/,"Kit de Tareas":/Kit de Tareas ([0-9]+)/,"Proximo Venc.":/Proximo Venc\. ([0-9/]+)/,"Fecha Prox Emision":/Fecha Prox Emisión ([0-9/]+)/,"N de Serie":/Nº de Serie (.+?) Planta/,Planta:/Planta (.+?) Tipo servici/,"Tipo servici":/Tipo servici ([A-Z0-9]+ [A-ZÁÉÍÓÚÑa-z\.]+)/,Prioridad:/Prioridad: ([A-Z\-a-z]+)/,"Seg. y Medio Ambiente":/Seg\. y Medio Ambiente ([A-Z0-9]+)/,Calidad:/Calidad ([A-Z0-9]+)/,Operacion:/Operación ([A-Z0-9]+)/,Mantenimiento:/Mantenimiento ([A-Z0-9]+)/,Categorizacion:/Categorización\s+?([A-Z0-9]+)/,"Tipo de Servicio":/Tipo de Servicio (.+?)\n/},n={};t.forEach(o=>n[o]=null);for(const[o,c]of Object.entries(e)){const h=r.match(c);h&&(n[o]=h[1].trim())}let a=n["Tipo de Servicio"];return a&&a.includes("SYS")?a=1:a&&a.includes("CCL")?a=2:a=3,n["Frec. Dias"]=n["Frec. Dias"]&&!isNaN(n["Frec. Dias"])?parseInt(n["Frec. Dias"]):null,n.prioridad=a,n.asignado_a_code=null,n.asignado_por_name=null,n.asignado_por_code=null,n.Especialidad_id=null,n.hs_reales=0,n.fecha_inicio=null,n.fecha_fin=null,n.observaciones=null,n.status=0,n.obs_anulada=null,n.code_orden_anulada=null,n.checkListDict={},n}function Jw(r){const t=r.split(`
`),e=[];let n=0;const a=/^([A-ZÁÉÍÓÚÑa-z0-9]+)\s+([\d\S]+)\s+(\d+)\s+(.*)\s+(\d\.\d+|\.\d+)\s+(.+)/,o=/^([A-ZÁÉÍÓÚÑa-z0-9]+)\s+([\d\.]+)\s+(\d+)\s+(.+)/;let c=0;for(let h=17;h<t.length;h++){const d=t[h];let f=d.match(a);if(f){let g=parseFloat(f[5]);isNaN(g)&&(g=0);const _={Taller:f[1],"Numero sec oper":parseFloat(f[2]),"Tarea Standard":f[3],Descripcion:f[4],"Hs Estim":g,"Valor esperado":f[6],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};e.push(_),n++}else if(f=d.match(o),f){const g={Taller:f[1],"Numero sec oper":parseFloat(f[2]),"Tarea Standard":f[3],Descripcion:f[4],"Hs Estim":0,"Valor esperado":f[4],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};e.push(g),n++}else{try{c=e.reduce((g,_)=>g+(_["Hs Estim"]||0),0),c=Math.round(c*1e3)/1e3}catch{c=0}return{data:e,Tasks_N:n,h_estimadas:c}}}try{c=e.reduce((h,d)=>h+(d["Hs Estim"]||0),0),c=Math.round(c*1e3)/1e3}catch{c=0}return{data:e,Tasks_N:n,h_estimadas:c}}function tC(r,t){let e="";const n=["OT Generadas","Realizado por:","Firma:"];e=t.split(`
`).slice(r+17).join(`
`).trim();for(const o of n){const c=e.indexOf(o);if(c!==-1){e=e.slice(0,c).trim();break}}return e}function eC(r,t){t=tC(r,t);const e=/^(.?.?T\d+)/im,n=/^(.?.?SEGURIDAD)|^(.?.?SGURIDAD)/im,a=[];let o="",c="",h=0,d=0;for(const f of t.split(`
`))e.test(f)?(h===1&&(c!==""&&(o=c+`
`+o),a.push(o)),o=f,h=1,d=0):n.test(f)&&h===1&&d===0?o+=`
`+f:n.test(f)?d===1&&h===1?(o=c+`
`+o,a.push(o)):(c=f,h=2,d=1):h===1?o+=`
`+f:h===2&&(c+=`
`+f);return h===1?(c!==""&&(o=c+`
`+o),a.push(o)):h===2&&c!==""&&a.push(c),a}function nC(r){const t=Qw(r),e=/Número orden\s+?(\d+)/,n=/(\nOT Generadas)|(\nRealizado por:)|(\nFirma:)/g,a="",o={};for(const c of t){let h;if((h=e.exec(c))!==null){const d=h[1];if(o[d]){let f=c.replace(n,a);f=f.split(`
`).slice(3).join(`
`),o[d].data+=`
`+f}else{o[d]={};let f=c.replace(n,a);o[d].data=f}}}for(const c in o)o[c].info=Zw(o[c].data),o[c].tasks=Jw(o[c].data),o[c].protocolos=eC(o[c].tasks.Tasks_N,o[c].data);return o}async function iC(r){let t=[];Array.isArray(r)?t=r:typeof r=="object"&&r!==null&&(t=Object.entries(r).map(([a,o])=>({id:a,...o})));const n=(await Jf("pdfDataDB",1,{upgrade(a){a.objectStoreNames.contains("pdfData")||a.createObjectStore("pdfData",{keyPath:"id"})}})).transaction("pdfData","readwrite");for(const a of t)await n.store.put(a);await n.done}async function sC(r,t){const e=await Ww(r),n=nC(e);await iC(n),t(Object.keys(n).length)}const aC=()=>{};var fb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q=function(r,t){if(!r)throw Za(t)},Za=function(r){return new Error("Firebase Database ("+Gv.SDK_VERSION+") INTERNAL ASSERT FAILED: "+r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vv=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);a<128?t[e++]=a:a<2048?(t[e++]=a>>6|192,t[e++]=a&63|128):(a&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=a>>18|240,t[e++]=a>>12&63|128,t[e++]=a>>6&63|128,t[e++]=a&63|128):(t[e++]=a>>12|224,t[e++]=a>>6&63|128,t[e++]=a&63|128)}return t},rC=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const a=r[e++];if(a<128)t[n++]=String.fromCharCode(a);else if(a>191&&a<224){const o=r[e++];t[n++]=String.fromCharCode((a&31)<<6|o&63)}else if(a>239&&a<365){const o=r[e++],c=r[e++],h=r[e++],d=((a&7)<<18|(o&63)<<12|(c&63)<<6|h&63)-65536;t[n++]=String.fromCharCode(55296+(d>>10)),t[n++]=String.fromCharCode(56320+(d&1023))}else{const o=r[e++],c=r[e++];t[n++]=String.fromCharCode((a&15)<<12|(o&63)<<6|c&63)}}return t.join("")},tp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<r.length;a+=3){const o=r[a],c=a+1<r.length,h=c?r[a+1]:0,d=a+2<r.length,f=d?r[a+2]:0,g=o>>2,_=(o&3)<<4|h>>4;let y=(h&15)<<2|f>>6,b=f&63;d||(b=64,c||(y=64)),n.push(e[g],e[_],e[y],e[b])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Vv(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):rC(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<r.length;){const o=e[r.charAt(a++)],h=a<r.length?e[r.charAt(a)]:0;++a;const f=a<r.length?e[r.charAt(a)]:64;++a;const _=a<r.length?e[r.charAt(a)]:64;if(++a,o==null||h==null||f==null||_==null)throw new oC;const y=o<<2|h>>4;if(n.push(y),f!==64){const b=h<<4&240|f>>2;if(n.push(b),_!==64){const A=f<<6&192|_;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class oC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qv=function(r){const t=Vv(r);return tp.encodeByteArray(t,!0)},Rc=function(r){return qv(r).replace(/\./g,"")},mf=function(r){try{return tp.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lC(r){return Yv(void 0,r)}function Yv(r,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const e=t;return new Date(e.getTime());case Object:r===void 0&&(r={});break;case Array:r=[];break;default:return t}for(const e in t)!t.hasOwnProperty(e)||!cC(e)||(r[e]=Yv(r[e],t[e]));return r}function cC(r){return r!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC=()=>uC().__FIREBASE_DEFAULTS__,dC=()=>{if(typeof process>"u"||typeof fb>"u")return;const r=fb.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},fC=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&mf(r[1]);return t&&JSON.parse(t)},Xv=()=>{try{return aC()||hC()||dC()||fC()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},pC=r=>Xv()?.emulatorHosts?.[r],gC=r=>{const t=pC(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},$v=()=>Xv()?.config;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ep(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function mC(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _C(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",a=r.iat||0,o=r.sub||r.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...r};return[Rc(JSON.stringify(e)),Rc(JSON.stringify(c)),""].join(".")}const mo={};function yC(){const r={prod:[],emulator:[]};for(const t of Object.keys(mo))mo[t]?r.emulator.push(t):r.prod.push(t);return r}function bC(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let pb=!1;function vC(r,t){if(typeof window>"u"||typeof document>"u"||!ep(window.location.host)||mo[r]===t||mo[r]||pb)return;mo[r]=t;function e(y){return`__firebase__banner__${y}`}const n="__firebase__banner",o=yC().prod.length>0;function c(){const y=document.getElementById(n);y&&y.remove()}function h(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function d(y,b){y.setAttribute("width","24"),y.setAttribute("id",b),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function f(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{pb=!0,c()},y}function g(y,b){y.setAttribute("id",b),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function _(){const y=bC(n),b=e("text"),A=document.getElementById(b)||document.createElement("span"),S=e("learnmore"),C=document.getElementById(S)||document.createElement("a"),w=e("preprendIcon"),D=document.getElementById(w)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const x=y.element;h(x),g(C,S);const k=f();d(D,w),x.append(D,A,C,k),document.body.appendChild(x)}o?(A.innerText="Preview backend disconnected.",D.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(D.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AC(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Wv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(AC())}function SC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function EC(){return Gv.NODE_ADMIN===!0}function wC(){try{return typeof indexedDB=="object"}catch{return!1}}function CC(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},a.onupgradeneeded=()=>{e=!1},a.onerror=()=>{t(a.error?.message||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC="FirebaseError";class Go extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=TC,Object.setPrototypeOf(this,Go.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Kv.prototype.create)}}class Kv{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},a=`${this.service}/${t}`,o=this.errors[t],c=o?xC(o,n):"Error",h=`${this.serviceName}: ${c} (${a}).`;return new Go(a,h,n)}}function xC(r,t){return r.replace(RC,(e,n)=>{const a=t[n];return a!=null?String(a):`<${n}?>`})}const RC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function To(r){return JSON.parse(r)}function Ce(r){return JSON.stringify(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv=function(r){let t={},e={},n={},a="";try{const o=r.split(".");t=To(mf(o[0])||""),e=To(mf(o[1])||""),a=o[2],n=e.d||{},delete e.d}catch{}return{header:t,claims:e,data:n,signature:a}},DC=function(r){const t=Qv(r),e=t.claims;return!!e&&typeof e=="object"&&e.hasOwnProperty("iat")},MC=function(r){const t=Qv(r).claims;return typeof t=="object"&&t.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function Ya(r,t){if(Object.prototype.hasOwnProperty.call(r,t))return r[t]}function _f(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function Dc(r,t,e){const n={};for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=t.call(e,r[a],a,r));return n}function Mc(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const a of e){if(!n.includes(a))return!1;const o=r[a],c=t[a];if(gb(o)&&gb(c)){if(!Mc(o,c))return!1}else if(o!==c)return!1}for(const a of n)if(!e.includes(a))return!1;return!0}function gb(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NC(r){const t=[];for(const[e,n]of Object.entries(r))Array.isArray(n)?n.forEach(a=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(a))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if(typeof t=="string")for(let _=0;_<16;_++)n[_]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let _=0;_<16;_++)n[_]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let _=16;_<80;_++){const y=n[_-3]^n[_-8]^n[_-14]^n[_-16];n[_]=(y<<1|y>>>31)&4294967295}let a=this.chain_[0],o=this.chain_[1],c=this.chain_[2],h=this.chain_[3],d=this.chain_[4],f,g;for(let _=0;_<80;_++){_<40?_<20?(f=h^o&(c^h),g=1518500249):(f=o^c^h,g=1859775393):_<60?(f=o&c|h&(o|c),g=2400959708):(f=o^c^h,g=3395469782);const y=(a<<5|a>>>27)+f+d+g+n[_]&4294967295;d=h,h=c,c=(o<<30|o>>>2)&4294967295,o=a,a=y}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+d&4294967295}update(t,e){if(t==null)return;e===void 0&&(e=t.length);const n=e-this.blockSize;let a=0;const o=this.buf_;let c=this.inbuf_;for(;a<e;){if(c===0)for(;a<=n;)this.compress_(t,a),a+=this.blockSize;if(typeof t=="string"){for(;a<e;)if(o[c]=t.charCodeAt(a),++c,++a,c===this.blockSize){this.compress_(o),c=0;break}}else for(;a<e;)if(o[c]=t[a],++c,++a,c===this.blockSize){this.compress_(o),c=0;break}}this.inbuf_=c,this.total_+=e}digest(){const t=[];let e=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=e&255,e/=256;this.compress_(this.buf_);let n=0;for(let a=0;a<5;a++)for(let o=24;o>=0;o-=8)t[n]=this.chain_[a]>>o&255,++n;return t}}function Xa(r,t){return`${r} failed: ${t} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kC=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);if(a>=55296&&a<=56319){const o=a-55296;n++,Q(n<r.length,"Surrogate pair missing trail surrogate.");const c=r.charCodeAt(n)-56320;a=65536+(o<<10)+c}a<128?t[e++]=a:a<2048?(t[e++]=a>>6|192,t[e++]=a&63|128):a<65536?(t[e++]=a>>12|224,t[e++]=a>>6&63|128,t[e++]=a&63|128):(t[e++]=a>>18|240,t[e++]=a>>12&63|128,t[e++]=a>>6&63|128,t[e++]=a&63|128)}return t},iu=function(r){let t=0;for(let e=0;e<r.length;e++){const n=r.charCodeAt(e);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,e++):t+=3}return t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(r){return r&&r._delegate?r._delegate:r}class xo{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ss="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new fi;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:e});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(a){if(n)return null;throw a}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(PC(t))try{this.getOrInitializeService({instanceIdentifier:Ss})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:a});n.resolve(o)}catch{}}}}clearInstance(t=Ss){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ss){return this.instances.has(t)}getOptions(t=Ss){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[o,c]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(o);n===h&&c.resolve(a)}return a}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),a=this.onInitCallbacks.get(n)??new Set;a.add(t),this.onInitCallbacks.set(n,a);const o=this.instances.get(n);return o&&t(o,n),()=>{a.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const a of n)try{a(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:IC(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=Ss){return this.component?this.component.multipleInstances?t:Ss:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function IC(r){return r===Ss?void 0:r}function PC(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new LC(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $t;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})($t||($t={}));const FC={debug:$t.DEBUG,verbose:$t.VERBOSE,info:$t.INFO,warn:$t.WARN,error:$t.ERROR,silent:$t.SILENT},HC=$t.INFO,zC={[$t.DEBUG]:"log",[$t.VERBOSE]:"log",[$t.INFO]:"info",[$t.WARN]:"warn",[$t.ERROR]:"error"},UC=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),a=zC[t];if(a)console[a](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Zv{constructor(t){this.name=t,this._logLevel=HC,this._logHandler=UC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in $t))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?FC[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,$t.DEBUG,...t),this._logHandler(this,$t.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,$t.VERBOSE,...t),this._logHandler(this,$t.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,$t.INFO,...t),this._logHandler(this,$t.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,$t.WARN,...t),this._logHandler(this,$t.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,$t.ERROR,...t),this._logHandler(this,$t.ERROR,...t)}}const jC=(r,t)=>t.some(e=>r instanceof e);let mb,_b;function GC(){return mb||(mb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function VC(){return _b||(_b=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Jv=new WeakMap,yf=new WeakMap,t0=new WeakMap,jd=new WeakMap,np=new WeakMap;function qC(r){const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("success",o),r.removeEventListener("error",c)},o=()=>{e(Wi(r.result)),a()},c=()=>{n(r.error),a()};r.addEventListener("success",o),r.addEventListener("error",c)});return t.then(e=>{e instanceof IDBCursor&&Jv.set(e,r)}).catch(()=>{}),np.set(t,r),t}function YC(r){if(yf.has(r))return;const t=new Promise((e,n)=>{const a=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",c),r.removeEventListener("abort",c)},o=()=>{e(),a()},c=()=>{n(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",o),r.addEventListener("error",c),r.addEventListener("abort",c)});yf.set(r,t)}let bf={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return yf.get(r);if(t==="objectStoreNames")return r.objectStoreNames||t0.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Wi(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function XC(r){bf=r(bf)}function $C(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(Gd(this),t,...e);return t0.set(n,t.sort?t.sort():[t]),Wi(n)}:VC().includes(r)?function(...t){return r.apply(Gd(this),t),Wi(Jv.get(this))}:function(...t){return Wi(r.apply(Gd(this),t))}}function WC(r){return typeof r=="function"?$C(r):(r instanceof IDBTransaction&&YC(r),jC(r,GC())?new Proxy(r,bf):r)}function Wi(r){if(r instanceof IDBRequest)return qC(r);if(jd.has(r))return jd.get(r);const t=WC(r);return t!==r&&(jd.set(r,t),np.set(t,r)),t}const Gd=r=>np.get(r);function KC(r,t,{blocked:e,upgrade:n,blocking:a,terminated:o}={}){const c=indexedDB.open(r,t),h=Wi(c);return n&&c.addEventListener("upgradeneeded",d=>{n(Wi(c.result),d.oldVersion,d.newVersion,Wi(c.transaction),d)}),e&&c.addEventListener("blocked",d=>e(d.oldVersion,d.newVersion,d)),h.then(d=>{o&&d.addEventListener("close",()=>o()),a&&d.addEventListener("versionchange",f=>a(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}const QC=["get","getKey","getAll","getAllKeys","count"],ZC=["put","add","delete","clear"],Vd=new Map;function yb(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Vd.get(t))return Vd.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,a=ZC.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(a||QC.includes(e)))return;const o=async function(c,...h){const d=this.transaction(c,a?"readwrite":"readonly");let f=d.store;return n&&(f=f.index(h.shift())),(await Promise.all([f[e](...h),a&&d.done]))[0]};return Vd.set(t,o),o}XC(r=>({...r,get:(t,e,n)=>yb(t,e)||r.get(t,e,n),has:(t,e)=>!!yb(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(tT(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function tT(r){return r.getComponent()?.type==="VERSION"}const vf="@firebase/app",bb="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mi=new Zv("@firebase/app"),eT="@firebase/app-compat",nT="@firebase/analytics-compat",iT="@firebase/analytics",sT="@firebase/app-check-compat",aT="@firebase/app-check",rT="@firebase/auth",oT="@firebase/auth-compat",lT="@firebase/database",cT="@firebase/data-connect",uT="@firebase/database-compat",hT="@firebase/functions",dT="@firebase/functions-compat",fT="@firebase/installations",pT="@firebase/installations-compat",gT="@firebase/messaging",mT="@firebase/messaging-compat",_T="@firebase/performance",yT="@firebase/performance-compat",bT="@firebase/remote-config",vT="@firebase/remote-config-compat",AT="@firebase/storage",ST="@firebase/storage-compat",ET="@firebase/firestore",wT="@firebase/ai",CT="@firebase/firestore-compat",TT="firebase",xT="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Af="[DEFAULT]",RT={[vf]:"fire-core",[eT]:"fire-core-compat",[iT]:"fire-analytics",[nT]:"fire-analytics-compat",[aT]:"fire-app-check",[sT]:"fire-app-check-compat",[rT]:"fire-auth",[oT]:"fire-auth-compat",[lT]:"fire-rtdb",[cT]:"fire-data-connect",[uT]:"fire-rtdb-compat",[hT]:"fire-fn",[dT]:"fire-fn-compat",[fT]:"fire-iid",[pT]:"fire-iid-compat",[gT]:"fire-fcm",[mT]:"fire-fcm-compat",[_T]:"fire-perf",[yT]:"fire-perf-compat",[bT]:"fire-rc",[vT]:"fire-rc-compat",[AT]:"fire-gcs",[ST]:"fire-gcs-compat",[ET]:"fire-fst",[CT]:"fire-fst-compat",[wT]:"fire-vertex","fire-js":"fire-js",[TT]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc=new Map,DT=new Map,Sf=new Map;function vb(r,t){try{r.container.addComponent(t)}catch(e){mi.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Oc(r){const t=r.name;if(Sf.has(t))return mi.debug(`There were multiple attempts to register component ${t}.`),!1;Sf.set(t,r);for(const e of Nc.values())vb(e,r);for(const e of DT.values())vb(e,r);return!0}function MT(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function NT(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ki=new Kv("app","Firebase",OT);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kT{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new xo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ki.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT=xT;function e0(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:Af,automaticDataCollectionEnabled:!0,...t},a=n.name;if(typeof a!="string"||!a)throw Ki.create("bad-app-name",{appName:String(a)});if(e||(e=$v()),!e)throw Ki.create("no-options");const o=Nc.get(a);if(o){if(Mc(e,o.options)&&Mc(n,o.config))return o;throw Ki.create("duplicate-app",{appName:a})}const c=new BC(a);for(const d of Sf.values())c.addComponent(d);const h=new kT(e,n,c);return Nc.set(a,h),h}function IT(r=Af){const t=Nc.get(r);if(!t&&r===Af&&$v())return e0();if(!t)throw Ki.create("no-app",{appName:r});return t}function za(r,t,e){let n=RT[r]??r;e&&(n+=`-${e}`);const a=n.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const c=[`Unable to register library "${n}" with version "${t}":`];a&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),a&&o&&c.push("and"),o&&c.push(`version name "${t}" contains illegal characters (whitespace or "/")`),mi.warn(c.join(" "));return}Oc(new xo(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT="firebase-heartbeat-database",BT=1,Ro="firebase-heartbeat-store";let qd=null;function n0(){return qd||(qd=KC(PT,BT,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Ro)}catch(e){console.warn(e)}}}}).catch(r=>{throw Ki.create("idb-open",{originalErrorMessage:r.message})})),qd}async function FT(r){try{const e=(await n0()).transaction(Ro),n=await e.objectStore(Ro).get(i0(r));return await e.done,n}catch(t){if(t instanceof Go)mi.warn(t.message);else{const e=Ki.create("idb-get",{originalErrorMessage:t?.message});mi.warn(e.message)}}}async function Ab(r,t){try{const n=(await n0()).transaction(Ro,"readwrite");await n.objectStore(Ro).put(t,i0(r)),await n.done}catch(e){if(e instanceof Go)mi.warn(e.message);else{const n=Ki.create("idb-set",{originalErrorMessage:e?.message});mi.warn(n.message)}}}function i0(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HT=1024,zT=30;class UT{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new GT(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Sb();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(a=>a.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>zT){const a=VT(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){mi.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Sb(),{heartbeatsToSend:e,unsentEntries:n}=jT(this._heartbeatsCache.heartbeats),a=Rc(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return mi.warn(t),""}}}function Sb(){return new Date().toISOString().substring(0,10)}function jT(r,t=HT){const e=[];let n=r.slice();for(const a of r){const o=e.find(c=>c.agent===a.agent);if(o){if(o.dates.push(a.date),Eb(e)>t){o.dates.pop();break}}else if(e.push({agent:a.agent,dates:[a.date]}),Eb(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class GT{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return wC()?CC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await FT(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Ab(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Ab(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Eb(r){return Rc(JSON.stringify({version:2,heartbeats:r})).length}function VT(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qT(r){Oc(new xo("platform-logger",t=>new JC(t),"PRIVATE")),Oc(new xo("heartbeat",t=>new UT(t),"PRIVATE")),za(vf,bb,r),za(vf,bb,"esm2020"),za("fire-js","")}qT("");var YT="firebase",XT="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */za(YT,XT,"app");var wb={};const Cb="@firebase/database",Tb="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s0="";function $T(r){s0=r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WT{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Ce(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:To(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return $n(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0=function(r){try{if(typeof window<"u"&&typeof window[r]<"u"){const t=window[r];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new WT(t)}}catch{}return new KT},Cs=a0("localStorage"),QT=a0("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua=new Zv("@firebase/database"),ZT=(function(){let r=1;return function(){return r++}})(),r0=function(r){const t=kC(r),e=new OC;e.update(t);const n=e.digest();return tp.encodeByteArray(n)},Vo=function(...r){let t="";for(let e=0;e<r.length;e++){const n=r[e];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?t+=Vo.apply(null,n):typeof n=="object"?t+=Ce(n):t+=n,t+=" "}return t};let _o=null,xb=!0;const JT=function(r,t){Q(!0,"Can't turn on custom loggers persistently."),Ua.logLevel=$t.VERBOSE,_o=Ua.log.bind(Ua)},Oe=function(...r){if(xb===!0&&(xb=!1,_o===null&&QT.get("logging_enabled")===!0&&JT()),_o){const t=Vo.apply(null,r);_o(t)}},qo=function(r){return function(...t){Oe(r,...t)}},Ef=function(...r){const t="FIREBASE INTERNAL ERROR: "+Vo(...r);Ua.error(t)},_i=function(...r){const t=`FIREBASE FATAL ERROR: ${Vo(...r)}`;throw Ua.error(t),new Error(t)},Je=function(...r){const t="FIREBASE WARNING: "+Vo(...r);Ua.warn(t)},tx=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Je("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},su=function(r){return typeof r=="number"&&(r!==r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)},ex=function(r){if(document.readyState==="complete")r();else{let t=!1;const e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,r())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},$a="[MIN_NAME]",ks="[MAX_NAME]",zs=function(r,t){if(r===t)return 0;if(r===$a||t===ks)return-1;if(t===$a||r===ks)return 1;{const e=Rb(r),n=Rb(t);return e!==null?n!==null?e-n===0?r.length-t.length:e-n:-1:n!==null?1:r<t?-1:1}},nx=function(r,t){return r===t?0:r<t?-1:1},oo=function(r,t){if(t&&r in t)return t[r];throw new Error("Missing required key ("+r+") in object: "+Ce(t))},ip=function(r){if(typeof r!="object"||r===null)return Ce(r);const t=[];for(const n in r)t.push(n);t.sort();let e="{";for(let n=0;n<t.length;n++)n!==0&&(e+=","),e+=Ce(t[n]),e+=":",e+=ip(r[t[n]]);return e+="}",e},o0=function(r,t){const e=r.length;if(e<=t)return[r];const n=[];for(let a=0;a<e;a+=t)a+t>e?n.push(r.substring(a,e)):n.push(r.substring(a,a+t));return n};function Be(r,t){for(const e in r)r.hasOwnProperty(e)&&t(e,r[e])}const l0=function(r){Q(!su(r),"Invalid JSON number");const t=11,e=52,n=(1<<t-1)-1;let a,o,c,h,d;r===0?(o=0,c=0,a=1/r===-1/0?1:0):(a=r<0,r=Math.abs(r),r>=Math.pow(2,1-n)?(h=Math.min(Math.floor(Math.log(r)/Math.LN2),n),o=h+n,c=Math.round(r*Math.pow(2,e-h)-Math.pow(2,e))):(o=0,c=Math.round(r/Math.pow(2,1-n-e))));const f=[];for(d=e;d;d-=1)f.push(c%2?1:0),c=Math.floor(c/2);for(d=t;d;d-=1)f.push(o%2?1:0),o=Math.floor(o/2);f.push(a?1:0),f.reverse();const g=f.join("");let _="";for(d=0;d<64;d+=8){let y=parseInt(g.substr(d,8),2).toString(16);y.length===1&&(y="0"+y),_=_+y}return _.toLowerCase()},ix=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},sx=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function ax(r,t){let e="Unknown Error";r==="too_big"?e="The data requested exceeds the maximum size that can be accessed with a single request.":r==="permission_denied"?e="Client doesn't have permission to access the desired data.":r==="unavailable"&&(e="The service is unavailable");const n=new Error(r+" at "+t._path.toString()+": "+e);return n.code=r.toUpperCase(),n}const rx=new RegExp("^-?(0*)\\d{1,10}$"),ox=-2147483648,lx=2147483647,Rb=function(r){if(rx.test(r)){const t=Number(r);if(t>=ox&&t<=lx)return t}return null},Ja=function(r){try{r()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Je("Exception was thrown by user callback.",e),t},Math.floor(0))}},cx=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},yo=function(r,t){const e=setTimeout(r,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ux{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,NT(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(n=>this.appCheck=n)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,n)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){this.appCheckProvider?.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Je(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hx{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(a=>this.auth_=a)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?(Oe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,n)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Je(t)}}class Ec{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}Ec.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sp="5",c0="v",u0="s",h0="r",d0="f",f0=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,p0="ls",g0="p",wf="ac",m0="websocket",_0="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(t,e,n,a,o=!1,c="",h=!1,d=!1,f=null){this.secure=e,this.namespace=n,this.webSocketOnly=a,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=d,this.emulatorOptions=f,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Cs.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Cs.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function dx(r){return r.host!==r.internalHost||r.isCustomHost()||r.includeNamespaceInQueryParams}function b0(r,t,e){Q(typeof t=="string","typeof type must == string"),Q(typeof e=="object","typeof params must == object");let n;if(t===m0)n=(r.secure?"wss://":"ws://")+r.internalHost+"/.ws?";else if(t===_0)n=(r.secure?"https://":"http://")+r.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);dx(r)&&(e.ns=r.namespace);const a=[];return Be(e,(o,c)=>{a.push(o+"="+c)}),n+a.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(){this.counters_={}}incrementCounter(t,e=1){$n(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return lC(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yd={},Xd={};function ap(r){const t=r.toString();return Yd[t]||(Yd[t]=new fx),Yd[t]}function px(r,t){const e=r.toString();return Xd[e]||(Xd[e]=t()),Xd[e]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let a=0;a<n.length;++a)n[a]&&Ja(()=>{this.onMessage_(n[a])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Db="start",mx="close",_x="pLPCommand",yx="pRTLPCB",v0="id",A0="pw",S0="ser",bx="cb",vx="seg",Ax="ts",Sx="d",Ex="dframe",E0=1870,w0=30,wx=E0-w0,Cx=25e3,Tx=3e4;class Pa{constructor(t,e,n,a,o,c,h){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=a,this.authToken=o,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=qo(t),this.stats_=ap(e),this.urlFn=d=>(this.appCheckToken&&(d[wf]=this.appCheckToken),b0(e,_0,d))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new gx(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Tx)),ex(()=>{if(this.isClosed_)return;this.scriptTagHolder=new rp((...o)=>{const[c,h,d,f,g]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,c===Db)this.id=h,this.password=d;else if(c===mx)h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+c)},(...o)=>{const[c,h]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const n={};n[Db]="t",n[S0]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[bx]=this.scriptTagHolder.uniqueCallbackIdentifier),n[c0]=sp,this.transportSessionId&&(n[u0]=this.transportSessionId),this.lastSessionId&&(n[p0]=this.lastSessionId),this.applicationId&&(n[g0]=this.applicationId),this.appCheckToken&&(n[wf]=this.appCheckToken),typeof location<"u"&&location.hostname&&f0.test(location.hostname)&&(n[h0]=d0);const a=this.urlFn(n);this.log_("Connecting via long-poll to "+a),this.scriptTagHolder.addTag(a,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Pa.forceAllow_=!0}static forceDisallow(){Pa.forceDisallow_=!0}static isAvailable(){return Pa.forceAllow_?!0:!Pa.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!ix()&&!sx()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=Ce(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=qv(e),a=o0(n,wx);for(let o=0;o<a.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,a.length,a[o]),this.curSegmentNum++}addDisconnectPingFrame(t,e){this.myDisconnFrame=document.createElement("iframe");const n={};n[Ex]="t",n[v0]=t,n[A0]=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=Ce(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class rp{constructor(t,e,n,a){this.onDisconnect=n,this.urlFn=a,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=ZT(),window[_x+this.uniqueCallbackIdentifier]=t,window[yx+this.uniqueCallbackIdentifier]=e,this.myIFrame=rp.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){Oe("frame writing exception"),h.stack&&Oe(h.stack),Oe(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||Oe("No IE domain setting required")}catch{const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[v0]=this.myID,t[A0]=this.myPW,t[S0]=this.currentSerial;let e=this.urlFn(t),n="",a=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+w0+n.length<=E0;){const c=this.pendingSegs.shift();n=n+"&"+vx+a+"="+c.seg+"&"+Ax+a+"="+c.ts+"&"+Sx+a+"="+c.d,a++}return e=e+n,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},a=setTimeout(n,Math.floor(Cx)),o=()=>{clearTimeout(a),n()};this.addTag(t,o)}addTag(t,e){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const a=n.readyState;(!a||a==="loaded"||a==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{Oe("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xx=16384,Rx=45e3;let kc=null;typeof MozWebSocket<"u"?kc=MozWebSocket:typeof WebSocket<"u"&&(kc=WebSocket);class Mn{constructor(t,e,n,a,o,c,h){this.connId=t,this.applicationId=n,this.appCheckToken=a,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=qo(this.connId),this.stats_=ap(e),this.connURL=Mn.connectionURL_(e,c,h,a,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,a,o){const c={};return c[c0]=sp,typeof location<"u"&&location.hostname&&f0.test(location.hostname)&&(c[h0]=d0),e&&(c[u0]=e),n&&(c[p0]=n),a&&(c[wf]=a),o&&(c[g0]=o),b0(t,m0,c)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Cs.set("previous_websocket_failure",!0);try{let n;EC(),this.mySock=new kc(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const a=n.message||n.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const a=n.message||n.data;a&&this.log_(a),this.onClosed_()}}start(){}static forceDisallow(){Mn.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&kc!==null&&!Mn.forceDisallow_}static previouslyFailed(){return Cs.isInMemoryStorage||Cs.get("previous_websocket_failure")===!0}markConnectionHealthy(){Cs.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const n=To(e);this.onMessage(n)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(Q(this.frames===null,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(e);else{const n=this.extractFrameCount_(e);n!==null&&this.appendFrame_(n)}}send(t){this.resetKeepAlive();const e=Ce(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=o0(e,xx);n.length>1&&this.sendString_(String(n.length));for(let a=0;a<n.length;a++)this.sendString_(n[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Rx))}sendString_(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Mn.responsesRequiredToBeHealthy=2;Mn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{static get ALL_TRANSPORTS(){return[Pa,Mn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=Mn&&Mn.isAvailable();let n=e&&!Mn.previouslyFailed();if(t.webSocketOnly&&(e||Je("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Mn];else{const a=this.transports_=[];for(const o of Do.ALL_TRANSPORTS)o&&o.isAvailable()&&a.push(o);Do.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Do.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dx=6e4,Mx=5e3,Nx=10*1024,Ox=100*1024,$d="t",Mb="d",kx="s",Nb="r",Lx="e",Ob="o",kb="a",Lb="n",Ib="p",Ix="h";class Px{constructor(t,e,n,a,o,c,h,d,f,g){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=a,this.authToken_=o,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=d,this.onKill_=f,this.lastSessionId=g,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=qo("c:"+this.id+":"),this.transportManager_=new Do(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,n)},Math.floor(0));const a=t.healthyTimeout||0;a>0&&(this.healthyTimeout_=yo(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Ox?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Nx?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(a)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if($d in t){const e=t[$d];e===kb?this.upgradeIfSecondaryHealthy_():e===Nb?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===Ob&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=oo("t",t),n=oo("d",t);if(e==="c")this.onSecondaryControl_(n);else if(e==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Ib,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:kb,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Lb,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=oo("t",t),n=oo("d",t);e==="c"?this.onControl_(n):e==="d"&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=oo($d,t);if(Mb in t){const n=t[Mb];if(e===Ix){const a={...n};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if(e===Lb){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===kx?this.onConnectionShutdown_(n):e===Nb?this.onReset_(n):e===Lx?Ef("Server Error: "+n):e===Ob?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ef("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,a=t.h;this.sessionId=t.s,this.repoInfo_.host=a,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),sp!==n&&Je("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),yo(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Dx))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):yo(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Mx))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Ib,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Cs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{put(t,e,n,a){}merge(t,e,n,a){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(t){this.allowedEvents_=t,this.listeners_={},Q(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let a=0;a<n.length;a++)n[a].callback.apply(n[a].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const a=this.getInitialEvent(t);a&&e.apply(n,a)}off(t,e,n){this.validateEventType_(t);const a=this.listeners_[t]||[];for(let o=0;o<a.length;o++)if(a[o].callback===e&&(!n||n===a[o].context)){a.splice(o,1);return}}validateEventType_(t){Q(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc extends T0{static getInstance(){return new Lc}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Wv()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return Q(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pb=32,Bb=768;class zt{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let n=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[n]=this.pieces_[a],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}}function Pt(){return new zt("")}function wt(r){return r.pieceNum_>=r.pieces_.length?null:r.pieces_[r.pieceNum_]}function ts(r){return r.pieces_.length-r.pieceNum_}function Yt(r){let t=r.pieceNum_;return t<r.pieces_.length&&t++,new zt(r.pieces_,t)}function op(r){return r.pieceNum_<r.pieces_.length?r.pieces_[r.pieces_.length-1]:null}function Bx(r){let t="";for(let e=r.pieceNum_;e<r.pieces_.length;e++)r.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(r.pieces_[e])));return t||"/"}function Mo(r,t=0){return r.pieces_.slice(r.pieceNum_+t)}function x0(r){if(r.pieceNum_>=r.pieces_.length)return null;const t=[];for(let e=r.pieceNum_;e<r.pieces_.length-1;e++)t.push(r.pieces_[e]);return new zt(t,0)}function oe(r,t){const e=[];for(let n=r.pieceNum_;n<r.pieces_.length;n++)e.push(r.pieces_[n]);if(t instanceof zt)for(let n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{const n=t.split("/");for(let a=0;a<n.length;a++)n[a].length>0&&e.push(n[a])}return new zt(e,0)}function xt(r){return r.pieceNum_>=r.pieces_.length}function Qe(r,t){const e=wt(r),n=wt(t);if(e===null)return t;if(e===n)return Qe(Yt(r),Yt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+r+")")}function Fx(r,t){const e=Mo(r,0),n=Mo(t,0);for(let a=0;a<e.length&&a<n.length;a++){const o=zs(e[a],n[a]);if(o!==0)return o}return e.length===n.length?0:e.length<n.length?-1:1}function lp(r,t){if(ts(r)!==ts(t))return!1;for(let e=r.pieceNum_,n=t.pieceNum_;e<=r.pieces_.length;e++,n++)if(r.pieces_[e]!==t.pieces_[n])return!1;return!0}function wn(r,t){let e=r.pieceNum_,n=t.pieceNum_;if(ts(r)>ts(t))return!1;for(;e<r.pieces_.length;){if(r.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0}class Hx{constructor(t,e){this.errorPrefix_=e,this.parts_=Mo(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=iu(this.parts_[n]);R0(this)}}function zx(r,t){r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=iu(t),R0(r)}function Ux(r){const t=r.parts_.pop();r.byteLength_-=iu(t),r.parts_.length>0&&(r.byteLength_-=1)}function R0(r){if(r.byteLength_>Bb)throw new Error(r.errorPrefix_+"has a key path longer than "+Bb+" bytes ("+r.byteLength_+").");if(r.parts_.length>Pb)throw new Error(r.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Pb+") or object contains a cycle "+Es(r))}function Es(r){return r.parts_.length===0?"":"in property '"+r.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp extends T0{static getInstance(){return new cp}constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const n=!document[t];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}getInitialEvent(t){return Q(t==="visible","Unknown event type: "+t),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lo=1e3,jx=300*1e3,Fb=30*1e3,Gx=1.3,Vx=3e4,qx="server_kill",Hb=3;class gi extends C0{constructor(t,e,n,a,o,c,h,d){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=a,this.onServerInfoUpdate_=o,this.authTokenProvider_=c,this.appCheckTokenProvider_=h,this.authOverride_=d,this.id=gi.nextPersistentConnectionId_++,this.log_=qo("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=lo,this.maxReconnectDelay_=jx,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");cp.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Lc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,n){const a=++this.requestNumber_,o={r:a,a:t,b:e};this.log_(Ce(o)),Q(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[a]=n)}get(t){this.initConnection_();const e=new fi,a={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:c=>{const h=c.d;c.s==="ok"?e.resolve(h):e.reject(h)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),e.promise}listen(t,e,n,a){this.initConnection_();const o=t._queryIdentifier,c=t._path.toString();this.log_("Listen called for "+c+" "+o),this.listens.has(c)||this.listens.set(c,new Map),Q(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Q(!this.listens.get(c).has(o),"listen() called twice for same path/queryId.");const h={onComplete:a,hashFn:e,query:t,tag:n};this.listens.get(c).set(o,h),this.connected_&&this.sendListen_(h)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)})}sendListen_(t){const e=t.query,n=e._path.toString(),a=e._queryIdentifier;this.log_("Listen on "+n+" for "+a);const o={p:n},c="q";t.tag&&(o.q=e._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(c,o,h=>{const d=h.d,f=h.s;gi.warnOnListenWarnings_(d,e),(this.listens.get(n)&&this.listens.get(n).get(a))===t&&(this.log_("listen response",h),f!=="ok"&&this.removeListen_(n,a),t.onComplete&&t.onComplete(f,d))})}static warnOnListenWarnings_(t,e){if(t&&typeof t=="object"&&$n(t,"w")){const n=Ya(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const a='".indexOn": "'+e._queryParams.getIndex().toString()+'"',o=e._path.toString();Je(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||MC(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Fb)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=DC(t)?"auth":"gauth",n={cred:t};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(e,n,a=>{const o=a.s,c=a.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,c))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const e=t.s,n=t.d||"error";e==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)})}unlisten(t,e){const n=t._path.toString(),a=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+a),Q(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,a)&&this.connected_&&this.sendUnlisten_(n,a,t._queryObject,e)}sendUnlisten_(t,e,n,a){this.log_("Unlisten on "+t+" for "+e);const o={p:t},c="n";a&&(o.q=n,o.t=a),this.sendRequest(c,o)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,a){const o={p:e,d:n};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,c=>{a&&setTimeout(()=>{a(c.s,c.d)},Math.floor(0))})}put(t,e,n,a){this.putInternal("p",t,e,n,a)}merge(t,e,n,a){this.putInternal("m",t,e,n,a)}putInternal(t,e,n,a,o){this.initConnection_();const c={p:e,d:n};o!==void 0&&(c.h=o),this.outstandingPuts_.push({action:t,request:c,onComplete:a}),this.outstandingPutCount_++;const h=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(h):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,a=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,o=>{this.log_(e+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),a&&a(o.s,o.d)})}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,n=>{if(n.s!=="ok"){const o=n.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ce(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),t==="d"?this.onDataUpdate_(e.p,e.d,!1,e.t):t==="m"?this.onDataUpdate_(e.p,e.d,!0,e.t):t==="c"?this.onListenRevoked_(e.p,e.q):t==="ac"?this.onAuthRevoked_(e.s,e.d):t==="apc"?this.onAppCheckRevoked_(e.s,e.d):t==="sd"?this.onSecurityDebugPacket_(e):Ef("Unrecognized action received from server: "+Ce(t)+`
Are you using the latest client?`)}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){Q(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=lo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=lo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Vx&&(this.reconnectDelay_=lo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Gx)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),a=this.id+":"+gi.nextConnectionId_++,o=this.lastSessionId;let c=!1,h=null;const d=function(){h?h.close():(c=!0,n())},f=function(_){Q(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(_)};this.realtime_={close:d,sendRequest:f};const g=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[_,y]=await Promise.all([this.authTokenProvider_.getToken(g),this.appCheckTokenProvider_.getToken(g)]);c?Oe("getToken() completed but was canceled"):(Oe("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=y&&y.token,h=new Px(a,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,n,b=>{Je(b+" ("+this.repoInfo_.toString()+")"),this.interrupt(qx)},o))}catch(_){this.log_("Failed to get token: "+_),c||(this.repoInfo_.nodeAdmin&&Je(_),d())}}}interrupt(t){Oe("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Oe("Resuming connection for reason: "+t),delete this.interruptReasons_[t],_f(this.interruptReasons_)&&(this.reconnectDelay_=lo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;e?n=e.map(o=>ip(o)).join("$"):n="default";const a=this.removeListen_(t,n);a&&a.onComplete&&a.onComplete("permission_denied")}removeListen_(t,e){const n=new zt(t).toString();let a;if(this.listens.has(n)){const o=this.listens.get(n);a=o.get(e),o.delete(e),o.size===0&&this.listens.delete(n)}else a=void 0;return a}onAuthRevoked_(t,e){Oe("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Hb&&(this.reconnectDelay_=Fb,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Oe("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Hb&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";t["sdk."+e+"."+s0.replace(/\./g,"-")]=1,Wv()?t["framework.cordova"]=1:SC()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Lc.getInstance().currentlyOnline();return _f(this.interruptReasons_)&&t}}gi.nextPersistentConnectionId_=0;gi.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new Rt(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new Rt($a,t),a=new Rt($a,e);return this.compare(n,a)!==0}minPost(){return Rt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _c;class D0 extends au{static get __EMPTY_NODE(){return _c}static set __EMPTY_NODE(t){_c=t}compare(t,e){return zs(t.name,e.name)}isDefinedOn(t){throw Za("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return Rt.MIN}maxPost(){return new Rt(ks,_c)}makePost(t,e){return Q(typeof t=="string","KeyIndex indexValue must always be a string."),new Rt(t,_c)}toString(){return".key"}}const ja=new D0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(t,e,n,a,o=null){this.isReverse_=a,this.resultGenerator_=o,this.nodeStack_=[];let c=1;for(;!t.isEmpty();)if(t=t,c=e?n(t.key,e):1,a&&(c*=-1),c<0)this.isReverse_?t=t.left:t=t.right;else if(c===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class we{constructor(t,e,n,a,o){this.key=t,this.value=e,this.color=n??we.RED,this.left=a??Ze.EMPTY_NODE,this.right=o??Ze.EMPTY_NODE}copy(t,e,n,a,o){return new we(t??this.key,e??this.value,n??this.color,a??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let a=this;const o=n(t,a.key);return o<0?a=a.copy(null,null,null,a.left.insert(t,e,n),null):o===0?a=a.copy(null,e,null,null,null):a=a.copy(null,null,null,null,a.right.insert(t,e,n)),a.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ze.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,a;if(n=this,e(t,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),e(t,n.key)===0){if(n.right.isEmpty())return Ze.EMPTY_NODE;a=n.right.min_(),n=n.copy(a.key,a.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}we.RED=!0;we.BLACK=!1;class Yx{copy(t,e,n,a,o){return this}insert(t,e,n){return new we(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ze{constructor(t,e=Ze.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new Ze(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,we.BLACK,null,null))}remove(t){return new Ze(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,we.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),e===0)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,a=null;for(;!n.isEmpty();)if(e=this.comparator_(t,n.key),e===0){if(n.left.isEmpty())return a?a.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else e<0?n=n.left:e>0&&(a=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new yc(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new yc(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new yc(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new yc(this.root_,null,this.comparator_,!0,t)}}Ze.EMPTY_NODE=new Yx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xx(r,t){return zs(r.name,t.name)}function up(r,t){return zs(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cf;function $x(r){Cf=r}const M0=function(r){return typeof r=="number"?"number:"+l0(r):"string:"+r},N0=function(r){if(r.isLeafNode()){const t=r.val();Q(typeof t=="string"||typeof t=="number"||typeof t=="object"&&$n(t,".sv"),"Priority must be a string or number.")}else Q(r===Cf||r.isEmpty(),"priority of unexpected type.");Q(r===Cf||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zb;class Ee{static set __childrenNodeConstructor(t){zb=t}static get __childrenNodeConstructor(){return zb}constructor(t,e=Ee.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,Q(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),N0(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Ee(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:Ee.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return xt(t)?this:wt(t)===".priority"?this.priorityNode_:Ee.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return t===".priority"?this.updatePriority(e):e.isEmpty()&&t!==".priority"?this:Ee.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const n=wt(t);return n===null?e:e.isEmpty()&&n!==".priority"?this:(Q(n!==".priority"||ts(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,Ee.__childrenNodeConstructor.EMPTY_NODE.updateChild(Yt(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+M0(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",e==="number"?t+=l0(this.value_):t+=this.value_,this.lazyHash_=r0(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Ee.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Ee.__childrenNodeConstructor?-1:(Q(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,n=typeof this.value_,a=Ee.VALUE_TYPE_ORDER.indexOf(e),o=Ee.VALUE_TYPE_ORDER.indexOf(n);return Q(a>=0,"Unknown leaf type: "+e),Q(o>=0,"Unknown leaf type: "+n),a===o?n==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-a}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}else return!1}}Ee.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let O0,k0;function Wx(r){O0=r}function Kx(r){k0=r}class Qx extends au{compare(t,e){const n=t.node.getPriority(),a=e.node.getPriority(),o=n.compareTo(a);return o===0?zs(t.name,e.name):o}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return Rt.MIN}maxPost(){return new Rt(ks,new Ee("[PRIORITY-POST]",k0))}makePost(t,e){const n=O0(t);return new Rt(e,new Ee("[PRIORITY-POST]",n))}toString(){return".priority"}}const ee=new Qx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zx=Math.log(2);class Jx{constructor(t){const e=o=>parseInt(Math.log(o)/Zx,10),n=o=>parseInt(Array(o+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const a=n(this.count);this.bits_=t+1&a}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Ic=function(r,t,e,n){r.sort(t);const a=function(d,f){const g=f-d;let _,y;if(g===0)return null;if(g===1)return _=r[d],y=e?e(_):_,new we(y,_.node,we.BLACK,null,null);{const b=parseInt(g/2,10)+d,A=a(d,b),S=a(b+1,f);return _=r[b],y=e?e(_):_,new we(y,_.node,we.BLACK,A,S)}},o=function(d){let f=null,g=null,_=r.length;const y=function(A,S){const C=_-A,w=_;_-=A;const D=a(C+1,w),x=r[C],k=e?e(x):x;b(new we(k,x.node,S,null,D))},b=function(A){f?(f.left=A,f=A):(g=A,f=A)};for(let A=0;A<d.count;++A){const S=d.nextBitIsOne(),C=Math.pow(2,d.count-(A+1));S?y(C,we.BLACK):(y(C,we.BLACK),y(C,we.RED))}return g},c=new Jx(r.length),h=o(c);return new Ze(n||t,h)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wd;const Da={};class pi{static get Default(){return Q(Da&&ee,"ChildrenNode.ts has not been loaded"),Wd=Wd||new pi({".priority":Da},{".priority":ee}),Wd}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=Ya(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Ze?e:null}hasIndex(t){return $n(this.indexSet_,t.toString())}addIndex(t,e){Q(t!==ja,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let a=!1;const o=e.getIterator(Rt.Wrap);let c=o.getNext();for(;c;)a=a||t.isDefinedOn(c.node),n.push(c),c=o.getNext();let h;a?h=Ic(n,t.getCompare()):h=Da;const d=t.toString(),f={...this.indexSet_};f[d]=t;const g={...this.indexes_};return g[d]=h,new pi(g,f)}addToIndexes(t,e){const n=Dc(this.indexes_,(a,o)=>{const c=Ya(this.indexSet_,o);if(Q(c,"Missing index implementation for "+o),a===Da)if(c.isDefinedOn(t.node)){const h=[],d=e.getIterator(Rt.Wrap);let f=d.getNext();for(;f;)f.name!==t.name&&h.push(f),f=d.getNext();return h.push(t),Ic(h,c.getCompare())}else return Da;else{const h=e.get(t.name);let d=a;return h&&(d=d.remove(new Rt(t.name,h))),d.insert(t,t.node)}});return new pi(n,this.indexSet_)}removeFromIndexes(t,e){const n=Dc(this.indexes_,a=>{if(a===Da)return a;{const o=e.get(t.name);return o?a.remove(new Rt(t.name,o)):a}});return new pi(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let co;class gt{static get EMPTY_NODE(){return co||(co=new gt(new Ze(up),null,pi.Default))}constructor(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&N0(this.priorityNode_),this.children_.isEmpty()&&Q(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||co}updatePriority(t){return this.children_.isEmpty()?this:new gt(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{const e=this.children_.get(t);return e===null?co:e}}getChild(t){const e=wt(t);return e===null?this:this.getImmediateChild(e).getChild(Yt(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,e){if(Q(e,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(e);{const n=new Rt(t,e);let a,o;e.isEmpty()?(a=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(n,this.children_)):(a=this.children_.insert(t,e),o=this.indexMap_.addToIndexes(n,this.children_));const c=a.isEmpty()?co:this.priorityNode_;return new gt(a,c,o)}}updateChild(t,e){const n=wt(t);if(n===null)return e;{Q(wt(t)!==".priority"||ts(t)===1,".priority must be the last token in a path");const a=this.getImmediateChild(n).updateChild(Yt(t),e);return this.updateImmediateChild(n,a)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,a=0,o=!0;if(this.forEachChild(ee,(c,h)=>{e[c]=h.val(t),n++,o&&gt.INTEGER_REGEXP_.test(c)?a=Math.max(a,Number(c)):o=!1}),!t&&o&&a<2*n){const c=[];for(const h in e)c[h]=e[h];return c}else return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+M0(this.getPriority().val())+":"),this.forEachChild(ee,(e,n)=>{const a=n.hash();a!==""&&(t+=":"+e+":"+a)}),this.lazyHash_=t===""?"":r0(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const a=this.resolveIndex_(n);if(a){const o=a.getPredecessorKey(new Rt(t,e));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const n=e.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new Rt(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const n=e.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new Rt(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal(a=>e(a.name,a.node)):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,a=>a);{const a=this.children_.getIteratorFrom(t.name,Rt.Wrap);let o=a.peek();for(;o!=null&&e.compare(o,t)<0;)a.getNext(),o=a.peek();return a}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,a=>a);{const a=this.children_.getReverseIteratorFrom(t.name,Rt.Wrap);let o=a.peek();for(;o!=null&&e.compare(o,t)>0;)a.getNext(),o=a.peek();return a}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Yo?-1:0}withIndex(t){if(t===ja||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new gt(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===ja||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority()))if(this.children_.count()===e.children_.count()){const n=this.getIterator(ee),a=e.getIterator(ee);let o=n.getNext(),c=a.getNext();for(;o&&c;){if(o.name!==c.name||!o.node.equals(c.node))return!1;o=n.getNext(),c=a.getNext()}return o===null&&c===null}else return!1;else return!1}}resolveIndex_(t){return t===ja?null:this.indexMap_.get(t.toString())}}gt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class tR extends gt{constructor(){super(new Ze(up),gt.EMPTY_NODE,pi.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return gt.EMPTY_NODE}isEmpty(){return!1}}const Yo=new tR;Object.defineProperties(Rt,{MIN:{value:new Rt($a,gt.EMPTY_NODE)},MAX:{value:new Rt(ks,Yo)}});D0.__EMPTY_NODE=gt.EMPTY_NODE;Ee.__childrenNodeConstructor=gt;$x(Yo);Kx(Yo);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eR=!0;function pe(r,t=null){if(r===null)return gt.EMPTY_NODE;if(typeof r=="object"&&".priority"in r&&(t=r[".priority"]),Q(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof r=="object"&&".value"in r&&r[".value"]!==null&&(r=r[".value"]),typeof r!="object"||".sv"in r){const e=r;return new Ee(e,pe(t))}if(!(r instanceof Array)&&eR){const e=[];let n=!1;if(Be(r,(c,h)=>{if(c.substring(0,1)!=="."){const d=pe(h);d.isEmpty()||(n=n||!d.getPriority().isEmpty(),e.push(new Rt(c,d)))}}),e.length===0)return gt.EMPTY_NODE;const o=Ic(e,Xx,c=>c.name,up);if(n){const c=Ic(e,ee.getCompare());return new gt(o,pe(t),new pi({".priority":c},{".priority":ee}))}else return new gt(o,pe(t),pi.Default)}else{let e=gt.EMPTY_NODE;return Be(r,(n,a)=>{if($n(r,n)&&n.substring(0,1)!=="."){const o=pe(a);(o.isLeafNode()||!o.isEmpty())&&(e=e.updateImmediateChild(n,o))}}),e.updatePriority(pe(t))}}Wx(pe);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR extends au{constructor(t){super(),this.indexPath_=t,Q(!xt(t)&&wt(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),a=this.extractChild(e.node),o=n.compareTo(a);return o===0?zs(t.name,e.name):o}makePost(t,e){const n=pe(t),a=gt.EMPTY_NODE.updateChild(this.indexPath_,n);return new Rt(e,a)}maxPost(){const t=gt.EMPTY_NODE.updateChild(this.indexPath_,Yo);return new Rt(ks,t)}toString(){return Mo(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR extends au{compare(t,e){const n=t.node.compareTo(e.node);return n===0?zs(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return Rt.MIN}maxPost(){return Rt.MAX}makePost(t,e){const n=pe(t);return new Rt(e,n)}toString(){return".value"}}const sR=new iR;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L0(r){return{type:"value",snapshotNode:r}}function Wa(r,t){return{type:"child_added",snapshotNode:t,childName:r}}function No(r,t){return{type:"child_removed",snapshotNode:t,childName:r}}function Oo(r,t,e){return{type:"child_changed",snapshotNode:t,childName:r,oldSnap:e}}function aR(r,t){return{type:"child_moved",snapshotNode:t,childName:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hp{constructor(t){this.index_=t}updateChild(t,e,n,a,o,c){Q(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=t.getImmediateChild(e);return h.getChild(a).equals(n.getChild(a))&&h.isEmpty()===n.isEmpty()||(c!=null&&(n.isEmpty()?t.hasChild(e)?c.trackChildChange(No(e,h)):Q(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(Wa(e,n)):c.trackChildChange(Oo(e,n,h))),t.isLeafNode()&&n.isEmpty())?t:t.updateImmediateChild(e,n).withIndex(this.index_)}updateFullNode(t,e,n){return n!=null&&(t.isLeafNode()||t.forEachChild(ee,(a,o)=>{e.hasChild(a)||n.trackChildChange(No(a,o))}),e.isLeafNode()||e.forEachChild(ee,(a,o)=>{if(t.hasChild(a)){const c=t.getImmediateChild(a);c.equals(o)||n.trackChildChange(Oo(a,o,c))}else n.trackChildChange(Wa(a,o))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?gt.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(t){this.indexedFilter_=new hp(t.getIndex()),this.index_=t.getIndex(),this.startPost_=ko.getStartPost_(t),this.endPost_=ko.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,n=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&n}updateChild(t,e,n,a,o,c){return this.matches(new Rt(e,n))||(n=gt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,a,o,c)}updateFullNode(t,e,n){e.isLeafNode()&&(e=gt.EMPTY_NODE);let a=e.withIndex(this.index_);a=a.updatePriority(gt.EMPTY_NODE);const o=this;return e.forEachChild(ee,(c,h)=>{o.matches(new Rt(c,h))||(a=a.updateImmediateChild(c,gt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,a,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}else return t.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=e=>{const n=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new ko(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,n,a,o,c){return this.rangedFilter_.matches(new Rt(e,n))||(n=gt.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,a,o,c):this.fullLimitUpdateChild_(t,e,n,o,c)}updateFullNode(t,e,n){let a;if(e.isLeafNode()||e.isEmpty())a=gt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<e.numChildren()&&e.isIndexed(this.index_)){a=gt.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;o.hasNext()&&c<this.limit_;){const h=o.getNext();if(this.withinDirectionalStart(h))if(this.withinDirectionalEnd(h))a=a.updateImmediateChild(h.name,h.node),c++;else break;else continue}}else{a=e.withIndex(this.index_),a=a.updatePriority(gt.EMPTY_NODE);let o;this.reverse_?o=a.getReverseIterator(this.index_):o=a.getIterator(this.index_);let c=0;for(;o.hasNext();){const h=o.getNext();c<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?c++:a=a.updateImmediateChild(h.name,gt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,a,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,n,a,o){let c;if(this.reverse_){const _=this.index_.getCompare();c=(y,b)=>_(b,y)}else c=this.index_.getCompare();const h=t;Q(h.numChildren()===this.limit_,"");const d=new Rt(e,n),f=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),g=this.rangedFilter_.matches(d);if(h.hasChild(e)){const _=h.getImmediateChild(e);let y=a.getChildAfterChild(this.index_,f,this.reverse_);for(;y!=null&&(y.name===e||h.hasChild(y.name));)y=a.getChildAfterChild(this.index_,y,this.reverse_);const b=y==null?1:c(y,d);if(g&&!n.isEmpty()&&b>=0)return o?.trackChildChange(Oo(e,n,_)),h.updateImmediateChild(e,n);{o?.trackChildChange(No(e,_));const S=h.updateImmediateChild(e,gt.EMPTY_NODE);return y!=null&&this.rangedFilter_.matches(y)?(o?.trackChildChange(Wa(y.name,y.node)),S.updateImmediateChild(y.name,y.node)):S}}else return n.isEmpty()?t:g&&c(f,d)>=0?(o!=null&&(o.trackChildChange(No(f.name,f.node)),o.trackChildChange(Wa(e,n))),h.updateImmediateChild(e,n).updateImmediateChild(f.name,gt.EMPTY_NODE)):t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ee}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Q(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Q(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:$a}hasEnd(){return this.endSet_}getIndexEndValue(){return Q(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Q(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ks}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Q(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ee}copy(){const t=new dp;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function oR(r){return r.loadsAllData()?new hp(r.getIndex()):r.hasLimit()?new rR(r):new ko(r)}function Ub(r){const t={};if(r.isDefault())return t;let e;if(r.index_===ee?e="$priority":r.index_===sR?e="$value":r.index_===ja?e="$key":(Q(r.index_ instanceof nR,"Unrecognized index type!"),e=r.index_.toString()),t.orderBy=Ce(e),r.startSet_){const n=r.startAfterSet_?"startAfter":"startAt";t[n]=Ce(r.indexStartValue_),r.startNameSet_&&(t[n]+=","+Ce(r.indexStartName_))}if(r.endSet_){const n=r.endBeforeSet_?"endBefore":"endAt";t[n]=Ce(r.indexEndValue_),r.endNameSet_&&(t[n]+=","+Ce(r.indexEndName_))}return r.limitSet_&&(r.isViewFromLeft()?t.limitToFirst=r.limit_:t.limitToLast=r.limit_),t}function jb(r){const t={};if(r.startSet_&&(t.sp=r.indexStartValue_,r.startNameSet_&&(t.sn=r.indexStartName_),t.sin=!r.startAfterSet_),r.endSet_&&(t.ep=r.indexEndValue_,r.endNameSet_&&(t.en=r.indexEndName_),t.ein=!r.endBeforeSet_),r.limitSet_){t.l=r.limit_;let e=r.viewFrom_;e===""&&(r.isViewFromLeft()?e="l":e="r"),t.vf=e}return r.index_!==ee&&(t.i=r.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends C0{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(Q(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,n,a){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=a,this.log_=qo("p:rest:"),this.listens_={}}listen(t,e,n,a){const o=t._path.toString();this.log_("Listen called for "+o+" "+t._queryIdentifier);const c=Pc.getListenId_(t,n),h={};this.listens_[c]=h;const d=Ub(t._queryParams);this.restRequest_(o+".json",d,(f,g)=>{let _=g;if(f===404&&(_=null,f=null),f===null&&this.onDataUpdate_(o,_,!1,n),Ya(this.listens_,c)===h){let y;f?f===401?y="permission_denied":y="rest_error:"+f:y="ok",a(y,null)}})}unlisten(t,e){const n=Pc.getListenId_(t,e);delete this.listens_[n]}get(t){const e=Ub(t._queryParams),n=t._path.toString(),a=new fi;return this.restRequest_(n+".json",e,(o,c)=>{let h=c;o===404&&(h=null,o=null),o===null?(this.onDataUpdate_(n,h,!1,null),a.resolve(h)):a.reject(new Error(h))}),a.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([a,o])=>{a&&a.accessToken&&(e.auth=a.accessToken),o&&o.token&&(e.ac=o.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+NC(e);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(n&&h.readyState===4){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let d=null;if(h.status>=200&&h.status<300){try{d=To(h.responseText)}catch{Je("Failed to parse JSON response for "+c+": "+h.responseText)}n(null,d)}else h.status!==401&&h.status!==404&&Je("Got unsuccessful REST response for "+c+" Status: "+h.status),n(h.status);n=null}},h.open("GET",c,!0),h.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{constructor(){this.rootNode_=gt.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(){return{value:null,children:new Map}}function tr(r,t,e){if(xt(t))r.value=e,r.children.clear();else if(r.value!==null)r.value=r.value.updateChild(t,e);else{const n=wt(t);r.children.has(n)||r.children.set(n,Bc());const a=r.children.get(n);t=Yt(t),tr(a,t,e)}}function Tf(r,t){if(xt(t))return r.value=null,r.children.clear(),!0;if(r.value!==null){if(r.value.isLeafNode())return!1;{const e=r.value;return r.value=null,e.forEachChild(ee,(n,a)=>{tr(r,new zt(n),a)}),Tf(r,t)}}else if(r.children.size>0){const e=wt(t);return t=Yt(t),r.children.has(e)&&Tf(r.children.get(e),t)&&r.children.delete(e),r.children.size===0}else return!0}function xf(r,t,e){r.value!==null?e(t,r.value):cR(r,(n,a)=>{const o=new zt(t.toString()+"/"+n);xf(a,o,e)})}function cR(r,t){r.children.forEach((e,n)=>{t(n,e)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e={...t};return this.last_&&Be(this.last_,(n,a)=>{e[n]=e[n]-a}),this.last_=t,e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb=10*1e3,hR=30*1e3,dR=300*1e3;class fR{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new uR(t);const n=Gb+(hR-Gb)*Math.random();yo(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;Be(t,(a,o)=>{o>0&&$n(this.statsToReport_,a)&&(e[a]=o,n=!0)}),n&&this.server_.reportStats(e),yo(this.reportStats_.bind(this),Math.floor(Math.random()*2*dR))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nn;(function(r){r[r.OVERWRITE=0]="OVERWRITE",r[r.MERGE=1]="MERGE",r[r.ACK_USER_WRITE=2]="ACK_USER_WRITE",r[r.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Nn||(Nn={}));function I0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function fp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function pp(r){return{fromUser:!1,fromServer:!0,queryId:r,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Nn.ACK_USER_WRITE,this.source=I0()}operationForChild(t){if(xt(this.path)){if(this.affectedTree.value!=null)return Q(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new zt(t));return new Fc(Pt(),e,this.revert)}}else return Q(wt(this.path)===t,"operationForChild called for unrelated child."),new Fc(Yt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(t,e){this.source=t,this.path=e,this.type=Nn.LISTEN_COMPLETE}operationForChild(t){return xt(this.path)?new Lo(this.source,Pt()):new Lo(this.source,Yt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Nn.OVERWRITE}operationForChild(t){return xt(this.path)?new Ls(this.source,Pt(),this.snap.getImmediateChild(t)):new Ls(this.source,Yt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Nn.MERGE}operationForChild(t){if(xt(this.path)){const e=this.children.subtree(new zt(t));return e.isEmpty()?null:e.value?new Ls(this.source,Pt(),e.value):new Io(this.source,Pt(),e)}else return Q(wt(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new Io(this.source,Yt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(xt(t))return this.isFullyInitialized()&&!this.filtered_;const e=wt(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function gR(r,t,e,n){const a=[],o=[];return t.forEach(c=>{c.type==="child_changed"&&r.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&o.push(aR(c.childName,c.snapshotNode))}),uo(r,a,"child_removed",t,n,e),uo(r,a,"child_added",t,n,e),uo(r,a,"child_moved",o,n,e),uo(r,a,"child_changed",t,n,e),uo(r,a,"value",t,n,e),a}function uo(r,t,e,n,a,o){const c=n.filter(h=>h.type===e);c.sort((h,d)=>_R(r,h,d)),c.forEach(h=>{const d=mR(r,h,o);a.forEach(f=>{f.respondsTo(h.type)&&t.push(f.createEvent(d,r.query_))})})}function mR(r,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,r.index_)),t}function _R(r,t,e){if(t.childName==null||e.childName==null)throw Za("Should only compare child_ events.");const n=new Rt(t.childName,t.snapshotNode),a=new Rt(e.childName,e.snapshotNode);return r.index_.compare(n,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(r,t){return{eventCache:r,serverCache:t}}function bo(r,t,e,n){return ru(new Is(t,e,n),r.serverCache)}function P0(r,t,e,n){return ru(r.eventCache,new Is(t,e,n))}function Rf(r){return r.eventCache.isFullyInitialized()?r.eventCache.getNode():null}function Ps(r){return r.serverCache.isFullyInitialized()?r.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kd;const yR=()=>(Kd||(Kd=new Ze(nx)),Kd);class Wt{static fromObject(t){let e=new Wt(null);return Be(t,(n,a)=>{e=e.set(new zt(n),a)}),e}constructor(t,e=yR()){this.value=t,this.children=e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:Pt(),value:this.value};if(xt(t))return null;{const n=wt(t),a=this.children.get(n);if(a!==null){const o=a.findRootMostMatchingPathAndValue(Yt(t),e);return o!=null?{path:oe(new zt(n),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(xt(t))return this;{const e=wt(t),n=this.children.get(e);return n!==null?n.subtree(Yt(t)):new Wt(null)}}set(t,e){if(xt(t))return new Wt(e,this.children);{const n=wt(t),o=(this.children.get(n)||new Wt(null)).set(Yt(t),e),c=this.children.insert(n,o);return new Wt(this.value,c)}}remove(t){if(xt(t))return this.children.isEmpty()?new Wt(null):new Wt(null,this.children);{const e=wt(t),n=this.children.get(e);if(n){const a=n.remove(Yt(t));let o;return a.isEmpty()?o=this.children.remove(e):o=this.children.insert(e,a),this.value===null&&o.isEmpty()?new Wt(null):new Wt(this.value,o)}else return this}}get(t){if(xt(t))return this.value;{const e=wt(t),n=this.children.get(e);return n?n.get(Yt(t)):null}}setTree(t,e){if(xt(t))return e;{const n=wt(t),o=(this.children.get(n)||new Wt(null)).setTree(Yt(t),e);let c;return o.isEmpty()?c=this.children.remove(n):c=this.children.insert(n,o),new Wt(this.value,c)}}fold(t){return this.fold_(Pt(),t)}fold_(t,e){const n={};return this.children.inorderTraversal((a,o)=>{n[a]=o.fold_(oe(t,a),e)}),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,Pt(),e)}findOnPath_(t,e,n){const a=this.value?n(e,this.value):!1;if(a)return a;if(xt(t))return null;{const o=wt(t),c=this.children.get(o);return c?c.findOnPath_(Yt(t),oe(e,o),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Pt(),e)}foreachOnPath_(t,e,n){if(xt(t))return this;{this.value&&n(e,this.value);const a=wt(t),o=this.children.get(a);return o?o.foreachOnPath_(Yt(t),oe(e,a),n):new Wt(null)}}foreach(t){this.foreach_(Pt(),t)}foreach_(t,e){this.children.inorderTraversal((n,a)=>{a.foreach_(oe(t,n),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,n)=>{n.value&&t(e,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(t){this.writeTree_=t}static empty(){return new On(new Wt(null))}}function vo(r,t,e){if(xt(t))return new On(new Wt(e));{const n=r.writeTree_.findRootMostValueAndPath(t);if(n!=null){const a=n.path;let o=n.value;const c=Qe(a,t);return o=o.updateChild(c,e),new On(r.writeTree_.set(a,o))}else{const a=new Wt(e),o=r.writeTree_.setTree(t,a);return new On(o)}}}function Vb(r,t,e){let n=r;return Be(e,(a,o)=>{n=vo(n,oe(t,a),o)}),n}function qb(r,t){if(xt(t))return On.empty();{const e=r.writeTree_.setTree(t,new Wt(null));return new On(e)}}function Df(r,t){return Us(r,t)!=null}function Us(r,t){const e=r.writeTree_.findRootMostValueAndPath(t);return e!=null?r.writeTree_.get(e.path).getChild(Qe(e.path,t)):null}function Yb(r){const t=[],e=r.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(ee,(n,a)=>{t.push(new Rt(n,a))}):r.writeTree_.children.inorderTraversal((n,a)=>{a.value!=null&&t.push(new Rt(n,a.value))}),t}function Qi(r,t){if(xt(t))return r;{const e=Us(r,t);return e!=null?new On(new Wt(e)):new On(r.writeTree_.subtree(t))}}function Mf(r){return r.writeTree_.isEmpty()}function Ka(r,t){return B0(Pt(),r.writeTree_,t)}function B0(r,t,e){if(t.value!=null)return e.updateChild(r,t.value);{let n=null;return t.children.inorderTraversal((a,o)=>{a===".priority"?(Q(o.value!==null,"Priority writes must always be leaf nodes"),n=o.value):e=B0(oe(r,a),o,e)}),!e.getChild(r).isEmpty()&&n!==null&&(e=e.updateChild(oe(r,".priority"),n)),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gp(r,t){return U0(t,r)}function bR(r,t,e,n,a){Q(n>r.lastWriteId,"Stacking an older write on top of newer ones"),a===void 0&&(a=!0),r.allWrites.push({path:t,snap:e,writeId:n,visible:a}),a&&(r.visibleWrites=vo(r.visibleWrites,t,e)),r.lastWriteId=n}function vR(r,t){for(let e=0;e<r.allWrites.length;e++){const n=r.allWrites[e];if(n.writeId===t)return n}return null}function AR(r,t){const e=r.allWrites.findIndex(h=>h.writeId===t);Q(e>=0,"removeWrite called with nonexistent writeId.");const n=r.allWrites[e];r.allWrites.splice(e,1);let a=n.visible,o=!1,c=r.allWrites.length-1;for(;a&&c>=0;){const h=r.allWrites[c];h.visible&&(c>=e&&SR(h,n.path)?a=!1:wn(n.path,h.path)&&(o=!0)),c--}if(a){if(o)return ER(r),!0;if(n.snap)r.visibleWrites=qb(r.visibleWrites,n.path);else{const h=n.children;Be(h,d=>{r.visibleWrites=qb(r.visibleWrites,oe(n.path,d))})}return!0}else return!1}function SR(r,t){if(r.snap)return wn(r.path,t);for(const e in r.children)if(r.children.hasOwnProperty(e)&&wn(oe(r.path,e),t))return!0;return!1}function ER(r){r.visibleWrites=F0(r.allWrites,wR,Pt()),r.allWrites.length>0?r.lastWriteId=r.allWrites[r.allWrites.length-1].writeId:r.lastWriteId=-1}function wR(r){return r.visible}function F0(r,t,e){let n=On.empty();for(let a=0;a<r.length;++a){const o=r[a];if(t(o)){const c=o.path;let h;if(o.snap)wn(e,c)?(h=Qe(e,c),n=vo(n,h,o.snap)):wn(c,e)&&(h=Qe(c,e),n=vo(n,Pt(),o.snap.getChild(h)));else if(o.children){if(wn(e,c))h=Qe(e,c),n=Vb(n,h,o.children);else if(wn(c,e))if(h=Qe(c,e),xt(h))n=Vb(n,Pt(),o.children);else{const d=Ya(o.children,wt(h));if(d){const f=d.getChild(Yt(h));n=vo(n,Pt(),f)}}}else throw Za("WriteRecord should have .snap or .children")}}return n}function H0(r,t,e,n,a){if(!n&&!a){const o=Us(r.visibleWrites,t);if(o!=null)return o;{const c=Qi(r.visibleWrites,t);if(Mf(c))return e;if(e==null&&!Df(c,Pt()))return null;{const h=e||gt.EMPTY_NODE;return Ka(c,h)}}}else{const o=Qi(r.visibleWrites,t);if(!a&&Mf(o))return e;if(!a&&e==null&&!Df(o,Pt()))return null;{const c=function(f){return(f.visible||a)&&(!n||!~n.indexOf(f.writeId))&&(wn(f.path,t)||wn(t,f.path))},h=F0(r.allWrites,c,t),d=e||gt.EMPTY_NODE;return Ka(h,d)}}}function CR(r,t,e){let n=gt.EMPTY_NODE;const a=Us(r.visibleWrites,t);if(a)return a.isLeafNode()||a.forEachChild(ee,(o,c)=>{n=n.updateImmediateChild(o,c)}),n;if(e){const o=Qi(r.visibleWrites,t);return e.forEachChild(ee,(c,h)=>{const d=Ka(Qi(o,new zt(c)),h);n=n.updateImmediateChild(c,d)}),Yb(o).forEach(c=>{n=n.updateImmediateChild(c.name,c.node)}),n}else{const o=Qi(r.visibleWrites,t);return Yb(o).forEach(c=>{n=n.updateImmediateChild(c.name,c.node)}),n}}function TR(r,t,e,n,a){Q(n||a,"Either existingEventSnap or existingServerSnap must exist");const o=oe(t,e);if(Df(r.visibleWrites,o))return null;{const c=Qi(r.visibleWrites,o);return Mf(c)?a.getChild(e):Ka(c,a.getChild(e))}}function xR(r,t,e,n){const a=oe(t,e),o=Us(r.visibleWrites,a);if(o!=null)return o;if(n.isCompleteForChild(e)){const c=Qi(r.visibleWrites,a);return Ka(c,n.getNode().getImmediateChild(e))}else return null}function RR(r,t){return Us(r.visibleWrites,t)}function DR(r,t,e,n,a,o,c){let h;const d=Qi(r.visibleWrites,t),f=Us(d,Pt());if(f!=null)h=f;else if(e!=null)h=Ka(d,e);else return[];if(h=h.withIndex(c),!h.isEmpty()&&!h.isLeafNode()){const g=[],_=c.getCompare(),y=o?h.getReverseIteratorFrom(n,c):h.getIteratorFrom(n,c);let b=y.getNext();for(;b&&g.length<a;)_(b,n)!==0&&g.push(b),b=y.getNext();return g}else return[]}function MR(){return{visibleWrites:On.empty(),allWrites:[],lastWriteId:-1}}function Hc(r,t,e,n){return H0(r.writeTree,r.treePath,t,e,n)}function mp(r,t){return CR(r.writeTree,r.treePath,t)}function Xb(r,t,e,n){return TR(r.writeTree,r.treePath,t,e,n)}function zc(r,t){return RR(r.writeTree,oe(r.treePath,t))}function NR(r,t,e,n,a,o){return DR(r.writeTree,r.treePath,t,e,n,a,o)}function _p(r,t,e){return xR(r.writeTree,r.treePath,t,e)}function z0(r,t){return U0(oe(r.treePath,t),r.writeTree)}function U0(r,t){return{treePath:r,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,n=t.childName;Q(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),Q(n!==".priority","Only non-priority child changes can be tracked.");const a=this.changeMap.get(n);if(a){const o=a.type;if(e==="child_added"&&o==="child_removed")this.changeMap.set(n,Oo(n,t.snapshotNode,a.snapshotNode));else if(e==="child_removed"&&o==="child_added")this.changeMap.delete(n);else if(e==="child_removed"&&o==="child_changed")this.changeMap.set(n,No(n,a.oldSnap));else if(e==="child_changed"&&o==="child_added")this.changeMap.set(n,Wa(n,t.snapshotNode));else if(e==="child_changed"&&o==="child_changed")this.changeMap.set(n,Oo(n,t.snapshotNode,a.oldSnap));else throw Za("Illegal combination of changes: "+t+" occurred after "+a)}else this.changeMap.set(n,t)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}}const j0=new kR;class yp{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const n=this.optCompleteServerCache_!=null?new Is(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _p(this.writes_,t,n)}}getChildAfterChild(t,e,n){const a=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ps(this.viewCache_),o=NR(this.writes_,a,e,1,n,t);return o.length===0?null:o[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LR(r){return{filter:r}}function IR(r,t){Q(t.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),Q(t.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed")}function PR(r,t,e,n,a){const o=new OR;let c,h;if(e.type===Nn.OVERWRITE){const f=e;f.source.fromUser?c=Nf(r,t,f.path,f.snap,n,a,o):(Q(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered()&&!xt(f.path),c=Uc(r,t,f.path,f.snap,n,a,h,o))}else if(e.type===Nn.MERGE){const f=e;f.source.fromUser?c=FR(r,t,f.path,f.children,n,a,o):(Q(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered(),c=Of(r,t,f.path,f.children,n,a,h,o))}else if(e.type===Nn.ACK_USER_WRITE){const f=e;f.revert?c=UR(r,t,f.path,n,a,o):c=HR(r,t,f.path,f.affectedTree,n,a,o)}else if(e.type===Nn.LISTEN_COMPLETE)c=zR(r,t,e.path,n,o);else throw Za("Unknown operation type: "+e.type);const d=o.getChanges();return BR(t,c,d),{viewCache:c,changes:d}}function BR(r,t,e){const n=t.eventCache;if(n.isFullyInitialized()){const a=n.getNode().isLeafNode()||n.getNode().isEmpty(),o=Rf(r);(e.length>0||!r.eventCache.isFullyInitialized()||a&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&e.push(L0(Rf(t)))}}function G0(r,t,e,n,a,o){const c=t.eventCache;if(zc(n,e)!=null)return t;{let h,d;if(xt(e))if(Q(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const f=Ps(t),g=f instanceof gt?f:gt.EMPTY_NODE,_=mp(n,g);h=r.filter.updateFullNode(t.eventCache.getNode(),_,o)}else{const f=Hc(n,Ps(t));h=r.filter.updateFullNode(t.eventCache.getNode(),f,o)}else{const f=wt(e);if(f===".priority"){Q(ts(e)===1,"Can't have a priority with additional path components");const g=c.getNode();d=t.serverCache.getNode();const _=Xb(n,e,g,d);_!=null?h=r.filter.updatePriority(g,_):h=c.getNode()}else{const g=Yt(e);let _;if(c.isCompleteForChild(f)){d=t.serverCache.getNode();const y=Xb(n,e,c.getNode(),d);y!=null?_=c.getNode().getImmediateChild(f).updateChild(g,y):_=c.getNode().getImmediateChild(f)}else _=_p(n,f,t.serverCache);_!=null?h=r.filter.updateChild(c.getNode(),f,_,g,a,o):h=c.getNode()}}return bo(t,h,c.isFullyInitialized()||xt(e),r.filter.filtersNodes())}}function Uc(r,t,e,n,a,o,c,h){const d=t.serverCache;let f;const g=c?r.filter:r.filter.getIndexedFilter();if(xt(e))f=g.updateFullNode(d.getNode(),n,null);else if(g.filtersNodes()&&!d.isFiltered()){const b=d.getNode().updateChild(e,n);f=g.updateFullNode(d.getNode(),b,null)}else{const b=wt(e);if(!d.isCompleteForPath(e)&&ts(e)>1)return t;const A=Yt(e),C=d.getNode().getImmediateChild(b).updateChild(A,n);b===".priority"?f=g.updatePriority(d.getNode(),C):f=g.updateChild(d.getNode(),b,C,A,j0,null)}const _=P0(t,f,d.isFullyInitialized()||xt(e),g.filtersNodes()),y=new yp(a,_,o);return G0(r,_,e,a,y,h)}function Nf(r,t,e,n,a,o,c){const h=t.eventCache;let d,f;const g=new yp(a,t,o);if(xt(e))f=r.filter.updateFullNode(t.eventCache.getNode(),n,c),d=bo(t,f,!0,r.filter.filtersNodes());else{const _=wt(e);if(_===".priority")f=r.filter.updatePriority(t.eventCache.getNode(),n),d=bo(t,f,h.isFullyInitialized(),h.isFiltered());else{const y=Yt(e),b=h.getNode().getImmediateChild(_);let A;if(xt(y))A=n;else{const S=g.getCompleteChild(_);S!=null?op(y)===".priority"&&S.getChild(x0(y)).isEmpty()?A=S:A=S.updateChild(y,n):A=gt.EMPTY_NODE}if(b.equals(A))d=t;else{const S=r.filter.updateChild(h.getNode(),_,A,y,g,c);d=bo(t,S,h.isFullyInitialized(),r.filter.filtersNodes())}}}return d}function $b(r,t){return r.eventCache.isCompleteForChild(t)}function FR(r,t,e,n,a,o,c){let h=t;return n.foreach((d,f)=>{const g=oe(e,d);$b(t,wt(g))&&(h=Nf(r,h,g,f,a,o,c))}),n.foreach((d,f)=>{const g=oe(e,d);$b(t,wt(g))||(h=Nf(r,h,g,f,a,o,c))}),h}function Wb(r,t,e){return e.foreach((n,a)=>{t=t.updateChild(n,a)}),t}function Of(r,t,e,n,a,o,c,h){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let d=t,f;xt(e)?f=n:f=new Wt(null).setTree(e,n);const g=t.serverCache.getNode();return f.children.inorderTraversal((_,y)=>{if(g.hasChild(_)){const b=t.serverCache.getNode().getImmediateChild(_),A=Wb(r,b,y);d=Uc(r,d,new zt(_),A,a,o,c,h)}}),f.children.inorderTraversal((_,y)=>{const b=!t.serverCache.isCompleteForChild(_)&&y.value===null;if(!g.hasChild(_)&&!b){const A=t.serverCache.getNode().getImmediateChild(_),S=Wb(r,A,y);d=Uc(r,d,new zt(_),S,a,o,c,h)}}),d}function HR(r,t,e,n,a,o,c){if(zc(a,e)!=null)return t;const h=t.serverCache.isFiltered(),d=t.serverCache;if(n.value!=null){if(xt(e)&&d.isFullyInitialized()||d.isCompleteForPath(e))return Uc(r,t,e,d.getNode().getChild(e),a,o,h,c);if(xt(e)){let f=new Wt(null);return d.getNode().forEachChild(ja,(g,_)=>{f=f.set(new zt(g),_)}),Of(r,t,e,f,a,o,h,c)}else return t}else{let f=new Wt(null);return n.foreach((g,_)=>{const y=oe(e,g);d.isCompleteForPath(y)&&(f=f.set(g,d.getNode().getChild(y)))}),Of(r,t,e,f,a,o,h,c)}}function zR(r,t,e,n,a){const o=t.serverCache,c=P0(t,o.getNode(),o.isFullyInitialized()||xt(e),o.isFiltered());return G0(r,c,e,n,j0,a)}function UR(r,t,e,n,a,o){let c;if(zc(n,e)!=null)return t;{const h=new yp(n,t,a),d=t.eventCache.getNode();let f;if(xt(e)||wt(e)===".priority"){let g;if(t.serverCache.isFullyInitialized())g=Hc(n,Ps(t));else{const _=t.serverCache.getNode();Q(_ instanceof gt,"serverChildren would be complete if leaf node"),g=mp(n,_)}g=g,f=r.filter.updateFullNode(d,g,o)}else{const g=wt(e);let _=_p(n,g,t.serverCache);_==null&&t.serverCache.isCompleteForChild(g)&&(_=d.getImmediateChild(g)),_!=null?f=r.filter.updateChild(d,g,_,Yt(e),h,o):t.eventCache.getNode().hasChild(g)?f=r.filter.updateChild(d,g,gt.EMPTY_NODE,Yt(e),h,o):f=d,f.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=Hc(n,Ps(t)),c.isLeafNode()&&(f=r.filter.updateFullNode(f,c,o)))}return c=t.serverCache.isFullyInitialized()||zc(n,Pt())!=null,bo(t,f,c,r.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const n=this.query_._queryParams,a=new hp(n.getIndex()),o=oR(n);this.processor_=LR(o);const c=e.serverCache,h=e.eventCache,d=a.updateFullNode(gt.EMPTY_NODE,c.getNode(),null),f=o.updateFullNode(gt.EMPTY_NODE,h.getNode(),null),g=new Is(d,c.isFullyInitialized(),a.filtersNodes()),_=new Is(f,h.isFullyInitialized(),o.filtersNodes());this.viewCache_=ru(_,g),this.eventGenerator_=new pR(this.query_)}get query(){return this.query_}}function GR(r){return r.viewCache_.serverCache.getNode()}function VR(r,t){const e=Ps(r.viewCache_);return e&&(r.query._queryParams.loadsAllData()||!xt(t)&&!e.getImmediateChild(wt(t)).isEmpty())?e.getChild(t):null}function Kb(r){return r.eventRegistrations_.length===0}function qR(r,t){r.eventRegistrations_.push(t)}function Qb(r,t,e){const n=[];if(e){Q(t==null,"A cancel should cancel all event registrations.");const a=r.query._path;r.eventRegistrations_.forEach(o=>{const c=o.createCancelEvent(e,a);c&&n.push(c)})}if(t){let a=[];for(let o=0;o<r.eventRegistrations_.length;++o){const c=r.eventRegistrations_[o];if(!c.matches(t))a.push(c);else if(t.hasAnyCallback()){a=a.concat(r.eventRegistrations_.slice(o+1));break}}r.eventRegistrations_=a}else r.eventRegistrations_=[];return n}function Zb(r,t,e,n){t.type===Nn.MERGE&&t.source.queryId!==null&&(Q(Ps(r.viewCache_),"We should always have a full cache before handling merges"),Q(Rf(r.viewCache_),"Missing event cache, even though we have a server cache"));const a=r.viewCache_,o=PR(r.processor_,a,t,e,n);return IR(r.processor_,o.viewCache),Q(o.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),r.viewCache_=o.viewCache,V0(r,o.changes,o.viewCache.eventCache.getNode(),null)}function YR(r,t){const e=r.viewCache_.eventCache,n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(ee,(o,c)=>{n.push(Wa(o,c))}),e.isFullyInitialized()&&n.push(L0(e.getNode())),V0(r,n,e.getNode(),t)}function V0(r,t,e,n){const a=n?[n]:r.eventRegistrations_;return gR(r.eventGenerator_,t,e,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jc;class XR{constructor(){this.views=new Map}}function $R(r){Q(!jc,"__referenceConstructor has already been defined"),jc=r}function WR(){return Q(jc,"Reference.ts has not been loaded"),jc}function KR(r){return r.views.size===0}function bp(r,t,e,n){const a=t.source.queryId;if(a!==null){const o=r.views.get(a);return Q(o!=null,"SyncTree gave us an op for an invalid query."),Zb(o,t,e,n)}else{let o=[];for(const c of r.views.values())o=o.concat(Zb(c,t,e,n));return o}}function QR(r,t,e,n,a){const o=t._queryIdentifier,c=r.views.get(o);if(!c){let h=Hc(e,a?n:null),d=!1;h?d=!0:n instanceof gt?(h=mp(e,n),d=!1):(h=gt.EMPTY_NODE,d=!1);const f=ru(new Is(h,d,!1),new Is(n,a,!1));return new jR(t,f)}return c}function ZR(r,t,e,n,a,o){const c=QR(r,t,n,a,o);return r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,c),qR(c,e),YR(c,e)}function JR(r,t,e,n){const a=t._queryIdentifier,o=[];let c=[];const h=es(r);if(a==="default")for(const[d,f]of r.views.entries())c=c.concat(Qb(f,e,n)),Kb(f)&&(r.views.delete(d),f.query._queryParams.loadsAllData()||o.push(f.query));else{const d=r.views.get(a);d&&(c=c.concat(Qb(d,e,n)),Kb(d)&&(r.views.delete(a),d.query._queryParams.loadsAllData()||o.push(d.query)))}return h&&!es(r)&&o.push(new(WR())(t._repo,t._path)),{removed:o,events:c}}function q0(r){const t=[];for(const e of r.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function Ga(r,t){let e=null;for(const n of r.views.values())e=e||VR(n,t);return e}function Y0(r,t){if(t._queryParams.loadsAllData())return ou(r);{const n=t._queryIdentifier;return r.views.get(n)}}function X0(r,t){return Y0(r,t)!=null}function es(r){return ou(r)!=null}function ou(r){for(const t of r.views.values())if(t.query._queryParams.loadsAllData())return t;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc;function tD(r){Q(!Gc,"__referenceConstructor has already been defined"),Gc=r}function eD(){return Q(Gc,"Reference.ts has not been loaded"),Gc}let nD=1;class Jb{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Wt(null),this.pendingWriteTree_=MR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function $0(r,t,e,n,a){return bR(r.pendingWriteTree_,t,e,n,a),a?Xo(r,new Ls(I0(),t,e)):[]}function Ts(r,t,e=!1){const n=vR(r.pendingWriteTree_,t);if(AR(r.pendingWriteTree_,t)){let o=new Wt(null);return n.snap!=null?o=o.set(Pt(),!0):Be(n.children,c=>{o=o.set(new zt(c),!0)}),Xo(r,new Fc(n.path,o,e))}else return[]}function lu(r,t,e){return Xo(r,new Ls(fp(),t,e))}function iD(r,t,e){const n=Wt.fromObject(e);return Xo(r,new Io(fp(),t,n))}function sD(r,t){return Xo(r,new Lo(fp(),t))}function aD(r,t,e){const n=Ap(r,e);if(n){const a=Sp(n),o=a.path,c=a.queryId,h=Qe(o,t),d=new Lo(pp(c),h);return Ep(r,o,d)}else return[]}function kf(r,t,e,n,a=!1){const o=t._path,c=r.syncPointTree_.get(o);let h=[];if(c&&(t._queryIdentifier==="default"||X0(c,t))){const d=JR(c,t,e,n);KR(c)&&(r.syncPointTree_=r.syncPointTree_.remove(o));const f=d.removed;if(h=d.events,!a){const g=f.findIndex(y=>y._queryParams.loadsAllData())!==-1,_=r.syncPointTree_.findOnPath(o,(y,b)=>es(b));if(g&&!_){const y=r.syncPointTree_.subtree(o);if(!y.isEmpty()){const b=lD(y);for(let A=0;A<b.length;++A){const S=b[A],C=S.query,w=Q0(r,S);r.listenProvider_.startListening(Ao(C),Vc(r,C),w.hashFn,w.onComplete)}}}!_&&f.length>0&&!n&&(g?r.listenProvider_.stopListening(Ao(t),null):f.forEach(y=>{const b=r.queryToTagMap.get(cu(y));r.listenProvider_.stopListening(Ao(y),b)}))}cD(r,f)}return h}function rD(r,t,e,n){const a=Ap(r,n);if(a!=null){const o=Sp(a),c=o.path,h=o.queryId,d=Qe(c,t),f=new Ls(pp(h),d,e);return Ep(r,c,f)}else return[]}function oD(r,t,e,n){const a=Ap(r,n);if(a){const o=Sp(a),c=o.path,h=o.queryId,d=Qe(c,t),f=Wt.fromObject(e),g=new Io(pp(h),d,f);return Ep(r,c,g)}else return[]}function tv(r,t,e,n=!1){const a=t._path;let o=null,c=!1;r.syncPointTree_.foreachOnPath(a,(y,b)=>{const A=Qe(y,a);o=o||Ga(b,A),c=c||es(b)});let h=r.syncPointTree_.get(a);h?(c=c||es(h),o=o||Ga(h,Pt())):(h=new XR,r.syncPointTree_=r.syncPointTree_.set(a,h));let d;o!=null?d=!0:(d=!1,o=gt.EMPTY_NODE,r.syncPointTree_.subtree(a).foreachChild((b,A)=>{const S=Ga(A,Pt());S&&(o=o.updateImmediateChild(b,S))}));const f=X0(h,t);if(!f&&!t._queryParams.loadsAllData()){const y=cu(t);Q(!r.queryToTagMap.has(y),"View does not exist, but we have a tag");const b=uD();r.queryToTagMap.set(y,b),r.tagToQueryMap.set(b,y)}const g=gp(r.pendingWriteTree_,a);let _=ZR(h,t,e,g,o,d);if(!f&&!c&&!n){const y=Y0(h,t);_=_.concat(hD(r,t,y))}return _}function vp(r,t,e){const a=r.pendingWriteTree_,o=r.syncPointTree_.findOnPath(t,(c,h)=>{const d=Qe(c,t),f=Ga(h,d);if(f)return f});return H0(a,t,o,e,!0)}function Xo(r,t){return W0(t,r.syncPointTree_,null,gp(r.pendingWriteTree_,Pt()))}function W0(r,t,e,n){if(xt(r.path))return K0(r,t,e,n);{const a=t.get(Pt());e==null&&a!=null&&(e=Ga(a,Pt()));let o=[];const c=wt(r.path),h=r.operationForChild(c),d=t.children.get(c);if(d&&h){const f=e?e.getImmediateChild(c):null,g=z0(n,c);o=o.concat(W0(h,d,f,g))}return a&&(o=o.concat(bp(a,r,n,e))),o}}function K0(r,t,e,n){const a=t.get(Pt());e==null&&a!=null&&(e=Ga(a,Pt()));let o=[];return t.children.inorderTraversal((c,h)=>{const d=e?e.getImmediateChild(c):null,f=z0(n,c),g=r.operationForChild(c);g&&(o=o.concat(K0(g,h,d,f)))}),a&&(o=o.concat(bp(a,r,n,e))),o}function Q0(r,t){const e=t.query,n=Vc(r,e);return{hashFn:()=>(GR(t)||gt.EMPTY_NODE).hash(),onComplete:a=>{if(a==="ok")return n?aD(r,e._path,n):sD(r,e._path);{const o=ax(a,e);return kf(r,e,null,o)}}}}function Vc(r,t){const e=cu(t);return r.queryToTagMap.get(e)}function cu(r){return r._path.toString()+"$"+r._queryIdentifier}function Ap(r,t){return r.tagToQueryMap.get(t)}function Sp(r){const t=r.indexOf("$");return Q(t!==-1&&t<r.length-1,"Bad queryKey."),{queryId:r.substr(t+1),path:new zt(r.substr(0,t))}}function Ep(r,t,e){const n=r.syncPointTree_.get(t);Q(n,"Missing sync point for query tag that we're tracking");const a=gp(r.pendingWriteTree_,t);return bp(n,e,a,null)}function lD(r){return r.fold((t,e,n)=>{if(e&&es(e))return[ou(e)];{let a=[];return e&&(a=q0(e)),Be(n,(o,c)=>{a=a.concat(c)}),a}})}function Ao(r){return r._queryParams.loadsAllData()&&!r._queryParams.isDefault()?new(eD())(r._repo,r._path):r}function cD(r,t){for(let e=0;e<t.length;++e){const n=t[e];if(!n._queryParams.loadsAllData()){const a=cu(n),o=r.queryToTagMap.get(a);r.queryToTagMap.delete(a),r.tagToQueryMap.delete(o)}}}function uD(){return nD++}function hD(r,t,e){const n=t._path,a=Vc(r,t),o=Q0(r,e),c=r.listenProvider_.startListening(Ao(t),a,o.hashFn,o.onComplete),h=r.syncPointTree_.subtree(n);if(a)Q(!es(h.value),"If we're adding a query, it shouldn't be shadowed");else{const d=h.fold((f,g,_)=>{if(!xt(f)&&g&&es(g))return[ou(g).query];{let y=[];return g&&(y=y.concat(q0(g).map(b=>b.query))),Be(_,(b,A)=>{y=y.concat(A)}),y}});for(let f=0;f<d.length;++f){const g=d[f];r.listenProvider_.stopListening(Ao(g),Vc(r,g))}}return c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wp{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new wp(e)}node(){return this.node_}}class Cp{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=oe(this.path_,t);return new Cp(this.syncTree_,e)}node(){return vp(this.syncTree_,this.path_)}}const dD=function(r){return r=r||{},r.timestamp=r.timestamp||new Date().getTime(),r},ev=function(r,t,e){if(!r||typeof r!="object")return r;if(Q(".sv"in r,"Unexpected leaf node or priority contents"),typeof r[".sv"]=="string")return fD(r[".sv"],t,e);if(typeof r[".sv"]=="object")return pD(r[".sv"],t);Q(!1,"Unexpected server value: "+JSON.stringify(r,null,2))},fD=function(r,t,e){switch(r){case"timestamp":return e.timestamp;default:Q(!1,"Unexpected server value: "+r)}},pD=function(r,t,e){r.hasOwnProperty("increment")||Q(!1,"Unexpected server value: "+JSON.stringify(r,null,2));const n=r.increment;typeof n!="number"&&Q(!1,"Unexpected increment value: "+n);const a=t.node();if(Q(a!==null&&typeof a<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!a.isLeafNode())return n;const c=a.getValue();return typeof c!="number"?n:c+n},gD=function(r,t,e,n){return Tp(t,new Cp(e,r),n)},Z0=function(r,t,e){return Tp(r,new wp(t),e)};function Tp(r,t,e){const n=r.getPriority().val(),a=ev(n,t.getImmediateChild(".priority"),e);let o;if(r.isLeafNode()){const c=r,h=ev(c.getValue(),t,e);return h!==c.getValue()||a!==c.getPriority().val()?new Ee(h,pe(a)):r}else{const c=r;return o=c,a!==c.getPriority().val()&&(o=o.updatePriority(new Ee(a))),c.forEachChild(ee,(h,d)=>{const f=Tp(d,t.getImmediateChild(h),e);f!==d&&(o=o.updateImmediateChild(h,f))}),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function Rp(r,t){let e=t instanceof zt?t:new zt(t),n=r,a=wt(e);for(;a!==null;){const o=Ya(n.node.children,a)||{children:{},childCount:0};n=new xp(a,n,o),e=Yt(e),a=wt(e)}return n}function er(r){return r.node.value}function J0(r,t){r.node.value=t,Lf(r)}function tA(r){return r.node.childCount>0}function mD(r){return er(r)===void 0&&!tA(r)}function uu(r,t){Be(r.node.children,(e,n)=>{t(new xp(e,r,n))})}function eA(r,t,e,n){e&&t(r),uu(r,a=>{eA(a,t,!0)})}function _D(r,t,e){let n=r.parent;for(;n!==null;){if(t(n))return!0;n=n.parent}return!1}function $o(r){return new zt(r.parent===null?r.name:$o(r.parent)+"/"+r.name)}function Lf(r){r.parent!==null&&yD(r.parent,r.name,r)}function yD(r,t,e){const n=mD(e),a=$n(r.node.children,t);n&&a?(delete r.node.children[t],r.node.childCount--,Lf(r)):!n&&!a&&(r.node.children[t]=e.node,r.node.childCount++,Lf(r))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bD=/[\[\].#$\/\u0000-\u001F\u007F]/,vD=/[\[\].#$\u0000-\u001F\u007F]/,Qd=10*1024*1024,Dp=function(r){return typeof r=="string"&&r.length!==0&&!bD.test(r)},nA=function(r){return typeof r=="string"&&r.length!==0&&!vD.test(r)},AD=function(r){return r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),nA(r)},iA=function(r){return r===null||typeof r=="string"||typeof r=="number"&&!su(r)||r&&typeof r=="object"&&$n(r,".sv")},qc=function(r,t,e,n){n&&t===void 0||hu(Xa(r,"value"),t,e)},hu=function(r,t,e){const n=e instanceof zt?new Hx(e,r):e;if(t===void 0)throw new Error(r+"contains undefined "+Es(n));if(typeof t=="function")throw new Error(r+"contains a function "+Es(n)+" with contents = "+t.toString());if(su(t))throw new Error(r+"contains "+t.toString()+" "+Es(n));if(typeof t=="string"&&t.length>Qd/3&&iu(t)>Qd)throw new Error(r+"contains a string greater than "+Qd+" utf8 bytes "+Es(n)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let a=!1,o=!1;if(Be(t,(c,h)=>{if(c===".value")a=!0;else if(c!==".priority"&&c!==".sv"&&(o=!0,!Dp(c)))throw new Error(r+" contains an invalid key ("+c+") "+Es(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);zx(n,c),hu(r,h,n),Ux(n)}),a&&o)throw new Error(r+' contains ".value" child '+Es(n)+" in addition to actual children.")}},SD=function(r,t){let e,n;for(e=0;e<t.length;e++){n=t[e];const o=Mo(n);for(let c=0;c<o.length;c++)if(!(o[c]===".priority"&&c===o.length-1)){if(!Dp(o[c]))throw new Error(r+"contains an invalid key ("+o[c]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}t.sort(Fx);let a=null;for(e=0;e<t.length;e++){if(n=t[e],a!==null&&wn(a,n))throw new Error(r+"contains a path "+a.toString()+" that is ancestor of another path "+n.toString());a=n}},ED=function(r,t,e,n){const a=Xa(r,"values");if(!(t&&typeof t=="object")||Array.isArray(t))throw new Error(a+" must be an object containing the children to replace.");const o=[];Be(t,(c,h)=>{const d=new zt(c);if(hu(a,h,oe(e,d)),op(d)===".priority"&&!iA(h))throw new Error(a+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(d)}),SD(a,o)},wD=function(r,t,e){if(su(t))throw new Error(Xa(r,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!iA(t))throw new Error(Xa(r,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},sA=function(r,t,e,n){if(!nA(e))throw new Error(Xa(r,t)+'was an invalid path = "'+e+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},CD=function(r,t,e,n){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),sA(r,t,e)},Ba=function(r,t){if(wt(t)===".info")throw new Error(r+" failed = Can't modify data under /.info/")},TD=function(r,t){const e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!Dp(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!AD(e))throw new Error(Xa(r,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Mp(r,t){let e=null;for(let n=0;n<t.length;n++){const a=t[n],o=a.getPath();e!==null&&!lp(o,e.path)&&(r.eventLists_.push(e),e=null),e===null&&(e={events:[],path:o}),e.events.push(a)}e&&r.eventLists_.push(e)}function aA(r,t,e){Mp(r,e),rA(r,n=>lp(n,t))}function yi(r,t,e){Mp(r,e),rA(r,n=>wn(n,t)||wn(t,n))}function rA(r,t){r.recursionDepth_++;let e=!0;for(let n=0;n<r.eventLists_.length;n++){const a=r.eventLists_[n];if(a){const o=a.path;t(o)?(RD(r.eventLists_[n]),r.eventLists_[n]=null):e=!1}}e&&(r.eventLists_=[]),r.recursionDepth_--}function RD(r){for(let t=0;t<r.events.length;t++){const e=r.events[t];if(e!==null){r.events[t]=null;const n=e.getEventRunner();_o&&Oe("event: "+e.toString()),Ja(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD="repo_interrupt",MD=25;class ND{constructor(t,e,n,a){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=a,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new xD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Bc(),this.transactionQueueTree_=new xp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function OD(r,t,e){if(r.stats_=ap(r.repoInfo_),r.forceRestClient_||cx())r.server_=new Pc(r.repoInfo_,(n,a,o,c)=>{nv(r,n,a,o,c)},r.authTokenProvider_,r.appCheckProvider_),setTimeout(()=>iv(r,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ce(e)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}r.persistentConnection_=new gi(r.repoInfo_,t,(n,a,o,c)=>{nv(r,n,a,o,c)},n=>{iv(r,n)},n=>{kD(r,n)},r.authTokenProvider_,r.appCheckProvider_,e),r.server_=r.persistentConnection_}r.authTokenProvider_.addTokenChangeListener(n=>{r.server_.refreshAuthToken(n)}),r.appCheckProvider_.addTokenChangeListener(n=>{r.server_.refreshAppCheckToken(n.token)}),r.statsReporter_=px(r.repoInfo_,()=>new fR(r.stats_,r.server_)),r.infoData_=new lR,r.infoSyncTree_=new Jb({startListening:(n,a,o,c)=>{let h=[];const d=r.infoData_.getNode(n._path);return d.isEmpty()||(h=lu(r.infoSyncTree_,n._path,d),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),Op(r,"connected",!1),r.serverSyncTree_=new Jb({startListening:(n,a,o,c)=>(r.server_.listen(n,o,a,(h,d)=>{const f=c(h,d);yi(r.eventQueue_,n._path,f)}),[]),stopListening:(n,a)=>{r.server_.unlisten(n,a)}})}function oA(r){const e=r.infoData_.getNode(new zt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function Np(r){return dD({timestamp:oA(r)})}function nv(r,t,e,n,a){r.dataUpdateCount++;const o=new zt(t);e=r.interceptServerDataCallback_?r.interceptServerDataCallback_(t,e):e;let c=[];if(a)if(n){const d=Dc(e,f=>pe(f));c=oD(r.serverSyncTree_,o,d,a)}else{const d=pe(e);c=rD(r.serverSyncTree_,o,d,a)}else if(n){const d=Dc(e,f=>pe(f));c=iD(r.serverSyncTree_,o,d)}else{const d=pe(e);c=lu(r.serverSyncTree_,o,d)}let h=o;c.length>0&&(h=du(r,o)),yi(r.eventQueue_,h,c)}function iv(r,t){Op(r,"connected",t),t===!1&&ID(r)}function kD(r,t){Be(t,(e,n)=>{Op(r,e,n)})}function Op(r,t,e){const n=new zt("/.info/"+t),a=pe(e);r.infoData_.updateSnapshot(n,a);const o=lu(r.infoSyncTree_,n,a);yi(r.eventQueue_,n,o)}function lA(r){return r.nextWriteId_++}function LD(r,t,e,n,a){kp(r,"set",{path:t.toString(),value:e,priority:n});const o=Np(r),c=pe(e,n),h=vp(r.serverSyncTree_,t),d=Z0(c,h,o),f=lA(r),g=$0(r.serverSyncTree_,t,d,f,!0);Mp(r.eventQueue_,g),r.server_.put(t.toString(),c.val(!0),(y,b)=>{const A=y==="ok";A||Je("set at "+t+" failed: "+y);const S=Ts(r.serverSyncTree_,f,!A);yi(r.eventQueue_,t,S),Qa(r,a,y,b)});const _=fA(r,t);du(r,_),yi(r.eventQueue_,_,[])}function ID(r){kp(r,"onDisconnectEvents");const t=Np(r),e=Bc();xf(r.onDisconnect_,Pt(),(a,o)=>{const c=gD(a,o,r.serverSyncTree_,t);tr(e,a,c)});let n=[];xf(e,Pt(),(a,o)=>{n=n.concat(lu(r.serverSyncTree_,a,o));const c=fA(r,a);du(r,c)}),r.onDisconnect_=Bc(),yi(r.eventQueue_,Pt(),n)}function PD(r,t,e){r.server_.onDisconnectCancel(t.toString(),(n,a)=>{n==="ok"&&Tf(r.onDisconnect_,t),Qa(r,e,n,a)})}function sv(r,t,e,n){const a=pe(e);r.server_.onDisconnectPut(t.toString(),a.val(!0),(o,c)=>{o==="ok"&&tr(r.onDisconnect_,t,a),Qa(r,n,o,c)})}function BD(r,t,e,n,a){const o=pe(e,n);r.server_.onDisconnectPut(t.toString(),o.val(!0),(c,h)=>{c==="ok"&&tr(r.onDisconnect_,t,o),Qa(r,a,c,h)})}function FD(r,t,e,n){if(_f(e)){Oe("onDisconnect().update() called with empty data.  Don't do anything."),Qa(r,n,"ok",void 0);return}r.server_.onDisconnectMerge(t.toString(),e,(a,o)=>{a==="ok"&&Be(e,(c,h)=>{const d=pe(h);tr(r.onDisconnect_,oe(t,c),d)}),Qa(r,n,a,o)})}function HD(r,t,e){let n;wt(t._path)===".info"?n=tv(r.infoSyncTree_,t,e):n=tv(r.serverSyncTree_,t,e),aA(r.eventQueue_,t._path,n)}function zD(r,t,e){let n;wt(t._path)===".info"?n=kf(r.infoSyncTree_,t,e):n=kf(r.serverSyncTree_,t,e),aA(r.eventQueue_,t._path,n)}function UD(r){r.persistentConnection_&&r.persistentConnection_.interrupt(DD)}function kp(r,...t){let e="";r.persistentConnection_&&(e=r.persistentConnection_.id+":"),Oe(e,...t)}function Qa(r,t,e,n){t&&Ja(()=>{if(e==="ok")t(null);else{const a=(e||"error").toUpperCase();let o=a;n&&(o+=": "+n);const c=new Error(o);c.code=a,t(c)}})}function cA(r,t,e){return vp(r.serverSyncTree_,t,e)||gt.EMPTY_NODE}function Lp(r,t=r.transactionQueueTree_){if(t||fu(r,t),er(t)){const e=hA(r,t);Q(e.length>0,"Sending zero length transaction queue"),e.every(a=>a.status===0)&&jD(r,$o(t),e)}else tA(t)&&uu(t,e=>{Lp(r,e)})}function jD(r,t,e){const n=e.map(f=>f.currentWriteId),a=cA(r,t,n);let o=a;const c=a.hash();for(let f=0;f<e.length;f++){const g=e[f];Q(g.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),g.status=1,g.retryCount++;const _=Qe(t,g.path);o=o.updateChild(_,g.currentOutputSnapshotRaw)}const h=o.val(!0),d=t;r.server_.put(d.toString(),h,f=>{kp(r,"transaction put response",{path:d.toString(),status:f});let g=[];if(f==="ok"){const _=[];for(let y=0;y<e.length;y++)e[y].status=2,g=g.concat(Ts(r.serverSyncTree_,e[y].currentWriteId)),e[y].onComplete&&_.push(()=>e[y].onComplete(null,!0,e[y].currentOutputSnapshotResolved)),e[y].unwatcher();fu(r,Rp(r.transactionQueueTree_,t)),Lp(r,r.transactionQueueTree_),yi(r.eventQueue_,t,g);for(let y=0;y<_.length;y++)Ja(_[y])}else{if(f==="datastale")for(let _=0;_<e.length;_++)e[_].status===3?e[_].status=4:e[_].status=0;else{Je("transaction at "+d.toString()+" failed: "+f);for(let _=0;_<e.length;_++)e[_].status=4,e[_].abortReason=f}du(r,t)}},c)}function du(r,t){const e=uA(r,t),n=$o(e),a=hA(r,e);return GD(r,a,n),n}function GD(r,t,e){if(t.length===0)return;const n=[];let a=[];const c=t.filter(h=>h.status===0).map(h=>h.currentWriteId);for(let h=0;h<t.length;h++){const d=t[h],f=Qe(e,d.path);let g=!1,_;if(Q(f!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),d.status===4)g=!0,_=d.abortReason,a=a.concat(Ts(r.serverSyncTree_,d.currentWriteId,!0));else if(d.status===0)if(d.retryCount>=MD)g=!0,_="maxretry",a=a.concat(Ts(r.serverSyncTree_,d.currentWriteId,!0));else{const y=cA(r,d.path,c);d.currentInputSnapshot=y;const b=t[h].update(y.val());if(b!==void 0){hu("transaction failed: Data returned ",b,d.path);let A=pe(b);typeof b=="object"&&b!=null&&$n(b,".priority")||(A=A.updatePriority(y.getPriority()));const C=d.currentWriteId,w=Np(r),D=Z0(A,y,w);d.currentOutputSnapshotRaw=A,d.currentOutputSnapshotResolved=D,d.currentWriteId=lA(r),c.splice(c.indexOf(C),1),a=a.concat($0(r.serverSyncTree_,d.path,D,d.currentWriteId,d.applyLocally)),a=a.concat(Ts(r.serverSyncTree_,C,!0))}else g=!0,_="nodata",a=a.concat(Ts(r.serverSyncTree_,d.currentWriteId,!0))}yi(r.eventQueue_,e,a),a=[],g&&(t[h].status=2,(function(y){setTimeout(y,Math.floor(0))})(t[h].unwatcher),t[h].onComplete&&(_==="nodata"?n.push(()=>t[h].onComplete(null,!1,t[h].currentInputSnapshot)):n.push(()=>t[h].onComplete(new Error(_),!1,null))))}fu(r,r.transactionQueueTree_);for(let h=0;h<n.length;h++)Ja(n[h]);Lp(r,r.transactionQueueTree_)}function uA(r,t){let e,n=r.transactionQueueTree_;for(e=wt(t);e!==null&&er(n)===void 0;)n=Rp(n,e),t=Yt(t),e=wt(t);return n}function hA(r,t){const e=[];return dA(r,t,e),e.sort((n,a)=>n.order-a.order),e}function dA(r,t,e){const n=er(t);if(n)for(let a=0;a<n.length;a++)e.push(n[a]);uu(t,a=>{dA(r,a,e)})}function fu(r,t){const e=er(t);if(e){let n=0;for(let a=0;a<e.length;a++)e[a].status!==2&&(e[n]=e[a],n++);e.length=n,J0(t,e.length>0?e:void 0)}uu(t,n=>{fu(r,n)})}function fA(r,t){const e=$o(uA(r,t)),n=Rp(r.transactionQueueTree_,t);return _D(n,a=>{Zd(r,a)}),Zd(r,n),eA(n,a=>{Zd(r,a)}),e}function Zd(r,t){const e=er(t);if(e){const n=[];let a=[],o=-1;for(let c=0;c<e.length;c++)e[c].status===3||(e[c].status===1?(Q(o===c-1,"All SENT items should be at beginning of queue."),o=c,e[c].status=3,e[c].abortReason="set"):(Q(e[c].status===0,"Unexpected transaction status in abort"),e[c].unwatcher(),a=a.concat(Ts(r.serverSyncTree_,e[c].currentWriteId,!0)),e[c].onComplete&&n.push(e[c].onComplete.bind(null,new Error("set"),!1,null))));o===-1?J0(t,void 0):e.length=o+1,yi(r.eventQueue_,$o(t),a);for(let c=0;c<n.length;c++)Ja(n[c])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VD(r){let t="";const e=r.split("/");for(let n=0;n<e.length;n++)if(e[n].length>0){let a=e[n];try{a=decodeURIComponent(a.replace(/\+/g," "))}catch{}t+="/"+a}return t}function qD(r){const t={};r.charAt(0)==="?"&&(r=r.substring(1));for(const e of r.split("&")){if(e.length===0)continue;const n=e.split("=");n.length===2?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Je(`Invalid query segment '${e}' in query '${r}'`)}return t}const av=function(r,t){const e=YD(r),n=e.namespace;e.domain==="firebase.com"&&_i(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&e.domain!=="localhost"&&_i("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||tx();const a=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new y0(e.host,e.secure,n,a,t,"",n!==e.subdomain),path:new zt(e.pathString)}},YD=function(r){let t="",e="",n="",a="",o="",c=!0,h="https",d=443;if(typeof r=="string"){let f=r.indexOf("//");f>=0&&(h=r.substring(0,f-1),r=r.substring(f+2));let g=r.indexOf("/");g===-1&&(g=r.length);let _=r.indexOf("?");_===-1&&(_=r.length),t=r.substring(0,Math.min(g,_)),g<_&&(a=VD(r.substring(g,_)));const y=qD(r.substring(Math.min(r.length,_)));f=t.indexOf(":"),f>=0?(c=h==="https"||h==="wss",d=parseInt(t.substring(f+1),10)):f=t.length;const b=t.slice(0,f);if(b.toLowerCase()==="localhost")e="localhost";else if(b.split(".").length<=2)e=b;else{const A=t.indexOf(".");n=t.substring(0,A).toLowerCase(),e=t.substring(A+1),o=n}"ns"in y&&(o=y.ns)}return{host:t,port:d,domain:e,subdomain:n,secure:c,scheme:h,pathString:a,namespace:o}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",XD=(function(){let r=0;const t=[];return function(e){const n=e===r;r=e;let a;const o=new Array(8);for(a=7;a>=0;a--)o[a]=rv.charAt(e%64),e=Math.floor(e/64);Q(e===0,"Cannot push at time == 0");let c=o.join("");if(n){for(a=11;a>=0&&t[a]===63;a--)t[a]=0;t[a]++}else for(a=0;a<12;a++)t[a]=Math.floor(Math.random()*64);for(a=0;a<12;a++)c+=rv.charAt(t[a]);return Q(c.length===20,"nextPushId: Length should be 20."),c}})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(t,e,n,a){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=a}getPath(){const t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ce(this.snapshot.exportVal())}}class WD{constructor(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return Q(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(t,e){this._repo=t,this._path=e}cancel(){const t=new fi;return PD(this._repo,this._path,t.wrapCallback(()=>{})),t.promise}remove(){Ba("OnDisconnect.remove",this._path);const t=new fi;return sv(this._repo,this._path,null,t.wrapCallback(()=>{})),t.promise}set(t){Ba("OnDisconnect.set",this._path),qc("OnDisconnect.set",t,this._path,!1);const e=new fi;return sv(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}setWithPriority(t,e){Ba("OnDisconnect.setWithPriority",this._path),qc("OnDisconnect.setWithPriority",t,this._path,!1),wD("OnDisconnect.setWithPriority",e);const n=new fi;return BD(this._repo,this._path,t,e,n.wrapCallback(()=>{})),n.promise}update(t){Ba("OnDisconnect.update",this._path),ED("OnDisconnect.update",t,this._path);const e=new fi;return FD(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(t,e,n,a){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=a}get key(){return xt(this._path)?null:op(this._path)}get ref(){return new ns(this._repo,this._path)}get _queryIdentifier(){const t=jb(this._queryParams),e=ip(t);return e==="{}"?"default":e}get _queryObject(){return jb(this._queryParams)}isEqual(t){if(t=Hs(t),!(t instanceof Ip))return!1;const e=this._repo===t._repo,n=lp(this._path,t._path),a=this._queryIdentifier===t._queryIdentifier;return e&&n&&a}toJSON(){return this.toString()}toString(){return this._repo.toString()+Bx(this._path)}}class ns extends Ip{constructor(t,e){super(t,e,new dp,!1)}get parent(){const t=x0(this._path);return t===null?null:new ns(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}}class Yc{constructor(t,e,n){this._node=t,this.ref=e,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new zt(t),n=Po(this.ref,t);return new Yc(this._node.getChild(e),n,ee)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,a)=>t(new Yc(a,Po(this.ref,n),ee)))}hasChild(t){const e=new zt(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Vi(r,t){return r=Hs(r),r._checkNotDeleted("ref"),t!==void 0?Po(r._root,t):r._root}function Po(r,t){return r=Hs(r),wt(r._path)===null?CD("child","path",t):sA("child","path",t),new ns(r._repo,oe(r._path,t))}function ZD(r){return r=Hs(r),new QD(r._repo,r._path)}function JD(r,t){r=Hs(r),Ba("push",r._path),qc("push",t,r._path,!0);const e=oA(r._repo),n=XD(e),a=Po(r,n),o=Po(r,n);let c;return t!=null?c=wc(o,t).then(()=>o):c=Promise.resolve(o),a.then=c.then.bind(c),a.catch=c.then.bind(c,void 0),a}function wc(r,t){r=Hs(r),Ba("set",r._path),qc("set",t,r._path,!1);const e=new fi;return LD(r._repo,r._path,t,null,e.wrapCallback(()=>{})),e.promise}class Pp{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,e){const n=e._queryParams.getIndex();return new $D("value",this,new Yc(t.snapshotNode,new ns(e._repo,e._path),n))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new WD(this,t,e):null}matches(t){return t instanceof Pp?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function tM(r,t,e,n,a){const o=new KD(e,void 0),c=new Pp(o);return HD(r._repo,r,c),()=>zD(r._repo,r,c)}function bc(r,t,e,n){return tM(r,"value",t)}$R(ns);tD(ns);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eM="FIREBASE_DATABASE_EMULATOR_HOST",If={};let nM=!1;function iM(r,t,e,n){const a=t.lastIndexOf(":"),o=t.substring(0,a),c=ep(o);r.repoInfo_=new y0(t,c,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0,e),n&&(r.authTokenProvider_=n)}function sM(r,t,e,n,a){let o=n||r.options.databaseURL;o===void 0&&(r.options.projectId||_i("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Oe("Using default host for project ",r.options.projectId),o=`${r.options.projectId}-default-rtdb.firebaseio.com`);let c=av(o,a),h=c.repoInfo,d;typeof process<"u"&&wb&&(d=wb[eM]),d?(o=`http://${d}?ns=${h.namespace}`,c=av(o,a),h=c.repoInfo):c.repoInfo.secure;const f=new hx(r.name,r.options,t);TD("Invalid Firebase Database URL",c),xt(c.path)||_i("Database URL must point to the root of a Firebase Database (not including a child path).");const g=rM(h,r,f,new ux(r,e));return new oM(g,r)}function aM(r,t){const e=If[t];(!e||e[r.key]!==r)&&_i(`Database ${t}(${r.repoInfo_}) has already been deleted.`),UD(r),delete e[r.key]}function rM(r,t,e,n){let a=If[t.name];a||(a={},If[t.name]=a);let o=a[r.toURLString()];return o&&_i("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new ND(r,nM,e,n),a[r.toURLString()]=o,o}class oM{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(OD(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ns(this._repo,Pt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(aM(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&_i("Cannot call "+t+" on a deleted database.")}}function lM(r=IT(),t){const e=MT(r,"database").getImmediate({identifier:t});if(!e._instanceStarted){const n=gC("database");n&&cM(e,...n)}return e}function cM(r,t,e,n={}){r=Hs(r),r._checkNotDeleted("useEmulator");const a=`${t}:${e}`,o=r._repoInternal;if(r._instanceStarted){if(a===r._repoInternal.repoInfo_.host&&Mc(n,o.repoInfo_.emulatorOptions))return;_i("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let c;if(o.repoInfo_.nodeAdmin)n.mockUserToken&&_i('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),c=new Ec(Ec.OWNER);else if(n.mockUserToken){const h=typeof n.mockUserToken=="string"?n.mockUserToken:_C(n.mockUserToken,r.app.options.projectId);c=new Ec(h)}ep(t)&&(mC(t),vC("Database",!0)),iM(o,a,n,c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uM(r){$T(LT),Oc(new xo("database",(t,{instanceIdentifier:e})=>{const n=t.getProvider("app").getImmediate(),a=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return sM(n,a,o,e)},"PUBLIC").setMultipleInstances(!0)),za(Cb,Tb,r),za(Cb,Tb,"esm2020")}gi.prototype.simpleListen=function(r,t){this.sendRequest("q",{p:r},t)};gi.prototype.echo=function(r,t){this.sendRequest("echo",{d:r},t)};uM();const hM={apiKey:"",authDomain:"watchtask-35eb1.firebaseapp.com",databaseURL:"https://watchtask-35eb1-default-rtdb.firebaseio.com",projectId:"watchtask-35eb1",storageBucket:"watchtask-35eb1.appspot.com",messagingSenderId:"421711878688",appId:"1:421711878688:web:xxxxxxxxxxxxxxxx"},dM=e0(hM),qi=lM(dM);function ov(){return crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}const Yi="peers",fM="profilesDB",qn="profiles";async function Ma(){return Jf(fM,1,{upgrade(r){r.objectStoreNames.contains(qn)||r.createObjectStore(qn,{keyPath:"code"})}})}function pM({autoStart:r=!0}={}){const[t]=St.useState(()=>ov()),[e,n]=St.useState(null),[a,o]=St.useState([]),[c,h]=St.useState({}),[d,f]=St.useState([]),[g,_]=St.useState("idle"),[y,b]=St.useState(!1),A=St.useRef(null),S=St.useRef({}),C=St.useRef({}),w=St.useRef(null),D=St.useRef(!1),x=St.useCallback(M=>f(V=>[...V,M]),[]),k=St.useCallback(async()=>{const V=await(await Ma()).getAll(qn);o(V)},[]),O=St.useCallback(async M=>{if(!M||!M.code)return;const V=await Ma();await V.get(qn,M.code)||(await V.put(qn,M),await k(),x(`Perfil ${M.code} almacenado`))},[k,x]),P=St.useCallback((M,V)=>{try{const Z=JSON.parse(V);if(Z.__type==="profile"){h(T=>({...T,[M]:{...T[M]||{},profile:Z.profile}})),O(Z.profile);return}if(Z.__type==="profilesSync"&&Array.isArray(Z.profiles)){Z.profiles.forEach(T=>O(T));return}if(Z.__type==="loginValidateRequest"){const{code:T,password:H}=Z;(async()=>{const W=await(await Ma()).get(qn,T),rt=!!W&&(!W.password||W.password===H),_t=S.current[M];_t?.dc?.readyState==="open"&&_t.dc.send(JSON.stringify({__type:"loginValidateResult",code:T,ok:rt}))})();return}if(Z.__type==="loginValidateResult"){A.current&&A.current.code===Z.code&&Z.ok&&(b(!0),A.current=null,_("login validado (remoto)"),x("Login validado remotamente"));return}}catch{}x(`${M}: ${V}`)},[x,O,a]),j=St.useCallback(async()=>{try{const M=await Ma();if(!await M.get(qn,"1111")){const Z={code:"1111",name:"Root Admin",uuid:ov(),role:"admin",speciality:"admin",password:"1234"};await M.put(qn,Z),x("Perfil root admin creado (1111 / 1234)"),await k()}}catch{x("No se pudo crear root admin")}},[x,k]),Y=St.useCallback(async M=>{if(!D.current)throw new Error("Solo admin puede agregar perfiles");await(await Ma()).put(qn,M),await k(),Object.values(S.current).forEach(({dc:Z})=>{Z?.readyState==="open"&&Z.send(JSON.stringify({__type:"profile",profile:M}))})},[k]),K=St.useCallback(async(M,V)=>{const T=await(await Ma()).get(qn,M);if(!T)throw new Error("Perfil no encontrado local");if(T.password&&T.password!==V)throw new Error("Password incorrecto local");_("validando login remoto"),A.current={code:M,password:V},n(T),D.current=T.role==="admin",Object.values(S.current).forEach(({dc:H})=>{H?.readyState==="open"&&H.send(JSON.stringify({__type:"loginValidateRequest",code:M,password:V}))}),setTimeout(()=>{y||(b(!0),_("login validado (timeout)"),x("Login validado por timeout"))},3e3)},[x,y]),it=St.useCallback(async()=>{const M=Vi(qi,`${Yi}/${t}`);await wc(M,{ts:Date.now()}),ZD(M).remove().catch(()=>{})},[t]),J=St.useCallback(()=>{if(w.current)return;const M=Vi(qi,Yi);w.current=bc(M,V=>{const Z=V.val()||{},T=Object.keys(Z).filter(H=>H!==t);T.forEach(H=>{S.current[H]||ft(H)}),Object.keys(S.current).forEach(H=>{T.includes(H)||(S.current[H].pc.close(),delete S.current[H],h(X=>({...X,[H]:{...X[H]||{},state:"offline"}})))})})},[t]),ft=St.useCallback(M=>{const V=new RTCPeerConnection,Z=H=>{S.current[M].dc=H,h(X=>({...X,[M]:{...X[M]||{},state:H.readyState}})),H.onopen=()=>{if(h(X=>({...X,[M]:{...X[M]||{},state:"open"}})),x(`Canal abierto con ${M}`),e&&H.send(JSON.stringify({__type:"profile",profile:e})),a.length&&!C.current[M]&&(H.send(JSON.stringify({__type:"profilesSync",profiles:a})),C.current[M]=!0,x(`ProfilesSync enviado onopen a ${M}`)),A.current){const{code:X,password:W}=A.current;H.send(JSON.stringify({__type:"loginValidateRequest",code:X,password:W}))}},H.onmessage=X=>P(M,X.data),H.onclose=()=>h(X=>({...X,[M]:{...X[M]||{},state:"closed"}}))},T=V.createDataChannel("mesh");S.current[M]={pc:V,dc:T,makingOffer:!1},h(H=>({...H,[M]:{...H[M]||{},state:"connecting"}})),Z(T),V.ondatachannel=H=>{S.current[M]&&Z(H.channel)},V.onicecandidate=H=>{if(H.candidate){const X=Vi(qi,`${Yi}/${M}/candidates/${t}`);JD(X,H.candidate.toJSON())}},V.onconnectionstatechange=()=>{h(H=>({...H,[M]:{...H[M]||{},connState:V.connectionState}}))},tt(M),vt(M,V),bt(M,V)},[x,e,t,a,P]),tt=St.useCallback(async M=>{const V=S.current[M];if(!V)return;const{pc:Z}=V;try{const T=await Z.createOffer();await Z.setLocalDescription(T);const H=Vi(qi,`${Yi}/${M}/offers/${t}`);await wc(H,T)}catch{x(`Error creando offer a ${M}`)}},[x,t]),vt=St.useCallback((M,V)=>{const Z=Vi(qi,`${Yi}/${t}/offers/${M}`);bc(Z,async H=>{const X=H.val();if(X&&(!V.currentRemoteDescription||V.currentRemoteDescription.type!=="offer")){await V.setRemoteDescription(X);const W=await V.createAnswer();await V.setLocalDescription(W),await wc(Vi(qi,`${Yi}/${M}/answers/${t}`),W)}});const T=Vi(qi,`${Yi}/${t}/answers/${M}`);bc(T,async H=>{const X=H.val();X&&V.signalingState==="have-local-offer"&&await V.setRemoteDescription(X)})},[t]),bt=St.useCallback((M,V)=>{const Z=Vi(qi,`${Yi}/${t}/candidates/${M}`);bc(Z,async T=>{const H=T.val()||{};for(const X of Object.keys(H)){const W=H[X];try{await V.addIceCandidate(new RTCIceCandidate(W))}catch{}}})},[t]),I=St.useCallback(M=>{Object.entries(S.current).forEach(([V,{dc:Z}])=>{Z?.readyState==="open"&&Z.send(M)}),x(`Yo: ${M}`)},[x]);return St.useEffect(()=>{a.length&&Object.entries(S.current).forEach(([M,{dc:V}])=>{V?.readyState==="open"&&!C.current[M]&&(V.send(JSON.stringify({__type:"profilesSync",profiles:a})),C.current[M]=!0,x(`ProfilesSync enviado diferido a ${M}`))})},[a,x]),St.useEffect(()=>{if(r)return it(),J(),(async()=>(await j(),await k()))(),()=>{w.current&&w.current(),Object.values(S.current).forEach(({pc:M})=>M.close())}},[r,it,J,k,j]),{peerId:t,status:g,messages:d,peers:Object.entries(c).map(([M,V])=>({id:M,...V})),knownProfiles:a,profile:e,addProfile:Y,login:K,broadcast:I,isAdmin:D.current,loginValidated:y}}function gM(){const{peerId:r,peers:t,messages:e,knownProfiles:n,profile:a,addProfile:o,login:c,broadcast:h,isAdmin:d,loginValidated:f}=pM(),[g,_]=St.useState(""),[y,b]=St.useState(""),[A,S]=St.useState("maintenance"),[C,w]=St.useState("mechanic"),[D,x]=St.useState(""),[k,O]=St.useState(""),[P,j]=St.useState(""),[Y,K]=St.useState(""),it=async()=>{try{await o({code:g.trim(),name:y,uuid:crypto.randomUUID(),role:A,speciality:C,password:Y}),_(""),b(""),K("")}catch(tt){console.warn(tt)}},J=async()=>{try{await c(D.trim(),k)}catch(tt){console.warn(tt)}},ft=()=>{P&&(h(P),j(""))};return et.jsxs("div",{className:"flex flex-col gap-4",children:[et.jsxs("div",{className:"text-xs font-mono p-2 bg-gray-100 rounded border",children:["PeerId: ",r]}),!a&&et.jsxs("div",{className:"card bg-white border p-3 flex flex-col gap-2",children:[et.jsx("h3",{className:"heading",children:"Login"}),et.jsxs("div",{className:"flex flex-col gap-2",children:[et.jsxs("div",{className:"flex gap-2",children:[et.jsx("input",{className:"input",placeholder:"code",value:D,onChange:tt=>x(tt.target.value)}),et.jsx("input",{className:"input",placeholder:"password",type:"password",value:k,onChange:tt=>O(tt.target.value)}),et.jsx("button",{className:"btn btn-primary",onClick:J,children:"Entrar"})]}),et.jsx("div",{className:"text-[10px] text-gray-500",children:f?"Validado":"Pendiente validación"})]})]}),d&&et.jsxs("div",{className:"card bg-white border p-3 flex flex-col gap-2",children:[et.jsx("h3",{className:"heading",children:"Agregar Perfil (admin)"}),et.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[et.jsx("input",{className:"input col-span-1",placeholder:"code",value:g,onChange:tt=>_(tt.target.value)}),et.jsx("input",{className:"input col-span-1",placeholder:"nombre",value:y,onChange:tt=>b(tt.target.value)}),et.jsxs("select",{className:"input",value:A,onChange:tt=>S(tt.target.value),children:[et.jsx("option",{value:"admin",children:"admin"}),et.jsx("option",{value:"supervisor",children:"supervisor"}),et.jsx("option",{value:"maintenance",children:"maintenance"})]}),et.jsxs("select",{className:"input",value:C,onChange:tt=>w(tt.target.value),children:[et.jsx("option",{value:"electric",children:"electric"}),et.jsx("option",{value:"mechanic",children:"mechanic"}),et.jsx("option",{value:"admin",children:"admin"})]}),et.jsx("input",{className:"input col-span-2",placeholder:"password",type:"password",value:Y,onChange:tt=>K(tt.target.value)})]}),et.jsx("button",{className:"btn btn-outline",onClick:it,disabled:!g||!y,children:"Guardar"})]}),et.jsxs("div",{className:"card p-3 border flex flex-col gap-2",children:[et.jsxs("h3",{className:"heading",children:["Perfiles (",n.length,")"]}),et.jsx("ul",{className:"max-h-40 overflow-auto text-xs space-y-1",children:n.map(tt=>et.jsxs("li",{className:"px-2 py-1 bg-gray-50 rounded border flex justify-between",children:[et.jsxs("span",{children:[tt.code," - ",tt.name]}),et.jsx("span",{className:"opacity-60",children:tt.role})]},tt.code))})]}),et.jsxs("div",{className:"card p-3 border flex flex-col gap-2",children:[et.jsxs("h3",{className:"heading",children:["Peers (",t.length,")"]}),et.jsx("ul",{className:"text-xs space-y-1 max-h-32 overflow-auto",children:t.map(tt=>et.jsxs("li",{className:"px-2 py-1 bg-blue-50 rounded border border-blue-100",children:[et.jsxs("div",{className:"flex justify-between",children:[et.jsx("span",{children:tt.id.slice(0,8)}),et.jsx("span",{children:tt.state})]}),tt.profile&&et.jsxs("div",{className:"text-[10px] mt-1 italic",children:[tt.profile.name," (",tt.profile.role,")"]})]},tt.id))})]}),et.jsxs("div",{className:"card p-3 border flex flex-col gap-2",children:[et.jsx("h3",{className:"heading",children:"Chat"}),et.jsxs("div",{className:"flex gap-2",children:[et.jsx("input",{className:"input flex-1",placeholder:"mensaje",value:P,onChange:tt=>j(tt.target.value)}),et.jsx("button",{className:"btn btn-primary",onClick:ft,disabled:!P,children:"Enviar"})]}),et.jsx("ul",{className:"text-xs max-h-48 overflow-auto space-y-1",children:e.map((tt,vt)=>et.jsx("li",{className:"px-2 py-1 bg-gray-100 rounded",children:tt},vt))})]})]})}function mM(){const[r,t]=St.useState(0),[e,n]=St.useState(0);St.useEffect(()=>{navigator.storage&&navigator.storage.persist&&navigator.storage.persist().then(o=>{console.log(o?"Almacenamiento persistente garantizado":"No se pudo garantizar almacenamiento persistente")})},[]),St.useEffect(()=>{async function o(){const h=await Jf("pdfDataDB",1,{upgrade(f){f.objectStoreNames.contains("pdfData")||f.createObjectStore("pdfData",{keyPath:"id"})}});let d=0;try{d=await h.count("pdfData")}catch{d=0}n(d)}o();const c=setInterval(o,5e3);return()=>clearInterval(c)},[]);async function a(o){await sC(o,t)}return et.jsxs("div",{className:"min-h-screen flex flex-col",children:[et.jsx("header",{className:"bg-blue-700 text-white shadow-sm",children:et.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[et.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"WatchTask"}),et.jsx("div",{className:"flex items-center gap-3",children:et.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium cursor-pointer",children:[et.jsx("span",{className:"hidden sm:inline",children:"Cargar PDF"}),et.jsx("input",{type:"file",accept:"application/pdf",onChange:o=>a(o.target.files[0]),className:"block text-sm text-white file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100"})]})})]})}),et.jsxs("main",{className:"flex-1 max-w-5xl w-full mx-auto px-4 py-6 grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[et.jsxs("section",{className:"card md:col-span-1 lg:col-span-1 flex flex-col gap-2",children:[et.jsx("h2",{className:"heading",children:"Resumen"}),et.jsx("p",{className:"muted",children:"Estado general de los datos procesados."}),et.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3 text-center",children:[et.jsxs("div",{className:"p-3 rounded-md bg-blue-50 border border-blue-100",children:[et.jsx("p",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"Órdenes"}),et.jsx("p",{className:"text-lg font-semibold text-blue-700",children:r})]}),et.jsxs("div",{className:"p-3 rounded-md bg-blue-50 border border-blue-100",children:[et.jsx("p",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"En DB"}),et.jsx("p",{className:"text-lg font-semibold text-blue-700",children:e})]})]})]}),et.jsx("section",{className:"card md:col-span-1 lg:col-span-2 flex flex-col gap-6",children:et.jsx(gM,{})})]}),et.jsx("footer",{className:"mt-auto bg-white border-t border-gray-200",children:et.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-3 text-xs text-gray-500 flex items-center justify-between",children:[et.jsxs("span",{children:["© ",new Date().getFullYear()," WatchTask v0.0.4.2"]}),et.jsx("span",{children:"Tailwind UI básico"})]})})]})}qE.createRoot(document.getElementById("root")).render(et.jsx(St.StrictMode,{children:et.jsx(mM,{})}));
