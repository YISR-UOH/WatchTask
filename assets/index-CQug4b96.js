var My=r=>{throw TypeError(r)};var xd=(r,t,e)=>t.has(r)||My("Cannot "+e);var Qt=(r,t,e)=>(xd(r,t,"read from private field"),e?e.call(r):t.get(r)),jn=(r,t,e)=>t.has(r)?My("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),$e=(r,t,e,n)=>(xd(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),Gn=(r,t,e)=>(xd(r,t,"access private method"),e);var Ny=(r,t,e,n)=>({set _(s){$e(r,t,s,e)},get _(){return Qt(r,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();var Rd={exports:{}},ao={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oy;function FE(){if(Oy)return ao;Oy=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,o){var c=null;if(o!==void 0&&(c=""+o),s.key!==void 0&&(c=""+s.key),"key"in s){o={};for(var h in s)h!=="key"&&(o[h]=s[h])}else o=s;return s=o.ref,{$$typeof:r,type:n,key:c,ref:s!==void 0?s:null,props:o}}return ao.Fragment=t,ao.jsx=e,ao.jsxs=e,ao}var ky;function HE(){return ky||(ky=1,Rd.exports=FE()),Rd.exports}var Q=HE(),Dd={exports:{}},St={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ly;function zE(){if(Ly)return St;Ly=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.iterator;function y(T){return T===null||typeof T!="object"?null:(T=_&&T[_]||T["@@iterator"],typeof T=="function"?T:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,S={};function C(T,G,K){this.props=T,this.context=G,this.refs=S,this.updater=K||b}C.prototype.isReactComponent={},C.prototype.setState=function(T,G){if(typeof T!="object"&&typeof T!="function"&&T!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,T,G,"setState")},C.prototype.forceUpdate=function(T){this.updater.enqueueForceUpdate(this,T,"forceUpdate")};function w(){}w.prototype=C.prototype;function N(T,G,K){this.props=T,this.context=G,this.refs=S,this.updater=K||b}var x=N.prototype=new w;x.constructor=N,A(x,C.prototype),x.isPureReactComponent=!0;var M=Array.isArray,D={H:null,A:null,T:null,S:null,V:null},O=Object.prototype.hasOwnProperty;function B(T,G,K,W,rt,bt){return K=bt.ref,{$$typeof:r,type:T,key:G,ref:K!==void 0?K:null,props:bt}}function j(T,G){return B(T.type,G,void 0,void 0,void 0,T.props)}function $(T){return typeof T=="object"&&T!==null&&T.$$typeof===r}function nt(T){var G={"=":"=0",":":"=2"};return"$"+T.replace(/[=:]/g,function(K){return G[K]})}var tt=/\/+/g;function lt(T,G){return typeof T=="object"&&T!==null&&T.key!=null?nt(""+T.key):G.toString(36)}function et(){}function yt(T){switch(T.status){case"fulfilled":return T.value;case"rejected":throw T.reason;default:switch(typeof T.status=="string"?T.then(et,et):(T.status="pending",T.then(function(G){T.status==="pending"&&(T.status="fulfilled",T.value=G)},function(G){T.status==="pending"&&(T.status="rejected",T.reason=G)})),T.status){case"fulfilled":return T.value;case"rejected":throw T.reason}}throw T}function At(T,G,K,W,rt){var bt=typeof T;(bt==="undefined"||bt==="boolean")&&(T=null);var ct=!1;if(T===null)ct=!0;else switch(bt){case"bigint":case"string":case"number":ct=!0;break;case"object":switch(T.$$typeof){case r:case t:ct=!0;break;case g:return ct=T._init,At(ct(T._payload),G,K,W,rt)}}if(ct)return rt=rt(T),ct=W===""?"."+lt(T,0):W,M(rt)?(K="",ct!=null&&(K=ct.replace(tt,"$&/")+"/"),At(rt,G,K,"",function(In){return In})):rt!=null&&($(rt)&&(rt=j(rt,K+(rt.key==null||T&&T.key===rt.key?"":(""+rt.key).replace(tt,"$&/")+"/")+ct)),G.push(rt)),1;ct=0;var Nt=W===""?".":W+":";if(M(T))for(var Bt=0;Bt<T.length;Bt++)W=T[Bt],bt=Nt+lt(W,Bt),ct+=At(W,G,K,bt,rt);else if(Bt=y(T),typeof Bt=="function")for(T=Bt.call(T),Bt=0;!(W=T.next()).done;)W=W.value,bt=Nt+lt(W,Bt++),ct+=At(W,G,K,bt,rt);else if(bt==="object"){if(typeof T.then=="function")return At(yt(T),G,K,W,rt);throw G=String(T),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return ct}function P(T,G,K){if(T==null)return T;var W=[],rt=0;return At(T,W,"","",function(bt){return G.call(K,bt,rt++)}),W}function L(T){if(T._status===-1){var G=T._result;G=G(),G.then(function(K){(T._status===0||T._status===-1)&&(T._status=1,T._result=K)},function(K){(T._status===0||T._status===-1)&&(T._status=2,T._result=K)}),T._status===-1&&(T._status=0,T._result=G)}if(T._status===1)return T._result.default;throw T._result}var q=typeof reportError=="function"?reportError:function(T){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof T=="object"&&T!==null&&typeof T.message=="string"?String(T.message):String(T),error:T});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",T);return}console.error(T)};function J(){}return St.Children={map:P,forEach:function(T,G,K){P(T,function(){G.apply(this,arguments)},K)},count:function(T){var G=0;return P(T,function(){G++}),G},toArray:function(T){return P(T,function(G){return G})||[]},only:function(T){if(!$(T))throw Error("React.Children.only expected to receive a single React element child.");return T}},St.Component=C,St.Fragment=e,St.Profiler=s,St.PureComponent=N,St.StrictMode=n,St.Suspense=d,St.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,St.__COMPILER_RUNTIME={__proto__:null,c:function(T){return D.H.useMemoCache(T)}},St.cache=function(T){return function(){return T.apply(null,arguments)}},St.cloneElement=function(T,G,K){if(T==null)throw Error("The argument must be a React element, but you passed "+T+".");var W=A({},T.props),rt=T.key,bt=void 0;if(G!=null)for(ct in G.ref!==void 0&&(bt=void 0),G.key!==void 0&&(rt=""+G.key),G)!O.call(G,ct)||ct==="key"||ct==="__self"||ct==="__source"||ct==="ref"&&G.ref===void 0||(W[ct]=G[ct]);var ct=arguments.length-2;if(ct===1)W.children=K;else if(1<ct){for(var Nt=Array(ct),Bt=0;Bt<ct;Bt++)Nt[Bt]=arguments[Bt+2];W.children=Nt}return B(T.type,rt,void 0,void 0,bt,W)},St.createContext=function(T){return T={$$typeof:c,_currentValue:T,_currentValue2:T,_threadCount:0,Provider:null,Consumer:null},T.Provider=T,T.Consumer={$$typeof:o,_context:T},T},St.createElement=function(T,G,K){var W,rt={},bt=null;if(G!=null)for(W in G.key!==void 0&&(bt=""+G.key),G)O.call(G,W)&&W!=="key"&&W!=="__self"&&W!=="__source"&&(rt[W]=G[W]);var ct=arguments.length-2;if(ct===1)rt.children=K;else if(1<ct){for(var Nt=Array(ct),Bt=0;Bt<ct;Bt++)Nt[Bt]=arguments[Bt+2];rt.children=Nt}if(T&&T.defaultProps)for(W in ct=T.defaultProps,ct)rt[W]===void 0&&(rt[W]=ct[W]);return B(T,bt,void 0,void 0,null,rt)},St.createRef=function(){return{current:null}},St.forwardRef=function(T){return{$$typeof:h,render:T}},St.isValidElement=$,St.lazy=function(T){return{$$typeof:g,_payload:{_status:-1,_result:T},_init:L}},St.memo=function(T,G){return{$$typeof:f,type:T,compare:G===void 0?null:G}},St.startTransition=function(T){var G=D.T,K={};D.T=K;try{var W=T(),rt=D.S;rt!==null&&rt(K,W),typeof W=="object"&&W!==null&&typeof W.then=="function"&&W.then(J,q)}catch(bt){q(bt)}finally{D.T=G}},St.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},St.use=function(T){return D.H.use(T)},St.useActionState=function(T,G,K){return D.H.useActionState(T,G,K)},St.useCallback=function(T,G){return D.H.useCallback(T,G)},St.useContext=function(T){return D.H.useContext(T)},St.useDebugValue=function(){},St.useDeferredValue=function(T,G){return D.H.useDeferredValue(T,G)},St.useEffect=function(T,G,K){var W=D.H;if(typeof K=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return W.useEffect(T,G)},St.useId=function(){return D.H.useId()},St.useImperativeHandle=function(T,G,K){return D.H.useImperativeHandle(T,G,K)},St.useInsertionEffect=function(T,G){return D.H.useInsertionEffect(T,G)},St.useLayoutEffect=function(T,G){return D.H.useLayoutEffect(T,G)},St.useMemo=function(T,G){return D.H.useMemo(T,G)},St.useOptimistic=function(T,G){return D.H.useOptimistic(T,G)},St.useReducer=function(T,G,K){return D.H.useReducer(T,G,K)},St.useRef=function(T){return D.H.useRef(T)},St.useState=function(T){return D.H.useState(T)},St.useSyncExternalStore=function(T,G,K){return D.H.useSyncExternalStore(T,G,K)},St.useTransition=function(){return D.H.useTransition()},St.version="19.1.1",St}var Iy;function Ff(){return Iy||(Iy=1,Dd.exports=zE()),Dd.exports}var gt=Ff(),Md={exports:{}},ro={},Nd={exports:{}},Od={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Py;function UE(){return Py||(Py=1,(function(r){function t(P,L){var q=P.length;P.push(L);t:for(;0<q;){var J=q-1>>>1,T=P[J];if(0<s(T,L))P[J]=L,P[q]=T,q=J;else break t}}function e(P){return P.length===0?null:P[0]}function n(P){if(P.length===0)return null;var L=P[0],q=P.pop();if(q!==L){P[0]=q;t:for(var J=0,T=P.length,G=T>>>1;J<G;){var K=2*(J+1)-1,W=P[K],rt=K+1,bt=P[rt];if(0>s(W,q))rt<T&&0>s(bt,W)?(P[J]=bt,P[rt]=q,J=rt):(P[J]=W,P[K]=q,J=K);else if(rt<T&&0>s(bt,q))P[J]=bt,P[rt]=q,J=rt;else break t}}return L}function s(P,L){var q=P.sortIndex-L.sortIndex;return q!==0?q:P.id-L.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var c=Date,h=c.now();r.unstable_now=function(){return c.now()-h}}var d=[],f=[],g=1,_=null,y=3,b=!1,A=!1,S=!1,C=!1,w=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function M(P){for(var L=e(f);L!==null;){if(L.callback===null)n(f);else if(L.startTime<=P)n(f),L.sortIndex=L.expirationTime,t(d,L);else break;L=e(f)}}function D(P){if(S=!1,M(P),!A)if(e(d)!==null)A=!0,O||(O=!0,lt());else{var L=e(f);L!==null&&At(D,L.startTime-P)}}var O=!1,B=-1,j=5,$=-1;function nt(){return C?!0:!(r.unstable_now()-$<j)}function tt(){if(C=!1,O){var P=r.unstable_now();$=P;var L=!0;try{t:{A=!1,S&&(S=!1,N(B),B=-1),b=!0;var q=y;try{e:{for(M(P),_=e(d);_!==null&&!(_.expirationTime>P&&nt());){var J=_.callback;if(typeof J=="function"){_.callback=null,y=_.priorityLevel;var T=J(_.expirationTime<=P);if(P=r.unstable_now(),typeof T=="function"){_.callback=T,M(P),L=!0;break e}_===e(d)&&n(d),M(P)}else n(d);_=e(d)}if(_!==null)L=!0;else{var G=e(f);G!==null&&At(D,G.startTime-P),L=!1}}break t}finally{_=null,y=q,b=!1}L=void 0}}finally{L?lt():O=!1}}}var lt;if(typeof x=="function")lt=function(){x(tt)};else if(typeof MessageChannel<"u"){var et=new MessageChannel,yt=et.port2;et.port1.onmessage=tt,lt=function(){yt.postMessage(null)}}else lt=function(){w(tt,0)};function At(P,L){B=w(function(){P(r.unstable_now())},L)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(P){P.callback=null},r.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<P?Math.floor(1e3/P):5},r.unstable_getCurrentPriorityLevel=function(){return y},r.unstable_next=function(P){switch(y){case 1:case 2:case 3:var L=3;break;default:L=y}var q=y;y=L;try{return P()}finally{y=q}},r.unstable_requestPaint=function(){C=!0},r.unstable_runWithPriority=function(P,L){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var q=y;y=P;try{return L()}finally{y=q}},r.unstable_scheduleCallback=function(P,L,q){var J=r.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?J+q:J):q=J,P){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=q+T,P={id:g++,callback:L,priorityLevel:P,startTime:q,expirationTime:T,sortIndex:-1},q>J?(P.sortIndex=q,t(f,P),e(d)===null&&P===e(f)&&(S?(N(B),B=-1):S=!0,At(D,q-J))):(P.sortIndex=T,t(d,P),A||b||(A=!0,O||(O=!0,lt()))),P},r.unstable_shouldYield=nt,r.unstable_wrapCallback=function(P){var L=y;return function(){var q=y;y=L;try{return P.apply(this,arguments)}finally{y=q}}}})(Od)),Od}var By;function jE(){return By||(By=1,Nd.exports=UE()),Nd.exports}var kd={exports:{}},Pe={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fy;function GE(){if(Fy)return Pe;Fy=1;var r=Ff();function t(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(d,f,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:d,containerInfo:f,implementation:g}}var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Pe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Pe.createPortal=function(d,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return o(d,f,null,g)},Pe.flushSync=function(d){var f=c.T,g=n.p;try{if(c.T=null,n.p=2,d)return d()}finally{c.T=f,n.p=g,n.d.f()}},Pe.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(d,f))},Pe.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},Pe.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var g=f.as,_=h(g,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,b=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?n.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:b}):g==="script"&&n.d.X(d,{crossOrigin:_,integrity:y,fetchPriority:b,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Pe.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=h(f.as,f.crossOrigin);n.d.M(d,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(d)},Pe.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,_=h(g,f.crossOrigin);n.d.L(d,g,{crossOrigin:_,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Pe.preloadModule=function(d,f){if(typeof d=="string")if(f){var g=h(f.as,f.crossOrigin);n.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(d)},Pe.requestFormReset=function(d){n.d.r(d)},Pe.unstable_batchedUpdates=function(d,f){return d(f)},Pe.useFormState=function(d,f,g){return c.H.useFormState(d,f,g)},Pe.useFormStatus=function(){return c.H.useHostTransitionStatus()},Pe.version="19.1.1",Pe}var Hy;function VE(){if(Hy)return kd.exports;Hy=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),kd.exports=GE(),kd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zy;function qE(){if(zy)return ro;zy=1;var r=jE(),t=Ff(),e=VE();function n(i){var a="https://react.dev/errors/"+i;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var a=i,l=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(l=a.return),i=a.return;while(i)}return a.tag===3?l:null}function c(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function h(i){if(o(i)!==i)throw Error(n(188))}function d(i){var a=i.alternate;if(!a){if(a=o(i),a===null)throw Error(n(188));return a!==i?null:i}for(var l=i,u=a;;){var p=l.return;if(p===null)break;var m=p.alternate;if(m===null){if(u=p.return,u!==null){l=u;continue}break}if(p.child===m.child){for(m=p.child;m;){if(m===l)return h(p),i;if(m===u)return h(p),a;m=m.sibling}throw Error(n(188))}if(l.return!==u.return)l=p,u=m;else{for(var v=!1,E=p.child;E;){if(E===l){v=!0,l=p,u=m;break}if(E===u){v=!0,u=p,l=m;break}E=E.sibling}if(!v){for(E=m.child;E;){if(E===l){v=!0,l=m,u=p;break}if(E===u){v=!0,u=m,l=p;break}E=E.sibling}if(!v)throw Error(n(189))}}if(l.alternate!==u)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?i:a}function f(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i;for(i=i.child;i!==null;){if(a=f(i),a!==null)return a;i=i.sibling}return null}var g=Object.assign,_=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),N=Symbol.for("react.consumer"),x=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),nt=Symbol.for("react.memo_cache_sentinel"),tt=Symbol.iterator;function lt(i){return i===null||typeof i!="object"?null:(i=tt&&i[tt]||i["@@iterator"],typeof i=="function"?i:null)}var et=Symbol.for("react.client.reference");function yt(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===et?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case A:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case D:return"Suspense";case O:return"SuspenseList";case $:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case b:return"Portal";case x:return(i.displayName||"Context")+".Provider";case N:return(i._context.displayName||"Context")+".Consumer";case M:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case B:return a=i.displayName||null,a!==null?a:yt(i.type)||"Memo";case j:a=i._payload,i=i._init;try{return yt(i(a))}catch{}}return null}var At=Array.isArray,P=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q={pending:!1,data:null,method:null,action:null},J=[],T=-1;function G(i){return{current:i}}function K(i){0>T||(i.current=J[T],J[T]=null,T--)}function W(i,a){T++,J[T]=i.current,i.current=a}var rt=G(null),bt=G(null),ct=G(null),Nt=G(null);function Bt(i,a){switch(W(ct,a),W(bt,i),W(rt,null),a.nodeType){case 9:case 11:i=(i=a.documentElement)&&(i=i.namespaceURI)?sy(i):0;break;default:if(i=a.tagName,a=a.namespaceURI)a=sy(a),i=ay(a,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}K(rt),W(rt,i)}function In(){K(rt),K(bt),K(ct)}function rr(i){i.memoizedState!==null&&W(Nt,i);var a=rt.current,l=ay(a,i.type);a!==l&&(W(bt,i),W(rt,l))}function Ai(i){bt.current===i&&(K(rt),K(bt)),Nt.current===i&&(K(Nt),to._currentValue=q)}var is=Object.prototype.hasOwnProperty,Gs=r.unstable_scheduleCallback,or=r.unstable_cancelCallback,mA=r.unstable_shouldYield,_A=r.unstable_requestPaint,Pn=r.unstable_now,yA=r.unstable_getCurrentPriorityLevel,Fp=r.unstable_ImmediatePriority,Hp=r.unstable_UserBlockingPriority,Jo=r.unstable_NormalPriority,bA=r.unstable_LowPriority,zp=r.unstable_IdlePriority,vA=r.log,AA=r.unstable_setDisableYieldValue,lr=null,tn=null;function Si(i){if(typeof vA=="function"&&AA(i),tn&&typeof tn.setStrictMode=="function")try{tn.setStrictMode(lr,i)}catch{}}var en=Math.clz32?Math.clz32:wA,SA=Math.log,EA=Math.LN2;function wA(i){return i>>>=0,i===0?32:31-(SA(i)/EA|0)|0}var tl=256,el=4194304;function ss(i){var a=i&42;if(a!==0)return a;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function nl(i,a,l){var u=i.pendingLanes;if(u===0)return 0;var p=0,m=i.suspendedLanes,v=i.pingedLanes;i=i.warmLanes;var E=u&134217727;return E!==0?(u=E&~m,u!==0?p=ss(u):(v&=E,v!==0?p=ss(v):l||(l=E&~i,l!==0&&(p=ss(l))))):(E=u&~m,E!==0?p=ss(E):v!==0?p=ss(v):l||(l=u&~i,l!==0&&(p=ss(l)))),p===0?0:a!==0&&a!==p&&(a&m)===0&&(m=p&-p,l=a&-a,m>=l||m===32&&(l&4194048)!==0)?a:p}function cr(i,a){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&a)===0}function CA(i,a){switch(i){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Up(){var i=tl;return tl<<=1,(tl&4194048)===0&&(tl=256),i}function jp(){var i=el;return el<<=1,(el&62914560)===0&&(el=4194304),i}function mu(i){for(var a=[],l=0;31>l;l++)a.push(i);return a}function ur(i,a){i.pendingLanes|=a,a!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function TA(i,a,l,u,p,m){var v=i.pendingLanes;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=l,i.entangledLanes&=l,i.errorRecoveryDisabledLanes&=l,i.shellSuspendCounter=0;var E=i.entanglements,R=i.expirationTimes,H=i.hiddenUpdates;for(l=v&~l;0<l;){var V=31-en(l),X=1<<V;E[V]=0,R[V]=-1;var z=H[V];if(z!==null)for(H[V]=null,V=0;V<z.length;V++){var U=z[V];U!==null&&(U.lane&=-536870913)}l&=~X}u!==0&&Gp(i,u,0),m!==0&&p===0&&i.tag!==0&&(i.suspendedLanes|=m&~(v&~a))}function Gp(i,a,l){i.pendingLanes|=a,i.suspendedLanes&=~a;var u=31-en(a);i.entangledLanes|=a,i.entanglements[u]=i.entanglements[u]|1073741824|l&4194090}function Vp(i,a){var l=i.entangledLanes|=a;for(i=i.entanglements;l;){var u=31-en(l),p=1<<u;p&a|i[u]&a&&(i[u]|=a),l&=~p}}function _u(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function yu(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function qp(){var i=L.p;return i!==0?i:(i=window.event,i===void 0?32:wy(i.type))}function xA(i,a){var l=L.p;try{return L.p=i,a()}finally{L.p=l}}var Ei=Math.random().toString(36).slice(2),Le="__reactFiber$"+Ei,Ge="__reactProps$"+Ei,Vs="__reactContainer$"+Ei,bu="__reactEvents$"+Ei,RA="__reactListeners$"+Ei,DA="__reactHandles$"+Ei,Yp="__reactResources$"+Ei,hr="__reactMarker$"+Ei;function vu(i){delete i[Le],delete i[Ge],delete i[bu],delete i[RA],delete i[DA]}function qs(i){var a=i[Le];if(a)return a;for(var l=i.parentNode;l;){if(a=l[Vs]||l[Le]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(i=cy(i);i!==null;){if(l=i[Le])return l;i=cy(i)}return a}i=l,l=i.parentNode}return null}function Ys(i){if(i=i[Le]||i[Vs]){var a=i.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return i}return null}function dr(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i.stateNode;throw Error(n(33))}function Xs(i){var a=i[Yp];return a||(a=i[Yp]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function ye(i){i[hr]=!0}var Xp=new Set,$p={};function as(i,a){$s(i,a),$s(i+"Capture",a)}function $s(i,a){for($p[i]=a,i=0;i<a.length;i++)Xp.add(a[i])}var MA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wp={},Kp={};function NA(i){return is.call(Kp,i)?!0:is.call(Wp,i)?!1:MA.test(i)?Kp[i]=!0:(Wp[i]=!0,!1)}function il(i,a,l){if(NA(a))if(l===null)i.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":i.removeAttribute(a);return;case"boolean":var u=a.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){i.removeAttribute(a);return}}i.setAttribute(a,""+l)}}function sl(i,a,l){if(l===null)i.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttribute(a,""+l)}}function Qn(i,a,l,u){if(u===null)i.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(l);return}i.setAttributeNS(a,l,""+u)}}var Au,Qp;function Ws(i){if(Au===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);Au=a&&a[1]||"",Qp=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Au+i+Qp}var Su=!1;function Eu(i,a){if(!i||Su)return"";Su=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(a){var X=function(){throw Error()};if(Object.defineProperty(X.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(X,[])}catch(U){var z=U}Reflect.construct(i,[],X)}else{try{X.call()}catch(U){z=U}i.call(X.prototype)}}else{try{throw Error()}catch(U){z=U}(X=i())&&typeof X.catch=="function"&&X.catch(function(){})}}catch(U){if(U&&z&&typeof U.stack=="string")return[U.stack,z.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=u.DetermineComponentFrameRoot(),v=m[0],E=m[1];if(v&&E){var R=v.split(`
`),H=E.split(`
`);for(p=u=0;u<R.length&&!R[u].includes("DetermineComponentFrameRoot");)u++;for(;p<H.length&&!H[p].includes("DetermineComponentFrameRoot");)p++;if(u===R.length||p===H.length)for(u=R.length-1,p=H.length-1;1<=u&&0<=p&&R[u]!==H[p];)p--;for(;1<=u&&0<=p;u--,p--)if(R[u]!==H[p]){if(u!==1||p!==1)do if(u--,p--,0>p||R[u]!==H[p]){var V=`
`+R[u].replace(" at new "," at ");return i.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",i.displayName)),V}while(1<=u&&0<=p);break}}}finally{Su=!1,Error.prepareStackTrace=l}return(l=i?i.displayName||i.name:"")?Ws(l):""}function OA(i){switch(i.tag){case 26:case 27:case 5:return Ws(i.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 15:return Eu(i.type,!1);case 11:return Eu(i.type.render,!1);case 1:return Eu(i.type,!0);case 31:return Ws("Activity");default:return""}}function Zp(i){try{var a="";do a+=OA(i),i=i.return;while(i);return a}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function dn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Jp(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function kA(i){var a=Jp(i)?"checked":"value",l=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),u=""+i[a];if(!i.hasOwnProperty(a)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var p=l.get,m=l.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return p.call(this)},set:function(v){u=""+v,m.call(this,v)}}),Object.defineProperty(i,a,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(v){u=""+v},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function al(i){i._valueTracker||(i._valueTracker=kA(i))}function tg(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var l=a.getValue(),u="";return i&&(u=Jp(i)?i.checked?"true":"false":i.value),i=u,i!==l?(a.setValue(i),!0):!1}function rl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var LA=/[\n"\\]/g;function fn(i){return i.replace(LA,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function wu(i,a,l,u,p,m,v,E){i.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?i.type=v:i.removeAttribute("type"),a!=null?v==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+dn(a)):i.value!==""+dn(a)&&(i.value=""+dn(a)):v!=="submit"&&v!=="reset"||i.removeAttribute("value"),a!=null?Cu(i,v,dn(a)):l!=null?Cu(i,v,dn(l)):u!=null&&i.removeAttribute("value"),p==null&&m!=null&&(i.defaultChecked=!!m),p!=null&&(i.checked=p&&typeof p!="function"&&typeof p!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?i.name=""+dn(E):i.removeAttribute("name")}function eg(i,a,l,u,p,m,v,E){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(i.type=m),a!=null||l!=null){if(!(m!=="submit"&&m!=="reset"||a!=null))return;l=l!=null?""+dn(l):"",a=a!=null?""+dn(a):l,E||a===i.value||(i.value=a),i.defaultValue=a}u=u??p,u=typeof u!="function"&&typeof u!="symbol"&&!!u,i.checked=E?i.checked:!!u,i.defaultChecked=!!u,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(i.name=v)}function Cu(i,a,l){a==="number"&&rl(i.ownerDocument)===i||i.defaultValue===""+l||(i.defaultValue=""+l)}function Ks(i,a,l,u){if(i=i.options,a){a={};for(var p=0;p<l.length;p++)a["$"+l[p]]=!0;for(l=0;l<i.length;l++)p=a.hasOwnProperty("$"+i[l].value),i[l].selected!==p&&(i[l].selected=p),p&&u&&(i[l].defaultSelected=!0)}else{for(l=""+dn(l),a=null,p=0;p<i.length;p++){if(i[p].value===l){i[p].selected=!0,u&&(i[p].defaultSelected=!0);return}a!==null||i[p].disabled||(a=i[p])}a!==null&&(a.selected=!0)}}function ng(i,a,l){if(a!=null&&(a=""+dn(a),a!==i.value&&(i.value=a),l==null)){i.defaultValue!==a&&(i.defaultValue=a);return}i.defaultValue=l!=null?""+dn(l):""}function ig(i,a,l,u){if(a==null){if(u!=null){if(l!=null)throw Error(n(92));if(At(u)){if(1<u.length)throw Error(n(93));u=u[0]}l=u}l==null&&(l=""),a=l}l=dn(a),i.defaultValue=l,u=i.textContent,u===l&&u!==""&&u!==null&&(i.value=u)}function Qs(i,a){if(a){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=a;return}}i.textContent=a}var IA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function sg(i,a,l){var u=a.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?i.setProperty(a,""):a==="float"?i.cssFloat="":i[a]="":u?i.setProperty(a,l):typeof l!="number"||l===0||IA.has(a)?a==="float"?i.cssFloat=l:i[a]=(""+l).trim():i[a]=l+"px"}function ag(i,a,l){if(a!=null&&typeof a!="object")throw Error(n(62));if(i=i.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||a!=null&&a.hasOwnProperty(u)||(u.indexOf("--")===0?i.setProperty(u,""):u==="float"?i.cssFloat="":i[u]="");for(var p in a)u=a[p],a.hasOwnProperty(p)&&l[p]!==u&&sg(i,p,u)}else for(var m in a)a.hasOwnProperty(m)&&sg(i,m,a[m])}function Tu(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var PA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),BA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ol(i){return BA.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var xu=null;function Ru(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Zs=null,Js=null;function rg(i){var a=Ys(i);if(a&&(i=a.stateNode)){var l=i[Ge]||null;t:switch(i=a.stateNode,a.type){case"input":if(wu(i,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),a=l.name,l.type==="radio"&&a!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+fn(""+a)+'"][type="radio"]'),a=0;a<l.length;a++){var u=l[a];if(u!==i&&u.form===i.form){var p=u[Ge]||null;if(!p)throw Error(n(90));wu(u,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(a=0;a<l.length;a++)u=l[a],u.form===i.form&&tg(u)}break t;case"textarea":ng(i,l.value,l.defaultValue);break t;case"select":a=l.value,a!=null&&Ks(i,!!l.multiple,a,!1)}}}var Du=!1;function og(i,a,l){if(Du)return i(a,l);Du=!0;try{var u=i(a);return u}finally{if(Du=!1,(Zs!==null||Js!==null)&&(Yl(),Zs&&(a=Zs,i=Js,Js=Zs=null,rg(a),i)))for(a=0;a<i.length;a++)rg(i[a])}}function fr(i,a){var l=i.stateNode;if(l===null)return null;var u=l[Ge]||null;if(u===null)return null;l=u[a];t:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(i=i.type,u=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!u;break t;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(n(231,a,typeof l));return l}var Zn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mu=!1;if(Zn)try{var pr={};Object.defineProperty(pr,"passive",{get:function(){Mu=!0}}),window.addEventListener("test",pr,pr),window.removeEventListener("test",pr,pr)}catch{Mu=!1}var wi=null,Nu=null,ll=null;function lg(){if(ll)return ll;var i,a=Nu,l=a.length,u,p="value"in wi?wi.value:wi.textContent,m=p.length;for(i=0;i<l&&a[i]===p[i];i++);var v=l-i;for(u=1;u<=v&&a[l-u]===p[m-u];u++);return ll=p.slice(i,1<u?1-u:void 0)}function cl(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function ul(){return!0}function cg(){return!1}function Ve(i){function a(l,u,p,m,v){this._reactName=l,this._targetInst=p,this.type=u,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var E in i)i.hasOwnProperty(E)&&(l=i[E],this[E]=l?l(m):m[E]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?ul:cg,this.isPropagationStopped=cg,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=ul)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=ul)},persist:function(){},isPersistent:ul}),a}var rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hl=Ve(rs),gr=g({},rs,{view:0,detail:0}),FA=Ve(gr),Ou,ku,mr,dl=g({},gr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Iu,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==mr&&(mr&&i.type==="mousemove"?(Ou=i.screenX-mr.screenX,ku=i.screenY-mr.screenY):ku=Ou=0,mr=i),Ou)},movementY:function(i){return"movementY"in i?i.movementY:ku}}),ug=Ve(dl),HA=g({},dl,{dataTransfer:0}),zA=Ve(HA),UA=g({},gr,{relatedTarget:0}),Lu=Ve(UA),jA=g({},rs,{animationName:0,elapsedTime:0,pseudoElement:0}),GA=Ve(jA),VA=g({},rs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),qA=Ve(VA),YA=g({},rs,{data:0}),hg=Ve(YA),XA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$A={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},WA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function KA(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=WA[i])?!!a[i]:!1}function Iu(){return KA}var QA=g({},gr,{key:function(i){if(i.key){var a=XA[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=cl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?$A[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Iu,charCode:function(i){return i.type==="keypress"?cl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?cl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),ZA=Ve(QA),JA=g({},dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dg=Ve(JA),tS=g({},gr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Iu}),eS=Ve(tS),nS=g({},rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),iS=Ve(nS),sS=g({},dl,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),aS=Ve(sS),rS=g({},rs,{newState:0,oldState:0}),oS=Ve(rS),lS=[9,13,27,32],Pu=Zn&&"CompositionEvent"in window,_r=null;Zn&&"documentMode"in document&&(_r=document.documentMode);var cS=Zn&&"TextEvent"in window&&!_r,fg=Zn&&(!Pu||_r&&8<_r&&11>=_r),pg=" ",gg=!1;function mg(i,a){switch(i){case"keyup":return lS.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _g(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ta=!1;function uS(i,a){switch(i){case"compositionend":return _g(a);case"keypress":return a.which!==32?null:(gg=!0,pg);case"textInput":return i=a.data,i===pg&&gg?null:i;default:return null}}function hS(i,a){if(ta)return i==="compositionend"||!Pu&&mg(i,a)?(i=lg(),ll=Nu=wi=null,ta=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return fg&&a.locale!=="ko"?null:a.data;default:return null}}var dS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yg(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!dS[i.type]:a==="textarea"}function bg(i,a,l,u){Zs?Js?Js.push(u):Js=[u]:Zs=u,a=Zl(a,"onChange"),0<a.length&&(l=new hl("onChange","change",null,l,u),i.push({event:l,listeners:a}))}var yr=null,br=null;function fS(i){J_(i,0)}function fl(i){var a=dr(i);if(tg(a))return i}function vg(i,a){if(i==="change")return a}var Ag=!1;if(Zn){var Bu;if(Zn){var Fu="oninput"in document;if(!Fu){var Sg=document.createElement("div");Sg.setAttribute("oninput","return;"),Fu=typeof Sg.oninput=="function"}Bu=Fu}else Bu=!1;Ag=Bu&&(!document.documentMode||9<document.documentMode)}function Eg(){yr&&(yr.detachEvent("onpropertychange",wg),br=yr=null)}function wg(i){if(i.propertyName==="value"&&fl(br)){var a=[];bg(a,br,i,Ru(i)),og(fS,a)}}function pS(i,a,l){i==="focusin"?(Eg(),yr=a,br=l,yr.attachEvent("onpropertychange",wg)):i==="focusout"&&Eg()}function gS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return fl(br)}function mS(i,a){if(i==="click")return fl(a)}function _S(i,a){if(i==="input"||i==="change")return fl(a)}function yS(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var nn=typeof Object.is=="function"?Object.is:yS;function vr(i,a){if(nn(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var l=Object.keys(i),u=Object.keys(a);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var p=l[u];if(!is.call(a,p)||!nn(i[p],a[p]))return!1}return!0}function Cg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Tg(i,a){var l=Cg(i);i=0;for(var u;l;){if(l.nodeType===3){if(u=i+l.textContent.length,i<=a&&u>=a)return{node:l,offset:a-i};i=u}t:{for(;l;){if(l.nextSibling){l=l.nextSibling;break t}l=l.parentNode}l=void 0}l=Cg(l)}}function xg(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?xg(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function Rg(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var a=rl(i.document);a instanceof i.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)i=a.contentWindow;else break;a=rl(i.document)}return a}function Hu(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}var bS=Zn&&"documentMode"in document&&11>=document.documentMode,ea=null,zu=null,Ar=null,Uu=!1;function Dg(i,a,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Uu||ea==null||ea!==rl(u)||(u=ea,"selectionStart"in u&&Hu(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Ar&&vr(Ar,u)||(Ar=u,u=Zl(zu,"onSelect"),0<u.length&&(a=new hl("onSelect","select",null,a,l),i.push({event:a,listeners:u}),a.target=ea)))}function os(i,a){var l={};return l[i.toLowerCase()]=a.toLowerCase(),l["Webkit"+i]="webkit"+a,l["Moz"+i]="moz"+a,l}var na={animationend:os("Animation","AnimationEnd"),animationiteration:os("Animation","AnimationIteration"),animationstart:os("Animation","AnimationStart"),transitionrun:os("Transition","TransitionRun"),transitionstart:os("Transition","TransitionStart"),transitioncancel:os("Transition","TransitionCancel"),transitionend:os("Transition","TransitionEnd")},ju={},Mg={};Zn&&(Mg=document.createElement("div").style,"AnimationEvent"in window||(delete na.animationend.animation,delete na.animationiteration.animation,delete na.animationstart.animation),"TransitionEvent"in window||delete na.transitionend.transition);function ls(i){if(ju[i])return ju[i];if(!na[i])return i;var a=na[i],l;for(l in a)if(a.hasOwnProperty(l)&&l in Mg)return ju[i]=a[l];return i}var Ng=ls("animationend"),Og=ls("animationiteration"),kg=ls("animationstart"),vS=ls("transitionrun"),AS=ls("transitionstart"),SS=ls("transitioncancel"),Lg=ls("transitionend"),Ig=new Map,Gu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Gu.push("scrollEnd");function Rn(i,a){Ig.set(i,a),as(a,[i])}var Pg=new WeakMap;function pn(i,a){if(typeof i=="object"&&i!==null){var l=Pg.get(i);return l!==void 0?l:(a={value:i,source:a,stack:Zp(a)},Pg.set(i,a),a)}return{value:i,source:a,stack:Zp(a)}}var gn=[],ia=0,Vu=0;function pl(){for(var i=ia,a=Vu=ia=0;a<i;){var l=gn[a];gn[a++]=null;var u=gn[a];gn[a++]=null;var p=gn[a];gn[a++]=null;var m=gn[a];if(gn[a++]=null,u!==null&&p!==null){var v=u.pending;v===null?p.next=p:(p.next=v.next,v.next=p),u.pending=p}m!==0&&Bg(l,p,m)}}function gl(i,a,l,u){gn[ia++]=i,gn[ia++]=a,gn[ia++]=l,gn[ia++]=u,Vu|=u,i.lanes|=u,i=i.alternate,i!==null&&(i.lanes|=u)}function qu(i,a,l,u){return gl(i,a,l,u),ml(i)}function sa(i,a){return gl(i,null,null,a),ml(i)}function Bg(i,a,l){i.lanes|=l;var u=i.alternate;u!==null&&(u.lanes|=l);for(var p=!1,m=i.return;m!==null;)m.childLanes|=l,u=m.alternate,u!==null&&(u.childLanes|=l),m.tag===22&&(i=m.stateNode,i===null||i._visibility&1||(p=!0)),i=m,m=m.return;return i.tag===3?(m=i.stateNode,p&&a!==null&&(p=31-en(l),i=m.hiddenUpdates,u=i[p],u===null?i[p]=[a]:u.push(a),a.lane=l|536870912),m):null}function ml(i){if(50<Yr)throw Yr=0,Qh=null,Error(n(185));for(var a=i.return;a!==null;)i=a,a=i.return;return i.tag===3?i.stateNode:null}var aa={};function ES(i,a,l,u){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sn(i,a,l,u){return new ES(i,a,l,u)}function Yu(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Jn(i,a){var l=i.alternate;return l===null?(l=sn(i.tag,a,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=a,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&65011712,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,a=i.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l.refCleanup=i.refCleanup,l}function Fg(i,a){i.flags&=65011714;var l=i.alternate;return l===null?(i.childLanes=0,i.lanes=a,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,a=l.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),i}function _l(i,a,l,u,p,m){var v=0;if(u=i,typeof i=="function")Yu(i)&&(v=1);else if(typeof i=="string")v=CE(i,l,rt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case $:return i=sn(31,l,a,p),i.elementType=$,i.lanes=m,i;case A:return cs(l.children,p,m,a);case S:v=8,p|=24;break;case C:return i=sn(12,l,a,p|2),i.elementType=C,i.lanes=m,i;case D:return i=sn(13,l,a,p),i.elementType=D,i.lanes=m,i;case O:return i=sn(19,l,a,p),i.elementType=O,i.lanes=m,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case w:case x:v=10;break t;case N:v=9;break t;case M:v=11;break t;case B:v=14;break t;case j:v=16,u=null;break t}v=29,l=Error(n(130,i===null?"null":typeof i,"")),u=null}return a=sn(v,l,a,p),a.elementType=i,a.type=u,a.lanes=m,a}function cs(i,a,l,u){return i=sn(7,i,u,a),i.lanes=l,i}function Xu(i,a,l){return i=sn(6,i,null,a),i.lanes=l,i}function $u(i,a,l){return a=sn(4,i.children!==null?i.children:[],i.key,a),a.lanes=l,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}var ra=[],oa=0,yl=null,bl=0,mn=[],_n=0,us=null,ti=1,ei="";function hs(i,a){ra[oa++]=bl,ra[oa++]=yl,yl=i,bl=a}function Hg(i,a,l){mn[_n++]=ti,mn[_n++]=ei,mn[_n++]=us,us=i;var u=ti;i=ei;var p=32-en(u)-1;u&=~(1<<p),l+=1;var m=32-en(a)+p;if(30<m){var v=p-p%5;m=(u&(1<<v)-1).toString(32),u>>=v,p-=v,ti=1<<32-en(a)+p|l<<p|u,ei=m+i}else ti=1<<m|l<<p|u,ei=i}function Wu(i){i.return!==null&&(hs(i,1),Hg(i,1,0))}function Ku(i){for(;i===yl;)yl=ra[--oa],ra[oa]=null,bl=ra[--oa],ra[oa]=null;for(;i===us;)us=mn[--_n],mn[_n]=null,ei=mn[--_n],mn[_n]=null,ti=mn[--_n],mn[_n]=null}var Fe=null,ne=null,It=!1,ds=null,Bn=!1,Qu=Error(n(519));function fs(i){var a=Error(n(418,""));throw wr(pn(a,i)),Qu}function zg(i){var a=i.stateNode,l=i.type,u=i.memoizedProps;switch(a[Le]=i,a[Ge]=u,l){case"dialog":Mt("cancel",a),Mt("close",a);break;case"iframe":case"object":case"embed":Mt("load",a);break;case"video":case"audio":for(l=0;l<$r.length;l++)Mt($r[l],a);break;case"source":Mt("error",a);break;case"img":case"image":case"link":Mt("error",a),Mt("load",a);break;case"details":Mt("toggle",a);break;case"input":Mt("invalid",a),eg(a,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0),al(a);break;case"select":Mt("invalid",a);break;case"textarea":Mt("invalid",a),ig(a,u.value,u.defaultValue,u.children),al(a)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||a.textContent===""+l||u.suppressHydrationWarning===!0||iy(a.textContent,l)?(u.popover!=null&&(Mt("beforetoggle",a),Mt("toggle",a)),u.onScroll!=null&&Mt("scroll",a),u.onScrollEnd!=null&&Mt("scrollend",a),u.onClick!=null&&(a.onclick=Jl),a=!0):a=!1,a||fs(i)}function Ug(i){for(Fe=i.return;Fe;)switch(Fe.tag){case 5:case 13:Bn=!1;return;case 27:case 3:Bn=!0;return;default:Fe=Fe.return}}function Sr(i){if(i!==Fe)return!1;if(!It)return Ug(i),It=!0,!1;var a=i.tag,l;if((l=a!==3&&a!==27)&&((l=a===5)&&(l=i.type,l=!(l!=="form"&&l!=="button")||fd(i.type,i.memoizedProps)),l=!l),l&&ne&&fs(i),Ug(i),a===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));t:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8)if(l=i.data,l==="/$"){if(a===0){ne=Mn(i.nextSibling);break t}a--}else l!=="$"&&l!=="$!"&&l!=="$?"||a++;i=i.nextSibling}ne=null}}else a===27?(a=ne,zi(i.type)?(i=_d,_d=null,ne=i):ne=a):ne=Fe?Mn(i.stateNode.nextSibling):null;return!0}function Er(){ne=Fe=null,It=!1}function jg(){var i=ds;return i!==null&&(Xe===null?Xe=i:Xe.push.apply(Xe,i),ds=null),i}function wr(i){ds===null?ds=[i]:ds.push(i)}var Zu=G(null),ps=null,ni=null;function Ci(i,a,l){W(Zu,a._currentValue),a._currentValue=l}function ii(i){i._currentValue=Zu.current,K(Zu)}function Ju(i,a,l){for(;i!==null;){var u=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,u!==null&&(u.childLanes|=a)):u!==null&&(u.childLanes&a)!==a&&(u.childLanes|=a),i===l)break;i=i.return}}function th(i,a,l,u){var p=i.child;for(p!==null&&(p.return=i);p!==null;){var m=p.dependencies;if(m!==null){var v=p.child;m=m.firstContext;t:for(;m!==null;){var E=m;m=p;for(var R=0;R<a.length;R++)if(E.context===a[R]){m.lanes|=l,E=m.alternate,E!==null&&(E.lanes|=l),Ju(m.return,l,i),u||(v=null);break t}m=E.next}}else if(p.tag===18){if(v=p.return,v===null)throw Error(n(341));v.lanes|=l,m=v.alternate,m!==null&&(m.lanes|=l),Ju(v,l,i),v=null}else v=p.child;if(v!==null)v.return=p;else for(v=p;v!==null;){if(v===i){v=null;break}if(p=v.sibling,p!==null){p.return=v.return,v=p;break}v=v.return}p=v}}function Cr(i,a,l,u){i=null;for(var p=a,m=!1;p!==null;){if(!m){if((p.flags&524288)!==0)m=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var v=p.alternate;if(v===null)throw Error(n(387));if(v=v.memoizedProps,v!==null){var E=p.type;nn(p.pendingProps.value,v.value)||(i!==null?i.push(E):i=[E])}}else if(p===Nt.current){if(v=p.alternate,v===null)throw Error(n(387));v.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(i!==null?i.push(to):i=[to])}p=p.return}i!==null&&th(a,i,l,u),a.flags|=262144}function vl(i){for(i=i.firstContext;i!==null;){if(!nn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function gs(i){ps=i,ni=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Ie(i){return Gg(ps,i)}function Al(i,a){return ps===null&&gs(i),Gg(i,a)}function Gg(i,a){var l=a._currentValue;if(a={context:a,memoizedValue:l,next:null},ni===null){if(i===null)throw Error(n(308));ni=a,i.dependencies={lanes:0,firstContext:a},i.flags|=524288}else ni=ni.next=a;return l}var wS=typeof AbortController<"u"?AbortController:function(){var i=[],a=this.signal={aborted:!1,addEventListener:function(l,u){i.push(u)}};this.abort=function(){a.aborted=!0,i.forEach(function(l){return l()})}},CS=r.unstable_scheduleCallback,TS=r.unstable_NormalPriority,me={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function eh(){return{controller:new wS,data:new Map,refCount:0}}function Tr(i){i.refCount--,i.refCount===0&&CS(TS,function(){i.controller.abort()})}var xr=null,nh=0,la=0,ca=null;function xS(i,a){if(xr===null){var l=xr=[];nh=0,la=sd(),ca={status:"pending",value:void 0,then:function(u){l.push(u)}}}return nh++,a.then(Vg,Vg),a}function Vg(){if(--nh===0&&xr!==null){ca!==null&&(ca.status="fulfilled");var i=xr;xr=null,la=0,ca=null;for(var a=0;a<i.length;a++)(0,i[a])()}}function RS(i,a){var l=[],u={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return i.then(function(){u.status="fulfilled",u.value=a;for(var p=0;p<l.length;p++)(0,l[p])(a)},function(p){for(u.status="rejected",u.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),u}var qg=P.S;P.S=function(i,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&xS(i,a),qg!==null&&qg(i,a)};var ms=G(null);function ih(){var i=ms.current;return i!==null?i:Xt.pooledCache}function Sl(i,a){a===null?W(ms,ms.current):W(ms,a.pool)}function Yg(){var i=ih();return i===null?null:{parent:me._currentValue,pool:i}}var Rr=Error(n(460)),Xg=Error(n(474)),El=Error(n(542)),sh={then:function(){}};function $g(i){return i=i.status,i==="fulfilled"||i==="rejected"}function wl(){}function Wg(i,a,l){switch(l=i[l],l===void 0?i.push(a):l!==a&&(a.then(wl,wl),a=l),a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,Qg(i),i;default:if(typeof a.status=="string")a.then(wl,wl);else{if(i=Xt,i!==null&&100<i.shellSuspendCounter)throw Error(n(482));i=a,i.status="pending",i.then(function(u){if(a.status==="pending"){var p=a;p.status="fulfilled",p.value=u}},function(u){if(a.status==="pending"){var p=a;p.status="rejected",p.reason=u}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,Qg(i),i}throw Dr=a,Rr}}var Dr=null;function Kg(){if(Dr===null)throw Error(n(459));var i=Dr;return Dr=null,i}function Qg(i){if(i===Rr||i===El)throw Error(n(483))}var Ti=!1;function ah(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rh(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function xi(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Ri(i,a,l){var u=i.updateQueue;if(u===null)return null;if(u=u.shared,(Ft&2)!==0){var p=u.pending;return p===null?a.next=a:(a.next=p.next,p.next=a),u.pending=a,a=ml(i),Bg(i,null,l),a}return gl(i,u,a,l),ml(i)}function Mr(i,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194048)!==0)){var u=a.lanes;u&=i.pendingLanes,l|=u,a.lanes=l,Vp(i,l)}}function oh(i,a){var l=i.updateQueue,u=i.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var p=null,m=null;if(l=l.firstBaseUpdate,l!==null){do{var v={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};m===null?p=m=v:m=m.next=v,l=l.next}while(l!==null);m===null?p=m=a:m=m.next=a}else p=m=a;l={baseState:u.baseState,firstBaseUpdate:p,lastBaseUpdate:m,shared:u.shared,callbacks:u.callbacks},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=a:i.next=a,l.lastBaseUpdate=a}var lh=!1;function Nr(){if(lh){var i=ca;if(i!==null)throw i}}function Or(i,a,l,u){lh=!1;var p=i.updateQueue;Ti=!1;var m=p.firstBaseUpdate,v=p.lastBaseUpdate,E=p.shared.pending;if(E!==null){p.shared.pending=null;var R=E,H=R.next;R.next=null,v===null?m=H:v.next=H,v=R;var V=i.alternate;V!==null&&(V=V.updateQueue,E=V.lastBaseUpdate,E!==v&&(E===null?V.firstBaseUpdate=H:E.next=H,V.lastBaseUpdate=R))}if(m!==null){var X=p.baseState;v=0,V=H=R=null,E=m;do{var z=E.lane&-536870913,U=z!==E.lane;if(U?(kt&z)===z:(u&z)===z){z!==0&&z===la&&(lh=!0),V!==null&&(V=V.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});t:{var pt=i,ht=E;z=a;var Gt=l;switch(ht.tag){case 1:if(pt=ht.payload,typeof pt=="function"){X=pt.call(Gt,X,z);break t}X=pt;break t;case 3:pt.flags=pt.flags&-65537|128;case 0:if(pt=ht.payload,z=typeof pt=="function"?pt.call(Gt,X,z):pt,z==null)break t;X=g({},X,z);break t;case 2:Ti=!0}}z=E.callback,z!==null&&(i.flags|=64,U&&(i.flags|=8192),U=p.callbacks,U===null?p.callbacks=[z]:U.push(z))}else U={lane:z,tag:E.tag,payload:E.payload,callback:E.callback,next:null},V===null?(H=V=U,R=X):V=V.next=U,v|=z;if(E=E.next,E===null){if(E=p.shared.pending,E===null)break;U=E,E=U.next,U.next=null,p.lastBaseUpdate=U,p.shared.pending=null}}while(!0);V===null&&(R=X),p.baseState=R,p.firstBaseUpdate=H,p.lastBaseUpdate=V,m===null&&(p.shared.lanes=0),Pi|=v,i.lanes=v,i.memoizedState=X}}function Zg(i,a){if(typeof i!="function")throw Error(n(191,i));i.call(a)}function Jg(i,a){var l=i.callbacks;if(l!==null)for(i.callbacks=null,i=0;i<l.length;i++)Zg(l[i],a)}var ua=G(null),Cl=G(0);function tm(i,a){i=ui,W(Cl,i),W(ua,a),ui=i|a.baseLanes}function ch(){W(Cl,ui),W(ua,ua.current)}function uh(){ui=Cl.current,K(ua),K(Cl)}var Di=0,Et=null,Ut=null,ce=null,Tl=!1,ha=!1,_s=!1,xl=0,kr=0,da=null,DS=0;function se(){throw Error(n(321))}function hh(i,a){if(a===null)return!1;for(var l=0;l<a.length&&l<i.length;l++)if(!nn(i[l],a[l]))return!1;return!0}function dh(i,a,l,u,p,m){return Di=m,Et=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,P.H=i===null||i.memoizedState===null?Bm:Fm,_s=!1,m=l(u,p),_s=!1,ha&&(m=nm(a,l,u,p)),em(i),m}function em(i){P.H=kl;var a=Ut!==null&&Ut.next!==null;if(Di=0,ce=Ut=Et=null,Tl=!1,kr=0,da=null,a)throw Error(n(300));i===null||be||(i=i.dependencies,i!==null&&vl(i)&&(be=!0))}function nm(i,a,l,u){Et=i;var p=0;do{if(ha&&(da=null),kr=0,ha=!1,25<=p)throw Error(n(301));if(p+=1,ce=Ut=null,i.updateQueue!=null){var m=i.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}P.H=PS,m=a(l,u)}while(ha);return m}function MS(){var i=P.H,a=i.useState()[0];return a=typeof a.then=="function"?Lr(a):a,i=i.useState()[0],(Ut!==null?Ut.memoizedState:null)!==i&&(Et.flags|=1024),a}function fh(){var i=xl!==0;return xl=0,i}function ph(i,a,l){a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~l}function gh(i){if(Tl){for(i=i.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}Tl=!1}Di=0,ce=Ut=Et=null,ha=!1,kr=xl=0,da=null}function qe(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ce===null?Et.memoizedState=ce=i:ce=ce.next=i,ce}function ue(){if(Ut===null){var i=Et.alternate;i=i!==null?i.memoizedState:null}else i=Ut.next;var a=ce===null?Et.memoizedState:ce.next;if(a!==null)ce=a,Ut=i;else{if(i===null)throw Et.alternate===null?Error(n(467)):Error(n(310));Ut=i,i={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},ce===null?Et.memoizedState=ce=i:ce=ce.next=i}return ce}function mh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Lr(i){var a=kr;return kr+=1,da===null&&(da=[]),i=Wg(da,i,a),a=Et,(ce===null?a.memoizedState:ce.next)===null&&(a=a.alternate,P.H=a===null||a.memoizedState===null?Bm:Fm),i}function Rl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Lr(i);if(i.$$typeof===x)return Ie(i)}throw Error(n(438,String(i)))}function _h(i){var a=null,l=Et.updateQueue;if(l!==null&&(a=l.memoCache),a==null){var u=Et.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(a={data:u.data.map(function(p){return p.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),l===null&&(l=mh(),Et.updateQueue=l),l.memoCache=a,l=a.data[a.index],l===void 0)for(l=a.data[a.index]=Array(i),u=0;u<i;u++)l[u]=nt;return a.index++,l}function si(i,a){return typeof a=="function"?a(i):a}function Dl(i){var a=ue();return yh(a,Ut,i)}function yh(i,a,l){var u=i.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=l;var p=i.baseQueue,m=u.pending;if(m!==null){if(p!==null){var v=p.next;p.next=m.next,m.next=v}a.baseQueue=p=m,u.pending=null}if(m=i.baseState,p===null)i.memoizedState=m;else{a=p.next;var E=v=null,R=null,H=a,V=!1;do{var X=H.lane&-536870913;if(X!==H.lane?(kt&X)===X:(Di&X)===X){var z=H.revertLane;if(z===0)R!==null&&(R=R.next={lane:0,revertLane:0,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null}),X===la&&(V=!0);else if((Di&z)===z){H=H.next,z===la&&(V=!0);continue}else X={lane:0,revertLane:H.revertLane,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},R===null?(E=R=X,v=m):R=R.next=X,Et.lanes|=z,Pi|=z;X=H.action,_s&&l(m,X),m=H.hasEagerState?H.eagerState:l(m,X)}else z={lane:X,revertLane:H.revertLane,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},R===null?(E=R=z,v=m):R=R.next=z,Et.lanes|=X,Pi|=X;H=H.next}while(H!==null&&H!==a);if(R===null?v=m:R.next=E,!nn(m,i.memoizedState)&&(be=!0,V&&(l=ca,l!==null)))throw l;i.memoizedState=m,i.baseState=v,i.baseQueue=R,u.lastRenderedState=m}return p===null&&(u.lanes=0),[i.memoizedState,u.dispatch]}function bh(i){var a=ue(),l=a.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=i;var u=l.dispatch,p=l.pending,m=a.memoizedState;if(p!==null){l.pending=null;var v=p=p.next;do m=i(m,v.action),v=v.next;while(v!==p);nn(m,a.memoizedState)||(be=!0),a.memoizedState=m,a.baseQueue===null&&(a.baseState=m),l.lastRenderedState=m}return[m,u]}function im(i,a,l){var u=Et,p=ue(),m=It;if(m){if(l===void 0)throw Error(n(407));l=l()}else l=a();var v=!nn((Ut||p).memoizedState,l);v&&(p.memoizedState=l,be=!0),p=p.queue;var E=rm.bind(null,u,p,i);if(Ir(2048,8,E,[i]),p.getSnapshot!==a||v||ce!==null&&ce.memoizedState.tag&1){if(u.flags|=2048,fa(9,Ml(),am.bind(null,u,p,l,a),null),Xt===null)throw Error(n(349));m||(Di&124)!==0||sm(u,a,l)}return l}function sm(i,a,l){i.flags|=16384,i={getSnapshot:a,value:l},a=Et.updateQueue,a===null?(a=mh(),Et.updateQueue=a,a.stores=[i]):(l=a.stores,l===null?a.stores=[i]:l.push(i))}function am(i,a,l,u){a.value=l,a.getSnapshot=u,om(a)&&lm(i)}function rm(i,a,l){return l(function(){om(a)&&lm(i)})}function om(i){var a=i.getSnapshot;i=i.value;try{var l=a();return!nn(i,l)}catch{return!0}}function lm(i){var a=sa(i,2);a!==null&&cn(a,i,2)}function vh(i){var a=qe();if(typeof i=="function"){var l=i;if(i=l(),_s){Si(!0);try{l()}finally{Si(!1)}}}return a.memoizedState=a.baseState=i,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:i},a}function cm(i,a,l,u){return i.baseState=l,yh(i,Ut,typeof u=="function"?u:si)}function NS(i,a,l,u,p){if(Ol(i))throw Error(n(485));if(i=a.action,i!==null){var m={payload:p,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){m.listeners.push(v)}};P.T!==null?l(!0):m.isTransition=!1,u(m),l=a.pending,l===null?(m.next=a.pending=m,um(a,m)):(m.next=l.next,a.pending=l.next=m)}}function um(i,a){var l=a.action,u=a.payload,p=i.state;if(a.isTransition){var m=P.T,v={};P.T=v;try{var E=l(p,u),R=P.S;R!==null&&R(v,E),hm(i,a,E)}catch(H){Ah(i,a,H)}finally{P.T=m}}else try{m=l(p,u),hm(i,a,m)}catch(H){Ah(i,a,H)}}function hm(i,a,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){dm(i,a,u)},function(u){return Ah(i,a,u)}):dm(i,a,l)}function dm(i,a,l){a.status="fulfilled",a.value=l,fm(a),i.state=l,a=i.pending,a!==null&&(l=a.next,l===a?i.pending=null:(l=l.next,a.next=l,um(i,l)))}function Ah(i,a,l){var u=i.pending;if(i.pending=null,u!==null){u=u.next;do a.status="rejected",a.reason=l,fm(a),a=a.next;while(a!==u)}i.action=null}function fm(i){i=i.listeners;for(var a=0;a<i.length;a++)(0,i[a])()}function pm(i,a){return a}function gm(i,a){if(It){var l=Xt.formState;if(l!==null){t:{var u=Et;if(It){if(ne){e:{for(var p=ne,m=Bn;p.nodeType!==8;){if(!m){p=null;break e}if(p=Mn(p.nextSibling),p===null){p=null;break e}}m=p.data,p=m==="F!"||m==="F"?p:null}if(p){ne=Mn(p.nextSibling),u=p.data==="F!";break t}}fs(u)}u=!1}u&&(a=l[0])}}return l=qe(),l.memoizedState=l.baseState=a,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pm,lastRenderedState:a},l.queue=u,l=Lm.bind(null,Et,u),u.dispatch=l,u=vh(!1),m=Th.bind(null,Et,!1,u.queue),u=qe(),p={state:a,dispatch:null,action:i,pending:null},u.queue=p,l=NS.bind(null,Et,p,m,l),p.dispatch=l,u.memoizedState=i,[a,l,!1]}function mm(i){var a=ue();return _m(a,Ut,i)}function _m(i,a,l){if(a=yh(i,a,pm)[0],i=Dl(si)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var u=Lr(a)}catch(v){throw v===Rr?El:v}else u=a;a=ue();var p=a.queue,m=p.dispatch;return l!==a.memoizedState&&(Et.flags|=2048,fa(9,Ml(),OS.bind(null,p,l),null)),[u,m,i]}function OS(i,a){i.action=a}function ym(i){var a=ue(),l=Ut;if(l!==null)return _m(a,l,i);ue(),a=a.memoizedState,l=ue();var u=l.queue.dispatch;return l.memoizedState=i,[a,u,!1]}function fa(i,a,l,u){return i={tag:i,create:l,deps:u,inst:a,next:null},a=Et.updateQueue,a===null&&(a=mh(),Et.updateQueue=a),l=a.lastEffect,l===null?a.lastEffect=i.next=i:(u=l.next,l.next=i,i.next=u,a.lastEffect=i),i}function Ml(){return{destroy:void 0,resource:void 0}}function bm(){return ue().memoizedState}function Nl(i,a,l,u){var p=qe();u=u===void 0?null:u,Et.flags|=i,p.memoizedState=fa(1|a,Ml(),l,u)}function Ir(i,a,l,u){var p=ue();u=u===void 0?null:u;var m=p.memoizedState.inst;Ut!==null&&u!==null&&hh(u,Ut.memoizedState.deps)?p.memoizedState=fa(a,m,l,u):(Et.flags|=i,p.memoizedState=fa(1|a,m,l,u))}function vm(i,a){Nl(8390656,8,i,a)}function Am(i,a){Ir(2048,8,i,a)}function Sm(i,a){return Ir(4,2,i,a)}function Em(i,a){return Ir(4,4,i,a)}function wm(i,a){if(typeof a=="function"){i=i();var l=a(i);return function(){typeof l=="function"?l():a(null)}}if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function Cm(i,a,l){l=l!=null?l.concat([i]):null,Ir(4,4,wm.bind(null,a,i),l)}function Sh(){}function Tm(i,a){var l=ue();a=a===void 0?null:a;var u=l.memoizedState;return a!==null&&hh(a,u[1])?u[0]:(l.memoizedState=[i,a],i)}function xm(i,a){var l=ue();a=a===void 0?null:a;var u=l.memoizedState;if(a!==null&&hh(a,u[1]))return u[0];if(u=i(),_s){Si(!0);try{i()}finally{Si(!1)}}return l.memoizedState=[u,a],u}function Eh(i,a,l){return l===void 0||(Di&1073741824)!==0?i.memoizedState=a:(i.memoizedState=l,i=M_(),Et.lanes|=i,Pi|=i,l)}function Rm(i,a,l,u){return nn(l,a)?l:ua.current!==null?(i=Eh(i,l,u),nn(i,a)||(be=!0),i):(Di&42)===0?(be=!0,i.memoizedState=l):(i=M_(),Et.lanes|=i,Pi|=i,a)}function Dm(i,a,l,u,p){var m=L.p;L.p=m!==0&&8>m?m:8;var v=P.T,E={};P.T=E,Th(i,!1,a,l);try{var R=p(),H=P.S;if(H!==null&&H(E,R),R!==null&&typeof R=="object"&&typeof R.then=="function"){var V=RS(R,u);Pr(i,a,V,ln(i))}else Pr(i,a,u,ln(i))}catch(X){Pr(i,a,{then:function(){},status:"rejected",reason:X},ln())}finally{L.p=m,P.T=v}}function kS(){}function wh(i,a,l,u){if(i.tag!==5)throw Error(n(476));var p=Mm(i).queue;Dm(i,p,a,q,l===null?kS:function(){return Nm(i),l(u)})}function Mm(i){var a=i.memoizedState;if(a!==null)return a;a={memoizedState:q,baseState:q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:q},next:null};var l={};return a.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:l},next:null},i.memoizedState=a,i=i.alternate,i!==null&&(i.memoizedState=a),a}function Nm(i){var a=Mm(i).next.queue;Pr(i,a,{},ln())}function Ch(){return Ie(to)}function Om(){return ue().memoizedState}function km(){return ue().memoizedState}function LS(i){for(var a=i.return;a!==null;){switch(a.tag){case 24:case 3:var l=ln();i=xi(l);var u=Ri(a,i,l);u!==null&&(cn(u,a,l),Mr(u,a,l)),a={cache:eh()},i.payload=a;return}a=a.return}}function IS(i,a,l){var u=ln();l={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},Ol(i)?Im(a,l):(l=qu(i,a,l,u),l!==null&&(cn(l,i,u),Pm(l,a,u)))}function Lm(i,a,l){var u=ln();Pr(i,a,l,u)}function Pr(i,a,l,u){var p={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(Ol(i))Im(a,p);else{var m=i.alternate;if(i.lanes===0&&(m===null||m.lanes===0)&&(m=a.lastRenderedReducer,m!==null))try{var v=a.lastRenderedState,E=m(v,l);if(p.hasEagerState=!0,p.eagerState=E,nn(E,v))return gl(i,a,p,0),Xt===null&&pl(),!1}catch{}finally{}if(l=qu(i,a,p,u),l!==null)return cn(l,i,u),Pm(l,a,u),!0}return!1}function Th(i,a,l,u){if(u={lane:2,revertLane:sd(),action:u,hasEagerState:!1,eagerState:null,next:null},Ol(i)){if(a)throw Error(n(479))}else a=qu(i,l,u,2),a!==null&&cn(a,i,2)}function Ol(i){var a=i.alternate;return i===Et||a!==null&&a===Et}function Im(i,a){ha=Tl=!0;var l=i.pending;l===null?a.next=a:(a.next=l.next,l.next=a),i.pending=a}function Pm(i,a,l){if((l&4194048)!==0){var u=a.lanes;u&=i.pendingLanes,l|=u,a.lanes=l,Vp(i,l)}}var kl={readContext:Ie,use:Rl,useCallback:se,useContext:se,useEffect:se,useImperativeHandle:se,useLayoutEffect:se,useInsertionEffect:se,useMemo:se,useReducer:se,useRef:se,useState:se,useDebugValue:se,useDeferredValue:se,useTransition:se,useSyncExternalStore:se,useId:se,useHostTransitionStatus:se,useFormState:se,useActionState:se,useOptimistic:se,useMemoCache:se,useCacheRefresh:se},Bm={readContext:Ie,use:Rl,useCallback:function(i,a){return qe().memoizedState=[i,a===void 0?null:a],i},useContext:Ie,useEffect:vm,useImperativeHandle:function(i,a,l){l=l!=null?l.concat([i]):null,Nl(4194308,4,wm.bind(null,a,i),l)},useLayoutEffect:function(i,a){return Nl(4194308,4,i,a)},useInsertionEffect:function(i,a){Nl(4,2,i,a)},useMemo:function(i,a){var l=qe();a=a===void 0?null:a;var u=i();if(_s){Si(!0);try{i()}finally{Si(!1)}}return l.memoizedState=[u,a],u},useReducer:function(i,a,l){var u=qe();if(l!==void 0){var p=l(a);if(_s){Si(!0);try{l(a)}finally{Si(!1)}}}else p=a;return u.memoizedState=u.baseState=p,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:p},u.queue=i,i=i.dispatch=IS.bind(null,Et,i),[u.memoizedState,i]},useRef:function(i){var a=qe();return i={current:i},a.memoizedState=i},useState:function(i){i=vh(i);var a=i.queue,l=Lm.bind(null,Et,a);return a.dispatch=l,[i.memoizedState,l]},useDebugValue:Sh,useDeferredValue:function(i,a){var l=qe();return Eh(l,i,a)},useTransition:function(){var i=vh(!1);return i=Dm.bind(null,Et,i.queue,!0,!1),qe().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,a,l){var u=Et,p=qe();if(It){if(l===void 0)throw Error(n(407));l=l()}else{if(l=a(),Xt===null)throw Error(n(349));(kt&124)!==0||sm(u,a,l)}p.memoizedState=l;var m={value:l,getSnapshot:a};return p.queue=m,vm(rm.bind(null,u,m,i),[i]),u.flags|=2048,fa(9,Ml(),am.bind(null,u,m,l,a),null),l},useId:function(){var i=qe(),a=Xt.identifierPrefix;if(It){var l=ei,u=ti;l=(u&~(1<<32-en(u)-1)).toString(32)+l,a="«"+a+"R"+l,l=xl++,0<l&&(a+="H"+l.toString(32)),a+="»"}else l=DS++,a="«"+a+"r"+l.toString(32)+"»";return i.memoizedState=a},useHostTransitionStatus:Ch,useFormState:gm,useActionState:gm,useOptimistic:function(i){var a=qe();a.memoizedState=a.baseState=i;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=l,a=Th.bind(null,Et,!0,l),l.dispatch=a,[i,a]},useMemoCache:_h,useCacheRefresh:function(){return qe().memoizedState=LS.bind(null,Et)}},Fm={readContext:Ie,use:Rl,useCallback:Tm,useContext:Ie,useEffect:Am,useImperativeHandle:Cm,useInsertionEffect:Sm,useLayoutEffect:Em,useMemo:xm,useReducer:Dl,useRef:bm,useState:function(){return Dl(si)},useDebugValue:Sh,useDeferredValue:function(i,a){var l=ue();return Rm(l,Ut.memoizedState,i,a)},useTransition:function(){var i=Dl(si)[0],a=ue().memoizedState;return[typeof i=="boolean"?i:Lr(i),a]},useSyncExternalStore:im,useId:Om,useHostTransitionStatus:Ch,useFormState:mm,useActionState:mm,useOptimistic:function(i,a){var l=ue();return cm(l,Ut,i,a)},useMemoCache:_h,useCacheRefresh:km},PS={readContext:Ie,use:Rl,useCallback:Tm,useContext:Ie,useEffect:Am,useImperativeHandle:Cm,useInsertionEffect:Sm,useLayoutEffect:Em,useMemo:xm,useReducer:bh,useRef:bm,useState:function(){return bh(si)},useDebugValue:Sh,useDeferredValue:function(i,a){var l=ue();return Ut===null?Eh(l,i,a):Rm(l,Ut.memoizedState,i,a)},useTransition:function(){var i=bh(si)[0],a=ue().memoizedState;return[typeof i=="boolean"?i:Lr(i),a]},useSyncExternalStore:im,useId:Om,useHostTransitionStatus:Ch,useFormState:ym,useActionState:ym,useOptimistic:function(i,a){var l=ue();return Ut!==null?cm(l,Ut,i,a):(l.baseState=i,[i,l.queue.dispatch])},useMemoCache:_h,useCacheRefresh:km},pa=null,Br=0;function Ll(i){var a=Br;return Br+=1,pa===null&&(pa=[]),Wg(pa,i,a)}function Fr(i,a){a=a.props.ref,i.ref=a!==void 0?a:null}function Il(i,a){throw a.$$typeof===_?Error(n(525)):(i=Object.prototype.toString.call(a),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i)))}function Hm(i){var a=i._init;return a(i._payload)}function zm(i){function a(I,k){if(i){var F=I.deletions;F===null?(I.deletions=[k],I.flags|=16):F.push(k)}}function l(I,k){if(!i)return null;for(;k!==null;)a(I,k),k=k.sibling;return null}function u(I){for(var k=new Map;I!==null;)I.key!==null?k.set(I.key,I):k.set(I.index,I),I=I.sibling;return k}function p(I,k){return I=Jn(I,k),I.index=0,I.sibling=null,I}function m(I,k,F){return I.index=F,i?(F=I.alternate,F!==null?(F=F.index,F<k?(I.flags|=67108866,k):F):(I.flags|=67108866,k)):(I.flags|=1048576,k)}function v(I){return i&&I.alternate===null&&(I.flags|=67108866),I}function E(I,k,F,Y){return k===null||k.tag!==6?(k=Xu(F,I.mode,Y),k.return=I,k):(k=p(k,F),k.return=I,k)}function R(I,k,F,Y){var st=F.type;return st===A?V(I,k,F.props.children,Y,F.key):k!==null&&(k.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===j&&Hm(st)===k.type)?(k=p(k,F.props),Fr(k,F),k.return=I,k):(k=_l(F.type,F.key,F.props,null,I.mode,Y),Fr(k,F),k.return=I,k)}function H(I,k,F,Y){return k===null||k.tag!==4||k.stateNode.containerInfo!==F.containerInfo||k.stateNode.implementation!==F.implementation?(k=$u(F,I.mode,Y),k.return=I,k):(k=p(k,F.children||[]),k.return=I,k)}function V(I,k,F,Y,st){return k===null||k.tag!==7?(k=cs(F,I.mode,Y,st),k.return=I,k):(k=p(k,F),k.return=I,k)}function X(I,k,F){if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return k=Xu(""+k,I.mode,F),k.return=I,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case y:return F=_l(k.type,k.key,k.props,null,I.mode,F),Fr(F,k),F.return=I,F;case b:return k=$u(k,I.mode,F),k.return=I,k;case j:var Y=k._init;return k=Y(k._payload),X(I,k,F)}if(At(k)||lt(k))return k=cs(k,I.mode,F,null),k.return=I,k;if(typeof k.then=="function")return X(I,Ll(k),F);if(k.$$typeof===x)return X(I,Al(I,k),F);Il(I,k)}return null}function z(I,k,F,Y){var st=k!==null?k.key:null;if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return st!==null?null:E(I,k,""+F,Y);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case y:return F.key===st?R(I,k,F,Y):null;case b:return F.key===st?H(I,k,F,Y):null;case j:return st=F._init,F=st(F._payload),z(I,k,F,Y)}if(At(F)||lt(F))return st!==null?null:V(I,k,F,Y,null);if(typeof F.then=="function")return z(I,k,Ll(F),Y);if(F.$$typeof===x)return z(I,k,Al(I,F),Y);Il(I,F)}return null}function U(I,k,F,Y,st){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return I=I.get(F)||null,E(k,I,""+Y,st);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case y:return I=I.get(Y.key===null?F:Y.key)||null,R(k,I,Y,st);case b:return I=I.get(Y.key===null?F:Y.key)||null,H(k,I,Y,st);case j:var Ct=Y._init;return Y=Ct(Y._payload),U(I,k,F,Y,st)}if(At(Y)||lt(Y))return I=I.get(F)||null,V(k,I,Y,st,null);if(typeof Y.then=="function")return U(I,k,F,Ll(Y),st);if(Y.$$typeof===x)return U(I,k,F,Al(k,Y),st);Il(k,Y)}return null}function pt(I,k,F,Y){for(var st=null,Ct=null,ot=k,dt=k=0,Ae=null;ot!==null&&dt<F.length;dt++){ot.index>dt?(Ae=ot,ot=null):Ae=ot.sibling;var Lt=z(I,ot,F[dt],Y);if(Lt===null){ot===null&&(ot=Ae);break}i&&ot&&Lt.alternate===null&&a(I,ot),k=m(Lt,k,dt),Ct===null?st=Lt:Ct.sibling=Lt,Ct=Lt,ot=Ae}if(dt===F.length)return l(I,ot),It&&hs(I,dt),st;if(ot===null){for(;dt<F.length;dt++)ot=X(I,F[dt],Y),ot!==null&&(k=m(ot,k,dt),Ct===null?st=ot:Ct.sibling=ot,Ct=ot);return It&&hs(I,dt),st}for(ot=u(ot);dt<F.length;dt++)Ae=U(ot,I,dt,F[dt],Y),Ae!==null&&(i&&Ae.alternate!==null&&ot.delete(Ae.key===null?dt:Ae.key),k=m(Ae,k,dt),Ct===null?st=Ae:Ct.sibling=Ae,Ct=Ae);return i&&ot.forEach(function(qi){return a(I,qi)}),It&&hs(I,dt),st}function ht(I,k,F,Y){if(F==null)throw Error(n(151));for(var st=null,Ct=null,ot=k,dt=k=0,Ae=null,Lt=F.next();ot!==null&&!Lt.done;dt++,Lt=F.next()){ot.index>dt?(Ae=ot,ot=null):Ae=ot.sibling;var qi=z(I,ot,Lt.value,Y);if(qi===null){ot===null&&(ot=Ae);break}i&&ot&&qi.alternate===null&&a(I,ot),k=m(qi,k,dt),Ct===null?st=qi:Ct.sibling=qi,Ct=qi,ot=Ae}if(Lt.done)return l(I,ot),It&&hs(I,dt),st;if(ot===null){for(;!Lt.done;dt++,Lt=F.next())Lt=X(I,Lt.value,Y),Lt!==null&&(k=m(Lt,k,dt),Ct===null?st=Lt:Ct.sibling=Lt,Ct=Lt);return It&&hs(I,dt),st}for(ot=u(ot);!Lt.done;dt++,Lt=F.next())Lt=U(ot,I,dt,Lt.value,Y),Lt!==null&&(i&&Lt.alternate!==null&&ot.delete(Lt.key===null?dt:Lt.key),k=m(Lt,k,dt),Ct===null?st=Lt:Ct.sibling=Lt,Ct=Lt);return i&&ot.forEach(function(BE){return a(I,BE)}),It&&hs(I,dt),st}function Gt(I,k,F,Y){if(typeof F=="object"&&F!==null&&F.type===A&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case y:t:{for(var st=F.key;k!==null;){if(k.key===st){if(st=F.type,st===A){if(k.tag===7){l(I,k.sibling),Y=p(k,F.props.children),Y.return=I,I=Y;break t}}else if(k.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===j&&Hm(st)===k.type){l(I,k.sibling),Y=p(k,F.props),Fr(Y,F),Y.return=I,I=Y;break t}l(I,k);break}else a(I,k);k=k.sibling}F.type===A?(Y=cs(F.props.children,I.mode,Y,F.key),Y.return=I,I=Y):(Y=_l(F.type,F.key,F.props,null,I.mode,Y),Fr(Y,F),Y.return=I,I=Y)}return v(I);case b:t:{for(st=F.key;k!==null;){if(k.key===st)if(k.tag===4&&k.stateNode.containerInfo===F.containerInfo&&k.stateNode.implementation===F.implementation){l(I,k.sibling),Y=p(k,F.children||[]),Y.return=I,I=Y;break t}else{l(I,k);break}else a(I,k);k=k.sibling}Y=$u(F,I.mode,Y),Y.return=I,I=Y}return v(I);case j:return st=F._init,F=st(F._payload),Gt(I,k,F,Y)}if(At(F))return pt(I,k,F,Y);if(lt(F)){if(st=lt(F),typeof st!="function")throw Error(n(150));return F=st.call(F),ht(I,k,F,Y)}if(typeof F.then=="function")return Gt(I,k,Ll(F),Y);if(F.$$typeof===x)return Gt(I,k,Al(I,F),Y);Il(I,F)}return typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint"?(F=""+F,k!==null&&k.tag===6?(l(I,k.sibling),Y=p(k,F),Y.return=I,I=Y):(l(I,k),Y=Xu(F,I.mode,Y),Y.return=I,I=Y),v(I)):l(I,k)}return function(I,k,F,Y){try{Br=0;var st=Gt(I,k,F,Y);return pa=null,st}catch(ot){if(ot===Rr||ot===El)throw ot;var Ct=sn(29,ot,null,I.mode);return Ct.lanes=Y,Ct.return=I,Ct}finally{}}}var ga=zm(!0),Um=zm(!1),yn=G(null),Fn=null;function Mi(i){var a=i.alternate;W(_e,_e.current&1),W(yn,i),Fn===null&&(a===null||ua.current!==null||a.memoizedState!==null)&&(Fn=i)}function jm(i){if(i.tag===22){if(W(_e,_e.current),W(yn,i),Fn===null){var a=i.alternate;a!==null&&a.memoizedState!==null&&(Fn=i)}}else Ni()}function Ni(){W(_e,_e.current),W(yn,yn.current)}function ai(i){K(yn),Fn===i&&(Fn=null),K(_e)}var _e=G(0);function Pl(i){for(var a=i;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||md(l)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function xh(i,a,l,u){a=i.memoizedState,l=l(u,a),l=l==null?a:g({},a,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var Rh={enqueueSetState:function(i,a,l){i=i._reactInternals;var u=ln(),p=xi(u);p.payload=a,l!=null&&(p.callback=l),a=Ri(i,p,u),a!==null&&(cn(a,i,u),Mr(a,i,u))},enqueueReplaceState:function(i,a,l){i=i._reactInternals;var u=ln(),p=xi(u);p.tag=1,p.payload=a,l!=null&&(p.callback=l),a=Ri(i,p,u),a!==null&&(cn(a,i,u),Mr(a,i,u))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var l=ln(),u=xi(l);u.tag=2,a!=null&&(u.callback=a),a=Ri(i,u,l),a!==null&&(cn(a,i,l),Mr(a,i,l))}};function Gm(i,a,l,u,p,m,v){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(u,m,v):a.prototype&&a.prototype.isPureReactComponent?!vr(l,u)||!vr(p,m):!0}function Vm(i,a,l,u){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,u),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,u),a.state!==i&&Rh.enqueueReplaceState(a,a.state,null)}function ys(i,a){var l=a;if("ref"in a){l={};for(var u in a)u!=="ref"&&(l[u]=a[u])}if(i=i.defaultProps){l===a&&(l=g({},l));for(var p in i)l[p]===void 0&&(l[p]=i[p])}return l}var Bl=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function qm(i){Bl(i)}function Ym(i){console.error(i)}function Xm(i){Bl(i)}function Fl(i,a){try{var l=i.onUncaughtError;l(a.value,{componentStack:a.stack})}catch(u){setTimeout(function(){throw u})}}function $m(i,a,l){try{var u=i.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Dh(i,a,l){return l=xi(l),l.tag=3,l.payload={element:null},l.callback=function(){Fl(i,a)},l}function Wm(i){return i=xi(i),i.tag=3,i}function Km(i,a,l,u){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var m=u.value;i.payload=function(){return p(m)},i.callback=function(){$m(a,l,u)}}var v=l.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(i.callback=function(){$m(a,l,u),typeof p!="function"&&(Bi===null?Bi=new Set([this]):Bi.add(this));var E=u.stack;this.componentDidCatch(u.value,{componentStack:E!==null?E:""})})}function BS(i,a,l,u,p){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(a=l.alternate,a!==null&&Cr(a,l,p,!0),l=yn.current,l!==null){switch(l.tag){case 13:return Fn===null?Jh():l.alternate===null&&ie===0&&(ie=3),l.flags&=-257,l.flags|=65536,l.lanes=p,u===sh?l.flags|=16384:(a=l.updateQueue,a===null?l.updateQueue=new Set([u]):a.add(u),ed(i,u,p)),!1;case 22:return l.flags|=65536,u===sh?l.flags|=16384:(a=l.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=a):(l=a.retryQueue,l===null?a.retryQueue=new Set([u]):l.add(u)),ed(i,u,p)),!1}throw Error(n(435,l.tag))}return ed(i,u,p),Jh(),!1}if(It)return a=yn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=p,u!==Qu&&(i=Error(n(422),{cause:u}),wr(pn(i,l)))):(u!==Qu&&(a=Error(n(423),{cause:u}),wr(pn(a,l))),i=i.current.alternate,i.flags|=65536,p&=-p,i.lanes|=p,u=pn(u,l),p=Dh(i.stateNode,u,p),oh(i,p),ie!==4&&(ie=2)),!1;var m=Error(n(520),{cause:u});if(m=pn(m,l),qr===null?qr=[m]:qr.push(m),ie!==4&&(ie=2),a===null)return!0;u=pn(u,l),l=a;do{switch(l.tag){case 3:return l.flags|=65536,i=p&-p,l.lanes|=i,i=Dh(l.stateNode,u,i),oh(l,i),!1;case 1:if(a=l.type,m=l.stateNode,(l.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Bi===null||!Bi.has(m))))return l.flags|=65536,p&=-p,l.lanes|=p,p=Wm(p),Km(p,i,l,u),oh(l,p),!1}l=l.return}while(l!==null);return!1}var Qm=Error(n(461)),be=!1;function Te(i,a,l,u){a.child=i===null?Um(a,null,l,u):ga(a,i.child,l,u)}function Zm(i,a,l,u,p){l=l.render;var m=a.ref;if("ref"in u){var v={};for(var E in u)E!=="ref"&&(v[E]=u[E])}else v=u;return gs(a),u=dh(i,a,l,v,m,p),E=fh(),i!==null&&!be?(ph(i,a,p),ri(i,a,p)):(It&&E&&Wu(a),a.flags|=1,Te(i,a,u,p),a.child)}function Jm(i,a,l,u,p){if(i===null){var m=l.type;return typeof m=="function"&&!Yu(m)&&m.defaultProps===void 0&&l.compare===null?(a.tag=15,a.type=m,t_(i,a,m,u,p)):(i=_l(l.type,null,u,a,a.mode,p),i.ref=a.ref,i.return=a,a.child=i)}if(m=i.child,!Bh(i,p)){var v=m.memoizedProps;if(l=l.compare,l=l!==null?l:vr,l(v,u)&&i.ref===a.ref)return ri(i,a,p)}return a.flags|=1,i=Jn(m,u),i.ref=a.ref,i.return=a,a.child=i}function t_(i,a,l,u,p){if(i!==null){var m=i.memoizedProps;if(vr(m,u)&&i.ref===a.ref)if(be=!1,a.pendingProps=u=m,Bh(i,p))(i.flags&131072)!==0&&(be=!0);else return a.lanes=i.lanes,ri(i,a,p)}return Mh(i,a,l,u,p)}function e_(i,a,l){var u=a.pendingProps,p=u.children,m=i!==null?i.memoizedState:null;if(u.mode==="hidden"){if((a.flags&128)!==0){if(u=m!==null?m.baseLanes|l:l,i!==null){for(p=a.child=i.child,m=0;p!==null;)m=m|p.lanes|p.childLanes,p=p.sibling;a.childLanes=m&~u}else a.childLanes=0,a.child=null;return n_(i,a,u,l)}if((l&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},i!==null&&Sl(a,m!==null?m.cachePool:null),m!==null?tm(a,m):ch(),jm(a);else return a.lanes=a.childLanes=536870912,n_(i,a,m!==null?m.baseLanes|l:l,l)}else m!==null?(Sl(a,m.cachePool),tm(a,m),Ni(),a.memoizedState=null):(i!==null&&Sl(a,null),ch(),Ni());return Te(i,a,p,l),a.child}function n_(i,a,l,u){var p=ih();return p=p===null?null:{parent:me._currentValue,pool:p},a.memoizedState={baseLanes:l,cachePool:p},i!==null&&Sl(a,null),ch(),jm(a),i!==null&&Cr(i,a,u,!0),null}function Hl(i,a){var l=a.ref;if(l===null)i!==null&&i.ref!==null&&(a.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(n(284));(i===null||i.ref!==l)&&(a.flags|=4194816)}}function Mh(i,a,l,u,p){return gs(a),l=dh(i,a,l,u,void 0,p),u=fh(),i!==null&&!be?(ph(i,a,p),ri(i,a,p)):(It&&u&&Wu(a),a.flags|=1,Te(i,a,l,p),a.child)}function i_(i,a,l,u,p,m){return gs(a),a.updateQueue=null,l=nm(a,u,l,p),em(i),u=fh(),i!==null&&!be?(ph(i,a,m),ri(i,a,m)):(It&&u&&Wu(a),a.flags|=1,Te(i,a,l,m),a.child)}function s_(i,a,l,u,p){if(gs(a),a.stateNode===null){var m=aa,v=l.contextType;typeof v=="object"&&v!==null&&(m=Ie(v)),m=new l(u,m),a.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Rh,a.stateNode=m,m._reactInternals=a,m=a.stateNode,m.props=u,m.state=a.memoizedState,m.refs={},ah(a),v=l.contextType,m.context=typeof v=="object"&&v!==null?Ie(v):aa,m.state=a.memoizedState,v=l.getDerivedStateFromProps,typeof v=="function"&&(xh(a,l,v,u),m.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(v=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),v!==m.state&&Rh.enqueueReplaceState(m,m.state,null),Or(a,u,m,p),Nr(),m.state=a.memoizedState),typeof m.componentDidMount=="function"&&(a.flags|=4194308),u=!0}else if(i===null){m=a.stateNode;var E=a.memoizedProps,R=ys(l,E);m.props=R;var H=m.context,V=l.contextType;v=aa,typeof V=="object"&&V!==null&&(v=Ie(V));var X=l.getDerivedStateFromProps;V=typeof X=="function"||typeof m.getSnapshotBeforeUpdate=="function",E=a.pendingProps!==E,V||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(E||H!==v)&&Vm(a,m,u,v),Ti=!1;var z=a.memoizedState;m.state=z,Or(a,u,m,p),Nr(),H=a.memoizedState,E||z!==H||Ti?(typeof X=="function"&&(xh(a,l,X,u),H=a.memoizedState),(R=Ti||Gm(a,l,R,u,z,H,v))?(V||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(a.flags|=4194308)):(typeof m.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=u,a.memoizedState=H),m.props=u,m.state=H,m.context=v,u=R):(typeof m.componentDidMount=="function"&&(a.flags|=4194308),u=!1)}else{m=a.stateNode,rh(i,a),v=a.memoizedProps,V=ys(l,v),m.props=V,X=a.pendingProps,z=m.context,H=l.contextType,R=aa,typeof H=="object"&&H!==null&&(R=Ie(H)),E=l.getDerivedStateFromProps,(H=typeof E=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(v!==X||z!==R)&&Vm(a,m,u,R),Ti=!1,z=a.memoizedState,m.state=z,Or(a,u,m,p),Nr();var U=a.memoizedState;v!==X||z!==U||Ti||i!==null&&i.dependencies!==null&&vl(i.dependencies)?(typeof E=="function"&&(xh(a,l,E,u),U=a.memoizedState),(V=Ti||Gm(a,l,V,u,z,U,R)||i!==null&&i.dependencies!==null&&vl(i.dependencies))?(H||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(u,U,R),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(u,U,R)),typeof m.componentDidUpdate=="function"&&(a.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof m.componentDidUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(a.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(a.flags|=1024),a.memoizedProps=u,a.memoizedState=U),m.props=u,m.state=U,m.context=R,u=V):(typeof m.componentDidUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(a.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===i.memoizedProps&&z===i.memoizedState||(a.flags|=1024),u=!1)}return m=u,Hl(i,a),u=(a.flags&128)!==0,m||u?(m=a.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:m.render(),a.flags|=1,i!==null&&u?(a.child=ga(a,i.child,null,p),a.child=ga(a,null,l,p)):Te(i,a,l,p),a.memoizedState=m.state,i=a.child):i=ri(i,a,p),i}function a_(i,a,l,u){return Er(),a.flags|=256,Te(i,a,l,u),a.child}var Nh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Oh(i){return{baseLanes:i,cachePool:Yg()}}function kh(i,a,l){return i=i!==null?i.childLanes&~l:0,a&&(i|=bn),i}function r_(i,a,l){var u=a.pendingProps,p=!1,m=(a.flags&128)!==0,v;if((v=m)||(v=i!==null&&i.memoizedState===null?!1:(_e.current&2)!==0),v&&(p=!0,a.flags&=-129),v=(a.flags&32)!==0,a.flags&=-33,i===null){if(It){if(p?Mi(a):Ni(),It){var E=ne,R;if(R=E){t:{for(R=E,E=Bn;R.nodeType!==8;){if(!E){E=null;break t}if(R=Mn(R.nextSibling),R===null){E=null;break t}}E=R}E!==null?(a.memoizedState={dehydrated:E,treeContext:us!==null?{id:ti,overflow:ei}:null,retryLane:536870912,hydrationErrors:null},R=sn(18,null,null,0),R.stateNode=E,R.return=a,a.child=R,Fe=a,ne=null,R=!0):R=!1}R||fs(a)}if(E=a.memoizedState,E!==null&&(E=E.dehydrated,E!==null))return md(E)?a.lanes=32:a.lanes=536870912,null;ai(a)}return E=u.children,u=u.fallback,p?(Ni(),p=a.mode,E=zl({mode:"hidden",children:E},p),u=cs(u,p,l,null),E.return=a,u.return=a,E.sibling=u,a.child=E,p=a.child,p.memoizedState=Oh(l),p.childLanes=kh(i,v,l),a.memoizedState=Nh,u):(Mi(a),Lh(a,E))}if(R=i.memoizedState,R!==null&&(E=R.dehydrated,E!==null)){if(m)a.flags&256?(Mi(a),a.flags&=-257,a=Ih(i,a,l)):a.memoizedState!==null?(Ni(),a.child=i.child,a.flags|=128,a=null):(Ni(),p=u.fallback,E=a.mode,u=zl({mode:"visible",children:u.children},E),p=cs(p,E,l,null),p.flags|=2,u.return=a,p.return=a,u.sibling=p,a.child=u,ga(a,i.child,null,l),u=a.child,u.memoizedState=Oh(l),u.childLanes=kh(i,v,l),a.memoizedState=Nh,a=p);else if(Mi(a),md(E)){if(v=E.nextSibling&&E.nextSibling.dataset,v)var H=v.dgst;v=H,u=Error(n(419)),u.stack="",u.digest=v,wr({value:u,source:null,stack:null}),a=Ih(i,a,l)}else if(be||Cr(i,a,l,!1),v=(l&i.childLanes)!==0,be||v){if(v=Xt,v!==null&&(u=l&-l,u=(u&42)!==0?1:_u(u),u=(u&(v.suspendedLanes|l))!==0?0:u,u!==0&&u!==R.retryLane))throw R.retryLane=u,sa(i,u),cn(v,i,u),Qm;E.data==="$?"||Jh(),a=Ih(i,a,l)}else E.data==="$?"?(a.flags|=192,a.child=i.child,a=null):(i=R.treeContext,ne=Mn(E.nextSibling),Fe=a,It=!0,ds=null,Bn=!1,i!==null&&(mn[_n++]=ti,mn[_n++]=ei,mn[_n++]=us,ti=i.id,ei=i.overflow,us=a),a=Lh(a,u.children),a.flags|=4096);return a}return p?(Ni(),p=u.fallback,E=a.mode,R=i.child,H=R.sibling,u=Jn(R,{mode:"hidden",children:u.children}),u.subtreeFlags=R.subtreeFlags&65011712,H!==null?p=Jn(H,p):(p=cs(p,E,l,null),p.flags|=2),p.return=a,u.return=a,u.sibling=p,a.child=u,u=p,p=a.child,E=i.child.memoizedState,E===null?E=Oh(l):(R=E.cachePool,R!==null?(H=me._currentValue,R=R.parent!==H?{parent:H,pool:H}:R):R=Yg(),E={baseLanes:E.baseLanes|l,cachePool:R}),p.memoizedState=E,p.childLanes=kh(i,v,l),a.memoizedState=Nh,u):(Mi(a),l=i.child,i=l.sibling,l=Jn(l,{mode:"visible",children:u.children}),l.return=a,l.sibling=null,i!==null&&(v=a.deletions,v===null?(a.deletions=[i],a.flags|=16):v.push(i)),a.child=l,a.memoizedState=null,l)}function Lh(i,a){return a=zl({mode:"visible",children:a},i.mode),a.return=i,i.child=a}function zl(i,a){return i=sn(22,i,null,a),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function Ih(i,a,l){return ga(a,i.child,null,l),i=Lh(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function o_(i,a,l){i.lanes|=a;var u=i.alternate;u!==null&&(u.lanes|=a),Ju(i.return,a,l)}function Ph(i,a,l,u,p){var m=i.memoizedState;m===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:p}:(m.isBackwards=a,m.rendering=null,m.renderingStartTime=0,m.last=u,m.tail=l,m.tailMode=p)}function l_(i,a,l){var u=a.pendingProps,p=u.revealOrder,m=u.tail;if(Te(i,a,u.children,l),u=_e.current,(u&2)!==0)u=u&1|2,a.flags|=128;else{if(i!==null&&(i.flags&128)!==0)t:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&o_(i,l,a);else if(i.tag===19)o_(i,l,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break t;for(;i.sibling===null;){if(i.return===null||i.return===a)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}u&=1}switch(W(_e,u),p){case"forwards":for(l=a.child,p=null;l!==null;)i=l.alternate,i!==null&&Pl(i)===null&&(p=l),l=l.sibling;l=p,l===null?(p=a.child,a.child=null):(p=l.sibling,l.sibling=null),Ph(a,!1,p,l,m);break;case"backwards":for(l=null,p=a.child,a.child=null;p!==null;){if(i=p.alternate,i!==null&&Pl(i)===null){a.child=p;break}i=p.sibling,p.sibling=l,l=p,p=i}Ph(a,!0,l,null,m);break;case"together":Ph(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function ri(i,a,l){if(i!==null&&(a.dependencies=i.dependencies),Pi|=a.lanes,(l&a.childLanes)===0)if(i!==null){if(Cr(i,a,l,!1),(l&a.childLanes)===0)return null}else return null;if(i!==null&&a.child!==i.child)throw Error(n(153));if(a.child!==null){for(i=a.child,l=Jn(i,i.pendingProps),a.child=l,l.return=a;i.sibling!==null;)i=i.sibling,l=l.sibling=Jn(i,i.pendingProps),l.return=a;l.sibling=null}return a.child}function Bh(i,a){return(i.lanes&a)!==0?!0:(i=i.dependencies,!!(i!==null&&vl(i)))}function FS(i,a,l){switch(a.tag){case 3:Bt(a,a.stateNode.containerInfo),Ci(a,me,i.memoizedState.cache),Er();break;case 27:case 5:rr(a);break;case 4:Bt(a,a.stateNode.containerInfo);break;case 10:Ci(a,a.type,a.memoizedProps.value);break;case 13:var u=a.memoizedState;if(u!==null)return u.dehydrated!==null?(Mi(a),a.flags|=128,null):(l&a.child.childLanes)!==0?r_(i,a,l):(Mi(a),i=ri(i,a,l),i!==null?i.sibling:null);Mi(a);break;case 19:var p=(i.flags&128)!==0;if(u=(l&a.childLanes)!==0,u||(Cr(i,a,l,!1),u=(l&a.childLanes)!==0),p){if(u)return l_(i,a,l);a.flags|=128}if(p=a.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),W(_e,_e.current),u)break;return null;case 22:case 23:return a.lanes=0,e_(i,a,l);case 24:Ci(a,me,i.memoizedState.cache)}return ri(i,a,l)}function c_(i,a,l){if(i!==null)if(i.memoizedProps!==a.pendingProps)be=!0;else{if(!Bh(i,l)&&(a.flags&128)===0)return be=!1,FS(i,a,l);be=(i.flags&131072)!==0}else be=!1,It&&(a.flags&1048576)!==0&&Hg(a,bl,a.index);switch(a.lanes=0,a.tag){case 16:t:{i=a.pendingProps;var u=a.elementType,p=u._init;if(u=p(u._payload),a.type=u,typeof u=="function")Yu(u)?(i=ys(u,i),a.tag=1,a=s_(null,a,u,i,l)):(a.tag=0,a=Mh(null,a,u,i,l));else{if(u!=null){if(p=u.$$typeof,p===M){a.tag=11,a=Zm(null,a,u,i,l);break t}else if(p===B){a.tag=14,a=Jm(null,a,u,i,l);break t}}throw a=yt(u)||u,Error(n(306,a,""))}}return a;case 0:return Mh(i,a,a.type,a.pendingProps,l);case 1:return u=a.type,p=ys(u,a.pendingProps),s_(i,a,u,p,l);case 3:t:{if(Bt(a,a.stateNode.containerInfo),i===null)throw Error(n(387));u=a.pendingProps;var m=a.memoizedState;p=m.element,rh(i,a),Or(a,u,null,l);var v=a.memoizedState;if(u=v.cache,Ci(a,me,u),u!==m.cache&&th(a,[me],l,!0),Nr(),u=v.element,m.isDehydrated)if(m={element:u,isDehydrated:!1,cache:v.cache},a.updateQueue.baseState=m,a.memoizedState=m,a.flags&256){a=a_(i,a,u,l);break t}else if(u!==p){p=pn(Error(n(424)),a),wr(p),a=a_(i,a,u,l);break t}else{switch(i=a.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(ne=Mn(i.firstChild),Fe=a,It=!0,ds=null,Bn=!0,l=Um(a,null,u,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Er(),u===p){a=ri(i,a,l);break t}Te(i,a,u,l)}a=a.child}return a;case 26:return Hl(i,a),i===null?(l=fy(a.type,null,a.pendingProps,null))?a.memoizedState=l:It||(l=a.type,i=a.pendingProps,u=tc(ct.current).createElement(l),u[Le]=a,u[Ge]=i,Re(u,l,i),ye(u),a.stateNode=u):a.memoizedState=fy(a.type,i.memoizedProps,a.pendingProps,i.memoizedState),null;case 27:return rr(a),i===null&&It&&(u=a.stateNode=uy(a.type,a.pendingProps,ct.current),Fe=a,Bn=!0,p=ne,zi(a.type)?(_d=p,ne=Mn(u.firstChild)):ne=p),Te(i,a,a.pendingProps.children,l),Hl(i,a),i===null&&(a.flags|=4194304),a.child;case 5:return i===null&&It&&((p=u=ne)&&(u=dE(u,a.type,a.pendingProps,Bn),u!==null?(a.stateNode=u,Fe=a,ne=Mn(u.firstChild),Bn=!1,p=!0):p=!1),p||fs(a)),rr(a),p=a.type,m=a.pendingProps,v=i!==null?i.memoizedProps:null,u=m.children,fd(p,m)?u=null:v!==null&&fd(p,v)&&(a.flags|=32),a.memoizedState!==null&&(p=dh(i,a,MS,null,null,l),to._currentValue=p),Hl(i,a),Te(i,a,u,l),a.child;case 6:return i===null&&It&&((i=l=ne)&&(l=fE(l,a.pendingProps,Bn),l!==null?(a.stateNode=l,Fe=a,ne=null,i=!0):i=!1),i||fs(a)),null;case 13:return r_(i,a,l);case 4:return Bt(a,a.stateNode.containerInfo),u=a.pendingProps,i===null?a.child=ga(a,null,u,l):Te(i,a,u,l),a.child;case 11:return Zm(i,a,a.type,a.pendingProps,l);case 7:return Te(i,a,a.pendingProps,l),a.child;case 8:return Te(i,a,a.pendingProps.children,l),a.child;case 12:return Te(i,a,a.pendingProps.children,l),a.child;case 10:return u=a.pendingProps,Ci(a,a.type,u.value),Te(i,a,u.children,l),a.child;case 9:return p=a.type._context,u=a.pendingProps.children,gs(a),p=Ie(p),u=u(p),a.flags|=1,Te(i,a,u,l),a.child;case 14:return Jm(i,a,a.type,a.pendingProps,l);case 15:return t_(i,a,a.type,a.pendingProps,l);case 19:return l_(i,a,l);case 31:return u=a.pendingProps,l=a.mode,u={mode:u.mode,children:u.children},i===null?(l=zl(u,l),l.ref=a.ref,a.child=l,l.return=a,a=l):(l=Jn(i.child,u),l.ref=a.ref,a.child=l,l.return=a,a=l),a;case 22:return e_(i,a,l);case 24:return gs(a),u=Ie(me),i===null?(p=ih(),p===null&&(p=Xt,m=eh(),p.pooledCache=m,m.refCount++,m!==null&&(p.pooledCacheLanes|=l),p=m),a.memoizedState={parent:u,cache:p},ah(a),Ci(a,me,p)):((i.lanes&l)!==0&&(rh(i,a),Or(a,null,null,l),Nr()),p=i.memoizedState,m=a.memoizedState,p.parent!==u?(p={parent:u,cache:u},a.memoizedState=p,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=p),Ci(a,me,u)):(u=m.cache,Ci(a,me,u),u!==p.cache&&th(a,[me],l,!0))),Te(i,a,a.pendingProps.children,l),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function oi(i){i.flags|=4}function u_(i,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!yy(a)){if(a=yn.current,a!==null&&((kt&4194048)===kt?Fn!==null:(kt&62914560)!==kt&&(kt&536870912)===0||a!==Fn))throw Dr=sh,Xg;i.flags|=8192}}function Ul(i,a){a!==null&&(i.flags|=4),i.flags&16384&&(a=i.tag!==22?jp():536870912,i.lanes|=a,ba|=a)}function Hr(i,a){if(!It)switch(i.tailMode){case"hidden":a=i.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:u.sibling=null}}function Jt(i){var a=i.alternate!==null&&i.alternate.child===i.child,l=0,u=0;if(a)for(var p=i.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags&65011712,u|=p.flags&65011712,p.return=i,p=p.sibling;else for(p=i.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags,u|=p.flags,p.return=i,p=p.sibling;return i.subtreeFlags|=u,i.childLanes=l,a}function HS(i,a,l){var u=a.pendingProps;switch(Ku(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(a),null;case 1:return Jt(a),null;case 3:return l=a.stateNode,u=null,i!==null&&(u=i.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),ii(me),In(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(Sr(a)?oi(a):i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,jg())),Jt(a),null;case 26:return l=a.memoizedState,i===null?(oi(a),l!==null?(Jt(a),u_(a,l)):(Jt(a),a.flags&=-16777217)):l?l!==i.memoizedState?(oi(a),Jt(a),u_(a,l)):(Jt(a),a.flags&=-16777217):(i.memoizedProps!==u&&oi(a),Jt(a),a.flags&=-16777217),null;case 27:Ai(a),l=ct.current;var p=a.type;if(i!==null&&a.stateNode!=null)i.memoizedProps!==u&&oi(a);else{if(!u){if(a.stateNode===null)throw Error(n(166));return Jt(a),null}i=rt.current,Sr(a)?zg(a):(i=uy(p,u,l),a.stateNode=i,oi(a))}return Jt(a),null;case 5:if(Ai(a),l=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==u&&oi(a);else{if(!u){if(a.stateNode===null)throw Error(n(166));return Jt(a),null}if(i=rt.current,Sr(a))zg(a);else{switch(p=tc(ct.current),i){case 1:i=p.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:i=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":i=p.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":i=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":i=p.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof u.is=="string"?p.createElement("select",{is:u.is}):p.createElement("select"),u.multiple?i.multiple=!0:u.size&&(i.size=u.size);break;default:i=typeof u.is=="string"?p.createElement(l,{is:u.is}):p.createElement(l)}}i[Le]=a,i[Ge]=u;t:for(p=a.child;p!==null;){if(p.tag===5||p.tag===6)i.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===a)break t;for(;p.sibling===null;){if(p.return===null||p.return===a)break t;p=p.return}p.sibling.return=p.return,p=p.sibling}a.stateNode=i;t:switch(Re(i,l,u),l){case"button":case"input":case"select":case"textarea":i=!!u.autoFocus;break t;case"img":i=!0;break t;default:i=!1}i&&oi(a)}}return Jt(a),a.flags&=-16777217,null;case 6:if(i&&a.stateNode!=null)i.memoizedProps!==u&&oi(a);else{if(typeof u!="string"&&a.stateNode===null)throw Error(n(166));if(i=ct.current,Sr(a)){if(i=a.stateNode,l=a.memoizedProps,u=null,p=Fe,p!==null)switch(p.tag){case 27:case 5:u=p.memoizedProps}i[Le]=a,i=!!(i.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||iy(i.nodeValue,l)),i||fs(a)}else i=tc(i).createTextNode(u),i[Le]=a,a.stateNode=i}return Jt(a),null;case 13:if(u=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(p=Sr(a),u!==null&&u.dehydrated!==null){if(i===null){if(!p)throw Error(n(318));if(p=a.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(n(317));p[Le]=a}else Er(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Jt(a),p=!1}else p=jg(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=p),p=!0;if(!p)return a.flags&256?(ai(a),a):(ai(a),null)}if(ai(a),(a.flags&128)!==0)return a.lanes=l,a;if(l=u!==null,i=i!==null&&i.memoizedState!==null,l){u=a.child,p=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(p=u.alternate.memoizedState.cachePool.pool);var m=null;u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(m=u.memoizedState.cachePool.pool),m!==p&&(u.flags|=2048)}return l!==i&&l&&(a.child.flags|=8192),Ul(a,a.updateQueue),Jt(a),null;case 4:return In(),i===null&&ld(a.stateNode.containerInfo),Jt(a),null;case 10:return ii(a.type),Jt(a),null;case 19:if(K(_e),p=a.memoizedState,p===null)return Jt(a),null;if(u=(a.flags&128)!==0,m=p.rendering,m===null)if(u)Hr(p,!1);else{if(ie!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if(m=Pl(i),m!==null){for(a.flags|=128,Hr(p,!1),i=m.updateQueue,a.updateQueue=i,Ul(a,i),a.subtreeFlags=0,i=l,l=a.child;l!==null;)Fg(l,i),l=l.sibling;return W(_e,_e.current&1|2),a.child}i=i.sibling}p.tail!==null&&Pn()>Vl&&(a.flags|=128,u=!0,Hr(p,!1),a.lanes=4194304)}else{if(!u)if(i=Pl(m),i!==null){if(a.flags|=128,u=!0,i=i.updateQueue,a.updateQueue=i,Ul(a,i),Hr(p,!0),p.tail===null&&p.tailMode==="hidden"&&!m.alternate&&!It)return Jt(a),null}else 2*Pn()-p.renderingStartTime>Vl&&l!==536870912&&(a.flags|=128,u=!0,Hr(p,!1),a.lanes=4194304);p.isBackwards?(m.sibling=a.child,a.child=m):(i=p.last,i!==null?i.sibling=m:a.child=m,p.last=m)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=Pn(),a.sibling=null,i=_e.current,W(_e,u?i&1|2:i&1),a):(Jt(a),null);case 22:case 23:return ai(a),uh(),u=a.memoizedState!==null,i!==null?i.memoizedState!==null!==u&&(a.flags|=8192):u&&(a.flags|=8192),u?(l&536870912)!==0&&(a.flags&128)===0&&(Jt(a),a.subtreeFlags&6&&(a.flags|=8192)):Jt(a),l=a.updateQueue,l!==null&&Ul(a,l.retryQueue),l=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),u=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),u!==l&&(a.flags|=2048),i!==null&&K(ms),null;case 24:return l=null,i!==null&&(l=i.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),ii(me),Jt(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function zS(i,a){switch(Ku(a),a.tag){case 1:return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return ii(me),In(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 26:case 27:case 5:return Ai(a),null;case 13:if(ai(a),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(n(340));Er()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return K(_e),null;case 4:return In(),null;case 10:return ii(a.type),null;case 22:case 23:return ai(a),uh(),i!==null&&K(ms),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 24:return ii(me),null;case 25:return null;default:return null}}function h_(i,a){switch(Ku(a),a.tag){case 3:ii(me),In();break;case 26:case 27:case 5:Ai(a);break;case 4:In();break;case 13:ai(a);break;case 19:K(_e);break;case 10:ii(a.type);break;case 22:case 23:ai(a),uh(),i!==null&&K(ms);break;case 24:ii(me)}}function zr(i,a){try{var l=a.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var p=u.next;l=p;do{if((l.tag&i)===i){u=void 0;var m=l.create,v=l.inst;u=m(),v.destroy=u}l=l.next}while(l!==p)}}catch(E){qt(a,a.return,E)}}function Oi(i,a,l){try{var u=a.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var m=p.next;u=m;do{if((u.tag&i)===i){var v=u.inst,E=v.destroy;if(E!==void 0){v.destroy=void 0,p=a;var R=l,H=E;try{H()}catch(V){qt(p,R,V)}}}u=u.next}while(u!==m)}}catch(V){qt(a,a.return,V)}}function d_(i){var a=i.updateQueue;if(a!==null){var l=i.stateNode;try{Jg(a,l)}catch(u){qt(i,i.return,u)}}}function f_(i,a,l){l.props=ys(i.type,i.memoizedProps),l.state=i.memoizedState;try{l.componentWillUnmount()}catch(u){qt(i,a,u)}}function Ur(i,a){try{var l=i.ref;if(l!==null){switch(i.tag){case 26:case 27:case 5:var u=i.stateNode;break;case 30:u=i.stateNode;break;default:u=i.stateNode}typeof l=="function"?i.refCleanup=l(u):l.current=u}}catch(p){qt(i,a,p)}}function Hn(i,a){var l=i.ref,u=i.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(p){qt(i,a,p)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){qt(i,a,p)}else l.current=null}function p_(i){var a=i.type,l=i.memoizedProps,u=i.stateNode;try{t:switch(a){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break t;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(p){qt(i,i.return,p)}}function Fh(i,a,l){try{var u=i.stateNode;oE(u,i.type,l,a),u[Ge]=a}catch(p){qt(i,i.return,p)}}function g_(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&zi(i.type)||i.tag===4}function Hh(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||g_(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&zi(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function zh(i,a,l){var u=i.tag;if(u===5||u===6)i=i.stateNode,a?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(i,a):(a=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,a.appendChild(i),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=Jl));else if(u!==4&&(u===27&&zi(i.type)&&(l=i.stateNode,a=null),i=i.child,i!==null))for(zh(i,a,l),i=i.sibling;i!==null;)zh(i,a,l),i=i.sibling}function jl(i,a,l){var u=i.tag;if(u===5||u===6)i=i.stateNode,a?l.insertBefore(i,a):l.appendChild(i);else if(u!==4&&(u===27&&zi(i.type)&&(l=i.stateNode),i=i.child,i!==null))for(jl(i,a,l),i=i.sibling;i!==null;)jl(i,a,l),i=i.sibling}function m_(i){var a=i.stateNode,l=i.memoizedProps;try{for(var u=i.type,p=a.attributes;p.length;)a.removeAttributeNode(p[0]);Re(a,u,l),a[Le]=i,a[Ge]=l}catch(m){qt(i,i.return,m)}}var li=!1,ae=!1,Uh=!1,__=typeof WeakSet=="function"?WeakSet:Set,ve=null;function US(i,a){if(i=i.containerInfo,hd=rc,i=Rg(i),Hu(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else t:{l=(l=i.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var p=u.anchorOffset,m=u.focusNode;u=u.focusOffset;try{l.nodeType,m.nodeType}catch{l=null;break t}var v=0,E=-1,R=-1,H=0,V=0,X=i,z=null;e:for(;;){for(var U;X!==l||p!==0&&X.nodeType!==3||(E=v+p),X!==m||u!==0&&X.nodeType!==3||(R=v+u),X.nodeType===3&&(v+=X.nodeValue.length),(U=X.firstChild)!==null;)z=X,X=U;for(;;){if(X===i)break e;if(z===l&&++H===p&&(E=v),z===m&&++V===u&&(R=v),(U=X.nextSibling)!==null)break;X=z,z=X.parentNode}X=U}l=E===-1||R===-1?null:{start:E,end:R}}else l=null}l=l||{start:0,end:0}}else l=null;for(dd={focusedElem:i,selectionRange:l},rc=!1,ve=a;ve!==null;)if(a=ve,i=a.child,(a.subtreeFlags&1024)!==0&&i!==null)i.return=a,ve=i;else for(;ve!==null;){switch(a=ve,m=a.alternate,i=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&m!==null){i=void 0,l=a,p=m.memoizedProps,m=m.memoizedState,u=l.stateNode;try{var pt=ys(l.type,p,l.elementType===l.type);i=u.getSnapshotBeforeUpdate(pt,m),u.__reactInternalSnapshotBeforeUpdate=i}catch(ht){qt(l,l.return,ht)}}break;case 3:if((i&1024)!==0){if(i=a.stateNode.containerInfo,l=i.nodeType,l===9)gd(i);else if(l===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":gd(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(n(163))}if(i=a.sibling,i!==null){i.return=a.return,ve=i;break}ve=a.return}}function y_(i,a,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:ki(i,l),u&4&&zr(5,l);break;case 1:if(ki(i,l),u&4)if(i=l.stateNode,a===null)try{i.componentDidMount()}catch(v){qt(l,l.return,v)}else{var p=ys(l.type,a.memoizedProps);a=a.memoizedState;try{i.componentDidUpdate(p,a,i.__reactInternalSnapshotBeforeUpdate)}catch(v){qt(l,l.return,v)}}u&64&&d_(l),u&512&&Ur(l,l.return);break;case 3:if(ki(i,l),u&64&&(i=l.updateQueue,i!==null)){if(a=null,l.child!==null)switch(l.child.tag){case 27:case 5:a=l.child.stateNode;break;case 1:a=l.child.stateNode}try{Jg(i,a)}catch(v){qt(l,l.return,v)}}break;case 27:a===null&&u&4&&m_(l);case 26:case 5:ki(i,l),a===null&&u&4&&p_(l),u&512&&Ur(l,l.return);break;case 12:ki(i,l);break;case 13:ki(i,l),u&4&&A_(i,l),u&64&&(i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(l=KS.bind(null,l),pE(i,l))));break;case 22:if(u=l.memoizedState!==null||li,!u){a=a!==null&&a.memoizedState!==null||ae,p=li;var m=ae;li=u,(ae=a)&&!m?Li(i,l,(l.subtreeFlags&8772)!==0):ki(i,l),li=p,ae=m}break;case 30:break;default:ki(i,l)}}function b_(i){var a=i.alternate;a!==null&&(i.alternate=null,b_(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&vu(a)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Kt=null,Ye=!1;function ci(i,a,l){for(l=l.child;l!==null;)v_(i,a,l),l=l.sibling}function v_(i,a,l){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(lr,l)}catch{}switch(l.tag){case 26:ae||Hn(l,a),ci(i,a,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:ae||Hn(l,a);var u=Kt,p=Ye;zi(l.type)&&(Kt=l.stateNode,Ye=!1),ci(i,a,l),Kr(l.stateNode),Kt=u,Ye=p;break;case 5:ae||Hn(l,a);case 6:if(u=Kt,p=Ye,Kt=null,ci(i,a,l),Kt=u,Ye=p,Kt!==null)if(Ye)try{(Kt.nodeType===9?Kt.body:Kt.nodeName==="HTML"?Kt.ownerDocument.body:Kt).removeChild(l.stateNode)}catch(m){qt(l,a,m)}else try{Kt.removeChild(l.stateNode)}catch(m){qt(l,a,m)}break;case 18:Kt!==null&&(Ye?(i=Kt,ly(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,l.stateNode),so(i)):ly(Kt,l.stateNode));break;case 4:u=Kt,p=Ye,Kt=l.stateNode.containerInfo,Ye=!0,ci(i,a,l),Kt=u,Ye=p;break;case 0:case 11:case 14:case 15:ae||Oi(2,l,a),ae||Oi(4,l,a),ci(i,a,l);break;case 1:ae||(Hn(l,a),u=l.stateNode,typeof u.componentWillUnmount=="function"&&f_(l,a,u)),ci(i,a,l);break;case 21:ci(i,a,l);break;case 22:ae=(u=ae)||l.memoizedState!==null,ci(i,a,l),ae=u;break;default:ci(i,a,l)}}function A_(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{so(i)}catch(l){qt(a,a.return,l)}}function jS(i){switch(i.tag){case 13:case 19:var a=i.stateNode;return a===null&&(a=i.stateNode=new __),a;case 22:return i=i.stateNode,a=i._retryCache,a===null&&(a=i._retryCache=new __),a;default:throw Error(n(435,i.tag))}}function jh(i,a){var l=jS(i);a.forEach(function(u){var p=QS.bind(null,i,u);l.has(u)||(l.add(u),u.then(p,p))})}function an(i,a){var l=a.deletions;if(l!==null)for(var u=0;u<l.length;u++){var p=l[u],m=i,v=a,E=v;t:for(;E!==null;){switch(E.tag){case 27:if(zi(E.type)){Kt=E.stateNode,Ye=!1;break t}break;case 5:Kt=E.stateNode,Ye=!1;break t;case 3:case 4:Kt=E.stateNode.containerInfo,Ye=!0;break t}E=E.return}if(Kt===null)throw Error(n(160));v_(m,v,p),Kt=null,Ye=!1,m=p.alternate,m!==null&&(m.return=null),p.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)S_(a,i),a=a.sibling}var Dn=null;function S_(i,a){var l=i.alternate,u=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:an(a,i),rn(i),u&4&&(Oi(3,i,i.return),zr(3,i),Oi(5,i,i.return));break;case 1:an(a,i),rn(i),u&512&&(ae||l===null||Hn(l,l.return)),u&64&&li&&(i=i.updateQueue,i!==null&&(u=i.callbacks,u!==null&&(l=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var p=Dn;if(an(a,i),rn(i),u&512&&(ae||l===null||Hn(l,l.return)),u&4){var m=l!==null?l.memoizedState:null;if(u=i.memoizedState,l===null)if(u===null)if(i.stateNode===null){t:{u=i.type,l=i.memoizedProps,p=p.ownerDocument||p;e:switch(u){case"title":m=p.getElementsByTagName("title")[0],(!m||m[hr]||m[Le]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=p.createElement(u),p.head.insertBefore(m,p.querySelector("head > title"))),Re(m,u,l),m[Le]=i,ye(m),u=m;break t;case"link":var v=my("link","href",p).get(u+(l.href||""));if(v){for(var E=0;E<v.length;E++)if(m=v[E],m.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&m.getAttribute("rel")===(l.rel==null?null:l.rel)&&m.getAttribute("title")===(l.title==null?null:l.title)&&m.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){v.splice(E,1);break e}}m=p.createElement(u),Re(m,u,l),p.head.appendChild(m);break;case"meta":if(v=my("meta","content",p).get(u+(l.content||""))){for(E=0;E<v.length;E++)if(m=v[E],m.getAttribute("content")===(l.content==null?null:""+l.content)&&m.getAttribute("name")===(l.name==null?null:l.name)&&m.getAttribute("property")===(l.property==null?null:l.property)&&m.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&m.getAttribute("charset")===(l.charSet==null?null:l.charSet)){v.splice(E,1);break e}}m=p.createElement(u),Re(m,u,l),p.head.appendChild(m);break;default:throw Error(n(468,u))}m[Le]=i,ye(m),u=m}i.stateNode=u}else _y(p,i.type,i.stateNode);else i.stateNode=gy(p,u,i.memoizedProps);else m!==u?(m===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):m.count--,u===null?_y(p,i.type,i.stateNode):gy(p,u,i.memoizedProps)):u===null&&i.stateNode!==null&&Fh(i,i.memoizedProps,l.memoizedProps)}break;case 27:an(a,i),rn(i),u&512&&(ae||l===null||Hn(l,l.return)),l!==null&&u&4&&Fh(i,i.memoizedProps,l.memoizedProps);break;case 5:if(an(a,i),rn(i),u&512&&(ae||l===null||Hn(l,l.return)),i.flags&32){p=i.stateNode;try{Qs(p,"")}catch(U){qt(i,i.return,U)}}u&4&&i.stateNode!=null&&(p=i.memoizedProps,Fh(i,p,l!==null?l.memoizedProps:p)),u&1024&&(Uh=!0);break;case 6:if(an(a,i),rn(i),u&4){if(i.stateNode===null)throw Error(n(162));u=i.memoizedProps,l=i.stateNode;try{l.nodeValue=u}catch(U){qt(i,i.return,U)}}break;case 3:if(ic=null,p=Dn,Dn=ec(a.containerInfo),an(a,i),Dn=p,rn(i),u&4&&l!==null&&l.memoizedState.isDehydrated)try{so(a.containerInfo)}catch(U){qt(i,i.return,U)}Uh&&(Uh=!1,E_(i));break;case 4:u=Dn,Dn=ec(i.stateNode.containerInfo),an(a,i),rn(i),Dn=u;break;case 12:an(a,i),rn(i);break;case 13:an(a,i),rn(i),i.child.flags&8192&&i.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&($h=Pn()),u&4&&(u=i.updateQueue,u!==null&&(i.updateQueue=null,jh(i,u)));break;case 22:p=i.memoizedState!==null;var R=l!==null&&l.memoizedState!==null,H=li,V=ae;if(li=H||p,ae=V||R,an(a,i),ae=V,li=H,rn(i),u&8192)t:for(a=i.stateNode,a._visibility=p?a._visibility&-2:a._visibility|1,p&&(l===null||R||li||ae||bs(i)),l=null,a=i;;){if(a.tag===5||a.tag===26){if(l===null){R=l=a;try{if(m=R.stateNode,p)v=m.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{E=R.stateNode;var X=R.memoizedProps.style,z=X!=null&&X.hasOwnProperty("display")?X.display:null;E.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(U){qt(R,R.return,U)}}}else if(a.tag===6){if(l===null){R=a;try{R.stateNode.nodeValue=p?"":R.memoizedProps}catch(U){qt(R,R.return,U)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===i)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break t;for(;a.sibling===null;){if(a.return===null||a.return===i)break t;l===a&&(l=null),a=a.return}l===a&&(l=null),a.sibling.return=a.return,a=a.sibling}u&4&&(u=i.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,jh(i,l))));break;case 19:an(a,i),rn(i),u&4&&(u=i.updateQueue,u!==null&&(i.updateQueue=null,jh(i,u)));break;case 30:break;case 21:break;default:an(a,i),rn(i)}}function rn(i){var a=i.flags;if(a&2){try{for(var l,u=i.return;u!==null;){if(g_(u)){l=u;break}u=u.return}if(l==null)throw Error(n(160));switch(l.tag){case 27:var p=l.stateNode,m=Hh(i);jl(i,m,p);break;case 5:var v=l.stateNode;l.flags&32&&(Qs(v,""),l.flags&=-33);var E=Hh(i);jl(i,E,v);break;case 3:case 4:var R=l.stateNode.containerInfo,H=Hh(i);zh(i,H,R);break;default:throw Error(n(161))}}catch(V){qt(i,i.return,V)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function E_(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var a=i;E_(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),i=i.sibling}}function ki(i,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)y_(i,a.alternate,a),a=a.sibling}function bs(i){for(i=i.child;i!==null;){var a=i;switch(a.tag){case 0:case 11:case 14:case 15:Oi(4,a,a.return),bs(a);break;case 1:Hn(a,a.return);var l=a.stateNode;typeof l.componentWillUnmount=="function"&&f_(a,a.return,l),bs(a);break;case 27:Kr(a.stateNode);case 26:case 5:Hn(a,a.return),bs(a);break;case 22:a.memoizedState===null&&bs(a);break;case 30:bs(a);break;default:bs(a)}i=i.sibling}}function Li(i,a,l){for(l=l&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var u=a.alternate,p=i,m=a,v=m.flags;switch(m.tag){case 0:case 11:case 15:Li(p,m,l),zr(4,m);break;case 1:if(Li(p,m,l),u=m,p=u.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(H){qt(u,u.return,H)}if(u=m,p=u.updateQueue,p!==null){var E=u.stateNode;try{var R=p.shared.hiddenCallbacks;if(R!==null)for(p.shared.hiddenCallbacks=null,p=0;p<R.length;p++)Zg(R[p],E)}catch(H){qt(u,u.return,H)}}l&&v&64&&d_(m),Ur(m,m.return);break;case 27:m_(m);case 26:case 5:Li(p,m,l),l&&u===null&&v&4&&p_(m),Ur(m,m.return);break;case 12:Li(p,m,l);break;case 13:Li(p,m,l),l&&v&4&&A_(p,m);break;case 22:m.memoizedState===null&&Li(p,m,l),Ur(m,m.return);break;case 30:break;default:Li(p,m,l)}a=a.sibling}}function Gh(i,a){var l=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==l&&(i!=null&&i.refCount++,l!=null&&Tr(l))}function Vh(i,a){i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Tr(i))}function zn(i,a,l,u){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)w_(i,a,l,u),a=a.sibling}function w_(i,a,l,u){var p=a.flags;switch(a.tag){case 0:case 11:case 15:zn(i,a,l,u),p&2048&&zr(9,a);break;case 1:zn(i,a,l,u);break;case 3:zn(i,a,l,u),p&2048&&(i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Tr(i)));break;case 12:if(p&2048){zn(i,a,l,u),i=a.stateNode;try{var m=a.memoizedProps,v=m.id,E=m.onPostCommit;typeof E=="function"&&E(v,a.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(R){qt(a,a.return,R)}}else zn(i,a,l,u);break;case 13:zn(i,a,l,u);break;case 23:break;case 22:m=a.stateNode,v=a.alternate,a.memoizedState!==null?m._visibility&2?zn(i,a,l,u):jr(i,a):m._visibility&2?zn(i,a,l,u):(m._visibility|=2,ma(i,a,l,u,(a.subtreeFlags&10256)!==0)),p&2048&&Gh(v,a);break;case 24:zn(i,a,l,u),p&2048&&Vh(a.alternate,a);break;default:zn(i,a,l,u)}}function ma(i,a,l,u,p){for(p=p&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var m=i,v=a,E=l,R=u,H=v.flags;switch(v.tag){case 0:case 11:case 15:ma(m,v,E,R,p),zr(8,v);break;case 23:break;case 22:var V=v.stateNode;v.memoizedState!==null?V._visibility&2?ma(m,v,E,R,p):jr(m,v):(V._visibility|=2,ma(m,v,E,R,p)),p&&H&2048&&Gh(v.alternate,v);break;case 24:ma(m,v,E,R,p),p&&H&2048&&Vh(v.alternate,v);break;default:ma(m,v,E,R,p)}a=a.sibling}}function jr(i,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var l=i,u=a,p=u.flags;switch(u.tag){case 22:jr(l,u),p&2048&&Gh(u.alternate,u);break;case 24:jr(l,u),p&2048&&Vh(u.alternate,u);break;default:jr(l,u)}a=a.sibling}}var Gr=8192;function _a(i){if(i.subtreeFlags&Gr)for(i=i.child;i!==null;)C_(i),i=i.sibling}function C_(i){switch(i.tag){case 26:_a(i),i.flags&Gr&&i.memoizedState!==null&&xE(Dn,i.memoizedState,i.memoizedProps);break;case 5:_a(i);break;case 3:case 4:var a=Dn;Dn=ec(i.stateNode.containerInfo),_a(i),Dn=a;break;case 22:i.memoizedState===null&&(a=i.alternate,a!==null&&a.memoizedState!==null?(a=Gr,Gr=16777216,_a(i),Gr=a):_a(i));break;default:_a(i)}}function T_(i){var a=i.alternate;if(a!==null&&(i=a.child,i!==null)){a.child=null;do a=i.sibling,i.sibling=null,i=a;while(i!==null)}}function Vr(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var u=a[l];ve=u,R_(u,i)}T_(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)x_(i),i=i.sibling}function x_(i){switch(i.tag){case 0:case 11:case 15:Vr(i),i.flags&2048&&Oi(9,i,i.return);break;case 3:Vr(i);break;case 12:Vr(i);break;case 22:var a=i.stateNode;i.memoizedState!==null&&a._visibility&2&&(i.return===null||i.return.tag!==13)?(a._visibility&=-3,Gl(i)):Vr(i);break;default:Vr(i)}}function Gl(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var u=a[l];ve=u,R_(u,i)}T_(i)}for(i=i.child;i!==null;){switch(a=i,a.tag){case 0:case 11:case 15:Oi(8,a,a.return),Gl(a);break;case 22:l=a.stateNode,l._visibility&2&&(l._visibility&=-3,Gl(a));break;default:Gl(a)}i=i.sibling}}function R_(i,a){for(;ve!==null;){var l=ve;switch(l.tag){case 0:case 11:case 15:Oi(8,l,a);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Tr(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,ve=u;else t:for(l=i;ve!==null;){u=ve;var p=u.sibling,m=u.return;if(b_(u),u===l){ve=null;break t}if(p!==null){p.return=m,ve=p;break t}ve=m}}}var GS={getCacheForType:function(i){var a=Ie(me),l=a.data.get(i);return l===void 0&&(l=i(),a.data.set(i,l)),l}},VS=typeof WeakMap=="function"?WeakMap:Map,Ft=0,Xt=null,Dt=null,kt=0,Ht=0,on=null,Ii=!1,ya=!1,qh=!1,ui=0,ie=0,Pi=0,vs=0,Yh=0,bn=0,ba=0,qr=null,Xe=null,Xh=!1,$h=0,Vl=1/0,ql=null,Bi=null,xe=0,Fi=null,va=null,Aa=0,Wh=0,Kh=null,D_=null,Yr=0,Qh=null;function ln(){if((Ft&2)!==0&&kt!==0)return kt&-kt;if(P.T!==null){var i=la;return i!==0?i:sd()}return qp()}function M_(){bn===0&&(bn=(kt&536870912)===0||It?Up():536870912);var i=yn.current;return i!==null&&(i.flags|=32),bn}function cn(i,a,l){(i===Xt&&(Ht===2||Ht===9)||i.cancelPendingCommit!==null)&&(Sa(i,0),Hi(i,kt,bn,!1)),ur(i,l),((Ft&2)===0||i!==Xt)&&(i===Xt&&((Ft&2)===0&&(vs|=l),ie===4&&Hi(i,kt,bn,!1)),Un(i))}function N_(i,a,l){if((Ft&6)!==0)throw Error(n(327));var u=!l&&(a&124)===0&&(a&i.expiredLanes)===0||cr(i,a),p=u?XS(i,a):td(i,a,!0),m=u;do{if(p===0){ya&&!u&&Hi(i,a,0,!1);break}else{if(l=i.current.alternate,m&&!qS(l)){p=td(i,a,!1),m=!1;continue}if(p===2){if(m=a,i.errorRecoveryDisabledLanes&m)var v=0;else v=i.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){a=v;t:{var E=i;p=qr;var R=E.current.memoizedState.isDehydrated;if(R&&(Sa(E,v).flags|=256),v=td(E,v,!1),v!==2){if(qh&&!R){E.errorRecoveryDisabledLanes|=m,vs|=m,p=4;break t}m=Xe,Xe=p,m!==null&&(Xe===null?Xe=m:Xe.push.apply(Xe,m))}p=v}if(m=!1,p!==2)continue}}if(p===1){Sa(i,0),Hi(i,a,0,!0);break}t:{switch(u=i,m=p,m){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Hi(u,a,bn,!Ii);break t;case 2:Xe=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(p=$h+300-Pn(),10<p)){if(Hi(u,a,bn,!Ii),nl(u,0,!0)!==0)break t;u.timeoutHandle=ry(O_.bind(null,u,l,Xe,ql,Xh,a,bn,vs,ba,Ii,m,2,-0,0),p);break t}O_(u,l,Xe,ql,Xh,a,bn,vs,ba,Ii,m,0,-0,0)}}break}while(!0);Un(i)}function O_(i,a,l,u,p,m,v,E,R,H,V,X,z,U){if(i.timeoutHandle=-1,X=a.subtreeFlags,(X&8192||(X&16785408)===16785408)&&(Jr={stylesheets:null,count:0,unsuspend:TE},C_(a),X=RE(),X!==null)){i.cancelPendingCommit=X(H_.bind(null,i,a,m,l,u,p,v,E,R,V,1,z,U)),Hi(i,m,v,!H);return}H_(i,a,m,l,u,p,v,E,R)}function qS(i){for(var a=i;;){var l=a.tag;if((l===0||l===11||l===15)&&a.flags&16384&&(l=a.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var p=l[u],m=p.getSnapshot;p=p.value;try{if(!nn(m(),p))return!1}catch{return!1}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Hi(i,a,l,u){a&=~Yh,a&=~vs,i.suspendedLanes|=a,i.pingedLanes&=~a,u&&(i.warmLanes|=a),u=i.expirationTimes;for(var p=a;0<p;){var m=31-en(p),v=1<<m;u[m]=-1,p&=~v}l!==0&&Gp(i,l,a)}function Yl(){return(Ft&6)===0?(Xr(0),!1):!0}function Zh(){if(Dt!==null){if(Ht===0)var i=Dt.return;else i=Dt,ni=ps=null,gh(i),pa=null,Br=0,i=Dt;for(;i!==null;)h_(i.alternate,i),i=i.return;Dt=null}}function Sa(i,a){var l=i.timeoutHandle;l!==-1&&(i.timeoutHandle=-1,cE(l)),l=i.cancelPendingCommit,l!==null&&(i.cancelPendingCommit=null,l()),Zh(),Xt=i,Dt=l=Jn(i.current,null),kt=a,Ht=0,on=null,Ii=!1,ya=cr(i,a),qh=!1,ba=bn=Yh=vs=Pi=ie=0,Xe=qr=null,Xh=!1,(a&8)!==0&&(a|=a&32);var u=i.entangledLanes;if(u!==0)for(i=i.entanglements,u&=a;0<u;){var p=31-en(u),m=1<<p;a|=i[p],u&=~m}return ui=a,pl(),l}function k_(i,a){Et=null,P.H=kl,a===Rr||a===El?(a=Kg(),Ht=3):a===Xg?(a=Kg(),Ht=4):Ht=a===Qm?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,on=a,Dt===null&&(ie=1,Fl(i,pn(a,i.current)))}function L_(){var i=P.H;return P.H=kl,i===null?kl:i}function I_(){var i=P.A;return P.A=GS,i}function Jh(){ie=4,Ii||(kt&4194048)!==kt&&yn.current!==null||(ya=!0),(Pi&134217727)===0&&(vs&134217727)===0||Xt===null||Hi(Xt,kt,bn,!1)}function td(i,a,l){var u=Ft;Ft|=2;var p=L_(),m=I_();(Xt!==i||kt!==a)&&(ql=null,Sa(i,a)),a=!1;var v=ie;t:do try{if(Ht!==0&&Dt!==null){var E=Dt,R=on;switch(Ht){case 8:Zh(),v=6;break t;case 3:case 2:case 9:case 6:yn.current===null&&(a=!0);var H=Ht;if(Ht=0,on=null,Ea(i,E,R,H),l&&ya){v=0;break t}break;default:H=Ht,Ht=0,on=null,Ea(i,E,R,H)}}YS(),v=ie;break}catch(V){k_(i,V)}while(!0);return a&&i.shellSuspendCounter++,ni=ps=null,Ft=u,P.H=p,P.A=m,Dt===null&&(Xt=null,kt=0,pl()),v}function YS(){for(;Dt!==null;)P_(Dt)}function XS(i,a){var l=Ft;Ft|=2;var u=L_(),p=I_();Xt!==i||kt!==a?(ql=null,Vl=Pn()+500,Sa(i,a)):ya=cr(i,a);t:do try{if(Ht!==0&&Dt!==null){a=Dt;var m=on;e:switch(Ht){case 1:Ht=0,on=null,Ea(i,a,m,1);break;case 2:case 9:if($g(m)){Ht=0,on=null,B_(a);break}a=function(){Ht!==2&&Ht!==9||Xt!==i||(Ht=7),Un(i)},m.then(a,a);break t;case 3:Ht=7;break t;case 4:Ht=5;break t;case 7:$g(m)?(Ht=0,on=null,B_(a)):(Ht=0,on=null,Ea(i,a,m,7));break;case 5:var v=null;switch(Dt.tag){case 26:v=Dt.memoizedState;case 5:case 27:var E=Dt;if(!v||yy(v)){Ht=0,on=null;var R=E.sibling;if(R!==null)Dt=R;else{var H=E.return;H!==null?(Dt=H,Xl(H)):Dt=null}break e}}Ht=0,on=null,Ea(i,a,m,5);break;case 6:Ht=0,on=null,Ea(i,a,m,6);break;case 8:Zh(),ie=6;break t;default:throw Error(n(462))}}$S();break}catch(V){k_(i,V)}while(!0);return ni=ps=null,P.H=u,P.A=p,Ft=l,Dt!==null?0:(Xt=null,kt=0,pl(),ie)}function $S(){for(;Dt!==null&&!mA();)P_(Dt)}function P_(i){var a=c_(i.alternate,i,ui);i.memoizedProps=i.pendingProps,a===null?Xl(i):Dt=a}function B_(i){var a=i,l=a.alternate;switch(a.tag){case 15:case 0:a=i_(l,a,a.pendingProps,a.type,void 0,kt);break;case 11:a=i_(l,a,a.pendingProps,a.type.render,a.ref,kt);break;case 5:gh(a);default:h_(l,a),a=Dt=Fg(a,ui),a=c_(l,a,ui)}i.memoizedProps=i.pendingProps,a===null?Xl(i):Dt=a}function Ea(i,a,l,u){ni=ps=null,gh(a),pa=null,Br=0;var p=a.return;try{if(BS(i,p,a,l,kt)){ie=1,Fl(i,pn(l,i.current)),Dt=null;return}}catch(m){if(p!==null)throw Dt=p,m;ie=1,Fl(i,pn(l,i.current)),Dt=null;return}a.flags&32768?(It||u===1?i=!0:ya||(kt&536870912)!==0?i=!1:(Ii=i=!0,(u===2||u===9||u===3||u===6)&&(u=yn.current,u!==null&&u.tag===13&&(u.flags|=16384))),F_(a,i)):Xl(a)}function Xl(i){var a=i;do{if((a.flags&32768)!==0){F_(a,Ii);return}i=a.return;var l=HS(a.alternate,a,ui);if(l!==null){Dt=l;return}if(a=a.sibling,a!==null){Dt=a;return}Dt=a=i}while(a!==null);ie===0&&(ie=5)}function F_(i,a){do{var l=zS(i.alternate,i);if(l!==null){l.flags&=32767,Dt=l;return}if(l=i.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!a&&(i=i.sibling,i!==null)){Dt=i;return}Dt=i=l}while(i!==null);ie=6,Dt=null}function H_(i,a,l,u,p,m,v,E,R){i.cancelPendingCommit=null;do $l();while(xe!==0);if((Ft&6)!==0)throw Error(n(327));if(a!==null){if(a===i.current)throw Error(n(177));if(m=a.lanes|a.childLanes,m|=Vu,TA(i,l,m,v,E,R),i===Xt&&(Dt=Xt=null,kt=0),va=a,Fi=i,Aa=l,Wh=m,Kh=p,D_=u,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,ZS(Jo,function(){return V_(),null})):(i.callbackNode=null,i.callbackPriority=0),u=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||u){u=P.T,P.T=null,p=L.p,L.p=2,v=Ft,Ft|=4;try{US(i,a,l)}finally{Ft=v,L.p=p,P.T=u}}xe=1,z_(),U_(),j_()}}function z_(){if(xe===1){xe=0;var i=Fi,a=va,l=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||l){l=P.T,P.T=null;var u=L.p;L.p=2;var p=Ft;Ft|=4;try{S_(a,i);var m=dd,v=Rg(i.containerInfo),E=m.focusedElem,R=m.selectionRange;if(v!==E&&E&&E.ownerDocument&&xg(E.ownerDocument.documentElement,E)){if(R!==null&&Hu(E)){var H=R.start,V=R.end;if(V===void 0&&(V=H),"selectionStart"in E)E.selectionStart=H,E.selectionEnd=Math.min(V,E.value.length);else{var X=E.ownerDocument||document,z=X&&X.defaultView||window;if(z.getSelection){var U=z.getSelection(),pt=E.textContent.length,ht=Math.min(R.start,pt),Gt=R.end===void 0?ht:Math.min(R.end,pt);!U.extend&&ht>Gt&&(v=Gt,Gt=ht,ht=v);var I=Tg(E,ht),k=Tg(E,Gt);if(I&&k&&(U.rangeCount!==1||U.anchorNode!==I.node||U.anchorOffset!==I.offset||U.focusNode!==k.node||U.focusOffset!==k.offset)){var F=X.createRange();F.setStart(I.node,I.offset),U.removeAllRanges(),ht>Gt?(U.addRange(F),U.extend(k.node,k.offset)):(F.setEnd(k.node,k.offset),U.addRange(F))}}}}for(X=[],U=E;U=U.parentNode;)U.nodeType===1&&X.push({element:U,left:U.scrollLeft,top:U.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<X.length;E++){var Y=X[E];Y.element.scrollLeft=Y.left,Y.element.scrollTop=Y.top}}rc=!!hd,dd=hd=null}finally{Ft=p,L.p=u,P.T=l}}i.current=a,xe=2}}function U_(){if(xe===2){xe=0;var i=Fi,a=va,l=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||l){l=P.T,P.T=null;var u=L.p;L.p=2;var p=Ft;Ft|=4;try{y_(i,a.alternate,a)}finally{Ft=p,L.p=u,P.T=l}}xe=3}}function j_(){if(xe===4||xe===3){xe=0,_A();var i=Fi,a=va,l=Aa,u=D_;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?xe=5:(xe=0,va=Fi=null,G_(i,i.pendingLanes));var p=i.pendingLanes;if(p===0&&(Bi=null),yu(l),a=a.stateNode,tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(lr,a,void 0,(a.current.flags&128)===128)}catch{}if(u!==null){a=P.T,p=L.p,L.p=2,P.T=null;try{for(var m=i.onRecoverableError,v=0;v<u.length;v++){var E=u[v];m(E.value,{componentStack:E.stack})}}finally{P.T=a,L.p=p}}(Aa&3)!==0&&$l(),Un(i),p=i.pendingLanes,(l&4194090)!==0&&(p&42)!==0?i===Qh?Yr++:(Yr=0,Qh=i):Yr=0,Xr(0)}}function G_(i,a){(i.pooledCacheLanes&=a)===0&&(a=i.pooledCache,a!=null&&(i.pooledCache=null,Tr(a)))}function $l(i){return z_(),U_(),j_(),V_()}function V_(){if(xe!==5)return!1;var i=Fi,a=Wh;Wh=0;var l=yu(Aa),u=P.T,p=L.p;try{L.p=32>l?32:l,P.T=null,l=Kh,Kh=null;var m=Fi,v=Aa;if(xe=0,va=Fi=null,Aa=0,(Ft&6)!==0)throw Error(n(331));var E=Ft;if(Ft|=4,x_(m.current),w_(m,m.current,v,l),Ft=E,Xr(0,!1),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(lr,m)}catch{}return!0}finally{L.p=p,P.T=u,G_(i,a)}}function q_(i,a,l){a=pn(l,a),a=Dh(i.stateNode,a,2),i=Ri(i,a,2),i!==null&&(ur(i,2),Un(i))}function qt(i,a,l){if(i.tag===3)q_(i,i,l);else for(;a!==null;){if(a.tag===3){q_(a,i,l);break}else if(a.tag===1){var u=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Bi===null||!Bi.has(u))){i=pn(l,i),l=Wm(2),u=Ri(a,l,2),u!==null&&(Km(l,u,a,i),ur(u,2),Un(u));break}}a=a.return}}function ed(i,a,l){var u=i.pingCache;if(u===null){u=i.pingCache=new VS;var p=new Set;u.set(a,p)}else p=u.get(a),p===void 0&&(p=new Set,u.set(a,p));p.has(l)||(qh=!0,p.add(l),i=WS.bind(null,i,a,l),a.then(i,i))}function WS(i,a,l){var u=i.pingCache;u!==null&&u.delete(a),i.pingedLanes|=i.suspendedLanes&l,i.warmLanes&=~l,Xt===i&&(kt&l)===l&&(ie===4||ie===3&&(kt&62914560)===kt&&300>Pn()-$h?(Ft&2)===0&&Sa(i,0):Yh|=l,ba===kt&&(ba=0)),Un(i)}function Y_(i,a){a===0&&(a=jp()),i=sa(i,a),i!==null&&(ur(i,a),Un(i))}function KS(i){var a=i.memoizedState,l=0;a!==null&&(l=a.retryLane),Y_(i,l)}function QS(i,a){var l=0;switch(i.tag){case 13:var u=i.stateNode,p=i.memoizedState;p!==null&&(l=p.retryLane);break;case 19:u=i.stateNode;break;case 22:u=i.stateNode._retryCache;break;default:throw Error(n(314))}u!==null&&u.delete(a),Y_(i,l)}function ZS(i,a){return Gs(i,a)}var Wl=null,wa=null,nd=!1,Kl=!1,id=!1,As=0;function Un(i){i!==wa&&i.next===null&&(wa===null?Wl=wa=i:wa=wa.next=i),Kl=!0,nd||(nd=!0,tE())}function Xr(i,a){if(!id&&Kl){id=!0;do for(var l=!1,u=Wl;u!==null;){if(i!==0){var p=u.pendingLanes;if(p===0)var m=0;else{var v=u.suspendedLanes,E=u.pingedLanes;m=(1<<31-en(42|i)+1)-1,m&=p&~(v&~E),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(l=!0,K_(u,m))}else m=kt,m=nl(u,u===Xt?m:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(m&3)===0||cr(u,m)||(l=!0,K_(u,m));u=u.next}while(l);id=!1}}function JS(){X_()}function X_(){Kl=nd=!1;var i=0;As!==0&&(lE()&&(i=As),As=0);for(var a=Pn(),l=null,u=Wl;u!==null;){var p=u.next,m=$_(u,a);m===0?(u.next=null,l===null?Wl=p:l.next=p,p===null&&(wa=l)):(l=u,(i!==0||(m&3)!==0)&&(Kl=!0)),u=p}Xr(i)}function $_(i,a){for(var l=i.suspendedLanes,u=i.pingedLanes,p=i.expirationTimes,m=i.pendingLanes&-62914561;0<m;){var v=31-en(m),E=1<<v,R=p[v];R===-1?((E&l)===0||(E&u)!==0)&&(p[v]=CA(E,a)):R<=a&&(i.expiredLanes|=E),m&=~E}if(a=Xt,l=kt,l=nl(i,i===a?l:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),u=i.callbackNode,l===0||i===a&&(Ht===2||Ht===9)||i.cancelPendingCommit!==null)return u!==null&&u!==null&&or(u),i.callbackNode=null,i.callbackPriority=0;if((l&3)===0||cr(i,l)){if(a=l&-l,a===i.callbackPriority)return a;switch(u!==null&&or(u),yu(l)){case 2:case 8:l=Hp;break;case 32:l=Jo;break;case 268435456:l=zp;break;default:l=Jo}return u=W_.bind(null,i),l=Gs(l,u),i.callbackPriority=a,i.callbackNode=l,a}return u!==null&&u!==null&&or(u),i.callbackPriority=2,i.callbackNode=null,2}function W_(i,a){if(xe!==0&&xe!==5)return i.callbackNode=null,i.callbackPriority=0,null;var l=i.callbackNode;if($l()&&i.callbackNode!==l)return null;var u=kt;return u=nl(i,i===Xt?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),u===0?null:(N_(i,u,a),$_(i,Pn()),i.callbackNode!=null&&i.callbackNode===l?W_.bind(null,i):null)}function K_(i,a){if($l())return null;N_(i,a,!0)}function tE(){uE(function(){(Ft&6)!==0?Gs(Fp,JS):X_()})}function sd(){return As===0&&(As=Up()),As}function Q_(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:ol(""+i)}function Z_(i,a){var l=a.ownerDocument.createElement("input");return l.name=a.name,l.value=a.value,i.id&&l.setAttribute("form",i.id),a.parentNode.insertBefore(l,a),i=new FormData(i),l.parentNode.removeChild(l),i}function eE(i,a,l,u,p){if(a==="submit"&&l&&l.stateNode===p){var m=Q_((p[Ge]||null).action),v=u.submitter;v&&(a=(a=v[Ge]||null)?Q_(a.formAction):v.getAttribute("formAction"),a!==null&&(m=a,v=null));var E=new hl("action","action",null,u,p);i.push({event:E,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(As!==0){var R=v?Z_(p,v):new FormData(p);wh(l,{pending:!0,data:R,method:p.method,action:m},null,R)}}else typeof m=="function"&&(E.preventDefault(),R=v?Z_(p,v):new FormData(p),wh(l,{pending:!0,data:R,method:p.method,action:m},m,R))},currentTarget:p}]})}}for(var ad=0;ad<Gu.length;ad++){var rd=Gu[ad],nE=rd.toLowerCase(),iE=rd[0].toUpperCase()+rd.slice(1);Rn(nE,"on"+iE)}Rn(Ng,"onAnimationEnd"),Rn(Og,"onAnimationIteration"),Rn(kg,"onAnimationStart"),Rn("dblclick","onDoubleClick"),Rn("focusin","onFocus"),Rn("focusout","onBlur"),Rn(vS,"onTransitionRun"),Rn(AS,"onTransitionStart"),Rn(SS,"onTransitionCancel"),Rn(Lg,"onTransitionEnd"),$s("onMouseEnter",["mouseout","mouseover"]),$s("onMouseLeave",["mouseout","mouseover"]),$s("onPointerEnter",["pointerout","pointerover"]),$s("onPointerLeave",["pointerout","pointerover"]),as("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),as("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),as("onBeforeInput",["compositionend","keypress","textInput","paste"]),as("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $r="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($r));function J_(i,a){a=(a&4)!==0;for(var l=0;l<i.length;l++){var u=i[l],p=u.event;u=u.listeners;t:{var m=void 0;if(a)for(var v=u.length-1;0<=v;v--){var E=u[v],R=E.instance,H=E.currentTarget;if(E=E.listener,R!==m&&p.isPropagationStopped())break t;m=E,p.currentTarget=H;try{m(p)}catch(V){Bl(V)}p.currentTarget=null,m=R}else for(v=0;v<u.length;v++){if(E=u[v],R=E.instance,H=E.currentTarget,E=E.listener,R!==m&&p.isPropagationStopped())break t;m=E,p.currentTarget=H;try{m(p)}catch(V){Bl(V)}p.currentTarget=null,m=R}}}}function Mt(i,a){var l=a[bu];l===void 0&&(l=a[bu]=new Set);var u=i+"__bubble";l.has(u)||(ty(a,i,2,!1),l.add(u))}function od(i,a,l){var u=0;a&&(u|=4),ty(l,i,u,a)}var Ql="_reactListening"+Math.random().toString(36).slice(2);function ld(i){if(!i[Ql]){i[Ql]=!0,Xp.forEach(function(l){l!=="selectionchange"&&(sE.has(l)||od(l,!1,i),od(l,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[Ql]||(a[Ql]=!0,od("selectionchange",!1,a))}}function ty(i,a,l,u){switch(wy(a)){case 2:var p=NE;break;case 8:p=OE;break;default:p=Sd}l=p.bind(null,a,l,i),p=void 0,!Mu||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(p=!0),u?p!==void 0?i.addEventListener(a,l,{capture:!0,passive:p}):i.addEventListener(a,l,!0):p!==void 0?i.addEventListener(a,l,{passive:p}):i.addEventListener(a,l,!1)}function cd(i,a,l,u,p){var m=u;if((a&1)===0&&(a&2)===0&&u!==null)t:for(;;){if(u===null)return;var v=u.tag;if(v===3||v===4){var E=u.stateNode.containerInfo;if(E===p)break;if(v===4)for(v=u.return;v!==null;){var R=v.tag;if((R===3||R===4)&&v.stateNode.containerInfo===p)return;v=v.return}for(;E!==null;){if(v=qs(E),v===null)return;if(R=v.tag,R===5||R===6||R===26||R===27){u=m=v;continue t}E=E.parentNode}}u=u.return}og(function(){var H=m,V=Ru(l),X=[];t:{var z=Ig.get(i);if(z!==void 0){var U=hl,pt=i;switch(i){case"keypress":if(cl(l)===0)break t;case"keydown":case"keyup":U=ZA;break;case"focusin":pt="focus",U=Lu;break;case"focusout":pt="blur",U=Lu;break;case"beforeblur":case"afterblur":U=Lu;break;case"click":if(l.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":U=ug;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":U=zA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":U=eS;break;case Ng:case Og:case kg:U=GA;break;case Lg:U=iS;break;case"scroll":case"scrollend":U=FA;break;case"wheel":U=aS;break;case"copy":case"cut":case"paste":U=qA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":U=dg;break;case"toggle":case"beforetoggle":U=oS}var ht=(a&4)!==0,Gt=!ht&&(i==="scroll"||i==="scrollend"),I=ht?z!==null?z+"Capture":null:z;ht=[];for(var k=H,F;k!==null;){var Y=k;if(F=Y.stateNode,Y=Y.tag,Y!==5&&Y!==26&&Y!==27||F===null||I===null||(Y=fr(k,I),Y!=null&&ht.push(Wr(k,Y,F))),Gt)break;k=k.return}0<ht.length&&(z=new U(z,pt,null,l,V),X.push({event:z,listeners:ht}))}}if((a&7)===0){t:{if(z=i==="mouseover"||i==="pointerover",U=i==="mouseout"||i==="pointerout",z&&l!==xu&&(pt=l.relatedTarget||l.fromElement)&&(qs(pt)||pt[Vs]))break t;if((U||z)&&(z=V.window===V?V:(z=V.ownerDocument)?z.defaultView||z.parentWindow:window,U?(pt=l.relatedTarget||l.toElement,U=H,pt=pt?qs(pt):null,pt!==null&&(Gt=o(pt),ht=pt.tag,pt!==Gt||ht!==5&&ht!==27&&ht!==6)&&(pt=null)):(U=null,pt=H),U!==pt)){if(ht=ug,Y="onMouseLeave",I="onMouseEnter",k="mouse",(i==="pointerout"||i==="pointerover")&&(ht=dg,Y="onPointerLeave",I="onPointerEnter",k="pointer"),Gt=U==null?z:dr(U),F=pt==null?z:dr(pt),z=new ht(Y,k+"leave",U,l,V),z.target=Gt,z.relatedTarget=F,Y=null,qs(V)===H&&(ht=new ht(I,k+"enter",pt,l,V),ht.target=F,ht.relatedTarget=Gt,Y=ht),Gt=Y,U&&pt)e:{for(ht=U,I=pt,k=0,F=ht;F;F=Ca(F))k++;for(F=0,Y=I;Y;Y=Ca(Y))F++;for(;0<k-F;)ht=Ca(ht),k--;for(;0<F-k;)I=Ca(I),F--;for(;k--;){if(ht===I||I!==null&&ht===I.alternate)break e;ht=Ca(ht),I=Ca(I)}ht=null}else ht=null;U!==null&&ey(X,z,U,ht,!1),pt!==null&&Gt!==null&&ey(X,Gt,pt,ht,!0)}}t:{if(z=H?dr(H):window,U=z.nodeName&&z.nodeName.toLowerCase(),U==="select"||U==="input"&&z.type==="file")var st=vg;else if(yg(z))if(Ag)st=_S;else{st=gS;var Ct=pS}else U=z.nodeName,!U||U.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?H&&Tu(H.elementType)&&(st=vg):st=mS;if(st&&(st=st(i,H))){bg(X,st,l,V);break t}Ct&&Ct(i,z,H),i==="focusout"&&H&&z.type==="number"&&H.memoizedProps.value!=null&&Cu(z,"number",z.value)}switch(Ct=H?dr(H):window,i){case"focusin":(yg(Ct)||Ct.contentEditable==="true")&&(ea=Ct,zu=H,Ar=null);break;case"focusout":Ar=zu=ea=null;break;case"mousedown":Uu=!0;break;case"contextmenu":case"mouseup":case"dragend":Uu=!1,Dg(X,l,V);break;case"selectionchange":if(bS)break;case"keydown":case"keyup":Dg(X,l,V)}var ot;if(Pu)t:{switch(i){case"compositionstart":var dt="onCompositionStart";break t;case"compositionend":dt="onCompositionEnd";break t;case"compositionupdate":dt="onCompositionUpdate";break t}dt=void 0}else ta?mg(i,l)&&(dt="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(dt="onCompositionStart");dt&&(fg&&l.locale!=="ko"&&(ta||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&ta&&(ot=lg()):(wi=V,Nu="value"in wi?wi.value:wi.textContent,ta=!0)),Ct=Zl(H,dt),0<Ct.length&&(dt=new hg(dt,i,null,l,V),X.push({event:dt,listeners:Ct}),ot?dt.data=ot:(ot=_g(l),ot!==null&&(dt.data=ot)))),(ot=cS?uS(i,l):hS(i,l))&&(dt=Zl(H,"onBeforeInput"),0<dt.length&&(Ct=new hg("onBeforeInput","beforeinput",null,l,V),X.push({event:Ct,listeners:dt}),Ct.data=ot)),eE(X,i,H,l,V)}J_(X,a)})}function Wr(i,a,l){return{instance:i,listener:a,currentTarget:l}}function Zl(i,a){for(var l=a+"Capture",u=[];i!==null;){var p=i,m=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||m===null||(p=fr(i,l),p!=null&&u.unshift(Wr(i,p,m)),p=fr(i,a),p!=null&&u.push(Wr(i,p,m))),i.tag===3)return u;i=i.return}return[]}function Ca(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function ey(i,a,l,u,p){for(var m=a._reactName,v=[];l!==null&&l!==u;){var E=l,R=E.alternate,H=E.stateNode;if(E=E.tag,R!==null&&R===u)break;E!==5&&E!==26&&E!==27||H===null||(R=H,p?(H=fr(l,m),H!=null&&v.unshift(Wr(l,H,R))):p||(H=fr(l,m),H!=null&&v.push(Wr(l,H,R)))),l=l.return}v.length!==0&&i.push({event:a,listeners:v})}var aE=/\r\n?/g,rE=/\u0000|\uFFFD/g;function ny(i){return(typeof i=="string"?i:""+i).replace(aE,`
`).replace(rE,"")}function iy(i,a){return a=ny(a),ny(i)===a}function Jl(){}function jt(i,a,l,u,p,m){switch(l){case"children":typeof u=="string"?a==="body"||a==="textarea"&&u===""||Qs(i,u):(typeof u=="number"||typeof u=="bigint")&&a!=="body"&&Qs(i,""+u);break;case"className":sl(i,"class",u);break;case"tabIndex":sl(i,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":sl(i,l,u);break;case"style":ag(i,u,m);break;case"data":if(a!=="object"){sl(i,"data",u);break}case"src":case"href":if(u===""&&(a!=="a"||l!=="href")){i.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){i.removeAttribute(l);break}u=ol(""+u),i.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){i.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(l==="formAction"?(a!=="input"&&jt(i,a,"name",p.name,p,null),jt(i,a,"formEncType",p.formEncType,p,null),jt(i,a,"formMethod",p.formMethod,p,null),jt(i,a,"formTarget",p.formTarget,p,null)):(jt(i,a,"encType",p.encType,p,null),jt(i,a,"method",p.method,p,null),jt(i,a,"target",p.target,p,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){i.removeAttribute(l);break}u=ol(""+u),i.setAttribute(l,u);break;case"onClick":u!=null&&(i.onclick=Jl);break;case"onScroll":u!=null&&Mt("scroll",i);break;case"onScrollEnd":u!=null&&Mt("scrollend",i);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(n(60));i.innerHTML=l}}break;case"multiple":i.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":i.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){i.removeAttribute("xlink:href");break}l=ol(""+u),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,""+u):i.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,""):i.removeAttribute(l);break;case"capture":case"download":u===!0?i.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?i.setAttribute(l,u):i.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?i.setAttribute(l,u):i.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?i.removeAttribute(l):i.setAttribute(l,u);break;case"popover":Mt("beforetoggle",i),Mt("toggle",i),il(i,"popover",u);break;case"xlinkActuate":Qn(i,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Qn(i,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Qn(i,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Qn(i,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Qn(i,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Qn(i,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Qn(i,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Qn(i,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Qn(i,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":il(i,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=PA.get(l)||l,il(i,l,u))}}function ud(i,a,l,u,p,m){switch(l){case"style":ag(i,u,m);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(n(60));i.innerHTML=l}}break;case"children":typeof u=="string"?Qs(i,u):(typeof u=="number"||typeof u=="bigint")&&Qs(i,""+u);break;case"onScroll":u!=null&&Mt("scroll",i);break;case"onScrollEnd":u!=null&&Mt("scrollend",i);break;case"onClick":u!=null&&(i.onclick=Jl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$p.hasOwnProperty(l))t:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),a=l.slice(2,p?l.length-7:void 0),m=i[Ge]||null,m=m!=null?m[l]:null,typeof m=="function"&&i.removeEventListener(a,m,p),typeof u=="function")){typeof m!="function"&&m!==null&&(l in i?i[l]=null:i.hasAttribute(l)&&i.removeAttribute(l)),i.addEventListener(a,u,p);break t}l in i?i[l]=u:u===!0?i.setAttribute(l,""):il(i,l,u)}}}function Re(i,a,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mt("error",i),Mt("load",i);var u=!1,p=!1,m;for(m in l)if(l.hasOwnProperty(m)){var v=l[m];if(v!=null)switch(m){case"src":u=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:jt(i,a,m,v,l,null)}}p&&jt(i,a,"srcSet",l.srcSet,l,null),u&&jt(i,a,"src",l.src,l,null);return;case"input":Mt("invalid",i);var E=m=v=p=null,R=null,H=null;for(u in l)if(l.hasOwnProperty(u)){var V=l[u];if(V!=null)switch(u){case"name":p=V;break;case"type":v=V;break;case"checked":R=V;break;case"defaultChecked":H=V;break;case"value":m=V;break;case"defaultValue":E=V;break;case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(n(137,a));break;default:jt(i,a,u,V,l,null)}}eg(i,m,E,R,H,v,p,!1),al(i);return;case"select":Mt("invalid",i),u=v=m=null;for(p in l)if(l.hasOwnProperty(p)&&(E=l[p],E!=null))switch(p){case"value":m=E;break;case"defaultValue":v=E;break;case"multiple":u=E;default:jt(i,a,p,E,l,null)}a=m,l=v,i.multiple=!!u,a!=null?Ks(i,!!u,a,!1):l!=null&&Ks(i,!!u,l,!0);return;case"textarea":Mt("invalid",i),m=p=u=null;for(v in l)if(l.hasOwnProperty(v)&&(E=l[v],E!=null))switch(v){case"value":u=E;break;case"defaultValue":p=E;break;case"children":m=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(n(91));break;default:jt(i,a,v,E,l,null)}ig(i,u,p,m),al(i);return;case"option":for(R in l)if(l.hasOwnProperty(R)&&(u=l[R],u!=null))switch(R){case"selected":i.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:jt(i,a,R,u,l,null)}return;case"dialog":Mt("beforetoggle",i),Mt("toggle",i),Mt("cancel",i),Mt("close",i);break;case"iframe":case"object":Mt("load",i);break;case"video":case"audio":for(u=0;u<$r.length;u++)Mt($r[u],i);break;case"image":Mt("error",i),Mt("load",i);break;case"details":Mt("toggle",i);break;case"embed":case"source":case"link":Mt("error",i),Mt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(H in l)if(l.hasOwnProperty(H)&&(u=l[H],u!=null))switch(H){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:jt(i,a,H,u,l,null)}return;default:if(Tu(a)){for(V in l)l.hasOwnProperty(V)&&(u=l[V],u!==void 0&&ud(i,a,V,u,l,void 0));return}}for(E in l)l.hasOwnProperty(E)&&(u=l[E],u!=null&&jt(i,a,E,u,l,null))}function oE(i,a,l,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,m=null,v=null,E=null,R=null,H=null,V=null;for(U in l){var X=l[U];if(l.hasOwnProperty(U)&&X!=null)switch(U){case"checked":break;case"value":break;case"defaultValue":R=X;default:u.hasOwnProperty(U)||jt(i,a,U,null,u,X)}}for(var z in u){var U=u[z];if(X=l[z],u.hasOwnProperty(z)&&(U!=null||X!=null))switch(z){case"type":m=U;break;case"name":p=U;break;case"checked":H=U;break;case"defaultChecked":V=U;break;case"value":v=U;break;case"defaultValue":E=U;break;case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(n(137,a));break;default:U!==X&&jt(i,a,z,U,u,X)}}wu(i,v,E,R,H,V,m,p);return;case"select":U=v=E=z=null;for(m in l)if(R=l[m],l.hasOwnProperty(m)&&R!=null)switch(m){case"value":break;case"multiple":U=R;default:u.hasOwnProperty(m)||jt(i,a,m,null,u,R)}for(p in u)if(m=u[p],R=l[p],u.hasOwnProperty(p)&&(m!=null||R!=null))switch(p){case"value":z=m;break;case"defaultValue":E=m;break;case"multiple":v=m;default:m!==R&&jt(i,a,p,m,u,R)}a=E,l=v,u=U,z!=null?Ks(i,!!l,z,!1):!!u!=!!l&&(a!=null?Ks(i,!!l,a,!0):Ks(i,!!l,l?[]:"",!1));return;case"textarea":U=z=null;for(E in l)if(p=l[E],l.hasOwnProperty(E)&&p!=null&&!u.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:jt(i,a,E,null,u,p)}for(v in u)if(p=u[v],m=l[v],u.hasOwnProperty(v)&&(p!=null||m!=null))switch(v){case"value":z=p;break;case"defaultValue":U=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(n(91));break;default:p!==m&&jt(i,a,v,p,u,m)}ng(i,z,U);return;case"option":for(var pt in l)if(z=l[pt],l.hasOwnProperty(pt)&&z!=null&&!u.hasOwnProperty(pt))switch(pt){case"selected":i.selected=!1;break;default:jt(i,a,pt,null,u,z)}for(R in u)if(z=u[R],U=l[R],u.hasOwnProperty(R)&&z!==U&&(z!=null||U!=null))switch(R){case"selected":i.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:jt(i,a,R,z,u,U)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ht in l)z=l[ht],l.hasOwnProperty(ht)&&z!=null&&!u.hasOwnProperty(ht)&&jt(i,a,ht,null,u,z);for(H in u)if(z=u[H],U=l[H],u.hasOwnProperty(H)&&z!==U&&(z!=null||U!=null))switch(H){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(n(137,a));break;default:jt(i,a,H,z,u,U)}return;default:if(Tu(a)){for(var Gt in l)z=l[Gt],l.hasOwnProperty(Gt)&&z!==void 0&&!u.hasOwnProperty(Gt)&&ud(i,a,Gt,void 0,u,z);for(V in u)z=u[V],U=l[V],!u.hasOwnProperty(V)||z===U||z===void 0&&U===void 0||ud(i,a,V,z,u,U);return}}for(var I in l)z=l[I],l.hasOwnProperty(I)&&z!=null&&!u.hasOwnProperty(I)&&jt(i,a,I,null,u,z);for(X in u)z=u[X],U=l[X],!u.hasOwnProperty(X)||z===U||z==null&&U==null||jt(i,a,X,z,u,U)}var hd=null,dd=null;function tc(i){return i.nodeType===9?i:i.ownerDocument}function sy(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ay(i,a){if(i===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&a==="foreignObject"?0:i}function fd(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var pd=null;function lE(){var i=window.event;return i&&i.type==="popstate"?i===pd?!1:(pd=i,!0):(pd=null,!1)}var ry=typeof setTimeout=="function"?setTimeout:void 0,cE=typeof clearTimeout=="function"?clearTimeout:void 0,oy=typeof Promise=="function"?Promise:void 0,uE=typeof queueMicrotask=="function"?queueMicrotask:typeof oy<"u"?function(i){return oy.resolve(null).then(i).catch(hE)}:ry;function hE(i){setTimeout(function(){throw i})}function zi(i){return i==="head"}function ly(i,a){var l=a,u=0,p=0;do{var m=l.nextSibling;if(i.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"){if(0<u&&8>u){l=u;var v=i.ownerDocument;if(l&1&&Kr(v.documentElement),l&2&&Kr(v.body),l&4)for(l=v.head,Kr(l),v=l.firstChild;v;){var E=v.nextSibling,R=v.nodeName;v[hr]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&v.rel.toLowerCase()==="stylesheet"||l.removeChild(v),v=E}}if(p===0){i.removeChild(m),so(a);return}p--}else l==="$"||l==="$?"||l==="$!"?p++:u=l.charCodeAt(0)-48;else u=0;l=m}while(l);so(a)}function gd(i){var a=i.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var l=a;switch(a=a.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":gd(l),vu(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}i.removeChild(l)}}function dE(i,a,l,u){for(;i.nodeType===1;){var p=l;if(i.nodeName.toLowerCase()!==a.toLowerCase()){if(!u&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(u){if(!i[hr])switch(a){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(m=i.getAttribute("rel"),m==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(m!==p.rel||i.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||i.getAttribute("title")!==(p.title==null?null:p.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(m=i.getAttribute("src"),(m!==(p.src==null?null:p.src)||i.getAttribute("type")!==(p.type==null?null:p.type)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&m&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(a==="input"&&i.type==="hidden"){var m=p.name==null?null:""+p.name;if(p.type==="hidden"&&i.getAttribute("name")===m)return i}else return i;if(i=Mn(i.nextSibling),i===null)break}return null}function fE(i,a,l){if(a==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!l||(i=Mn(i.nextSibling),i===null))return null;return i}function md(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function pE(i,a){var l=i.ownerDocument;if(i.data!=="$?"||l.readyState==="complete")a();else{var u=function(){a(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),i._reactRetry=u}}function Mn(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return i}var _d=null;function cy(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"){if(a===0)return i;a--}else l==="/$"&&a++}i=i.previousSibling}return null}function uy(i,a,l){switch(a=tc(l),i){case"html":if(i=a.documentElement,!i)throw Error(n(452));return i;case"head":if(i=a.head,!i)throw Error(n(453));return i;case"body":if(i=a.body,!i)throw Error(n(454));return i;default:throw Error(n(451))}}function Kr(i){for(var a=i.attributes;a.length;)i.removeAttributeNode(a[0]);vu(i)}var vn=new Map,hy=new Set;function ec(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var hi=L.d;L.d={f:gE,r:mE,D:_E,C:yE,L:bE,m:vE,X:SE,S:AE,M:EE};function gE(){var i=hi.f(),a=Yl();return i||a}function mE(i){var a=Ys(i);a!==null&&a.tag===5&&a.type==="form"?Nm(a):hi.r(i)}var Ta=typeof document>"u"?null:document;function dy(i,a,l){var u=Ta;if(u&&typeof a=="string"&&a){var p=fn(a);p='link[rel="'+i+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),hy.has(p)||(hy.add(p),i={rel:i,crossOrigin:l,href:a},u.querySelector(p)===null&&(a=u.createElement("link"),Re(a,"link",i),ye(a),u.head.appendChild(a)))}}function _E(i){hi.D(i),dy("dns-prefetch",i,null)}function yE(i,a){hi.C(i,a),dy("preconnect",i,a)}function bE(i,a,l){hi.L(i,a,l);var u=Ta;if(u&&i&&a){var p='link[rel="preload"][as="'+fn(a)+'"]';a==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+fn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+fn(l.imageSizes)+'"]')):p+='[href="'+fn(i)+'"]';var m=p;switch(a){case"style":m=xa(i);break;case"script":m=Ra(i)}vn.has(m)||(i=g({rel:"preload",href:a==="image"&&l&&l.imageSrcSet?void 0:i,as:a},l),vn.set(m,i),u.querySelector(p)!==null||a==="style"&&u.querySelector(Qr(m))||a==="script"&&u.querySelector(Zr(m))||(a=u.createElement("link"),Re(a,"link",i),ye(a),u.head.appendChild(a)))}}function vE(i,a){hi.m(i,a);var l=Ta;if(l&&i){var u=a&&typeof a.as=="string"?a.as:"script",p='link[rel="modulepreload"][as="'+fn(u)+'"][href="'+fn(i)+'"]',m=p;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Ra(i)}if(!vn.has(m)&&(i=g({rel:"modulepreload",href:i},a),vn.set(m,i),l.querySelector(p)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Zr(m)))return}u=l.createElement("link"),Re(u,"link",i),ye(u),l.head.appendChild(u)}}}function AE(i,a,l){hi.S(i,a,l);var u=Ta;if(u&&i){var p=Xs(u).hoistableStyles,m=xa(i);a=a||"default";var v=p.get(m);if(!v){var E={loading:0,preload:null};if(v=u.querySelector(Qr(m)))E.loading=5;else{i=g({rel:"stylesheet",href:i,"data-precedence":a},l),(l=vn.get(m))&&yd(i,l);var R=v=u.createElement("link");ye(R),Re(R,"link",i),R._p=new Promise(function(H,V){R.onload=H,R.onerror=V}),R.addEventListener("load",function(){E.loading|=1}),R.addEventListener("error",function(){E.loading|=2}),E.loading|=4,nc(v,a,u)}v={type:"stylesheet",instance:v,count:1,state:E},p.set(m,v)}}}function SE(i,a){hi.X(i,a);var l=Ta;if(l&&i){var u=Xs(l).hoistableScripts,p=Ra(i),m=u.get(p);m||(m=l.querySelector(Zr(p)),m||(i=g({src:i,async:!0},a),(a=vn.get(p))&&bd(i,a),m=l.createElement("script"),ye(m),Re(m,"link",i),l.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(p,m))}}function EE(i,a){hi.M(i,a);var l=Ta;if(l&&i){var u=Xs(l).hoistableScripts,p=Ra(i),m=u.get(p);m||(m=l.querySelector(Zr(p)),m||(i=g({src:i,async:!0,type:"module"},a),(a=vn.get(p))&&bd(i,a),m=l.createElement("script"),ye(m),Re(m,"link",i),l.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(p,m))}}function fy(i,a,l,u){var p=(p=ct.current)?ec(p):null;if(!p)throw Error(n(446));switch(i){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(a=xa(l.href),l=Xs(p).hoistableStyles,u=l.get(a),u||(u={type:"style",instance:null,count:0,state:null},l.set(a,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){i=xa(l.href);var m=Xs(p).hoistableStyles,v=m.get(i);if(v||(p=p.ownerDocument||p,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(i,v),(m=p.querySelector(Qr(i)))&&!m._p&&(v.instance=m,v.state.loading=5),vn.has(i)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},vn.set(i,l),m||wE(p,i,l,v.state))),a&&u===null)throw Error(n(528,""));return v}if(a&&u!==null)throw Error(n(529,""));return null;case"script":return a=l.async,l=l.src,typeof l=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Ra(l),l=Xs(p).hoistableScripts,u=l.get(a),u||(u={type:"script",instance:null,count:0,state:null},l.set(a,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,i))}}function xa(i){return'href="'+fn(i)+'"'}function Qr(i){return'link[rel="stylesheet"]['+i+"]"}function py(i){return g({},i,{"data-precedence":i.precedence,precedence:null})}function wE(i,a,l,u){i.querySelector('link[rel="preload"][as="style"]['+a+"]")?u.loading=1:(a=i.createElement("link"),u.preload=a,a.addEventListener("load",function(){return u.loading|=1}),a.addEventListener("error",function(){return u.loading|=2}),Re(a,"link",l),ye(a),i.head.appendChild(a))}function Ra(i){return'[src="'+fn(i)+'"]'}function Zr(i){return"script[async]"+i}function gy(i,a,l){if(a.count++,a.instance===null)switch(a.type){case"style":var u=i.querySelector('style[data-href~="'+fn(l.href)+'"]');if(u)return a.instance=u,ye(u),u;var p=g({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(i.ownerDocument||i).createElement("style"),ye(u),Re(u,"style",p),nc(u,l.precedence,i),a.instance=u;case"stylesheet":p=xa(l.href);var m=i.querySelector(Qr(p));if(m)return a.state.loading|=4,a.instance=m,ye(m),m;u=py(l),(p=vn.get(p))&&yd(u,p),m=(i.ownerDocument||i).createElement("link"),ye(m);var v=m;return v._p=new Promise(function(E,R){v.onload=E,v.onerror=R}),Re(m,"link",u),a.state.loading|=4,nc(m,l.precedence,i),a.instance=m;case"script":return m=Ra(l.src),(p=i.querySelector(Zr(m)))?(a.instance=p,ye(p),p):(u=l,(p=vn.get(m))&&(u=g({},l),bd(u,p)),i=i.ownerDocument||i,p=i.createElement("script"),ye(p),Re(p,"link",u),i.head.appendChild(p),a.instance=p);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(u=a.instance,a.state.loading|=4,nc(u,l.precedence,i));return a.instance}function nc(i,a,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=u.length?u[u.length-1]:null,m=p,v=0;v<u.length;v++){var E=u[v];if(E.dataset.precedence===a)m=E;else if(m!==p)break}m?m.parentNode.insertBefore(i,m.nextSibling):(a=l.nodeType===9?l.head:l,a.insertBefore(i,a.firstChild))}function yd(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.title==null&&(i.title=a.title)}function bd(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.integrity==null&&(i.integrity=a.integrity)}var ic=null;function my(i,a,l){if(ic===null){var u=new Map,p=ic=new Map;p.set(l,u)}else p=ic,u=p.get(l),u||(u=new Map,p.set(l,u));if(u.has(i))return u;for(u.set(i,null),l=l.getElementsByTagName(i),p=0;p<l.length;p++){var m=l[p];if(!(m[hr]||m[Le]||i==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var v=m.getAttribute(a)||"";v=i+v;var E=u.get(v);E?E.push(m):u.set(v,[m])}}return u}function _y(i,a,l){i=i.ownerDocument||i,i.head.insertBefore(l,a==="title"?i.querySelector("head > title"):null)}function CE(i,a,l){if(l===1||a.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return i=a.disabled,typeof a.precedence=="string"&&i==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function yy(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var Jr=null;function TE(){}function xE(i,a,l){if(Jr===null)throw Error(n(475));var u=Jr;if(a.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var p=xa(l.href),m=i.querySelector(Qr(p));if(m){i=m._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(u.count++,u=sc.bind(u),i.then(u,u)),a.state.loading|=4,a.instance=m,ye(m);return}m=i.ownerDocument||i,l=py(l),(p=vn.get(p))&&yd(l,p),m=m.createElement("link"),ye(m);var v=m;v._p=new Promise(function(E,R){v.onload=E,v.onerror=R}),Re(m,"link",l),a.instance=m}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(a,i),(i=a.state.preload)&&(a.state.loading&3)===0&&(u.count++,a=sc.bind(u),i.addEventListener("load",a),i.addEventListener("error",a))}}function RE(){if(Jr===null)throw Error(n(475));var i=Jr;return i.stylesheets&&i.count===0&&vd(i,i.stylesheets),0<i.count?function(a){var l=setTimeout(function(){if(i.stylesheets&&vd(i,i.stylesheets),i.unsuspend){var u=i.unsuspend;i.unsuspend=null,u()}},6e4);return i.unsuspend=a,function(){i.unsuspend=null,clearTimeout(l)}}:null}function sc(){if(this.count--,this.count===0){if(this.stylesheets)vd(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var ac=null;function vd(i,a){i.stylesheets=null,i.unsuspend!==null&&(i.count++,ac=new Map,a.forEach(DE,i),ac=null,sc.call(i))}function DE(i,a){if(!(a.state.loading&4)){var l=ac.get(i);if(l)var u=l.get(null);else{l=new Map,ac.set(i,l);for(var p=i.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<p.length;m++){var v=p[m];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(l.set(v.dataset.precedence,v),u=v)}u&&l.set(null,u)}p=a.instance,v=p.getAttribute("data-precedence"),m=l.get(v)||u,m===u&&l.set(null,p),l.set(v,p),this.count++,u=sc.bind(this),p.addEventListener("load",u),p.addEventListener("error",u),m?m.parentNode.insertBefore(p,m.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(p,i.firstChild)),a.state.loading|=4}}var to={$$typeof:x,Provider:null,Consumer:null,_currentValue:q,_currentValue2:q,_threadCount:0};function ME(i,a,l,u,p,m,v,E){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=mu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mu(0),this.hiddenUpdates=mu(null),this.identifierPrefix=u,this.onUncaughtError=p,this.onCaughtError=m,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=E,this.incompleteTransitions=new Map}function by(i,a,l,u,p,m,v,E,R,H,V,X){return i=new ME(i,a,l,v,E,R,H,X),a=1,m===!0&&(a|=24),m=sn(3,null,null,a),i.current=m,m.stateNode=i,a=eh(),a.refCount++,i.pooledCache=a,a.refCount++,m.memoizedState={element:u,isDehydrated:l,cache:a},ah(m),i}function vy(i){return i?(i=aa,i):aa}function Ay(i,a,l,u,p,m){p=vy(p),u.context===null?u.context=p:u.pendingContext=p,u=xi(a),u.payload={element:l},m=m===void 0?null:m,m!==null&&(u.callback=m),l=Ri(i,u,a),l!==null&&(cn(l,i,a),Mr(l,i,a))}function Sy(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<a?l:a}}function Ad(i,a){Sy(i,a),(i=i.alternate)&&Sy(i,a)}function Ey(i){if(i.tag===13){var a=sa(i,67108864);a!==null&&cn(a,i,67108864),Ad(i,67108864)}}var rc=!0;function NE(i,a,l,u){var p=P.T;P.T=null;var m=L.p;try{L.p=2,Sd(i,a,l,u)}finally{L.p=m,P.T=p}}function OE(i,a,l,u){var p=P.T;P.T=null;var m=L.p;try{L.p=8,Sd(i,a,l,u)}finally{L.p=m,P.T=p}}function Sd(i,a,l,u){if(rc){var p=Ed(u);if(p===null)cd(i,a,u,oc,l),Cy(i,u);else if(LE(p,i,a,l,u))u.stopPropagation();else if(Cy(i,u),a&4&&-1<kE.indexOf(i)){for(;p!==null;){var m=Ys(p);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var v=ss(m.pendingLanes);if(v!==0){var E=m;for(E.pendingLanes|=2,E.entangledLanes|=2;v;){var R=1<<31-en(v);E.entanglements[1]|=R,v&=~R}Un(m),(Ft&6)===0&&(Vl=Pn()+500,Xr(0))}}break;case 13:E=sa(m,2),E!==null&&cn(E,m,2),Yl(),Ad(m,2)}if(m=Ed(u),m===null&&cd(i,a,u,oc,l),m===p)break;p=m}p!==null&&u.stopPropagation()}else cd(i,a,u,null,l)}}function Ed(i){return i=Ru(i),wd(i)}var oc=null;function wd(i){if(oc=null,i=qs(i),i!==null){var a=o(i);if(a===null)i=null;else{var l=a.tag;if(l===13){if(i=c(a),i!==null)return i;i=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return oc=i,null}function wy(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(yA()){case Fp:return 2;case Hp:return 8;case Jo:case bA:return 32;case zp:return 268435456;default:return 32}default:return 32}}var Cd=!1,Ui=null,ji=null,Gi=null,eo=new Map,no=new Map,Vi=[],kE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Cy(i,a){switch(i){case"focusin":case"focusout":Ui=null;break;case"dragenter":case"dragleave":ji=null;break;case"mouseover":case"mouseout":Gi=null;break;case"pointerover":case"pointerout":eo.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(a.pointerId)}}function io(i,a,l,u,p,m){return i===null||i.nativeEvent!==m?(i={blockedOn:a,domEventName:l,eventSystemFlags:u,nativeEvent:m,targetContainers:[p]},a!==null&&(a=Ys(a),a!==null&&Ey(a)),i):(i.eventSystemFlags|=u,a=i.targetContainers,p!==null&&a.indexOf(p)===-1&&a.push(p),i)}function LE(i,a,l,u,p){switch(a){case"focusin":return Ui=io(Ui,i,a,l,u,p),!0;case"dragenter":return ji=io(ji,i,a,l,u,p),!0;case"mouseover":return Gi=io(Gi,i,a,l,u,p),!0;case"pointerover":var m=p.pointerId;return eo.set(m,io(eo.get(m)||null,i,a,l,u,p)),!0;case"gotpointercapture":return m=p.pointerId,no.set(m,io(no.get(m)||null,i,a,l,u,p)),!0}return!1}function Ty(i){var a=qs(i.target);if(a!==null){var l=o(a);if(l!==null){if(a=l.tag,a===13){if(a=c(l),a!==null){i.blockedOn=a,xA(i.priority,function(){if(l.tag===13){var u=ln();u=_u(u);var p=sa(l,u);p!==null&&cn(p,l,u),Ad(l,u)}});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function lc(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var l=Ed(i.nativeEvent);if(l===null){l=i.nativeEvent;var u=new l.constructor(l.type,l);xu=u,l.target.dispatchEvent(u),xu=null}else return a=Ys(l),a!==null&&Ey(a),i.blockedOn=l,!1;a.shift()}return!0}function xy(i,a,l){lc(i)&&l.delete(a)}function IE(){Cd=!1,Ui!==null&&lc(Ui)&&(Ui=null),ji!==null&&lc(ji)&&(ji=null),Gi!==null&&lc(Gi)&&(Gi=null),eo.forEach(xy),no.forEach(xy)}function cc(i,a){i.blockedOn===a&&(i.blockedOn=null,Cd||(Cd=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,IE)))}var uc=null;function Ry(i){uc!==i&&(uc=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){uc===i&&(uc=null);for(var a=0;a<i.length;a+=3){var l=i[a],u=i[a+1],p=i[a+2];if(typeof u!="function"){if(wd(u||l)===null)continue;break}var m=Ys(l);m!==null&&(i.splice(a,3),a-=3,wh(m,{pending:!0,data:p,method:l.method,action:u},u,p))}}))}function so(i){function a(R){return cc(R,i)}Ui!==null&&cc(Ui,i),ji!==null&&cc(ji,i),Gi!==null&&cc(Gi,i),eo.forEach(a),no.forEach(a);for(var l=0;l<Vi.length;l++){var u=Vi[l];u.blockedOn===i&&(u.blockedOn=null)}for(;0<Vi.length&&(l=Vi[0],l.blockedOn===null);)Ty(l),l.blockedOn===null&&Vi.shift();if(l=(i.ownerDocument||i).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var p=l[u],m=l[u+1],v=p[Ge]||null;if(typeof m=="function")v||Ry(l);else if(v){var E=null;if(m&&m.hasAttribute("formAction")){if(p=m,v=m[Ge]||null)E=v.formAction;else if(wd(p)!==null)continue}else E=v.action;typeof E=="function"?l[u+1]=E:(l.splice(u,3),u-=3),Ry(l)}}}function Td(i){this._internalRoot=i}hc.prototype.render=Td.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(n(409));var l=a.current,u=ln();Ay(l,u,i,a,null,null)},hc.prototype.unmount=Td.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Ay(i.current,2,null,i,null,null),Yl(),a[Vs]=null}};function hc(i){this._internalRoot=i}hc.prototype.unstable_scheduleHydration=function(i){if(i){var a=qp();i={blockedOn:null,target:i,priority:a};for(var l=0;l<Vi.length&&a!==0&&a<Vi[l].priority;l++);Vi.splice(l,0,i),l===0&&Ty(i)}};var Dy=t.version;if(Dy!=="19.1.1")throw Error(n(527,Dy,"19.1.1"));L.findDOMNode=function(i){var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=d(a),i=i!==null?f(i):null,i=i===null?null:i.stateNode,i};var PE={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dc.isDisabled&&dc.supportsFiber)try{lr=dc.inject(PE),tn=dc}catch{}}return ro.createRoot=function(i,a){if(!s(i))throw Error(n(299));var l=!1,u="",p=qm,m=Ym,v=Xm,E=null;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(p=a.onUncaughtError),a.onCaughtError!==void 0&&(m=a.onCaughtError),a.onRecoverableError!==void 0&&(v=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(E=a.unstable_transitionCallbacks)),a=by(i,1,!1,null,null,l,u,p,m,v,E,null),i[Vs]=a.current,ld(i),new Td(a)},ro.hydrateRoot=function(i,a,l){if(!s(i))throw Error(n(299));var u=!1,p="",m=qm,v=Ym,E=Xm,R=null,H=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(m=l.onUncaughtError),l.onCaughtError!==void 0&&(v=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(R=l.unstable_transitionCallbacks),l.formState!==void 0&&(H=l.formState)),a=by(i,1,!0,a,l??null,u,p,m,v,E,R,H),a.context=vy(null),l=a.current,u=ln(),u=_u(u),p=xi(u),p.callback=null,Ri(l,p,u),l=u,a.current.lanes=l,ur(a,l),Un(a),i[Vs]=a.current,ld(i),new hc(a)},ro.version="19.1.1",ro}var Uy;function YE(){if(Uy)return Md.exports;Uy=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Md.exports=qE(),Md.exports}var XE=YE();const ze=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ef=[.001,0,0,.001,0,0],Ld=1.35,un={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Xi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},cv="pdfjs_internal_editor_",_t={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Ot={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},$E={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},De={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Ec={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},de={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},ka={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Kc={ERRORS:0,WARNINGS:1,INFOS:5},To={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},fc={moveTo:0,lineTo:1,curveTo:2,closePath:3},WE={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Qc=Kc.WARNINGS;function KE(r){Number.isInteger(r)&&(Qc=r)}function QE(){return Qc}function Zc(r){Qc>=Kc.INFOS&&console.log(`Info: ${r}`)}function vt(r){Qc>=Kc.WARNINGS&&console.log(`Warning: ${r}`)}function Vt(r){throw new Error(r)}function ge(r,t){r||Vt(t)}function ZE(r){switch(r?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function uv(r,t=null,e=null){if(!r)return null;if(e&&typeof r=="string"&&(e.addDefaultProtocol&&r.startsWith("www.")&&r.match(/\./g)?.length>=2&&(r=`http://${r}`),e.tryConvertEncoding))try{r=iw(r)}catch{}const n=t?URL.parse(r,t):URL.parse(r);return ZE(n)?n:null}function hv(r,t,e=!1){const n=URL.parse(r);return n?(n.hash=t,n.href):e&&uv(r,"http://example.com")?r.split("#",1)[0]+`${t?`#${t}`:""}`:""}function Tt(r,t,e,n=!1){return Object.defineProperty(r,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}const Fs=(function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t})();class jy extends Fs{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Id extends Fs{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class nf extends Fs{constructor(t){super(t,"InvalidPDFException")}}class xc extends Fs{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class JE extends Fs{constructor(t){super(t,"FormatError")}}class Zi extends Fs{constructor(t){super(t,"AbortException")}}function dv(r){(typeof r!="object"||r?.length===void 0)&&Vt("Invalid argument for bytesToString");const t=r.length,e=8192;if(t<e)return String.fromCharCode.apply(null,r);const n=[];for(let s=0;s<t;s+=e){const o=Math.min(s+e,t),c=r.subarray(s,o);n.push(String.fromCharCode.apply(null,c))}return n.join("")}function Uo(r){typeof r!="string"&&Vt("Invalid argument for stringToBytes");const t=r.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=r.charCodeAt(n)&255;return e}function tw(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,r&255)}function ew(){const r=new Uint8Array(4);return r[0]=1,new Uint32Array(r.buffer,0,1)[0]===1}function nw(){try{return new Function(""),!0}catch{return!1}}class ke{static get isLittleEndian(){return Tt(this,"isLittleEndian",ew())}static get isEvalSupported(){return Tt(this,"isEvalSupported",nw())}static get isOffscreenCanvasSupported(){return Tt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Tt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return Tt(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return Tt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Pd=Array.from(Array(256).keys(),r=>r.toString(16).padStart(2,"0"));class at{static makeHexColor(t,e,n){return`#${Pd[t]}${Pd[e]}${Pd[n]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,n=0){const s=t[n],o=t[n+1];t[n]=s*e[0]+o*e[2]+e[4],t[n+1]=s*e[1]+o*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const s=e[0],o=e[1],c=e[2],h=e[3],d=e[4],f=e[5];for(let g=0;g<6;g+=2){const _=t[n+g],y=t[n+g+1];t[n+g]=_*s+y*c+d,t[n+g+1]=_*o+y*h+f}}static applyInverseTransform(t,e){const n=t[0],s=t[1],o=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-s*e[2]+e[2]*e[5]-e[4]*e[3])/o,t[1]=(-n*e[1]+s*e[0]+e[4]*e[1]-e[5]*e[0])/o}static axialAlignedBoundingBox(t,e,n){const s=e[0],o=e[1],c=e[2],h=e[3],d=e[4],f=e[5],g=t[0],_=t[1],y=t[2],b=t[3];let A=s*g+d,S=A,C=s*y+d,w=C,N=h*_+f,x=N,M=h*b+f,D=M;if(o!==0||c!==0){const O=o*g,B=o*y,j=c*_,$=c*b;A+=j,w+=j,C+=$,S+=$,N+=O,D+=O,M+=B,x+=B}n[0]=Math.min(n[0],A,C,S,w),n[1]=Math.min(n[1],N,M,x,D),n[2]=Math.max(n[2],A,C,S,w),n[3]=Math.max(n[3],N,M,x,D)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],s=t[1],o=t[2],c=t[3],h=n**2+s**2,d=n*o+s*c,f=o**2+c**2,g=(h+f)/2,_=Math.sqrt(g**2-(h*f-d**2));e[0]=Math.sqrt(g+_||1),e[1]=Math.sqrt(g-_||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>s)return null;const o=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),c=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return o>c?null:[n,o,s,c]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,s,o){o[0]=Math.min(o[0],t,n),o[1]=Math.min(o[1],e,s),o[2]=Math.max(o[2],t,n),o[3]=Math.max(o[3],e,s)}static#t(t,e,n,s,o,c,h,d,f,g){if(f<=0||f>=1)return;const _=1-f,y=f*f,b=y*f,A=_*(_*(_*t+3*f*e)+3*y*n)+b*s,S=_*(_*(_*o+3*f*c)+3*y*h)+b*d;g[0]=Math.min(g[0],A),g[1]=Math.min(g[1],S),g[2]=Math.max(g[2],A),g[3]=Math.max(g[3],S)}static#e(t,e,n,s,o,c,h,d,f,g,_,y){if(Math.abs(f)<1e-12){Math.abs(g)>=1e-12&&this.#t(t,e,n,s,o,c,h,d,-_/g,y);return}const b=g**2-4*_*f;if(b<0)return;const A=Math.sqrt(b),S=2*f;this.#t(t,e,n,s,o,c,h,d,(-g+A)/S,y),this.#t(t,e,n,s,o,c,h,d,(-g-A)/S,y)}static bezierBoundingBox(t,e,n,s,o,c,h,d,f){f[0]=Math.min(f[0],t,h),f[1]=Math.min(f[1],e,d),f[2]=Math.max(f[2],t,h),f[3]=Math.max(f[3],e,d),this.#e(t,n,o,h,e,s,c,d,3*(-t+3*(n-o)+h),6*(t-2*n+o),3*(n-t),f),this.#e(t,n,o,h,e,s,c,d,3*(-e+3*(s-c)+d),6*(e-2*s+c),3*(s-e),f)}}function iw(r){return decodeURIComponent(escape(r))}let Bd=null,Gy=null;function sw(r){return Bd||(Bd=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Gy=new Map([["ﬅ","ſt"]])),r.replaceAll(Bd,(t,e,n)=>e?e.normalize("NFKC"):Gy.get(n))}function fv(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const r=new Uint8Array(32);return crypto.getRandomValues(r),dv(r)}const Hf="pdfjs_internal_id_";function aw(r,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[n,s,...o]=e;if(!r(n)&&!Number.isInteger(n)||!t(s))return!1;const c=o.length;let h=!0;switch(s.name){case"XYZ":if(c<2||c>3)return!1;break;case"Fit":case"FitB":return c===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(c>1)return!1;break;case"FitR":if(c!==4)return!1;h=!1;break;default:return!1}for(const d of o)if(!(typeof d=="number"||h&&d===null))return!1;return!0}function Ue(r,t,e){return Math.min(Math.max(r,t),e)}function pv(r){return Uint8Array.prototype.toBase64?r.toBase64():btoa(dv(r))}function rw(r){return Uint8Array.fromBase64?Uint8Array.fromBase64(r):Uo(atob(r))}typeof Promise.try!="function"&&(Promise.try=function(r,...t){return new Promise(e=>{e(r(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(r){return r.reduce((t,e)=>t+e,0)});const di="http://www.w3.org/2000/svg";class Wa{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function jo(r,t="text"){if(mo(r,document.baseURI)){const e=await fetch(r);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{const s=new XMLHttpRequest;s.open("GET",r,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}class Go{constructor({viewBox:t,userUnit:e,scale:n,rotation:s,offsetX:o=0,offsetY:c=0,dontFlip:h=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=s,this.offsetX=o,this.offsetY=c,n*=e;const d=(t[2]+t[0])/2,f=(t[3]+t[1])/2;let g,_,y,b;switch(s%=360,s<0&&(s+=360),s){case 180:g=-1,_=0,y=0,b=1;break;case 90:g=0,_=1,y=1,b=0;break;case 270:g=0,_=-1,y=-1,b=0;break;case 0:g=1,_=0,y=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}h&&(y=-y,b=-b);let A,S,C,w;g===0?(A=Math.abs(f-t[1])*n+o,S=Math.abs(d-t[0])*n+c,C=(t[3]-t[1])*n,w=(t[2]-t[0])*n):(A=Math.abs(d-t[0])*n+o,S=Math.abs(f-t[1])*n+c,C=(t[2]-t[0])*n,w=(t[3]-t[1])*n),this.transform=[g*n,_*n,y*n,b*n,A-g*n*d-y*n*f,S-_*n*d-b*n*f],this.width=C,this.height=w}get rawDims(){const t=this.viewBox;return Tt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:o=!1}={}){return new Go({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:o})}convertToViewportPoint(t,e){const n=[t,e];return at.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];at.applyTransform(e,this.transform);const n=[t[2],t[3]];return at.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return at.applyInverseTransform(n,this.transform),n}}class zf extends Fs{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Jc(r){const t=r.length;let e=0;for(;e<t&&r[e].trim()==="";)e++;return r.substring(e,e+5).toLowerCase()==="data:"}function Uf(r){return typeof r=="string"&&/\.pdf$/i.test(r)}function ow(r){return[r]=r.split(/[#?]/,1),r.substring(r.lastIndexOf("/")+1)}function lw(r,t="document.pdf"){if(typeof r!="string")return t;if(Jc(r))return vt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(h=>{try{return new URL(h)}catch{try{return new URL(decodeURIComponent(h))}catch{try{return new URL(h,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(h),"https://foo.bar")}catch{return null}}}}})(r);if(!n)return t;const s=h=>{try{let d=decodeURIComponent(h);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:h):d}catch{return h}},o=/\.pdf$/i,c=n.pathname.split("/").at(-1);if(o.test(c))return s(c);if(n.searchParams.size>0){const h=Array.from(n.searchParams.values()).reverse();for(const f of h)if(o.test(f))return s(f);const d=Array.from(n.searchParams.keys()).reverse();for(const f of d)if(o.test(f))return s(f)}if(n.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(d)return s(d[0])}return t}class Vy{started=Object.create(null);times=[];time(t){t in this.started&&vt(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||vt(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:s,end:o}of this.times)t.push(`${n.padEnd(e)} ${o-s}ms
`);return t.join("")}}function mo(r,t){const e=t?URL.parse(r,t):URL.parse(r);return e?.protocol==="http:"||e?.protocol==="https:"}function xn(r){r.preventDefault()}function fe(r){r.preventDefault(),r.stopPropagation()}function cw(r){console.log("Deprecated API usage: "+r)}class sf{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const n=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let o=parseInt(e[3],10);o=o>=1&&o<=31?o:1;let c=parseInt(e[4],10);c=c>=0&&c<=23?c:0;let h=parseInt(e[5],10);h=h>=0&&h<=59?h:0;let d=parseInt(e[6],10);d=d>=0&&d<=59?d:0;const f=e[7]||"Z";let g=parseInt(e[8],10);g=g>=0&&g<=23?g:0;let _=parseInt(e[9],10)||0;return _=_>=0&&_<=59?_:0,f==="-"?(c+=g,h+=_):f==="+"&&(c-=g,h-=_),new Date(Date.UTC(n,s,o,c,h,d))}}function uw(r,{scale:t=1,rotation:e=0}){const{width:n,height:s}=r.attributes.style,o=[0,0,parseInt(n),parseInt(s)];return new Go({viewBox:o,userUnit:1,scale:t,rotation:e})}function tu(r){if(r.startsWith("#")){const t=parseInt(r.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return r.startsWith("rgb(")?r.slice(4,-1).split(",").map(t=>parseInt(t)):r.startsWith("rgba(")?r.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(vt(`Not a valid color format: "${r}"`),[0,0,0])}function hw(r){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of r.keys()){t.style.color=e;const n=window.getComputedStyle(t).color;r.set(e,tu(n))}t.remove()}function te(r){const{a:t,b:e,c:n,d:s,e:o,f:c}=r.getTransform();return[t,e,n,s,o,c]}function Vn(r){const{a:t,b:e,c:n,d:s,e:o,f:c}=r.getTransform().invertSelf();return[t,e,n,s,o,c]}function Os(r,t,e=!1,n=!0){if(t instanceof Go){const{pageWidth:s,pageHeight:o}=t.rawDims,{style:c}=r,h=ke.isCSSRoundSupported,d=`var(--total-scale-factor) * ${s}px`,f=`var(--total-scale-factor) * ${o}px`,g=h?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,_=h?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!e||t.rotation%180===0?(c.width=g,c.height=_):(c.width=_,c.height=g)}n&&r.setAttribute("data-main-rotation",t.rotation)}class Wn{constructor(){const{pixelRatio:t}=Wn;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,s,o=-1){let c=1/0,h=1/0,d=1/0;n=Wn.capPixels(n,o),n>0&&(c=Math.sqrt(n/(t*e))),s!==-1&&(h=s/t,d=s/e);const f=Math.min(c,h,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const af=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class bo{#t=null;#e=null;#n;#i=null;#a=null;#s=null;#r=null;static#o=null;constructor(t){this.#n=t,bo.#o||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#n._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",xn,{signal:e}),t.addEventListener("pointerdown",bo.#l,{signal:e}));const n=this.#i=document.createElement("div");n.className="buttons",t.append(n);const s=this.#n.toolbarPosition;if(s){const{style:o}=t,c=this.#n._uiManager.direction==="ltr"?1-s[0]:s[0];o.insetInlineEnd=`${100*c}%`,o.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#c(t){this.#n._focusEventsAllowed=!1,fe(t)}#d(t){this.#n._focusEventsAllowed=!0,fe(t)}#u(t){const e=this.#n._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#c.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",xn,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#s?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#n,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",bo.#o[t]),this.#u(n)&&n.addEventListener("click",s=>{e.delete()},{signal:e._signal}),this.#i.append(n)}get#f(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#u(e),this.#i.append(e,this.#f),this.#a=t}addComment(t){if(this.#s)return;const e=t.render();e&&(this.#u(e),this.#i.append(e,this.#f),this.#s=t,t.toolbar=this)}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#u(e),this.#i.append(e,this.#f)}async addEditSignatureButton(t){const e=this.#r=await t.renderEditButton(this.#n);this.#u(e),this.#i.append(e,this.#f)}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}updateEditSignatureButton(t){this.#r&&(this.#r.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class dw{#t=null;#e=null;#n;constructor(t){this.#n=t}#i(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#n._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",xn,{signal:e});const n=this.#t=document.createElement("div");return n.className="buttons",t.append(n),this.#n.hasCommentManager()&&this.#s("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#s("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),t}#a(t,e){let n=0,s=0;for(const o of t){const c=o.y+o.height;if(c<n)continue;const h=o.x+(e?o.width:0);if(c>n){s=h,n=c;continue}e?h>s&&(s=h):h<s&&(s=h)}return[e?1-s:s,n]}show(t,e,n){const[s,o]=this.#a(e,n),{style:c}=this.#e||=this.#i();t.append(this.#e),c.insetInlineEnd=`${100*s}%`,c.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#s(t,e,n,s){const o=document.createElement("button");o.classList.add("basic",t),o.tabIndex=0,o.setAttribute("data-l10n-id",e);const c=document.createElement("span");o.append(c),c.className="visuallyHidden",c.setAttribute("data-l10n-id",n);const h=this.#n._signal;h instanceof AbortSignal&&!h.aborted&&(o.addEventListener("contextmenu",xn,{signal:h}),o.addEventListener("click",s,{signal:h})),this.#t.append(o)}}function gv(r,t,e){for(const n of e)t.addEventListener(n,r[n].bind(r))}class fw{#t=0;get id(){return`${cv}${this.#t++}`}}class jf{#t=fv();#e=0;#n=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const o=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Tt(this,"_isSVGFittingCanvas",o)}async#i(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof e=="string"?(n.url=e,s=await jo(e,"blob")):e instanceof File?s=n.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const o=jf._isSVGFittingCanvas,c=new FileReader,h=new Image,d=new Promise((f,g)=>{h.onload=()=>{n.bitmap=h,n.isSvg=!0,f()},c.onload=async()=>{const _=n.svgUrl=c.result;h.src=await o?`${_}#svgView(preserveAspectRatio(none))`:_},h.onerror=c.onerror=g});c.readAsDataURL(s),await d}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){vt(s),n=null}return this.#n.set(t,n),n&&this.#n.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:s,type:o}=t;return this.#i(`${e}_${n}_${s}_${o}`,t)}async getFromUrl(t){return this.#i(t,t)}async getFromBlob(t,e){const n=await e;return this.#i(t,n)}async getFromId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n?.bitmap)return n.refCounter+=1,n;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#n.set(t,n),this.#n.set(n.id,n),n}getSvgUrl(t){const e=this.#n.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:n}=e;if(!e.url&&!e.file){const s=new OffscreenCanvas(n.width,n.height);s.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=s.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class pw{#t=[];#e=!1;#n;#i=-1;constructor(t=128){this.#n=t}add({cmd:t,undo:e,post:n,mustExec:s,type:o=NaN,overwriteIfSameType:c=!1,keepUndo:h=!1}){if(s&&t(),this.#e)return;const d={cmd:t,undo:e,post:n,type:o};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(d);return}if(c&&this.#t[this.#i].type===o){h&&(d.undo=this.#t[this.#i].undo),this.#t[this.#i]=d;return}const f=this.#i+1;f===this.#n?this.#t.splice(0,1):(this.#i=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(d)}undo(){if(this.#i===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(t){if(this.#i!==-1){for(let e=this.#i;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#i-e),this.#i=e;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}}class Vo{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=ke.platform;for(const[n,s,o={}]of t)for(const c of n){const h=c.startsWith("mac+");e&&h?(this.callbacks.set(c.slice(4),{callback:s,options:o}),this.allKeys.add(c.split("+").at(-1))):!e&&!h&&(this.callbacks.set(c,{callback:s,options:o}),this.allKeys.add(c.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#t(e));if(!n)return;const{callback:s,options:{bubbles:o=!1,args:c=[],checker:h=null}}=n;h&&!h(t,e)||(s.bind(t,...c,e)(),o||fe(e))}}class Gf{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return hw(t),Tt(this,"_colors",t)}convert(t){const e=tu(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,s]of this._colors)if(s.every((o,c)=>o===e[c]))return Gf._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?at.makeHexColor(...e):t}}class Ji{#t=new AbortController;#e=null;#n=null;#i=new Map;#a=new Map;#s=null;#r=null;#o=null;#l=new pw;#c=null;#d=null;#u=null;#f=0;#g=new Set;#p=null;#h=null;#m=new Set;_editorUndoBar=null;#b=!1;#_=!1;#A=!1;#S=null;#y=null;#E=null;#R=null;#T=!1;#w=null;#O=new fw;#x=!1;#D=!1;#I=!1;#k=null;#L=null;#P=null;#N=null;#H=null;#C=_t.NONE;#v=new Set;#z=null;#U=null;#G=null;#$=null;#Y=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#B=[0,0];#V=null;#q=null;#Z=null;#J=null;#F=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Ji.prototype,e=c=>c.#q.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&c.hasSomethingToControl(),n=(c,{target:h})=>{if(h instanceof HTMLInputElement){const{type:d}=h;return d!=="text"&&d!=="number"}return!0},s=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Tt(this,"_keyboardManager",new Vo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(c,{target:h})=>!(h instanceof HTMLButtonElement)&&c.#q.contains(h)&&!c.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(c,{target:h})=>!(h instanceof HTMLButtonElement)&&c.#q.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:e}]]))}constructor(t,e,n,s,o,c,h,d,f,g,_,y,b,A,S,C){const w=this._signal=this.#t.signal;this.#q=t,this.#Z=e,this.#J=n,this.#s=s,this.#c=o,this.#U=c,this.#Y=d,this._eventBus=h,h._on("editingaction",this.onEditingAction.bind(this),{signal:w}),h._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),h._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),h._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),h._on("setpreference",this.onSetPreference.bind(this),{signal:w}),h._on("switchannotationeditorparams",N=>this.updateParams(N.type,N.value),{signal:w}),window.addEventListener("pointerdown",()=>{this.#D=!0},{capture:!0,signal:w}),window.addEventListener("pointerup",()=>{this.#D=!1},{capture:!0,signal:w}),this.#lt(),this.#dt(),this.#et(),this.#r=d.annotationStorage,this.#S=d.filterFactory,this.#G=f,this.#R=g||null,this.#b=_,this.#_=y,this.#A=b,this.#H=A||null,this.viewParameters={realScale:Wa.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=S||null,this._supportsPinchToZoom=C!==!1}destroy(){this.#F?.resolve(),this.#F=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#i.clear(),this.#m.clear(),this.#N?.clear(),this.#e=null,this.#v.clear(),this.#l.destroy(),this.#s?.destroy(),this.#c?.destroy(),this.#U?.destroy(),this.#w?.hide(),this.#w=null,this.#P?.destroy(),this.#P=null,this.#n=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#V&&(clearTimeout(this.#V),this.#V=null),this._editorUndoBar?.destroy(),this.#Y=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#_}get useNewAltTextWhenAddingImage(){return this.#A}get hcmFilter(){return Tt(this,"hcmFilter",this.#G?this.#S.addHCMFilter(this.#G.foreground,this.#G.background):"none")}get direction(){return Tt(this,"direction",getComputedStyle(this.#q).direction)}get _highlightColors(){return Tt(this,"_highlightColors",this.#R?new Map(this.#R.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return Tt(this,"highlightColors",null);const e=new Map,n=!!this.#G;for(const[s,o]of t){const c=s.endsWith("_HCM");if(n&&c){e.set(s.replace("_HCM",""),o);continue}!n&&!c&&e.set(s,o)}return Tt(this,"highlightColors",e)}get highlightColorNames(){return Tt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#u=t}setMainHighlightColorPicker(t){this.#P=t}editAltText(t,e=!1){this.#s?.editAltText(this,t,e)}hasCommentManager(){return!!this.#c}editComment(t,e){this.#c?.open(this,t,e)}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#A=e;break}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#q.focus()}findParent(t,e){for(const n of this.#a.values()){const{x:s,y:o,width:c,height:h}=n.div.getBoundingClientRect();if(t>=s&&t<=s+c&&e>=o&&e<=o+h)return n}return null}disableUserSelect(t=!1){this.#Z.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#m.add(t)}removeShouldRescale(t){this.#m.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Wa.PDF_TO_CSS_UNITS;for(const e of this.#m)e.onScaleChanging();this.#u?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of this.#a.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(t="",e=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:s,anchorOffset:o,focusNode:c,focusOffset:h}=n,d=n.toString(),g=this.#Q(n).closest(".textLayer"),_=this.getSelectionBoxes(g);if(!_)return;n.empty();const y=this.#tt(g),b=this.#C===_t.NONE,A=()=>{const S=y?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:_,anchorNode:s,anchorOffset:o,focusNode:c,focusOffset:h,text:d});b&&this.showAllEditors("highlight",!0,!0),e&&S?.editComment()};if(b){this.switchToMode(_t.HIGHLIGHT,A);return}A()}commentSelection(t=""){this.highlightSelection(t,!0)}#rt(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=this.#Q(t).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(this.#w||=new dw(this),this.#w.show(n,s,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#r&&!this.#r.has(t.id)&&this.#r.setValue(t.id,t)}a11yAlert(t,e=null){const n=this.#J;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#ot(){const t=document.getSelection();if(!t||t.isCollapsed){this.#z&&(this.#w?.hide(),this.#z=null,this.#M({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#z)return;const s=this.#Q(t).closest(".textLayer");if(!s){this.#z&&(this.#w?.hide(),this.#z=null,this.#M({hasSelectedText:!1}));return}if(this.#w?.hide(),this.#z=e,this.#M({hasSelectedText:!0}),!(this.#C!==_t.HIGHLIGHT&&this.#C!==_t.NONE)&&(this.#C===_t.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#T=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#C===_t.HIGHLIGHT?this.#tt(s):null;if(o?.toggleDrawing(),this.#D){const c=new AbortController,h=this.combinedSignal(c),d=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),o?.toggleDrawing(!0),f.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("blur",d,{signal:h})}else o?.toggleDrawing(!0),this.#W("main_toolbar")}}#W(t=""){this.#C===_t.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#rt()}#lt(){document.addEventListener("selectionchange",this.#ot.bind(this),{signal:this._signal})}#ct(){if(this.#E)return;this.#E=new AbortController;const t=this.combinedSignal(this.#E);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ut(){this.#E?.abort(),this.#E=null}blur(){if(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#v)if(e.div.contains(t)){this.#L=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#L)return;const[t,e]=this.#L;this.#L=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#k)return;this.#k=new AbortController;const t=this.combinedSignal(this.#k);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ht(){this.#k?.abort(),this.#k=null}#nt(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#it(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.#nt()}removeEditListeners(){this.#ht(),this.#it()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#h)if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#h)if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of this.#v){const s=n.serialize(!0);s&&e.push(s)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const o of e.items)for(const c of this.#h)if(c.isHandlingMimeForPasting(o.type)){c.paste(o,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){vt(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const o=[];for(const d of n){const f=await s.deserialize(d);if(!f)return;o.push(f)}const c=()=>{for(const d of o)this.#st(d);this.#at(o)},h=()=>{for(const d of o)d.remove()};this.addCommands({cmd:c,undo:h,mustExec:!0})}catch(o){vt(`paste: "${o.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==_t.NONE&&!this.isEditorHandlingKeyboard&&Ji._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#M(t){Object.entries(t).some(([n,s])=>this.#X[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#C===_t.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#j([[Ot.HIGHLIGHT_FREE,!0]]))}#j(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ct(),this.#nt(),this.#M({isEditing:this.#C!==_t.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ut(),this.#it(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#h){this.#h=t;for(const e of this.#h)this.#j(e.defaultPropertiesToUpdate)}}getId(){return this.#O.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#a.set(t.pageIndex,t),this.#x?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,n=!1,s=!1,o=!1){if(this.#C!==t&&!(this.#F&&(await this.#F.promise,!this.#F))){if(this.#F=Promise.withResolvers(),this.#u?.commitOrRemove(),this.#C===_t.POPUP&&this.#c?.hideSidebar(),this.#C=t,t===_t.NONE){this.setEditingState(!1),this.#pt(),this._editorUndoBar?.hide(),this.#F.resolve();return}t===_t.SIGNATURE&&await this.#U?.loadSignatures(),t===_t.POPUP&&(this.#n||=await this.#Y.getAnnotationsByType(new Set(this.#h.map(c=>c._editorType))),this.#c?.showSidebar(this.#n)),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const c of this.#a.values())c.updateMode(t);if(!e){n&&this.addNewEditorFromKeyboard(),this.#F.resolve();return}for(const c of this.#i.values())c.annotationElementId===e||c.id===e?(this.setSelected(c),o?c.editComment():s&&c.enterInEditMode()):c.unselect();this.#F.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#h){switch(t){case Ot.CREATE:this.currentLayer.addNewEditor(e);return;case Ot.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#$||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const n of this.#v)n.updateParams(t,e);else for(const n of this.#h)n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){for(const o of this.#i.values())o.editorType===t&&o.show(e);(this.#$?.get(Ot.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#j([[Ot.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#I!==t){this.#I=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#x){this.#x=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#pt(){if(this.unselectAll(),this.#x){this.#x=!1;for(const t of this.#a.values())t.disable();for(const t of this.#i.values())t.disable()}}getEditors(t){const e=[];for(const n of this.#i.values())n.pageIndex===t&&e.push(n);return e}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#N?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#g.has(t.annotationElementId))&&this.#r?.remove(t.id)}addDeletedAnnotationElement(t){this.#g.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#g.has(t)}removeDeletedAnnotationElement(t){this.#g.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#j(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#v);return t}updateUI(t){this.#gt===t&&this.#j(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#j(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#u?.commitOrRemove();for(const e of this.#v)e!==t&&e.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#j(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#M({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#l.add(t),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#l.cleanType(t)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#v],n=()=>{this._editorUndoBar?.show(s,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},s=()=>{for(const o of e)this.#st(o)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#at(t){for(const e of this.#v)e.unselect();this.#v.clear();for(const e of t)e.isEmpty()||(this.#v.add(e),e.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#v)t.commit();this.#at(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#C!==_t.NONE))&&!this.#u?.commitOrRemove()&&this.hasSelection){for(const t of this.#v)t.unselect();this.#v.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#B[0]+=t,this.#B[1]+=e;const[s,o]=this.#B,c=[...this.#v],h=1e3;this.#V&&clearTimeout(this.#V),this.#V=setTimeout(()=>{this.#V=null,this.#B[0]=this.#B[1]=0,this.addCommands({cmd:()=>{for(const d of c)this.#i.has(d.id)&&(d.translateInPage(s,o),d.translationDone())},undo:()=>{for(const d of c)this.#i.has(d.id)&&(d.translateInPage(-s,-o),d.translationDone())},mustExec:!1})},h);for(const d of c)d.translateInPage(t,e),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const t of this.#v)this.#p.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const t=this.#p;this.#p=null;let e=!1;for(const[{x:s,y:o,pageIndex:c},h]of t)h.newX=s,h.newY=o,h.newPageIndex=c,e||=s!==h.savedX||o!==h.savedY||c!==h.savedPageIndex;if(!e)return!1;const n=(s,o,c,h)=>{if(this.#i.has(s.id)){const d=this.#a.get(h);d?s._setParentAndPosition(d,o,c):(s.pageIndex=h,s.x=o,s.y=c)}};return this.addCommands({cmd:()=>{for(const[s,{newX:o,newY:c,newPageIndex:h}]of t)n(s,o,c,h)},undo:()=>{for(const[s,{savedX:o,savedY:c,savedPageIndex:h}]of t)n(s,o,c,h)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#p)for(const n of this.#p.keys())n.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#C}get imageManager(){return Tt(this,"imageManager",new jf)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let f=0,g=e.rangeCount;f<g;f++)if(!t.contains(e.getRangeAt(f).commonAncestorContainer))return null;const{x:n,y:s,width:o,height:c}=t.getBoundingClientRect();let h;switch(t.getAttribute("data-main-rotation")){case"90":h=(f,g,_,y)=>({x:(g-s)/c,y:1-(f+_-n)/o,width:y/c,height:_/o});break;case"180":h=(f,g,_,y)=>({x:1-(f+_-n)/o,y:1-(g+y-s)/c,width:_/o,height:y/c});break;case"270":h=(f,g,_,y)=>({x:1-(g+y-s)/c,y:(f-n)/o,width:y/c,height:_/o});break;default:h=(f,g,_,y)=>({x:(f-n)/o,y:(g-s)/c,width:_/o,height:y/c});break}const d=[];for(let f=0,g=e.rangeCount;f<g;f++){const _=e.getRangeAt(f);if(!_.collapsed)for(const{x:y,y:b,width:A,height:S}of _.getClientRects())A===0||S===0||d.push(h(y,b,A,S))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const n=this.#r.getRawValue(e);n&&(this.#C===_t.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,e,n){const s=this.#N?.get(t);s&&(s.setCanvas(e,n),this.#N.delete(t))}addMissingCanvas(t,e){(this.#N||=new Map).set(t,e)}}class $n{#t=null;#e=!1;#n=null;#i=null;#a=null;#s=null;#r=!1;#o=null;#l=null;#c=null;#d=null;#u=!1;static#f=null;static _l10n=null;constructor(t){this.#l=t,this.#u=t._uiManager.useNewAltTextFlow,$n.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){$n._l10n??=t}async render(){const t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#i=document.createElement("span");t.append(e),this.#u?(t.classList.add("new"),t.setAttribute("data-l10n-id",$n.#f.missing),e.setAttribute("data-l10n-id",$n.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#l._uiManager._signal;t.addEventListener("contextmenu",xn,{signal:n}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});const s=o=>{o.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#u&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",s,{capture:!0,signal:n}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(this.#r=!0,s(o))},{signal:n}),await this.#p(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#u?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#u?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(t){this.#t===null&&(this.#c=t,this.#d=await $n._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())}toggleAltTextBadge(t=!1){if(!this.#u||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#l.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#c===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:s,cancel:o=!1}){n&&(this.#c=n,this.#d=s),!(this.#t===t&&this.#e===e)&&(o||(this.#t=t,this.#e=e),this.#p())}toggle(t=!1){this.#n&&(!t&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!t)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#a=null,this.#o?.remove(),this.#o=null}async#p(){const t=this.#n;if(!t)return;if(this.#u){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",$n.#f[this.#g]),this.#i?.setAttribute("data-l10n-id",$n.#f[`${this.#g}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#l.id}`;const s=100,o=this.#l._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#a.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:o}),t.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#a?.classList.remove("show")},{signal:o})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#l.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class pc{#t=null;#e=!1;#n=null;#i=null;#a=null;#s=null;#r=!1;constructor(t){this.#n=t,this.toolbar=null}render(){if(!this.#n._uiManager.hasCommentManager())return null;const t=this.#t=document.createElement("button");t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=this.#n._uiManager._signal;if(!(e instanceof AbortSignal)||e.aborted)return t;t.addEventListener("contextmenu",xn,{signal:e}),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:e});const n=s=>{s.preventDefault(),this.edit()};return t.addEventListener("click",n,{capture:!0,signal:e}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(this.#e=!0,n(s))},{signal:e}),t}edit(){const{bottom:t,left:e,right:n}=this.#n.getClientDimensions(),s={top:t};this.#n._uiManager.direction==="ltr"?s.right=n:s.left=e,this.#n._uiManager.editComment(this.#n,s)}finish(){this.#t&&(this.#t.focus({focusVisible:this.#e}),this.#e=!1)}isDeleted(){return this.#r||this.#a===""}hasBeenEdited(){return this.isDeleted()||this.#a!==this.#i}serialize(){return this.data}get data(){return{text:this.#a,date:this.#s,deleted:this.#r}}set data(t){if(t===null){this.#a="",this.#r=!0;return}this.#a=t,this.#s=new Date,this.#r=!1}setInitialText(t){this.#i=t,this.data=t}toggle(t=!1){this.#t&&(this.#t.disabled=!t)}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#a="",this.#s=null,this.#n=null,this.#e=!1,this.#r=!1}}class eu{#t;#e=!1;#n=null;#i;#a;#s;#r;#o=null;#l;#c=null;#d;#u=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:o=null,onPinchEnd:c=null,signal:h}){this.#t=t,this.#n=n,this.#i=e,this.#a=s,this.#s=o,this.#r=c,this.#d=new AbortController,this.#l=AbortSignal.any([h,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Wn.pixelRatio}#f(t){if(this.#i?.())return;if(t.touches.length===1){if(this.#o)return;const s=this.#o=new AbortController,o=AbortSignal.any([this.#l,s.signal]),c=this.#t,h={capture:!0,signal:o,passive:!1},d=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};c.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(fe(f),d(f))},h),c.addEventListener("pointerup",d,h),c.addEventListener("pointercancel",d,h);return}if(!this.#u){this.#u=new AbortController;const s=AbortSignal.any([this.#l,this.#u.signal]),o=this.#t,c={signal:s,capture:!1,passive:!1};o.addEventListener("touchmove",this.#g.bind(this),c);const h=this.#p.bind(this);o.addEventListener("touchend",h,c),o.addEventListener("touchcancel",h,c),c.capture=!0,o.addEventListener("pointerdown",fe,c),o.addEventListener("pointermove",fe,c),o.addEventListener("pointercancel",fe,c),o.addEventListener("pointerup",fe,c),this.#a?.()}if(fe(t),t.touches.length!==2||this.#n?.()){this.#c=null;return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#c={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#g(t){if(!this.#c||t.touches.length!==2)return;fe(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:s,screenY:o}=e,{screenX:c,screenY:h}=n,d=this.#c,{touch0X:f,touch0Y:g,touch1X:_,touch1Y:y}=d,b=_-f,A=y-g,S=c-s,C=h-o,w=Math.hypot(S,C)||1,N=Math.hypot(b,A)||1;if(!this.#e&&Math.abs(N-w)<=eu.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=s,d.touch0Y=o,d.touch1X=c,d.touch1Y=h,!this.#e){this.#e=!0;return}const x=[(s+c)/2,(o+h)/2];this.#s?.(x,N,w)}#p(t){t.touches.length>=2||(this.#u&&(this.#u.abort(),this.#u=null,this.#r?.()),this.#c&&(fe(t),this.#c=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class ut{#t=null;#e=null;#n=null;#i=null;#a=!1;#s=null;#r="";#o=!1;#l=null;#c=null;#d=null;#u=null;#f="";#g=!1;#p=null;#h=!1;#m=!1;#b=!1;#_=null;#A=0;#S=0;#y=null;#E=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#R=!1;#T=ut._zIndex++;static _borderLineWidth=-1;static _colorManager=new Gf;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=ut.prototype._resizeWithKeyboard,e=Ji.TRANSLATE_SMALL,n=Ji.TRANSLATE_BIG;return Tt(this,"_resizerKeyboardManager",new Vo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],ut.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:n,pageHeight:s,pageX:o,pageY:c}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[o,c];const[h,d]=this.parentDimensions;this.x=t.x/h,this.y=t.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Tt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new gw({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(ut._l10n??=t,ut._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),ut._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);ut._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Vt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#R}set _isDraggable(t){this.#R=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#B(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,s){const[o,c]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(t+n)/o,this.y=(e+s)/c,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,s]=this.parentDimensions;this.setAt(t*n,e*s,this.width*n,this.height*s),this._onTranslated()}#w([t,e],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#w(this.parentDimensions,t,e)}translateInPage(t,e){this.#p||=[this.x,this.y,this.width,this.height],this.#w(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#p||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[s,o]}=this;if(this.x+=t/s,this.y+=e/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:_,y}=this.div.getBoundingClientRect();this.parent.findNewParent(this,_,y)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:c,y:h}=this;const[d,f]=this.getBaseTranslation();c+=d,h+=f;const{style:g}=n;g.left=`${(100*c).toFixed(2)}%`,g.top=`${(100*h).toFixed(2)}%`,this._onTranslating(c,h),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#p&&(this.#p[0]!==this.x||this.#p[1]!==this.y)}get _hasBeenResized(){return!!this.#p&&(this.#p[2]!==this.width||this.#p[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=ut,s=n/t,o=n/e;switch(this.rotation){case 90:return[-s,o];case 180:return[s,o];case 270:return[s,-o];default:return[-s,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,s]}=this;let{x:o,y:c,width:h,height:d}=this;if(h*=n,d*=s,o*=n,c*=s,this._mustFixPosition)switch(t){case 0:o=Ue(o,0,n-h),c=Ue(c,0,s-d);break;case 90:o=Ue(o,0,n-d),c=Ue(c,h,s);break;case 180:o=Ue(o,h,n),c=Ue(c,d,s);break;case 270:o=Ue(o,d,n),c=Ue(c,0,s-h);break}this.x=o/=n,this.y=c/=s;const[f,g]=this.getBaseTranslation();o+=f,c+=g,e.left=`${(100*o).toFixed(2)}%`,e.top=`${(100*c).toFixed(2)}%`,this.moveInDOM()}static#O(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return ut.#O(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return ut.#O(t,e,360-this.parentRotation)}#x(t){switch(t){case 90:{const[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(t,e){const[n,s]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*t/n).toFixed(2)}%`,this.#o||(o.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:n}=t,s=n.endsWith("%"),o=!this.#o&&e.endsWith("%");if(s&&o)return;const[c,h]=this.parentDimensions;s||(t.width=`${(100*parseFloat(n)/c).toFixed(2)}%`),!this.#o&&!o&&(t.height=`${(100*parseFloat(e)/h).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#D(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const s=document.createElement("div");this.#l.append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",this.#I.bind(this,n),{signal:e}),s.addEventListener("contextmenu",xn,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#l)}#I(t,e){e.preventDefault();const{isMac:n}=ke.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#n?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#c=[e.screenX,e.screenY];const o=new AbortController,c=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#P.bind(this,t),{passive:!0,capture:!0,signal:c}),window.addEventListener("touchmove",fe,{passive:!1,signal:c}),window.addEventListener("contextmenu",xn,{signal:c}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const h=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const f=()=>{o.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=h,this.div.style.cursor=d,this.#L()};window.addEventListener("pointerup",f,{signal:c}),window.addEventListener("blur",f,{signal:c})}#k(t,e,n,s){this.width=n,this.height=s,this.x=t,this.y=e;const[o,c]=this.parentDimensions;this.setDims(o*n,c*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#L(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:s}=this.#d;this.#d=null;const o=this.x,c=this.y,h=this.width,d=this.height;o===t&&c===e&&h===n&&d===s||this.addCommands({cmd:this.#k.bind(this,o,c,h,d),undo:this.#k.bind(this,t,e,n,s),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#P(t,e){const[n,s]=this.parentDimensions,o=this.x,c=this.y,h=this.width,d=this.height,f=ut.MIN_SIZE/n,g=ut.MIN_SIZE/s,_=this.#x(this.rotation),y=(P,L)=>[_[0]*P+_[2]*L,_[1]*P+_[3]*L],b=this.#x(360-this.rotation),A=(P,L)=>[b[0]*P+b[2]*L,b[1]*P+b[3]*L];let S,C,w=!1,N=!1;switch(t){case"topLeft":w=!0,S=(P,L)=>[0,0],C=(P,L)=>[P,L];break;case"topMiddle":S=(P,L)=>[P/2,0],C=(P,L)=>[P/2,L];break;case"topRight":w=!0,S=(P,L)=>[P,0],C=(P,L)=>[0,L];break;case"middleRight":N=!0,S=(P,L)=>[P,L/2],C=(P,L)=>[0,L/2];break;case"bottomRight":w=!0,S=(P,L)=>[P,L],C=(P,L)=>[0,0];break;case"bottomMiddle":S=(P,L)=>[P/2,L],C=(P,L)=>[P/2,0];break;case"bottomLeft":w=!0,S=(P,L)=>[0,L],C=(P,L)=>[P,0];break;case"middleLeft":N=!0,S=(P,L)=>[0,L/2],C=(P,L)=>[P,L/2];break}const x=S(h,d),M=C(h,d);let D=y(...M);const O=ut._round(o+D[0]),B=ut._round(c+D[1]);let j=1,$=1,nt,tt;if(e.fromKeyboard)({deltaX:nt,deltaY:tt}=e);else{const{screenX:P,screenY:L}=e,[q,J]=this.#c;[nt,tt]=this.screenToPageTranslation(P-q,L-J),this.#c[0]=P,this.#c[1]=L}if([nt,tt]=A(nt/n,tt/s),w){const P=Math.hypot(h,d);j=$=Math.max(Math.min(Math.hypot(M[0]-x[0]-nt,M[1]-x[1]-tt)/P,1/h,1/d),f/h,g/d)}else N?j=Ue(Math.abs(M[0]-x[0]-nt),f,1)/h:$=Ue(Math.abs(M[1]-x[1]-tt),g,1)/d;const lt=ut._round(h*j),et=ut._round(d*$);D=y(...C(lt,et));const yt=O-D[0],At=B-D[1];this.#p||=[this.x,this.y,this.width,this.height],this.width=lt,this.height=et,this.x=yt,this.y=At,this.setDims(n*lt,s*et),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#m)return this._editToolbar;this._editToolbar=new bo(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#n?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||($n.initialize(ut._l10n),this.#n=new $n(this),this.#t&&(this.#n.data=this.#t,this.#t=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(t){this.#n&&(this.#n.data=t)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(t){await this.#n?.setGuessedText(t)}serializeAltText(t){return this.#n?.serialize(t)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}addCommentButton(){return this.#i?this.#i:this.#i=new pc(this)}get commentColor(){return null}get comment(){const t=this.#i;return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){this.#i||(this.#i=new pc(this)),this.#i.data=t}setCommentData(t){this.#i||(this.#i=new pc(this)),this.#i.setInitialText(t)}get hasEditedComment(){return this.#i?.hasBeenEdited()}async editComment(){this.#i||(this.#i=new pc(this)),this.#i.edit()}addComment(t){if(this.hasEditedComment){const[,,,s]=t.rect,[o]=this.pageDimensions,[c]=this.pageTranslation,h=c+o+1,d=s-100,f=h+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[h,d,f,s]}}}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#a?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#U();const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[s,o]=this.getInitialTranslation();return this.translate(s,o),gv(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#E||=new eu({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#N.bind(this),onPinching:this.#H.bind(this),onPinchEnd:this.#C.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),t}#N(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#H(t,e,n){let o=.7*(n/e)+1-.7;if(o===1)return;const c=this.#x(this.rotation),h=(O,B)=>[c[0]*O+c[2]*B,c[1]*O+c[3]*B],[d,f]=this.parentDimensions,g=this.x,_=this.y,y=this.width,b=this.height,A=ut.MIN_SIZE/d,S=ut.MIN_SIZE/f;o=Math.max(Math.min(o,1/y,1/b),A/y,S/b);const C=ut._round(y*o),w=ut._round(b*o);if(C===y&&w===b)return;this.#p||=[g,_,y,b];const N=h(y/2,b/2),x=ut._round(g+N[0]),M=ut._round(_+N[1]),D=h(C/2,w/2);this.x=x-D[0],this.y=M-D[1],this.width=C,this.height=w,this.setDims(d*C,f*w),this.fixAndSetPosition(),this._onResizing()}#C(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#L()}pointerdown(t){const{isMac:e}=ke.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#z(t);return}this.#v(t)}#v(t){const{isMac:e}=ke.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#z(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const s=new AbortController,o=this._uiManager.combinedSignal(s),c={capture:!0,passive:!1,signal:o},h=f=>{s.abort(),this.#s=null,this.#g=!1,this._uiManager.endDragSession()||this.#v(f),n&&this._onStopDragging()};e&&(this.#A=t.clientX,this.#S=t.clientY,this.#s=t.pointerId,this.#r=t.pointerType,window.addEventListener("pointermove",f=>{n||(n=!0,this._onStartDragging());const{clientX:g,clientY:_,pointerId:y}=f;if(y!==this.#s){fe(f);return}const[b,A]=this.screenToPageTranslation(g-this.#A,_-this.#S);this.#A=g,this.#S=_,this._uiManager.dragSelectedEditors(b,A)},c),window.addEventListener("touchmove",fe,c),window.addEventListener("pointerdown",f=>{f.pointerType===this.#r&&(this.#E||f.isPrimary)&&h(f),fe(f)},c));const d=f=>{if(!this.#s||this.#s===f.pointerId){h(f);return}fe(f)};window.addEventListener("pointerup",d,{signal:o}),window.addEventListener("blur",d,{signal:o})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.#_=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const s=this.parentScale,[o,c]=this.pageDimensions,[h,d]=this.pageTranslation,f=t/s,g=e/s,_=this.x*o,y=this.y*c,b=this.width*o,A=this.height*c;switch(n){case 0:return[_+f+h,c-y-g-A+d,_+f+b+h,c-y-g+d];case 90:return[_+g+h,c-y+f+d,_+g+A+h,c-y+f+b+d];case 180:return[_-f-b+h,c-y+g+d,_-f+h,c-y+g+A+d];case 270:return[_-g-A+h,c-y-f-b+d,_-g+h,c-y-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,s,o,c]=t,h=o-n,d=c-s;switch(this.rotation){case 0:return[n,e-c,h,d];case 90:return[n,e-s,d,h];case 180:return[o,e-s,h,d];case 270:return[o,e-c,d,h];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#m=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#m=!1,!0):!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#b}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:o,innerWidth:c}=window;return e<c&&s>0&&t<o&&n>0}#U(){if(this.#u||!this.div)return;this.#u=new AbortController;const t=this._uiManager.combinedSignal(this.#u);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#U()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){Vt("An editor must be serializable")}static async deserialize(t,e,n){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId});s.rotation=t.rotation,s.#t=t.accessibilityData,s._isCopy=t.isCopy||!1;const[o,c]=s.pageDimensions,[h,d,f,g]=s.getRectInCurrentCoords(t.rect,c);return s.x=h/o,s.y=d/c,s.width=f/o,s.height=g/c,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#u?.abort(),this.#u=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#_&&(clearTimeout(this.#_),this.#_=null),this.#B(),this.removeEditToolbar(),this.#y){for(const t of this.#y.values())clearTimeout(t);this.#y=null}this.parent=null,this.#E?.destroy(),this.#E=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#D(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#l.children;if(!this.#e){this.#e=Array.from(e);const c=this.#G.bind(this),h=this.#$.bind(this),d=this._uiManager._signal;for(const f of this.#e){const g=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",c,{signal:d}),f.addEventListener("blur",h,{signal:d}),f.addEventListener("focus",this.#Y.bind(this,g),{signal:d}),f.setAttribute("data-l10n-id",ut._l10nResizer[g])}}const n=this.#e[0];let s=0;for(const c of e){if(c===n)break;s++}const o=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(o!==s){if(o<s)for(let h=0;h<s-o;h++)this.#l.append(this.#l.firstChild);else if(o>s)for(let h=0;h<o-s;h++)this.#l.firstChild.before(this.#l.lastChild);let c=0;for(const h of e){const f=this.#e[c++].getAttribute("data-resizer-name");h.setAttribute("data-l10n-id",ut._l10nResizer[f])}}this.#X(0),this.#b=!0,this.#l.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#G(t){ut._resizerKeyboardManager.exec(this,t)}#$(t){this.#b&&t.relatedTarget?.parentNode!==this.#l&&this.#B()}#Y(t){this.#f=this.#b?t:""}#X(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#b&&this.#P(this.#f,{deltaX:t,deltaY:e,fromKeyboard:!0})}#B(){this.#b=!1,this.#X(-1),this.#L()}_stopResizingWithKeyboard(){this.#B(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#h}set isEditing(t){this.#h=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#o=!0;const n=t/e,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#y||=new Map;const{action:n}=t;let s=this.#y.get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),this.#y.delete(n),this.#y.size===0&&(this.#y=null)},ut._telemetryTimeout),this.#y.set(n,s);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#a=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#a=!0}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class gw extends ut{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const qy=3285377520,An=4294901760,qn=65535;class mv{constructor(t){this.h1=t?t&4294967295:qy,this.h2=t?t&4294967295:qy}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let S=0,C=t.length;S<C;S++){const w=t.charCodeAt(S);w<=255?e[n++]=w:(e[n++]=w>>>8,e[n++]=w&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=n>>2,o=n-s*4,c=new Uint32Array(e.buffer,0,s);let h=0,d=0,f=this.h1,g=this.h2;const _=3432918353,y=461845907,b=_&qn,A=y&qn;for(let S=0;S<s;S++)S&1?(h=c[S],h=h*_&An|h*b&qn,h=h<<15|h>>>17,h=h*y&An|h*A&qn,f^=h,f=f<<13|f>>>19,f=f*5+3864292196):(d=c[S],d=d*_&An|d*b&qn,d=d<<15|d>>>17,d=d*y&An|d*A&qn,g^=d,g=g<<13|g>>>19,g=g*5+3864292196);switch(h=0,o){case 3:h^=e[s*4+2]<<16;case 2:h^=e[s*4+1]<<8;case 1:h^=e[s*4],h=h*_&An|h*b&qn,h=h<<15|h>>>17,h=h*y&An|h*A&qn,s&1?f^=h:g^=h}this.h1=f,this.h2=g}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&An|t*36045&qn,e=e*4283543511&An|((e<<16|t>>>16)*2950163797&An)>>>16,t^=e>>>1,t=t*444984403&An|t*60499&qn,e=e*3301882366&An|((e<<16|t>>>16)*3120437893&An)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const rf=Object.freeze({map:null,hash:"",transfer:void 0});class Vf{#t=!1;#e=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#n.get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return this.#n.get(t)}remove(t){if(this.#n.delete(t),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of this.#n.values())if(e instanceof ut)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#n.get(t);let s=!1;if(n!==void 0)for(const[o,c]of Object.entries(e))n[o]!==c&&(s=!0,n[o]=c);else s=!0,this.#n.set(t,e);s&&this.#i(),e instanceof ut&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#n.has(t)}get size(){return this.#n.size}#i(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new _v(this)}get serializable(){if(this.#n.size===0)return rf;const t=new Map,e=new mv,n=[],s=Object.create(null);let o=!1;for(const[c,h]of this.#n){const d=h instanceof ut?h.serialize(!1,s):h;d&&(t.set(c,d),e.update(`${c}:${JSON.stringify(d)}`),o||=!!d.bitmap)}if(o)for(const c of t.values())c.bitmap&&n.push(c.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:rf}get editorStats(){let t=null;const e=new Map;for(const n of this.#n.values()){if(!(n instanceof ut))continue;const s=n.telemetryFinalData;if(!s)continue;const{type:o}=s;e.has(o)||e.set(o,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const c=t[o]||=new Map;for(const[h,d]of Object.entries(s)){if(h==="type")continue;let f=c.get(h);f||(f=new Map,c.set(h,f));const g=f.get(d)??0;f.set(d,g+1)}}for(const[n,s]of e)t[n]=s.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;const t=[];for(const e of this.#n.values())!(e instanceof ut)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class _v extends Vf{#t;constructor(t){super();const{map:e,hash:n,transfer:s}=t.serializable,o=structuredClone(e,s?{transfer:s}:null);this.#t={map:o,hash:n,transfer:s}}get print(){Vt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return Tt(this,"modifiedIds",{ids:new Set,hash:""})}}class mw{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(!(!t||this.#t.has(t.loadedName))){if(ge(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:o,style:c}=t,h=new FontFace(s,o,c);this.addNativeFontFace(h);try{await h.load(),this.#t.add(s),n?.(t)}catch{vt(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(h)}return}Vt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw vt(`Failed to load font '${n.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return Tt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Tt(this,"isSyncFontLoadingSupported",ze||ke.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(ge(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){const o=n.shift();setTimeout(o.callback,0)}}const{loadingRequests:n}=this,s={done:!1,complete:e,callback:t};return n.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Tt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(M,D){return M.charCodeAt(D)<<24|M.charCodeAt(D+1)<<16|M.charCodeAt(D+2)<<8|M.charCodeAt(D+3)&255}function s(M,D,O,B){const j=M.substring(0,D),$=M.substring(D+O);return j+B+$}let o,c;const h=this._document.createElement("canvas");h.width=1,h.height=1;const d=h.getContext("2d");let f=0;function g(M,D){if(++f>30){vt("Load test font never loaded."),D();return}if(d.font="30px "+M,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){D();return}setTimeout(g.bind(null,M,D))}const _=`lt${Date.now()}${this.loadTestFontId++}`;let y=this._loadTestFont;y=s(y,976,_.length,_);const A=16,S=1482184792;let C=n(y,A);for(o=0,c=_.length-3;o<c;o+=4)C=C-S+n(_,o)|0;o<_.length&&(C=C-S+n(_+"XXX",o)|0),y=s(y,A,4,tw(C));const w=`url(data:font/opentype;base64,${btoa(y)});`,N=`@font-face {font-family:"${_}";src:${w}}`;this.insertRule(N);const x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(const M of[t.loadedName,_]){const D=this._document.createElement("span");D.textContent="Hi",D.style.fontFamily=M,x.append(D)}this._document.body.append(x),g(_,()=>{x.remove(),e.complete()})}}class _w{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const n in t)this[n]=t[n];this._inspectFont=e}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${pv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let s;try{s=t.get(n)}catch(c){vt(`getPathGenerator - ignoring character: "${c}".`)}const o=new Path2D(s||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=o}}function yw(r){if(r instanceof URL)return r.href;if(typeof r=="string"){if(ze)return r;const t=URL.parse(r,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function bw(r){if(ze&&typeof Buffer<"u"&&r instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength)return r;if(typeof r=="string")return Uo(r);if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)||typeof r=="object"&&!isNaN(r?.length))return new Uint8Array(r);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function gc(r){if(typeof r!="string")return null;if(r.endsWith("/"))return r;throw new Error(`Invalid factory url: "${r}" must include trailing slash.`)}const of=r=>typeof r=="object"&&Number.isInteger(r?.num)&&r.num>=0&&Number.isInteger(r?.gen)&&r.gen>=0,vw=r=>typeof r=="object"&&typeof r?.name=="string",Aw=aw.bind(null,of,vw);class Sw{#t=new Map;#e=Promise.resolve();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[s]of this.#t)s.call(this,n)})}addEventListener(t,e,n=null){let s=null;if(n?.signal instanceof AbortSignal){const{signal:o}=n;if(o.aborted){vt("LoopbackPort - cannot use an `aborted` signal.");return}const c=()=>this.removeEventListener(t,e);s=()=>o.removeEventListener("abort",c),o.addEventListener("abort",c)}this.#t.set(e,s)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const mc={DATA:1,ERROR:2},he={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Yy(){}function We(r){if(r instanceof Zi||r instanceof nf||r instanceof jy||r instanceof xc||r instanceof Id)return r;switch(r instanceof Error||typeof r=="object"&&r!==null||Vt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),r.name){case"AbortException":return new Zi(r.message);case"InvalidPDFException":return new nf(r.message);case"PasswordException":return new jy(r.message,r.code);case"ResponseException":return new xc(r.message,r.status,r.missing);case"UnknownErrorException":return new Id(r.message,r.details)}return new Id(r.message,r.toString())}class _o{#t=new AbortController;constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#i(t);return}if(t.callback){const n=t.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===mc.DATA)s.resolve(t.data);else if(t.callback===mc.ERROR)s.reject(We(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,s=t.sourceName,o=this.comObj;Promise.try(e,t.data).then(function(c){o.postMessage({sourceName:n,targetName:s,callback:mc.DATA,callbackId:t.callbackId,data:c})},function(c){o.postMessage({sourceName:n,targetName:s,callback:mc.ERROR,callbackId:t.callbackId,reason:We(c)})});return}if(t.streamId){this.#n(t);return}e(t.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const s=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[s]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},n)}catch(c){o.reject(c)}return o.promise}sendWithStream(t,e,n,s){const o=this.streamId++,c=this.sourceName,h=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const g=Promise.withResolvers();return this.streamControllers[o]={controller:f,startCall:g,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:c,targetName:h,action:t,streamId:o,data:e,desiredSize:f.desiredSize},s),g.promise},pull:f=>{const g=Promise.withResolvers();return this.streamControllers[o].pullCall=g,d.postMessage({sourceName:c,targetName:h,stream:he.PULL,streamId:o,desiredSize:f.desiredSize}),g.promise},cancel:f=>{ge(f instanceof Error,"cancel must have a valid reason");const g=Promise.withResolvers();return this.streamControllers[o].cancelCall=g,this.streamControllers[o].isClosed=!0,d.postMessage({sourceName:c,targetName:h,stream:he.CANCEL,streamId:o,reason:We(f)}),g.promise}},n)}#n(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,o=this.comObj,c=this,h=this.actionHandler[t.action],d={enqueue(f,g=1,_){if(this.isCancelled)return;const y=this.desiredSize;this.desiredSize-=g,y>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:s,stream:he.ENQUEUE,streamId:e,chunk:f},_)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:he.CLOSE,streamId:e}),delete c.streamSinks[e])},error(f){ge(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:he.ERROR,streamId:e,reason:We(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[e]=d,Promise.try(h,t.data,d).then(function(){o.postMessage({sourceName:n,targetName:s,stream:he.START_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:s,stream:he.START_COMPLETE,streamId:e,reason:We(f)})})}#i(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,o=this.comObj,c=this.streamControllers[e],h=this.streamSinks[e];switch(t.stream){case he.START_COMPLETE:t.success?c.startCall.resolve():c.startCall.reject(We(t.reason));break;case he.PULL_COMPLETE:t.success?c.pullCall.resolve():c.pullCall.reject(We(t.reason));break;case he.PULL:if(!h){o.postMessage({sourceName:n,targetName:s,stream:he.PULL_COMPLETE,streamId:e,success:!0});break}h.desiredSize<=0&&t.desiredSize>0&&h.sinkCapability.resolve(),h.desiredSize=t.desiredSize,Promise.try(h.onPull||Yy).then(function(){o.postMessage({sourceName:n,targetName:s,stream:he.PULL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:s,stream:he.PULL_COMPLETE,streamId:e,reason:We(f)})});break;case he.ENQUEUE:if(ge(c,"enqueue should have stream controller"),c.isClosed)break;c.controller.enqueue(t.chunk);break;case he.CLOSE:if(ge(c,"close should have stream controller"),c.isClosed)break;c.isClosed=!0,c.controller.close(),this.#a(c,e);break;case he.ERROR:ge(c,"error should have stream controller"),c.controller.error(We(t.reason)),this.#a(c,e);break;case he.CANCEL_COMPLETE:t.success?c.cancelCall.resolve():c.cancelCall.reject(We(t.reason)),this.#a(c,e);break;case he.CANCEL:if(!h)break;const d=We(t.reason);Promise.try(h.onCancel||Yy,d).then(function(){o.postMessage({sourceName:n,targetName:s,stream:he.CANCEL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:s,stream:he.CANCEL_COMPLETE,streamId:e,reason:We(f)})}),h.sinkCapability.reject(d),h.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class yv{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Vt("Abstract method `_createCanvas` called.")}}class Ew extends yv{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class bv{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Vt("Abstract method `_fetch` called.")}}class Xy extends bv{async _fetch(t){const e=await jo(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Uo(e)}}class vv{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,s,o){return"none"}destroy(t=!1){}}class ww extends vv{#t;#e;#n;#i;#a;#s;#r=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#i=t,this.#a=e}get#o(){return this.#e||=new Map}get#l(){return this.#s||=new Map}get#c(){if(!this.#n){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#a.createElementNS(di,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#n=this.#a.createElementNS(di,"defs"),t.append(n),n.append(this.#n),this.#a.body.append(t)}return this.#n}#d(t){if(t.length===1){const d=t[0],f=new Array(256);for(let _=0;_<256;_++)f[_]=d[_]/255;const g=f.join(",");return[g,g,g]}const[e,n,s]=t,o=new Array(256),c=new Array(256),h=new Array(256);for(let d=0;d<256;d++)o[d]=e[d]/255,c[d]=n[d]/255,h[d]=s[d]/255;return[o.join(","),c.join(","),h.join(",")]}#u(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(Jc(e)?vt('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=hv(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[n,s,o]=this.#d(t),c=t.length===1?n:`${n}${s}${o}`;if(e=this.#o.get(c),e)return this.#o.set(t,e),e;const h=`g_${this.#i}_transfer_map_${this.#r++}`,d=this.#u(h);this.#o.set(t,d),this.#o.set(c,d);const f=this.#p(h);return this.#m(n,s,o,f),d}addHCMFilter(t,e){const n=`${t}-${e}`,s="base";let o=this.#l.get(s);if(o?.key===n||(o?(o.filter?.remove(),o.key=n,o.url="none",o.filter=null):(o={key:n,url:"none",filter:null},this.#l.set(s,o)),!t||!e))return o.url;const c=this.#_(t);t=at.makeHexColor(...c);const h=this.#_(e);if(e=at.makeHexColor(...h),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return o.url;const d=new Array(256);for(let b=0;b<=255;b++){const A=b/255;d[b]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const f=d.join(","),g=`g_${this.#i}_hcm_filter`,_=o.filter=this.#p(g);this.#m(f,f,f,_),this.#g(_);const y=(b,A)=>{const S=c[b]/255,C=h[b]/255,w=new Array(A+1);for(let N=0;N<=A;N++)w[N]=S+N/A*(C-S);return w.join(",")};return this.#m(y(0,5),y(1,5),y(2,5),_),o.url=this.#u(g),o.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[n]=this.#d([t]),s=`alpha_${n}`;if(e=this.#o.get(s),e)return this.#o.set(t,e),e;const o=`g_${this.#i}_alpha_map_${this.#r++}`,c=this.#u(o);this.#o.set(t,c),this.#o.set(s,c);const h=this.#p(o);return this.#b(n,h),c}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let n,s;if(t?([n]=this.#d([t]),s=`luminosity_${n}`):s="luminosity",e=this.#o.get(s),e)return this.#o.set(t,e),e;const o=`g_${this.#i}_luminosity_map_${this.#r++}`,c=this.#u(o);this.#o.set(t,c),this.#o.set(s,c);const h=this.#p(o);return this.#f(h),t&&this.#b(n,h),c}addHighlightHCMFilter(t,e,n,s,o){const c=`${e}-${n}-${s}-${o}`;let h=this.#l.get(t);if(h?.key===c||(h?(h.filter?.remove(),h.key=c,h.url="none",h.filter=null):(h={key:c,url:"none",filter:null},this.#l.set(t,h)),!e||!n))return h.url;const[d,f]=[e,n].map(this.#_.bind(this));let g=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),_=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[y,b]=[s,o].map(this.#_.bind(this));_<g&&([g,_,y,b]=[_,g,b,y]),this.#c.style.color="";const A=(w,N,x)=>{const M=new Array(256),D=(_-g)/x,O=w/255,B=(N-w)/(255*x);let j=0;for(let $=0;$<=x;$++){const nt=Math.round(g+$*D),tt=O+$*B;for(let lt=j;lt<=nt;lt++)M[lt]=tt;j=nt+1}for(let $=j;$<256;$++)M[$]=M[j-1];return M.join(",")},S=`g_${this.#i}_hcm_${t}_filter`,C=h.filter=this.#p(S);return this.#g(C),this.#m(A(y[0],b[0],5),A(y[1],b[1],5),A(y[2],b[2],5),C),h.url=this.#u(S),h.url}destroy(t=!1){t&&this.#s?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#e?.clear(),this.#e=null,this.#s?.clear(),this.#s=null,this.#r=0)}#f(t){const e=this.#a.createElementNS(di,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#a.createElementNS(di,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){const e=this.#a.createElementNS(di,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#h(t,e,n){const s=this.#a.createElementNS(di,e);s.setAttribute("type","discrete"),s.setAttribute("tableValues",n),t.append(s)}#m(t,e,n,s){const o=this.#a.createElementNS(di,"feComponentTransfer");s.append(o),this.#h(o,"feFuncR",t),this.#h(o,"feFuncG",e),this.#h(o,"feFuncB",n)}#b(t,e){const n=this.#a.createElementNS(di,"feComponentTransfer");e.append(n),this.#h(n,"feFuncA",t)}#_(t){return this.#c.style.color=t,tu(getComputedStyle(this.#c).getPropertyValue("color"))}}class Av{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Vt("Abstract method `_fetch` called.")}}class $y extends Av{async _fetch(t){const e=await jo(t,"arraybuffer");return new Uint8Array(e)}}class Sv{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Vt("Abstract method `_fetch` called.")}}class Wy extends Sv{async _fetch(t){const e=await jo(t,"arraybuffer");return new Uint8Array(e)}}ze&&vt("Please use the `legacy` build in Node.js environments.");async function qf(r){const e=await process.getBuiltinModule("fs").promises.readFile(r);return new Uint8Array(e)}class Cw extends vv{}class Tw extends yv{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class xw extends bv{async _fetch(t){return qf(t)}}class Rw extends Av{async _fetch(t){return qf(t)}}class Dw extends Sv{async _fetch(t){return qf(t)}}const Da="__forcedDependency";class Mw{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Da]:[]};#n=new Map;#i=[];#a=[];#s=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#c=new Set;#d=new Map;#u=new Map;#f;#g;constructor(t){this.#f=t.width,this.#g=t.height}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Da]:{__proto__:this.#e[Da]}},this.#r={__proto__:this.#r},this.#i.push([t,null]),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#r=Object.getPrototypeOf(this.#r);const n=this.#i.pop();return n!==void 0&&(n[1]=t),this}recordOpenMarker(t){return this.#i.push([t,null]),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)[0]}recordCloseMarker(t){const e=this.#i.pop();return e!==void 0&&(e[1]=t),this}beginMarkedContent(t){return this.#a.push([t,null]),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(e[1]=t),this}pushBaseTransform(t){return this.#s.push(at.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform())),this}popBaseTransform(){return this.#s.length>1&&this.#s.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#n.set(t,e),this}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Da,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#c)this.recordFutureForcedDependency(Da,t);return this}resetBBox(t){return this.#l=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0,this}get hasPendingBBox(){return this.#l!==-1}recordClipBox(t,e,n,s,o,c){const h=at.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform()),d=[1/0,1/0,-1/0,-1/0];at.axialAlignedBoundingBox([n,o,s,c],h,d);const f=at.intersect(this.#r,d);return f?(this.#r[0]=f[0],this.#r[1]=f[1],this.#r[2]=f[2],this.#r[3]=f[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(t,e,n,s,o,c){const h=this.#r;if(h[0]===1/0)return this;const d=at.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform());if(h[0]===-1/0)return at.axialAlignedBoundingBox([n,o,s,c],d,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return at.axialAlignedBoundingBox([n,o,s,c],d,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],h[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],h[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],h[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],h[3])),this}recordCharacterBBox(t,e,n,s=1,o=0,c=0,h){const d=n.bbox;let f,g;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&this.#u.get(n),f!==!1&&(g=[0,0,0,0],at.axialAlignedBoundingBox(d,n.fontMatrix,g),(s!==1||o!==0||c!==0)&&at.scaleMinMax([s,0,0,-s,o,c],g),f)))return this.recordBBox(t,e,g[0],g[2],g[1],g[3]);if(!h)return this.recordFullPageBBox(t);const _=h();return d&&g&&f===void 0&&(f=g[0]<=o-_.actualBoundingBoxLeft&&g[2]>=o+_.actualBoundingBoxRight&&g[1]<=c-_.actualBoundingBoxAscent&&g[3]>=c+_.actualBoundingBoxDescent,this.#u.set(n,f),f)?this.recordBBox(t,e,g[0],g[2],g[1],g[3]):this.recordBBox(t,e,o-_.actualBoundingBoxLeft,o+_.actualBoundingBoxRight,c-_.actualBoundingBoxAscent,c+_.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#f,this.#r[2]),this.#o[3]=Math.min(this.#g,this.#r[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const n=this.#c,s=this.#t,o=this.#e;for(const c of e)c in this.#t?n.add(s[c]):c in o&&o[c].forEach(n.add,n);return this}copyDependenciesFromIncrementalOperation(t,e){const n=this.#d,s=this.#c;for(const o of this.#e[e])n.get(o).dependencies.forEach(s.add,s.add(o));return this}recordNamedDependency(t,e){return this.#n.has(e)&&this.#c.add(this.#n.get(e)),this}recordOperation(t,e=!1){this.recordDependencies(t,[Da]);const n=new Set(this.#c),s=this.#i.concat(this.#a),o=this.#l===t?{minX:this.#o[0],minY:this.#o[1],maxX:this.#o[2],maxY:this.#o[3]}:null;return this.#d.set(t,{bbox:o,pairs:s,dependencies:n}),e||(this.#l=-1),this.#c.clear(),this}bboxToClipBoxDropOperation(t){return this.#l!==-1&&(this.#l=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3])),this.#c.clear(),this}_takePendingDependencies(){const t=this.#c;return this.#c=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#c.add(e)}take(){return this.#u.clear(),Array.from(this.#d,([t,{bbox:e,pairs:n,dependencies:s}])=>(n.forEach(o=>o.forEach(s.add,s)),s.delete(t),{minX:(e?.minX??0)/this.#f,maxX:(e?.maxX??this.#f)/this.#f,minY:(e?.minY??0)/this.#g,maxY:(e?.maxY??this.#g)/this.#g,dependencies:Array.from(s).sort((o,c)=>o-c),idx:t}))}}class Rc{#t;#e;#n=0;#i;#a=0;constructor(t,e){if(t instanceof Rc)return t;this.#t=t,this.#i=t._takePendingDependencies(),this.#e=e}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#n--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#t.hasPendingBBox||this.#t.resetBBox(this.#e),this}get hasPendingBBox(){return this.#t.hasPendingBBox}recordClipBox(t,e,n,s,o,c){return this.#t.recordClipBox(this.#e,e,n,s,o,c),this}recordBBox(t,e,n,s,o,c){return this.#t.recordBBox(this.#e,e,n,s,o,c),this}recordCharacterBBox(t,e,n,s,o,c,h){return this.#t.recordCharacterBBox(this.#e,e,n,s,o,c,h),this}recordFullPageBBox(t){return this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}copyDependenciesFromIncrementalOperation(t,e){return this.#t.copyDependenciesFromIncrementalOperation(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){this.#t.recordOperation(this.#e,!0);const e=this.#t._extractOperation(this.#e);for(const n of e.dependencies)this.#i.add(n);return this.#i.delete(this.#e),this.#i.delete(null),this}bboxToClipBoxDropOperation(t){return this.#t.bboxToClipBoxDropOperation(this.#e),this}recordNestedDependencies(){this.#t._pushPendingDependencies(this.#i)}take(){throw new Error("Unreachable")}}const Sn={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation"],transform:["transform"],transformAndFill:["transform","fillColor"]},Ne={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function lf(r,t){if(!t)return;const e=t[2]-t[0],n=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,n),r.clip(s)}class Yf{isModifyingCurrentTransform(){return!1}getPattern(){Vt("Abstract method `getPattern` called.")}}class Nw extends Yf{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,s){let o;if(s===Ne.STROKE||s===Ne.FILL){const c=e.current.getClippedPathBoundingBox(s,te(t))||[0,0,0,0],h=Math.ceil(c[2]-c[0])||1,d=Math.ceil(c[3]-c[1])||1,f=e.cachedCanvases.getCanvas("pattern",h,d),g=f.context;g.clearRect(0,0,g.canvas.width,g.canvas.height),g.beginPath(),g.rect(0,0,g.canvas.width,g.canvas.height),g.translate(-c[0],-c[1]),n=at.transform(n,[1,0,0,1,c[0],c[1]]),g.transform(...e.baseTransform),this.matrix&&g.transform(...this.matrix),lf(g,this._bbox),g.fillStyle=this._createGradient(g),g.fill(),o=t.createPattern(f.canvas,"no-repeat");const _=new DOMMatrix(n);o.setTransform(_)}else lf(t,this._bbox),o=this._createGradient(t);return o}}function Fd(r,t,e,n,s,o,c,h){const d=t.coords,f=t.colors,g=r.data,_=r.width*4;let y;d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=o,o=c,c=y),d[n+1]>d[s+1]&&(y=n,n=s,s=y,y=c,c=h,h=y),d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=o,o=c,c=y);const b=(d[e]+t.offsetX)*t.scaleX,A=(d[e+1]+t.offsetY)*t.scaleY,S=(d[n]+t.offsetX)*t.scaleX,C=(d[n+1]+t.offsetY)*t.scaleY,w=(d[s]+t.offsetX)*t.scaleX,N=(d[s+1]+t.offsetY)*t.scaleY;if(A>=N)return;const x=f[o],M=f[o+1],D=f[o+2],O=f[c],B=f[c+1],j=f[c+2],$=f[h],nt=f[h+1],tt=f[h+2],lt=Math.round(A),et=Math.round(N);let yt,At,P,L,q,J,T,G;for(let K=lt;K<=et;K++){if(K<C){const Nt=K<A?0:(A-K)/(A-C);yt=b-(b-S)*Nt,At=x-(x-O)*Nt,P=M-(M-B)*Nt,L=D-(D-j)*Nt}else{let Nt;K>N?Nt=1:C===N?Nt=0:Nt=(C-K)/(C-N),yt=S-(S-w)*Nt,At=O-(O-$)*Nt,P=B-(B-nt)*Nt,L=j-(j-tt)*Nt}let W;K<A?W=0:K>N?W=1:W=(A-K)/(A-N),q=b-(b-w)*W,J=x-(x-$)*W,T=M-(M-nt)*W,G=D-(D-tt)*W;const rt=Math.round(Math.min(yt,q)),bt=Math.round(Math.max(yt,q));let ct=_*K+rt*4;for(let Nt=rt;Nt<=bt;Nt++)W=(yt-Nt)/(yt-q),W<0?W=0:W>1&&(W=1),g[ct++]=At-(At-J)*W|0,g[ct++]=P-(P-T)*W|0,g[ct++]=L-(L-G)*W|0,g[ct++]=255}}function Ow(r,t,e){const n=t.coords,s=t.colors;let o,c;switch(t.type){case"lattice":const h=t.verticesPerRow,d=Math.floor(n.length/h)-1,f=h-1;for(o=0;o<d;o++){let g=o*h;for(let _=0;_<f;_++,g++)Fd(r,e,n[g],n[g+1],n[g+h],s[g],s[g+1],s[g+h]),Fd(r,e,n[g+h+1],n[g+1],n[g+h],s[g+h+1],s[g+1],s[g+h])}break;case"triangles":for(o=0,c=n.length;o<c;o+=3)Fd(r,e,n[o],n[o+1],n[o+2],s[o],s[o+1],s[o+2]);break;default:throw new Error("illegal figure")}}class kw extends Yf{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const h=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-h,g=Math.ceil(this._bounds[3])-d,_=Math.min(Math.ceil(Math.abs(f*t[0]*1.1)),3e3),y=Math.min(Math.ceil(Math.abs(g*t[1]*1.1)),3e3),b=f/_,A=g/y,S={coords:this._coords,colors:this._colors,offsetX:-h,offsetY:-d,scaleX:1/b,scaleY:1/A},C=_+4,w=y+4,N=n.getCanvas("mesh",C,w),x=N.context,M=x.createImageData(_,y);if(e){const O=M.data;for(let B=0,j=O.length;B<j;B+=4)O[B]=e[0],O[B+1]=e[1],O[B+2]=e[2],O[B+3]=255}for(const O of this._figures)Ow(M,O,S);return x.putImageData(M,2,2),{canvas:N.canvas,offsetX:h-2*b,offsetY:d-2*A,scaleX:b,scaleY:A}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,s){lf(t,this._bbox);const o=new Float32Array(2);if(s===Ne.SHADING)at.singularValueDecompose2dScale(te(t),o);else if(this.matrix){at.singularValueDecompose2dScale(this.matrix,o);const[h,d]=o;at.singularValueDecompose2dScale(e.baseTransform,o),o[0]*=h,o[1]*=d}else at.singularValueDecompose2dScale(e.baseTransform,o);const c=this._createMeshCanvas(o,s===Ne.SHADING?null:this._background,e.cachedCanvases);return s!==Ne.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(c.offsetX,c.offsetY),t.scale(c.scaleX,c.scaleY),t.createPattern(c.canvas,"no-repeat")}}class Lw extends Yf{getPattern(){return"hotpink"}}function Iw(r){switch(r[0]){case"RadialAxial":return new Nw(r);case"Mesh":return new kw(r);case"Dummy":return new Lw}throw new Error(`Unknown IR type: ${r[0]}`)}const Ky={COLORED:1,UNCOLORED:2};class Xf{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(t){const{bbox:e,operatorList:n,paintType:s,tilingType:o,color:c,canvasGraphicsFactory:h}=this;let{xstep:d,ystep:f}=this;d=Math.abs(d),f=Math.abs(f),Zc("TilingType: "+o);const g=e[0],_=e[1],y=e[2],b=e[3],A=y-g,S=b-_,C=new Float32Array(2);at.singularValueDecompose2dScale(this.matrix,C);const[w,N]=C;at.singularValueDecompose2dScale(this.baseTransform,C);const x=w*C[0],M=N*C[1];let D=A,O=S,B=!1,j=!1;const $=Math.ceil(d*x),nt=Math.ceil(f*M),tt=Math.ceil(A*x),lt=Math.ceil(S*M);$>=tt?D=d:B=!0,nt>=lt?O=f:j=!0;const et=this.getSizeAndScale(D,this.ctx.canvas.width,x),yt=this.getSizeAndScale(O,this.ctx.canvas.height,M),At=t.cachedCanvases.getCanvas("pattern",et.size,yt.size),P=At.context,L=h.createCanvasGraphics(P);if(L.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(L,s,c),P.translate(-et.scale*g,-yt.scale*_),L.transform(0,et.scale,0,0,yt.scale,0,0),P.save(),L.dependencyTracker?.save(),this.clipBbox(L,g,_,y,b),L.baseTransform=te(L.ctx),L.executeOperatorList(n),L.endDrawing(),L.dependencyTracker?.restore().recordNestedDependencies?.(),P.restore(),B||j){const q=At.canvas;B&&(D=d),j&&(O=f);const J=this.getSizeAndScale(D,this.ctx.canvas.width,x),T=this.getSizeAndScale(O,this.ctx.canvas.height,M),G=J.size,K=T.size,W=t.cachedCanvases.getCanvas("pattern-workaround",G,K),rt=W.context,bt=B?Math.floor(A/d):0,ct=j?Math.floor(S/f):0;for(let Nt=0;Nt<=bt;Nt++)for(let Bt=0;Bt<=ct;Bt++)rt.drawImage(q,G*Nt,K*Bt,G,K,0,0,G,K);return{canvas:W.canvas,scaleX:J.scale,scaleY:T.scale,offsetX:g,offsetY:_}}return{canvas:At.canvas,scaleX:et.scale,scaleY:yt.scale,offsetX:g,offsetY:_}}getSizeAndScale(t,e,n){const s=Math.max(Xf.MAX_PATTERN_SIZE,e);let o=Math.ceil(t*n);return o>=s?o=s:n=o/t,{scale:n,size:o}}clipBbox(t,e,n,s,o){const c=s-e,h=o-n;t.ctx.rect(e,n,c,h),at.axialAlignedBoundingBox([e,n,s,o],te(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const s=t.ctx,o=t.current;switch(e){case Ky.COLORED:const{fillStyle:c,strokeStyle:h}=this.ctx;s.fillStyle=o.fillColor=c,s.strokeStyle=o.strokeColor=h;break;case Ky.UNCOLORED:s.fillStyle=s.strokeStyle=n,o.fillColor=o.strokeColor=n;break;default:throw new JE(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,s){let o=n;s!==Ne.SHADING&&(o=at.transform(o,e.baseTransform),this.matrix&&(o=at.transform(o,this.matrix)));const c=this.createPatternCanvas(e);let h=new DOMMatrix(o);h=h.translate(c.offsetX,c.offsetY),h=h.scale(1/c.scaleX,1/c.scaleY);const d=t.createPattern(c.canvas,"repeat");return d.setTransform(h),d}}function Pw({src:r,srcPos:t=0,dest:e,width:n,height:s,nonBlackColor:o=4294967295,inverseDecode:c=!1}){const h=ke.isLittleEndian?4278190080:255,[d,f]=c?[o,h]:[h,o],g=n>>3,_=n&7,y=r.length;e=new Uint32Array(e.buffer);let b=0;for(let A=0;A<s;A++){for(const C=t+g;t<C;t++){const w=t<y?r[t]:255;e[b++]=w&128?f:d,e[b++]=w&64?f:d,e[b++]=w&32?f:d,e[b++]=w&16?f:d,e[b++]=w&8?f:d,e[b++]=w&4?f:d,e[b++]=w&2?f:d,e[b++]=w&1?f:d}if(_===0)continue;const S=t<y?r[t++]:255;for(let C=0;C<_;C++)e[b++]=S&1<<7-C?f:d}return{srcPos:t,destPos:b}}const Qy=16,Zy=100,Bw=15,Jy=10,Ke=16,Hd=new DOMMatrix,hn=new Float32Array(2),Pa=new Float32Array([1/0,1/0,-1/0,-1/0]);function Fw(r,t){if(r._removeMirroring)throw new Error("Context is already forwarding operations.");r.__originalSave=r.save,r.__originalRestore=r.restore,r.__originalRotate=r.rotate,r.__originalScale=r.scale,r.__originalTranslate=r.translate,r.__originalTransform=r.transform,r.__originalSetTransform=r.setTransform,r.__originalResetTransform=r.resetTransform,r.__originalClip=r.clip,r.__originalMoveTo=r.moveTo,r.__originalLineTo=r.lineTo,r.__originalBezierCurveTo=r.bezierCurveTo,r.__originalRect=r.rect,r.__originalClosePath=r.closePath,r.__originalBeginPath=r.beginPath,r._removeMirroring=()=>{r.save=r.__originalSave,r.restore=r.__originalRestore,r.rotate=r.__originalRotate,r.scale=r.__originalScale,r.translate=r.__originalTranslate,r.transform=r.__originalTransform,r.setTransform=r.__originalSetTransform,r.resetTransform=r.__originalResetTransform,r.clip=r.__originalClip,r.moveTo=r.__originalMoveTo,r.lineTo=r.__originalLineTo,r.bezierCurveTo=r.__originalBezierCurveTo,r.rect=r.__originalRect,r.closePath=r.__originalClosePath,r.beginPath=r.__originalBeginPath,delete r._removeMirroring},r.save=function(){t.save(),this.__originalSave()},r.restore=function(){t.restore(),this.__originalRestore()},r.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},r.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},r.transform=function(e,n,s,o,c,h){t.transform(e,n,s,o,c,h),this.__originalTransform(e,n,s,o,c,h)},r.setTransform=function(e,n,s,o,c,h){t.setTransform(e,n,s,o,c,h),this.__originalSetTransform(e,n,s,o,c,h)},r.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},r.rotate=function(e){t.rotate(e),this.__originalRotate(e)},r.clip=function(e){t.clip(e),this.__originalClip(e)},r.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},r.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},r.bezierCurveTo=function(e,n,s,o,c,h){t.bezierCurveTo(e,n,s,o,c,h),this.__originalBezierCurveTo(e,n,s,o,c,h)},r.rect=function(e,n,s,o){t.rect(e,n,s,o),this.__originalRect(e,n,s,o)},r.closePath=function(){t.closePath(),this.__originalClosePath()},r.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Hw{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,n)):(s=this.canvasFactory.create(e,n),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function _c(r,t,e,n,s,o,c,h,d,f){const[g,_,y,b,A,S]=te(r);if(_===0&&y===0){const N=c*g+A,x=Math.round(N),M=h*b+S,D=Math.round(M),O=(c+d)*g+A,B=Math.abs(Math.round(O)-x)||1,j=(h+f)*b+S,$=Math.abs(Math.round(j)-D)||1;return r.setTransform(Math.sign(g),0,0,Math.sign(b),x,D),r.drawImage(t,e,n,s,o,0,0,B,$),r.setTransform(g,_,y,b,A,S),[B,$]}if(g===0&&b===0){const N=h*y+A,x=Math.round(N),M=c*_+S,D=Math.round(M),O=(h+f)*y+A,B=Math.abs(Math.round(O)-x)||1,j=(c+d)*_+S,$=Math.abs(Math.round(j)-D)||1;return r.setTransform(0,Math.sign(_),Math.sign(y),0,x,D),r.drawImage(t,e,n,s,o,0,0,$,B),r.setTransform(g,_,y,b,A,S),[$,B]}r.drawImage(t,e,n,s,o,c,h,d,f);const C=Math.hypot(g,_),w=Math.hypot(y,b);return[C*d,w*f]}class tb{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=ef;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=De.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,n){n?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Pa.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Ne.FILL,e=null){const n=this.minMax.slice();if(t===Ne.STROKE){e||Vt("Stroke bounding box must include transform."),at.singularValueDecompose2dScale(e,hn);const s=hn[0]*this.lineWidth/2,o=hn[1]*this.lineWidth/2;n[0]-=s,n[1]-=o,n[2]+=s,n[3]+=o}return n}updateClipFromPath(){const t=at.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Pa,0)}getClippedPathBoundingBox(t=Ne.FILL,e=null){return at.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function eb(r,t){if(t instanceof ImageData){r.putImageData(t,0,0);return}const e=t.height,n=t.width,s=e%Ke,o=(e-s)/Ke,c=s===0?o:o+1,h=r.createImageData(n,Ke);let d=0,f;const g=t.data,_=h.data;let y,b,A,S;if(t.kind===Ec.GRAYSCALE_1BPP){const C=g.byteLength,w=new Uint32Array(_.buffer,0,_.byteLength>>2),N=w.length,x=n+7>>3,M=4294967295,D=ke.isLittleEndian?4278190080:255;for(y=0;y<c;y++){for(A=y<o?Ke:s,f=0,b=0;b<A;b++){const O=C-d;let B=0;const j=O>x?n:O*8-7,$=j&-8;let nt=0,tt=0;for(;B<$;B+=8)tt=g[d++],w[f++]=tt&128?M:D,w[f++]=tt&64?M:D,w[f++]=tt&32?M:D,w[f++]=tt&16?M:D,w[f++]=tt&8?M:D,w[f++]=tt&4?M:D,w[f++]=tt&2?M:D,w[f++]=tt&1?M:D;for(;B<j;B++)nt===0&&(tt=g[d++],nt=128),w[f++]=tt&nt?M:D,nt>>=1}for(;f<N;)w[f++]=0;r.putImageData(h,0,y*Ke)}}else if(t.kind===Ec.RGBA_32BPP){for(b=0,S=n*Ke*4,y=0;y<o;y++)_.set(g.subarray(d,d+S)),d+=S,r.putImageData(h,0,b),b+=Ke;y<c&&(S=n*s*4,_.set(g.subarray(d,d+S)),r.putImageData(h,0,b))}else if(t.kind===Ec.RGB_24BPP)for(A=Ke,S=n*A,y=0;y<c;y++){for(y>=o&&(A=s,S=n*A),f=0,b=S;b--;)_[f++]=g[d++],_[f++]=g[d++],_[f++]=g[d++],_[f++]=255;r.putImageData(h,0,y*Ke)}else throw new Error(`bad image kind: ${t.kind}`)}function nb(r,t){if(t.bitmap){r.drawImage(t.bitmap,0,0);return}const e=t.height,n=t.width,s=e%Ke,o=(e-s)/Ke,c=s===0?o:o+1,h=r.createImageData(n,Ke);let d=0;const f=t.data,g=h.data;for(let _=0;_<c;_++){const y=_<o?Ke:s;({srcPos:d}=Pw({src:f,srcPos:d,dest:g,width:n,height:y,nonBlackColor:0})),r.putImageData(h,0,_*Ke)}}function oo(r,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of e)r[n]!==void 0&&(t[n]=r[n]);r.setLineDash!==void 0&&(t.setLineDash(r.getLineDash()),t.lineDashOffset=r.lineDashOffset)}function yc(r){r.strokeStyle=r.fillStyle="#000000",r.fillRule="nonzero",r.globalAlpha=1,r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.miterLimit=10,r.globalCompositeOperation="source-over",r.font="10px sans-serif",r.setLineDash!==void 0&&(r.setLineDash([]),r.lineDashOffset=0);const{filter:t}=r;t!=="none"&&t!==""&&(r.filter="none")}function ib(r,t){if(t)return!0;at.singularValueDecompose2dScale(r,hn);const e=Math.fround(Wn.pixelRatio*Wa.PDF_TO_CSS_UNITS);return hn[0]<=e&&hn[1]<=e}const zw=["butt","round","square"],Uw=["miter","round","bevel"],jw={},sb={};class Ua{constructor(t,e,n,s,o,{optionalContentConfig:c,markedContentStack:h=null},d,f,g){this.ctx=t,this.current=new tb(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=s,this.filterFactory=o,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=h||[],this.optionalContentConfig=c,this.cachedCanvases=new Hw(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=g??null}getObject(t,e,n=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):n}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:s=null}){const o=this.ctx.canvas.width,c=this.ctx.canvas.height,h=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,o,c),this.ctx.fillStyle=h,n){const d=this.cachedCanvases.getCanvas("transparent",o,c);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...te(this.compositeCtx))}this.ctx.save(),yc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=te(this.ctx)}executeOperatorList(t,e,n,s,o){const c=t.argsArray,h=t.fnArray;let d=e||0;const f=c.length;if(f===d)return d;const g=f-d>Jy&&typeof n=="function",_=g?Date.now()+Bw:0;let y=0;const b=this.commonObjs,A=this.objs;let S,C;for(;;){if(s!==void 0&&d===s.nextBreakPoint)return s.breakIt(d,n),d;if(!o||o.has(d))if(S=h[d],C=c[d]??null,S!==To.dependency)C===null?this[S](d):this[S](d,...C);else for(const w of C){this.dependencyTracker?.recordNamedData(w,d);const N=w.startsWith("g_")?b:A;if(!N.has(w))return N.get(w,n),d}if(d++,d===f)return d;if(g&&++y>Jy){if(Date.now()>_)return n(),d;y=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,s=t.height??t.displayHeight;let o=Math.max(Math.hypot(e[0],e[1]),1),c=Math.max(Math.hypot(e[2],e[3]),1),h=n,d=s,f="prescale1",g,_;for(;o>2&&h>1||c>2&&d>1;){let y=h,b=d;o>2&&h>1&&(y=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2),o/=h/y),c>2&&d>1&&(b=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,c/=d/b),g=this.cachedCanvases.getCanvas(f,y,b),_=g.context,_.clearRect(0,0,y,b),_.drawImage(t,0,0,h,d,0,0,y,b),t=g.canvas,h=y,d=b,f=f==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:h,paintHeight:d}}_createMaskCanvas(t,e){const n=this.ctx,{width:s,height:o}=e,c=this.current.fillColor,h=this.current.patternFill,d=te(n);let f,g,_,y;if((e.bitmap||e.data)&&e.count>1){const nt=e.bitmap||e.data.buffer;g=JSON.stringify(h?d:[d.slice(0,4),c]),f=this._cachedBitmapsMap.get(nt),f||(f=new Map,this._cachedBitmapsMap.set(nt,f));const tt=f.get(g);if(tt&&!h){const lt=Math.round(Math.min(d[0],d[2])+d[4]),et=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(t,Sn.transformAndFill),{canvas:tt,offsetX:lt,offsetY:et}}_=tt}_||(y=this.cachedCanvases.getCanvas("maskCanvas",s,o),nb(y.context,e));let b=at.transform(d,[1/s,0,0,-1/o,0,0]);b=at.transform(b,[1,0,0,1,0,-o]);const A=Pa.slice();at.axialAlignedBoundingBox([0,0,s,o],b,A);const[S,C,w,N]=A,x=Math.round(w-S)||1,M=Math.round(N-C)||1,D=this.cachedCanvases.getCanvas("fillCanvas",x,M),O=D.context,B=S,j=C;O.translate(-B,-j),O.transform(...b),_||(_=this._scaleImage(y.canvas,Vn(O)),_=_.img,f&&h&&f.set(g,_)),O.imageSmoothingEnabled=ib(te(O),e.interpolate),_c(O,_,0,0,_.width,_.height,0,0,s,o),O.globalCompositeOperation="source-in";const $=at.transform(Vn(O),[1,0,0,1,-B,-j]);return O.fillStyle=h?c.getPattern(n,this,$,Ne.FILL):c,O.fillRect(0,0,s,o),f&&!h&&(this.cachedCanvases.delete("fillCanvas"),f.set(g,D.canvas)),this.dependencyTracker?.recordDependencies(t,Sn.transformAndFill),{canvas:D.canvas,offsetX:Math.round(B),offsetY:Math.round(j)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=zw[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=Uw[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,n){this.dependencyTracker?.recordSimpleData("dash",t);const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=n)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[n,s]of e)switch(n){case"LW":this.setLineWidth(t,s);break;case"LC":this.setLineCap(t,s);break;case"LJ":this.setLineJoin(t,s);break;case"ML":this.setMiterLimit(t,s);break;case"D":this.setDash(t,s[0],s[1]);break;case"RI":this.setRenderingIntent(t,s);break;case"FL":this.setFlatness(t,s);break;case"Font":this.setFont(t,s[0],s[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=s;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=s;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(s,e,n);this.suspendedCtx=this.ctx;const c=this.ctx=o.context;c.setTransform(this.suspendedCtx.getTransform()),oo(this.suspendedCtx,c),Fw(c,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),oo(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,s){const o=s[0],c=s[1],h=s[2]-o,d=s[3]-c;h===0||d===0||(this.genericComposeSMask(e.context,n,h,d,e.subtype,e.backdrop,e.transferMap,o,c,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,s,o,c,h,d,f,g,_){let y=t.canvas,b=d-g,A=f-_;if(c)if(b<0||A<0||b+n>y.width||A+s>y.height){const C=this.cachedCanvases.getCanvas("maskExtension",n,s),w=C.context;w.drawImage(y,-b,-A),w.globalCompositeOperation="destination-atop",w.fillStyle=c,w.fillRect(0,0,n,s),w.globalCompositeOperation="source-over",y=C.canvas,b=A=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const C=new Path2D;C.rect(b,A,n,s),t.clip(C),t.globalCompositeOperation="destination-atop",t.fillStyle=c,t.fillRect(b,A,n,s),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),o==="Alpha"&&h?e.filter=this.filterFactory.addAlphaFilter(h):o==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(h));const S=new Path2D;S.rect(d,f,n,s),e.clip(S),e.globalCompositeOperation="destination-in",e.drawImage(y,b,A,n,s,d,f,n,s),e.restore()}save(t){this.inSMaskMode&&oo(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&oo(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,n,s,o,c,h){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,n,s,o,c,h),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n,s){let[o]=n;if(!s){o||=n[0]=new Path2D,this[e](t,o);return}if(this.dependencyTracker!==null){const c=e===To.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,s[0]-c,s[2]+c,s[1]-c,s[3]+c).recordDependencies(t,["transform"])}if(!(o instanceof Path2D)){const c=n[0]=new Path2D;for(let h=0,d=o.length;h<d;)switch(o[h++]){case fc.moveTo:c.moveTo(o[h++],o[h++]);break;case fc.lineTo:c.lineTo(o[h++],o[h++]);break;case fc.curveTo:c.bezierCurveTo(o[h++],o[h++],o[h++],o[h++],o[h++],o[h++]);break;case fc.closePath:c.closePath();break;default:vt(`Unrecognized drawing path operator: ${o[h-1]}`);break}o=c}at.axialAlignedBoundingBox(s,te(this.ctx),this.current.minMax),this[e](t,o),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,n=!0){const s=this.ctx,o=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof o=="object"&&o?.getPattern){const c=o.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=o.getPattern(s,this,Vn(s),Ne.STROKE),c){const h=new Path2D;h.addPath(e,s.getTransform().invertSelf().multiplySelf(c)),e=h}this.rescaleAndStroke(e,!1),s.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Sn.stroke),n&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(Ne.STROKE,te(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,n=!0){const s=this.ctx,o=this.current.fillColor,c=this.current.patternFill;let h=!1;if(c){const f=o.isModifyingCurrentTransform()?s.getTransform():null;if(this.dependencyTracker?.save(t),s.save(),s.fillStyle=o.getPattern(s,this,Vn(s),Ne.FILL),f){const g=new Path2D;g.addPath(e,s.getTransform().invertSelf().multiplySelf(f)),e=g}h=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(s.fill(e,"evenodd"),this.pendingEOFill=!1):s.fill(e)),this.dependencyTracker?.recordDependencies(t,Sn.fill),h&&(s.restore(),this.dependencyTracker?.restore(t)),n&&this.consumePath(t,e,d)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Sn.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=jw}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=sb}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:s}=this;e!==void 0&&s.recordFutureForcedDependency("textClip",s.getOpenMarker()).recordFutureForcedDependency("textClip",t),s.recordCloseMarker(t)}if(e!==void 0){const s=new Path2D,o=n.getTransform().invertSelf();for(const{transform:c,x:h,y:d,fontSize:f,path:g}of e)g&&s.addPath(g,new DOMMatrix(c).preMultiplySelf(o).translate(h,d).scale(f,-f));n.clip(s)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,n){this.dependencyTracker?.recordSimpleData("font",t).recordNamedDependency(t,e);const s=this.commonObjs.get(e),o=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(o.fontMatrix=s.fontMatrix||ef,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&vt("Invalid font matrix for font "+e),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=s,this.current.fontSize=n,s.isType3Font)return;const c=s.loadedName||"sans-serif",h=s.systemFontInfo?.css||`"${c}", ${s.fallbackName}`;let d="normal";s.black?d="900":s.bold&&(d="bold");const f=s.italic?"italic":"normal";let g=n;n<Qy?g=Qy:n>Zy&&(g=Zy),this.current.fontSizeScale=n/g,this.ctx.font=`${f} ${d} ${g}px ${h}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(t,e,n){this.setLeading(t,-n),this.moveText(t,e,n)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:n}=this;n.textMatrix=e,n.textMatrixScale=Math.hypot(e[0],e[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#n(t,e,n){const s=new Path2D;return s.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),s}paintChar(t,e,n,s,o,c){const h=this.ctx,d=this.current,f=d.font,g=d.textRenderingMode,_=d.fontSize/d.fontSizeScale,y=g&De.FILL_STROKE_MASK,b=!!(g&De.ADD_TO_PATH_FLAG),A=d.patternFill&&!f.missingFile,S=d.patternStroke&&!f.missingFile;let C;if((f.disableFontFace||b||A||S)&&!f.missingFile&&(C=f.getPathGenerator(this.commonObjs,e)),C&&(f.disableFontFace||A||S)){h.save(),h.translate(n,s),h.scale(_,-_),this.dependencyTracker?.recordCharacterBBox(t,h,f);let w;if(y===De.FILL||y===De.FILL_STROKE)if(o){w=h.getTransform(),h.setTransform(...o);const N=this.#n(C,w,o);h.fill(N)}else h.fill(C);if(y===De.STROKE||y===De.FILL_STROKE)if(c){w||=h.getTransform(),h.setTransform(...c);const{a:N,b:x,c:M,d:D}=w,O=at.inverseTransform(c),B=at.transform([N,x,M,D,0,0],O);at.singularValueDecompose2dScale(B,hn),h.lineWidth*=Math.max(hn[0],hn[1])/_,h.stroke(this.#n(C,w,c))}else h.lineWidth/=_,h.stroke(C);h.restore()}else(y===De.FILL||y===De.FILL_STROKE)&&(h.fillText(e,n,s),this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,s,()=>h.measureText(e))),(y===De.STROKE||y===De.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,s,()=>h.measureText(e)).recordDependencies(t,Sn.stroke),h.strokeText(e,n,s));b&&((this.pendingTextPaths||=[]).push({transform:te(h),x:n,y:s,fontSize:_,path:C}),this.dependencyTracker?.recordCharacterBBox(t,h,f,_,n,s))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){n=!0;break}return Tt(this,"isFontSubpixelAAEnabled",n)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Sn.showText).copyDependenciesFromIncrementalOperation(t,"sameLineText").resetBBox(t),this.current.textRenderingMode&De.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,s=n.font;if(s.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t);return}const o=n.fontSize;if(o===0){this.dependencyTracker?.recordOperation(t);return}const c=this.ctx,h=n.fontSizeScale,d=n.charSpacing,f=n.wordSpacing,g=n.fontDirection,_=n.textHScale*g,y=e.length,b=s.vertical,A=b?1:-1,S=s.defaultVMetrics,C=o*n.fontMatrix[0],w=n.textRenderingMode===De.FILL&&!s.disableFontFace&&!n.patternFill;c.save(),n.textMatrix&&c.transform(...n.textMatrix),c.translate(n.x,n.y+n.textRise),g>0?c.scale(_,-1):c.scale(_,1);let N,x;if(n.patternFill){c.save();const j=n.fillColor.getPattern(c,this,Vn(c),Ne.FILL);N=te(c),c.restore(),c.fillStyle=j}if(n.patternStroke){c.save();const j=n.strokeColor.getPattern(c,this,Vn(c),Ne.STROKE);x=te(c),c.restore(),c.strokeStyle=j}let M=n.lineWidth;const D=n.textMatrixScale;if(D===0||M===0){const j=n.textRenderingMode&De.FILL_STROKE_MASK;(j===De.STROKE||j===De.FILL_STROKE)&&(M=this.getSinglePixelWidth())}else M/=D;if(h!==1&&(c.scale(h,h),M/=h),c.lineWidth=M,s.isInvalidPDFjsFont){const j=[];let $=0;for(const tt of e)j.push(tt.unicode),$+=tt.width;const nt=j.join("");if(c.fillText(nt,0,0),this.dependencyTracker!==null){const tt=c.measureText(nt);this.dependencyTracker.recordBBox(t,this.ctx,-tt.actualBoundingBoxLeft,tt.actualBoundingBoxRight,-tt.actualBoundingBoxAscent,tt.actualBoundingBoxDescent).recordOperation(t).recordIncrementalData("sameLineText",t)}n.x+=$*C*_,c.restore(),this.compose();return}let O=0,B;for(B=0;B<y;++B){const j=e[B];if(typeof j=="number"){O+=A*j*o/1e3;continue}let $=!1;const nt=(j.isSpace?f:0)+d,tt=j.fontChar,lt=j.accent;let et,yt,At=j.width;if(b){const q=j.vmetric||S,J=-(j.vmetric?q[1]:At*.5)*C,T=q[2]*C;At=q?-q[0]:At,et=J/h,yt=(O+T)/h}else et=O/h,yt=0;let P;if(s.remeasure&&At>0){P=c.measureText(tt);const q=P.width*1e3/o*h;if(At<q&&this.isFontSubpixelAAEnabled){const J=At/q;$=!0,c.save(),c.scale(J,1),et/=J}else At!==q&&(et+=(At-q)/2e3*o/h)}if(this.contentVisible&&(j.isInFont||s.missingFile)){if(w&&!lt)c.fillText(tt,et,yt),this.dependencyTracker?.recordCharacterBBox(t,c,P?{bbox:null}:s,o/h,et,yt,()=>P??c.measureText(tt));else if(this.paintChar(t,tt,et,yt,N,x),lt){const q=et+o*lt.offset.x/h,J=yt-o*lt.offset.y/h;this.paintChar(t,lt.fontChar,q,J,N,x)}}const L=b?At*C-nt*g:At*C+nt*g;O+=L,$&&c.restore()}b?n.y-=O:n.x+=O*_,c.restore(),this.compose(),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t)}showType3Text(t,e){const n=this.ctx,s=this.current,o=s.font,c=s.fontSize,h=s.fontDirection,d=o.vertical?1:-1,f=s.charSpacing,g=s.wordSpacing,_=s.textHScale*h,y=s.fontMatrix||ef,b=e.length,A=s.textRenderingMode===De.INVISIBLE;let S,C,w,N;if(A||c===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),s.textMatrix&&n.transform(...s.textMatrix),n.translate(s.x,s.y+s.textRise),n.scale(_,h);const x=this.dependencyTracker;for(this.dependencyTracker=x?new Rc(x,t):null,S=0;S<b;++S){if(C=e[S],typeof C=="number"){N=d*C*c/1e3,this.ctx.translate(N,0),s.x+=N*_;continue}const M=(C.isSpace?g:0)+f,D=o.charProcOperatorList[C.operatorListId];D?this.contentVisible&&(this.save(),n.scale(c,c),n.transform(...y),this.executeOperatorList(D),this.restore()):vt(`Type3 character "${C.operatorListId}" is not available.`);const O=[C.width,0];at.applyTransform(O,y),w=O[0]*c+M,n.translate(w,0),s.x+=w*_}n.restore(),x&&(this.dependencyTracker.recordNestedDependencies(),this.dependencyTracker=x)}setCharWidth(t,e,n){}setCharWidthAndBounds(t,e,n,s,o,c,h){const d=new Path2D;d.rect(s,o,c-s,h-o),this.ctx.clip(d),this.dependencyTracker?.recordBBox(t,this.ctx,s,c,o,h).recordClipBox(t,this.ctx,s,c,o,h),this.endPath(t)}getColorN_Pattern(t,e){let n;if(e[0]==="TilingPattern"){const s=this.baseTransform||te(this.ctx),o={createCanvasGraphics:c=>new Ua(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Rc(this.dependencyTracker,t):null)};n=new Xf(e,this.ctx,o,s)}else n=this._getPattern(t,e[1],e[2]);return n}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,n=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=Iw(this.getObject(t,e)),this.cachedPatterns.set(e,s)),n&&(s.matrix=n),s}shadingFill(t,e){if(!this.contentVisible)return;const n=this.ctx;this.save(t);const s=this._getPattern(t,e);n.fillStyle=s.getPattern(n,this,Vn(n),Ne.SHADING);const o=Vn(n);if(o){const{width:c,height:h}=n.canvas,d=Pa.slice();at.axialAlignedBoundingBox([0,0,c,h],o,d);const[f,g,_,y]=d;this.ctx.fillRect(f,g,_-f,y-g)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Sn.transform).recordDependencies(t,Sn.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Vt("Should not call beginInlineImage")}beginImageData(){Vt("Should not call beginImageData")}paintFormXObjectBegin(t,e,n){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=te(this.ctx),n)){at.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[s,o,c,h]=n,d=new Path2D;d.rect(s,o,c-s,h-o),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(t,this.ctx,s,c,o,h),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||Zc("TODO: Support non-isolated groups."),e.knockout&&vt("Knockout groups not supported.");const s=te(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let o=Pa.slice();at.axialAlignedBoundingBox(e.bbox,te(n),o);const c=[0,0,n.canvas.width,n.canvas.height];o=at.intersect(o,c)||[0,0,0,0];const h=Math.floor(o[0]),d=Math.floor(o[1]),f=Math.max(Math.ceil(o[2])-h,1),g=Math.max(Math.ceil(o[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,g]);let _="groupAt"+this.groupLevel;e.smask&&(_+="_smask_"+this.smaskCounter++%2);const y=this.cachedCanvases.getCanvas(_,f,g),b=y.context;b.translate(-h,-d),b.transform(...s);let A=new Path2D;const[S,C,w,N]=e.bbox;if(A.rect(S,C,w-S,N-C),e.matrix){const x=new Path2D;x.addPath(A,new DOMMatrix(e.matrix)),A=x}b.clip(A),e.smask&&this.smaskStack.push({canvas:y.canvas,context:b,offsetX:h,offsetY:d,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(h,d),n.save()),oo(n,b),this.ctx=b,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=te(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...o);const c=Pa.slice();at.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,c),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(c)}}beginAnnotation(t,e,n,s,o,c){if(this.#t(),yc(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const h=n[2]-n[0],d=n[3]-n[1];if(c&&this.annotationCanvasMap){s=s.slice(),s[4]-=n[0],s[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=h,n[3]=d,at.singularValueDecompose2dScale(te(this.ctx),hn);const{viewportScale:f}=this,g=Math.ceil(h*this.outputScaleX*f),_=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(g,_);const{canvas:y,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(e,y),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(hn[0],0,0,-hn[1],0,d*hn[1]),yc(this.ctx)}else{yc(this.ctx),this.endPath(t);const f=new Path2D;f.rect(n[0],n[1],h,d),this.ctx.clip(f)}}this.current=new tb(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...s),this.transform(t,...o)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(t,e.data,e),e.count=n;const s=this.ctx,o=this._createMaskCanvas(t,e),c=o.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(c,o.offsetX,o.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,o.offsetX,o.offsetX+c.width,o.offsetY,o.offsetY+c.height).recordOperation(t),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n,s=0,o=0,c,h){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const d=this.ctx;d.save();const f=te(d);d.transform(n,s,o,c,0,0);const g=this._createMaskCanvas(t,e);d.setTransform(1,0,0,1,g.offsetX-f[4],g.offsetY-f[5]),this.dependencyTracker?.resetBBox(t);for(let _=0,y=h.length;_<y;_+=2){const b=at.transform(f,[n,s,o,c,h[_],h[_+1]]);d.drawImage(g.canvas,b[4],b[5]),this.dependencyTracker?.recordBBox(t,this.ctx,b[4],b[4]+g.canvas.width,b[5],b[5]+g.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx,s=this.current.fillColor,o=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Sn.transformAndFill);for(const c of e){const{data:h,width:d,height:f,transform:g}=c,_=this.cachedCanvases.getCanvas("maskCanvas",d,f),y=_.context;y.save();const b=this.getObject(t,h,c);nb(y,b),y.globalCompositeOperation="source-in",y.fillStyle=o?s.getPattern(y,this,Vn(n),Ne.FILL):s,y.fillRect(0,0,d,f),y.restore(),n.save(),n.transform(...g),n.scale(1,-1),_c(n,_.canvas,0,0,d,f,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,d,0,f),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const n=this.getObject(t,e);if(!n){vt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,n)}paintImageXObjectRepeat(t,e,n,s,o){if(!this.contentVisible)return;const c=this.getObject(t,e);if(!c){vt("Dependent image isn't ready yet");return}const h=c.width,d=c.height,f=[];for(let g=0,_=o.length;g<_;g+=2)f.push({transform:[n,0,0,s,o[g],o[g+1]],x:0,y:0,w:h,h:d});this.paintInlineImageXObjectGroup(t,c,f)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:n,height:s}=t,o=this.cachedCanvases.getCanvas("inlineImage",n,s),c=o.context;return c.filter=this.current.transferMaps,c.drawImage(e,0,0),c.filter="none",o.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const n=e.width,s=e.height,o=this.ctx;this.save(t);const{filter:c}=o;c!=="none"&&c!==""&&(o.filter="none"),o.scale(1/n,-1/s);let h;if(e.bitmap)h=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)h=e;else{const g=this.cachedCanvases.getCanvas("inlineImage",n,s).context;eb(g,e),h=this.applyTransferMapsToCanvas(g)}const d=this._scaleImage(h,Vn(o));o.imageSmoothingEnabled=ib(te(o),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,o,0,n,-s,0).recordDependencies(t,Sn.imageXObject).recordOperation(t),_c(o,d.img,0,0,d.paintWidth,d.paintHeight,0,-s,n,s),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,n){if(!this.contentVisible)return;const s=this.ctx;let o;if(e.bitmap)o=e.bitmap;else{const c=e.width,h=e.height,f=this.cachedCanvases.getCanvas("inlineImage",c,h).context;eb(f,e),o=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(t);for(const c of n)s.save(),s.transform(...c.transform),s.scale(1,-1),_c(s,o,c.x,c.y,c.w,c.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,1,-1,0),s.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Sn.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,n){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,n){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,n){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const o=this.ctx;this.pendingClip?(s||(this.pendingClip===sb?o.clip(e,"evenodd"):o.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=te(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:n,c:s,d:o}=this.ctx.getTransform();let c,h;if(n===0&&s===0){const d=Math.abs(e),f=Math.abs(o);if(d===f)if(t===0)c=h=1/d;else{const g=d*t;c=h=g<1?1/g:1}else if(t===0)c=1/d,h=1/f;else{const g=d*t,_=f*t;c=g<1?1/g:1,h=_<1?1/_:1}}else{const d=Math.abs(e*o-n*s),f=Math.hypot(e,n),g=Math.hypot(s,o);if(t===0)c=g/d,h=f/d;else{const _=t*d;c=g>_?g/_:1,h=f>_?f/_:1}}this._cachedScaleForStroking[0]=c,this._cachedScaleForStroking[1]=h}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:s}}=this,[o,c]=this.getScaleForStroking();if(o===c){n.lineWidth=(s||1)*o,n.stroke(t);return}const h=n.getLineDash();e&&n.save(),n.scale(o,c),Hd.a=1/o,Hd.d=1/c;const d=new Path2D;if(d.addPath(t,Hd),h.length>0){const f=Math.max(o,c);n.setLineDash(h.map(g=>g/f)),n.lineDashOffset/=f}n.lineWidth=s||1,n.stroke(d),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const r in To)Ua.prototype[r]!==void 0&&(Ua.prototype[To[r]]=Ua.prototype[r]);class ja{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class Gw{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const La=Symbol("INTERNAL");class Vw{#t=!1;#e=!1;#n=!1;#i=!0;constructor(t,{name:e,intent:n,usage:s,rbGroups:o}){this.#t=!!(t&un.DISPLAY),this.#e=!!(t&un.PRINT),this.name=e,this.intent=n,this.usage=s,this.rbGroups=o}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,n=!1){t!==La&&Vt("Internal method `_setVisible` called."),this.#n=n,this.#i=e}}class qw{#t=null;#e=new Map;#n=null;#i=null;constructor(t,e=un.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#i=t.order;for(const n of t.groups)this.#e.set(n.id,new Vw(e,n));if(t.baseState==="OFF")for(const n of this.#e.values())n._setVisible(La,!1);for(const n of t.on)this.#e.get(n)._setVisible(La,!0);for(const n of t.off)this.#e.get(n)._setVisible(La,!1);this.#n=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let s=1;s<e;s++){const o=t[s];let c;if(Array.isArray(o))c=this.#a(o);else if(this.#e.has(o))c=this.#e.get(o).visible;else return vt(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!c)return!1;break;case"Or":if(c)return!0;break;case"Not":return!c;default:return!0}}return n==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Zc("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(vt(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return vt(`Unknown optional content policy ${t.policy}.`),!0}return vt(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){const s=this.#e.get(t);if(!s){vt(`Optional content group not found: ${t}`);return}if(n&&e&&s.rbGroups.length)for(const o of s.rbGroups)for(const c of o)c!==t&&this.#e.get(c)?._setVisible(La,!1,!0);s._setVisible(La,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let n;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}const o=this.#e.get(s);if(o)switch(n){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!o.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new mv;for(const[e,n]of this.#e)t.update(`${e}:${n.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Yw{constructor(t,{disableRange:e=!1,disableStream:n=!1}){ge(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:o,progressiveDone:c,contentDispositionFilename:h}=t;if(this._queuedChunks=[],this._progressiveDone=c,this._contentDispositionFilename=h,o?.length>0){const d=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),t.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),t.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const s=this._rangeReaders.some(function(o){return o._begin!==t?!1:(o._enqueue(n),!0)});ge(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){ge(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Xw(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new $w(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class Xw{constructor(t,e,n=!1,s=null){this._stream=t,this._done=n||!1,this._filename=Uf(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class $w{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Ww(r){let t=!0,e=n("filename\\*","i").exec(r);if(e){e=e[1];let g=h(e);return g=unescape(g),g=d(g),g=f(g),o(g)}if(e=c(r),e){const g=f(e);return o(g)}if(e=n("filename","i").exec(r),e){e=e[1];let g=h(e);return g=f(g),o(g)}function n(g,_){return new RegExp("(?:^|;)\\s*"+g+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',_)}function s(g,_){if(g){if(!/^[\x00-\xFF]+$/.test(_))return _;try{const y=new TextDecoder(g,{fatal:!0}),b=Uo(_);_=y.decode(b),t=!1}catch{}}return _}function o(g){return t&&/[\x80-\xff]/.test(g)&&(g=s("utf-8",g),t&&(g=s("iso-8859-1",g))),g}function c(g){const _=[];let y;const b=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(y=b.exec(g))!==null;){let[,S,C,w]=y;if(S=parseInt(S,10),S in _){if(S===0)break;continue}_[S]=[C,w]}const A=[];for(let S=0;S<_.length&&S in _;++S){let[C,w]=_[S];w=h(w),C&&(w=unescape(w),S===0&&(w=d(w))),A.push(w)}return A.join("")}function h(g){if(g.startsWith('"')){const _=g.slice(1).split('\\"');for(let y=0;y<_.length;++y){const b=_[y].indexOf('"');b!==-1&&(_[y]=_[y].slice(0,b),_.length=y+1),_[y]=_[y].replaceAll(/\\(.)/g,"$1")}g=_.join('"')}return g}function d(g){const _=g.indexOf("'");if(_===-1)return g;const y=g.slice(0,_),A=g.slice(_+1).replace(/^[^']*'/,"");return s(y,A)}function f(g){return!g.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(g)?g:g.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(_,y,b,A){if(b==="q"||b==="Q")return A=A.replaceAll("_"," "),A=A.replaceAll(/=([0-9a-fA-F]{2})/g,function(S,C){return String.fromCharCode(parseInt(C,16))}),s(y,A);try{A=atob(A)}catch{}return s(y,A)})}return""}function Ev(r,t){const e=new Headers;if(!r||!t||typeof t!="object")return e;for(const n in t){const s=t[n];s!==void 0&&e.append(n,s)}return e}function nu(r){return URL.parse(r)?.origin??null}function wv({responseHeaders:r,isHttp:t,rangeChunkSize:e,disableRange:n}){const s={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(r.get("Content-Length"),10);return!Number.isInteger(o)||(s.suggestedLength=o,o<=2*e)||n||!t||r.get("Accept-Ranges")!=="bytes"||(r.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Cv(r){const t=r.get("Content-Disposition");if(t){let e=Ww(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Uf(e))return e}return null}function qo(r,t){return new xc(`Unexpected server response (${r}) while retrieving PDF "${t}".`,r,r===404||r===0&&t.startsWith("file:"))}function Tv(r){return r===200||r===206}function xv(r,t,e){return{method:"GET",headers:r,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Rv(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:(vt(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class Kw{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Ev(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ge(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Qw(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new Zw(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Qw{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),s=e.url;fetch(s,xv(n,this._withCredentials,this._abortController)).then(o=>{if(t._responseOrigin=nu(o.url),!Tv(o.status))throw qo(o.status,s);this._reader=o.body.getReader(),this._headersCapability.resolve();const c=o.headers,{allowRangeRequests:h,suggestedLength:d}=wv({responseHeaders:c,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=d||this._contentLength,this._filename=Cv(c),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Zi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Rv(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Zw{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const o=new Headers(t.headers);o.append("Range",`bytes=${e}-${n-1}`);const c=s.url;fetch(c,xv(o,this._withCredentials,this._abortController)).then(h=>{const d=nu(h.url);if(d!==t._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${t._responseOrigin}".`);if(!Tv(h.status))throw qo(h.status,c);this._readCapability.resolve(),this._reader=h.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Rv(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const zd=200,Ud=206;function Jw(r){const t=r.response;return typeof t!="string"?t:Uo(t).buffer}class t1{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:n}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Ev(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[o,c]of this.headers)e.setRequestHeader(o,c);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=Ud):s.expectedStatus=zd,e.responseType="arraybuffer",ge(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){n.onError(s.status);return}const o=s.status||zd;if(!(o===zd&&n.expectedStatus===Ud)&&o!==n.expectedStatus){n.onError(s.status);return}const h=Jw(s);if(o===Ud){const d=s.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?n.onDone({begin:parseInt(f[1],10),chunk:h}):(vt('Missing or invalid "Content-Range" header.'),n.onError(0))}else h?n.onDone({begin:0,chunk:h}):n.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class e1{constructor(t){this._source=t,this._manager=new t1(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return ge(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new n1(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new i1(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class n1{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=nu(e.responseURL);const n=e.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(h=>{const[d,...f]=h.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:c}=wv({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=c||this._contentLength,this._filename=Cv(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=qo(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class i1{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=nu(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=qo(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const s1=/^[a-z][a-z0-9\-+.]+:/i;function a1(r){if(s1.test(r))return new URL(r);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(r))}class r1{constructor(t){this.source=t,this.url=a1(t.url),ge(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ge(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new o1(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new l1(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class o1{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=qo(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Zi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class l1{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const lo=Symbol("INITIAL_DATA");class Dv{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:lo}}get(t,e=null){if(e){const s=this.#e(t);return s.promise.then(()=>e(s.data)),null}const n=this.#t[t];if(!n||n.data===lo)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#t[t];return!!e&&e.data!==lo}delete(t){const e=this.#t[t];return!e||e.data===lo?!1:(delete this.#t[t],!0)}resolve(t,e=null){const n=this.#e(t);n.data=e,n.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==lo&&(yield[t,e])}}}const c1=1e5,ab=30;class He{#t=Promise.withResolvers();#e=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#a=null;#s=null;#r=0;#o=0;#l=null;#c=null;#d=0;#u=0;#f=Object.create(null);#g=[];#p=null;#h=[];#m=new WeakMap;#b=null;static#_=new Map;static#A=new Map;static#S=new WeakMap;static#y=null;static#E=new Set;constructor({textContentSource:t,container:e,viewport:n}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(d){d.enqueue(t),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#u=n.scale*Wn.pixelRatio,this.#d=n.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:o,pageX:c,pageY:h}=n.rawDims;this.#b=[1,0,0,-1,-c,h+o],this.#o=s,this.#r=o,He.#D(),Os(e,n),this.#t.promise.finally(()=>{He.#E.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=ke.platform;return Tt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#l.read().then(({value:e,done:n})=>{if(n){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#f,e.styles),this.#R(e.items),t()},this.#t.reject)};return this.#l=this.#p.getReader(),He.#E.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const n=t.scale*Wn.pixelRatio,s=t.rotation;if(s!==this.#d&&(e?.(),this.#d=s,Os(this.#c,{rotation:s})),n!==this.#u){e?.(),this.#u=n;const o={div:null,properties:null,ctx:He.#O(this.#a)};for(const c of this.#h)o.properties=this.#m.get(c),o.div=c,this.#w(o)}}cancel(){const t=new Zi("TextLayer task cancelled.");this.#l?.cancel(t).catch(()=>{}),this.#l=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#g}#R(t){if(this.#n)return;this.#s.ctx??=He.#O(this.#a);const e=this.#h,n=this.#g;for(const s of t){if(e.length>c1){vt("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const o=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id&&this.#e.setAttribute("id",`${s.id}`),o.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}n.push(s.str),this.#T(s)}}#T(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const s=at.transform(this.#b,t.transform);let o=Math.atan2(s[1],s[0]);const c=this.#f[t.fontName];c.vertical&&(o+=Math.PI/2);let h=this.#i&&c.fontSubstitution||c.fontFamily;h=He.fontFamilyMap.get(h)||h;const d=Math.hypot(s[2],s[3]),f=d*He.#I(h,c,this.#a);let g,_;o===0?(g=s[4],_=s[5]-f):(g=s[4]+f*Math.sin(o),_=s[5]-f*Math.cos(o));const y="calc(var(--total-scale-factor) *",b=e.style;this.#e===this.#c?(b.left=`${(100*g/this.#o).toFixed(2)}%`,b.top=`${(100*_/this.#r).toFixed(2)}%`):(b.left=`${y}${g.toFixed(2)}px)`,b.top=`${y}${_.toFixed(2)}px)`),b.fontSize=`${y}${(He.#y*d).toFixed(2)}px)`,b.fontFamily=h,n.fontSize=d,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#i&&(e.dataset.fontName=c.fontSubstitutionLoadedName||t.fontName),o!==0&&(n.angle=o*(180/Math.PI));let A=!1;if(t.str.length>1)A=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const S=Math.abs(t.transform[0]),C=Math.abs(t.transform[3]);S!==C&&Math.max(S,C)/Math.min(S,C)>1.5&&(A=!0)}if(A&&(n.canvasWidth=c.vertical?t.height:t.width),this.#m.set(e,n),this.#s.div=e,this.#s.properties=n,this.#w(this.#s),n.hasText&&this.#e.append(e),n.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),this.#e.append(S)}}#w(t){const{div:e,properties:n,ctx:s}=t,{style:o}=e;let c="";if(He.#y>1&&(c=`scale(${1/He.#y})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:h}=o,{canvasWidth:d,fontSize:f}=n;He.#x(s,f*this.#u,h);const{width:g}=s.measureText(e.textContent);g>0&&(c=`scaleX(${d*this.#u/g}) ${c}`)}n.angle!==0&&(c=`rotate(${n.angle}deg) ${c}`),c.length>0&&(o.transform=c)}static cleanup(){if(!(this.#E.size>0)){this.#_.clear();for(const{canvas:t}of this.#A.values())t.remove();this.#A.clear()}}static#O(t=null){let e=this.#A.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#A.set(t,e),this.#S.set(e,{size:0,family:""})}return e}static#x(t,e,n){const s=this.#S.get(t);e===s.size&&n===s.family||(t.font=`${e}px ${n}`,s.size=e,s.family=n)}static#D(){if(this.#y!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#y=t.getBoundingClientRect().height,t.remove()}static#I(t,e,n){const s=this.#_.get(t);if(s)return s;const o=this.#O(n);o.canvas.width=o.canvas.height=ab,this.#x(o,ab,t);const c=o.measureText(""),h=c.fontBoundingBoxAscent,d=Math.abs(c.fontBoundingBoxDescent);o.canvas.width=o.canvas.height=0;let f=.8;return h?f=h/(h+d):(ke.platform.isFirefox&&vt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?f=e.ascent:e.descent&&(f=1+e.descent)),this.#_.set(t,f),f}}class xo{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};function s(o){if(!o)return;let c=null;const h=o.name;if(h==="#text")c=o.value;else if(xo.shouldBuildText(h))o?.attributes?.textContent?c=o.attributes.textContent:o.value&&(c=o.value);else return;if(c!==null&&e.push({str:c}),!!o.children)for(const d of o.children)s(d)}return s(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const u1=100;function Mv(r={}){typeof r=="string"||r instanceof URL?r={url:r}:(r instanceof ArrayBuffer||ArrayBuffer.isView(r))&&(r={data:r});const t=new $f,{docId:e}=t,n=r.url?yw(r.url):null,s=r.data?bw(r.data):null,o=r.httpHeaders||null,c=r.withCredentials===!0,h=r.password??null,d=r.range instanceof Nv?r.range:null,f=Number.isInteger(r.rangeChunkSize)&&r.rangeChunkSize>0?r.rangeChunkSize:2**16;let g=r.worker instanceof Ro?r.worker:null;const _=r.verbosity,y=typeof r.docBaseUrl=="string"&&!Jc(r.docBaseUrl)?r.docBaseUrl:null,b=gc(r.cMapUrl),A=r.cMapPacked!==!1,S=r.CMapReaderFactory||(ze?xw:Xy),C=gc(r.iccUrl),w=gc(r.standardFontDataUrl),N=r.StandardFontDataFactory||(ze?Rw:$y),x=gc(r.wasmUrl),M=r.WasmFactory||(ze?Dw:Wy),D=r.stopAtErrors!==!0,O=Number.isInteger(r.maxImageSize)&&r.maxImageSize>-1?r.maxImageSize:-1,B=r.isEvalSupported!==!1,j=typeof r.isOffscreenCanvasSupported=="boolean"?r.isOffscreenCanvasSupported:!ze,$=typeof r.isImageDecoderSupported=="boolean"?r.isImageDecoderSupported:!ze&&(ke.platform.isFirefox||!globalThis.chrome),nt=Number.isInteger(r.canvasMaxAreaInBytes)?r.canvasMaxAreaInBytes:-1,tt=typeof r.disableFontFace=="boolean"?r.disableFontFace:ze,lt=r.fontExtraProperties===!0,et=r.enableXfa===!0,yt=r.ownerDocument||globalThis.document,At=r.disableRange===!0,P=r.disableStream===!0,L=r.disableAutoFetch===!0,q=r.pdfBug===!0,J=r.CanvasFactory||(ze?Tw:Ew),T=r.FilterFactory||(ze?Cw:ww),G=r.enableHWA===!0,K=r.useWasm!==!1,W=d?d.length:r.length??NaN,rt=typeof r.useSystemFonts=="boolean"?r.useSystemFonts:!ze&&!tt,bt=typeof r.useWorkerFetch=="boolean"?r.useWorkerFetch:!!(S===Xy&&N===$y&&M===Wy&&b&&w&&x&&mo(b,document.baseURI)&&mo(w,document.baseURI)&&mo(x,document.baseURI)),ct=null;KE(_);const Nt={canvasFactory:new J({ownerDocument:yt,enableHWA:G}),filterFactory:new T({docId:e,ownerDocument:yt}),cMapReaderFactory:bt?null:new S({baseUrl:b,isCompressed:A}),standardFontDataFactory:bt?null:new N({baseUrl:w}),wasmFactory:bt?null:new M({baseUrl:x})};g||(g=Ro.create({verbosity:_,port:ja.workerPort}),t._worker=g);const Bt={docId:e,apiVersion:"5.4.149",data:s,password:h,disableAutoFetch:L,rangeChunkSize:f,length:W,docBaseUrl:y,enableXfa:et,evaluatorOptions:{maxImageSize:O,disableFontFace:tt,ignoreErrors:D,isEvalSupported:B,isOffscreenCanvasSupported:j,isImageDecoderSupported:$,canvasMaxAreaInBytes:nt,fontExtraProperties:lt,useSystemFonts:rt,useWasm:K,useWorkerFetch:bt,cMapUrl:b,iccUrl:C,standardFontDataUrl:w,wasmUrl:x}},In={ownerDocument:yt,pdfBug:q,styleElement:ct,loadingParams:{disableAutoFetch:L,enableXfa:et}};return g.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const rr=g.messageHandler.sendWithPromise("GetDocRequest",Bt,s?[s.buffer]:null);let Ai;if(d)Ai=new Yw(d,{disableRange:At,disableStream:P});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");const is=mo(n)?Kw:ze?r1:e1;Ai=new is({url:n,length:W,httpHeaders:o,withCredentials:c,rangeChunkSize:f,disableRange:At,disableStream:P})}return rr.then(is=>{if(t.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const Gs=new _o(e,is,g.port),or=new f1(Gs,t,Ai,In,Nt,G);t._transport=or,Gs.send("Ready",null)})}).catch(t._capability.reject),t}class $f{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${$f.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Nv{#t=Promise.withResolvers();#e=[];#n=[];#i=[];#a=[];constructor(t,e,n=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=s}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#i.push(t)}addProgressiveReadListener(t){this.#n.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const n of this.#a)n(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const n of this.#i)n(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#n)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Vt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class h1{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Tt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class d1{#t=!1;constructor(t,e,n,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=s?new Vy:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new Dv,this._intentStates=new Map,this.destroyed=!1,this.recordedGroups=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:o=!1}={}){return new Go({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:o})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Tt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:s="display",annotationMode:o=Xi.ENABLE,transform:c=null,background:h=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:g=null,printAnnotationStorage:_=null,isEditing:y=!1,recordOperations:b=!1,filteredOperationIndexes:A=null}){this._stats?.time("Overall");const S=this._transport.getRenderingIntent(s,o,_,y),{renderingIntent:C,cacheKey:w}=S;this.#t=!1,d||=this._transport.getOptionalContentConfig(C);let N=this._intentStates.get(w);N||(N=Object.create(null),this._intentStates.set(w,N)),N.streamReaderCancelTimeout&&(clearTimeout(N.streamReaderCancelTimeout),N.streamReaderCancelTimeout=null);const x=!!(C&un.PRINT);N.displayReadyCapability||(N.displayReadyCapability=Promise.withResolvers(),N.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(S));const M=!this.recordedGroups&&(b||this._pdfBug&&globalThis.StepperManager?.enabled),D=j=>{if(N.renderTasks.delete(O),M){const $=O.gfx?.dependencyTracker.take();$?(O.stepper?.setOperatorGroups($),b&&(this.recordedGroups=$)):b&&(this.recordedGroups=[])}x&&(this.#t=!0),this.#e(),j?(O.capability.reject(j),this._abortOperatorList({intentState:N,reason:j instanceof Error?j:new Error(j)})):O.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},O=new Ba({callback:D,params:{canvas:e,canvasContext:t,dependencyTracker:M?new Mw(e):null,viewport:n,transform:c,background:h},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:N.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!x,pdfBug:this._pdfBug,pageColors:g,enableHWA:this._transport.enableHWA,filteredOperationIndexes:A});(N.renderTasks||=new Set).add(O);const B=O.task;return Promise.all([N.displayReadyCapability.promise,d]).then(([j,$])=>{if(this.destroyed){D();return}if(this._stats?.time("Rendering"),!($.renderingIntent&C))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");O.initializeGraphics({transparency:j,optionalContentConfig:$}),O.operatorListChanged()}).catch(D),B}getOperatorList({intent:t="display",annotationMode:e=Xi.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){function o(){h.operatorList.lastChunk&&(h.opListReadCapability.resolve(h.operatorList),h.renderTasks.delete(d))}const c=this._transport.getRenderingIntent(t,e,n,s,!0);let h=this._intentStates.get(c.cacheKey);h||(h=Object.create(null),this._intentStates.set(c.cacheKey,h));let d;return h.opListReadCapability||(d=Object.create(null),d.operatorListChanged=o,h.opListReadCapability=Promise.withResolvers(),(h.renderTasks||=new Set).add(d),h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(c)),h.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>xo.textContent(n));const e=this.streamTextContent(t);return new Promise(function(n,s){function o(){c.read().then(function({value:d,done:f}){if(f){n(h);return}h.lang??=d.lang,Object.assign(h.styles,d.styles),h.items.push(...d.items),o()},s)}const c=e.getReader(),h={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new Vy),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,s=t.length;n<s;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:s}){const{map:o,transfer:c}=n,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:o,modifiedIds:s},c).getReader(),f=this._intentStates.get(e);f.streamReader=d;const g=()=>{d.read().then(({value:_,done:y})=>{if(y){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(_,f),g())},_=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const y of f.renderTasks)y.operatorListChanged();this.#e()}if(f.displayReadyCapability)f.displayReadyCapability.reject(_);else if(f.opListReadCapability)f.opListReadCapability.reject(_);else throw _}})};g()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof zf){let s=u1;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new Zi(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,o]of this._intentStates)if(o===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}var $i,Nn,pi,Rs,Wc,Ds,Ms,je,wc,Ov,kv,yo,$a,Cc;const Zt=class Zt{constructor({name:t=null,port:e=null,verbosity:n=QE()}={}){jn(this,je);jn(this,$i,Promise.withResolvers());jn(this,Nn,null);jn(this,pi,null);jn(this,Rs,null);if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(Qt(Zt,Ms).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Qt(Zt,Ms).set(e,this),Gn(this,je,Ov).call(this,e)}else Gn(this,je,kv).call(this)}get promise(){return Qt(this,$i).promise}get port(){return Qt(this,pi)}get messageHandler(){return Qt(this,Nn)}destroy(){this.destroyed=!0,Qt(this,Rs)?.terminate(),$e(this,Rs,null),Qt(Zt,Ms).delete(Qt(this,pi)),$e(this,pi,null),Qt(this,Nn)?.destroy(),$e(this,Nn,null)}static create(t){const e=Qt(this,Ms).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Zt(t)}static get workerSrc(){if(ja.workerSrc)return ja.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Tt(this,"_setupFakeWorkerGlobal",(async()=>Qt(this,$a,Cc)?Qt(this,$a,Cc):(await import(this.workerSrc)).WorkerMessageHandler)())}};$i=new WeakMap,Nn=new WeakMap,pi=new WeakMap,Rs=new WeakMap,Wc=new WeakMap,Ds=new WeakMap,Ms=new WeakMap,je=new WeakSet,wc=function(){Qt(this,$i).resolve(),Qt(this,Nn).send("configure",{verbosity:this.verbosity})},Ov=function(t){$e(this,pi,t),$e(this,Nn,new _o("main","worker",t)),Qt(this,Nn).on("ready",()=>{}),Gn(this,je,wc).call(this)},kv=function(){if(Qt(Zt,Ds)||Qt(Zt,$a,Cc)){Gn(this,je,yo).call(this);return}let{workerSrc:t}=Zt;try{Zt._isSameOrigin(window.location,t)||(t=Zt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new _o("main","worker",e),s=()=>{o.abort(),n.destroy(),e.terminate(),this.destroyed?Qt(this,$i).reject(new Error("Worker was destroyed")):Gn(this,je,yo).call(this)},o=new AbortController;e.addEventListener("error",()=>{Qt(this,Rs)||s()},{signal:o.signal}),n.on("test",h=>{if(o.abort(),this.destroyed||!h){s();return}$e(this,Nn,n),$e(this,pi,e),$e(this,Rs,e),Gn(this,je,wc).call(this)}),n.on("ready",h=>{if(o.abort(),this.destroyed){s();return}try{c()}catch{Gn(this,je,yo).call(this)}});const c=()=>{const h=new Uint8Array;n.send("test",h,[h.buffer])};c();return}catch{Zc("The worker has been disabled.")}Gn(this,je,yo).call(this)},yo=function(){Qt(Zt,Ds)||(vt("Setting up fake worker."),$e(Zt,Ds,!0)),Zt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Qt(this,$i).reject(new Error("Worker was destroyed"));return}const e=new Sw;$e(this,pi,e);const n=`fake${Ny(Zt,Wc)._++}`,s=new _o(n+"_worker",n,e);t.setup(s,e),$e(this,Nn,new _o(n,n+"_worker",e)),Gn(this,je,wc).call(this)}).catch(t=>{Qt(this,$i).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},$a=new WeakSet,Cc=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},jn(Zt,$a),jn(Zt,Wc,0),jn(Zt,Ds,!1),jn(Zt,Ms,new WeakMap),ze&&($e(Zt,Ds,!0),ja.workerSrc||="./pdf.worker.mjs"),Zt._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||n.origin==="null")return!1;const s=new URL(e,n);return n.origin===s.origin},Zt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Zt.fromPort=t=>{if(cw("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Zt.create(t)};let Ro=Zt;class f1{#t=new Map;#e=new Map;#n=new Map;#i=new Map;#a=null;constructor(t,e,n,s,o,c){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Dv,this.fontLoader=new mw({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.wasmFactory=o.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=c,this.setupMessageHandler()}#s(t,e=null){const n=this.#t.get(t);if(n)return n;const s=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,s),s}get annotationStorage(){return Tt(this,"annotationStorage",new Vf)}getRenderingIntent(t,e=Xi.ENABLE,n=null,s=!1,o=!1){let c=un.DISPLAY,h=rf;switch(t){case"any":c=un.ANY;break;case"display":break;case"print":c=un.PRINT;break;default:vt(`getRenderingIntent - invalid intent: ${t}`)}const d=c&un.PRINT&&n instanceof _v?n:this.annotationStorage;switch(e){case Xi.DISABLE:c+=un.ANNOTATIONS_DISABLE;break;case Xi.ENABLE:break;case Xi.ENABLE_FORMS:c+=un.ANNOTATIONS_FORMS;break;case Xi.ENABLE_STORAGE:c+=un.ANNOTATIONS_STORAGE,h=d.serializable;break;default:vt(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(c+=un.IS_EDITING),o&&(c+=un.OPLIST);const{ids:f,hash:g}=d.modifiedIds,_=[c,h.hash,g];return{renderingIntent:c,cacheKey:_.join("_"),annotationStorageSerializable:h,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#e.values())t.push(n._destroy());this.#e.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),He.cleanup(),this._networkStream?.cancelAllRequests(new Zi("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,s)=>{ge(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},s.onPull=()=>{this._fullReader.read().then(function({value:o,done:c}){if(c){s.close();return}ge(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{this._fullReader.cancel(o),s.ready.catch(c=>{if(!this.destroyed)throw c})}}),t.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:o,contentLength:c}=this._fullReader;return(!s||!o)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=h=>{e.onProgress?.({loaded:h.loaded,total:h.total})}),{isStreamingSupported:s,isRangeSupported:o,contentLength:c}}),t.on("GetRangeReader",(n,s)=>{ge(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){s.close();return}s.onPull=()=>{o.read().then(function({value:c,done:h}){if(h){s.close();return}ge(c instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(c),1,[c])}).catch(c=>{s.error(c)})},s.onCancel=c=>{o.cancel(c),s.ready.catch(h=>{if(!this.destroyed)throw h})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new h1(n,this))}),t.on("DocException",n=>{e._capability.reject(We(n))}),t.on("PasswordRequest",n=>{this.#a=Promise.withResolvers();try{if(!e.onPassword)throw We(n);const s=o=>{o instanceof Error?this.#a.reject(o):this.#a.resolve({password:o})};e.onPassword(s,n.code)}catch(s){this.#a.reject(s)}return this.#a.promise}),t.on("DataLoaded",n=>{e.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;this.#e.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,s,o])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":if("error"in o){const f=o.error;vt(`Error during font loading: ${f}`),this.commonObjs.resolve(n,f);break}const c=this._params.pdfBug&&globalThis.FontInspector?.enabled?(f,g)=>globalThis.FontInspector.fontAdded(f,g):null,h=new _w(o,c);this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!h.fontExtraProperties&&h.data&&(h.data=null),this.commonObjs.resolve(n,h)});break;case"CopyLocalImage":const{imageRef:d}=o;ge(d,"The imageRef must be defined.");for(const f of this.#e.values())for(const[,g]of f.objs)if(g?.ref===d)return g.dataLen?(this.commonObjs.resolve(n,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([n,s,o,c])=>{if(this.destroyed)return;const h=this.#e.get(s);if(!h.objs.has(n)){if(h._intentStates.size===0){c?.bitmap?.close();return}switch(o){case"Image":case"Pattern":h.objs.resolve(n,c);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",n=>{this.destroyed||e.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[n.type];if(!s)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&vt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#n.get(e);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#i.set(o.refStr,t);const c=new d1(e,o,this,this._params.pdfBug);return this.#e.set(e,c),c});return this.#n.set(e,s),s}getPageIndex(t){return of(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#s("GetOptionalContentConfig").then(e=>new qw(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(s=>({info:s[0],metadata:s[1]?new Gw(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),He.cleanup()}}cachedPageNumber(t){if(!of(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#i.get(e)??null}}class p1{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Ba{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:n,commonObjs:s,annotationCanvasMap:o,operatorList:c,pageIndex:h,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:g=!1,pdfBug:_=!1,pageColors:y=null,enableHWA:b=!1,filteredOperationIndexes:A=null}){this.callback=t,this.params=e,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=c,this._pageIndex=h,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=_,this.pageColors=y,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=g===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new p1(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=b,this._dependencyTracker=e.dependencyTracker,this._filteredOperationIndexes=A}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Ba.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ba.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:s,background:o,dependencyTracker:c}=this.params,h=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Ua(h,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,c),this.gfx.beginDrawing({transform:s,viewport:n,transparency:t,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Ba.#e.delete(this._canvas),t||=new zf(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._filteredOperationIndexes),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ba.#e.delete(this._canvas),this.callback())))}}const g1="5.4.149",m1="9e2e9e209";class En{#t=null;#e=null;#n;#i=null;#a=!1;#s=!1;#r=null;#o;#l=null;#c=null;static#d=null;static get _keyboardManager(){return Tt(this,"_keyboardManager",new Vo([[["Escape","mac+Escape"],En.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],En.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],En.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],En.prototype._moveToPrevious],[["Home","mac+Home"],En.prototype._moveToBeginning],[["End","mac+End"],En.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#s=!1,this.#r=t):this.#s=!0,this.#c=t?._uiManager||e,this.#o=this.#c._eventBus,this.#n=t?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",En.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#c._signal;t.addEventListener("click",this.#p.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const n=this.#e=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#n,t.append(n),t}renderMainDropdown(){const t=this.#i=this.#u();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#u(){const t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",xn,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,s]of this.#c.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",s),o.title=n,o.setAttribute("data-l10n-id",En.#d[n]);const c=document.createElement("span");o.append(c),c.className="swatch",c.style.backgroundColor=s,o.ariaSelected=s===this.#n,o.addEventListener("click",this.#f.bind(this,s),{signal:e}),t.append(o)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:Ot.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#p(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#m){this.#p(t);return}if(t.target===this.#t){this.#i.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#i?.firstChild||t.target===this.#t){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#p(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#m){this.#p(t);return}this.#i.firstChild?.focus()}_moveToEnd(t){if(!this.#m){this.#p(t);return}this.#i.lastChild?.focus()}#g(t){En._keyboardManager.exec(this,t)}#p(t){if(this.#m){this.hideDropdown();return}if(this.#a=t.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#c.combinedSignal(this.#l)})),this.#t.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const e=this.#i=this.#u();this.#t.append(e)}#h(t){this.#i?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#m(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#m){this.#r?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#i)return;const e=this.#c.highlightColors.values();for(const n of this.#i.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}}class Do{#t=null;#e=null;#n=null;static#i=null;constructor(t){this.#e=t,this.#n=t._uiManager,Do.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:n}=this.#e,s=this.#t=document.createElement("input");return s.type="color",s.value=n||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",Do.#i[t]),s.addEventListener("input",()=>{this.#n.updateParams(e,s.value)},{signal:this.#n._signal}),s}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function rb(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function co(r){return Math.max(0,Math.min(255,255*r))}class ob{static CMYK_G([t,e,n,s]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=co(t),[t,t,t]}static G_HTML([t]){const e=rb(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(co)}static RGB_HTML(t){return`#${t.map(rb).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,n+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,n,s]){return[co(1-Math.min(1,t+s)),co(1-Math.min(1,n+s)),co(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const s=1-t,o=1-e,c=1-n,h=Math.min(s,o,c);return["CMYK",s,o,c,h]}}class _1{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Vt("Abstract method `_createSVG` called.")}}class Dc extends _1{_createSVG(t){return document.createElementNS(di,t)}}class Lv{static setupStorage(t,e,n,s,o){const c=s.getValue(e,{value:null});switch(n.name){case"textarea":if(c.value!==null&&(t.textContent=c.value),o==="print")break;t.addEventListener("input",h=>{s.setValue(e,{value:h.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(c.value===n.attributes.xfaOn?t.setAttribute("checked",!0):c.value===n.attributes.xfaOff&&t.removeAttribute("checked"),o==="print")break;t.addEventListener("change",h=>{s.setValue(e,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(c.value!==null&&t.setAttribute("value",c.value),o==="print")break;t.addEventListener("input",h=>{s.setValue(e,{value:h.target.value})})}break;case"select":if(c.value!==null){t.setAttribute("value",c.value);for(const h of n.children)h.attributes.value===c.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}t.addEventListener("input",h=>{const d=h.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;s.setValue(e,{value:f})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:s,linkService:o}){const{attributes:c}=e,h=t instanceof HTMLAnchorElement;c.type==="radio"&&(c.name=`${c.name}-${s}`);for(const[d,f]of Object.entries(c))if(f!=null)switch(d){case"class":f.length&&t.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",f);break;case"style":Object.assign(t.style,f);break;case"textContent":t.textContent=f;break;default:(!h||d!=="href"&&d!=="newWindow")&&t.setAttribute(d,f)}h&&o.addLinkAttributes(t,c.href,c.newWindow),n&&c.dataId&&this.setupStorage(t,c.dataId,e,n)}static render(t){const e=t.annotationStorage,n=t.linkService,s=t.xfaHtml,o=t.intent||"display",c=document.createElement(s.name);s.attributes&&this.setAttributes({html:c,element:s,intent:o,linkService:n});const h=o!=="richText",d=t.div;if(d.append(c),t.viewport){const _=`matrix(${t.viewport.transform.join(",")})`;d.style.transform=_}h&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(s.children.length===0){if(s.value){const _=document.createTextNode(s.value);c.append(_),h&&xo.shouldBuildText(s.name)&&f.push(_)}return{textDivs:f}}const g=[[s,-1,c]];for(;g.length>0;){const[_,y,b]=g.at(-1);if(y+1===_.children.length){g.pop();continue}const A=_.children[++g.at(-1)[1]];if(A===null)continue;const{name:S}=A;if(S==="#text"){const w=document.createTextNode(A.value);f.push(w),b.append(w);continue}const C=A?.attributes?.xmlns?document.createElementNS(A.attributes.xmlns,S):document.createElement(S);if(b.append(C),A.attributes&&this.setAttributes({html:C,element:A,storage:e,intent:o,linkService:n}),A.children?.length>0)g.push([A,-1,C]);else if(A.value){const w=document.createTextNode(A.value);h&&xo.shouldBuildText(S)&&f.push(w),C.append(w)}}for(const _ of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))_.setAttribute("readOnly",!0);return{textDivs:f}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const y1=9,ks=new WeakSet,b1=new Date().getTimezoneOffset()*60*1e3;class lb{static create(t){switch(t.data.annotationType){case de.LINK:return new Wf(t);case de.TEXT:return new v1(t);case de.WIDGET:switch(t.data.fieldType){case"Tx":return new A1(t);case"Btn":return t.data.radioButton?new Iv(t):t.data.checkBox?new E1(t):new w1(t);case"Ch":return new C1(t);case"Sig":return new S1(t)}return new Hs(t);case de.POPUP:return new cf(t);case de.FREETEXT:return new Pv(t);case de.LINE:return new x1(t);case de.SQUARE:return new R1(t);case de.CIRCLE:return new D1(t);case de.POLYLINE:return new Bv(t);case de.CARET:return new N1(t);case de.INK:return new Kf(t);case de.POLYGON:return new M1(t);case de.HIGHLIGHT:return new Fv(t);case de.UNDERLINE:return new O1(t);case de.SQUIGGLY:return new k1(t);case de.STRIKEOUT:return new L1(t);case de.STAMP:return new Hv(t);case de.FILEATTACHMENT:return new I1(t);default:return new le(t)}}}class le{#t=null;#e=!1;#n=null;constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return le._hasPopupData(this.data)}get hasCommentButton(){return this.enableComment&&this._isEditable&&this.hasPopupElement}get commentButtonPosition(){const{quadPoints:t,rect:e}=this.data;let n=-1/0,s=-1/0;if(t?.length>=8){for(let o=0;o<t.length;o+=8)t[o+1]>s?(s=t[o+1],n=t[o+2]):t[o+1]===s&&(n=Math.max(n,t[o+2]));return[n,s]}return e?[e[2],e[3]]:null}get commentButtonColor(){if(!this.data.color)return null;const[t,e,n]=this.data.color,o=255*(1-(this.data.opacity??1));return this.#i(Math.min(t+o,255),Math.min(e+o,255),Math.min(n+o,255))}#i(t,e,n){t/=255,e/=255,n/=255;const s=Math.max(t,e,n),o=Math.min(t,e,n),c=(s+o)/2,h=((1+Math.sqrt(c))/2*100).toFixed(2);if(s===o)return`hsl(0, 0%, ${h}%)`;const d=s-o;let f;s===t?f=(e-n)/d+(e<n?6:0):s===e?f=(n-t)/d+2:f=(t-e)/d+4,f=(f*60).toFixed(2);const g=(d/(1-Math.abs(2*c-1))*100).toFixed(2);return`hsl(${f}, ${g}%, ${h}%)`}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:n,pageHeight:s,pageX:o,pageY:c}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-o)/n,t[1]=100*(t[1]-c)/s,t}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#a(e);let s=this.#n?.popup||this.popup;!s&&n?.text&&(this._createPopup(n),s=this.#n.popup),s&&(s.updateEdited(t),n?.deleted&&(s.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#t&&(this.#a(this.#t.rect),this.#n?.popup.resetEdited(),this.#t=null)}#a(t){const{container:{style:e},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:c,pageX:h,pageY:d}}}}=this;n?.splice(0,4,...t),e.left=`${100*(t[0]-h)/o}%`,e.top=`${100*(c-t[3]+d)/c}%`,s===0?(e.width=`${100*(t[2]-t[0])/o}%`,e.height=`${100*(t[3]-t[1])/c}%`):this.setRotation(s)}_createContainer(t){const{data:e,parent:{page:n,viewport:s}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",e.id),!(this instanceof Hs)&&!(this instanceof Wf)&&(o.tabIndex=0);const{style:c}=o;if(c.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(o.title=e.alternativeText),e.noRotate&&o.classList.add("norotate"),!e.rect||this instanceof cf){const{rotation:S}=e;return!e.hasOwnCanvas&&S!==0&&this.setRotation(S,o),o}const{width:h,height:d}=this;if(!t&&e.borderStyle.width>0){c.borderWidth=`${e.borderStyle.width}px`;const S=e.borderStyle.horizontalCornerRadius,C=e.borderStyle.verticalCornerRadius;if(S>0||C>0){const N=`calc(${S}px * var(--total-scale-factor)) / calc(${C}px * var(--total-scale-factor))`;c.borderRadius=N}else if(this instanceof Iv){const N=`calc(${h}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;c.borderRadius=N}switch(e.borderStyle.style){case ka.SOLID:c.borderStyle="solid";break;case ka.DASHED:c.borderStyle="dashed";break;case ka.BEVELED:vt("Unimplemented border style: beveled");break;case ka.INSET:vt("Unimplemented border style: inset");break;case ka.UNDERLINE:c.borderBottomStyle="solid";break}const w=e.borderColor||null;w?(this.#e=!0,c.borderColor=at.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):c.borderWidth=0}const f=at.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:g,pageHeight:_,pageX:y,pageY:b}=s.rawDims;c.left=`${100*(f[0]-y)/g}%`,c.top=`${100*(f[1]-b)/_}%`;const{rotation:A}=e;return e.hasOwnCanvas||A===0?(c.width=`${100*h/g}%`,c.height=`${100*d/_}%`):this.setRotation(A,o),o}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims;let{width:o,height:c}=this;t%180!==0&&([o,c]=[c,o]),e.style.width=`${100*o/n}%`,e.style.height=`${100*c/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,n,s)=>{const o=s.detail[e],c=o[0],h=o.slice(1);s.target.style[n]=ob[`${c}_HTML`](h),this.annotationStorage.setValue(this.data.id,{[n]:ob[`${c}_rgb`](h)})};return Tt(this,"_commonActions",{display:e=>{const{display:n}=e.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const s of Object.keys(e.detail))(t[s]||n[s])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[s,o]of Object.entries(e)){const c=n[s];if(c){const h={detail:{[s]:o},target:t};c(h),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,s,o]=this.data.rect.map(S=>Math.fround(S));if(t.length===8){const[S,C,w,N]=t.subarray(2,6);if(s===S&&o===C&&e===w&&n===N)return}const{style:c}=this.container;let h;if(this.#e){const{borderColor:S,borderWidth:C}=c;c.borderWidth=0,h=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${S}" stroke-width="${C}">`],this.container.classList.add("hasBorder")}const d=s-e,f=o-n,{svgFactory:g}=this,_=g.createElement("svg");_.classList.add("quadrilateralsContainer"),_.setAttribute("width",0),_.setAttribute("height",0),_.role="none";const y=g.createElement("defs");_.append(y);const b=g.createElement("clipPath"),A=`clippath_${this.data.id}`;b.setAttribute("id",A),b.setAttribute("clipPathUnits","objectBoundingBox"),y.append(b);for(let S=2,C=t.length;S<C;S+=8){const w=t[S],N=t[S+1],x=t[S+2],M=t[S+3],D=g.createElement("rect"),O=(x-e)/d,B=(o-N)/f,j=(w-x)/d,$=(N-M)/f;D.setAttribute("x",O),D.setAttribute("y",B),D.setAttribute("width",j),D.setAttribute("height",$),b.append(D),h?.push(`<rect vector-effect="non-scaling-stroke" x="${O}" y="${B}" width="${j}" height="${$}"/>`)}this.#e&&(h.push("</g></svg>')"),c.backgroundImage=h.join("")),this.container.append(_),this.container.style.clipPath=`url(#${A})`}_createPopup(t=null){const{data:e}=this;let n,s;t?(n={str:t.text},s=t.date):(n=e.contentsObj,s=e.modificationDate);const o=this.#n=new cf({data:{color:e.color,titleObj:e.titleObj,modificationDate:s,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(o.render())}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}render(){Vt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:o,id:c,exportValues:h}of s){if(o===-1||c===e)continue;const d=typeof h=="string"?h:null,f=document.querySelector(`[data-element-id="${c}"]`);if(f&&!ks.has(f)){vt(`_getElementsByName - element not allowed: ${c}`);continue}n.push({id:c,exportValue:d,domElement:f})}return n}for(const s of document.getElementsByName(t)){const{exportValue:o}=s,c=s.getAttribute("data-element-id");c!==e&&ks.has(s)&&n.push({id:c,exportValue:o,domElement:s})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Wf extends le{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),s=!0):t.attachment?(this.#e(n,t.attachment,t.overlaidText,t.attachmentDest),s=!0):t.setOCGState?(this.#n(n,t.setOCGState,t.overlaidText),s=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),s=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(n,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(n),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,n=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),n&&(t.title=n)}_bindNamedAction(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#t()}#e(t,e,n="",s=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,s),!1),this.#t()}#n(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(e.actions)){const o=n.get(s);o&&(t[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){vt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(t.onclick=()=>!1);return}t.onclick=()=>{n?.();const{fields:s,refs:o,include:c}=e,h=[];if(s.length!==0||o.length!==0){const g=new Set(o);for(const _ of s){const y=this._fieldObjects[_]||[];for(const{id:b}of y)g.add(b)}for(const _ of Object.values(this._fieldObjects))for(const y of _)g.has(y.id)===c&&h.push(y)}else for(const g of Object.values(this._fieldObjects))h.push(...g);const d=this.annotationStorage,f=[];for(const g of h){const{id:_}=g;switch(f.push(_),g.type){case"text":{const b=g.defaultValue||"";d.setValue(_,{value:b});break}case"checkbox":case"radiobutton":{const b=g.defaultValue===g.exportValues;d.setValue(_,{value:b});break}case"combobox":case"listbox":{const b=g.defaultValue||"";d.setValue(_,{value:b});break}default:continue}const y=document.querySelector(`[data-element-id="${_}"]`);if(y){if(!ks.has(y)){vt(`_bindResetFormAction - element not allowed: ${_}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class v1 extends le{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Hs extends le{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return ke.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,s,o){n.includes("mouse")?t.addEventListener(n,c=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:o(c),shift:c.shiftKey,modifier:this._getKeyModifier(c)}})}):t.addEventListener(n,c=>{if(n==="blur"){if(!e.focused||!c.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}o&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:o(c)}})})}_setEventListeners(t,e,n,s){for(const[o,c]of n)(c==="Action"||this.data.actions?.[c])&&((c==="Focus"||c==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,o,c,s),c==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":at.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||y1,o=t.style;let c;const h=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h),g=Math.round(f/(Ld*s))||1,_=f/g;c=Math.min(s,d(_/Ld))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h);c=Math.min(s,d(f/Ld))}o.fontSize=`calc(${c}px * var(--total-scale-factor))`,o.color=at.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class A1 extends Hs{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,s){const o=this.annotationStorage;for(const c of this._getElementsByName(t.name,t.id))c.domElement&&(c.domElement[e]=n),o.setValue(c.id,{[s]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const s=t.getValue(e,{value:this.data.fieldValue});let o=s.value||"";const c=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;c&&o.length>c&&(o=o.slice(0,c));let h=s.formattedValue||this.data.textContent?.join(`
`)||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=h??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",h??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),ks.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:f,datetimeType:g,timeStep:_}=this.data,y=!!g&&this.enableScripting;f&&(n.title=f),this._setRequired(n,this.data.required),c&&(n.maxLength=c),n.addEventListener("input",A=>{t.setValue(e,{value:A.target.value}),this.setPropertyOnSiblings(n,"value",A.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",A=>{const S=this.data.defaultFieldValue??"";n.value=d.userValue=S,d.formattedValue=null});let b=A=>{const{formattedValue:S}=d;S!=null&&(A.target.value=S),A.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",S=>{if(d.focused)return;const{target:C}=S;if(y&&(C.type=g,_&&(C.step=_)),d.userValue){const w=d.userValue;if(y)if(g==="time"){const N=new Date(w),x=[N.getHours(),N.getMinutes(),N.getSeconds()];C.value=x.map(M=>M.toString().padStart(2,"0")).join(":")}else C.value=new Date(w-b1).toISOString().split(g==="date"?"T":".",1)[0];else C.value=w}d.lastCommittedValue=C.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",S=>{this.showElementAndHideCanvas(S.target);const C={value(w){d.userValue=w.detail.value??"",y||t.setValue(e,{value:d.userValue.toString()}),w.target.value=d.userValue},formattedValue(w){const{formattedValue:N}=w.detail;d.formattedValue=N,N!=null&&w.target!==document.activeElement&&(w.target.value=N);const x={formattedValue:N};y&&(x.value=N),t.setValue(e,x)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{const{charLimit:N}=w.detail,{target:x}=w;if(N===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",N);let M=d.userValue;!M||M.length<=N||(M=M.slice(0,N),x.value=d.userValue=M,t.setValue(e,{value:M}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:M,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(C,S)}),n.addEventListener("keydown",S=>{d.commitKey=1;let C=-1;if(S.key==="Escape"?C=0:S.key==="Enter"&&!this.data.multiLine?C=2:S.key==="Tab"&&(d.commitKey=3),C===-1)return;const{value:w}=S.target;d.lastCommittedValue!==w&&(d.lastCommittedValue=w,d.userValue=w,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:C,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}}))});const A=b;b=null,n.addEventListener("blur",S=>{if(!d.focused||!S.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:C}=S;let{value:w}=C;if(y){if(w&&g==="time"){const N=w.split(":").map(x=>parseInt(x,10));w=new Date(2e3,0,1,N[0],N[1],N[2]||0).valueOf(),C.step=""}else w=new Date(w).valueOf();C.type="text"}d.userValue=w,d.lastCommittedValue!==w&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:d.commitKey,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}}),A(S)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",S=>{d.lastCommittedValue=null;const{data:C,target:w}=S,{value:N,selectionStart:x,selectionEnd:M}=w;let D=x,O=M;switch(S.inputType){case"deleteWordBackward":{const B=N.substring(0,x).match(/\w*[^\w]*$/);B&&(D-=B[0].length);break}case"deleteWordForward":{const B=N.substring(x).match(/^[^\w]*\w*/);B&&(O+=B[0].length);break}case"deleteContentBackward":x===M&&(D-=1);break;case"deleteContentForward":x===M&&(O+=1);break}S.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:N,change:C||"",willCommit:!1,selStart:D,selEnd:O}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],S=>S.target.value)}if(b&&n.addEventListener("blur",b),this.data.comb){const S=(this.data.rect[2]-this.data.rect[0])/c;n.classList.add("comb"),n.style.letterSpacing=`calc(${S}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class S1 extends Hs{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class E1 extends Hs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return ks.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=e.fieldName,s&&o.setAttribute("checked",!0),o.setAttribute("exportValue",e.exportValue),o.tabIndex=0,o.addEventListener("change",c=>{const{name:h,checked:d}=c.target;for(const f of this._getElementsByName(h,n)){const g=d&&f.exportValue===e.exportValue;f.domElement&&(f.domElement.checked=g),t.setValue(f.id,{value:g})}t.setValue(n,{value:d})}),o.addEventListener("resetform",c=>{const h=e.defaultFieldValue||"Off";c.target.checked=h===e.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",c=>{const h={value(d){d.target.checked=d.detail.value!=="Off",t.setValue(n,{value:d.target.checked})}};this._dispatchEventFromSandbox(h,c)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class Iv extends Hs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(n,{value:s})),s)for(const c of this._getElementsByName(e.fieldName,n))t.setValue(c.id,{value:!1});const o=document.createElement("input");if(ks.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=e.fieldName,s&&o.setAttribute("checked",!0),o.tabIndex=0,o.addEventListener("change",c=>{const{name:h,checked:d}=c.target;for(const f of this._getElementsByName(h,n))t.setValue(f.id,{value:!1});t.setValue(n,{value:d})}),o.addEventListener("resetform",c=>{const h=e.defaultFieldValue;c.target.checked=h!=null&&h===e.buttonValue}),this.enableScripting&&this.hasJSActions){const c=e.buttonValue;o.addEventListener("updatefromsandbox",h=>{const d={value:f=>{const g=c===f.detail.value;for(const _ of this._getElementsByName(f.target.name)){const y=g&&_.id===n;_.domElement&&(_.domElement.checked=y),t.setValue(_.id,{value:y})}}};this._dispatchEventFromSandbox(d,h)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class w1 extends Wf{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}}class C1 extends Hs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");ks.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",g=>{const _=this.data.defaultFieldValue;for(const y of s.options)y.selected=y.value===_});for(const g of this.data.options){const _=document.createElement("option");_.textContent=g.displayValue,_.value=g.exportValue,n.value.includes(g.exportValue)&&(_.setAttribute("selected",!0),o=!1),s.append(_)}let c=null;if(o){const g=document.createElement("option");g.value=" ",g.setAttribute("hidden",!0),g.setAttribute("selected",!0),s.prepend(g),c=()=>{g.remove(),s.removeEventListener("input",c),c=null},s.addEventListener("input",c)}const h=g=>{const _=g?"value":"textContent",{options:y,multiple:b}=s;return b?Array.prototype.filter.call(y,A=>A.selected).map(A=>A[_]):y.selectedIndex===-1?null:y[y.selectedIndex][_]};let d=h(!1);const f=g=>{const _=g.target.options;return Array.prototype.map.call(_,y=>({displayValue:y.textContent,exportValue:y.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",g=>{const _={value(y){c?.();const b=y.detail.value,A=new Set(Array.isArray(b)?b:[b]);for(const S of s.options)S.selected=A.has(S.value);t.setValue(e,{value:h(!0)}),d=h(!1)},multipleSelection(y){s.multiple=!0},remove(y){const b=s.options,A=y.detail.remove;b[A].selected=!1,s.remove(A),b.length>0&&Array.prototype.findIndex.call(b,C=>C.selected)===-1&&(b[0].selected=!0),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},clear(y){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),d=h(!1)},insert(y){const{index:b,displayValue:A,exportValue:S}=y.detail.insert,C=s.children[b],w=document.createElement("option");w.textContent=A,w.value=S,C?C.before(w):s.append(w),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},items(y){const{items:b}=y.detail;for(;s.length!==0;)s.remove(0);for(const A of b){const{displayValue:S,exportValue:C}=A,w=document.createElement("option");w.textContent=S,w.value=C,s.append(w)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:h(!0),items:f(y)}),d=h(!1)},indices(y){const b=new Set(y.detail.indices);for(const A of y.target.options)A.selected=b.has(A.index);t.setValue(e,{value:h(!0)}),d=h(!1)},editable(y){y.target.disabled=!y.detail.editable}};this._dispatchEventFromSandbox(_,g)}),s.addEventListener("input",g=>{const _=h(!0),y=h(!1);t.setValue(e,{value:_}),g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:d,change:y,changeEx:_,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],g=>g.target.value)):s.addEventListener("input",function(g){t.setValue(e,{value:h(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class cf extends le{constructor(t){const{data:e,elements:n}=t;super(t,{isRenderable:le._hasPopupData(e)}),this.elements=n,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new T1({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,eventBus:this.linkService.eventBus}),n=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",n.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(s=>`${Hf}${s}`).join(",")),this.container}}class T1{#t=this.#L.bind(this);#e=this.#C.bind(this);#n=this.#H.bind(this);#i=this.#N.bind(this);#a=null;#s=null;#r=null;#o=null;#l=null;#c=null;#d=null;#u=null;#f=!1;#g=null;#p=null;#h=null;#m=null;#b=null;#_=null;#A=null;#S=null;#y=null;#E=null;#R=!1;constructor({container:t,color:e,elements:n,titleObj:s,modificationDate:o,contentsObj:c,richText:h,parent:d,rect:f,parentRect:g,open:_,eventBus:y=null}){this.#s=t,this.#y=s,this.#r=c,this.#S=h,this.#d=d,this.#a=e,this.#A=f,this.#u=g,this.#l=n,this.#c=y,this.#o=sf.toDateObject(o),this.trigger=n.flatMap(b=>b.getElementsToTriggerPopup()),this.#T(),this.#s.hidden=!0,_&&this.#N()}#T(){if(this.#p)return;this.#p=new AbortController;const{signal:t}=this.#p;for(const e of this.trigger)e.addEventListener("click",this.#i,{signal:t}),e.addEventListener("mouseenter",this.#n,{signal:t}),e.addEventListener("mouseleave",this.#e,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#t,{signal:t});this.#O()}#w(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition),this.#_=t.commentButtonColor)}#O(){if(this.#m||(this.#b||this.#w(),!this.#b))return;const t=this.#m=document.createElement("button");t.className="annotationCommentButton";const e=this.#l[0].container;t.style.zIndex=e.style.zIndex+1,t.tabIndex=0;const{signal:n}=this.#p;t.addEventListener("hover",this.#i,{signal:n}),t.addEventListener("keydown",this.#t,{signal:n}),t.addEventListener("click",()=>{const[{data:{id:o},annotationEditorType:c}]=this.#l;this.#c?.dispatch("switchannotationeditormode",{source:this,editId:o,mode:c,editComment:!0})},{signal:n});const{style:s}=t;s.left=`calc(${this.#b[0]}%)`,s.top=`calc(${this.#b[1]}% - var(--comment-button-dim))`,this.#_&&(s.backgroundColor=this.#_),e.after(t)}render(){if(this.#g)return;const t=this.#g=document.createElement("div");if(t.className="popup",this.#a){const s=t.style.outlineColor=at.makeHexColor(...this.#a);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#y?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#y}if(t.append(e),this.#o){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),s.dateTime=this.#o.toISOString(),e.append(s)}const n=this.#x;if(n)Lv.render({xfaHtml:n,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const s=this._formatContents(this.#r);t.append(s)}this.#s.append(t)}get#x(){const t=this.#S,e=this.#r;return t?.str&&(!e?.str||e.str===t.str)&&this.#S.html||null}get#D(){return this.#x?.attributes?.style?.fontSize||0}get#I(){return this.#x?.attributes?.style?.color||null}#k(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:this.#I,fontSize:this.#D?`calc(${this.#D}px * var(--total-scale-factor))`:""}};for(const o of t.split(`
`))e.push({name:"span",value:o,attributes:s});return n}_formatContents({str:t,dir:e}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=e;const s=t.split(/(?:\r\n?|\n)/);for(let o=0,c=s.length;o<c;++o){const h=s[o];n.append(document.createTextNode(h)),o<c-1&&n.append(document.createElement("br"))}return n}#L(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#N()}updateEdited({rect:t,popup:e,deleted:n}){if(n||e?.deleted){this.remove();return}this.#T(),this.#E||={contentsObj:this.#r,richText:this.#S},t&&(this.#h=null),e&&(this.#S=this.#k(e.text),this.#o=sf.toDateObject(e.date),this.#r=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#E&&({contentsObj:this.#r,richText:this.#S}=this.#E,this.#E=null,this.#g?.remove(),this.#g=null,this.#h=null)}remove(){this.#p?.abort(),this.#p=null,this.#g?.remove(),this.#g=null,this.#R=!1,this.#f=!1;for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#P(){if(this.#h!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:s,pageY:o}}}=this.#d;let c=!!this.#u,h=c?this.#u:this.#A;for(const A of this.#l)if(!h||at.intersect(A.data.rect,h)!==null){h=A.data.rect,c=!0;break}const d=at.normalizeRect([h[0],t[3]-h[1]+t[1],h[2],t[3]-h[3]+t[1]]),g=c?h[2]-h[0]+5:0,_=d[0]+g,y=d[1];this.#h=[100*(_-s)/e,100*(y-o)/n];const{style:b}=this.#s;b.left=`${this.#h[0]}%`,b.top=`${this.#h[1]}%`}#N(){this.#f=!this.#f,this.#f?(this.#H(),this.#s.addEventListener("click",this.#i),this.#s.addEventListener("keydown",this.#t)):(this.#C(),this.#s.removeEventListener("click",this.#i),this.#s.removeEventListener("keydown",this.#t))}#H(){this.#g||this.render(),this.isVisible?this.#f&&this.#s.classList.add("focused"):(this.#P(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#C(){this.#s.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#R=this.isVisible,this.#R&&(this.#s.hidden=!0)}maybeShow(){this.#T(),this.#R&&(this.#g||this.#H(),this.#R=!1,this.#s.hidden=!1)}get isVisible(){return this.#s.hidden===!1}}class Pv extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=_t.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class x1 extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),o=this.#t=this.svgFactory.createElement("svg:line");return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class R1 extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,c=this.#t=this.svgFactory.createElement("svg:rect");return c.setAttribute("x",o/2),c.setAttribute("y",o/2),c.setAttribute("width",e-o),c.setAttribute("height",n-o),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),s.append(c),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class D1 extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,c=this.#t=this.svgFactory.createElement("svg:ellipse");return c.setAttribute("cx",e/2),c.setAttribute("cy",n/2),c.setAttribute("rx",e/2-o/2),c.setAttribute("ry",n/2-o/2),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),s.append(c),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Bv extends le{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:s},width:o,height:c}=this;if(!e)return this.container;const h=this.svgFactory.create(o,c,!0);let d=[];for(let g=0,_=e.length;g<_;g+=2){const y=e[g]-t[0],b=t[3]-e[g+1];d.push(`${y},${b}`)}d=d.join(" ");const f=this.#t=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",d),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),h.append(f),this.container.append(h),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class M1 extends Bv{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class N1 extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Kf extends le{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?_t.HIGHLIGHT:_t.INK}#n(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:s,popupRef:o}}=this,{transform:c,width:h,height:d}=this.#n(e,t),f=this.svgFactory.create(h,d,!0),g=this.#t=this.svgFactory.createElement("svg:g");f.append(g),g.setAttribute("stroke-width",s.width||1),g.setAttribute("stroke-linecap","round"),g.setAttribute("stroke-linejoin","round"),g.setAttribute("stroke-miterlimit",10),g.setAttribute("stroke","transparent"),g.setAttribute("fill","transparent"),g.setAttribute("transform",c);for(let _=0,y=n.length;_<y;_++){const b=this.svgFactory.createElement(this.svgElementName);this.#e.push(b),b.setAttribute("points",n[_].join(",")),g.append(b)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:s}=t,o=this.#t;if(e>=0&&o.setAttribute("stroke-width",e||1),n)for(let c=0,h=this.#e.length;c<h;c++)this.#e[c].setAttribute("points",n[c].join(","));if(s){const{transform:c,width:h,height:d}=this.#n(this.data.rotation,s);o.parentElement.setAttribute("viewBox",`0 0 ${h} ${d}`),o.setAttribute("transform",c)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}get commentButtonPosition(){const{inkLists:t,rect:e}=this.data;if(t?.length>=1){let n=-1/0,s=-1/0;for(const o of t)for(let c=0,h=o.length;c<h;c+=2)o[c+1]>s?(s=o[c+1],n=o[c]):o[c+1]===s&&(n=Math.max(n,o[c]));if(n!==1/0)return[n,s]}return e?[e[2],e[3]]:null}}class Fv extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=_t.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class O1 extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class k1 extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class L1 extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Hv extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=_t.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class I1 extends le{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||e.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#e.bind(this)),this.#t=n;const{isMac:s}=ke.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(s?o.metaKey:o.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Qf{#t=null;#e=null;#n=new Map;#i=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:s,page:o,viewport:c,structTreeLayer:h}){this.div=t,this.#t=e,this.#e=n,this.#i=h||null,this.page=o,this.viewport=c,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#n.size>0}async#a(t,e,n){const s=t.firstChild||t,o=s.id=`${Hf}${e}`,c=await this.#i?.getAriaAttributes(o);if(c)for(const[h,d]of c)s.setAttribute(h,d);n?n.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,s,!1))}async render(t){const{annotations:e}=t,n=this.div;Os(n,this.viewport);const s=new Map,o={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Dc,annotationStorage:t.annotationStorage||new Vf,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const c of e){if(c.noHTML)continue;const h=c.annotationType===de.POPUP;if(h){const g=s.get(c.id);if(!g)continue;o.elements=g}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;o.data=c;const d=lb.create(o);if(!d.isRenderable)continue;if(!h&&c.popupRef){const g=s.get(c.popupRef);g?g.push(d):s.set(c.popupRef,[d])}const f=d.render();c.hidden&&(f.style.visibility="hidden"),await this.#a(f,c.id,o.elements),d._isEditable&&(this.#n.set(d.data.id,d),this._annotationEditorUIManager?.renderAnnotationElement(d))}this.#s()}async addLinkAnnotations(t,e){const n={data:null,layer:this.div,linkService:e,svgFactory:new Dc,parent:this};for(const s of t){s.borderStyle||=Qf._defaultBorderStyle,n.data=s;const o=lb.create(n);if(!o.isRenderable)continue;const c=o.render();await this.#a(c,s.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,Os(e,{rotation:t.rotation}),this.#s(),e.hidden=!1}#s(){if(!this.#e)return;const t=this.div;for(const[e,n]of this.#e){const s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;n.className="annotationContent";const{firstChild:o}=s;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):s.append(n);const c=this.#n.get(e);c&&(c._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,s.id,n),c._hasNoCanvas=!1):c.canvas=n)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(t){return this.#n.get(t)}static get _defaultBorderStyle(){return Tt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:ka.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const bc=/\r\n?|\n/g;class Se extends ut{#t;#e="";#n=`${this.id}-editor`;#i=null;#a;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Se.prototype,e=o=>o.isEmpty(),n=Ji.TRANSLATE_SMALL,s=Ji.TRANSLATE_BIG;return Tt(this,"_keyboardManager",new Vo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=_t.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#t=t.color||Se._defaultColor||ut._defaultLineColor,this.#a=t.fontSize||Se._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){ut.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case Ot.FREETEXT_SIZE:Se._defaultFontSize=e;break;case Ot.FREETEXT_COLOR:Se._defaultColor=e;break}}updateParams(t,e){switch(t){case Ot.FREETEXT_SIZE:this.#s(e);break;case Ot.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[Ot.FREETEXT_SIZE,Se._defaultFontSize],[Ot.FREETEXT_COLOR,Se._defaultColor||ut._defaultLineColor]]}get propertiesToUpdate(){return[[Ot.FREETEXT_SIZE,this.#a],[Ot.FREETEXT_COLOR,this.#t]]}get toolbarButtons(){return this._colorPicker||=new Do(this),[["colorPicker",this._colorPicker]]}get colorType(){return Ot.FREETEXT_COLOR}get colorValue(){return this.#t}#s(t){const e=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-this.#a)*this.parentScale),this.#a=s,this.#l()},n=this.#a;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#r(t){const e=s=>{this.#t=this.editorDiv.style.color=s,this._colorPicker?.update(s)},n=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Se._internalPadding*t,-(Se._internalPadding+this.#a)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(Se.#c(n)),e=n);return t.join(`
`)}#l(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:s,div:o}=this,c=o.style.display,h=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",s.div.append(this.div),n=o.getBoundingClientRect(),o.remove(),o.style.display=c,o.classList.toggle("hidden",h)}this.rotation%180===this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;const n=s=>{if(this.#e=s,!s){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#l()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#l()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Se._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#a}px * var(--total-scale-factor))`,n.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,o]=this.parentDimensions;if(this.annotationElementId){const{position:c}=this._initialData;let[h,d]=this.getInitialTranslation();[h,d]=this.pageTranslationToScreen(h,d);const[f,g]=this.pageDimensions,[_,y]=this.pageTranslation;let b,A;switch(this.rotation){case 0:b=t+(c[0]-_)/f,A=e+this.height-(c[1]-y)/g;break;case 90:b=t+(c[0]-_)/f,A=e-(c[1]-y)/g,[h,d]=[d,-h];break;case 180:b=t-this.width+(c[0]-_)/f,A=e-(c[1]-y)/g,[h,d]=[-h,-d];break;case 270:b=t+(c[0]-_-this.height*g)/f,A=e+(c[1]-y-this.width*f)/g,[h,d]=[-d,h];break}this.setAt(b*s,A*o,h,d)}else this._moveAfterPaste(t,e);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(bc,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(n.length===1&&n[0]==="text/plain")return;t.preventDefault();const s=Se.#f(e.getData("text")||"").replaceAll(bc,`
`);if(!s)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const c=o.getRangeAt(0);if(!s.includes(`
`)){c.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:h,startOffset:d}=c,f=[],g=[];if(h.nodeType===Node.TEXT_NODE){const b=h.parentElement;if(g.push(h.nodeValue.slice(d).replaceAll(bc,"")),b!==this.editorDiv){let A=f;for(const S of this.editorDiv.childNodes){if(S===b){A=g;continue}A.push(Se.#c(S))}}f.push(h.nodeValue.slice(0,d).replaceAll(bc,""))}else if(h===this.editorDiv){let b=f,A=0;for(const S of this.editorDiv.childNodes)A++===d&&(b=g),b.push(Se.#c(S))}this.#e=`${f.join(`
`)}${s}${g.join(`
`)}`,this.#d();const _=new Range;let y=Math.sumPrecise(f.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const A=b.nodeValue.length;if(y<=A){_.setStart(b,y),_.setEnd(b,y);break}y-=A}o.removeAllRanges(),o.addRange(_)}#d(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const t of this.#e.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#e.replaceAll(" "," ")}static#f(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Se._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,n){let s=null;if(t instanceof Pv){const{data:{defaultAppearanceData:{fontSize:c,fontColor:h},rect:d,rotation:f,id:g,popupRef:_,contentsObj:y},textContent:b,textPosition:A,parent:{page:{pageNumber:S}}}=t;if(!b||b.length===0)return null;s=t={annotationType:_t.FREETEXT,color:Array.from(h),fontSize:c,value:b.join(`
`),position:A,pageIndex:S-1,rect:d.slice(0),rotation:f,annotationElementId:g,id:g,deleted:!1,popupRef:_,comment:y?.str||null}}const o=await super.deserialize(t,e,n);return o.#a=t.fontSize,o.#t=at.makeHexColor(...t.color),o.#e=Se.#f(t.value),o._initialData=s,t.comment&&o.setCommentData(t.comment),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),n=ut._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),s={annotationType:_t.FREETEXT,color:n,fontSize:this.#a,value:this.#u(),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#g(s)?null:(s.id=this.annotationElementId,s)}#g(t){const{value:e,fontSize:n,color:s,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((c,h)=>c!==s[h])||t.pageIndex!==o}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:n}=e;n.fontSize=`calc(${this.#a}px * var(--total-scale-factor))`,n.color=this.#t,e.replaceChildren();for(const o of this.#e.split(`
`)){const c=document.createElement("div");c.append(o?document.createTextNode(o):document.createElement("br")),e.append(c)}const s={rect:this.getPDFRect()};return s.popup=this.hasEditedComment?this.comment:{text:this.#e},t.updateEdited(s),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class it{static PRECISION=1e-4;toSVGPath(){Vt("Abstract method `toSVGPath` must be implemented.")}get box(){Vt("Abstract getter `box` must be implemented.")}serialize(t,e){Vt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,s,o,c){c||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)c[h]=e+t[h]*s,c[h+1]=n+t[h+1]*o;return c}static _rescaleAndSwap(t,e,n,s,o,c){c||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)c[h]=e+t[h+1]*s,c[h+1]=n+t[h]*o;return c}static _translate(t,e,n,s){s||=new Float32Array(t.length);for(let o=0,c=t.length;o<c;o+=2)s[o]=e+t[o],s[o+1]=n+t[o+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,s,o){switch(o){case 90:return[1-e/n,t/s];case 180:return[1-t/n,1-e/s];case 270:return[e/n,1-t/s];default:return[t/n,e/s]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,s,o,c){return[(t+5*n)/6,(e+5*s)/6,(5*n+o)/6,(5*s+c)/6,(n+o)/2,(s+c)/2]}}class ws{#t;#e=[];#n;#i;#a=[];#s=new Float32Array(18);#r;#o;#l;#c;#d;#u;#f=[];static#g=8;static#p=2;static#h=ws.#g+ws.#p;constructor({x:t,y:e},n,s,o,c,h=0){this.#t=n,this.#u=o*s,this.#i=c,this.#s.set([NaN,NaN,NaN,NaN,t,e],6),this.#n=h,this.#c=ws.#g*s,this.#l=ws.#h*s,this.#d=s,this.#f.push(t,e)}isEmpty(){return isNaN(this.#s[8])}#m(){const t=this.#s.subarray(4,6),e=this.#s.subarray(16,18),[n,s,o,c]=this.#t;return[(this.#r+(t[0]-e[0])/2-n)/o,(this.#o+(t[1]-e[1])/2-s)/c,(this.#r+(e[0]-t[0])/2-n)/o,(this.#o+(e[1]-t[1])/2-s)/c]}add({x:t,y:e}){this.#r=t,this.#o=e;const[n,s,o,c]=this.#t;let[h,d,f,g]=this.#s.subarray(8,12);const _=t-f,y=e-g,b=Math.hypot(_,y);if(b<this.#l)return!1;const A=b-this.#c,S=A/b,C=S*_,w=S*y;let N=h,x=d;h=f,d=g,f+=C,g+=w,this.#f?.push(t,e);const M=-w/A,D=C/A,O=M*this.#u,B=D*this.#u;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([f+O,g+B],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([f-O,g-B],16),isNaN(this.#s[6])?(this.#a.length===0&&(this.#s.set([h+O,d+B],2),this.#a.push(NaN,NaN,NaN,NaN,(h+O-n)/o,(d+B-s)/c),this.#s.set([h-O,d-B],14),this.#e.push(NaN,NaN,NaN,NaN,(h-O-n)/o,(d-B-s)/c)),this.#s.set([N,x,h,d,f,g],6),!this.isEmpty()):(this.#s.set([N,x,h,d,f,g],6),Math.abs(Math.atan2(x-d,N-h)-Math.atan2(w,C))<Math.PI/2?([h,d,f,g]=this.#s.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((h+f)/2-n)/o,((d+g)/2-s)/c),[h,d,N,x]=this.#s.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((N+h)/2-n)/o,((x+d)/2-s)/c),!0):([N,x,h,d,f,g]=this.#s.subarray(0,6),this.#a.push(((N+5*h)/6-n)/o,((x+5*d)/6-s)/c,((5*h+f)/6-n)/o,((5*d+g)/6-s)/c,((h+f)/2-n)/o,((d+g)/2-s)/c),[f,g,h,d,N,x]=this.#s.subarray(12,18),this.#e.push(((N+5*h)/6-n)/o,((x+5*d)/6-s)/c,((5*h+f)/6-n)/o,((5*d+g)/6-s)/c,((h+f)/2-n)/o,((d+g)/2-s)/c),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#b();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);this.#A(n);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return this.#_(n),n.join(" ")}#b(){const[t,e,n,s]=this.#t,[o,c,h,d]=this.#m();return`M${(this.#s[2]-t)/n} ${(this.#s[3]-e)/s} L${(this.#s[4]-t)/n} ${(this.#s[5]-e)/s} L${o} ${c} L${h} ${d} L${(this.#s[16]-t)/n} ${(this.#s[17]-e)/s} L${(this.#s[14]-t)/n} ${(this.#s[15]-e)/s} Z`}#_(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#A(t){const[e,n,s,o]=this.#t,c=this.#s.subarray(4,6),h=this.#s.subarray(16,18),[d,f,g,_]=this.#m();t.push(`L${(c[0]-e)/s} ${(c[1]-n)/o} L${d} ${f} L${g} ${_} L${(h[0]-e)/s} ${(h[1]-n)/o}`)}newFreeDrawOutline(t,e,n,s,o,c){return new zv(t,e,n,s,o,c)}getOutlines(){const t=this.#a,e=this.#e,n=this.#s,[s,o,c,h]=this.#t,d=new Float32Array((this.#f?.length??0)+2);for(let _=0,y=d.length-2;_<y;_+=2)d[_]=(this.#f[_]-s)/c,d[_+1]=(this.#f[_+1]-o)/h;if(d[d.length-2]=(this.#r-s)/c,d[d.length-1]=(this.#o-o)/h,isNaN(n[6])&&!this.isEmpty())return this.#S(d);const f=new Float32Array(this.#a.length+24+this.#e.length);let g=t.length;for(let _=0;_<g;_+=2){if(isNaN(t[_])){f[_]=f[_+1]=NaN;continue}f[_]=t[_],f[_+1]=t[_+1]}g=this.#E(f,g);for(let _=e.length-6;_>=6;_-=6)for(let y=0;y<6;y+=2){if(isNaN(e[_+y])){f[g]=f[g+1]=NaN,g+=2;continue}f[g]=e[_+y],f[g+1]=e[_+y+1],g+=2}return this.#y(f,g),this.newFreeDrawOutline(f,d,this.#t,this.#d,this.#n,this.#i)}#S(t){const e=this.#s,[n,s,o,c]=this.#t,[h,d,f,g]=this.#m(),_=new Float32Array(36);return _.set([NaN,NaN,NaN,NaN,(e[2]-n)/o,(e[3]-s)/c,NaN,NaN,NaN,NaN,(e[4]-n)/o,(e[5]-s)/c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,f,g,NaN,NaN,NaN,NaN,(e[16]-n)/o,(e[17]-s)/c,NaN,NaN,NaN,NaN,(e[14]-n)/o,(e[15]-s)/c],0),this.newFreeDrawOutline(_,t,this.#t,this.#d,this.#n,this.#i)}#y(t,e){const n=this.#e;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6}#E(t,e){const n=this.#s.subarray(4,6),s=this.#s.subarray(16,18),[o,c,h,d]=this.#t,[f,g,_,y]=this.#m();return t.set([NaN,NaN,NaN,NaN,(n[0]-o)/h,(n[1]-c)/d,NaN,NaN,NaN,NaN,f,g,NaN,NaN,NaN,NaN,_,y,NaN,NaN,NaN,NaN,(s[0]-o)/h,(s[1]-c)/d],e),e+=24}}class zv extends it{#t;#e=new Float32Array(4);#n;#i;#a;#s;#r;constructor(t,e,n,s,o,c){super(),this.#r=t,this.#a=e,this.#t=n,this.#s=s,this.#n=o,this.#i=c,this.lastPoint=[NaN,NaN],this.#o(c);const[h,d,f,g]=this.#e;for(let _=0,y=t.length;_<y;_+=2)t[_]=(t[_]-h)/f,t[_+1]=(t[_+1]-d)/g;for(let _=0,y=e.length;_<y;_+=2)e[_]=(e[_]-h)/f,e[_+1]=(e[_+1]-d)/g}toSVGPath(){const t=[`M${this.#r[4]} ${this.#r[5]}`];for(let e=6,n=this.#r.length;e<n;e+=6){if(isNaN(this.#r[e])){t.push(`L${this.#r[e+4]} ${this.#r[e+5]}`);continue}t.push(`C${this.#r[e]} ${this.#r[e+1]} ${this.#r[e+2]} ${this.#r[e+3]} ${this.#r[e+4]} ${this.#r[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,n,s],o){const c=n-t,h=s-e;let d,f;switch(o){case 0:d=it._rescale(this.#r,t,s,c,-h),f=it._rescale(this.#a,t,s,c,-h);break;case 90:d=it._rescaleAndSwap(this.#r,t,e,c,h),f=it._rescaleAndSwap(this.#a,t,e,c,h);break;case 180:d=it._rescale(this.#r,n,e,-c,h),f=it._rescale(this.#a,n,e,-c,h);break;case 270:d=it._rescaleAndSwap(this.#r,n,s,-c,-h),f=it._rescaleAndSwap(this.#a,n,s,-c,-h);break}return{outline:Array.from(d),points:[Array.from(f)]}}#o(t){const e=this.#r;let n=e[4],s=e[5];const o=[n,s,n,s];let c=n,h=s;const d=t?Math.max:Math.min;for(let g=6,_=e.length;g<_;g+=6){const y=e[g+4],b=e[g+5];if(isNaN(e[g]))at.pointBoundingBox(y,b,o),h<b?(c=y,h=b):h===b&&(c=d(c,y));else{const A=[1/0,1/0,-1/0,-1/0];at.bezierBoundingBox(n,s,...e.slice(g,g+6),A),at.rectBoundingBox(...A,o),h<A[3]?(c=A[2],h=A[3]):h===A[3]&&(c=d(c,A[2]))}n=y,s=b}const f=this.#e;f[0]=o[0]-this.#n,f[1]=o[1]-this.#n,f[2]=o[2]-o[0]+2*this.#n,f[3]=o[3]-o[1]+2*this.#n,this.lastPoint=[c,h]}get box(){return this.#e}newOutliner(t,e,n,s,o,c=0){return new ws(t,e,n,s,o,c)}getNewOutline(t,e){const[n,s,o,c]=this.#e,[h,d,f,g]=this.#t,_=o*f,y=c*g,b=n*f+h,A=s*g+d,S=this.newOutliner({x:this.#a[0]*_+b,y:this.#a[1]*y+A},this.#t,this.#s,t,this.#i,e??this.#n);for(let C=2;C<this.#a.length;C+=2)S.add({x:this.#a[C]*_+b,y:this.#a[C+1]*y+A});return S.getOutlines()}}class uf{#t;#e;#n=[];#i=[];constructor(t,e=0,n=0,s=!0){const o=[1/0,1/0,-1/0,-1/0],c=10**-4;for(const{x:b,y:A,width:S,height:C}of t){const w=Math.floor((b-e)/c)*c,N=Math.ceil((b+S+e)/c)*c,x=Math.floor((A-e)/c)*c,M=Math.ceil((A+C+e)/c)*c,D=[w,x,M,!0],O=[N,x,M,!1];this.#n.push(D,O),at.rectBoundingBox(w,x,N,M,o)}const h=o[2]-o[0]+2*n,d=o[3]-o[1]+2*n,f=o[0]-n,g=o[1]-n,_=this.#n.at(s?-1:-2),y=[_[0],_[2]];for(const b of this.#n){const[A,S,C]=b;b[0]=(A-f)/h,b[1]=(S-g)/d,b[2]=(C-g)/d}this.#t=new Float32Array([f,g,h,d]),this.#e=y}getOutlines(){this.#n.sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);const t=[];for(const e of this.#n)e[3]?(t.push(...this.#l(e)),this.#r(e)):(this.#o(e),t.push(...this.#l(e)));return this.#a(t)}#a(t){const e=[],n=new Set;for(const c of t){const[h,d,f]=c;e.push([h,d,c],[h,f,c])}e.sort((c,h)=>c[1]-h[1]||c[0]-h[0]);for(let c=0,h=e.length;c<h;c+=2){const d=e[c][2],f=e[c+1][2];d.push(f),f.push(d),n.add(d),n.add(f)}const s=[];let o;for(;n.size>0;){const c=n.values().next().value;let[h,d,f,g,_]=c;n.delete(c);let y=h,b=d;for(o=[h,f],s.push(o);;){let A;if(n.has(g))A=g;else if(n.has(_))A=_;else break;n.delete(A),[h,d,f,g,_]=A,y!==h&&(o.push(y,b,h,b===d?d:f),y=h),b=b===d?f:d}o.push(y,b)}return new P1(s,this.#t,this.#e)}#s(t){const e=this.#i;let n=0,s=e.length-1;for(;n<=s;){const o=n+s>>1,c=e[o][0];if(c===t)return o;c<t?n=o+1:s=o-1}return s+1}#r([,t,e]){const n=this.#s(t);this.#i.splice(n,0,[t,e])}#o([,t,e]){const n=this.#s(t);for(let s=n;s<this.#i.length;s++){const[o,c]=this.#i[s];if(o!==t)break;if(o===t&&c===e){this.#i.splice(s,1);return}}for(let s=n-1;s>=0;s--){const[o,c]=this.#i[s];if(o!==t)break;if(o===t&&c===e){this.#i.splice(s,1);return}}}#l(t){const[e,n,s]=t,o=[[e,n,s]],c=this.#s(s);for(let h=0;h<c;h++){const[d,f]=this.#i[h];for(let g=0,_=o.length;g<_;g++){const[,y,b]=o[g];if(!(f<=y||b<=d)){if(y>=d){if(b>f)o[g][1]=f;else{if(_===1)return[];o.splice(g,1),g--,_--}continue}o[g][2]=d,b>f&&o.push([e,f,b])}}}return o}}class P1 extends it{#t;#e;constructor(t,e,n){super(),this.#e=t,this.#t=e,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#e){let[n,s]=e;t.push(`M${n} ${s}`);for(let o=2;o<e.length;o+=2){const c=e[o],h=e[o+1];c===n?(t.push(`V${h}`),s=h):h===s&&(t.push(`H${c}`),n=c)}t.push("Z")}return t.join(" ")}serialize([t,e,n,s],o){const c=[],h=n-t,d=s-e;for(const f of this.#e){const g=new Array(f.length);for(let _=0;_<f.length;_+=2)g[_]=t+f[_]*h,g[_+1]=s-f[_+1]*d;c.push(g)}return c}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class hf extends ws{newFreeDrawOutline(t,e,n,s,o,c){return new B1(t,e,n,s,o,c)}}class B1 extends zv{newOutliner(t,e,n,s,o,c=0){return new hf(t,e,n,s,o,c)}}class re extends ut{#t=null;#e=0;#n;#i=null;#a=null;#s=null;#r=null;#o=0;#l=null;#c=null;#d=null;#u=!1;#f=null;#g;#p=null;#h="";#m;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=_t.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=re.prototype;return Tt(this,"_keyboardManager",new Vo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||re._defaultColor,this.#m=t.thickness||re._defaultThickness,this.#g=t.opacity||re._defaultOpacity,this.#n=t.boxes||null,this.#b=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#u=!0,this.#A(t),this.#T()):this.#n&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#r=t.focusNode,this.#o=t.focusOffset,this.#_(),this.#T(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#m,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#_(){const t=new uf(this.#n,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const e=new uf(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#s=e.getOutlines();const{lastPoint:n}=this.#s;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#A({highlightOutlines:t,highlightId:e,clipPathId:n}){this.#c=t;const s=1.5;if(this.#s=t.getNewOutline(this.#m/2+s,.0025),e>=0)this.#d=e,this.#i=n,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:re.#w(this.#c.box,(g-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:re.#w(this.#s.box,g),path:{d:this.#s.toSVGPath()}})}const[o,c,h,d]=t.box;switch(this.rotation){case 0:this.x=o,this.y=c,this.width=h,this.height=d;break;case 90:{const[g,_]=this.parentDimensions;this.x=c,this.y=1-o,this.width=h*_/g,this.height=d*g/_;break}case 180:this.x=1-o,this.y=1-c,this.width=h,this.height=d;break;case 270:{const[g,_]=this.parentDimensions;this.x=1-c,this.y=o,this.width=h*_/g,this.height=d*g/_;break}}const{lastPoint:f}=this.#s;this.#f=[(f[0]-o)/h,(f[1]-c)/d]}static initialize(t,e){ut.initialize(t,e),re._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case Ot.HIGHLIGHT_COLOR:re._defaultColor=e;break;case Ot.HIGHLIGHT_THICKNESS:re._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#f}updateParams(t,e){switch(t){case Ot.HIGHLIGHT_COLOR:this.#S(e);break;case Ot.HIGHLIGHT_THICKNESS:this.#y(e);break}}static get defaultPropertiesToUpdate(){return[[Ot.HIGHLIGHT_COLOR,re._defaultColor],[Ot.HIGHLIGHT_THICKNESS,re._defaultThickness]]}get propertiesToUpdate(){return[[Ot.HIGHLIGHT_COLOR,this.color||re._defaultColor],[Ot.HIGHLIGHT_THICKNESS,this.#m||re._defaultThickness],[Ot.HIGHLIGHT_FREE,this.#u]]}#S(t){const e=(o,c)=>{this.color=o,this.#g=c,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:o,"fill-opacity":c}}),this.#a?.updateColor(o)},n=this.color,s=this.#g;this.addCommands({cmd:e.bind(this,t,re._defaultOpacity),undo:e.bind(this,n,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#y(t){const e=this.#m,n=s=>{this.#m=s,this.#E(s)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new En({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#D())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#D())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#R(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#T(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#R():t&&(this.#T(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#E(t){if(!this.#u)return;this.#A({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}#R(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#T(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#i}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#g},rootClass:{highlight:!0,free:this.#u},path:{d:this.#c.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#u),this.#l&&(this.#l.style.clipPath=this.#i))}static#w([t,e,n,s],o){switch(o){case 90:return[1-e-s,t,s,n];case 180:return[1-t-n,1-e-s,n,s];case 270:return[e,1-t-n,s,n]}return[t,e,n,s]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#u?(t=(t-this.rotation+360)%360,n=re.#w(this.#c.box,t)):n=re.#w([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:re.#w(this.#s.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#u?t.classList.add("free"):this.div.addEventListener("keydown",this.#O.bind(this),{signal:this._uiManager._signal});const e=this.#l=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#i;const[n,s]=this.parentDimensions;return this.setDims(this.width*n,this.height*s),gv(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#O(t){re._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#x(!0);break;case 1:case 3:this.#x(!1);break}}#x(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#r,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#u||this.#x(!1))}get _mustFixPosition(){return!this.#u}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#D(){return this.#u?this.rotation:0}#I(){if(this.#u)return null;const[t,e]=this.pageDimensions,[n,s]=this.pageTranslation,o=this.#n,c=new Float32Array(o.length*8);let h=0;for(const{x:d,y:f,width:g,height:_}of o){const y=d*t+n,b=(1-f)*e+s;c[h]=c[h+4]=y,c[h+1]=c[h+3]=b,c[h+2]=c[h+6]=y+g*t,c[h+5]=c[h+7]=b-_*e,h+=8}return c}#k(t){return this.#c.serialize(t,this.#D())}static startHighlighting(t,e,{target:n,x:s,y:o}){const{x:c,y:h,width:d,height:f}=n.getBoundingClientRect(),g=new AbortController,_=t.combinedSignal(g),y=b=>{g.abort(),this.#P(t,b)};window.addEventListener("blur",y,{signal:_}),window.addEventListener("pointerup",y,{signal:_}),window.addEventListener("pointerdown",fe,{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",xn,{signal:_}),n.addEventListener("pointermove",this.#L.bind(this,t),{signal:_}),this._freeHighlight=new hf({x:s,y:o},[c,h,d,f],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#L(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#P(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let s=null;if(t instanceof Fv){const{data:{quadPoints:A,rect:S,rotation:C,id:w,color:N,opacity:x,popupRef:M,contentsObj:D},parent:{page:{pageNumber:O}}}=t;s=t={annotationType:_t.HIGHLIGHT,color:Array.from(N),opacity:x,quadPoints:A,boxes:null,pageIndex:O-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,popupRef:M,comment:D?.str||null}}else if(t instanceof Kf){const{data:{inkLists:A,rect:S,rotation:C,id:w,color:N,borderStyle:{rawWidth:x},popupRef:M,contentsObj:D},parent:{page:{pageNumber:O}}}=t;s=t={annotationType:_t.HIGHLIGHT,color:Array.from(N),thickness:x,inkLists:A,boxes:null,pageIndex:O-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,popupRef:M,comment:D?.str||null}}const{color:o,quadPoints:c,inkLists:h,opacity:d}=t,f=await super.deserialize(t,e,n);f.color=at.makeHexColor(...o),f.#g=d||1,h&&(f.#m=t.thickness),f._initialData=s,t.comment&&f.setCommentData(t.comment);const[g,_]=f.pageDimensions,[y,b]=f.pageTranslation;if(c){const A=f.#n=[];for(let S=0;S<c.length;S+=8)A.push({x:(c[S]-y)/g,y:1-(c[S+1]-b)/_,width:(c[S+2]-c[S])/g,height:(c[S+1]-c[S+5])/_});f.#_(),f.#T(),f.rotate(f.rotation)}else if(h){f.#u=!0;const A=h[0],S={x:A[0]-y,y:_-(A[1]-b)},C=new hf(S,[0,0,g,_],1,f.#m/2,!0,.001);for(let x=0,M=A.length;x<M;x+=2)S.x=A[x]-y,S.y=_-(A[x+1]-b),C.add(S);const{id:w,clipPathId:N}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);f.#A({highlightOutlines:C.getOutlines(),highlightId:w,clipPathId:N}),f.#T(),f.rotate(f.parentRotation)}return f}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),n=ut._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s={annotationType:_t.HIGHLIGHT,color:n,opacity:this.#g,thickness:this.#m,quadPoints:this.#I(),outlines:this.#k(e),pageIndex:this.pageIndex,rect:e,rotation:this.#D(),structTreeParentId:this._structTreeParentId};return this.addComment(s),this.annotationElementId&&!this.#N(s)?null:(s.id=this.annotationElementId,s)}#N(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((n,s)=>n!==e[s])}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}static canCreateNewEmptyEditor(){return!1}}class Uv{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Vt("Not implemented")}}class ft extends ut{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#a=null;static#s=NaN;static#r=null;static#o=null;static#l=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(this.#c(t),this.#f())}#c({drawOutlines:t,drawId:e,drawingOptions:n}){this.#t=t,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#d(t,this.parent),this.#h(t.box)}#d(t,e){const{id:n}=e.drawLayer.draw(ft._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[s,o]of Object.entries(e))n.has(s)?Object.assign(t[s],o):t[s]=o;return t}static getDefaultDrawingOptions(t){Vt("Not implemented")}static get typesMap(){Vt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(ft.#n.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,s]of this.typesMap)t.push([n,e[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,s]of this.constructor.typesMap)t.push([n,e[s]]);return t}_updateProperty(t,e,n){const s=this._drawingOptions,o=s[e],c=h=>{s.updateProperty(e,h);const d=this.#t.updateProperty(e,h);d&&this.#h(d),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),t===this.colorType&&this._colorPicker?.update(h)};this.addCommands({cmd:c.bind(this,n),undo:c.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#m()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#u(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#u()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#u(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#t,t)}}#g([t,e,n,s]){const{parentDimensions:[o,c],rotation:h}=this;switch(h){case 90:return[e,1-t,n*(c/o),s*(o/c)];case 180:return[1-t,1-e,n,s];case 270:return[1-e,t,n*(c/o),s*(o/c)];default:return[t,e,n,s]}}#p(){const{x:t,y:e,width:n,height:s,parentDimensions:[o,c],rotation:h}=this;switch(h){case 90:return[1-e,t,n*(o/c),s*(c/o)];case 180:return[1-t,1-e,n,s];case 270:return[e,1-t,n*(o/c),s*(c/o)];default:return[t,e,n,s]}}#h(t){if([this.x,this.y,this.width,this.height]=this.#g(t),this.div){this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}this._onResized()}#m(){const{x:t,y:e,width:n,height:s,rotation:o,parentRotation:c,parentDimensions:[h,d]}=this;switch((o*4+c)/90){case 1:return[1-e-s,t,s,n];case 2:return[1-t-n,1-e-s,n,s];case 3:return[e,1-t-n,s,n];case 4:return[t,e-n*(h/d),s*(d/h),n*(h/d)];case 5:return[1-e,t,n*(h/d),s*(d/h)];case 6:return[1-t-s*(d/h),1-e,s*(d/h),n*(h/d)];case 7:return[e-n*(h/d),1-t-s*(d/h),n*(h/d),s*(d/h)];case 8:return[t-n,e-s,n,s];case 9:return[1-e,t-n,s,n];case 10:return[1-t,1-e,n,s];case 11:return[e-s,1-t,s,n];case 12:return[t-s*(d/h),e,s*(d/h),n*(h/d)];case 13:return[1-e-n*(h/d),t-s*(d/h),n*(h/d),s*(d/h)];case 14:return[1-t,1-e-n*(h/d),s*(d/h),n*(h/d)];case 15:return[e,1-t,n*(h/d),s*(d/h)];default:return[t,e,n,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ft._mergeSVGProperties({bbox:this.#m()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const s=document.createElement("div");n.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[o,c]=this.parentDimensions;return this.setDims(this.width*o,this.height*c),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,s,o){Vt("Not implemented")}static startDrawing(t,e,n,s){const{target:o,offsetX:c,offsetY:h,pointerId:d,pointerType:f}=s;if(ft.#r&&ft.#r!==f)return;const{viewport:{rotation:g}}=t,{width:_,height:y}=o.getBoundingClientRect(),b=ft.#i=new AbortController,A=t.combinedSignal(b);if(ft.#s||=d,ft.#r??=f,window.addEventListener("pointerup",S=>{ft.#s===S.pointerId?this._endDraw(S):ft.#o?.delete(S.pointerId)},{signal:A}),window.addEventListener("pointercancel",S=>{ft.#s===S.pointerId?this._currentParent.endDrawingSession():ft.#o?.delete(S.pointerId)},{signal:A}),window.addEventListener("pointerdown",S=>{ft.#r===S.pointerType&&((ft.#o||=new Set).add(S.pointerId),ft.#n.isCancellable()&&(ft.#n.removeLastElement(),ft.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:A}),window.addEventListener("contextmenu",xn,{signal:A}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:A}),o.addEventListener("touchmove",S=>{S.timeStamp===ft.#l&&fe(S)},{signal:A}),t.toggleDrawing(),e._editorUndoBar?.hide(),ft.#n){t.drawLayer.updateProperties(this._currentDrawId,ft.#n.startNew(c,h,_,y,g));return}e.updateUIForDefaultProperties(this),ft.#n=this.createDrawerInstance(c,h,_,y,g),ft.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(ft.#a.toSVGProperties(),ft.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(ft.#l=-1,!ft.#n)return;const{offsetX:e,offsetY:n,pointerId:s}=t;if(ft.#s===s){if(ft.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,ft.#n.add(e,n)),ft.#l=t.timeStamp,fe(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,ft.#n=null,ft.#a=null,ft.#r=null,ft.#l=NaN),ft.#i&&(ft.#i.abort(),ft.#i=null,ft.#s=NaN,ft.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,ft.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const n=ft.#n,s=this._currentDrawId,o=n.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(s,n.setLastElement(o))},undo:()=>{e.drawLayer.updateProperties(s,n.removeLastElement())},mustExec:!1,type:Ot.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(Ot.DRAW_STEP),!ft.#n.isEmpty()){const{pageDimensions:[n,s],scale:o}=e,c=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:ft.#n.getOutlines(n*o,s*o,o,this._INNER_MARGIN),drawingOptions:ft.#a,mustBeCommitted:!t});return this._cleanup(!0),c}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,s,o,c){Vt("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:s,pageHeight:o,pageX:c,pageY:h}}=e.viewport,d=this.deserializeDraw(c,h,s,o,this._INNER_MARGIN,t),f=await super.deserialize(t,e,n);return f.createDrawingOptions(t),f.#c({drawOutlines:d}),f.#f(),f.onScaleChanging(),f.rotate(),f}serializeDraw(t){const[e,n]=this.pageTranslation,[s,o]=this.pageDimensions;return this.#t.serialize([e,n,s,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class F1{#t=new Float64Array(6);#e;#n;#i;#a;#s;#r="";#o=0;#l=new Yo;#c;#d;constructor(t,e,n,s,o,c){this.#c=n,this.#d=s,this.#i=o,this.#a=c,[t,e]=this.#u(t,e);const h=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e],this.#n=[{line:h,points:this.#s}],this.#t.set(h,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#u(t,e){return it._normalizePoint(t,e,this.#c,this.#d,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#s.length<=10}add(t,e){[t,e]=this.#u(t,e);const[n,s,o,c]=this.#t.subarray(2,6),h=t-o,d=e-c;return Math.hypot(this.#c*h,this.#d*d)<=2?null:(this.#s.push(t,e),isNaN(n)?(this.#t.set([o,c,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([n,s,o,c,t,e],0),this.#e.push(...it.createBezierPoints(n,s,o,c,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,s,o){this.#c=n,this.#d=s,this.#i=o,[t,e]=this.#u(t,e);const c=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e];const h=this.#n.at(-1);return h&&(h.line=new Float32Array(h.line),h.points=new Float32Array(h.points)),this.#n.push({line:c,points:this.#s}),this.#t.set(c,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(t){return this.#n?(this.#n.push(t),this.#e=t.line,this.#s=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(t)}removeLastElement(){if(!this.#n)return this.#l.removeLastElement();this.#n.pop(),this.#r="";for(let t=0,e=this.#n.length;t<e;t++){const{line:n,points:s}=this.#n[t];this.#e=n,this.#s=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const t=it.svgRound(this.#e[4]),e=it.svgRound(this.#e[5]);if(this.#s.length===2)return this.#r=`${this.#r} M ${t} ${e} Z`,this.#r;if(this.#s.length<=6){const s=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,s)} M ${t} ${e}`,this.#o=6}if(this.#s.length===4){const s=it.svgRound(this.#e[10]),o=it.svgRound(this.#e[11]);return this.#r=`${this.#r} L ${s} ${o}`,this.#o=12,this.#r}const n=[];this.#o===0&&(n.push(`M ${t} ${e}`),this.#o=6);for(let s=this.#o,o=this.#e.length;s<o;s+=6){const[c,h,d,f,g,_]=this.#e.slice(s,s+6).map(it.svgRound);n.push(`C${c} ${h} ${d} ${f} ${g} ${_}`)}return this.#r+=n.join(" "),this.#o=this.#e.length,this.#r}getOutlines(t,e,n,s){const o=this.#n.at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),this.#l.build(this.#n,t,e,n,this.#i,this.#a,s),this.#t=null,this.#e=null,this.#n=null,this.#r=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Yo extends it{#t;#e=0;#n;#i;#a;#s;#r;#o;#l;build(t,e,n,s,o,c,h){this.#a=e,this.#s=n,this.#r=s,this.#o=o,this.#l=c,this.#n=h??0,this.#i=t,this.#u()}get thickness(){return this.#l}setLastElement(t){return this.#i.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#i){if(t.push(`M${it.svgRound(e[4])} ${it.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${it.svgRound(e[10])} ${it.svgRound(e[11])}`);continue}for(let n=6,s=e.length;n<s;n+=6){const[o,c,h,d,f,g]=e.subarray(n,n+6).map(it.svgRound);t.push(`C${o} ${c} ${h} ${d} ${f} ${g}`)}}return t.join("")}serialize([t,e,n,s],o){const c=[],h=[],[d,f,g,_]=this.#d();let y,b,A,S,C,w,N,x,M;switch(this.#o){case 0:M=it._rescale,y=t,b=e+s,A=n,S=-s,C=t+d*n,w=e+(1-f-_)*s,N=t+(d+g)*n,x=e+(1-f)*s;break;case 90:M=it._rescaleAndSwap,y=t,b=e,A=n,S=s,C=t+f*n,w=e+d*s,N=t+(f+_)*n,x=e+(d+g)*s;break;case 180:M=it._rescale,y=t+n,b=e,A=-n,S=s,C=t+(1-d-g)*n,w=e+f*s,N=t+(1-d)*n,x=e+(f+_)*s;break;case 270:M=it._rescaleAndSwap,y=t+n,b=e+s,A=-n,S=-s,C=t+(1-f-_)*n,w=e+(1-d-g)*s,N=t+(1-f)*n,x=e+(1-d)*s;break}for(const{line:D,points:O}of this.#i)c.push(M(D,y,b,A,S,o?new Array(D.length):null)),h.push(M(O,y,b,A,S,o?new Array(O.length):null));return{lines:c,points:h,rect:[C,w,N,x]}}static deserialize(t,e,n,s,o,{paths:{lines:c,points:h},rotation:d,thickness:f}){const g=[];let _,y,b,A,S;switch(d){case 0:S=it._rescale,_=-t/n,y=e/s+1,b=1/n,A=-1/s;break;case 90:S=it._rescaleAndSwap,_=-e/s,y=-t/n,b=1/s,A=1/n;break;case 180:S=it._rescale,_=t/n+1,y=-e/s,b=-1/n,A=1/s;break;case 270:S=it._rescaleAndSwap,_=e/s+1,y=t/n+1,b=-1/s,A=-1/n;break}if(!c){c=[];for(const w of h){const N=w.length;if(N===2){c.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(N===4){c.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const x=new Float32Array(3*(N-2));c.push(x);let[M,D,O,B]=w.subarray(0,4);x.set([NaN,NaN,NaN,NaN,M,D],0);for(let j=4;j<N;j+=2){const $=w[j],nt=w[j+1];x.set(it.createBezierPoints(M,D,O,B,$,nt),(j-2)*3),[M,D,O,B]=[O,B,$,nt]}}}for(let w=0,N=c.length;w<N;w++)g.push({line:S(c[w].map(x=>x??NaN),_,y,b,A),points:S(h[w].map(x=>x??NaN),_,y,b,A)});const C=new this.prototype.constructor;return C.build(g,n,s,1,d,f,o),C}#c(t=this.#l){const e=this.#n+t/2*this.#r;return this.#o%180===0?[e/this.#a,e/this.#s]:[e/this.#s,e/this.#a]}#d(){const[t,e,n,s]=this.#t,[o,c]=this.#c(0);return[t+o,e+c,n-2*o,s-2*c]}#u(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#i){if(s.length<=12){for(let h=4,d=s.length;h<d;h+=6)at.pointBoundingBox(s[h],s[h+1],t);continue}let o=s[4],c=s[5];for(let h=6,d=s.length;h<d;h+=6){const[f,g,_,y,b,A]=s.subarray(h,h+6);at.bezierBoundingBox(o,c,f,g,_,y,b,A,t),o=b,c=A}}const[e,n]=this.#c();t[0]=Ue(t[0]-e,0,1),t[1]=Ue(t[1]-n,0,1),t[2]=Ue(t[2]+e,0,1),t[3]=Ue(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,n]=this.#c();this.#l=t;const[s,o]=this.#c(),[c,h]=[s-e,o-n],d=this.#t;return d[0]-=c,d[1]-=h,d[2]+=2*c,d[3]+=2*h,d}updateParentDimensions([t,e],n){const[s,o]=this.#c();this.#a=t,this.#s=e,this.#r=n;const[c,h]=this.#c(),d=c-s,f=h-o,g=this.#t;return g[0]-=d,g[1]-=f,g[2]+=2*d,g[3]+=2*f,g}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(it.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${it.svgRound(t)} ${it.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let n=0,s=0,o=0,c=0,h=0,d=0;switch(this.#e){case 90:s=e/t,o=-t/e,h=t;break;case 180:n=-1,c=-1,h=t,d=e;break;case 270:s=-e/t,o=t/e,d=e;break;default:return""}return`matrix(${n} ${s} ${o} ${c} ${it.svgRound(h)} ${it.svgRound(d)})`}getPathResizingSVGProperties([t,e,n,s]){const[o,c]=this.#c(),[h,d,f,g]=this.#t;if(Math.abs(f-o)<=it.PRECISION||Math.abs(g-c)<=it.PRECISION){const S=t+n/2-(h+f/2),C=e+s/2-(d+g/2);return{path:{"transform-origin":`${it.svgRound(t)} ${it.svgRound(e)}`,transform:`${this.rotationTransform} translate(${S} ${C})`}}}const _=(n-2*o)/(f-2*o),y=(s-2*c)/(g-2*c),b=f/n,A=g/s;return{path:{"transform-origin":`${it.svgRound(h)} ${it.svgRound(d)}`,transform:`${this.rotationTransform} scale(${b} ${A}) translate(${it.svgRound(o)} ${it.svgRound(c)}) scale(${_} ${y}) translate(${it.svgRound(-o)} ${it.svgRound(-c)})`}}}getPathResizedSVGProperties([t,e,n,s]){const[o,c]=this.#c(),h=this.#t,[d,f,g,_]=h;if(h[0]=t,h[1]=e,h[2]=n,h[3]=s,Math.abs(g-o)<=it.PRECISION||Math.abs(_-c)<=it.PRECISION){const C=t+n/2-(d+g/2),w=e+s/2-(f+_/2);for(const{line:N,points:x}of this.#i)it._translate(N,C,w,N),it._translate(x,C,w,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${it.svgRound(t)} ${it.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const y=(n-2*o)/(g-2*o),b=(s-2*c)/(_-2*c),A=-y*(d+o)+t+o,S=-b*(f+c)+e+c;if(y!==1||b!==1||A!==0||S!==0)for(const{line:C,points:w}of this.#i)it._rescale(C,A,S,y,b,C),it._rescale(w,A,S,y,b,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${it.svgRound(t)} ${it.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],n){const[s,o]=n,c=this.#t,h=t-c[0],d=e-c[1];if(this.#a===s&&this.#s===o)for(const{line:f,points:g}of this.#i)it._translate(f,h,d,f),it._translate(g,h,d,g);else{const f=this.#a/s,g=this.#s/o;this.#a=s,this.#s=o;for(const{line:_,points:y}of this.#i)it._rescale(_,h,d,f,g,_),it._rescale(y,h,d,f,g,y);c[2]*=f,c[3]*=g}return c[0]=t,c[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${it.svgRound(t)} ${it.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${it.svgRound(t[0])} ${it.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class iu extends Uv{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:ut._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new iu(this._viewParameters);return t.updateAll(this),t}}class Zf extends ft{static _type="ink";static _editorType=_t.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){ut.initialize(t,e),this._defaultDrawingOptions=new iu(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return Tt(this,"typesMap",new Map([[Ot.INK_THICKNESS,"stroke-width"],[Ot.INK_COLOR,"stroke"],[Ot.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,s,o){return new F1(t,e,n,s,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,s,o,c){return Yo.deserialize(t,e,n,s,o,c)}static async deserialize(t,e,n){let s=null;if(t instanceof Kf){const{data:{inkLists:c,rect:h,rotation:d,id:f,color:g,opacity:_,borderStyle:{rawWidth:y},popupRef:b,contentsObj:A},parent:{page:{pageNumber:S}}}=t;s=t={annotationType:_t.INK,color:Array.from(g),thickness:y,opacity:_,paths:{points:c},boxes:null,pageIndex:S-1,rect:h.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:b,comment:A?.str||null}}const o=await super.deserialize(t,e,n);return o._initialData=s,t.comment&&o.setCommentData(t.comment),o}get toolbarButtons(){return this._colorPicker||=new Do(this),[["colorPicker",this._colorPicker]]}get colorType(){return Ot.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:n}){this._drawingOptions=Zf.getDefaultDrawingOptions({stroke:at.makeHexColor(...t),"stroke-width":e,"stroke-opacity":n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n,rect:s}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":c,"stroke-width":h}}=this,d={annotationType:_t.INK,color:ut._colorManager.convert(o),opacity:c,thickness:h,paths:{lines:e,points:n},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(d),t?(d.isCopy=!0,d):this.annotationElementId&&!this.#t(d)?null:(d.id=this.annotationElementId,d)}#t(t){const{color:e,thickness:n,opacity:s,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((c,h)=>c!==e[h])||t.thickness!==n||t.opacity!==s||t.pageIndex!==o}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:n}=this.serializeDraw(!1),s={rect:n,thickness:this._drawingOptions["stroke-width"],points:e};return this.hasEditedComment&&(s.popup=this.comment),t.updateEdited(s),null}}class df extends Yo{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const vc=8,uo=3;class Ia{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,n,s){return n-=t,s-=e,n===0?s>0?0:4:n===1?s+6:2-s}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(t,e,n,s,o,c,h){const d=this.#e(n,s,o,c);for(let f=0;f<8;f++){const g=(-f+d-h+16)%8,_=this.#n[2*g],y=this.#n[2*g+1];if(t[(n+_)*e+(s+y)]!==0)return g}return-1}static#a(t,e,n,s,o,c,h){const d=this.#e(n,s,o,c);for(let f=0;f<8;f++){const g=(f+d+h+16)%8,_=this.#n[2*g],y=this.#n[2*g+1];if(t[(n+_)*e+(s+y)]!==0)return g}return-1}static#s(t,e,n,s){const o=t.length,c=new Int32Array(o);for(let g=0;g<o;g++)c[g]=t[g]<=s?1:0;for(let g=1;g<n-1;g++)c[g*e]=c[g*e+e-1]=0;for(let g=0;g<e;g++)c[g]=c[e*n-1-g]=0;let h=1,d;const f=[];for(let g=1;g<n-1;g++){d=1;for(let _=1;_<e-1;_++){const y=g*e+_,b=c[y];if(b===0)continue;let A=g,S=_;if(b===1&&c[y-1]===0)h+=1,S-=1;else if(b>=1&&c[y+1]===0)h+=1,S+=1,b>1&&(d=b);else{b!==1&&(d=Math.abs(b));continue}const C=[_,g],w=S===_+1,N={isHole:w,points:C,id:h,parent:0};f.push(N);let x;for(const tt of f)if(tt.id===d){x=tt;break}x?x.isHole?N.parent=w?x.parent:d:N.parent=w?d:x.parent:N.parent=w?d:0;const M=this.#i(c,e,g,_,A,S,0);if(M===-1){c[y]=-h,c[y]!==1&&(d=Math.abs(c[y]));continue}let D=this.#n[2*M],O=this.#n[2*M+1];const B=g+D,j=_+O;A=B,S=j;let $=g,nt=_;for(;;){const tt=this.#a(c,e,$,nt,A,S,1);D=this.#n[2*tt],O=this.#n[2*tt+1];const lt=$+D,et=nt+O;C.push(et,lt);const yt=$*e+nt;if(c[yt+1]===0?c[yt]=-h:c[yt]===1&&(c[yt]=h),lt===g&&et===_&&$===B&&nt===j){c[y]!==1&&(d=Math.abs(c[y]));break}else A=$,S=nt,$=lt,nt=et}}}return f}static#r(t,e,n,s){if(n-e<=4){for(let B=e;B<n-2;B+=2)s.push(t[B],t[B+1]);return}const o=t[e],c=t[e+1],h=t[n-4]-o,d=t[n-3]-c,f=Math.hypot(h,d),g=h/f,_=d/f,y=g*c-_*o,b=d/h,A=1/f,S=Math.atan(b),C=Math.cos(S),w=Math.sin(S),N=A*(Math.abs(C)+Math.abs(w)),x=A*(1-N+N**2),M=Math.max(Math.atan(Math.abs(w+C)*x),Math.atan(Math.abs(w-C)*x));let D=0,O=e;for(let B=e+2;B<n-2;B+=2){const j=Math.abs(y-g*t[B+1]+_*t[B]);j>D&&(O=B,D=j)}D>(f*M)**2?(this.#r(t,e,O+2,s),this.#r(t,O,n,s)):s.push(o,c)}static#o(t){const e=[],n=t.length;return this.#r(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#l(t,e,n,s,o,c){const h=new Float32Array(c**2),d=-2*s**2,f=c>>1;for(let S=0;S<c;S++){const C=(S-f)**2;for(let w=0;w<c;w++)h[S*c+w]=Math.exp((C+(w-f)**2)/d)}const g=new Float32Array(256),_=-2*o**2;for(let S=0;S<256;S++)g[S]=Math.exp(S**2/_);const y=t.length,b=new Uint8Array(y),A=new Uint32Array(256);for(let S=0;S<n;S++)for(let C=0;C<e;C++){const w=S*e+C,N=t[w];let x=0,M=0;for(let O=0;O<c;O++){const B=S+O-f;if(!(B<0||B>=n))for(let j=0;j<c;j++){const $=C+j-f;if($<0||$>=e)continue;const nt=t[B*e+$],tt=h[O*c+j]*g[Math.abs(nt-N)];x+=nt*tt,M+=tt}}const D=b[w]=Math.round(x/M);A[D]++}return[b,A]}static#c(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#d(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let s=-1/0,o=1/0;for(let h=0,d=n.length;h<d;h++){const f=n[h]=t[h<<2];s=Math.max(s,f),o=Math.min(o,f)}const c=255/(s-o);for(let h=0,d=n.length;h<d;h++)n[h]=(n[h]-o)*c;return n}static#u(t){let e,n=-1/0,s=-1/0;const o=t.findIndex(d=>d!==0);let c=o,h=o;for(e=o;e<256;e++){const d=t[e];d>n&&(e-c>s&&(s=e-c,h=e-1),n=d,c=e)}for(e=h-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:n,height:s}=t,{maxDim:o}=this.#t;let c=n,h=s;if(n>o||s>o){let y=n,b=s,A=Math.log2(Math.max(n,s)/o);const S=Math.floor(A);A=A===S?S-1:S;for(let w=0;w<A;w++){c=Math.ceil(y/2),h=Math.ceil(b/2);const N=new OffscreenCanvas(c,h);N.getContext("2d").drawImage(t,0,0,y,b,0,0,c,h),y=c,b=h,t!==e&&t.close(),t=N.transferToImageBitmap()}const C=Math.min(o/c,o/h);c=Math.round(c*C),h=Math.round(h*C)}const f=new OffscreenCanvas(c,h).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,c,h),f.filter="grayscale(1)",f.drawImage(t,0,0,t.width,t.height,0,0,c,h);const g=f.getImageData(0,0,c,h).data;return[this.#d(g),c,h]}static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:s},o,c,h,d){let f=new OffscreenCanvas(1,1),g=f.getContext("2d",{alpha:!1});const _=200,y=g.font=`${n} ${s} ${_}px ${e}`,{actualBoundingBoxLeft:b,actualBoundingBoxRight:A,actualBoundingBoxAscent:S,actualBoundingBoxDescent:C,fontBoundingBoxAscent:w,fontBoundingBoxDescent:N,width:x}=g.measureText(t),M=1.5,D=Math.ceil(Math.max(Math.abs(b)+Math.abs(A)||0,x)*M),O=Math.ceil(Math.max(Math.abs(S)+Math.abs(C)||_,Math.abs(w)+Math.abs(N)||_)*M);f=new OffscreenCanvas(D,O),g=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),g.font=y,g.filter="grayscale(1)",g.fillStyle="white",g.fillRect(0,0,D,O),g.fillStyle="black",g.fillText(t,D*(M-1)/2,O*(3-M)/2);const B=this.#d(g.getImageData(0,0,D,O).data),j=this.#c(B),$=this.#u(j),nt=this.#s(B,D,O,$);return this.processDrawnLines({lines:{curves:nt,width:D,height:O},pageWidth:o,pageHeight:c,rotation:h,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(t,e,n,s,o){const[c,h,d]=this.#f(t),[f,g]=this.#l(c,h,d,Math.hypot(h,d)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),_=this.#u(g),y=this.#s(f,h,d,_);return this.processDrawnLines({lines:{curves:y,width:h,height:d},pageWidth:e,pageHeight:n,rotation:s,innerMargin:o,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:s,innerMargin:o,mustSmooth:c,areContours:h}){s%180!==0&&([e,n]=[n,e]);const{curves:d,width:f,height:g}=t,_=t.thickness??0,y=[],b=Math.min(e/f,n/g),A=b/e,S=b/n,C=[];for(const{points:N}of d){const x=c?this.#o(N):N;if(!x)continue;C.push(x);const M=x.length,D=new Float32Array(M),O=new Float32Array(3*(M===2?2:M-2));if(y.push({line:O,points:D}),M===2){D[0]=x[0]*A,D[1]=x[1]*S,O.set([NaN,NaN,NaN,NaN,D[0],D[1]],0);continue}let[B,j,$,nt]=x;B*=A,j*=S,$*=A,nt*=S,D.set([B,j,$,nt],0),O.set([NaN,NaN,NaN,NaN,B,j],0);for(let tt=4;tt<M;tt+=2){const lt=D[tt]=x[tt]*A,et=D[tt+1]=x[tt+1]*S;O.set(it.createBezierPoints(B,j,$,nt,lt,et),(tt-2)*3),[B,j,$,nt]=[$,nt,lt,et]}}if(y.length===0)return null;const w=h?new df:new Yo;return w.build(y,e,n,1,s,h?0:_,o),{outline:w,newCurves:C,areContours:h,thickness:_,width:f,height:g}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:s,height:o}){let c=1/0,h=-1/0,d=0;for(const x of t){d+=x.length;for(let M=2,D=x.length;M<D;M++){const O=x[M]-x[M-2];c=Math.min(c,O),h=Math.max(h,O)}}let f;c>=-128&&h<=127?f=Int8Array:c>=-32768&&h<=32767?f=Int16Array:f=Int32Array;const g=t.length,_=vc+uo*g,y=new Uint32Array(_);let b=0;y[b++]=_*Uint32Array.BYTES_PER_ELEMENT+(d-2*g)*f.BYTES_PER_ELEMENT,y[b++]=0,y[b++]=s,y[b++]=o,y[b++]=e?0:1,y[b++]=Math.max(0,Math.floor(n??0)),y[b++]=g,y[b++]=f.BYTES_PER_ELEMENT;for(const x of t)y[b++]=x.length-2,y[b++]=x[0],y[b++]=x[1];const A=new CompressionStream("deflate-raw"),S=A.writable.getWriter();await S.ready,S.write(y);const C=f.prototype.constructor;for(const x of t){const M=new C(x.length-2);for(let D=2,O=x.length;D<O;D++)M[D-2]=x[D]-x[D-2];S.write(M)}S.close();const w=await new Response(A.readable).arrayBuffer(),N=new Uint8Array(w);return pv(N)}static async decompressSignature(t){try{const e=rw(t),{readable:n,writable:s}=new DecompressionStream("deflate-raw"),o=s.getWriter();await o.ready,o.write(e).then(async()=>{await o.ready,await o.close()}).catch(()=>{});let c=null,h=0;for await(const x of n)c||=new Uint8Array(new Uint32Array(x.buffer,0,4)[0]),c.set(x,h),h+=x.length;const d=new Uint32Array(c.buffer,0,c.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const g=d[2],_=d[3],y=d[4]===0,b=d[5],A=d[6],S=d[7],C=[],w=(vc+uo*A)*Uint32Array.BYTES_PER_ELEMENT;let N;switch(S){case Int8Array.BYTES_PER_ELEMENT:N=new Int8Array(c.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:N=new Int16Array(c.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:N=new Int32Array(c.buffer,w);break}h=0;for(let x=0;x<A;x++){const M=d[uo*x+vc],D=new Float32Array(M+2);C.push(D);for(let O=0;O<uo-1;O++)D[O]=d[uo*x+vc+O+1];for(let O=0;O<M;O++)D[O+2]=D[O]+N[h++]}return{areContours:y,thickness:b,outlines:C,width:g,height:_}}catch(e){return vt(`decompressSignature: ${e}`),null}}}class Jf extends Uv{constructor(){super(),super.updateProperties({fill:ut._defaultLineColor,"stroke-width":0})}clone(){const t=new Jf;return t.updateAll(this),t}}class tp extends iu{constructor(t){super(t),super.updateProperties({stroke:ut._defaultLineColor,"stroke-width":1})}clone(){const t=new tp(this._viewParameters);return t.updateAll(this),t}}class Yn extends ft{#t=!1;#e=null;#n=null;#i=null;static _type="signature";static _editorType=_t.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){ut.initialize(t,e),this._defaultDrawingOptions=new Jf,this._defaultDrawnSignatureOptions=new tp(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return Tt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:s,mustSmooth:o,areContours:c,description:h,uuid:d,heightInPage:f}=this.#n,{rawDims:{pageWidth:g,pageHeight:_},rotation:y}=this.parent.viewport,b=Ia.processDrawnLines({lines:s,pageWidth:g,pageHeight:_,rotation:y,innerMargin:Yn._INNER_MARGIN,mustSmooth:o,areContours:c});this.addSignature(b,f,h,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#i=t,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:s,height:o}=this.#n,c=Math.max(s,o),h=Ia.processDrawnLines({lines:{curves:t.map(d=>({points:d})),thickness:n,width:s,height:o},pageWidth:c,pageHeight:c,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:h.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,s){const{x:o,y:c}=this,{outline:h}=this.#n=t;this.#t=h instanceof df,this.description=n;let d;this.#t?d=Yn.getDefaultDrawingOptions():(d=Yn._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":h.thickness})),this._addOutlines({drawOutlines:h,drawingOptions:d});const[f,g]=this.parentDimensions,[,_]=this.pageDimensions;let y=e/_;y=y>=1?.5:y,this.width*=y/this.height,this.width>=1&&(y*=.9/this.width,this.width=.9),this.height=y,this.setDims(f*this.width,g*this.height),this.x=o,this.y=c,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:s}=this.parent.viewport;return Ia.process(t,e,n,s,Yn._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:s},rotation:o}=this.parent.viewport;return Ia.extractContoursFromText(t,e,n,s,o,Yn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:s}=this.parent.viewport;return Ia.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:s,innerMargin:Yn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Yn.getDefaultDrawingOptions():(this._drawingOptions=Yn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:n,rect:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":o}}=this,c={annotationType:_t.SIGNATURE,isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:o,pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(c),t?(c.paths={lines:e,points:n},c.uuid=this.#i,c.isCopy=!0):c.lines=e,this.#e&&(c.accessibilityData={type:"Figure",alt:this.#e}),c}static deserializeDraw(t,e,n,s,o,c){return c.areContours?df.deserialize(t,e,n,s,o,c):Yo.deserialize(t,e,n,s,o,c)}static async deserialize(t,e,n){const s=await super.deserialize(t,e,n);return s.#t=t.areContours,s.description=t.accessibilityData?.alt||"",s.#i=t.uuid,s}}class H1 extends ut{#t=null;#e=null;#n=null;#i=null;#a=null;#s="";#r=null;#o=!1;#l=null;#c=!1;#d=!1;static _type="stamp";static _editorType=_t.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#i=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){ut.initialize(t,e)}static isHandlingMimeForPasting(t){return af.includes(t)}static paste(t,e){e.pasteEditor({mode:_t.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#u(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#c=t.isSvg),t.file&&(this.#s=t.file.name),this.#p()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:o,height:c}=t||this.copyCanvas(null,null,!0).imageData,h=await n.guess({name:"altText",request:{data:s,width:o,height:c,channels:s.length/(o*c)}});if(!h)throw new Error("No response from the AI service.");if(h.error)throw new Error("Error from the AI service.");if(h.cancel)return null;if(!h.output)throw new Error("No valid response from the AI service.");const d=h.output;return await this.setGuessedAltText(d),e&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(n=>this.#u(n,!0)).finally(()=>this.#f());return}if(this.#i){const n=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(n).then(s=>this.#u(s)).finally(()=>this.#f());return}if(this.#a){const n=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(n).then(s=>this.#u(s)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=af.join(",");const e=this._uiManager._signal;this.#n=new Promise(n=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(s)}n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#r?.remove(),this.#r=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#r===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#n||this.#t||this.#i||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#p():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:s}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#e=n,s&&(this.#t=s),this.#o=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const t=200;this.#l=setTimeout(()=>{this.#l=null,this.#m()},t)}#p(){const{div:t}=this;let{width:e,height:n}=this.#t;const[s,o]=this.pageDimensions,c=.75;if(this.width)e=this.width*s,n=this.height*o;else if(e>c*s||n>c*o){const g=Math.min(c*s/e,c*o/n);e*=g,n*=g}const[h,d]=this.parentDimensions;this.setDims(e*h/s,n*d/o),this._uiManager.enableWaiting(!1);const f=this.#r=document.createElement("canvas");f.setAttribute("role","img"),this.addContainer(f),this.width=e/s,this.height=n/o,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,n=!1){t||(t=224);const{width:s,height:o}=this.#t,c=new Wn;let h=this.#t,d=s,f=o,g=null;if(e){if(s>e||o>e){const O=Math.min(e/s,e/o);d=Math.floor(s*O),f=Math.floor(o*O)}g=document.createElement("canvas");const y=g.width=Math.ceil(d*c.sx),b=g.height=Math.ceil(f*c.sy);this.#c||(h=this.#h(y,b));const A=g.getContext("2d");A.filter=this._uiManager.hcmFilter;let S="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(S="#8f8f9d",C="#42414d");const w=15,N=w*c.sx,x=w*c.sy,M=new OffscreenCanvas(N*2,x*2),D=M.getContext("2d");D.fillStyle=S,D.fillRect(0,0,N*2,x*2),D.fillStyle=C,D.fillRect(0,0,N,x),D.fillRect(N,x,N,x),A.fillStyle=A.createPattern(M,"repeat"),A.fillRect(0,0,y,b),A.drawImage(h,0,0,h.width,h.height,0,0,y,b)}let _=null;if(n){let y,b;if(c.symmetric&&h.width<t&&h.height<t)y=h.width,b=h.height;else if(h=this.#t,s>t||o>t){const C=Math.min(t/s,t/o);y=Math.floor(s*C),b=Math.floor(o*C),this.#c||(h=this.#h(y,b))}const S=new OffscreenCanvas(y,b).getContext("2d",{willReadFrequently:!0});S.drawImage(h,0,0,h.width,h.height,0,0,y,b),_={width:y,height:b,data:S.getImageData(0,0,y,b).data}}return{canvas:g,width:d,height:f,imageData:_}}#h(t,e){const{width:n,height:s}=this.#t;let o=n,c=s,h=this.#t;for(;o>2*t||c>2*e;){const d=o,f=c;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),c>2*e&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2));const g=new OffscreenCanvas(o,c);g.getContext("2d").drawImage(h,0,0,d,f,0,0,o,c),h=g.transferToImageBitmap()}return h}#m(){const[t,e]=this.parentDimensions,{width:n,height:s}=this,o=new Wn,c=Math.ceil(n*t*o.sx),h=Math.ceil(s*e*o.sy),d=this.#r;if(!d||d.width===c&&d.height===h)return;d.width=c,d.height=h;const f=this.#c?this.#t:this.#h(c,h),g=d.getContext("2d");g.filter=this._uiManager.hcmFilter,g.drawImage(f,0,0,f.width,f.height,0,0,c,h)}#b(t){if(t){if(this.#c){const s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#c){const[e,n]=this.pageDimensions,s=Math.round(this.width*e*Wa.PDF_TO_CSS_UNITS),o=Math.round(this.height*n*Wa.PDF_TO_CSS_UNITS),c=new OffscreenCanvas(s,o);return c.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,o),c.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,n){let s=null,o=!1;if(t instanceof Hv){const{data:{rect:S,rotation:C,id:w,structParent:N,popupRef:x,contentsObj:M},container:D,parent:{page:{pageNumber:O}},canvas:B}=t;let j,$;B?(delete t.canvas,{id:j,bitmap:$}=n.imageManager.getFromCanvas(D.id,B),B.remove()):(o=!0,t._hasNoCanvas=!0);const nt=(await e._structTree.getAriaAttributes(`${Hf}${w}`))?.get("aria-label")||"";s=t={annotationType:_t.STAMP,bitmapId:j,bitmap:$,pageIndex:O-1,rect:S.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:nt},isSvg:!1,structParent:N,popupRef:x,comment:M?.str||null}}const c=await super.deserialize(t,e,n),{rect:h,bitmap:d,bitmapUrl:f,bitmapId:g,isSvg:_,accessibilityData:y}=t;o?(n.addMissingCanvas(t.id,c),c.#o=!0):g&&n.imageManager.isValidId(g)?(c.#e=g,d&&(c.#t=d)):c.#i=f,c.#c=_;const[b,A]=c.pageDimensions;return c.width=(h[2]-h[0])/b,c.height=(h[3]-h[1])/A,y&&(c.altTextData=y),c._initialData=s,t.comment&&c.setCommentData(t.comment),c.#d=!!s,c}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:_t.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(this.addComment(n),t)return n.bitmapUrl=this.#b(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:s,altText:o}=this.serializeAltText(!1);if(!s&&o&&(n.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const h=this.#_(n);if(h.isSame)return null;h.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,e===null)return n;e.stamps||=new Map;const c=this.#c?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:c,serialized:n}),n.bitmap=this.#b(!1);else if(this.#c){const h=e.stamps.get(this.#e);c>h.area&&(h.area=c,h.serialized.bitmap.close(),h.serialized.bitmap=this.#b(!1))}return n}#_(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,s=t.pageIndex===e,o=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&o,isSameAltText:o}}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}}class fi{#t;#e=!1;#n=null;#i=null;#a=null;#s=new Map;#r=!1;#o=!1;#l=!1;#c=null;#d=null;#u=null;#f=null;#g=null;#p=-1;#h;static _initialized=!1;static#m=new Map([Se,Zf,H1,re,Yn].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:s,accessibilityManager:o,annotationLayer:c,drawLayer:h,textLayer:d,viewport:f,l10n:g}){const _=[...fi.#m.values()];if(!fi._initialized){fi._initialized=!0;for(const y of _)y.initialize(g,t)}t.registerEditorTypes(_),this.#h=t,this.pageIndex=e,this.div=n,this.#t=o,this.#n=c,this.viewport=f,this.#u=d,this.drawLayer=h,this._structTree=s,this.#h.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===_t.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#y(),t){case _t.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case _t.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case _t.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const n of fi.#m.values())e.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#u?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.div.classList.toggle("disabled",!t)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#g?.abort(),this.#g=null;const t=new Set;for(const n of this.#s.values())n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#h.removeChangedExistingAnnotation(n),t.add(n.annotationElementId));if(!this.#n){this.#l=!1;return}const e=this.#n.getEditableAnnotations();for(const n of e){if(n.hide(),this.#h.isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;const s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}this.#l=!1}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#u&&!this.#g){this.#g=new AbortController;const s=this.#h.combinedSignal(this.#g);this.#u.div.addEventListener("pointerdown",o=>{const{clientX:h,clientY:d,timeStamp:f}=o,g=this.#p;if(f-g>500){this.#p=f;return}this.#p=-1;const{classList:_}=this.div;_.toggle("getElements",!0);const y=document.elementsFromPoint(h,d);if(_.toggle("getElements",!1),!this.div.contains(y[0]))return;let b;const A=new RegExp(`^${cv}[0-9]+$`);for(const C of y)if(A.test(C.id)){b=C.id;break}if(!b)return;const S=this.#s.get(b);S?.annotationElementId===null&&(o.stopPropagation(),o.preventDefault(),S.dblclick())},{signal:s,capture:!0})}const t=new Map,e=new Map;for(const s of this.#s.values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){t.set(s.annotationElementId,s);continue}else e.set(s.annotationElementId,s);this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(this.#n){const s=this.#n.getEditableAnnotations();for(const o of s){const{id:c}=o.data;if(this.#h.isDeletedAnnotationElement(c)){o.updateEdited({deleted:!0});continue}let h=e.get(c);if(h){h.resetAnnotationElement(o),h.show(!1),o.show();continue}h=t.get(c),h&&(this.#h.addChangedExistingAnnotation(h),h.renderAnnotationElement(o)&&h.show(!1)),o.show()}}this.#y(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const s of fi.#m.values())n.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#f){this.#f=new AbortController;const t=this.#h.combinedSignal(this.#f);this.#u.div.addEventListener("pointerdown",this.#b.bind(this),{signal:t}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#u.div.classList.remove("highlighting"))}#b(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#u.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#u.div.contains(e)){const{isMac:n}=ke.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#h.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),re.startHighlighting(this,this.#h.direction==="ltr",{target:this.#u.div,x:t.x,y:t.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const t=this.#h.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#s.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#s.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t.annotationElementId),ut.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#l),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getNextId(){return this.#h.getId()}get#_(){return fi.#m.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#A(t){const e=this.#_;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#_?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:n,offsetY:s}=this.#S(),o=this.getNextId(),c=this.#A({parent:this,id:o,x:n,y:s,uiManager:this.#h,isCentered:!0,...e});c&&this.add(c)}async deserialize(t){return await fi.#m.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,n={}){const s=this.getNextId(),o=this.#A({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...n});return o&&this.add(o),o}#S(){const{x:t,y:e,width:n,height:s}=this.div.getBoundingClientRect(),o=Math.max(0,t),c=Math.max(0,e),h=Math.min(window.innerWidth,t+n),d=Math.min(window.innerHeight,e+s),f=(o+h)/2-t,g=(c+d)/2-e,[_,y]=this.viewport.rotation%180===0?[f,g]:[g,f];return{offsetX:_,offsetY:y}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=ke.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#r||(this.#r=!1,this.#_?.isDrawer&&this.#_.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const n=this.#h.getMode();if(n===_t.STAMP||n===_t.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===_t.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:e}=ke.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#r=!0,this.#_?.isDrawer){this.startDrawingSession(t);return}const n=this.#h.getActive();this.#e=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#c){this.#_.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#c=new AbortController;const e=this.#h.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#_.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#c?(this.#h.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#_.endDrawing(t)):null}findNewParent(t,e,n){const s=this.#h.findParent(e,n);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#_.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#s.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#s.clear(),this.#h.removeLayer(this)}#y(){for(const t of this.#s.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Os(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#y();const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Os(this.div,{rotation:n}),e!==n)for(const s of this.#s.values())s.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class Me{#t=null;#e=new Map;#n=new Map;static#i=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return Tt(this,"_svgFactory",new Dc)}static#a(t,[e,n,s,o]){const{style:c}=t;c.top=`${100*n}%`,c.left=`${100*e}%`,c.width=`${100*s}%`,c.height=`${100*o}%`}#s(){const t=Me._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#r(t,e){const n=Me._svgFactory.createElement("clipPath");t.append(n);const s=`clip_${e}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const o=Me._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${e}`),o.classList.add("clip"),s}#o(t,e){for(const[n,s]of Object.entries(e))s===null?t.removeAttribute(n):t.setAttribute(n,s)}draw(t,e=!1,n=!1){const s=Me.#i++,o=this.#s(),c=Me._svgFactory.createElement("defs");o.append(c);const h=Me._svgFactory.createElement("path");c.append(h);const d=`path_p${this.pageIndex}_${s}`;h.setAttribute("id",d),h.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(s,h);const f=n?this.#r(c,d):null,g=Me._svgFactory.createElement("use");return o.append(g),g.setAttribute("href",`#${d}`),this.updateProperties(o,t),this.#e.set(s,o),{id:s,clipPathId:`url(#${f})`}}drawOutline(t,e){const n=Me.#i++,s=this.#s(),o=Me._svgFactory.createElement("defs");s.append(o);const c=Me._svgFactory.createElement("path");o.append(c);const h=`path_p${this.pageIndex}_${n}`;c.setAttribute("id",h),c.setAttribute("vector-effect","non-scaling-stroke");let d;if(e){const _=Me._svgFactory.createElement("mask");o.append(_),d=`mask_p${this.pageIndex}_${n}`,_.setAttribute("id",d),_.setAttribute("maskUnits","objectBoundingBox");const y=Me._svgFactory.createElement("rect");_.append(y),y.setAttribute("width","1"),y.setAttribute("height","1"),y.setAttribute("fill","white");const b=Me._svgFactory.createElement("use");_.append(b),b.setAttribute("href",`#${h}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const f=Me._svgFactory.createElement("use");s.append(f),f.setAttribute("href",`#${h}`),d&&f.setAttribute("mask",`url(#${d})`);const g=f.cloneNode();return s.append(g),f.classList.add("mainOutline"),g.classList.add("secondaryOutline"),this.updateProperties(s,t),this.#e.set(n,s),n}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:s,rootClass:o,path:c}=e,h=typeof t=="number"?this.#e.get(t):t;if(h){if(n&&this.#o(h,n),s&&Me.#a(h,s),o){const{classList:d}=h;for(const[f,g]of Object.entries(o))d.toggle(f,g)}if(c){const f=h.firstChild.firstChild;this.#o(f,c)}}}updateParent(t,e){if(e===this)return;const n=this.#e.get(t);n&&(e.#t.append(n),this.#e.delete(t),e.#e.set(t,n))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:uf};globalThis.pdfjsLib={AbortException:Zi,AnnotationEditorLayer:fi,AnnotationEditorParamsType:Ot,AnnotationEditorType:_t,AnnotationEditorUIManager:Ji,AnnotationLayer:Qf,AnnotationMode:Xi,AnnotationType:de,build:m1,ColorPicker:En,createValidAbsoluteUrl:uv,DOMSVGFactory:Dc,DrawLayer:Me,FeatureTest:ke,fetchData:jo,getDocument:Mv,getFilenameFromUrl:ow,getPdfFilenameFromUrl:lw,getRGB:tu,getUuid:fv,getXfaPageViewport:uw,GlobalWorkerOptions:ja,ImageKind:Ec,InvalidPDFException:nf,isDataScheme:Jc,isPdfFile:Uf,isValidExplicitDest:Aw,MathClamp:Ue,noContextMenu:xn,normalizeUnicode:sw,OPS:To,OutputScale:Wn,PasswordResponses:WE,PDFDataRangeTransport:Nv,PDFDateString:sf,PDFWorker:Ro,PermissionFlag:$E,PixelsPerInch:Wa,RenderingCancelledException:zf,ResponseException:xc,setLayerDimensions:Os,shadow:Tt,SignatureExtractor:Ia,stopEvent:fe,SupportedImageMimeTypes:af,TextLayer:He,TouchManager:eu,updateUrlHash:hv,Util:at,VerbosityLevel:Kc,version:g1,XfaLayer:Lv};const ff=(r,t)=>t.some(e=>r instanceof e);let cb,ub;function z1(){return cb||(cb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function U1(){return ub||(ub=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pf=new WeakMap,jd=new WeakMap,su=new WeakMap;function j1(r){const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",c)},o=()=>{e(Ns(r.result)),s()},c=()=>{n(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",c)});return su.set(t,r),t}function G1(r){if(pf.has(r))return;const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",c),r.removeEventListener("abort",c)},o=()=>{e(),s()},c=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",c),r.addEventListener("abort",c)});pf.set(r,t)}let gf={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return pf.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ns(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function jv(r){gf=r(gf)}function V1(r){return U1().includes(r)?function(...t){return r.apply(mf(this),t),Ns(this.request)}:function(...t){return Ns(r.apply(mf(this),t))}}function q1(r){return typeof r=="function"?V1(r):(r instanceof IDBTransaction&&G1(r),ff(r,z1())?new Proxy(r,gf):r)}function Ns(r){if(r instanceof IDBRequest)return j1(r);if(jd.has(r))return jd.get(r);const t=q1(r);return t!==r&&(jd.set(r,t),su.set(t,r)),t}const mf=r=>su.get(r);function Cs(r,t,{blocked:e,upgrade:n,blocking:s,terminated:o}={}){const c=indexedDB.open(r,t),h=Ns(c);return n&&c.addEventListener("upgradeneeded",d=>{n(Ns(c.result),d.oldVersion,d.newVersion,Ns(c.transaction),d)}),e&&c.addEventListener("blocked",d=>e(d.oldVersion,d.newVersion,d)),h.then(d=>{o&&d.addEventListener("close",()=>o()),s&&d.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}const Y1=["get","getKey","getAll","getAllKeys","count"],X1=["put","add","delete","clear"],Gd=new Map;function hb(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Gd.get(t))return Gd.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=X1.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Y1.includes(e)))return;const o=async function(c,...h){const d=this.transaction(c,s?"readwrite":"readonly");let f=d.store;return n&&(f=f.index(h.shift())),(await Promise.all([f[e](...h),s&&d.done]))[0]};return Gd.set(t,o),o}jv(r=>({...r,get:(t,e,n)=>hb(t,e)||r.get(t,e,n),has:(t,e)=>!!hb(t,e)||r.has(t,e)}));const $1=["continue","continuePrimaryKey","advance"],db={},_f=new WeakMap,Gv=new WeakMap,W1={get(r,t){if(!$1.includes(t))return r[t];let e=db[t];return e||(e=db[t]=function(...n){_f.set(this,Gv.get(this)[t](...n))}),e}};async function*K1(...r){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...r)),!t)return;t=t;const e=new Proxy(t,W1);for(Gv.set(e,t),su.set(e,mf(t));t;)yield e,t=await(_f.get(e)||t.continue()),_f.delete(e)}function fb(r,t){return t===Symbol.asyncIterator&&ff(r,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&ff(r,[IDBIndex,IDBObjectStore])}jv(r=>({...r,get(t,e,n){return fb(t,e)?K1:r.get(t,e,n)},has(t,e){return fb(t,e)||r.has(t,e)}}));ja.workerSrc="./pdf.worker.min.js";async function Q1(r){const t=await Mv({url:URL.createObjectURL(r)}).promise,e=[];for(let n=0;n<t.numPages;n++){const s=await t.getPage(n+1),o=await Z1(s);e.push(o)}return e}async function Z1(r){const n=(await r.getTextContent()).items.map(f=>{const[g,_,y,b,A,S]=f.transform;return{text:f.str,x:A,y:S,width:f.width,height:b}}).sort((f,g)=>Math.abs(f.y-g.y)>5?g.y-f.y:f.x-g.x),s=[];let o=[],c=null;const h=5;for(let f of n)c===null||Math.abs(f.y-c)<=h?(o.push(f),c===null?c=f.y:c=o.reduce((g,_)=>g+_.y,0)/o.length):(o.length&&s.push(o),o=[f],c=f.y);o.length&&s.push(o);let d="";for(let f of s){f.sort((y,b)=>y.x-b.x);let g="",_=null;for(let y of f)_!==null&&y.x-_>y.height*.2&&(g+=" "),g+=y.text,_=y.x+y.width;g.trim()&&(d+=g+`
`)}return d.trim()}function J1(r){return!r||!Array.isArray(r)||r.length===0?(console.warn("No se pudo extraer texto del PDF"),{}):r}function tC(r){const t=["Fecha Fin","Frec. Horas","F. Real de Ejecucion","Frec. Comb.","Incidencia"],e={"Numero orden":/Número orden\s+?(\d+)/,"Tipo de Orden":/[A-Z0-9]\nClase/,Clase:/Clase (.+?) Asignado a/,"Asignado a":/Asignado a (.+?)\n/,Descripcion:/Descripción (.+?) Tipo/,Tipo:/Tipo (.+?) Estado/,Estado:/Estado (.+?) Frec/,"Frec. Dias":/Frec\. D[ií]as ([0-9]+)/,"N Unidad":/Nº Unidad (.+?) Parte/,Parte:/Parte (.+?) F inicial/,"F inicial":/F inicial ([0-9/]+)/,"Frec. Comb.":/Frec\. Comb\. (.+?)/,Especialidad:/Especialidad (.+?) Elemento/,Elemento:/Elemento (.+?) FF\.\.RReeaall/,"F. Real de Ejecucion":/FF\.\.RReeaall EEjjeeccuucciioonn (.+?) Frec\. Km/,"Frec. Km":/Frec\. Km ([^ ]*)/,Modo:/Modo ([^ ]*?)(?:\s+(?:Fecha Fin|Frec\. Horas))/,"Fecha Fin":/Fecha Fin ([0-9/]+)/,"Frec. Horas":/Frec\. Horas ([^ ]*)/,Originador:/Originador\s+?([A-Z]+ [A-ZÁÉÍÓÚÑa-z\s]+)\nIncidencia/,Incidencia:/Incidencia (.+?) Fecha Venc\./,"Fecha Venc.":/Fecha Venc\. ([0-9/]+)/,"Ultima Realiz.":/Ultima Realiz\.\s+?([0-9/]+)/,Linea:/Linea (.+?) Kit de Tareas/,"Kit de Tareas":/Kit de Tareas ([0-9]+)/,"Proximo Venc.":/Proximo Venc\. ([0-9/]+)/,"Fecha Prox Emision":/Fecha Prox Emisión ([0-9/]+)/,"N de Serie":/Nº de Serie (.+?) Planta/,Planta:/Planta (.+?) Tipo servici/,"Tipo servici":/Tipo servici ([A-Z0-9]+ [A-ZÁÉÍÓÚÑa-z\.]+)/,Prioridad:/Prioridad: ([A-Z\-a-z]+)/,"Seg. y Medio Ambiente":/Seg\. y Medio Ambiente ([A-Z0-9]+)/,Calidad:/Calidad ([A-Z0-9]+)/,Operacion:/Operación ([A-Z0-9]+)/,Mantenimiento:/Mantenimiento ([A-Z0-9]+)/,Categorizacion:/Categorización\s+?([A-Z0-9]+)/,"Tipo de Servicio":/Tipo de Servicio (.+?)\n/},n={};t.forEach(o=>n[o]=null);for(const[o,c]of Object.entries(e)){const h=r.match(c);h&&(n[o]=h[1].trim())}let s=n["Tipo de Servicio"];return s&&s.includes("SYS")?s=1:s&&s.includes("CCL")?s=2:s=3,n["Frec. Dias"]=n["Frec. Dias"]&&!isNaN(n["Frec. Dias"])?parseInt(n["Frec. Dias"]):null,n.prioridad=s,n.asignado_a_code=null,n.asignado_por_name=null,n.asignado_por_code=null,n.Especialidad_id=null,n.hs_reales=0,n.fecha_inicio=null,n.fecha_fin=null,n.observaciones=null,n.status=0,n.obs_anulada=null,n.code_orden_anulada=null,n.checkListDict={},n}function eC(r){const t=r.split(`
`),e=[];let n=0;const s=/^([A-ZÁÉÍÓÚÑa-z0-9]+)\s+([\d\S]+)\s+(\d+)\s+(.*)\s+(\d\.\d+|\.\d+)\s+(.+)/,o=/^([A-ZÁÉÍÓÚÑa-z0-9]+)\s+([\d\.]+)\s+(\d+)\s+(.+)/;let c=0;for(let h=17;h<t.length;h++){const d=t[h];let f=d.match(s);if(f){let g=parseFloat(f[5]);isNaN(g)&&(g=0);const _={Taller:f[1],"Numero sec oper":parseFloat(f[2]),"Tarea Standard":f[3],Descripcion:f[4],"Hs Estim":g,"Valor esperado":f[6],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};e.push(_),n++}else if(f=d.match(o),f){const g={Taller:f[1],"Numero sec oper":parseFloat(f[2]),"Tarea Standard":f[3],Descripcion:f[4],"Hs Estim":0,"Valor esperado":f[4],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};e.push(g),n++}else{try{c=e.reduce((g,_)=>g+(_["Hs Estim"]||0),0),c=Math.round(c*1e3)/1e3}catch{c=0}return{data:e,Tasks_N:n,h_estimadas:c}}}try{c=e.reduce((h,d)=>h+(d["Hs Estim"]||0),0),c=Math.round(c*1e3)/1e3}catch{c=0}return{data:e,Tasks_N:n,h_estimadas:c}}function nC(r,t){let e="";const n=["OT Generadas","Realizado por:","Firma:"];e=t.split(`
`).slice(r+17).join(`
`).trim();for(const o of n){const c=e.indexOf(o);if(c!==-1){e=e.slice(0,c).trim();break}}return e}function iC(r,t){t=nC(r,t);const e=/^(.?.?T\d+)/im,n=/^(.?.?SEGURIDAD)|^(.?.?SGURIDAD)/im,s=[];let o="",c="",h=0,d=0;for(const f of t.split(`
`))e.test(f)?(h===1&&(c!==""&&(o=c+`
`+o),s.push(o)),o=f,h=1,d=0):n.test(f)&&h===1&&d===0?o+=`
`+f:n.test(f)?d===1&&h===1?(o=c+`
`+o,s.push(o)):(c=f,h=2,d=1):h===1?o+=`
`+f:h===2&&(c+=`
`+f);return h===1?(c!==""&&(o=c+`
`+o),s.push(o)):h===2&&c!==""&&s.push(c),s}function sC(r){const t=J1(r),e=/Número orden\s+?(\d+)/,n=/(\nOT Generadas)|(\nRealizado por:)|(\nFirma:)/g,s="",o={};for(const c of t){let h;if((h=e.exec(c))!==null){const d=h[1];if(o[d]){let f=c.replace(n,s);f=f.split(`
`).slice(3).join(`
`),o[d].data+=`
`+f}else{o[d]={};let f=c.replace(n,s);o[d].data=f}}}for(const c in o)o[c].info=tC(o[c].data),o[c].tasks=eC(o[c].data),o[c].protocolos=iC(o[c].tasks.Tasks_N,o[c].data);return o}async function aC(r){let t=[];Array.isArray(r)?t=r:typeof r=="object"&&r!==null&&(t=Object.entries(r).map(([s,o])=>({id:s,...o})));const n=(await Cs("pdfDataDB",1,{upgrade(s){s.objectStoreNames.contains("pdfData")||s.createObjectStore("pdfData",{keyPath:"id"})}})).transaction("pdfData","readwrite");for(const s of t)await n.store.put(s);await n.done}async function rC(r,t){const e=await Q1(r),n=sC(e);await aC(n),t(Object.keys(n).length)}const oC=()=>{};var pb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vv={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z=function(r,t){if(!r)throw nr(t)},nr=function(r){return new Error("Firebase Database ("+Vv.SDK_VERSION+") INTERNAL ASSERT FAILED: "+r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qv=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},lC=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const o=r[e++];t[n++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=r[e++],c=r[e++],h=r[e++],d=((s&7)<<18|(o&63)<<12|(c&63)<<6|h&63)-65536;t[n++]=String.fromCharCode(55296+(d>>10)),t[n++]=String.fromCharCode(56320+(d&1023))}else{const o=r[e++],c=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(o&63)<<6|c&63)}}return t.join("")},ep={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const o=r[s],c=s+1<r.length,h=c?r[s+1]:0,d=s+2<r.length,f=d?r[s+2]:0,g=o>>2,_=(o&3)<<4|h>>4;let y=(h&15)<<2|f>>6,b=f&63;d||(b=64,c||(y=64)),n.push(e[g],e[_],e[y],e[b])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(qv(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):lC(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const o=e[r.charAt(s++)],h=s<r.length?e[r.charAt(s)]:0;++s;const f=s<r.length?e[r.charAt(s)]:64;++s;const _=s<r.length?e[r.charAt(s)]:64;if(++s,o==null||h==null||f==null||_==null)throw new cC;const y=o<<2|h>>4;if(n.push(y),f!==64){const b=h<<4&240|f>>2;if(n.push(b),_!==64){const A=f<<6&192|_;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class cC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Yv=function(r){const t=qv(r);return ep.encodeByteArray(t,!0)},Mc=function(r){return Yv(r).replace(/\./g,"")},yf=function(r){try{return ep.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uC(r){return Xv(void 0,r)}function Xv(r,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const e=t;return new Date(e.getTime());case Object:r===void 0&&(r={});break;case Array:r=[];break;default:return t}for(const e in t)!t.hasOwnProperty(e)||!hC(e)||(r[e]=Xv(r[e],t[e]));return r}function hC(r){return r!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC=()=>dC().__FIREBASE_DEFAULTS__,pC=()=>{if(typeof process>"u"||typeof pb>"u")return;const r=pb.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},gC=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&yf(r[1]);return t&&JSON.parse(t)},$v=()=>{try{return oC()||fC()||pC()||gC()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},mC=r=>$v()?.emulatorHosts?.[r],_C=r=>{const t=mC(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},Wv=()=>$v()?.config;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function np(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function yC(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bC(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,o=r.sub||r.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...r};return[Mc(JSON.stringify(e)),Mc(JSON.stringify(c)),""].join(".")}const vo={};function vC(){const r={prod:[],emulator:[]};for(const t of Object.keys(vo))vo[t]?r.emulator.push(t):r.prod.push(t);return r}function AC(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let gb=!1;function SC(r,t){if(typeof window>"u"||typeof document>"u"||!np(window.location.host)||vo[r]===t||vo[r]||gb)return;vo[r]=t;function e(y){return`__firebase__banner__${y}`}const n="__firebase__banner",o=vC().prod.length>0;function c(){const y=document.getElementById(n);y&&y.remove()}function h(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function d(y,b){y.setAttribute("width","24"),y.setAttribute("id",b),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function f(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{gb=!0,c()},y}function g(y,b){y.setAttribute("id",b),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function _(){const y=AC(n),b=e("text"),A=document.getElementById(b)||document.createElement("span"),S=e("learnmore"),C=document.getElementById(S)||document.createElement("a"),w=e("preprendIcon"),N=document.getElementById(w)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const x=y.element;h(x),g(C,S);const M=f();d(N,w),x.append(N,A,C,M),document.body.appendChild(x)}o?(A.innerText="Preview backend disconnected.",N.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(N.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EC(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Kv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(EC())}function wC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function CC(){return Vv.NODE_ADMIN===!0}function TC(){try{return typeof indexedDB=="object"}catch{return!1}}function xC(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RC="FirebaseError";class Xo extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=RC,Object.setPrototypeOf(this,Xo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qv.prototype.create)}}class Qv{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],c=o?DC(o,n):"Error",h=`${this.serviceName}: ${c} (${s}).`;return new Xo(s,h,n)}}function DC(r,t){return r.replace(MC,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const MC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mo(r){return JSON.parse(r)}function Ce(r){return JSON.stringify(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv=function(r){let t={},e={},n={},s="";try{const o=r.split(".");t=Mo(yf(o[0])||""),e=Mo(yf(o[1])||""),s=o[2],n=e.d||{},delete e.d}catch{}return{header:t,claims:e,data:n,signature:s}},NC=function(r){const t=Zv(r),e=t.claims;return!!e&&typeof e=="object"&&e.hasOwnProperty("iat")},OC=function(r){const t=Zv(r).claims;return typeof t=="object"&&t.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function Ka(r,t){if(Object.prototype.hasOwnProperty.call(r,t))return r[t]}function bf(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function Nc(r,t,e){const n={};for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=t.call(e,r[s],s,r));return n}function Oc(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const o=r[s],c=t[s];if(mb(o)&&mb(c)){if(!Oc(o,c))return!1}else if(o!==c)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function mb(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kC(r){const t=[];for(const[e,n]of Object.entries(r))Array.isArray(n)?n.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if(typeof t=="string")for(let _=0;_<16;_++)n[_]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let _=0;_<16;_++)n[_]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let _=16;_<80;_++){const y=n[_-3]^n[_-8]^n[_-14]^n[_-16];n[_]=(y<<1|y>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],c=this.chain_[2],h=this.chain_[3],d=this.chain_[4],f,g;for(let _=0;_<80;_++){_<40?_<20?(f=h^o&(c^h),g=1518500249):(f=o^c^h,g=1859775393):_<60?(f=o&c|h&(o|c),g=2400959708):(f=o^c^h,g=3395469782);const y=(s<<5|s>>>27)+f+d+g+n[_]&4294967295;d=h,h=c,c=(o<<30|o>>>2)&4294967295,o=s,s=y}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+d&4294967295}update(t,e){if(t==null)return;e===void 0&&(e=t.length);const n=e-this.blockSize;let s=0;const o=this.buf_;let c=this.inbuf_;for(;s<e;){if(c===0)for(;s<=n;)this.compress_(t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(o[c]=t.charCodeAt(s),++c,++s,c===this.blockSize){this.compress_(o),c=0;break}}else for(;s<e;)if(o[c]=t[s],++c,++s,c===this.blockSize){this.compress_(o),c=0;break}}this.inbuf_=c,this.total_+=e}digest(){const t=[];let e=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=e&255,e/=256;this.compress_(this.buf_);let n=0;for(let s=0;s<5;s++)for(let o=24;o>=0;o-=8)t[n]=this.chain_[s]>>o&255,++n;return t}}function Qa(r,t){return`${r} failed: ${t} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IC=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);if(s>=55296&&s<=56319){const o=s-55296;n++,Z(n<r.length,"Surrogate pair missing trail surrogate.");const c=r.charCodeAt(n)-56320;s=65536+(o<<10)+c}s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):s<65536?(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},au=function(r){let t=0;for(let e=0;e<r.length;e++){const n=r.charCodeAt(e);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,e++):t+=3}return t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zs(r){return r&&r._delegate?r._delegate:r}class No{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ss="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new gi;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(FC(t))try{this.getOrInitializeService({instanceIdentifier:Ss})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});n.resolve(o)}catch{}}}}clearInstance(t=Ss){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ss){return this.instances.has(t)}getOptions(t=Ss){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[o,c]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(o);n===h&&c.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const o=this.instances.get(n);return o&&t(o,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:BC(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=Ss){return this.component?this.component.multipleInstances?t:Ss:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function BC(r){return r===Ss?void 0:r}function FC(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HC{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new PC(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $t;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})($t||($t={}));const zC={debug:$t.DEBUG,verbose:$t.VERBOSE,info:$t.INFO,warn:$t.WARN,error:$t.ERROR,silent:$t.SILENT},UC=$t.INFO,jC={[$t.DEBUG]:"log",[$t.VERBOSE]:"log",[$t.INFO]:"info",[$t.WARN]:"warn",[$t.ERROR]:"error"},GC=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),s=jC[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Jv{constructor(t){this.name=t,this._logLevel=UC,this._logHandler=GC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in $t))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?zC[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,$t.DEBUG,...t),this._logHandler(this,$t.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,$t.VERBOSE,...t),this._logHandler(this,$t.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,$t.INFO,...t),this._logHandler(this,$t.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,$t.WARN,...t),this._logHandler(this,$t.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,$t.ERROR,...t),this._logHandler(this,$t.ERROR,...t)}}const VC=(r,t)=>t.some(e=>r instanceof e);let _b,yb;function qC(){return _b||(_b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function YC(){return yb||(yb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const t0=new WeakMap,vf=new WeakMap,e0=new WeakMap,Vd=new WeakMap,ip=new WeakMap;function XC(r){const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",c)},o=()=>{e(Wi(r.result)),s()},c=()=>{n(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",c)});return t.then(e=>{e instanceof IDBCursor&&t0.set(e,r)}).catch(()=>{}),ip.set(t,r),t}function $C(r){if(vf.has(r))return;const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",c),r.removeEventListener("abort",c)},o=()=>{e(),s()},c=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",c),r.addEventListener("abort",c)});vf.set(r,t)}let Af={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return vf.get(r);if(t==="objectStoreNames")return r.objectStoreNames||e0.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Wi(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function WC(r){Af=r(Af)}function KC(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(qd(this),t,...e);return e0.set(n,t.sort?t.sort():[t]),Wi(n)}:YC().includes(r)?function(...t){return r.apply(qd(this),t),Wi(t0.get(this))}:function(...t){return Wi(r.apply(qd(this),t))}}function QC(r){return typeof r=="function"?KC(r):(r instanceof IDBTransaction&&$C(r),VC(r,qC())?new Proxy(r,Af):r)}function Wi(r){if(r instanceof IDBRequest)return XC(r);if(Vd.has(r))return Vd.get(r);const t=QC(r);return t!==r&&(Vd.set(r,t),ip.set(t,r)),t}const qd=r=>ip.get(r);function ZC(r,t,{blocked:e,upgrade:n,blocking:s,terminated:o}={}){const c=indexedDB.open(r,t),h=Wi(c);return n&&c.addEventListener("upgradeneeded",d=>{n(Wi(c.result),d.oldVersion,d.newVersion,Wi(c.transaction),d)}),e&&c.addEventListener("blocked",d=>e(d.oldVersion,d.newVersion,d)),h.then(d=>{o&&d.addEventListener("close",()=>o()),s&&d.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}const JC=["get","getKey","getAll","getAllKeys","count"],tT=["put","add","delete","clear"],Yd=new Map;function bb(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Yd.get(t))return Yd.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=tT.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||JC.includes(e)))return;const o=async function(c,...h){const d=this.transaction(c,s?"readwrite":"readonly");let f=d.store;return n&&(f=f.index(h.shift())),(await Promise.all([f[e](...h),s&&d.done]))[0]};return Yd.set(t,o),o}WC(r=>({...r,get:(t,e,n)=>bb(t,e)||r.get(t,e,n),has:(t,e)=>!!bb(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eT{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(nT(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function nT(r){return r.getComponent()?.type==="VERSION"}const Sf="@firebase/app",vb="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi=new Jv("@firebase/app"),iT="@firebase/app-compat",sT="@firebase/analytics-compat",aT="@firebase/analytics",rT="@firebase/app-check-compat",oT="@firebase/app-check",lT="@firebase/auth",cT="@firebase/auth-compat",uT="@firebase/database",hT="@firebase/data-connect",dT="@firebase/database-compat",fT="@firebase/functions",pT="@firebase/functions-compat",gT="@firebase/installations",mT="@firebase/installations-compat",_T="@firebase/messaging",yT="@firebase/messaging-compat",bT="@firebase/performance",vT="@firebase/performance-compat",AT="@firebase/remote-config",ST="@firebase/remote-config-compat",ET="@firebase/storage",wT="@firebase/storage-compat",CT="@firebase/firestore",TT="@firebase/ai",xT="@firebase/firestore-compat",RT="firebase",DT="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ef="[DEFAULT]",MT={[Sf]:"fire-core",[iT]:"fire-core-compat",[aT]:"fire-analytics",[sT]:"fire-analytics-compat",[oT]:"fire-app-check",[rT]:"fire-app-check-compat",[lT]:"fire-auth",[cT]:"fire-auth-compat",[uT]:"fire-rtdb",[hT]:"fire-data-connect",[dT]:"fire-rtdb-compat",[fT]:"fire-fn",[pT]:"fire-fn-compat",[gT]:"fire-iid",[mT]:"fire-iid-compat",[_T]:"fire-fcm",[yT]:"fire-fcm-compat",[bT]:"fire-perf",[vT]:"fire-perf-compat",[AT]:"fire-rc",[ST]:"fire-rc-compat",[ET]:"fire-gcs",[wT]:"fire-gcs-compat",[CT]:"fire-fst",[xT]:"fire-fst-compat",[TT]:"fire-vertex","fire-js":"fire-js",[RT]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=new Map,NT=new Map,wf=new Map;function Ab(r,t){try{r.container.addComponent(t)}catch(e){yi.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Lc(r){const t=r.name;if(wf.has(t))return yi.debug(`There were multiple attempts to register component ${t}.`),!1;wf.set(t,r);for(const e of kc.values())Ab(e,r);for(const e of NT.values())Ab(e,r);return!0}function OT(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function kT(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ki=new Qv("app","Firebase",LT);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IT{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new No("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ki.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT=DT;function n0(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:Ef,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw Ki.create("bad-app-name",{appName:String(s)});if(e||(e=Wv()),!e)throw Ki.create("no-options");const o=kc.get(s);if(o){if(Oc(e,o.options)&&Oc(n,o.config))return o;throw Ki.create("duplicate-app",{appName:s})}const c=new HC(s);for(const d of wf.values())c.addComponent(d);const h=new IT(e,n,c);return kc.set(s,h),h}function BT(r=Ef){const t=kc.get(r);if(!t&&r===Ef&&Wv())return n0();if(!t)throw Ki.create("no-app",{appName:r});return t}function Ga(r,t,e){let n=MT[r]??r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const c=[`Unable to register library "${n}" with version "${t}":`];s&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${t}" contains illegal characters (whitespace or "/")`),yi.warn(c.join(" "));return}Lc(new No(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FT="firebase-heartbeat-database",HT=1,Oo="firebase-heartbeat-store";let Xd=null;function i0(){return Xd||(Xd=ZC(FT,HT,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Oo)}catch(e){console.warn(e)}}}}).catch(r=>{throw Ki.create("idb-open",{originalErrorMessage:r.message})})),Xd}async function zT(r){try{const e=(await i0()).transaction(Oo),n=await e.objectStore(Oo).get(s0(r));return await e.done,n}catch(t){if(t instanceof Xo)yi.warn(t.message);else{const e=Ki.create("idb-get",{originalErrorMessage:t?.message});yi.warn(e.message)}}}async function Sb(r,t){try{const n=(await i0()).transaction(Oo,"readwrite");await n.objectStore(Oo).put(t,s0(r)),await n.done}catch(e){if(e instanceof Xo)yi.warn(e.message);else{const n=Ki.create("idb-set",{originalErrorMessage:e?.message});yi.warn(n.message)}}}function s0(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UT=1024,jT=30;class GT{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new qT(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Eb();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>jT){const s=YT(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){yi.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Eb(),{heartbeatsToSend:e,unsentEntries:n}=VT(this._heartbeatsCache.heartbeats),s=Mc(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return yi.warn(t),""}}}function Eb(){return new Date().toISOString().substring(0,10)}function VT(r,t=UT){const e=[];let n=r.slice();for(const s of r){const o=e.find(c=>c.agent===s.agent);if(o){if(o.dates.push(s.date),wb(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),wb(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class qT{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return TC()?xC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await zT(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Sb(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Sb(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function wb(r){return Mc(JSON.stringify({version:2,heartbeats:r})).length}function YT(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XT(r){Lc(new No("platform-logger",t=>new eT(t),"PRIVATE")),Lc(new No("heartbeat",t=>new GT(t),"PRIVATE")),Ga(Sf,vb,r),Ga(Sf,vb,"esm2020"),Ga("fire-js","")}XT("");var $T="firebase",WT="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ga($T,WT,"app");var Cb={};const Tb="@firebase/database",xb="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let a0="";function KT(r){a0=r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Ce(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:Mo(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return Kn(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r0=function(r){try{if(typeof window<"u"&&typeof window[r]<"u"){const t=window[r];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new QT(t)}}catch{}return new ZT},Ts=r0("localStorage"),JT=r0("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va=new Jv("@firebase/database"),tx=(function(){let r=1;return function(){return r++}})(),o0=function(r){const t=IC(r),e=new LC;e.update(t);const n=e.digest();return ep.encodeByteArray(n)},$o=function(...r){let t="";for(let e=0;e<r.length;e++){const n=r[e];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?t+=$o.apply(null,n):typeof n=="object"?t+=Ce(n):t+=n,t+=" "}return t};let Ao=null,Rb=!0;const ex=function(r,t){Z(!0,"Can't turn on custom loggers persistently."),Va.logLevel=$t.VERBOSE,Ao=Va.log.bind(Va)},Oe=function(...r){if(Rb===!0&&(Rb=!1,Ao===null&&JT.get("logging_enabled")===!0&&ex()),Ao){const t=$o.apply(null,r);Ao(t)}},Wo=function(r){return function(...t){Oe(r,...t)}},Cf=function(...r){const t="FIREBASE INTERNAL ERROR: "+$o(...r);Va.error(t)},bi=function(...r){const t=`FIREBASE FATAL ERROR: ${$o(...r)}`;throw Va.error(t),new Error(t)},Je=function(...r){const t="FIREBASE WARNING: "+$o(...r);Va.warn(t)},nx=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Je("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ru=function(r){return typeof r=="number"&&(r!==r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)},ix=function(r){if(document.readyState==="complete")r();else{let t=!1;const e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,r())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},Za="[MIN_NAME]",Ls="[MAX_NAME]",Us=function(r,t){if(r===t)return 0;if(r===Za||t===Ls)return-1;if(t===Za||r===Ls)return 1;{const e=Db(r),n=Db(t);return e!==null?n!==null?e-n===0?r.length-t.length:e-n:-1:n!==null?1:r<t?-1:1}},sx=function(r,t){return r===t?0:r<t?-1:1},ho=function(r,t){if(t&&r in t)return t[r];throw new Error("Missing required key ("+r+") in object: "+Ce(t))},sp=function(r){if(typeof r!="object"||r===null)return Ce(r);const t=[];for(const n in r)t.push(n);t.sort();let e="{";for(let n=0;n<t.length;n++)n!==0&&(e+=","),e+=Ce(t[n]),e+=":",e+=sp(r[t[n]]);return e+="}",e},l0=function(r,t){const e=r.length;if(e<=t)return[r];const n=[];for(let s=0;s<e;s+=t)s+t>e?n.push(r.substring(s,e)):n.push(r.substring(s,s+t));return n};function Be(r,t){for(const e in r)r.hasOwnProperty(e)&&t(e,r[e])}const c0=function(r){Z(!ru(r),"Invalid JSON number");const t=11,e=52,n=(1<<t-1)-1;let s,o,c,h,d;r===0?(o=0,c=0,s=1/r===-1/0?1:0):(s=r<0,r=Math.abs(r),r>=Math.pow(2,1-n)?(h=Math.min(Math.floor(Math.log(r)/Math.LN2),n),o=h+n,c=Math.round(r*Math.pow(2,e-h)-Math.pow(2,e))):(o=0,c=Math.round(r/Math.pow(2,1-n-e))));const f=[];for(d=e;d;d-=1)f.push(c%2?1:0),c=Math.floor(c/2);for(d=t;d;d-=1)f.push(o%2?1:0),o=Math.floor(o/2);f.push(s?1:0),f.reverse();const g=f.join("");let _="";for(d=0;d<64;d+=8){let y=parseInt(g.substr(d,8),2).toString(16);y.length===1&&(y="0"+y),_=_+y}return _.toLowerCase()},ax=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},rx=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function ox(r,t){let e="Unknown Error";r==="too_big"?e="The data requested exceeds the maximum size that can be accessed with a single request.":r==="permission_denied"?e="Client doesn't have permission to access the desired data.":r==="unavailable"&&(e="The service is unavailable");const n=new Error(r+" at "+t._path.toString()+": "+e);return n.code=r.toUpperCase(),n}const lx=new RegExp("^-?(0*)\\d{1,10}$"),cx=-2147483648,ux=2147483647,Db=function(r){if(lx.test(r)){const t=Number(r);if(t>=cx&&t<=ux)return t}return null},ir=function(r){try{r()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Je("Exception was thrown by user callback.",e),t},Math.floor(0))}},hx=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},So=function(r,t){const e=setTimeout(r,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,kT(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(n=>this.appCheck=n)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,n)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){this.appCheckProvider?.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Je(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(s=>this.auth_=s)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?(Oe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,n)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Je(t)}}class Tc{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}Tc.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap="5",u0="v",h0="s",d0="r",f0="f",p0=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,g0="ls",m0="p",Tf="ac",_0="websocket",y0="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(t,e,n,s,o=!1,c="",h=!1,d=!1,f=null){this.secure=e,this.namespace=n,this.webSocketOnly=s,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=d,this.emulatorOptions=f,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ts.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ts.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function px(r){return r.host!==r.internalHost||r.isCustomHost()||r.includeNamespaceInQueryParams}function v0(r,t,e){Z(typeof t=="string","typeof type must == string"),Z(typeof e=="object","typeof params must == object");let n;if(t===_0)n=(r.secure?"wss://":"ws://")+r.internalHost+"/.ws?";else if(t===y0)n=(r.secure?"https://":"http://")+r.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);px(r)&&(e.ns=r.namespace);const s=[];return Be(e,(o,c)=>{s.push(o+"="+c)}),n+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(){this.counters_={}}incrementCounter(t,e=1){Kn(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return uC(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $d={},Wd={};function rp(r){const t=r.toString();return $d[t]||($d[t]=new gx),$d[t]}function mx(r,t){const e=r.toString();return Wd[e]||(Wd[e]=t()),Wd[e]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<n.length;++s)n[s]&&ir(()=>{this.onMessage_(n[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mb="start",yx="close",bx="pLPCommand",vx="pRTLPCB",A0="id",S0="pw",E0="ser",Ax="cb",Sx="seg",Ex="ts",wx="d",Cx="dframe",w0=1870,C0=30,Tx=w0-C0,xx=25e3,Rx=3e4;class Fa{constructor(t,e,n,s,o,c,h){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=s,this.authToken=o,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Wo(t),this.stats_=rp(e),this.urlFn=d=>(this.appCheckToken&&(d[Tf]=this.appCheckToken),v0(e,y0,d))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new _x(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Rx)),ix(()=>{if(this.isClosed_)return;this.scriptTagHolder=new op((...o)=>{const[c,h,d,f,g]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,c===Mb)this.id=h,this.password=d;else if(c===yx)h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+c)},(...o)=>{const[c,h]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const n={};n[Mb]="t",n[E0]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[Ax]=this.scriptTagHolder.uniqueCallbackIdentifier),n[u0]=ap,this.transportSessionId&&(n[h0]=this.transportSessionId),this.lastSessionId&&(n[g0]=this.lastSessionId),this.applicationId&&(n[m0]=this.applicationId),this.appCheckToken&&(n[Tf]=this.appCheckToken),typeof location<"u"&&location.hostname&&p0.test(location.hostname)&&(n[d0]=f0);const s=this.urlFn(n);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Fa.forceAllow_=!0}static forceDisallow(){Fa.forceDisallow_=!0}static isAvailable(){return Fa.forceAllow_?!0:!Fa.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!ax()&&!rx()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=Ce(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=Yv(e),s=l0(n,Tx);for(let o=0;o<s.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[o]),this.curSegmentNum++}addDisconnectPingFrame(t,e){this.myDisconnFrame=document.createElement("iframe");const n={};n[Cx]="t",n[A0]=t,n[S0]=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=Ce(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class op{constructor(t,e,n,s){this.onDisconnect=n,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=tx(),window[bx+this.uniqueCallbackIdentifier]=t,window[vx+this.uniqueCallbackIdentifier]=e,this.myIFrame=op.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){Oe("frame writing exception"),h.stack&&Oe(h.stack),Oe(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||Oe("No IE domain setting required")}catch{const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[A0]=this.myID,t[S0]=this.myPW,t[E0]=this.currentSerial;let e=this.urlFn(t),n="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+C0+n.length<=w0;){const c=this.pendingSegs.shift();n=n+"&"+Sx+s+"="+c.seg+"&"+Ex+s+"="+c.ts+"&"+wx+s+"="+c.d,s++}return e=e+n,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},s=setTimeout(n,Math.floor(xx)),o=()=>{clearTimeout(s),n()};this.addTag(t,o)}addTag(t,e){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const s=n.readyState;(!s||s==="loaded"||s==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{Oe("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dx=16384,Mx=45e3;let Ic=null;typeof MozWebSocket<"u"?Ic=MozWebSocket:typeof WebSocket<"u"&&(Ic=WebSocket);class On{constructor(t,e,n,s,o,c,h){this.connId=t,this.applicationId=n,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Wo(this.connId),this.stats_=rp(e),this.connURL=On.connectionURL_(e,c,h,s,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,s,o){const c={};return c[u0]=ap,typeof location<"u"&&location.hostname&&p0.test(location.hostname)&&(c[d0]=f0),e&&(c[h0]=e),n&&(c[g0]=n),s&&(c[Tf]=s),o&&(c[m0]=o),v0(t,_0,c)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ts.set("previous_websocket_failure",!0);try{let n;CC(),this.mySock=new Ic(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const s=n.message||n.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const s=n.message||n.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){On.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&Ic!==null&&!On.forceDisallow_}static previouslyFailed(){return Ts.isInMemoryStorage||Ts.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ts.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const n=Mo(e);this.onMessage(n)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(Z(this.frames===null,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(e);else{const n=this.extractFrameCount_(e);n!==null&&this.appendFrame_(n)}}send(t){this.resetKeepAlive();const e=Ce(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=l0(e,Dx);n.length>1&&this.sendString_(String(n.length));for(let s=0;s<n.length;s++)this.sendString_(n[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Mx))}sendString_(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}On.responsesRequiredToBeHealthy=2;On.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{static get ALL_TRANSPORTS(){return[Fa,On]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=On&&On.isAvailable();let n=e&&!On.previouslyFailed();if(t.webSocketOnly&&(e||Je("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[On];else{const s=this.transports_=[];for(const o of ko.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);ko.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ko.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nx=6e4,Ox=5e3,kx=10*1024,Lx=100*1024,Kd="t",Nb="d",Ix="s",Ob="r",Px="e",kb="o",Lb="a",Ib="n",Pb="p",Bx="h";let Fx=class{constructor(t,e,n,s,o,c,h,d,f,g){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=s,this.authToken_=o,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=d,this.onKill_=f,this.lastSessionId=g,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Wo("c:"+this.id+":"),this.transportManager_=new ko(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,n)},Math.floor(0));const s=t.healthyTimeout||0;s>0&&(this.healthyTimeout_=So(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Lx?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>kx?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(Kd in t){const e=t[Kd];e===Lb?this.upgradeIfSecondaryHealthy_():e===Ob?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===kb&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=ho("t",t),n=ho("d",t);if(e==="c")this.onSecondaryControl_(n);else if(e==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Pb,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Lb,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Ib,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=ho("t",t),n=ho("d",t);e==="c"?this.onControl_(n):e==="d"&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=ho(Kd,t);if(Nb in t){const n=t[Nb];if(e===Bx){const s={...n};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(e===Ib){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===Ix?this.onConnectionShutdown_(n):e===Ob?this.onReset_(n):e===Px?Cf("Server Error: "+n):e===kb?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Cf("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,s=t.h;this.sessionId=t.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),ap!==n&&Je("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),So(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Nx))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):So(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Ox))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Pb,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ts.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{put(t,e,n,s){}merge(t,e,n,s){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(t){this.allowedEvents_=t,this.listeners_={},Z(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let s=0;s<n.length;s++)n[s].callback.apply(n[s].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const s=this.getInitialEvent(t);s&&e.apply(n,s)}off(t,e,n){this.validateEventType_(t);const s=this.listeners_[t]||[];for(let o=0;o<s.length;o++)if(s[o].callback===e&&(!n||n===s[o].context)){s.splice(o,1);return}}validateEventType_(t){Z(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends x0{static getInstance(){return new Pc}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Kv()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return Z(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bb=32,Fb=768;class zt{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let n=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[n]=this.pieces_[s],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}}function Pt(){return new zt("")}function wt(r){return r.pieceNum_>=r.pieces_.length?null:r.pieces_[r.pieceNum_]}function ts(r){return r.pieces_.length-r.pieceNum_}function Yt(r){let t=r.pieceNum_;return t<r.pieces_.length&&t++,new zt(r.pieces_,t)}function lp(r){return r.pieceNum_<r.pieces_.length?r.pieces_[r.pieces_.length-1]:null}function Hx(r){let t="";for(let e=r.pieceNum_;e<r.pieces_.length;e++)r.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(r.pieces_[e])));return t||"/"}function Lo(r,t=0){return r.pieces_.slice(r.pieceNum_+t)}function R0(r){if(r.pieceNum_>=r.pieces_.length)return null;const t=[];for(let e=r.pieceNum_;e<r.pieces_.length-1;e++)t.push(r.pieces_[e]);return new zt(t,0)}function oe(r,t){const e=[];for(let n=r.pieceNum_;n<r.pieces_.length;n++)e.push(r.pieces_[n]);if(t instanceof zt)for(let n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{const n=t.split("/");for(let s=0;s<n.length;s++)n[s].length>0&&e.push(n[s])}return new zt(e,0)}function xt(r){return r.pieceNum_>=r.pieces_.length}function Qe(r,t){const e=wt(r),n=wt(t);if(e===null)return t;if(e===n)return Qe(Yt(r),Yt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+r+")")}function zx(r,t){const e=Lo(r,0),n=Lo(t,0);for(let s=0;s<e.length&&s<n.length;s++){const o=Us(e[s],n[s]);if(o!==0)return o}return e.length===n.length?0:e.length<n.length?-1:1}function cp(r,t){if(ts(r)!==ts(t))return!1;for(let e=r.pieceNum_,n=t.pieceNum_;e<=r.pieces_.length;e++,n++)if(r.pieces_[e]!==t.pieces_[n])return!1;return!0}function Tn(r,t){let e=r.pieceNum_,n=t.pieceNum_;if(ts(r)>ts(t))return!1;for(;e<r.pieces_.length;){if(r.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0}class Ux{constructor(t,e){this.errorPrefix_=e,this.parts_=Lo(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=au(this.parts_[n]);D0(this)}}function jx(r,t){r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=au(t),D0(r)}function Gx(r){const t=r.parts_.pop();r.byteLength_-=au(t),r.parts_.length>0&&(r.byteLength_-=1)}function D0(r){if(r.byteLength_>Fb)throw new Error(r.errorPrefix_+"has a key path longer than "+Fb+" bytes ("+r.byteLength_+").");if(r.parts_.length>Bb)throw new Error(r.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Bb+") or object contains a cycle "+Es(r))}function Es(r){return r.parts_.length===0?"":"in property '"+r.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up extends x0{static getInstance(){return new up}constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const n=!document[t];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}getInitialEvent(t){return Z(t==="visible","Unknown event type: "+t),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fo=1e3,Vx=300*1e3,Hb=30*1e3,qx=1.3,Yx=3e4,Xx="server_kill",zb=3;class _i extends T0{constructor(t,e,n,s,o,c,h,d){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=c,this.appCheckTokenProvider_=h,this.authOverride_=d,this.id=_i.nextPersistentConnectionId_++,this.log_=Wo("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=fo,this.maxReconnectDelay_=Vx,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");up.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Pc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,n){const s=++this.requestNumber_,o={r:s,a:t,b:e};this.log_(Ce(o)),Z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[s]=n)}get(t){this.initConnection_();const e=new gi,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:c=>{const h=c.d;c.s==="ok"?e.resolve(h):e.reject(h)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),e.promise}listen(t,e,n,s){this.initConnection_();const o=t._queryIdentifier,c=t._path.toString();this.log_("Listen called for "+c+" "+o),this.listens.has(c)||this.listens.set(c,new Map),Z(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Z(!this.listens.get(c).has(o),"listen() called twice for same path/queryId.");const h={onComplete:s,hashFn:e,query:t,tag:n};this.listens.get(c).set(o,h),this.connected_&&this.sendListen_(h)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)})}sendListen_(t){const e=t.query,n=e._path.toString(),s=e._queryIdentifier;this.log_("Listen on "+n+" for "+s);const o={p:n},c="q";t.tag&&(o.q=e._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(c,o,h=>{const d=h.d,f=h.s;_i.warnOnListenWarnings_(d,e),(this.listens.get(n)&&this.listens.get(n).get(s))===t&&(this.log_("listen response",h),f!=="ok"&&this.removeListen_(n,s),t.onComplete&&t.onComplete(f,d))})}static warnOnListenWarnings_(t,e){if(t&&typeof t=="object"&&Kn(t,"w")){const n=Ka(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const s='".indexOn": "'+e._queryParams.getIndex().toString()+'"',o=e._path.toString();Je(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||OC(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Hb)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=NC(t)?"auth":"gauth",n={cred:t};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(e,n,s=>{const o=s.s,c=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,c))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const e=t.s,n=t.d||"error";e==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)})}unlisten(t,e){const n=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+s),Z(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,s)&&this.connected_&&this.sendUnlisten_(n,s,t._queryObject,e)}sendUnlisten_(t,e,n,s){this.log_("Unlisten on "+t+" for "+e);const o={p:t},c="n";s&&(o.q=n,o.t=s),this.sendRequest(c,o)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,s){const o={p:e,d:n};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,c=>{s&&setTimeout(()=>{s(c.s,c.d)},Math.floor(0))})}put(t,e,n,s){this.putInternal("p",t,e,n,s)}merge(t,e,n,s){this.putInternal("m",t,e,n,s)}putInternal(t,e,n,s,o){this.initConnection_();const c={p:e,d:n};o!==void 0&&(c.h=o),this.outstandingPuts_.push({action:t,request:c,onComplete:s}),this.outstandingPutCount_++;const h=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(h):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,o=>{this.log_(e+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,n=>{if(n.s!=="ok"){const o=n.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ce(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),t==="d"?this.onDataUpdate_(e.p,e.d,!1,e.t):t==="m"?this.onDataUpdate_(e.p,e.d,!0,e.t):t==="c"?this.onListenRevoked_(e.p,e.q):t==="ac"?this.onAuthRevoked_(e.s,e.d):t==="apc"?this.onAppCheckRevoked_(e.s,e.d):t==="sd"?this.onSecurityDebugPacket_(e):Cf("Unrecognized action received from server: "+Ce(t)+`
Are you using the latest client?`)}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){Z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=fo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=fo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Yx&&(this.reconnectDelay_=fo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*qx)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+_i.nextConnectionId_++,o=this.lastSessionId;let c=!1,h=null;const d=function(){h?h.close():(c=!0,n())},f=function(_){Z(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(_)};this.realtime_={close:d,sendRequest:f};const g=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[_,y]=await Promise.all([this.authTokenProvider_.getToken(g),this.appCheckTokenProvider_.getToken(g)]);c?Oe("getToken() completed but was canceled"):(Oe("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=y&&y.token,h=new Fx(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,n,b=>{Je(b+" ("+this.repoInfo_.toString()+")"),this.interrupt(Xx)},o))}catch(_){this.log_("Failed to get token: "+_),c||(this.repoInfo_.nodeAdmin&&Je(_),d())}}}interrupt(t){Oe("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Oe("Resuming connection for reason: "+t),delete this.interruptReasons_[t],bf(this.interruptReasons_)&&(this.reconnectDelay_=fo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;e?n=e.map(o=>sp(o)).join("$"):n="default";const s=this.removeListen_(t,n);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,e){const n=new zt(t).toString();let s;if(this.listens.has(n)){const o=this.listens.get(n);s=o.get(e),o.delete(e),o.size===0&&this.listens.delete(n)}else s=void 0;return s}onAuthRevoked_(t,e){Oe("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=zb&&(this.reconnectDelay_=Hb,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Oe("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=zb&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";t["sdk."+e+"."+a0.replace(/\./g,"-")]=1,Kv()?t["framework.cordova"]=1:wC()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Pc.getInstance().currentlyOnline();return bf(this.interruptReasons_)&&t}}_i.nextPersistentConnectionId_=0;_i.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new Rt(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new Rt(Za,t),s=new Rt(Za,e);return this.compare(n,s)!==0}minPost(){return Rt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ac;class M0 extends ou{static get __EMPTY_NODE(){return Ac}static set __EMPTY_NODE(t){Ac=t}compare(t,e){return Us(t.name,e.name)}isDefinedOn(t){throw nr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return Rt.MIN}maxPost(){return new Rt(Ls,Ac)}makePost(t,e){return Z(typeof t=="string","KeyIndex indexValue must always be a string."),new Rt(t,Ac)}toString(){return".key"}}const qa=new M0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(t,e,n,s,o=null){this.isReverse_=s,this.resultGenerator_=o,this.nodeStack_=[];let c=1;for(;!t.isEmpty();)if(t=t,c=e?n(t.key,e):1,s&&(c*=-1),c<0)this.isReverse_?t=t.left:t=t.right;else if(c===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class we{constructor(t,e,n,s,o){this.key=t,this.value=e,this.color=n??we.RED,this.left=s??Ze.EMPTY_NODE,this.right=o??Ze.EMPTY_NODE}copy(t,e,n,s,o){return new we(t??this.key,e??this.value,n??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const o=n(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,e,n),null):o===0?s=s.copy(null,e,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ze.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,s;if(n=this,e(t,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),e(t,n.key)===0){if(n.right.isEmpty())return Ze.EMPTY_NODE;s=n.right.min_(),n=n.copy(s.key,s.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}we.RED=!0;we.BLACK=!1;class $x{copy(t,e,n,s,o){return this}insert(t,e,n){return new we(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ze{constructor(t,e=Ze.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new Ze(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,we.BLACK,null,null))}remove(t){return new Ze(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,we.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),e===0)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,s=null;for(;!n.isEmpty();)if(e=this.comparator_(t,n.key),e===0){if(n.left.isEmpty())return s?s.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else e<0?n=n.left:e>0&&(s=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new Sc(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new Sc(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new Sc(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new Sc(this.root_,null,this.comparator_,!0,t)}}Ze.EMPTY_NODE=new $x;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wx(r,t){return Us(r.name,t.name)}function hp(r,t){return Us(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xf;function Kx(r){xf=r}const N0=function(r){return typeof r=="number"?"number:"+c0(r):"string:"+r},O0=function(r){if(r.isLeafNode()){const t=r.val();Z(typeof t=="string"||typeof t=="number"||typeof t=="object"&&Kn(t,".sv"),"Priority must be a string or number.")}else Z(r===xf||r.isEmpty(),"priority of unexpected type.");Z(r===xf||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ub;class Ee{static set __childrenNodeConstructor(t){Ub=t}static get __childrenNodeConstructor(){return Ub}constructor(t,e=Ee.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,Z(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),O0(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Ee(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:Ee.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return xt(t)?this:wt(t)===".priority"?this.priorityNode_:Ee.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return t===".priority"?this.updatePriority(e):e.isEmpty()&&t!==".priority"?this:Ee.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const n=wt(t);return n===null?e:e.isEmpty()&&n!==".priority"?this:(Z(n!==".priority"||ts(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,Ee.__childrenNodeConstructor.EMPTY_NODE.updateChild(Yt(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+N0(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",e==="number"?t+=c0(this.value_):t+=this.value_,this.lazyHash_=o0(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Ee.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Ee.__childrenNodeConstructor?-1:(Z(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,n=typeof this.value_,s=Ee.VALUE_TYPE_ORDER.indexOf(e),o=Ee.VALUE_TYPE_ORDER.indexOf(n);return Z(s>=0,"Unknown leaf type: "+e),Z(o>=0,"Unknown leaf type: "+n),s===o?n==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}else return!1}}Ee.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let k0,L0;function Qx(r){k0=r}function Zx(r){L0=r}class Jx extends ou{compare(t,e){const n=t.node.getPriority(),s=e.node.getPriority(),o=n.compareTo(s);return o===0?Us(t.name,e.name):o}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return Rt.MIN}maxPost(){return new Rt(Ls,new Ee("[PRIORITY-POST]",L0))}makePost(t,e){const n=k0(t);return new Rt(e,new Ee("[PRIORITY-POST]",n))}toString(){return".priority"}}const ee=new Jx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tR=Math.log(2);class eR{constructor(t){const e=o=>parseInt(Math.log(o)/tR,10),n=o=>parseInt(Array(o+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const s=n(this.count);this.bits_=t+1&s}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Bc=function(r,t,e,n){r.sort(t);const s=function(d,f){const g=f-d;let _,y;if(g===0)return null;if(g===1)return _=r[d],y=e?e(_):_,new we(y,_.node,we.BLACK,null,null);{const b=parseInt(g/2,10)+d,A=s(d,b),S=s(b+1,f);return _=r[b],y=e?e(_):_,new we(y,_.node,we.BLACK,A,S)}},o=function(d){let f=null,g=null,_=r.length;const y=function(A,S){const C=_-A,w=_;_-=A;const N=s(C+1,w),x=r[C],M=e?e(x):x;b(new we(M,x.node,S,null,N))},b=function(A){f?(f.left=A,f=A):(g=A,f=A)};for(let A=0;A<d.count;++A){const S=d.nextBitIsOne(),C=Math.pow(2,d.count-(A+1));S?y(C,we.BLACK):(y(C,we.BLACK),y(C,we.RED))}return g},c=new eR(r.length),h=o(c);return new Ze(n||t,h)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qd;const Ma={};class mi{static get Default(){return Z(Ma&&ee,"ChildrenNode.ts has not been loaded"),Qd=Qd||new mi({".priority":Ma},{".priority":ee}),Qd}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=Ka(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Ze?e:null}hasIndex(t){return Kn(this.indexSet_,t.toString())}addIndex(t,e){Z(t!==qa,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let s=!1;const o=e.getIterator(Rt.Wrap);let c=o.getNext();for(;c;)s=s||t.isDefinedOn(c.node),n.push(c),c=o.getNext();let h;s?h=Bc(n,t.getCompare()):h=Ma;const d=t.toString(),f={...this.indexSet_};f[d]=t;const g={...this.indexes_};return g[d]=h,new mi(g,f)}addToIndexes(t,e){const n=Nc(this.indexes_,(s,o)=>{const c=Ka(this.indexSet_,o);if(Z(c,"Missing index implementation for "+o),s===Ma)if(c.isDefinedOn(t.node)){const h=[],d=e.getIterator(Rt.Wrap);let f=d.getNext();for(;f;)f.name!==t.name&&h.push(f),f=d.getNext();return h.push(t),Bc(h,c.getCompare())}else return Ma;else{const h=e.get(t.name);let d=s;return h&&(d=d.remove(new Rt(t.name,h))),d.insert(t,t.node)}});return new mi(n,this.indexSet_)}removeFromIndexes(t,e){const n=Nc(this.indexes_,s=>{if(s===Ma)return s;{const o=e.get(t.name);return o?s.remove(new Rt(t.name,o)):s}});return new mi(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let po;class mt{static get EMPTY_NODE(){return po||(po=new mt(new Ze(hp),null,mi.Default))}constructor(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&O0(this.priorityNode_),this.children_.isEmpty()&&Z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||po}updatePriority(t){return this.children_.isEmpty()?this:new mt(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{const e=this.children_.get(t);return e===null?po:e}}getChild(t){const e=wt(t);return e===null?this:this.getImmediateChild(e).getChild(Yt(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,e){if(Z(e,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(e);{const n=new Rt(t,e);let s,o;e.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(n,this.children_)):(s=this.children_.insert(t,e),o=this.indexMap_.addToIndexes(n,this.children_));const c=s.isEmpty()?po:this.priorityNode_;return new mt(s,c,o)}}updateChild(t,e){const n=wt(t);if(n===null)return e;{Z(wt(t)!==".priority"||ts(t)===1,".priority must be the last token in a path");const s=this.getImmediateChild(n).updateChild(Yt(t),e);return this.updateImmediateChild(n,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,s=0,o=!0;if(this.forEachChild(ee,(c,h)=>{e[c]=h.val(t),n++,o&&mt.INTEGER_REGEXP_.test(c)?s=Math.max(s,Number(c)):o=!1}),!t&&o&&s<2*n){const c=[];for(const h in e)c[h]=e[h];return c}else return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+N0(this.getPriority().val())+":"),this.forEachChild(ee,(e,n)=>{const s=n.hash();s!==""&&(t+=":"+e+":"+s)}),this.lazyHash_=t===""?"":o0(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const s=this.resolveIndex_(n);if(s){const o=s.getPredecessorKey(new Rt(t,e));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const n=e.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new Rt(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const n=e.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new Rt(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal(s=>e(s.name,s.node)):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,s=>s);{const s=this.children_.getIteratorFrom(t.name,Rt.Wrap);let o=s.peek();for(;o!=null&&e.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,s=>s);{const s=this.children_.getReverseIteratorFrom(t.name,Rt.Wrap);let o=s.peek();for(;o!=null&&e.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ko?-1:0}withIndex(t){if(t===qa||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new mt(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===qa||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority()))if(this.children_.count()===e.children_.count()){const n=this.getIterator(ee),s=e.getIterator(ee);let o=n.getNext(),c=s.getNext();for(;o&&c;){if(o.name!==c.name||!o.node.equals(c.node))return!1;o=n.getNext(),c=s.getNext()}return o===null&&c===null}else return!1;else return!1}}resolveIndex_(t){return t===qa?null:this.indexMap_.get(t.toString())}}mt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class nR extends mt{constructor(){super(new Ze(hp),mt.EMPTY_NODE,mi.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return mt.EMPTY_NODE}isEmpty(){return!1}}const Ko=new nR;Object.defineProperties(Rt,{MIN:{value:new Rt(Za,mt.EMPTY_NODE)},MAX:{value:new Rt(Ls,Ko)}});M0.__EMPTY_NODE=mt.EMPTY_NODE;Ee.__childrenNodeConstructor=mt;Kx(Ko);Zx(Ko);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR=!0;function pe(r,t=null){if(r===null)return mt.EMPTY_NODE;if(typeof r=="object"&&".priority"in r&&(t=r[".priority"]),Z(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof r=="object"&&".value"in r&&r[".value"]!==null&&(r=r[".value"]),typeof r!="object"||".sv"in r){const e=r;return new Ee(e,pe(t))}if(!(r instanceof Array)&&iR){const e=[];let n=!1;if(Be(r,(c,h)=>{if(c.substring(0,1)!=="."){const d=pe(h);d.isEmpty()||(n=n||!d.getPriority().isEmpty(),e.push(new Rt(c,d)))}}),e.length===0)return mt.EMPTY_NODE;const o=Bc(e,Wx,c=>c.name,hp);if(n){const c=Bc(e,ee.getCompare());return new mt(o,pe(t),new mi({".priority":c},{".priority":ee}))}else return new mt(o,pe(t),mi.Default)}else{let e=mt.EMPTY_NODE;return Be(r,(n,s)=>{if(Kn(r,n)&&n.substring(0,1)!=="."){const o=pe(s);(o.isLeafNode()||!o.isEmpty())&&(e=e.updateImmediateChild(n,o))}}),e.updatePriority(pe(t))}}Qx(pe);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR extends ou{constructor(t){super(),this.indexPath_=t,Z(!xt(t)&&wt(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),s=this.extractChild(e.node),o=n.compareTo(s);return o===0?Us(t.name,e.name):o}makePost(t,e){const n=pe(t),s=mt.EMPTY_NODE.updateChild(this.indexPath_,n);return new Rt(e,s)}maxPost(){const t=mt.EMPTY_NODE.updateChild(this.indexPath_,Ko);return new Rt(Ls,t)}toString(){return Lo(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR extends ou{compare(t,e){const n=t.node.compareTo(e.node);return n===0?Us(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return Rt.MIN}maxPost(){return Rt.MAX}makePost(t,e){const n=pe(t);return new Rt(e,n)}toString(){return".value"}}const rR=new aR;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I0(r){return{type:"value",snapshotNode:r}}function Ja(r,t){return{type:"child_added",snapshotNode:t,childName:r}}function Io(r,t){return{type:"child_removed",snapshotNode:t,childName:r}}function Po(r,t,e){return{type:"child_changed",snapshotNode:t,childName:r,oldSnap:e}}function oR(r,t){return{type:"child_moved",snapshotNode:t,childName:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(t){this.index_=t}updateChild(t,e,n,s,o,c){Z(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=t.getImmediateChild(e);return h.getChild(s).equals(n.getChild(s))&&h.isEmpty()===n.isEmpty()||(c!=null&&(n.isEmpty()?t.hasChild(e)?c.trackChildChange(Io(e,h)):Z(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(Ja(e,n)):c.trackChildChange(Po(e,n,h))),t.isLeafNode()&&n.isEmpty())?t:t.updateImmediateChild(e,n).withIndex(this.index_)}updateFullNode(t,e,n){return n!=null&&(t.isLeafNode()||t.forEachChild(ee,(s,o)=>{e.hasChild(s)||n.trackChildChange(Io(s,o))}),e.isLeafNode()||e.forEachChild(ee,(s,o)=>{if(t.hasChild(s)){const c=t.getImmediateChild(s);c.equals(o)||n.trackChildChange(Po(s,o,c))}else n.trackChildChange(Ja(s,o))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?mt.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(t){this.indexedFilter_=new dp(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Bo.getStartPost_(t),this.endPost_=Bo.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,n=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&n}updateChild(t,e,n,s,o,c){return this.matches(new Rt(e,n))||(n=mt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,s,o,c)}updateFullNode(t,e,n){e.isLeafNode()&&(e=mt.EMPTY_NODE);let s=e.withIndex(this.index_);s=s.updatePriority(mt.EMPTY_NODE);const o=this;return e.forEachChild(ee,(c,h)=>{o.matches(new Rt(c,h))||(s=s.updateImmediateChild(c,mt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,s,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}else return t.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=e=>{const n=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new Bo(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,n,s,o,c){return this.rangedFilter_.matches(new Rt(e,n))||(n=mt.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,s,o,c):this.fullLimitUpdateChild_(t,e,n,o,c)}updateFullNode(t,e,n){let s;if(e.isLeafNode()||e.isEmpty())s=mt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<e.numChildren()&&e.isIndexed(this.index_)){s=mt.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;o.hasNext()&&c<this.limit_;){const h=o.getNext();if(this.withinDirectionalStart(h))if(this.withinDirectionalEnd(h))s=s.updateImmediateChild(h.name,h.node),c++;else break;else continue}}else{s=e.withIndex(this.index_),s=s.updatePriority(mt.EMPTY_NODE);let o;this.reverse_?o=s.getReverseIterator(this.index_):o=s.getIterator(this.index_);let c=0;for(;o.hasNext();){const h=o.getNext();c<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?c++:s=s.updateImmediateChild(h.name,mt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,s,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,n,s,o){let c;if(this.reverse_){const _=this.index_.getCompare();c=(y,b)=>_(b,y)}else c=this.index_.getCompare();const h=t;Z(h.numChildren()===this.limit_,"");const d=new Rt(e,n),f=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),g=this.rangedFilter_.matches(d);if(h.hasChild(e)){const _=h.getImmediateChild(e);let y=s.getChildAfterChild(this.index_,f,this.reverse_);for(;y!=null&&(y.name===e||h.hasChild(y.name));)y=s.getChildAfterChild(this.index_,y,this.reverse_);const b=y==null?1:c(y,d);if(g&&!n.isEmpty()&&b>=0)return o?.trackChildChange(Po(e,n,_)),h.updateImmediateChild(e,n);{o?.trackChildChange(Io(e,_));const S=h.updateImmediateChild(e,mt.EMPTY_NODE);return y!=null&&this.rangedFilter_.matches(y)?(o?.trackChildChange(Ja(y.name,y.node)),S.updateImmediateChild(y.name,y.node)):S}}else return n.isEmpty()?t:g&&c(f,d)>=0?(o!=null&&(o.trackChildChange(Io(f.name,f.node)),o.trackChildChange(Ja(e,n))),h.updateImmediateChild(e,n).updateImmediateChild(f.name,mt.EMPTY_NODE)):t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ee}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Z(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Za}hasEnd(){return this.endSet_}getIndexEndValue(){return Z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Z(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ls}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ee}copy(){const t=new fp;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function cR(r){return r.loadsAllData()?new dp(r.getIndex()):r.hasLimit()?new lR(r):new Bo(r)}function jb(r){const t={};if(r.isDefault())return t;let e;if(r.index_===ee?e="$priority":r.index_===rR?e="$value":r.index_===qa?e="$key":(Z(r.index_ instanceof sR,"Unrecognized index type!"),e=r.index_.toString()),t.orderBy=Ce(e),r.startSet_){const n=r.startAfterSet_?"startAfter":"startAt";t[n]=Ce(r.indexStartValue_),r.startNameSet_&&(t[n]+=","+Ce(r.indexStartName_))}if(r.endSet_){const n=r.endBeforeSet_?"endBefore":"endAt";t[n]=Ce(r.indexEndValue_),r.endNameSet_&&(t[n]+=","+Ce(r.indexEndName_))}return r.limitSet_&&(r.isViewFromLeft()?t.limitToFirst=r.limit_:t.limitToLast=r.limit_),t}function Gb(r){const t={};if(r.startSet_&&(t.sp=r.indexStartValue_,r.startNameSet_&&(t.sn=r.indexStartName_),t.sin=!r.startAfterSet_),r.endSet_&&(t.ep=r.indexEndValue_,r.endNameSet_&&(t.en=r.indexEndName_),t.ein=!r.endBeforeSet_),r.limitSet_){t.l=r.limit_;let e=r.viewFrom_;e===""&&(r.isViewFromLeft()?e="l":e="r"),t.vf=e}return r.index_!==ee&&(t.i=r.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc extends T0{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(Z(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,n,s){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=s,this.log_=Wo("p:rest:"),this.listens_={}}listen(t,e,n,s){const o=t._path.toString();this.log_("Listen called for "+o+" "+t._queryIdentifier);const c=Fc.getListenId_(t,n),h={};this.listens_[c]=h;const d=jb(t._queryParams);this.restRequest_(o+".json",d,(f,g)=>{let _=g;if(f===404&&(_=null,f=null),f===null&&this.onDataUpdate_(o,_,!1,n),Ka(this.listens_,c)===h){let y;f?f===401?y="permission_denied":y="rest_error:"+f:y="ok",s(y,null)}})}unlisten(t,e){const n=Fc.getListenId_(t,e);delete this.listens_[n]}get(t){const e=jb(t._queryParams),n=t._path.toString(),s=new gi;return this.restRequest_(n+".json",e,(o,c)=>{let h=c;o===404&&(h=null,o=null),o===null?(this.onDataUpdate_(n,h,!1,null),s.resolve(h)):s.reject(new Error(h))}),s.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,o])=>{s&&s.accessToken&&(e.auth=s.accessToken),o&&o.token&&(e.ac=o.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+kC(e);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(n&&h.readyState===4){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let d=null;if(h.status>=200&&h.status<300){try{d=Mo(h.responseText)}catch{Je("Failed to parse JSON response for "+c+": "+h.responseText)}n(null,d)}else h.status!==401&&h.status!==404&&Je("Got unsuccessful REST response for "+c+" Status: "+h.status),n(h.status);n=null}},h.open("GET",c,!0),h.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(){this.rootNode_=mt.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hc(){return{value:null,children:new Map}}function sr(r,t,e){if(xt(t))r.value=e,r.children.clear();else if(r.value!==null)r.value=r.value.updateChild(t,e);else{const n=wt(t);r.children.has(n)||r.children.set(n,Hc());const s=r.children.get(n);t=Yt(t),sr(s,t,e)}}function Rf(r,t){if(xt(t))return r.value=null,r.children.clear(),!0;if(r.value!==null){if(r.value.isLeafNode())return!1;{const e=r.value;return r.value=null,e.forEachChild(ee,(n,s)=>{sr(r,new zt(n),s)}),Rf(r,t)}}else if(r.children.size>0){const e=wt(t);return t=Yt(t),r.children.has(e)&&Rf(r.children.get(e),t)&&r.children.delete(e),r.children.size===0}else return!0}function Df(r,t,e){r.value!==null?e(t,r.value):hR(r,(n,s)=>{const o=new zt(t.toString()+"/"+n);Df(s,o,e)})}function hR(r,t){r.children.forEach((e,n)=>{t(n,e)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e={...t};return this.last_&&Be(this.last_,(n,s)=>{e[n]=e[n]-s}),this.last_=t,e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vb=10*1e3,fR=30*1e3,pR=300*1e3;class gR{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new dR(t);const n=Vb+(fR-Vb)*Math.random();So(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;Be(t,(s,o)=>{o>0&&Kn(this.statsToReport_,s)&&(e[s]=o,n=!0)}),n&&this.server_.reportStats(e),So(this.reportStats_.bind(this),Math.floor(Math.random()*2*pR))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kn;(function(r){r[r.OVERWRITE=0]="OVERWRITE",r[r.MERGE=1]="MERGE",r[r.ACK_USER_WRITE=2]="ACK_USER_WRITE",r[r.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(kn||(kn={}));function P0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function pp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function gp(r){return{fromUser:!1,fromServer:!0,queryId:r,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=kn.ACK_USER_WRITE,this.source=P0()}operationForChild(t){if(xt(this.path)){if(this.affectedTree.value!=null)return Z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new zt(t));return new zc(Pt(),e,this.revert)}}else return Z(wt(this.path)===t,"operationForChild called for unrelated child."),new zc(Yt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(t,e){this.source=t,this.path=e,this.type=kn.LISTEN_COMPLETE}operationForChild(t){return xt(this.path)?new Fo(this.source,Pt()):new Fo(this.source,Yt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=kn.OVERWRITE}operationForChild(t){return xt(this.path)?new Is(this.source,Pt(),this.snap.getImmediateChild(t)):new Is(this.source,Yt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=kn.MERGE}operationForChild(t){if(xt(this.path)){const e=this.children.subtree(new zt(t));return e.isEmpty()?null:e.value?new Is(this.source,Pt(),e.value):new Ho(this.source,Pt(),e)}else return Z(wt(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new Ho(this.source,Yt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(xt(t))return this.isFullyInitialized()&&!this.filtered_;const e=wt(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function _R(r,t,e,n){const s=[],o=[];return t.forEach(c=>{c.type==="child_changed"&&r.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&o.push(oR(c.childName,c.snapshotNode))}),go(r,s,"child_removed",t,n,e),go(r,s,"child_added",t,n,e),go(r,s,"child_moved",o,n,e),go(r,s,"child_changed",t,n,e),go(r,s,"value",t,n,e),s}function go(r,t,e,n,s,o){const c=n.filter(h=>h.type===e);c.sort((h,d)=>bR(r,h,d)),c.forEach(h=>{const d=yR(r,h,o);s.forEach(f=>{f.respondsTo(h.type)&&t.push(f.createEvent(d,r.query_))})})}function yR(r,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,r.index_)),t}function bR(r,t,e){if(t.childName==null||e.childName==null)throw nr("Should only compare child_ events.");const n=new Rt(t.childName,t.snapshotNode),s=new Rt(e.childName,e.snapshotNode);return r.index_.compare(n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(r,t){return{eventCache:r,serverCache:t}}function Eo(r,t,e,n){return lu(new Ps(t,e,n),r.serverCache)}function B0(r,t,e,n){return lu(r.eventCache,new Ps(t,e,n))}function Mf(r){return r.eventCache.isFullyInitialized()?r.eventCache.getNode():null}function Bs(r){return r.serverCache.isFullyInitialized()?r.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zd;const vR=()=>(Zd||(Zd=new Ze(sx)),Zd);class Wt{static fromObject(t){let e=new Wt(null);return Be(t,(n,s)=>{e=e.set(new zt(n),s)}),e}constructor(t,e=vR()){this.value=t,this.children=e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:Pt(),value:this.value};if(xt(t))return null;{const n=wt(t),s=this.children.get(n);if(s!==null){const o=s.findRootMostMatchingPathAndValue(Yt(t),e);return o!=null?{path:oe(new zt(n),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(xt(t))return this;{const e=wt(t),n=this.children.get(e);return n!==null?n.subtree(Yt(t)):new Wt(null)}}set(t,e){if(xt(t))return new Wt(e,this.children);{const n=wt(t),o=(this.children.get(n)||new Wt(null)).set(Yt(t),e),c=this.children.insert(n,o);return new Wt(this.value,c)}}remove(t){if(xt(t))return this.children.isEmpty()?new Wt(null):new Wt(null,this.children);{const e=wt(t),n=this.children.get(e);if(n){const s=n.remove(Yt(t));let o;return s.isEmpty()?o=this.children.remove(e):o=this.children.insert(e,s),this.value===null&&o.isEmpty()?new Wt(null):new Wt(this.value,o)}else return this}}get(t){if(xt(t))return this.value;{const e=wt(t),n=this.children.get(e);return n?n.get(Yt(t)):null}}setTree(t,e){if(xt(t))return e;{const n=wt(t),o=(this.children.get(n)||new Wt(null)).setTree(Yt(t),e);let c;return o.isEmpty()?c=this.children.remove(n):c=this.children.insert(n,o),new Wt(this.value,c)}}fold(t){return this.fold_(Pt(),t)}fold_(t,e){const n={};return this.children.inorderTraversal((s,o)=>{n[s]=o.fold_(oe(t,s),e)}),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,Pt(),e)}findOnPath_(t,e,n){const s=this.value?n(e,this.value):!1;if(s)return s;if(xt(t))return null;{const o=wt(t),c=this.children.get(o);return c?c.findOnPath_(Yt(t),oe(e,o),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Pt(),e)}foreachOnPath_(t,e,n){if(xt(t))return this;{this.value&&n(e,this.value);const s=wt(t),o=this.children.get(s);return o?o.foreachOnPath_(Yt(t),oe(e,s),n):new Wt(null)}}foreach(t){this.foreach_(Pt(),t)}foreach_(t,e){this.children.inorderTraversal((n,s)=>{s.foreach_(oe(t,n),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,n)=>{n.value&&t(e,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(t){this.writeTree_=t}static empty(){return new Ln(new Wt(null))}}function wo(r,t,e){if(xt(t))return new Ln(new Wt(e));{const n=r.writeTree_.findRootMostValueAndPath(t);if(n!=null){const s=n.path;let o=n.value;const c=Qe(s,t);return o=o.updateChild(c,e),new Ln(r.writeTree_.set(s,o))}else{const s=new Wt(e),o=r.writeTree_.setTree(t,s);return new Ln(o)}}}function qb(r,t,e){let n=r;return Be(e,(s,o)=>{n=wo(n,oe(t,s),o)}),n}function Yb(r,t){if(xt(t))return Ln.empty();{const e=r.writeTree_.setTree(t,new Wt(null));return new Ln(e)}}function Nf(r,t){return js(r,t)!=null}function js(r,t){const e=r.writeTree_.findRootMostValueAndPath(t);return e!=null?r.writeTree_.get(e.path).getChild(Qe(e.path,t)):null}function Xb(r){const t=[],e=r.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(ee,(n,s)=>{t.push(new Rt(n,s))}):r.writeTree_.children.inorderTraversal((n,s)=>{s.value!=null&&t.push(new Rt(n,s.value))}),t}function Qi(r,t){if(xt(t))return r;{const e=js(r,t);return e!=null?new Ln(new Wt(e)):new Ln(r.writeTree_.subtree(t))}}function Of(r){return r.writeTree_.isEmpty()}function tr(r,t){return F0(Pt(),r.writeTree_,t)}function F0(r,t,e){if(t.value!=null)return e.updateChild(r,t.value);{let n=null;return t.children.inorderTraversal((s,o)=>{s===".priority"?(Z(o.value!==null,"Priority writes must always be leaf nodes"),n=o.value):e=F0(oe(r,s),o,e)}),!e.getChild(r).isEmpty()&&n!==null&&(e=e.updateChild(oe(r,".priority"),n)),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mp(r,t){return j0(t,r)}function AR(r,t,e,n,s){Z(n>r.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),r.allWrites.push({path:t,snap:e,writeId:n,visible:s}),s&&(r.visibleWrites=wo(r.visibleWrites,t,e)),r.lastWriteId=n}function SR(r,t){for(let e=0;e<r.allWrites.length;e++){const n=r.allWrites[e];if(n.writeId===t)return n}return null}function ER(r,t){const e=r.allWrites.findIndex(h=>h.writeId===t);Z(e>=0,"removeWrite called with nonexistent writeId.");const n=r.allWrites[e];r.allWrites.splice(e,1);let s=n.visible,o=!1,c=r.allWrites.length-1;for(;s&&c>=0;){const h=r.allWrites[c];h.visible&&(c>=e&&wR(h,n.path)?s=!1:Tn(n.path,h.path)&&(o=!0)),c--}if(s){if(o)return CR(r),!0;if(n.snap)r.visibleWrites=Yb(r.visibleWrites,n.path);else{const h=n.children;Be(h,d=>{r.visibleWrites=Yb(r.visibleWrites,oe(n.path,d))})}return!0}else return!1}function wR(r,t){if(r.snap)return Tn(r.path,t);for(const e in r.children)if(r.children.hasOwnProperty(e)&&Tn(oe(r.path,e),t))return!0;return!1}function CR(r){r.visibleWrites=H0(r.allWrites,TR,Pt()),r.allWrites.length>0?r.lastWriteId=r.allWrites[r.allWrites.length-1].writeId:r.lastWriteId=-1}function TR(r){return r.visible}function H0(r,t,e){let n=Ln.empty();for(let s=0;s<r.length;++s){const o=r[s];if(t(o)){const c=o.path;let h;if(o.snap)Tn(e,c)?(h=Qe(e,c),n=wo(n,h,o.snap)):Tn(c,e)&&(h=Qe(c,e),n=wo(n,Pt(),o.snap.getChild(h)));else if(o.children){if(Tn(e,c))h=Qe(e,c),n=qb(n,h,o.children);else if(Tn(c,e))if(h=Qe(c,e),xt(h))n=qb(n,Pt(),o.children);else{const d=Ka(o.children,wt(h));if(d){const f=d.getChild(Yt(h));n=wo(n,Pt(),f)}}}else throw nr("WriteRecord should have .snap or .children")}}return n}function z0(r,t,e,n,s){if(!n&&!s){const o=js(r.visibleWrites,t);if(o!=null)return o;{const c=Qi(r.visibleWrites,t);if(Of(c))return e;if(e==null&&!Nf(c,Pt()))return null;{const h=e||mt.EMPTY_NODE;return tr(c,h)}}}else{const o=Qi(r.visibleWrites,t);if(!s&&Of(o))return e;if(!s&&e==null&&!Nf(o,Pt()))return null;{const c=function(f){return(f.visible||s)&&(!n||!~n.indexOf(f.writeId))&&(Tn(f.path,t)||Tn(t,f.path))},h=H0(r.allWrites,c,t),d=e||mt.EMPTY_NODE;return tr(h,d)}}}function xR(r,t,e){let n=mt.EMPTY_NODE;const s=js(r.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(ee,(o,c)=>{n=n.updateImmediateChild(o,c)}),n;if(e){const o=Qi(r.visibleWrites,t);return e.forEachChild(ee,(c,h)=>{const d=tr(Qi(o,new zt(c)),h);n=n.updateImmediateChild(c,d)}),Xb(o).forEach(c=>{n=n.updateImmediateChild(c.name,c.node)}),n}else{const o=Qi(r.visibleWrites,t);return Xb(o).forEach(c=>{n=n.updateImmediateChild(c.name,c.node)}),n}}function RR(r,t,e,n,s){Z(n||s,"Either existingEventSnap or existingServerSnap must exist");const o=oe(t,e);if(Nf(r.visibleWrites,o))return null;{const c=Qi(r.visibleWrites,o);return Of(c)?s.getChild(e):tr(c,s.getChild(e))}}function DR(r,t,e,n){const s=oe(t,e),o=js(r.visibleWrites,s);if(o!=null)return o;if(n.isCompleteForChild(e)){const c=Qi(r.visibleWrites,s);return tr(c,n.getNode().getImmediateChild(e))}else return null}function MR(r,t){return js(r.visibleWrites,t)}function NR(r,t,e,n,s,o,c){let h;const d=Qi(r.visibleWrites,t),f=js(d,Pt());if(f!=null)h=f;else if(e!=null)h=tr(d,e);else return[];if(h=h.withIndex(c),!h.isEmpty()&&!h.isLeafNode()){const g=[],_=c.getCompare(),y=o?h.getReverseIteratorFrom(n,c):h.getIteratorFrom(n,c);let b=y.getNext();for(;b&&g.length<s;)_(b,n)!==0&&g.push(b),b=y.getNext();return g}else return[]}function OR(){return{visibleWrites:Ln.empty(),allWrites:[],lastWriteId:-1}}function Uc(r,t,e,n){return z0(r.writeTree,r.treePath,t,e,n)}function _p(r,t){return xR(r.writeTree,r.treePath,t)}function $b(r,t,e,n){return RR(r.writeTree,r.treePath,t,e,n)}function jc(r,t){return MR(r.writeTree,oe(r.treePath,t))}function kR(r,t,e,n,s,o){return NR(r.writeTree,r.treePath,t,e,n,s,o)}function yp(r,t,e){return DR(r.writeTree,r.treePath,t,e)}function U0(r,t){return j0(oe(r.treePath,t),r.writeTree)}function j0(r,t){return{treePath:r,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,n=t.childName;Z(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),Z(n!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(n);if(s){const o=s.type;if(e==="child_added"&&o==="child_removed")this.changeMap.set(n,Po(n,t.snapshotNode,s.snapshotNode));else if(e==="child_removed"&&o==="child_added")this.changeMap.delete(n);else if(e==="child_removed"&&o==="child_changed")this.changeMap.set(n,Io(n,s.oldSnap));else if(e==="child_changed"&&o==="child_added")this.changeMap.set(n,Ja(n,t.snapshotNode));else if(e==="child_changed"&&o==="child_changed")this.changeMap.set(n,Po(n,t.snapshotNode,s.oldSnap));else throw nr("Illegal combination of changes: "+t+" occurred after "+s)}else this.changeMap.set(n,t)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}}const G0=new IR;class bp{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const n=this.optCompleteServerCache_!=null?new Ps(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return yp(this.writes_,t,n)}}getChildAfterChild(t,e,n){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Bs(this.viewCache_),o=kR(this.writes_,s,e,1,n,t);return o.length===0?null:o[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PR(r){return{filter:r}}function BR(r,t){Z(t.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),Z(t.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed")}function FR(r,t,e,n,s){const o=new LR;let c,h;if(e.type===kn.OVERWRITE){const f=e;f.source.fromUser?c=kf(r,t,f.path,f.snap,n,s,o):(Z(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered()&&!xt(f.path),c=Gc(r,t,f.path,f.snap,n,s,h,o))}else if(e.type===kn.MERGE){const f=e;f.source.fromUser?c=zR(r,t,f.path,f.children,n,s,o):(Z(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered(),c=Lf(r,t,f.path,f.children,n,s,h,o))}else if(e.type===kn.ACK_USER_WRITE){const f=e;f.revert?c=GR(r,t,f.path,n,s,o):c=UR(r,t,f.path,f.affectedTree,n,s,o)}else if(e.type===kn.LISTEN_COMPLETE)c=jR(r,t,e.path,n,o);else throw nr("Unknown operation type: "+e.type);const d=o.getChanges();return HR(t,c,d),{viewCache:c,changes:d}}function HR(r,t,e){const n=t.eventCache;if(n.isFullyInitialized()){const s=n.getNode().isLeafNode()||n.getNode().isEmpty(),o=Mf(r);(e.length>0||!r.eventCache.isFullyInitialized()||s&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&e.push(I0(Mf(t)))}}function V0(r,t,e,n,s,o){const c=t.eventCache;if(jc(n,e)!=null)return t;{let h,d;if(xt(e))if(Z(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const f=Bs(t),g=f instanceof mt?f:mt.EMPTY_NODE,_=_p(n,g);h=r.filter.updateFullNode(t.eventCache.getNode(),_,o)}else{const f=Uc(n,Bs(t));h=r.filter.updateFullNode(t.eventCache.getNode(),f,o)}else{const f=wt(e);if(f===".priority"){Z(ts(e)===1,"Can't have a priority with additional path components");const g=c.getNode();d=t.serverCache.getNode();const _=$b(n,e,g,d);_!=null?h=r.filter.updatePriority(g,_):h=c.getNode()}else{const g=Yt(e);let _;if(c.isCompleteForChild(f)){d=t.serverCache.getNode();const y=$b(n,e,c.getNode(),d);y!=null?_=c.getNode().getImmediateChild(f).updateChild(g,y):_=c.getNode().getImmediateChild(f)}else _=yp(n,f,t.serverCache);_!=null?h=r.filter.updateChild(c.getNode(),f,_,g,s,o):h=c.getNode()}}return Eo(t,h,c.isFullyInitialized()||xt(e),r.filter.filtersNodes())}}function Gc(r,t,e,n,s,o,c,h){const d=t.serverCache;let f;const g=c?r.filter:r.filter.getIndexedFilter();if(xt(e))f=g.updateFullNode(d.getNode(),n,null);else if(g.filtersNodes()&&!d.isFiltered()){const b=d.getNode().updateChild(e,n);f=g.updateFullNode(d.getNode(),b,null)}else{const b=wt(e);if(!d.isCompleteForPath(e)&&ts(e)>1)return t;const A=Yt(e),C=d.getNode().getImmediateChild(b).updateChild(A,n);b===".priority"?f=g.updatePriority(d.getNode(),C):f=g.updateChild(d.getNode(),b,C,A,G0,null)}const _=B0(t,f,d.isFullyInitialized()||xt(e),g.filtersNodes()),y=new bp(s,_,o);return V0(r,_,e,s,y,h)}function kf(r,t,e,n,s,o,c){const h=t.eventCache;let d,f;const g=new bp(s,t,o);if(xt(e))f=r.filter.updateFullNode(t.eventCache.getNode(),n,c),d=Eo(t,f,!0,r.filter.filtersNodes());else{const _=wt(e);if(_===".priority")f=r.filter.updatePriority(t.eventCache.getNode(),n),d=Eo(t,f,h.isFullyInitialized(),h.isFiltered());else{const y=Yt(e),b=h.getNode().getImmediateChild(_);let A;if(xt(y))A=n;else{const S=g.getCompleteChild(_);S!=null?lp(y)===".priority"&&S.getChild(R0(y)).isEmpty()?A=S:A=S.updateChild(y,n):A=mt.EMPTY_NODE}if(b.equals(A))d=t;else{const S=r.filter.updateChild(h.getNode(),_,A,y,g,c);d=Eo(t,S,h.isFullyInitialized(),r.filter.filtersNodes())}}}return d}function Wb(r,t){return r.eventCache.isCompleteForChild(t)}function zR(r,t,e,n,s,o,c){let h=t;return n.foreach((d,f)=>{const g=oe(e,d);Wb(t,wt(g))&&(h=kf(r,h,g,f,s,o,c))}),n.foreach((d,f)=>{const g=oe(e,d);Wb(t,wt(g))||(h=kf(r,h,g,f,s,o,c))}),h}function Kb(r,t,e){return e.foreach((n,s)=>{t=t.updateChild(n,s)}),t}function Lf(r,t,e,n,s,o,c,h){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let d=t,f;xt(e)?f=n:f=new Wt(null).setTree(e,n);const g=t.serverCache.getNode();return f.children.inorderTraversal((_,y)=>{if(g.hasChild(_)){const b=t.serverCache.getNode().getImmediateChild(_),A=Kb(r,b,y);d=Gc(r,d,new zt(_),A,s,o,c,h)}}),f.children.inorderTraversal((_,y)=>{const b=!t.serverCache.isCompleteForChild(_)&&y.value===null;if(!g.hasChild(_)&&!b){const A=t.serverCache.getNode().getImmediateChild(_),S=Kb(r,A,y);d=Gc(r,d,new zt(_),S,s,o,c,h)}}),d}function UR(r,t,e,n,s,o,c){if(jc(s,e)!=null)return t;const h=t.serverCache.isFiltered(),d=t.serverCache;if(n.value!=null){if(xt(e)&&d.isFullyInitialized()||d.isCompleteForPath(e))return Gc(r,t,e,d.getNode().getChild(e),s,o,h,c);if(xt(e)){let f=new Wt(null);return d.getNode().forEachChild(qa,(g,_)=>{f=f.set(new zt(g),_)}),Lf(r,t,e,f,s,o,h,c)}else return t}else{let f=new Wt(null);return n.foreach((g,_)=>{const y=oe(e,g);d.isCompleteForPath(y)&&(f=f.set(g,d.getNode().getChild(y)))}),Lf(r,t,e,f,s,o,h,c)}}function jR(r,t,e,n,s){const o=t.serverCache,c=B0(t,o.getNode(),o.isFullyInitialized()||xt(e),o.isFiltered());return V0(r,c,e,n,G0,s)}function GR(r,t,e,n,s,o){let c;if(jc(n,e)!=null)return t;{const h=new bp(n,t,s),d=t.eventCache.getNode();let f;if(xt(e)||wt(e)===".priority"){let g;if(t.serverCache.isFullyInitialized())g=Uc(n,Bs(t));else{const _=t.serverCache.getNode();Z(_ instanceof mt,"serverChildren would be complete if leaf node"),g=_p(n,_)}g=g,f=r.filter.updateFullNode(d,g,o)}else{const g=wt(e);let _=yp(n,g,t.serverCache);_==null&&t.serverCache.isCompleteForChild(g)&&(_=d.getImmediateChild(g)),_!=null?f=r.filter.updateChild(d,g,_,Yt(e),h,o):t.eventCache.getNode().hasChild(g)?f=r.filter.updateChild(d,g,mt.EMPTY_NODE,Yt(e),h,o):f=d,f.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=Uc(n,Bs(t)),c.isLeafNode()&&(f=r.filter.updateFullNode(f,c,o)))}return c=t.serverCache.isFullyInitialized()||jc(n,Pt())!=null,Eo(t,f,c,r.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const n=this.query_._queryParams,s=new dp(n.getIndex()),o=cR(n);this.processor_=PR(o);const c=e.serverCache,h=e.eventCache,d=s.updateFullNode(mt.EMPTY_NODE,c.getNode(),null),f=o.updateFullNode(mt.EMPTY_NODE,h.getNode(),null),g=new Ps(d,c.isFullyInitialized(),s.filtersNodes()),_=new Ps(f,h.isFullyInitialized(),o.filtersNodes());this.viewCache_=lu(_,g),this.eventGenerator_=new mR(this.query_)}get query(){return this.query_}}function qR(r){return r.viewCache_.serverCache.getNode()}function YR(r,t){const e=Bs(r.viewCache_);return e&&(r.query._queryParams.loadsAllData()||!xt(t)&&!e.getImmediateChild(wt(t)).isEmpty())?e.getChild(t):null}function Qb(r){return r.eventRegistrations_.length===0}function XR(r,t){r.eventRegistrations_.push(t)}function Zb(r,t,e){const n=[];if(e){Z(t==null,"A cancel should cancel all event registrations.");const s=r.query._path;r.eventRegistrations_.forEach(o=>{const c=o.createCancelEvent(e,s);c&&n.push(c)})}if(t){let s=[];for(let o=0;o<r.eventRegistrations_.length;++o){const c=r.eventRegistrations_[o];if(!c.matches(t))s.push(c);else if(t.hasAnyCallback()){s=s.concat(r.eventRegistrations_.slice(o+1));break}}r.eventRegistrations_=s}else r.eventRegistrations_=[];return n}function Jb(r,t,e,n){t.type===kn.MERGE&&t.source.queryId!==null&&(Z(Bs(r.viewCache_),"We should always have a full cache before handling merges"),Z(Mf(r.viewCache_),"Missing event cache, even though we have a server cache"));const s=r.viewCache_,o=FR(r.processor_,s,t,e,n);return BR(r.processor_,o.viewCache),Z(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),r.viewCache_=o.viewCache,q0(r,o.changes,o.viewCache.eventCache.getNode(),null)}function $R(r,t){const e=r.viewCache_.eventCache,n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(ee,(o,c)=>{n.push(Ja(o,c))}),e.isFullyInitialized()&&n.push(I0(e.getNode())),q0(r,n,e.getNode(),t)}function q0(r,t,e,n){const s=n?[n]:r.eventRegistrations_;return _R(r.eventGenerator_,t,e,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vc;class WR{constructor(){this.views=new Map}}function KR(r){Z(!Vc,"__referenceConstructor has already been defined"),Vc=r}function QR(){return Z(Vc,"Reference.ts has not been loaded"),Vc}function ZR(r){return r.views.size===0}function vp(r,t,e,n){const s=t.source.queryId;if(s!==null){const o=r.views.get(s);return Z(o!=null,"SyncTree gave us an op for an invalid query."),Jb(o,t,e,n)}else{let o=[];for(const c of r.views.values())o=o.concat(Jb(c,t,e,n));return o}}function JR(r,t,e,n,s){const o=t._queryIdentifier,c=r.views.get(o);if(!c){let h=Uc(e,s?n:null),d=!1;h?d=!0:n instanceof mt?(h=_p(e,n),d=!1):(h=mt.EMPTY_NODE,d=!1);const f=lu(new Ps(h,d,!1),new Ps(n,s,!1));return new VR(t,f)}return c}function tD(r,t,e,n,s,o){const c=JR(r,t,n,s,o);return r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,c),XR(c,e),$R(c,e)}function eD(r,t,e,n){const s=t._queryIdentifier,o=[];let c=[];const h=es(r);if(s==="default")for(const[d,f]of r.views.entries())c=c.concat(Zb(f,e,n)),Qb(f)&&(r.views.delete(d),f.query._queryParams.loadsAllData()||o.push(f.query));else{const d=r.views.get(s);d&&(c=c.concat(Zb(d,e,n)),Qb(d)&&(r.views.delete(s),d.query._queryParams.loadsAllData()||o.push(d.query)))}return h&&!es(r)&&o.push(new(QR())(t._repo,t._path)),{removed:o,events:c}}function Y0(r){const t=[];for(const e of r.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function Ya(r,t){let e=null;for(const n of r.views.values())e=e||YR(n,t);return e}function X0(r,t){if(t._queryParams.loadsAllData())return cu(r);{const n=t._queryIdentifier;return r.views.get(n)}}function $0(r,t){return X0(r,t)!=null}function es(r){return cu(r)!=null}function cu(r){for(const t of r.views.values())if(t.query._queryParams.loadsAllData())return t;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qc;function nD(r){Z(!qc,"__referenceConstructor has already been defined"),qc=r}function iD(){return Z(qc,"Reference.ts has not been loaded"),qc}let sD=1;class tv{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Wt(null),this.pendingWriteTree_=OR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function W0(r,t,e,n,s){return AR(r.pendingWriteTree_,t,e,n,s),s?Qo(r,new Is(P0(),t,e)):[]}function xs(r,t,e=!1){const n=SR(r.pendingWriteTree_,t);if(ER(r.pendingWriteTree_,t)){let o=new Wt(null);return n.snap!=null?o=o.set(Pt(),!0):Be(n.children,c=>{o=o.set(new zt(c),!0)}),Qo(r,new zc(n.path,o,e))}else return[]}function uu(r,t,e){return Qo(r,new Is(pp(),t,e))}function aD(r,t,e){const n=Wt.fromObject(e);return Qo(r,new Ho(pp(),t,n))}function rD(r,t){return Qo(r,new Fo(pp(),t))}function oD(r,t,e){const n=Sp(r,e);if(n){const s=Ep(n),o=s.path,c=s.queryId,h=Qe(o,t),d=new Fo(gp(c),h);return wp(r,o,d)}else return[]}function If(r,t,e,n,s=!1){const o=t._path,c=r.syncPointTree_.get(o);let h=[];if(c&&(t._queryIdentifier==="default"||$0(c,t))){const d=eD(c,t,e,n);ZR(c)&&(r.syncPointTree_=r.syncPointTree_.remove(o));const f=d.removed;if(h=d.events,!s){const g=f.findIndex(y=>y._queryParams.loadsAllData())!==-1,_=r.syncPointTree_.findOnPath(o,(y,b)=>es(b));if(g&&!_){const y=r.syncPointTree_.subtree(o);if(!y.isEmpty()){const b=uD(y);for(let A=0;A<b.length;++A){const S=b[A],C=S.query,w=Z0(r,S);r.listenProvider_.startListening(Co(C),Yc(r,C),w.hashFn,w.onComplete)}}}!_&&f.length>0&&!n&&(g?r.listenProvider_.stopListening(Co(t),null):f.forEach(y=>{const b=r.queryToTagMap.get(hu(y));r.listenProvider_.stopListening(Co(y),b)}))}hD(r,f)}return h}function lD(r,t,e,n){const s=Sp(r,n);if(s!=null){const o=Ep(s),c=o.path,h=o.queryId,d=Qe(c,t),f=new Is(gp(h),d,e);return wp(r,c,f)}else return[]}function cD(r,t,e,n){const s=Sp(r,n);if(s){const o=Ep(s),c=o.path,h=o.queryId,d=Qe(c,t),f=Wt.fromObject(e),g=new Ho(gp(h),d,f);return wp(r,c,g)}else return[]}function ev(r,t,e,n=!1){const s=t._path;let o=null,c=!1;r.syncPointTree_.foreachOnPath(s,(y,b)=>{const A=Qe(y,s);o=o||Ya(b,A),c=c||es(b)});let h=r.syncPointTree_.get(s);h?(c=c||es(h),o=o||Ya(h,Pt())):(h=new WR,r.syncPointTree_=r.syncPointTree_.set(s,h));let d;o!=null?d=!0:(d=!1,o=mt.EMPTY_NODE,r.syncPointTree_.subtree(s).foreachChild((b,A)=>{const S=Ya(A,Pt());S&&(o=o.updateImmediateChild(b,S))}));const f=$0(h,t);if(!f&&!t._queryParams.loadsAllData()){const y=hu(t);Z(!r.queryToTagMap.has(y),"View does not exist, but we have a tag");const b=dD();r.queryToTagMap.set(y,b),r.tagToQueryMap.set(b,y)}const g=mp(r.pendingWriteTree_,s);let _=tD(h,t,e,g,o,d);if(!f&&!c&&!n){const y=X0(h,t);_=_.concat(fD(r,t,y))}return _}function Ap(r,t,e){const s=r.pendingWriteTree_,o=r.syncPointTree_.findOnPath(t,(c,h)=>{const d=Qe(c,t),f=Ya(h,d);if(f)return f});return z0(s,t,o,e,!0)}function Qo(r,t){return K0(t,r.syncPointTree_,null,mp(r.pendingWriteTree_,Pt()))}function K0(r,t,e,n){if(xt(r.path))return Q0(r,t,e,n);{const s=t.get(Pt());e==null&&s!=null&&(e=Ya(s,Pt()));let o=[];const c=wt(r.path),h=r.operationForChild(c),d=t.children.get(c);if(d&&h){const f=e?e.getImmediateChild(c):null,g=U0(n,c);o=o.concat(K0(h,d,f,g))}return s&&(o=o.concat(vp(s,r,n,e))),o}}function Q0(r,t,e,n){const s=t.get(Pt());e==null&&s!=null&&(e=Ya(s,Pt()));let o=[];return t.children.inorderTraversal((c,h)=>{const d=e?e.getImmediateChild(c):null,f=U0(n,c),g=r.operationForChild(c);g&&(o=o.concat(Q0(g,h,d,f)))}),s&&(o=o.concat(vp(s,r,n,e))),o}function Z0(r,t){const e=t.query,n=Yc(r,e);return{hashFn:()=>(qR(t)||mt.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return n?oD(r,e._path,n):rD(r,e._path);{const o=ox(s,e);return If(r,e,null,o)}}}}function Yc(r,t){const e=hu(t);return r.queryToTagMap.get(e)}function hu(r){return r._path.toString()+"$"+r._queryIdentifier}function Sp(r,t){return r.tagToQueryMap.get(t)}function Ep(r){const t=r.indexOf("$");return Z(t!==-1&&t<r.length-1,"Bad queryKey."),{queryId:r.substr(t+1),path:new zt(r.substr(0,t))}}function wp(r,t,e){const n=r.syncPointTree_.get(t);Z(n,"Missing sync point for query tag that we're tracking");const s=mp(r.pendingWriteTree_,t);return vp(n,e,s,null)}function uD(r){return r.fold((t,e,n)=>{if(e&&es(e))return[cu(e)];{let s=[];return e&&(s=Y0(e)),Be(n,(o,c)=>{s=s.concat(c)}),s}})}function Co(r){return r._queryParams.loadsAllData()&&!r._queryParams.isDefault()?new(iD())(r._repo,r._path):r}function hD(r,t){for(let e=0;e<t.length;++e){const n=t[e];if(!n._queryParams.loadsAllData()){const s=hu(n),o=r.queryToTagMap.get(s);r.queryToTagMap.delete(s),r.tagToQueryMap.delete(o)}}}function dD(){return sD++}function fD(r,t,e){const n=t._path,s=Yc(r,t),o=Z0(r,e),c=r.listenProvider_.startListening(Co(t),s,o.hashFn,o.onComplete),h=r.syncPointTree_.subtree(n);if(s)Z(!es(h.value),"If we're adding a query, it shouldn't be shadowed");else{const d=h.fold((f,g,_)=>{if(!xt(f)&&g&&es(g))return[cu(g).query];{let y=[];return g&&(y=y.concat(Y0(g).map(b=>b.query))),Be(_,(b,A)=>{y=y.concat(A)}),y}});for(let f=0;f<d.length;++f){const g=d[f];r.listenProvider_.stopListening(Co(g),Yc(r,g))}}return c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Cp(e)}node(){return this.node_}}class Tp{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=oe(this.path_,t);return new Tp(this.syncTree_,e)}node(){return Ap(this.syncTree_,this.path_)}}const pD=function(r){return r=r||{},r.timestamp=r.timestamp||new Date().getTime(),r},nv=function(r,t,e){if(!r||typeof r!="object")return r;if(Z(".sv"in r,"Unexpected leaf node or priority contents"),typeof r[".sv"]=="string")return gD(r[".sv"],t,e);if(typeof r[".sv"]=="object")return mD(r[".sv"],t);Z(!1,"Unexpected server value: "+JSON.stringify(r,null,2))},gD=function(r,t,e){switch(r){case"timestamp":return e.timestamp;default:Z(!1,"Unexpected server value: "+r)}},mD=function(r,t,e){r.hasOwnProperty("increment")||Z(!1,"Unexpected server value: "+JSON.stringify(r,null,2));const n=r.increment;typeof n!="number"&&Z(!1,"Unexpected increment value: "+n);const s=t.node();if(Z(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return n;const c=s.getValue();return typeof c!="number"?n:c+n},_D=function(r,t,e,n){return xp(t,new Tp(e,r),n)},J0=function(r,t,e){return xp(r,new Cp(t),e)};function xp(r,t,e){const n=r.getPriority().val(),s=nv(n,t.getImmediateChild(".priority"),e);let o;if(r.isLeafNode()){const c=r,h=nv(c.getValue(),t,e);return h!==c.getValue()||s!==c.getPriority().val()?new Ee(h,pe(s)):r}else{const c=r;return o=c,s!==c.getPriority().val()&&(o=o.updatePriority(new Ee(s))),c.forEachChild(ee,(h,d)=>{const f=xp(d,t.getImmediateChild(h),e);f!==d&&(o=o.updateImmediateChild(h,f))}),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function Dp(r,t){let e=t instanceof zt?t:new zt(t),n=r,s=wt(e);for(;s!==null;){const o=Ka(n.node.children,s)||{children:{},childCount:0};n=new Rp(s,n,o),e=Yt(e),s=wt(e)}return n}function ar(r){return r.node.value}function tA(r,t){r.node.value=t,Pf(r)}function eA(r){return r.node.childCount>0}function yD(r){return ar(r)===void 0&&!eA(r)}function du(r,t){Be(r.node.children,(e,n)=>{t(new Rp(e,r,n))})}function nA(r,t,e,n){e&&t(r),du(r,s=>{nA(s,t,!0)})}function bD(r,t,e){let n=r.parent;for(;n!==null;){if(t(n))return!0;n=n.parent}return!1}function Zo(r){return new zt(r.parent===null?r.name:Zo(r.parent)+"/"+r.name)}function Pf(r){r.parent!==null&&vD(r.parent,r.name,r)}function vD(r,t,e){const n=yD(e),s=Kn(r.node.children,t);n&&s?(delete r.node.children[t],r.node.childCount--,Pf(r)):!n&&!s&&(r.node.children[t]=e.node,r.node.childCount++,Pf(r))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD=/[\[\].#$\/\u0000-\u001F\u007F]/,SD=/[\[\].#$\u0000-\u001F\u007F]/,Jd=10*1024*1024,Mp=function(r){return typeof r=="string"&&r.length!==0&&!AD.test(r)},iA=function(r){return typeof r=="string"&&r.length!==0&&!SD.test(r)},ED=function(r){return r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),iA(r)},sA=function(r){return r===null||typeof r=="string"||typeof r=="number"&&!ru(r)||r&&typeof r=="object"&&Kn(r,".sv")},Xc=function(r,t,e,n){n&&t===void 0||fu(Qa(r,"value"),t,e)},fu=function(r,t,e){const n=e instanceof zt?new Ux(e,r):e;if(t===void 0)throw new Error(r+"contains undefined "+Es(n));if(typeof t=="function")throw new Error(r+"contains a function "+Es(n)+" with contents = "+t.toString());if(ru(t))throw new Error(r+"contains "+t.toString()+" "+Es(n));if(typeof t=="string"&&t.length>Jd/3&&au(t)>Jd)throw new Error(r+"contains a string greater than "+Jd+" utf8 bytes "+Es(n)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let s=!1,o=!1;if(Be(t,(c,h)=>{if(c===".value")s=!0;else if(c!==".priority"&&c!==".sv"&&(o=!0,!Mp(c)))throw new Error(r+" contains an invalid key ("+c+") "+Es(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);jx(n,c),fu(r,h,n),Gx(n)}),s&&o)throw new Error(r+' contains ".value" child '+Es(n)+" in addition to actual children.")}},wD=function(r,t){let e,n;for(e=0;e<t.length;e++){n=t[e];const o=Lo(n);for(let c=0;c<o.length;c++)if(!(o[c]===".priority"&&c===o.length-1)){if(!Mp(o[c]))throw new Error(r+"contains an invalid key ("+o[c]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}t.sort(zx);let s=null;for(e=0;e<t.length;e++){if(n=t[e],s!==null&&Tn(s,n))throw new Error(r+"contains a path "+s.toString()+" that is ancestor of another path "+n.toString());s=n}},CD=function(r,t,e,n){const s=Qa(r,"values");if(!(t&&typeof t=="object")||Array.isArray(t))throw new Error(s+" must be an object containing the children to replace.");const o=[];Be(t,(c,h)=>{const d=new zt(c);if(fu(s,h,oe(e,d)),lp(d)===".priority"&&!sA(h))throw new Error(s+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(d)}),wD(s,o)},TD=function(r,t,e){if(ru(t))throw new Error(Qa(r,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!sA(t))throw new Error(Qa(r,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},aA=function(r,t,e,n){if(!iA(e))throw new Error(Qa(r,t)+'was an invalid path = "'+e+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},xD=function(r,t,e,n){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),aA(r,t,e)},Ha=function(r,t){if(wt(t)===".info")throw new Error(r+" failed = Can't modify data under /.info/")},RD=function(r,t){const e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!Mp(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!ED(e))throw new Error(Qa(r,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Np(r,t){let e=null;for(let n=0;n<t.length;n++){const s=t[n],o=s.getPath();e!==null&&!cp(o,e.path)&&(r.eventLists_.push(e),e=null),e===null&&(e={events:[],path:o}),e.events.push(s)}e&&r.eventLists_.push(e)}function rA(r,t,e){Np(r,e),oA(r,n=>cp(n,t))}function vi(r,t,e){Np(r,e),oA(r,n=>Tn(n,t)||Tn(t,n))}function oA(r,t){r.recursionDepth_++;let e=!0;for(let n=0;n<r.eventLists_.length;n++){const s=r.eventLists_[n];if(s){const o=s.path;t(o)?(MD(r.eventLists_[n]),r.eventLists_[n]=null):e=!1}}e&&(r.eventLists_=[]),r.recursionDepth_--}function MD(r){for(let t=0;t<r.events.length;t++){const e=r.events[t];if(e!==null){r.events[t]=null;const n=e.getEventRunner();Ao&&Oe("event: "+e.toString()),ir(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ND="repo_interrupt",OD=25;class kD{constructor(t,e,n,s){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new DD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Hc(),this.transactionQueueTree_=new Rp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function LD(r,t,e){if(r.stats_=rp(r.repoInfo_),r.forceRestClient_||hx())r.server_=new Fc(r.repoInfo_,(n,s,o,c)=>{iv(r,n,s,o,c)},r.authTokenProvider_,r.appCheckProvider_),setTimeout(()=>sv(r,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ce(e)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}r.persistentConnection_=new _i(r.repoInfo_,t,(n,s,o,c)=>{iv(r,n,s,o,c)},n=>{sv(r,n)},n=>{ID(r,n)},r.authTokenProvider_,r.appCheckProvider_,e),r.server_=r.persistentConnection_}r.authTokenProvider_.addTokenChangeListener(n=>{r.server_.refreshAuthToken(n)}),r.appCheckProvider_.addTokenChangeListener(n=>{r.server_.refreshAppCheckToken(n.token)}),r.statsReporter_=mx(r.repoInfo_,()=>new gR(r.stats_,r.server_)),r.infoData_=new uR,r.infoSyncTree_=new tv({startListening:(n,s,o,c)=>{let h=[];const d=r.infoData_.getNode(n._path);return d.isEmpty()||(h=uu(r.infoSyncTree_,n._path,d),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),kp(r,"connected",!1),r.serverSyncTree_=new tv({startListening:(n,s,o,c)=>(r.server_.listen(n,o,s,(h,d)=>{const f=c(h,d);vi(r.eventQueue_,n._path,f)}),[]),stopListening:(n,s)=>{r.server_.unlisten(n,s)}})}function lA(r){const e=r.infoData_.getNode(new zt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function Op(r){return pD({timestamp:lA(r)})}function iv(r,t,e,n,s){r.dataUpdateCount++;const o=new zt(t);e=r.interceptServerDataCallback_?r.interceptServerDataCallback_(t,e):e;let c=[];if(s)if(n){const d=Nc(e,f=>pe(f));c=cD(r.serverSyncTree_,o,d,s)}else{const d=pe(e);c=lD(r.serverSyncTree_,o,d,s)}else if(n){const d=Nc(e,f=>pe(f));c=aD(r.serverSyncTree_,o,d)}else{const d=pe(e);c=uu(r.serverSyncTree_,o,d)}let h=o;c.length>0&&(h=pu(r,o)),vi(r.eventQueue_,h,c)}function sv(r,t){kp(r,"connected",t),t===!1&&BD(r)}function ID(r,t){Be(t,(e,n)=>{kp(r,e,n)})}function kp(r,t,e){const n=new zt("/.info/"+t),s=pe(e);r.infoData_.updateSnapshot(n,s);const o=uu(r.infoSyncTree_,n,s);vi(r.eventQueue_,n,o)}function cA(r){return r.nextWriteId_++}function PD(r,t,e,n,s){Lp(r,"set",{path:t.toString(),value:e,priority:n});const o=Op(r),c=pe(e,n),h=Ap(r.serverSyncTree_,t),d=J0(c,h,o),f=cA(r),g=W0(r.serverSyncTree_,t,d,f,!0);Np(r.eventQueue_,g),r.server_.put(t.toString(),c.val(!0),(y,b)=>{const A=y==="ok";A||Je("set at "+t+" failed: "+y);const S=xs(r.serverSyncTree_,f,!A);vi(r.eventQueue_,t,S),er(r,s,y,b)});const _=pA(r,t);pu(r,_),vi(r.eventQueue_,_,[])}function BD(r){Lp(r,"onDisconnectEvents");const t=Op(r),e=Hc();Df(r.onDisconnect_,Pt(),(s,o)=>{const c=_D(s,o,r.serverSyncTree_,t);sr(e,s,c)});let n=[];Df(e,Pt(),(s,o)=>{n=n.concat(uu(r.serverSyncTree_,s,o));const c=pA(r,s);pu(r,c)}),r.onDisconnect_=Hc(),vi(r.eventQueue_,Pt(),n)}function FD(r,t,e){r.server_.onDisconnectCancel(t.toString(),(n,s)=>{n==="ok"&&Rf(r.onDisconnect_,t),er(r,e,n,s)})}function av(r,t,e,n){const s=pe(e);r.server_.onDisconnectPut(t.toString(),s.val(!0),(o,c)=>{o==="ok"&&sr(r.onDisconnect_,t,s),er(r,n,o,c)})}function HD(r,t,e,n,s){const o=pe(e,n);r.server_.onDisconnectPut(t.toString(),o.val(!0),(c,h)=>{c==="ok"&&sr(r.onDisconnect_,t,o),er(r,s,c,h)})}function zD(r,t,e,n){if(bf(e)){Oe("onDisconnect().update() called with empty data.  Don't do anything."),er(r,n,"ok",void 0);return}r.server_.onDisconnectMerge(t.toString(),e,(s,o)=>{s==="ok"&&Be(e,(c,h)=>{const d=pe(h);sr(r.onDisconnect_,oe(t,c),d)}),er(r,n,s,o)})}function UD(r,t,e){let n;wt(t._path)===".info"?n=ev(r.infoSyncTree_,t,e):n=ev(r.serverSyncTree_,t,e),rA(r.eventQueue_,t._path,n)}function jD(r,t,e){let n;wt(t._path)===".info"?n=If(r.infoSyncTree_,t,e):n=If(r.serverSyncTree_,t,e),rA(r.eventQueue_,t._path,n)}function GD(r){r.persistentConnection_&&r.persistentConnection_.interrupt(ND)}function Lp(r,...t){let e="";r.persistentConnection_&&(e=r.persistentConnection_.id+":"),Oe(e,...t)}function er(r,t,e,n){t&&ir(()=>{if(e==="ok")t(null);else{const s=(e||"error").toUpperCase();let o=s;n&&(o+=": "+n);const c=new Error(o);c.code=s,t(c)}})}function uA(r,t,e){return Ap(r.serverSyncTree_,t,e)||mt.EMPTY_NODE}function Ip(r,t=r.transactionQueueTree_){if(t||gu(r,t),ar(t)){const e=dA(r,t);Z(e.length>0,"Sending zero length transaction queue"),e.every(s=>s.status===0)&&VD(r,Zo(t),e)}else eA(t)&&du(t,e=>{Ip(r,e)})}function VD(r,t,e){const n=e.map(f=>f.currentWriteId),s=uA(r,t,n);let o=s;const c=s.hash();for(let f=0;f<e.length;f++){const g=e[f];Z(g.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),g.status=1,g.retryCount++;const _=Qe(t,g.path);o=o.updateChild(_,g.currentOutputSnapshotRaw)}const h=o.val(!0),d=t;r.server_.put(d.toString(),h,f=>{Lp(r,"transaction put response",{path:d.toString(),status:f});let g=[];if(f==="ok"){const _=[];for(let y=0;y<e.length;y++)e[y].status=2,g=g.concat(xs(r.serverSyncTree_,e[y].currentWriteId)),e[y].onComplete&&_.push(()=>e[y].onComplete(null,!0,e[y].currentOutputSnapshotResolved)),e[y].unwatcher();gu(r,Dp(r.transactionQueueTree_,t)),Ip(r,r.transactionQueueTree_),vi(r.eventQueue_,t,g);for(let y=0;y<_.length;y++)ir(_[y])}else{if(f==="datastale")for(let _=0;_<e.length;_++)e[_].status===3?e[_].status=4:e[_].status=0;else{Je("transaction at "+d.toString()+" failed: "+f);for(let _=0;_<e.length;_++)e[_].status=4,e[_].abortReason=f}pu(r,t)}},c)}function pu(r,t){const e=hA(r,t),n=Zo(e),s=dA(r,e);return qD(r,s,n),n}function qD(r,t,e){if(t.length===0)return;const n=[];let s=[];const c=t.filter(h=>h.status===0).map(h=>h.currentWriteId);for(let h=0;h<t.length;h++){const d=t[h],f=Qe(e,d.path);let g=!1,_;if(Z(f!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),d.status===4)g=!0,_=d.abortReason,s=s.concat(xs(r.serverSyncTree_,d.currentWriteId,!0));else if(d.status===0)if(d.retryCount>=OD)g=!0,_="maxretry",s=s.concat(xs(r.serverSyncTree_,d.currentWriteId,!0));else{const y=uA(r,d.path,c);d.currentInputSnapshot=y;const b=t[h].update(y.val());if(b!==void 0){fu("transaction failed: Data returned ",b,d.path);let A=pe(b);typeof b=="object"&&b!=null&&Kn(b,".priority")||(A=A.updatePriority(y.getPriority()));const C=d.currentWriteId,w=Op(r),N=J0(A,y,w);d.currentOutputSnapshotRaw=A,d.currentOutputSnapshotResolved=N,d.currentWriteId=cA(r),c.splice(c.indexOf(C),1),s=s.concat(W0(r.serverSyncTree_,d.path,N,d.currentWriteId,d.applyLocally)),s=s.concat(xs(r.serverSyncTree_,C,!0))}else g=!0,_="nodata",s=s.concat(xs(r.serverSyncTree_,d.currentWriteId,!0))}vi(r.eventQueue_,e,s),s=[],g&&(t[h].status=2,(function(y){setTimeout(y,Math.floor(0))})(t[h].unwatcher),t[h].onComplete&&(_==="nodata"?n.push(()=>t[h].onComplete(null,!1,t[h].currentInputSnapshot)):n.push(()=>t[h].onComplete(new Error(_),!1,null))))}gu(r,r.transactionQueueTree_);for(let h=0;h<n.length;h++)ir(n[h]);Ip(r,r.transactionQueueTree_)}function hA(r,t){let e,n=r.transactionQueueTree_;for(e=wt(t);e!==null&&ar(n)===void 0;)n=Dp(n,e),t=Yt(t),e=wt(t);return n}function dA(r,t){const e=[];return fA(r,t,e),e.sort((n,s)=>n.order-s.order),e}function fA(r,t,e){const n=ar(t);if(n)for(let s=0;s<n.length;s++)e.push(n[s]);du(t,s=>{fA(r,s,e)})}function gu(r,t){const e=ar(t);if(e){let n=0;for(let s=0;s<e.length;s++)e[s].status!==2&&(e[n]=e[s],n++);e.length=n,tA(t,e.length>0?e:void 0)}du(t,n=>{gu(r,n)})}function pA(r,t){const e=Zo(hA(r,t)),n=Dp(r.transactionQueueTree_,t);return bD(n,s=>{tf(r,s)}),tf(r,n),nA(n,s=>{tf(r,s)}),e}function tf(r,t){const e=ar(t);if(e){const n=[];let s=[],o=-1;for(let c=0;c<e.length;c++)e[c].status===3||(e[c].status===1?(Z(o===c-1,"All SENT items should be at beginning of queue."),o=c,e[c].status=3,e[c].abortReason="set"):(Z(e[c].status===0,"Unexpected transaction status in abort"),e[c].unwatcher(),s=s.concat(xs(r.serverSyncTree_,e[c].currentWriteId,!0)),e[c].onComplete&&n.push(e[c].onComplete.bind(null,new Error("set"),!1,null))));o===-1?tA(t,void 0):e.length=o+1,vi(r.eventQueue_,Zo(t),s);for(let c=0;c<n.length;c++)ir(n[c])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YD(r){let t="";const e=r.split("/");for(let n=0;n<e.length;n++)if(e[n].length>0){let s=e[n];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}t+="/"+s}return t}function XD(r){const t={};r.charAt(0)==="?"&&(r=r.substring(1));for(const e of r.split("&")){if(e.length===0)continue;const n=e.split("=");n.length===2?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Je(`Invalid query segment '${e}' in query '${r}'`)}return t}const rv=function(r,t){const e=$D(r),n=e.namespace;e.domain==="firebase.com"&&bi(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&e.domain!=="localhost"&&bi("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||nx();const s=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new b0(e.host,e.secure,n,s,t,"",n!==e.subdomain),path:new zt(e.pathString)}},$D=function(r){let t="",e="",n="",s="",o="",c=!0,h="https",d=443;if(typeof r=="string"){let f=r.indexOf("//");f>=0&&(h=r.substring(0,f-1),r=r.substring(f+2));let g=r.indexOf("/");g===-1&&(g=r.length);let _=r.indexOf("?");_===-1&&(_=r.length),t=r.substring(0,Math.min(g,_)),g<_&&(s=YD(r.substring(g,_)));const y=XD(r.substring(Math.min(r.length,_)));f=t.indexOf(":"),f>=0?(c=h==="https"||h==="wss",d=parseInt(t.substring(f+1),10)):f=t.length;const b=t.slice(0,f);if(b.toLowerCase()==="localhost")e="localhost";else if(b.split(".").length<=2)e=b;else{const A=t.indexOf(".");n=t.substring(0,A).toLowerCase(),e=t.substring(A+1),o=n}"ns"in y&&(o=y.ns)}return{host:t,port:d,domain:e,subdomain:n,secure:c,scheme:h,pathString:s,namespace:o}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ov="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",WD=(function(){let r=0;const t=[];return function(e){const n=e===r;r=e;let s;const o=new Array(8);for(s=7;s>=0;s--)o[s]=ov.charAt(e%64),e=Math.floor(e/64);Z(e===0,"Cannot push at time == 0");let c=o.join("");if(n){for(s=11;s>=0&&t[s]===63;s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)c+=ov.charAt(t[s]);return Z(c.length===20,"nextPushId: Length should be 20."),c}})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(t,e,n,s){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=s}getPath(){const t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ce(this.snapshot.exportVal())}}class QD{constructor(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return Z(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(t,e){this._repo=t,this._path=e}cancel(){const t=new gi;return FD(this._repo,this._path,t.wrapCallback(()=>{})),t.promise}remove(){Ha("OnDisconnect.remove",this._path);const t=new gi;return av(this._repo,this._path,null,t.wrapCallback(()=>{})),t.promise}set(t){Ha("OnDisconnect.set",this._path),Xc("OnDisconnect.set",t,this._path,!1);const e=new gi;return av(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}setWithPriority(t,e){Ha("OnDisconnect.setWithPriority",this._path),Xc("OnDisconnect.setWithPriority",t,this._path,!1),TD("OnDisconnect.setWithPriority",e);const n=new gi;return HD(this._repo,this._path,t,e,n.wrapCallback(()=>{})),n.promise}update(t){Ha("OnDisconnect.update",this._path),CD("OnDisconnect.update",t,this._path);const e=new gi;return zD(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp{constructor(t,e,n,s){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=s}get key(){return xt(this._path)?null:lp(this._path)}get ref(){return new ns(this._repo,this._path)}get _queryIdentifier(){const t=Gb(this._queryParams),e=sp(t);return e==="{}"?"default":e}get _queryObject(){return Gb(this._queryParams)}isEqual(t){if(t=zs(t),!(t instanceof Pp))return!1;const e=this._repo===t._repo,n=cp(this._path,t._path),s=this._queryIdentifier===t._queryIdentifier;return e&&n&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Hx(this._path)}}class ns extends Pp{constructor(t,e){super(t,e,new fp,!1)}get parent(){const t=R0(this._path);return t===null?null:new ns(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}}class $c{constructor(t,e,n){this._node=t,this.ref=e,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new zt(t),n=zo(this.ref,t);return new $c(this._node.getChild(e),n,ee)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,s)=>t(new $c(s,zo(this.ref,n),ee)))}hasChild(t){const e=new zt(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function wn(r,t){return r=zs(r),r._checkNotDeleted("ref"),t!==void 0?zo(r._root,t):r._root}function zo(r,t){return r=zs(r),wt(r._path)===null?xD("child","path",t):aA("child","path",t),new ns(r._repo,oe(r._path,t))}function tM(r){return r=zs(r),new JD(r._repo,r._path)}function gA(r,t){r=zs(r),Ha("push",r._path),Xc("push",t,r._path,!0);const e=lA(r._repo),n=WD(e),s=zo(r,n),o=zo(r,n);let c;return t!=null?c=Xa(o,t).then(()=>o):c=Promise.resolve(o),s.then=c.then.bind(c),s.catch=c.then.bind(c,void 0),s}function Xa(r,t){r=zs(r),Ha("set",r._path),Xc("set",t,r._path,!1);const e=new gi;return PD(r._repo,r._path,t,null,e.wrapCallback(()=>{})),e.promise}class Bp{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,e){const n=e._queryParams.getIndex();return new KD("value",this,new $c(t.snapshotNode,new ns(e._repo,e._path),n))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new QD(this,t,e):null}matches(t){return t instanceof Bp?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function eM(r,t,e,n,s){const o=new ZD(e,void 0),c=new Bp(o);return UD(r._repo,r,c),()=>jD(r._repo,r,c)}function za(r,t,e,n){return eM(r,"value",t)}KR(ns);nD(ns);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nM="FIREBASE_DATABASE_EMULATOR_HOST",Bf={};let iM=!1;function sM(r,t,e,n){const s=t.lastIndexOf(":"),o=t.substring(0,s),c=np(o);r.repoInfo_=new b0(t,c,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0,e),n&&(r.authTokenProvider_=n)}function aM(r,t,e,n,s){let o=n||r.options.databaseURL;o===void 0&&(r.options.projectId||bi("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Oe("Using default host for project ",r.options.projectId),o=`${r.options.projectId}-default-rtdb.firebaseio.com`);let c=rv(o,s),h=c.repoInfo,d;typeof process<"u"&&Cb&&(d=Cb[nM]),d?(o=`http://${d}?ns=${h.namespace}`,c=rv(o,s),h=c.repoInfo):c.repoInfo.secure;const f=new fx(r.name,r.options,t);RD("Invalid Firebase Database URL",c),xt(c.path)||bi("Database URL must point to the root of a Firebase Database (not including a child path).");const g=oM(h,r,f,new dx(r,e));return new lM(g,r)}function rM(r,t){const e=Bf[t];(!e||e[r.key]!==r)&&bi(`Database ${t}(${r.repoInfo_}) has already been deleted.`),GD(r),delete e[r.key]}function oM(r,t,e,n){let s=Bf[t.name];s||(s={},Bf[t.name]=s);let o=s[r.toURLString()];return o&&bi("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new kD(r,iM,e,n),s[r.toURLString()]=o,o}class lM{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(LD(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ns(this._repo,Pt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(rM(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&bi("Cannot call "+t+" on a deleted database.")}}function cM(r=BT(),t){const e=OT(r,"database").getImmediate({identifier:t});if(!e._instanceStarted){const n=_C("database");n&&uM(e,...n)}return e}function uM(r,t,e,n={}){r=zs(r),r._checkNotDeleted("useEmulator");const s=`${t}:${e}`,o=r._repoInternal;if(r._instanceStarted){if(s===r._repoInternal.repoInfo_.host&&Oc(n,o.repoInfo_.emulatorOptions))return;bi("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let c;if(o.repoInfo_.nodeAdmin)n.mockUserToken&&bi('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),c=new Tc(Tc.OWNER);else if(n.mockUserToken){const h=typeof n.mockUserToken=="string"?n.mockUserToken:bC(n.mockUserToken,r.app.options.projectId);c=new Tc(h)}np(t)&&(yC(t),SC("Database",!0)),sM(o,s,n,c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hM(r){KT(PT),Lc(new No("database",(t,{instanceIdentifier:e})=>{const n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return aM(n,s,o,e)},"PUBLIC").setMultipleInstances(!0)),Ga(Tb,xb,r),Ga(Tb,xb,"esm2020")}_i.prototype.simpleListen=function(r,t){this.sendRequest("q",{p:r},t)};_i.prototype.echo=function(r,t){this.sendRequest("echo",{d:r},t)};hM();const dM={apiKey:"",authDomain:"watchtask-35eb1.firebaseapp.com",databaseURL:"https://watchtask-35eb1-default-rtdb.firebaseio.com",projectId:"watchtask-35eb1",storageBucket:"watchtask-35eb1.appspot.com",messagingSenderId:"421711878688",appId:"1:421711878688:web:xxxxxxxxxxxxxxxx"},fM=n0(dM),Cn=cM(fM),Na="globalRoom";function pM(){const[r,t]=gt.useState([]),[e,n]=gt.useState("idle"),s=gt.useRef(null),o=gt.useRef(null),c=gt.useRef([]),h=(M,D)=>{const O=wn(Cn,M),B=za(O,D);return c.current.push(()=>B()),O},d=()=>{s.current||(s.current=new RTCPeerConnection,s.current.onicecandidate=M=>{if(M.candidate){const O=s.current.__role==="caller"?"callerCandidates":"calleeCandidates";gA(wn(Cn,`${Na}/${O}`),M.candidate.toJSON())}},s.current.ondatachannel=M=>{o.current=M.channel,o.current.onmessage=g,n("canal listo")})},f=gt.useRef({}),g=M=>{let D=M.data;try{const O=JSON.parse(D);if(O&&O.__type==="chunk"){const{id:B,index:j,total:$,payload:nt}=O;f.current[B]||(f.current[B]={parts:[],total:$}),f.current[B].parts[j]=nt;const tt=f.current[B].parts.filter(Boolean).length;if(n(`recibiendo dataset ${B}: ${tt}/${$}`),tt===$){const lt=f.current[B].parts.join("");delete f.current[B];try{const et=JSON.parse(lt);t(yt=>[...yt,`Peer dataset (${B}) recibido (${et.length||Object.keys(et).length} items)`]),b(et)}catch{t(yt=>[...yt,`Error parseando dataset ${B}`])}n("conectado")}return}else if(O&&O.__type==="info"){t(B=>[...B,`Peer info: ${O.msg}`]);return}}catch{}t(O=>[...O,"Peer: "+D])};let _=null;const y=async()=>{if(_)return _;_=(async()=>{let M=await Cs("pdfDataDB");if(!M.objectStoreNames.contains("pdfData")){const D=M.version+1,O=M.version;M.close();try{M=await Cs("pdfDataDB",D,{upgrade(B){B.objectStoreNames.contains("pdfData")||B.createObjectStore("pdfData",{keyPath:"id"})}}),console.info(`[IndexedDB] pdfData store creado (v${O} -> v${D})`)}catch(B){console.warn("Reintento creación store tras fallo de upgrade",B);let j=await Cs("pdfDataDB");if(j.objectStoreNames.contains("pdfData"))M=j;else{const $=j.version+1;j.close(),M=await Cs("pdfDataDB",$,{upgrade(nt){nt.objectStoreNames.contains("pdfData")||nt.createObjectStore("pdfData",{keyPath:"id"})}}),console.info(`[IndexedDB] pdfData store creado en reintento (v${$})`)}}}return M})();try{return await _}catch(M){throw _=null,M}},b=async M=>{try{console.time("store");const D=await y();console.log("Version DB",D.name,D.version,D.objectStoreNames);const O=D.transaction("pdfData","readwrite");if(console.timeEnd("store"),Array.isArray(M)&&M.length){const B=D.transaction("pdfData","readwrite");for(const j of M)await B.store.put(j);await B.done}}catch(D){if(D&&D.name==="NotFoundError"){console.warn("Object store 'pdfData' aún inexistente tras upgrade; limpiando caché de promesa y reintentando"),_=null;try{const O=await y();if(Array.isArray(M)&&M.length){const B=O.transaction("pdfData","readwrite");for(const j of M)await B.store.put(j);await B.done;return}}catch(O){console.warn("Reintento también falló",O)}}else console.warn("No se pudo almacenar dataset recibido",D)}},A=async()=>{n("conectando..."),d();const M=wn(Cn,`${Na}/offer`);let D;if(await new Promise(O=>{const B=za(M,j=>{D=j.val(),B(),O()})}),D){s.current.__role="callee",await s.current.setRemoteDescription(D);const O=await s.current.createAnswer();await s.current.setLocalDescription(O),await Xa(wn(Cn,`${Na}/answer`),O),n("conectado (callee)")}else{s.current.__role="caller",o.current=s.current.createDataChannel("data"),o.current.onmessage=g,n("creando oferta");const O=await s.current.createOffer();await s.current.setLocalDescription(O),await Xa(M,O),h(`${Na}/answer`,async B=>{const j=B.val();j&&!s.current.currentRemoteDescription&&(await s.current.setRemoteDescription(j),n("conectado (caller)"))})}h(`${Na}/callerCandidates`,O=>{s.current.__role==="callee"&&O.forEach(async B=>{const j=B.val();if(j&&!j.__added)try{await s.current.addIceCandidate(new RTCIceCandidate(j))}catch{}})}),h(`${Na}/calleeCandidates`,O=>{s.current.__role==="caller"&&O.forEach(async B=>{const j=B.val();if(j&&!j.__added)try{await s.current.addIceCandidate(new RTCIceCandidate(j))}catch{}})})},S=()=>{const M="Hola 👋";o.current?.send(M),t(D=>[...D,"Yo: "+M])},C=async()=>await(await y()).transaction("pdfData","readonly").store.getAll(),w=async M=>{if(!o.current)return;const D=JSON.stringify(M),O=14e3,B=Math.ceil(D.length/O),j=Date.now().toString(36);n(`enviando dataset ${j} (${B} chunks)`);for(let $=0;$<B;$++){const nt=D.slice($*O,($+1)*O),tt=JSON.stringify({__type:"chunk",id:j,index:$,total:B,payload:nt});o.current.send(tt),await new Promise(lt=>setTimeout(lt,5))}o.current.send(JSON.stringify({__type:"info",msg:`dataset ${j} enviado`})),n("conectado")},N=async()=>{try{const M=await C();if(!M.length){t(D=>[...D,"DB vacía"]);return}await w(M),t(D=>[...D,`Dataset completo enviado (${M.length} registros)`])}catch{t(D=>[...D,"Error leyendo DB"])}},x=async(M=10)=>{try{const D=await C();if(!D.length){t(B=>[...B,"DB vacía"]);return}const O=D.slice(0,M);await w(O),t(B=>[...B,`Fracción enviada (${O.length}/${D.length})`])}catch{t(O=>[...O,"Error leyendo DB"])}};return gt.useEffect(()=>()=>{c.current.forEach(M=>M()),s.current&&s.current.close()},[]),Q.jsxs("div",{className:"flex flex-col h-full",children:[Q.jsxs("div",{className:"flex items-start justify-between gap-2 flex-wrap mb-4",children:[Q.jsxs("div",{children:[Q.jsx("h2",{className:"heading mb-1",children:"Conexión global WebRTC"}),Q.jsx("p",{className:"text-xs font-mono px-2 py-1 rounded bg-gray-100 border border-gray-200 inline-block",children:e})]}),Q.jsxs("div",{className:"flex flex-wrap gap-2",children:[Q.jsx("button",{onClick:A,disabled:e.startsWith("conectado"),className:"btn btn-primary",children:"Conectar"}),Q.jsx("button",{onClick:S,disabled:!o.current,className:"btn btn-outline",children:"Chat hola"}),Q.jsx("button",{onClick:N,disabled:!o.current,className:"btn btn-outline",children:"DB completa"}),Q.jsx("button",{onClick:()=>x(5),disabled:!o.current,className:"btn btn-outline",children:"5 registros"})]})]}),Q.jsx("ul",{className:"messages flex-1",children:r.map((M,D)=>Q.jsx("li",{children:M},D))})]})}function lv(){return crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}const Yi="peers",gM="profilesDB",Xn="profiles";async function Oa(){return Cs(gM,1,{upgrade(r){r.objectStoreNames.contains(Xn)||r.createObjectStore(Xn,{keyPath:"code"})}})}function mM({autoStart:r=!0}={}){const[t]=gt.useState(()=>lv()),[e,n]=gt.useState(null),[s,o]=gt.useState([]),[c,h]=gt.useState({}),[d,f]=gt.useState([]),[g,_]=gt.useState("idle"),[y,b]=gt.useState(!1),A=gt.useRef(null),S=gt.useRef({}),C=gt.useRef({}),w=gt.useRef(null),N=gt.useRef(!1),x=gt.useCallback(L=>f(q=>[...q,L]),[]),M=gt.useCallback(async()=>{const q=await(await Oa()).getAll(Xn);o(q)},[]),D=gt.useCallback(async L=>{if(!L||!L.code)return;const q=await Oa();await q.get(Xn,L.code)||(await q.put(Xn,L),await M(),x(`Perfil ${L.code} almacenado`))},[M,x]),O=gt.useCallback(async()=>{try{const L=await Oa();if(!await L.get(Xn,"1111")){const J={code:"1111",name:"Root Admin",uuid:lv(),role:"admin",speciality:"admin",password:"1234"};await L.put(Xn,J),x("Perfil root admin creado (1111 / 1234)"),await M()}}catch{x("No se pudo crear root admin")}},[x,M]),B=gt.useCallback(async L=>{if(!N.current)throw new Error("Solo admin puede agregar perfiles");await(await Oa()).put(Xn,L),await M(),Object.values(S.current).forEach(({dc:J})=>{J?.readyState==="open"&&J.send(JSON.stringify({__type:"profile",profile:L}))})},[M]),j=gt.useCallback(async(L,q)=>{const T=await(await Oa()).get(Xn,L);if(!T)throw new Error("Perfil no encontrado local");if(T.password&&T.password!==q)throw new Error("Password incorrecto local");_("validando login remoto"),A.current={code:L,password:q},n(T),N.current=T.role==="admin",Object.values(S.current).forEach(({dc:G})=>{G?.readyState==="open"&&G.send(JSON.stringify({__type:"loginValidateRequest",code:L,password:q}))}),setTimeout(()=>{y||(b(!0),_("login validado (timeout)"),x("Login validado por timeout"))},3e3)},[x,y]),$=gt.useCallback(async()=>{const L=wn(Cn,`${Yi}/${t}`);await Xa(L,{ts:Date.now()}),tM(L).remove().catch(()=>{})},[t]),nt=gt.useCallback(()=>{if(w.current)return;const L=wn(Cn,Yi);w.current=za(L,q=>{const J=q.val()||{},T=Object.keys(J).filter(G=>G!==t);T.forEach(G=>{S.current[G]||tt(G)}),Object.keys(S.current).forEach(G=>{T.includes(G)||(S.current[G].pc.close(),delete S.current[G],h(K=>({...K,[G]:{...K[G]||{},state:"offline"}})))})})},[t]),tt=gt.useCallback(L=>{const q=new RTCPeerConnection,J=q.createDataChannel("mesh");S.current[L]={pc:q,dc:J,makingOffer:!1},h(T=>({...T,[L]:{...T[L]||{},state:"connecting"}})),J.onopen=async()=>{if(h(T=>({...T,[L]:{...T[L]||{},state:"open"}})),x(`Canal abierto con ${L}`),e&&J.send(JSON.stringify({__type:"profile",profile:e})),s.length&&(J.send(JSON.stringify({__type:"profilesSync",profiles:s})),C.current[L]=!0),A.current){const{code:T,password:G}=A.current;J.send(JSON.stringify({__type:"loginValidateRequest",code:T,password:G}))}},J.onmessage=T=>At(L,T.data),J.onclose=()=>h(T=>({...T,[L]:{...T[L]||{},state:"closed"}})),q.onicecandidate=T=>{if(T.candidate){const G=wn(Cn,`${Yi}/${L}/candidates/${t}`);gA(G,T.candidate.toJSON())}},q.onconnectionstatechange=()=>{h(T=>({...T,[L]:{...T[L]||{},connState:q.connectionState}}))},lt(L),et(L,q),yt(L,q)},[x,e,t]),lt=gt.useCallback(async L=>{const q=S.current[L];if(!q)return;const{pc:J}=q;try{const T=await J.createOffer();await J.setLocalDescription(T);const G=wn(Cn,`${Yi}/${L}/offers/${t}`);await Xa(G,T)}catch{x(`Error creando offer a ${L}`)}},[x,t]),et=gt.useCallback((L,q)=>{const J=wn(Cn,`${Yi}/${t}/offers/${L}`);za(J,async G=>{const K=G.val();if(K&&(!q.currentRemoteDescription||q.currentRemoteDescription.type!=="offer")){await q.setRemoteDescription(K);const W=await q.createAnswer();await q.setLocalDescription(W),await Xa(wn(Cn,`${Yi}/${L}/answers/${t}`),W)}});const T=wn(Cn,`${Yi}/${t}/answers/${L}`);za(T,async G=>{const K=G.val();K&&q.signalingState==="have-local-offer"&&await q.setRemoteDescription(K)})},[t]),yt=gt.useCallback((L,q)=>{const J=wn(Cn,`${Yi}/${t}/candidates/${L}`);za(J,async T=>{const G=T.val()||{};for(const K of Object.keys(G)){const W=G[K];try{await q.addIceCandidate(new RTCIceCandidate(W))}catch{}}})},[t]),At=gt.useCallback((L,q)=>{try{const J=JSON.parse(q);if(J.__type==="profile"){h(T=>({...T,[L]:{...T[L]||{},profile:J.profile}})),D(J.profile);return}if(J.__type==="profilesSync"&&Array.isArray(J.profiles)){J.profiles.forEach(T=>D(T));return}if(J.__type==="loginValidateRequest"){const{code:T,password:G}=J;(async()=>{const W=await(await Oa()).get(Xn,T),rt=!!W&&(!W.password||W.password===G),bt=S.current[L];bt?.dc?.readyState==="open"&&bt.dc.send(JSON.stringify({__type:"loginValidateResult",code:T,ok:rt}))})();return}if(J.__type==="loginValidateResult"){A.current&&A.current.code===J.code&&J.ok&&(b(!0),A.current=null,_("login validado (remoto)"),x("Login validado remotamente"));return}}catch{}x(`${L}: ${q}`)},[x,D,s]),P=gt.useCallback(L=>{Object.entries(S.current).forEach(([q,{dc:J}])=>{J?.readyState==="open"&&J.send(L)}),x(`Yo: ${L}`)},[x]);return gt.useEffect(()=>{s.length&&Object.entries(S.current).forEach(([L,{dc:q}])=>{q?.readyState==="open"&&!C.current[L]&&(q.send(JSON.stringify({__type:"profilesSync",profiles:s})),C.current[L]=!0,x(`ProfilesSync enviado diferido a ${L}`))})},[s,x]),gt.useEffect(()=>{if(r)return $(),nt(),(async()=>(await O(),await M()))(),()=>{w.current&&w.current(),Object.values(S.current).forEach(({pc:L})=>L.close())}},[r,$,nt,M,O]),{peerId:t,status:g,messages:d,peers:Object.entries(c).map(([L,q])=>({id:L,...q})),knownProfiles:s,profile:e,addProfile:B,login:j,broadcast:P,isAdmin:N.current,loginValidated:y}}function _M(){const{peerId:r,peers:t,messages:e,knownProfiles:n,profile:s,addProfile:o,login:c,broadcast:h,isAdmin:d,loginValidated:f}=mM(),[g,_]=gt.useState(""),[y,b]=gt.useState(""),[A,S]=gt.useState("maintenance"),[C,w]=gt.useState("mechanic"),[N,x]=gt.useState(""),[M,D]=gt.useState(""),[O,B]=gt.useState(""),[j,$]=gt.useState(""),nt=async()=>{try{await o({code:g.trim(),name:y,uuid:crypto.randomUUID(),role:A,speciality:C,password:j}),_(""),b(""),$("")}catch(et){console.warn(et)}},tt=async()=>{try{await c(N.trim(),M)}catch(et){console.warn(et)}},lt=()=>{O&&(h(O),B(""))};return Q.jsxs("div",{className:"flex flex-col gap-4",children:[Q.jsxs("div",{className:"text-xs font-mono p-2 bg-gray-100 rounded border",children:["PeerId: ",r]}),!s&&Q.jsxs("div",{className:"card bg-white border p-3 flex flex-col gap-2",children:[Q.jsx("h3",{className:"heading",children:"Login"}),Q.jsxs("div",{className:"flex flex-col gap-2",children:[Q.jsxs("div",{className:"flex gap-2",children:[Q.jsx("input",{className:"input",placeholder:"code",value:N,onChange:et=>x(et.target.value)}),Q.jsx("input",{className:"input",placeholder:"password",type:"password",value:M,onChange:et=>D(et.target.value)}),Q.jsx("button",{className:"btn btn-primary",onClick:tt,children:"Entrar"})]}),Q.jsx("div",{className:"text-[10px] text-gray-500",children:f?"Validado":"Pendiente validación"})]})]}),d&&Q.jsxs("div",{className:"card bg-white border p-3 flex flex-col gap-2",children:[Q.jsx("h3",{className:"heading",children:"Agregar Perfil (admin)"}),Q.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Q.jsx("input",{className:"input col-span-1",placeholder:"code",value:g,onChange:et=>_(et.target.value)}),Q.jsx("input",{className:"input col-span-1",placeholder:"nombre",value:y,onChange:et=>b(et.target.value)}),Q.jsxs("select",{className:"input",value:A,onChange:et=>S(et.target.value),children:[Q.jsx("option",{value:"admin",children:"admin"}),Q.jsx("option",{value:"supervisor",children:"supervisor"}),Q.jsx("option",{value:"maintenance",children:"maintenance"})]}),Q.jsxs("select",{className:"input",value:C,onChange:et=>w(et.target.value),children:[Q.jsx("option",{value:"electric",children:"electric"}),Q.jsx("option",{value:"mechanic",children:"mechanic"}),Q.jsx("option",{value:"admin",children:"admin"})]}),Q.jsx("input",{className:"input col-span-2",placeholder:"password",type:"password",value:j,onChange:et=>$(et.target.value)})]}),Q.jsx("button",{className:"btn btn-outline",onClick:nt,disabled:!g||!y,children:"Guardar"})]}),Q.jsxs("div",{className:"card p-3 border flex flex-col gap-2",children:[Q.jsxs("h3",{className:"heading",children:["Perfiles (",n.length,")"]}),Q.jsx("ul",{className:"max-h-40 overflow-auto text-xs space-y-1",children:n.map(et=>Q.jsxs("li",{className:"px-2 py-1 bg-gray-50 rounded border flex justify-between",children:[Q.jsxs("span",{children:[et.code," - ",et.name]}),Q.jsx("span",{className:"opacity-60",children:et.role})]},et.code))})]}),Q.jsxs("div",{className:"card p-3 border flex flex-col gap-2",children:[Q.jsxs("h3",{className:"heading",children:["Peers (",t.length,")"]}),Q.jsx("ul",{className:"text-xs space-y-1 max-h-32 overflow-auto",children:t.map(et=>Q.jsxs("li",{className:"px-2 py-1 bg-blue-50 rounded border border-blue-100",children:[Q.jsxs("div",{className:"flex justify-between",children:[Q.jsx("span",{children:et.id.slice(0,8)}),Q.jsx("span",{children:et.state})]}),et.profile&&Q.jsxs("div",{className:"text-[10px] mt-1 italic",children:[et.profile.name," (",et.profile.role,")"]})]},et.id))})]}),Q.jsxs("div",{className:"card p-3 border flex flex-col gap-2",children:[Q.jsx("h3",{className:"heading",children:"Chat"}),Q.jsxs("div",{className:"flex gap-2",children:[Q.jsx("input",{className:"input flex-1",placeholder:"mensaje",value:O,onChange:et=>B(et.target.value)}),Q.jsx("button",{className:"btn btn-primary",onClick:lt,disabled:!O,children:"Enviar"})]}),Q.jsx("ul",{className:"text-xs max-h-48 overflow-auto space-y-1",children:e.map((et,yt)=>Q.jsx("li",{className:"px-2 py-1 bg-gray-100 rounded",children:et},yt))})]})]})}function yM(){const[r,t]=gt.useState(0),[e,n]=gt.useState(0);gt.useEffect(()=>{navigator.storage&&navigator.storage.persist&&navigator.storage.persist().then(o=>{console.log(o?"Almacenamiento persistente garantizado":"No se pudo garantizar almacenamiento persistente")})},[]),gt.useEffect(()=>{async function o(){const h=await Cs("pdfDataDB",1,{upgrade(f){f.objectStoreNames.contains("pdfData")||f.createObjectStore("pdfData",{keyPath:"id"})}});let d=0;try{d=await h.count("pdfData")}catch{d=0}n(d)}o();const c=setInterval(o,5e3);return()=>clearInterval(c)},[]);async function s(o){await rC(o,t)}return Q.jsxs("div",{className:"min-h-screen flex flex-col",children:[Q.jsx("header",{className:"bg-blue-700 text-white shadow-sm",children:Q.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[Q.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"WatchTask"}),Q.jsx("div",{className:"flex items-center gap-3",children:Q.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium cursor-pointer",children:[Q.jsx("span",{className:"hidden sm:inline",children:"Cargar PDF"}),Q.jsx("input",{type:"file",accept:"application/pdf",onChange:o=>s(o.target.files[0]),className:"block text-sm text-white file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100"})]})})]})}),Q.jsxs("main",{className:"flex-1 max-w-5xl w-full mx-auto px-4 py-6 grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[Q.jsxs("section",{className:"card md:col-span-1 lg:col-span-1 flex flex-col gap-2",children:[Q.jsx("h2",{className:"heading",children:"Resumen"}),Q.jsx("p",{className:"muted",children:"Estado general de los datos procesados."}),Q.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3 text-center",children:[Q.jsxs("div",{className:"p-3 rounded-md bg-blue-50 border border-blue-100",children:[Q.jsx("p",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"Órdenes"}),Q.jsx("p",{className:"text-lg font-semibold text-blue-700",children:r})]}),Q.jsxs("div",{className:"p-3 rounded-md bg-blue-50 border border-blue-100",children:[Q.jsx("p",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"En DB"}),Q.jsx("p",{className:"text-lg font-semibold text-blue-700",children:e})]})]})]}),Q.jsxs("section",{className:"card md:col-span-1 lg:col-span-2 flex flex-col gap-6",children:[Q.jsx(pM,{}),Q.jsx(_M,{})]})]}),Q.jsx("footer",{className:"mt-auto bg-white border-t border-gray-200",children:Q.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-3 text-xs text-gray-500 flex items-center justify-between",children:[Q.jsxs("span",{children:["© ",new Date().getFullYear()," WatchTask v0.0.4.2"]}),Q.jsx("span",{children:"Tailwind UI básico"})]})})]})}XE.createRoot(document.getElementById("root")).render(Q.jsx(gt.StrictMode,{children:Q.jsx(yM,{})}));
